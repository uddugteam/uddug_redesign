"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2918],{2249:function(a,b,c){c.d(b,{M:function(){return Xgd}});var d,e,f=c(3454),g=c(1876).Buffer,h=Object.create,i=Object.defineProperty,j=Object.getOwnPropertyDescriptor,k=Object.getOwnPropertyNames,l=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty,n=(a,b,c)=>b in a?i(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,o=(a,b)=>()=>(b||a((b={exports:{}}).exports,b),b.exports),p=(a,b)=>{for(var c in b)i(a,c,{get:b[c],enumerable:!0})},q=(a,b,c,d)=>{if(b&&"object"==typeof b||"function"==typeof b)for(let e of k(b))m.call(a,e)||e===c||i(a,e,{get:()=>b[e],enumerable:!(d=j(b,e))||d.enumerable});return a},r=(a,b,c)=>(c=null!=a?h(l(a)):{},q(!b&&a&&a.__esModule?c:i(c,"default",{value:a,enumerable:!0}),a)),s=(a,b,c)=>(n(a,"symbol"!=typeof b?b+"":b,c),c),t=o((a,b)=>{!function(c,d){"object"==typeof a?b.exports=d():"function"==typeof define&&define.amd?define(d):c.Alea=d()}(a,function(){"use strict";return a.importState=function(b){var c=new a;return c.importState(b),c},a;function a(){return(function(a){var c=0,d=0,e=0,f=1;0==a.length&&(a=[+new Date]);var g=b();c=g(" "),d=g(" "),e=g(" ");for(var h=0;h<a.length;h++)(c-=g(a[h]))<0&&(c+=1),(d-=g(a[h]))<0&&(d+=1),(e-=g(a[h]))<0&&(e+=1);g=null;var i=function(){var a=2091639*c+23283064365386963e-26*f;return c=d,d=e,e=a-(f=0|a)};return i.next=i,i.uint32=function(){return 4294967296*i()},i.fract53=function(){return i()+(2097152*i()|0)*11102230246251565e-32},i.version="Alea 0.9",i.args=a,i.exportState=function(){return[c,d,e,f]},i.importState=function(a){c=+a[0]||0,d=+a[1]||0,e=+a[2]||0,f=+a[3]||0},i})(Array.prototype.slice.call(arguments))}function b(){var a=4022871197,b=function(b){b=b.toString();for(var c=0;c<b.length;c++){var d=.02519603282416938*(a+=b.charCodeAt(c));d-=a=d>>>0,d*=a,a=d>>>0,d-=a,a+=4294967296*d}return(a>>>0)*23283064365386963e-26};return b.version="Mash 0.9",b}})}),u=o((a,b)=>{!function(c,d){"object"==typeof a&&"u">typeof b?d(a):"function"==typeof define&&define.amd?define(["exports"],d):d((c="u">typeof globalThis?globalThis:c||self).SVDJS={})}(a,function(a){"use strict";a.SVD=function(a,b,c,d,e){if(b=void 0===b||b,c=void 0===c||c,e=1e-64/(d=d||2220446049250313e-31),!a)throw new TypeError("Matrix a is not defined");var f,g,h,i,j,k,l,m,n,o,p,q,r=a[0].length,s=a.length;if(s<r)throw new TypeError("Invalid matrix: m < n");for(var t=[],u=[],v=[],w="f"===b?s:r,x=o=l=0;x<s;x++)u[x]=new Array(w).fill(0);for(x=0;x<r;x++)v[x]=new Array(r).fill(0);var y,z=new Array(r).fill(0);for(x=0;x<s;x++)for(f=0;f<r;f++)u[x][f]=a[x][f];for(x=0;x<r;x++){for(t[x]=l,n=0,h=x+1,f=x;f<s;f++)n+=Math.pow(u[f][x],2);if(n<e)l=0;else for(m=(k=u[x][x])*(l=k<0?Math.sqrt(n):-Math.sqrt(n))-n,u[x][x]=k-l,f=h;f<r;f++){for(n=0,g=x;g<s;g++)n+=u[g][x]*u[g][f];for(k=n/m,g=x;g<s;g++)u[g][f]=u[g][f]+k*u[g][x]}for(z[x]=l,n=0,f=h;f<r;f++)n+=Math.pow(u[x][f],2);if(n<e)l=0;else{for(m=(k=u[x][x+1])*(l=k<0?Math.sqrt(n):-Math.sqrt(n))-n,u[x][x+1]=k-l,f=h;f<r;f++)t[f]=u[x][f]/m;for(f=h;f<s;f++){for(n=0,g=h;g<r;g++)n+=u[f][g]*u[x][g];for(g=h;g<r;g++)u[f][g]=u[f][g]+n*t[g]}}o<(p=Math.abs(z[x])+Math.abs(t[x]))&&(o=p)}if(c)for(x=r-1;0<=x;x--){if(0!==l){for(m=u[x][x+1]*l,f=h;f<r;f++)v[f][x]=u[x][f]/m;for(f=h;f<r;f++){for(n=0,g=h;g<r;g++)n+=u[x][g]*v[g][f];for(g=h;g<r;g++)v[g][f]=v[g][f]+n*v[g][x]}}for(f=h;f<r;f++)v[x][f]=0,v[f][x]=0;v[x][x]=1,l=t[x],h=x}if(b){if("f"===b)for(x=r;x<s;x++){for(f=r;f<s;f++)u[x][f]=0;u[x][x]=1}for(x=r-1;0<=x;x--){for(h=x+1,l=z[x],f=h;f<w;f++)u[x][f]=0;if(0!==l){for(m=u[x][x]*l,f=h;f<w;f++){for(n=0,g=h;g<s;g++)n+=u[g][x]*u[g][f];for(k=n/m,g=x;g<s;g++)u[g][f]=u[g][f]+k*u[g][x]}for(f=x;f<s;f++)u[f][x]=u[f][x]/l}else for(f=x;f<s;f++)u[f][x]=0;u[x][x]=u[x][x]+1}}for(d*=o,g=r-1;0<=g;g--)for(var A=0;A<50;A++){for(y=!1,h=g;0<=h;h--){if(Math.abs(t[h])<=d){y=!0;break}if(Math.abs(z[h-1])<=d)break}if(!y){for(j=0,i=h-(n=1),x=h;x<g+1&&(k=n*t[x],t[x]=j*t[x],!(Math.abs(k)<=d));x++)if(l=z[x],z[x]=Math.sqrt(k*k+l*l),j=l/(m=z[x]),n=-k/m,b)for(f=0;f<s;f++)p=u[f][i],q=u[f][x],u[f][i]=p*j+q*n,u[f][x]=-p*n+q*j}if(q=z[g],h===g){if(q<0&&(z[g]=-q,c))for(f=0;f<r;f++)v[f][g]=-v[f][g];break}for(o=z[h],k=(((p=z[g-1])-q)*(p+q)+((l=t[g-1])-(m=t[g]))*(l+m))/(2*m*p),l=Math.sqrt(k*k+1),k=((o-q)*(o+q)+m*(p/(k<0?k-l:k+l)-m))/o,x=h+(n=j=1);x<g+1;x++){if(l=t[x],p=z[x],m=n*l,l*=j,q=Math.sqrt(k*k+m*m),k=o*(j=k/(t[x-1]=q))+l*(n=m/q),l=-o*n+l*j,m=p*n,p*=j,c)for(f=0;f<r;f++)o=v[f][x-1],q=v[f][x],v[f][x-1]=o*j+q*n,v[f][x]=-o*n+q*j;if(q=Math.sqrt(k*k+m*m),k=(j=k/(z[x-1]=q))*l+(n=m/q)*p,o=-n*l+j*p,b)for(f=0;f<s;f++)p=u[f][x-1],q=u[f][x],u[f][x-1]=p*j+q*n,u[f][x]=-p*n+q*j}t[h]=0,t[g]=k,z[g]=o}for(x=0;x<r;x++)z[x]<d&&(z[x]=0);return{u:u,q:z,v:v}},a.VERSION="1.1.1",Object.defineProperty(a,"__esModule",{value:!0})})}),v=o((a,b)=>{!function(c,d){"object"==typeof a&&"u">typeof b?b.exports=d():"function"==typeof define&&define.amd?define(d):(c=c||self).TinyQueue=d()}(a,function(){"use strict";var a=function(a,c){if(void 0===a&&(a=[]),void 0===c&&(c=b),this.data=a,this.length=this.data.length,this.compare=c,this.length>0)for(var d=(this.length>>1)-1;d>=0;d--)this._down(d)};function b(a,b){return a<b?-1:a>b?1:0}return a.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},a.prototype.pop=function(){if(0!==this.length){var a=this.data[0],b=this.data.pop();return this.length--,this.length>0&&(this.data[0]=b,this._down(0)),a}},a.prototype.peek=function(){return this.data[0]},a.prototype._up=function(a){for(var b=this,c=b.data,d=b.compare,e=c[a];a>0;){var f=a-1>>1,g=c[f];if(d(e,g)>=0)break;c[a]=g,a=f}c[a]=e},a.prototype._down=function(a){for(var b=this,c=b.data,d=b.compare,e=this.length>>1,f=c[a];a<e;){var g=(a<<1)+1,h=c[g],i=g+1;if(i<this.length&&0>d(c[i],h)&&(g=i,h=c[i]),d(h,f)>=0)break;c[a]=h,a=g}c[a]=f},a})}),w=o((a,b)=>{"use strict";var c=v();function d(a,b,d){b=b||1;for(var g,i,j,k,l=0;l<a[0].length;l++){var m=a[0][l];(!l||m[0]<g)&&(g=m[0]),(!l||m[1]<i)&&(i=m[1]),(!l||m[0]>j)&&(j=m[0]),(!l||m[1]>k)&&(k=m[1])}var n=j-g,o=k-i,p=Math.min(n,o),q=p/2;if(0===p){var r=[g,i];return r.distance=0,r}for(var s=new c(void 0,e),t=g;t<j;t+=p)for(var u=i;u<k;u+=p)s.push(new f(t+q,u+q,q,a));var v=h(a),w=new f(g+n/2,i+o/2,0,a);w.d>v.d&&(v=w);for(var x=s.length;s.length;){var y=s.pop();y.d>v.d&&(v=y,d&&console.log("found best %d after %d probes",Math.round(1e4*y.d)/1e4,x)),y.max-v.d<=b||(q=y.h/2,s.push(new f(y.x-q,y.y-q,q,a)),s.push(new f(y.x+q,y.y-q,q,a)),s.push(new f(y.x-q,y.y+q,q,a)),s.push(new f(y.x+q,y.y+q,q,a)),x+=4)}d&&(console.log("num probes: "+x),console.log("best distance: "+v.d));var z=[v.x,v.y];return z.distance=v.d,z}function e(a,b){return b.max-a.max}function f(a,b,c,d){this.x=a,this.y=b,this.h=c,this.d=g(a,b,d),this.max=this.d+this.h*Math.SQRT2}function g(a,b,c){for(var d=!1,e=1/0,f=0;f<c.length;f++)for(var g=c[f],h=0,j=g.length,k=j-1;h<j;k=h++){var l=g[h],m=g[k];l[1]>b!=m[1]>b&&a<(m[0]-l[0])*(b-l[1])/(m[1]-l[1])+l[0]&&(d=!d),e=Math.min(e,i(a,b,l,m))}return 0===e?0:(d?1:-1)*Math.sqrt(e)}function h(a){for(var b=0,c=0,d=0,e=a[0],g=0,h=e.length,i=h-1;g<h;i=g++){var j=e[g],k=e[i],l=j[0]*k[1]-k[0]*j[1];c+=(j[0]+k[0])*l,d+=(j[1]+k[1])*l,b+=3*l}return 0===b?new f(e[0][0],e[0][1],0,a):new f(c/b,d/b,0,a)}function i(a,b,c,d){var e=c[0],f=c[1],g=d[0]-e,h=d[1]-f;if(0!==g||0!==h){var i=((a-e)*g+(b-f)*h)/(g*g+h*h);i>1?(e=d[0],f=d[1]):i>0&&(e+=g*i,f+=h*i)}return(g=a-e)*g+(h=b-f)*h}c.default&&(c=c.default),b.exports=d,b.exports.default=d}),x=o((a,b)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(a){if(null===a|| !0===a|| !1===a)return NaN;var b=Number(a);return isNaN(b)?b:b<0?Math.ceil(b):Math.floor(b)},b.exports=a.default}),y=o((a,b)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(a){var b=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()));return b.setUTCFullYear(a.getFullYear()),a.getTime()-b.getTime()},b.exports=a.default}),z=o(a=>{var b,c,d,e,f,g,h,i,j,k,l,m,n,o;(b=function(){this.init()}).prototype={init:function(){var a=this||c;return a._counter=1e3,a._html5AudioPool=[],a.html5PoolSize=10,a._codecs={},a._howls=[],a._muted=!1,a._volume=1,a._canPlayEvent="canplaythrough",a._navigator="u">typeof window&&window.navigator?window.navigator:null,a.masterGain=null,a.noAudio=!1,a.usingWebAudio=!0,a.autoSuspend=!0,a.ctx=null,a.autoUnlock=!0,a._setup(),a},volume:function(a){var b=this||c;if(a=parseFloat(a),b.ctx||k(),"u">typeof a&&a>=0&&a<=1){if(b._volume=a,b._muted)return b;b.usingWebAudio&&b.masterGain.gain.setValueAtTime(a,c.ctx.currentTime);for(var d=0;d<b._howls.length;d++)if(!b._howls[d]._webAudio)for(var e=b._howls[d]._getSoundIds(),f=0;f<e.length;f++){var g=b._howls[d]._soundById(e[f]);g&&g._node&&(g._node.volume=g._volume*a)}return b}return b._volume},mute:function(a){var b=this||c;b.ctx||k(),b._muted=a,b.usingWebAudio&&b.masterGain.gain.setValueAtTime(a?0:b._volume,c.ctx.currentTime);for(var d=0;d<b._howls.length;d++)if(!b._howls[d]._webAudio)for(var e=b._howls[d]._getSoundIds(),f=0;f<e.length;f++){var g=b._howls[d]._soundById(e[f]);g&&g._node&&(g._node.muted=!!a||g._muted)}return b},stop:function(){for(var a=this||c,b=0;b<a._howls.length;b++)a._howls[b].stop();return a},unload:function(){for(var a=this||c,b=a._howls.length-1;b>=0;b--)a._howls[b].unload();return a.usingWebAudio&&a.ctx&&"u">typeof a.ctx.close&&(a.ctx.close(),a.ctx=null,k()),a},codecs:function(a){return(this||c)._codecs[a.replace(/^x-/,"")]},_setup:function(){var a=this||c;if(a.state=a.ctx&&a.ctx.state||"suspended",a._autoSuspend(),!a.usingWebAudio)if("u">typeof Audio)try{var b=new Audio;typeof b.oncanplaythrough>"u"&&(a._canPlayEvent="canplay")}catch{a.noAudio=!0}else a.noAudio=!0;try{var b=new Audio;b.muted&&(a.noAudio=!0)}catch{}return a.noAudio||a._setupCodecs(),a},_setupCodecs:function(){var a=this||c,b=null;try{b="u">typeof Audio?new Audio:null}catch{return a}if(!b||"function"!=typeof b.canPlayType)return a;var d=b.canPlayType("audio/mpeg;").replace(/^no$/,""),e=a._navigator?a._navigator.userAgent:"",f=e.match(/OPR\/([0-6].)/g),g=f&&33>parseInt(f[0].split("/")[1],10),h=-1!==e.indexOf("Safari")&& -1===e.indexOf("Chrome"),i=e.match(/Version\/(.*?) /),j=h&&i&&15>parseInt(i[1],10);return a._codecs={mp3:!!(!g&&(d||b.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!d,opus:!!b.canPlayType("audio/ogg; codecs=\"opus\"").replace(/^no$/,""),ogg:!!b.canPlayType("audio/ogg; codecs=\"vorbis\"").replace(/^no$/,""),oga:!!b.canPlayType("audio/ogg; codecs=\"vorbis\"").replace(/^no$/,""),wav:!!(b.canPlayType("audio/wav; codecs=\"1\"")||b.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!b.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!b.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(b.canPlayType("audio/x-m4a;")||b.canPlayType("audio/m4a;")||b.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(b.canPlayType("audio/x-m4b;")||b.canPlayType("audio/m4b;")||b.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(b.canPlayType("audio/x-mp4;")||b.canPlayType("audio/mp4;")||b.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!j&&b.canPlayType("audio/webm; codecs=\"vorbis\"").replace(/^no$/,"")),webm:!!(!j&&b.canPlayType("audio/webm; codecs=\"vorbis\"").replace(/^no$/,"")),dolby:!!b.canPlayType("audio/mp4; codecs=\"ec-3\"").replace(/^no$/,""),flac:!!(b.canPlayType("audio/x-flac;")||b.canPlayType("audio/flac;")).replace(/^no$/,"")},a},_unlockAudio:function(){var a=this||c;if(!(a._audioUnlocked||!a.ctx)){a._audioUnlocked=!1,a.autoUnlock=!1,a._mobileUnloaded||44100===a.ctx.sampleRate||(a._mobileUnloaded=!0,a.unload()),a._scratchBuffer=a.ctx.createBuffer(1,1,22050);var b=function(c){for(;a._html5AudioPool.length<a.html5PoolSize;)try{var d=new Audio;d._unlocked=!0,a._releaseHtml5Audio(d)}catch{a.noAudio=!0;break}for(var e=0;e<a._howls.length;e++)if(!a._howls[e]._webAudio)for(var f=a._howls[e]._getSoundIds(),g=0;g<f.length;g++){var h=a._howls[e]._soundById(f[g]);h&&h._node&&!h._node._unlocked&&(h._node._unlocked=!0,h._node.load())}a._autoResume();var i=a.ctx.createBufferSource();i.buffer=a._scratchBuffer,i.connect(a.ctx.destination),typeof i.start>"u"?i.noteOn(0):i.start(0),"function"==typeof a.ctx.resume&&a.ctx.resume(),i.onended=function(){i.disconnect(0),a._audioUnlocked=!0,document.removeEventListener("touchstart",b,!0),document.removeEventListener("touchend",b,!0),document.removeEventListener("click",b,!0),document.removeEventListener("keydown",b,!0);for(var c=0;c<a._howls.length;c++)a._howls[c]._emit("unlock")}};return document.addEventListener("touchstart",b,!0),document.addEventListener("touchend",b,!0),document.addEventListener("click",b,!0),document.addEventListener("keydown",b,!0),a}},_obtainHtml5Audio:function(){var a=this||c;if(a._html5AudioPool.length)return a._html5AudioPool.pop();var b=new Audio().play();return b&&"u">typeof Promise&&(b instanceof Promise||"function"==typeof b.then)&&b.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(a){var b=this||c;return a._unlocked&&b._html5AudioPool.push(a),b},_autoSuspend:function(){var a=this;if(!(!a.autoSuspend||!a.ctx|| typeof a.ctx.suspend>"u"||!c.usingWebAudio)){for(var b=0;b<a._howls.length;b++)if(a._howls[b]._webAudio){for(var d=0;d<a._howls[b]._sounds.length;d++)if(!a._howls[b]._sounds[d]._paused)return a}return a._suspendTimer&&clearTimeout(a._suspendTimer),a._suspendTimer=setTimeout(function(){if(a.autoSuspend){a._suspendTimer=null,a.state="suspending";var b=function(){a.state="suspended",a._resumeAfterSuspend&&(delete a._resumeAfterSuspend,a._autoResume())};a.ctx.suspend().then(b,b)}},3e4),a}},_autoResume:function(){var a=this;if(!(!a.ctx|| typeof a.ctx.resume>"u"||!c.usingWebAudio))return"running"===a.state&&"interrupted"!==a.ctx.state&&a._suspendTimer?(clearTimeout(a._suspendTimer),a._suspendTimer=null):"suspended"===a.state||"running"===a.state&&"interrupted"===a.ctx.state?(a.ctx.resume().then(function(){a.state="running";for(var b=0;b<a._howls.length;b++)a._howls[b]._emit("resume")}),a._suspendTimer&&(clearTimeout(a._suspendTimer),a._suspendTimer=null)):"suspending"===a.state&&(a._resumeAfterSuspend=!0),a}},c=new b,(d=function(a){var b=this;if(!a.src||0===a.src.length){console.error("An array of source files must be passed with any new Howl.");return}b.init(a)}).prototype={init:function(a){var b=this;return c.ctx||k(),b._autoplay=a.autoplay||!1,b._format="string"!=typeof a.format?a.format:[a.format],b._html5=a.html5||!1,b._muted=a.mute||!1,b._loop=a.loop||!1,b._pool=a.pool||5,b._preload="boolean"!=typeof a.preload&&"metadata"!==a.preload||a.preload,b._rate=a.rate||1,b._sprite=a.sprite||{},b._src="string"!=typeof a.src?a.src:[a.src],b._volume=void 0!==a.volume?a.volume:1,b._xhr={method:a.xhr&&a.xhr.method?a.xhr.method:"GET",headers:a.xhr&&a.xhr.headers?a.xhr.headers:null,withCredentials:!!a.xhr&&!!a.xhr.withCredentials&&a.xhr.withCredentials},b._duration=0,b._state="unloaded",b._sounds=[],b._endTimers={},b._queue=[],b._playLock=!1,b._onend=a.onend?[{fn:a.onend}]:[],b._onfade=a.onfade?[{fn:a.onfade}]:[],b._onload=a.onload?[{fn:a.onload}]:[],b._onloaderror=a.onloaderror?[{fn:a.onloaderror}]:[],b._onplayerror=a.onplayerror?[{fn:a.onplayerror}]:[],b._onpause=a.onpause?[{fn:a.onpause}]:[],b._onplay=a.onplay?[{fn:a.onplay}]:[],b._onstop=a.onstop?[{fn:a.onstop}]:[],b._onmute=a.onmute?[{fn:a.onmute}]:[],b._onvolume=a.onvolume?[{fn:a.onvolume}]:[],b._onrate=a.onrate?[{fn:a.onrate}]:[],b._onseek=a.onseek?[{fn:a.onseek}]:[],b._onunlock=a.onunlock?[{fn:a.onunlock}]:[],b._onresume=[],b._webAudio=c.usingWebAudio&&!b._html5,"u">typeof c.ctx&&c.ctx&&c.autoUnlock&&c._unlockAudio(),c._howls.push(b),b._autoplay&&b._queue.push({event:"play",action:function(){b.play()}}),b._preload&&"none"!==b._preload&&b.load(),b},load:function(){var a,b,d=this,f=null;if(c.noAudio){d._emit("loaderror",null,"No audio support.");return}"string"==typeof d._src&&(d._src=[d._src]);for(var h=0;h<d._src.length;h++){if(d._format&&d._format[h])a=d._format[h];else{if("string"!=typeof(b=d._src[h])){d._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(a=/^data:audio\/([^;,]+);/i.exec(b))||(a=/\.([^.]+)$/.exec(b.split("?",1)[0])),a&&(a=a[1].toLowerCase())}if(a||console.warn("No file extension was found. Consider using the \"format\" property or specify an extension."),a&&c.codecs(a)){f=d._src[h];break}}if(!f){d._emit("loaderror",null,"No codec support for selected audio sources.");return}return d._src=f,d._state="loading","https:"===window.location.protocol&&"http:"===f.slice(0,5)&&(d._html5=!0,d._webAudio=!1),new e(d),d._webAudio&&g(d),d},play:function(a,b){var d=this,e=null;if("number"==typeof a)e=a,a=null;else{if("string"==typeof a&&"loaded"===d._state&&!d._sprite[a])return null;if(typeof a>"u"&&(a="__default",!d._playLock)){for(var f=0,g=0;g<d._sounds.length;g++)d._sounds[g]._paused&&!d._sounds[g]._ended&&(f++,e=d._sounds[g]._id);1===f?a=null:e=null}}var h=e?d._soundById(e):d._inactiveSound();if(!h)return null;if(e&&!a&&(a=h._sprite||"__default"),"loaded"!==d._state){h._sprite=a,h._ended=!1;var i=h._id;return d._queue.push({event:"play",action:function(){d.play(i)}}),i}if(e&&!h._paused)return b||d._loadQueue("play"),h._id;d._webAudio&&c._autoResume();var j=Math.max(0,h._seek>0?h._seek:d._sprite[a][0]/1e3),k=Math.max(0,(d._sprite[a][0]+d._sprite[a][1])/1e3-j),l=1e3*k/Math.abs(h._rate),m=d._sprite[a][0]/1e3,n=(d._sprite[a][0]+d._sprite[a][1])/1e3;h._sprite=a,h._ended=!1;var o=function(){h._paused=!1,h._seek=j,h._start=m,h._stop=n,h._loop=!!(h._loop||d._sprite[a][2])};if(j>=n){d._ended(h);return}var p=h._node;if(d._webAudio){var q=function(){d._playLock=!1,o(),d._refreshBuffer(h);var a=h._muted||d._muted?0:h._volume;p.gain.setValueAtTime(a,c.ctx.currentTime),h._playStart=c.ctx.currentTime,typeof p.bufferSource.start>"u"?h._loop?p.bufferSource.noteGrainOn(0,j,86400):p.bufferSource.noteGrainOn(0,j,k):h._loop?p.bufferSource.start(0,j,86400):p.bufferSource.start(0,j,k),l!==1/0&&(d._endTimers[h._id]=setTimeout(d._ended.bind(d,h),l)),b||setTimeout(function(){d._emit("play",h._id),d._loadQueue()},0)};"running"===c.state&&"interrupted"!==c.ctx.state?q():(d._playLock=!0,d.once("resume",q),d._clearTimer(h._id))}else{var r=function(){p.currentTime=j,p.muted=h._muted||d._muted||c._muted||p.muted,p.volume=h._volume*c.volume(),p.playbackRate=h._rate;try{var e=p.play();if(e&&"u">typeof Promise&&(e instanceof Promise||"function"==typeof e.then)?(d._playLock=!0,o(),e.then(function(){d._playLock=!1,p._unlocked=!0,b?d._loadQueue():d._emit("play",h._id)}).catch(function(){d._playLock=!1,d._emit("playerror",h._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),h._ended=!0,h._paused=!0})):b||(d._playLock=!1,o(),d._emit("play",h._id)),p.playbackRate=h._rate,p.paused){d._emit("playerror",h._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}"__default"!==a||h._loop?d._endTimers[h._id]=setTimeout(d._ended.bind(d,h),l):(d._endTimers[h._id]=function(){d._ended(h),p.removeEventListener("ended",d._endTimers[h._id],!1)},p.addEventListener("ended",d._endTimers[h._id],!1))}catch(f){d._emit("playerror",h._id,f)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===p.src&&(p.src=d._src,p.load());var s=window&&window.ejecta|| !p.readyState&&c._navigator.isCocoonJS;if(p.readyState>=3||s)r();else{d._playLock=!0,d._state="loading";var t=function(){d._state="loaded",r(),p.removeEventListener(c._canPlayEvent,t,!1)};p.addEventListener(c._canPlayEvent,t,!1),d._clearTimer(h._id)}}return h._id},pause:function(a){var b=this;if("loaded"!==b._state||b._playLock)return b._queue.push({event:"pause",action:function(){b.pause(a)}}),b;for(var c=b._getSoundIds(a),d=0;d<c.length;d++){b._clearTimer(c[d]);var e=b._soundById(c[d]);if(e&&!e._paused&&(e._seek=b.seek(c[d]),e._rateSeek=0,e._paused=!0,b._stopFade(c[d]),e._node))if(b._webAudio){if(!e._node.bufferSource)continue;typeof e._node.bufferSource.stop>"u"?e._node.bufferSource.noteOff(0):e._node.bufferSource.stop(0),b._cleanBuffer(e._node)}else isNaN(e._node.duration)&&e._node.duration!==1/0||e._node.pause();arguments[1]||b._emit("pause",e?e._id:null)}return b},stop:function(a,b){var c=this;if("loaded"!==c._state||c._playLock)return c._queue.push({event:"stop",action:function(){c.stop(a)}}),c;for(var d=c._getSoundIds(a),e=0;e<d.length;e++){c._clearTimer(d[e]);var f=c._soundById(d[e]);f&&(f._seek=f._start||0,f._rateSeek=0,f._paused=!0,f._ended=!0,c._stopFade(d[e]),f._node&&(c._webAudio?f._node.bufferSource&&(typeof f._node.bufferSource.stop>"u"?f._node.bufferSource.noteOff(0):f._node.bufferSource.stop(0),c._cleanBuffer(f._node)):isNaN(f._node.duration)&&f._node.duration!==1/0||(f._node.currentTime=f._start||0,f._node.pause(),f._node.duration===1/0&&c._clearSound(f._node))),b||c._emit("stop",f._id))}return c},mute:function(a,b){var d=this;if("loaded"!==d._state||d._playLock)return d._queue.push({event:"mute",action:function(){d.mute(a,b)}}),d;if(typeof b>"u")if("boolean"!=typeof a)return d._muted;else d._muted=a;for(var e=d._getSoundIds(b),f=0;f<e.length;f++){var g=d._soundById(e[f]);g&&(g._muted=a,g._interval&&d._stopFade(g._id),d._webAudio&&g._node?g._node.gain.setValueAtTime(a?0:g._volume,c.ctx.currentTime):g._node&&(g._node.muted=!!c._muted||a),d._emit("mute",g._id))}return d},volume:function(){var a,b,d,e=this,f=arguments;if(0===f.length)return e._volume;if(1===f.length||2===f.length&& typeof f[1]>"u"?e._getSoundIds().indexOf(f[0])>=0?d=parseInt(f[0],10):b=parseFloat(f[0]):f.length>=2&&(b=parseFloat(f[0]),d=parseInt(f[1],10)),!("u">typeof b)||!(b>=0)||!(b<=1))return(a=d?e._soundById(d):e._sounds[0])?a._volume:0;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"volume",action:function(){e.volume.apply(e,f)}}),e;typeof d>"u"&&(e._volume=b),d=e._getSoundIds(d);for(var g=0;g<d.length;g++)(a=e._soundById(d[g]))&&(a._volume=b,f[2]||e._stopFade(d[g]),e._webAudio&&a._node&&!a._muted?a._node.gain.setValueAtTime(b,c.ctx.currentTime):a._node&&!a._muted&&(a._node.volume=b*c.volume()),e._emit("volume",a._id));return e},fade:function(a,b,d,e){var f=this;if("loaded"!==f._state||f._playLock)return f._queue.push({event:"fade",action:function(){f.fade(a,b,d,e)}}),f;a=Math.min(Math.max(0,parseFloat(a)),1),b=Math.min(Math.max(0,parseFloat(b)),1),d=parseFloat(d),f.volume(a,e);for(var g=f._getSoundIds(e),h=0;h<g.length;h++){var i=f._soundById(g[h]);if(i){if(e||f._stopFade(g[h]),f._webAudio&&!i._muted){var j=c.ctx.currentTime,k=j+d/1e3;i._volume=a,i._node.gain.setValueAtTime(a,j),i._node.gain.linearRampToValueAtTime(b,k)}f._startFadeInterval(i,a,b,d,g[h],typeof e>"u")}}return f},_startFadeInterval:function(a,b,c,d,e,f){var g=this,h=b,i=c-b,j=Math.abs(i/.01),k=Math.max(4,j>0?d/j:d),l=Date.now();a._fadeTo=c,a._interval=setInterval(function(){var e=(Date.now()-l)/d;l=Date.now(),h=Math.round(100*(h+=i*e))/100,h=i<0?Math.max(c,h):Math.min(c,h),g._webAudio?a._volume=h:g.volume(h,a._id,!0),f&&(g._volume=h),(c<b&&h<=c||c>b&&h>=c)&&(clearInterval(a._interval),a._interval=null,a._fadeTo=null,g.volume(c,a._id),g._emit("fade",a._id))},k)},_stopFade:function(a){var b=this,d=b._soundById(a);return d&&d._interval&&(b._webAudio&&d._node.gain.cancelScheduledValues(c.ctx.currentTime),clearInterval(d._interval),d._interval=null,b.volume(d._fadeTo,a),d._fadeTo=null,b._emit("fade",a)),b},loop:function(){var a,b,c,d=this,e=arguments;if(0===e.length)return d._loop;if(1===e.length)if("boolean"!=typeof e[0])return!!(c=d._soundById(parseInt(e[0],10)))&&c._loop;else a=e[0],d._loop=a;else 2===e.length&&(a=e[0],b=parseInt(e[1],10));for(var f=d._getSoundIds(b),g=0;g<f.length;g++)(c=d._soundById(f[g]))&&(c._loop=a,d._webAudio&&c._node&&c._node.bufferSource&&(c._node.bufferSource.loop=a,a&&(c._node.bufferSource.loopStart=c._start||0,c._node.bufferSource.loopEnd=c._stop,d.playing(f[g])&&(d.pause(f[g],!0),d.play(f[g],!0)))));return d},rate:function(){var a,b,d,e=this,f=arguments;if(0===f.length?d=e._sounds[0]._id:1===f.length?e._getSoundIds().indexOf(f[0])>=0?d=parseInt(f[0],10):b=parseFloat(f[0]):2===f.length&&(b=parseFloat(f[0]),d=parseInt(f[1],10)),"number"!=typeof b)return(a=e._soundById(d))?a._rate:e._rate;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"rate",action:function(){e.rate.apply(e,f)}}),e;typeof d>"u"&&(e._rate=b),d=e._getSoundIds(d);for(var g=0;g<d.length;g++)if(a=e._soundById(d[g])){e.playing(d[g])&&(a._rateSeek=e.seek(d[g]),a._playStart=e._webAudio?c.ctx.currentTime:a._playStart),a._rate=b,e._webAudio&&a._node&&a._node.bufferSource?a._node.bufferSource.playbackRate.setValueAtTime(b,c.ctx.currentTime):a._node&&(a._node.playbackRate=b);var h=e.seek(d[g]),i=(e._sprite[a._sprite][0]+e._sprite[a._sprite][1])/1e3-h,j=1e3*i/Math.abs(a._rate);(e._endTimers[d[g]]||!a._paused)&&(e._clearTimer(d[g]),e._endTimers[d[g]]=setTimeout(e._ended.bind(e,a),j)),e._emit("rate",a._id)}return e},seek:function(){var a,b,d=this,e=arguments;if(0===e.length?d._sounds.length&&(b=d._sounds[0]._id):1===e.length?d._getSoundIds().indexOf(e[0])>=0?b=parseInt(e[0],10):d._sounds.length&&(b=d._sounds[0]._id,a=parseFloat(e[0])):2===e.length&&(a=parseFloat(e[0]),b=parseInt(e[1],10)),typeof b>"u")return 0;if("number"==typeof a&&("loaded"!==d._state||d._playLock))return d._queue.push({event:"seek",action:function(){d.seek.apply(d,e)}}),d;var f=d._soundById(b);if(f)if("number"==typeof a&&a>=0){var g=d.playing(b);g&&d.pause(b,!0),f._seek=a,f._ended=!1,d._clearTimer(b),d._webAudio||!f._node||isNaN(f._node.duration)||(f._node.currentTime=a);var h=function(){g&&d.play(b,!0),d._emit("seek",b)};if(g&&!d._webAudio){var i=function(){d._playLock?setTimeout(i,0):h()};setTimeout(i,0)}else h()}else{if(!d._webAudio)return f._node.currentTime;var j=d.playing(b)?c.ctx.currentTime-f._playStart:0,k=f._rateSeek?f._rateSeek-f._seek:0;return f._seek+(k+j*Math.abs(f._rate))}return d},playing:function(a){var b=this;if("number"==typeof a){var c=b._soundById(a);return!!c&&!c._paused}for(var d=0;d<b._sounds.length;d++)if(!b._sounds[d]._paused)return!0;return!1},duration:function(a){var b=this,c=b._duration,d=b._soundById(a);return d&&(c=b._sprite[d._sprite][1]/1e3),c},state:function(){return this._state},unload:function(){for(var a=this,b=a._sounds,d=0;d<b.length;d++)b[d]._paused||a.stop(b[d]._id),a._webAudio||(a._clearSound(b[d]._node),b[d]._node.removeEventListener("error",b[d]._errorFn,!1),b[d]._node.removeEventListener(c._canPlayEvent,b[d]._loadFn,!1),b[d]._node.removeEventListener("ended",b[d]._endFn,!1),c._releaseHtml5Audio(b[d]._node)),delete b[d]._node,a._clearTimer(b[d]._id);var e=c._howls.indexOf(a);e>=0&&c._howls.splice(e,1);var g=!0;for(d=0;d<c._howls.length;d++)if(c._howls[d]._src===a._src||a._src.indexOf(c._howls[d]._src)>=0){g=!1;break}return f&&g&&delete f[a._src],c.noAudio=!1,a._state="unloaded",a._sounds=[],a=null,null},on:function(a,b,c,d){var e=this,f=e["_on"+a];return"function"==typeof b&&f.push(d?{id:c,fn:b,once:d}:{id:c,fn:b}),e},off:function(a,b,c){var d=this,e=d["_on"+a],f=0;if("number"==typeof b&&(c=b,b=null),b||c)for(f=0;f<e.length;f++){var g=c===e[f].id;if(b===e[f].fn&&g|| !b&&g){e.splice(f,1);break}}else if(a)d["_on"+a]=[];else{var h=Object.keys(d);for(f=0;f<h.length;f++)0===h[f].indexOf("_on")&&Array.isArray(d[h[f]])&&(d[h[f]]=[])}return d},once:function(a,b,c){var d=this;return d.on(a,b,c,1),d},_emit:function(a,b,c){for(var d=this,e=d["_on"+a],f=e.length-1;f>=0;f--)(!e[f].id||e[f].id===b||"load"===a)&&(setTimeout((function(a){a.call(this,b,c)}).bind(d,e[f].fn),0),e[f].once&&d.off(a,e[f].fn,e[f].id));return d._loadQueue(a),d},_loadQueue:function(a){var b=this;if(b._queue.length>0){var c=b._queue[0];c.event===a&&(b._queue.shift(),b._loadQueue()),a||c.action()}return b},_ended:function(a){var b=this,d=a._sprite;if(!b._webAudio&&a._node&&!a._node.paused&&!a._node.ended&&a._node.currentTime<a._stop)return setTimeout(b._ended.bind(b,a),100),b;var e=!!(a._loop||b._sprite[d][2]);if(b._emit("end",a._id),!b._webAudio&&e&&b.stop(a._id,!0).play(a._id),b._webAudio&&e){b._emit("play",a._id),a._seek=a._start||0,a._rateSeek=0,a._playStart=c.ctx.currentTime;var f=(a._stop-a._start)*1e3/Math.abs(a._rate);b._endTimers[a._id]=setTimeout(b._ended.bind(b,a),f)}return b._webAudio&&!e&&(a._paused=!0,a._ended=!0,a._seek=a._start||0,a._rateSeek=0,b._clearTimer(a._id),b._cleanBuffer(a._node),c._autoSuspend()),b._webAudio||e||b.stop(a._id,!0),b},_clearTimer:function(a){var b=this;if(b._endTimers[a]){if("function"!=typeof b._endTimers[a])clearTimeout(b._endTimers[a]);else{var c=b._soundById(a);c&&c._node&&c._node.removeEventListener("ended",b._endTimers[a],!1)}delete b._endTimers[a]}return b},_soundById:function(a){for(var b=this,c=0;c<b._sounds.length;c++)if(a===b._sounds[c]._id)return b._sounds[c];return null},_inactiveSound:function(){var a=this;a._drain();for(var b=0;b<a._sounds.length;b++)if(a._sounds[b]._ended)return a._sounds[b].reset();return new e(a)},_drain:function(){var a=this,b=a._pool,c=0,d=0;if(!(a._sounds.length<b)){for(d=0;d<a._sounds.length;d++)a._sounds[d]._ended&&c++;for(d=a._sounds.length-1;d>=0;d--){if(c<=b)return;a._sounds[d]._ended&&(a._webAudio&&a._sounds[d]._node&&a._sounds[d]._node.disconnect(0),a._sounds.splice(d,1),c--)}}},_getSoundIds:function(a){var b=this;if(!(typeof a>"u"))return[a];for(var c=[],d=0;d<b._sounds.length;d++)c.push(b._sounds[d]._id);return c},_refreshBuffer:function(a){var b=this;return a._node.bufferSource=c.ctx.createBufferSource(),a._node.bufferSource.buffer=f[b._src],a._panner?a._node.bufferSource.connect(a._panner):a._node.bufferSource.connect(a._node),a._node.bufferSource.loop=a._loop,a._loop&&(a._node.bufferSource.loopStart=a._start||0,a._node.bufferSource.loopEnd=a._stop||0),a._node.bufferSource.playbackRate.setValueAtTime(a._rate,c.ctx.currentTime),b},_cleanBuffer:function(a){var b=this,d=c._navigator&&c._navigator.vendor.indexOf("Apple")>=0;if(c._scratchBuffer&&a.bufferSource&&(a.bufferSource.onended=null,a.bufferSource.disconnect(0),d))try{a.bufferSource.buffer=c._scratchBuffer}catch{}return a.bufferSource=null,b},_clearSound:function(a){/MSIE |Trident\//.test(c._navigator&&c._navigator.userAgent)||(a.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}},(e=function(a){this._parent=a,this.init()}).prototype={init:function(){var a=this,b=a._parent;return a._muted=b._muted,a._loop=b._loop,a._volume=b._volume,a._rate=b._rate,a._seek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++c._counter,b._sounds.push(a),a.create(),a},create:function(){var a=this,b=a._parent,d=c._muted||a._muted||a._parent._muted?0:a._volume;return b._webAudio?(a._node=typeof c.ctx.createGain>"u"?c.ctx.createGainNode():c.ctx.createGain(),a._node.gain.setValueAtTime(d,c.ctx.currentTime),a._node.paused=!0,a._node.connect(c.masterGain)):c.noAudio||(a._node=c._obtainHtml5Audio(),a._errorFn=a._errorListener.bind(a),a._node.addEventListener("error",a._errorFn,!1),a._loadFn=a._loadListener.bind(a),a._node.addEventListener(c._canPlayEvent,a._loadFn,!1),a._endFn=a._endListener.bind(a),a._node.addEventListener("ended",a._endFn,!1),a._node.src=b._src,a._node.preload=!0===b._preload?"auto":b._preload,a._node.volume=d*c.volume(),a._node.load()),a},reset:function(){var a=this,b=a._parent;return a._muted=b._muted,a._loop=b._loop,a._volume=b._volume,a._rate=b._rate,a._seek=0,a._rateSeek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++c._counter,a},_errorListener:function(){var a=this;a._parent._emit("loaderror",a._id,a._node.error?a._node.error.code:0),a._node.removeEventListener("error",a._errorFn,!1)},_loadListener:function(){var a=this,b=a._parent;b._duration=Math.ceil(10*a._node.duration)/10,0===Object.keys(b._sprite).length&&(b._sprite={__default:[0,1e3*b._duration]}),"loaded"!==b._state&&(b._state="loaded",b._emit("load"),b._loadQueue()),a._node.removeEventListener(c._canPlayEvent,a._loadFn,!1)},_endListener:function(){var a=this,b=a._parent;b._duration===1/0&&(b._duration=Math.ceil(10*a._node.duration)/10,b._sprite.__default[1]===1/0&&(b._sprite.__default[1]=1e3*b._duration),b._ended(a)),a._node.removeEventListener("ended",a._endFn,!1)}},f={},g=function(a){var b=a._src;if(f[b]){a._duration=f[b].duration,j(a);return}if(/^data:[^;]+;base64,/.test(b)){for(var c=atob(b.split(",")[1]),d=new Uint8Array(c.length),e=0;e<c.length;++e)d[e]=c.charCodeAt(e);i(d.buffer,a)}else{var g=new XMLHttpRequest;g.open(a._xhr.method,b,!0),g.withCredentials=a._xhr.withCredentials,g.responseType="arraybuffer",a._xhr.headers&&Object.keys(a._xhr.headers).forEach(function(b){g.setRequestHeader(b,a._xhr.headers[b])}),g.onload=function(){var b=(g.status+"")[0];if("0"!==b&&"2"!==b&&"3"!==b){a._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");return}i(g.response,a)},g.onerror=function(){a._webAudio&&(a._html5=!0,a._webAudio=!1,a._sounds=[],delete f[b],a.load())},h(g)}},h=function(a){try{a.send()}catch{a.onerror()}},i=function(a,b){var d=function(){b._emit("loaderror",null,"Decoding audio data failed.")},e=function(a){a&&b._sounds.length>0?(f[b._src]=a,j(b,a)):d()};"u">typeof Promise&&1===c.ctx.decodeAudioData.length?c.ctx.decodeAudioData(a).then(e).catch(d):c.ctx.decodeAudioData(a,e,d)},j=function(a,b){b&&!a._duration&&(a._duration=b.duration),0===Object.keys(a._sprite).length&&(a._sprite={__default:[0,1e3*a._duration]}),"loaded"!==a._state&&(a._state="loaded",a._emit("load"),a._loadQueue())},k=function(){if(c.usingWebAudio){try{"u">typeof AudioContext?c.ctx=new AudioContext:"u">typeof webkitAudioContext?c.ctx=new webkitAudioContext:c.usingWebAudio=!1}catch{c.usingWebAudio=!1}c.ctx||(c.usingWebAudio=!1);var a=/iP(hone|od|ad)/.test(c._navigator&&c._navigator.platform),b=c._navigator&&c._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),d=b?parseInt(b[1],10):null;if(a&&d&&d<9){var e=/safari/.test(c._navigator&&c._navigator.userAgent.toLowerCase());c._navigator&&!e&&(c.usingWebAudio=!1)}c.usingWebAudio&&(c.masterGain=typeof c.ctx.createGain>"u"?c.ctx.createGainNode():c.ctx.createGain(),c.masterGain.gain.setValueAtTime(c._muted?0:c._volume,c.ctx.currentTime),c.masterGain.connect(c.ctx.destination)),c._setup()}},"function"==typeof define&&define.amd&&define([],function(){return{Howler:c,Howl:d}}),"u">typeof a&&(a.Howler=c,a.Howl=d),"u">typeof global?(global.HowlerGlobal=b,global.Howler=c,global.Howl=d,global.Sound=e):"u">typeof window&&(window.HowlerGlobal=b,window.Howler=c,window.Howl=d,window.Sound=e),HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(a){var b=this;if(!b.ctx||!b.ctx.listener)return b;for(var c=b._howls.length-1;c>=0;c--)b._howls[c].stereo(a);return b},HowlerGlobal.prototype.pos=function(a,b,c){var d=this;return d.ctx&&d.ctx.listener?(b="number"!=typeof b?d._pos[1]:b,c="number"!=typeof c?d._pos[2]:c,"number"!=typeof a)?d._pos:(d._pos=[a,b,c],"u">typeof d.ctx.listener.positionX?(d.ctx.listener.positionX.setTargetAtTime(d._pos[0],Howler.ctx.currentTime,.1),d.ctx.listener.positionY.setTargetAtTime(d._pos[1],Howler.ctx.currentTime,.1),d.ctx.listener.positionZ.setTargetAtTime(d._pos[2],Howler.ctx.currentTime,.1)):d.ctx.listener.setPosition(d._pos[0],d._pos[1],d._pos[2]),d):d},HowlerGlobal.prototype.orientation=function(a,b,c,d,e,f){var g=this;if(!g.ctx||!g.ctx.listener)return g;var h=g._orientation;return(b="number"!=typeof b?h[1]:b,c="number"!=typeof c?h[2]:c,d="number"!=typeof d?h[3]:d,e="number"!=typeof e?h[4]:e,f="number"!=typeof f?h[5]:f,"number"!=typeof a)?h:(g._orientation=[a,b,c,d,e,f],"u">typeof g.ctx.listener.forwardX?(g.ctx.listener.forwardX.setTargetAtTime(a,Howler.ctx.currentTime,.1),g.ctx.listener.forwardY.setTargetAtTime(b,Howler.ctx.currentTime,.1),g.ctx.listener.forwardZ.setTargetAtTime(c,Howler.ctx.currentTime,.1),g.ctx.listener.upX.setTargetAtTime(d,Howler.ctx.currentTime,.1),g.ctx.listener.upY.setTargetAtTime(e,Howler.ctx.currentTime,.1),g.ctx.listener.upZ.setTargetAtTime(f,Howler.ctx.currentTime,.1)):g.ctx.listener.setOrientation(a,b,c,d,e,f),g)},l=Howl.prototype.init,Howl.prototype.init=function(a){var b=this;return b._orientation=a.orientation||[1,0,0],b._stereo=a.stereo||null,b._pos=a.pos||null,b._pannerAttr={coneInnerAngle:"u">typeof a.coneInnerAngle?a.coneInnerAngle:360,coneOuterAngle:"u">typeof a.coneOuterAngle?a.coneOuterAngle:360,coneOuterGain:"u">typeof a.coneOuterGain?a.coneOuterGain:0,distanceModel:"u">typeof a.distanceModel?a.distanceModel:"inverse",maxDistance:"u">typeof a.maxDistance?a.maxDistance:1e4,panningModel:"u">typeof a.panningModel?a.panningModel:"HRTF",refDistance:"u">typeof a.refDistance?a.refDistance:1,rolloffFactor:"u">typeof a.rolloffFactor?a.rolloffFactor:1},b._onstereo=a.onstereo?[{fn:a.onstereo}]:[],b._onpos=a.onpos?[{fn:a.onpos}]:[],b._onorientation=a.onorientation?[{fn:a.onorientation}]:[],l.call(this,a)},Howl.prototype.stereo=function(a,b){var c=this;if(!c._webAudio)return c;if("loaded"!==c._state)return c._queue.push({event:"stereo",action:function(){c.stereo(a,b)}}),c;var d=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof b>"u")if("number"!=typeof a)return c._stereo;else c._stereo=a,c._pos=[a,0,0];for(var e=c._getSoundIds(b),f=0;f<e.length;f++){var g=c._soundById(e[f]);if(g)if("number"!=typeof a)return g._stereo;else g._stereo=a,g._pos=[a,0,0],g._node&&(g._pannerAttr.panningModel="equalpower",g._panner&&g._panner.pan||o(g,d),"spatial"===d?"u">typeof g._panner.positionX?(g._panner.positionX.setValueAtTime(a,Howler.ctx.currentTime),g._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),g._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):g._panner.setPosition(a,0,0):g._panner.pan.setValueAtTime(a,Howler.ctx.currentTime)),c._emit("stereo",g._id)}return c},Howl.prototype.pos=function(a,b,c,d){var e=this;if(!e._webAudio)return e;if("loaded"!==e._state)return e._queue.push({event:"pos",action:function(){e.pos(a,b,c,d)}}),e;if(b="number"!=typeof b?0:b,c="number"!=typeof c?-0.5:c,typeof d>"u")if("number"!=typeof a)return e._pos;else e._pos=[a,b,c];for(var f=e._getSoundIds(d),g=0;g<f.length;g++){var h=e._soundById(f[g]);if(h)if("number"!=typeof a)return h._pos;else h._pos=[a,b,c],h._node&&((!h._panner||h._panner.pan)&&o(h,"spatial"),"u">typeof h._panner.positionX?(h._panner.positionX.setValueAtTime(a,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(b,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(c,Howler.ctx.currentTime)):h._panner.setPosition(a,b,c)),e._emit("pos",h._id)}return e},Howl.prototype.orientation=function(a,b,c,d){var e=this;if(!e._webAudio)return e;if("loaded"!==e._state)return e._queue.push({event:"orientation",action:function(){e.orientation(a,b,c,d)}}),e;if(b="number"!=typeof b?e._orientation[1]:b,c="number"!=typeof c?e._orientation[2]:c,typeof d>"u")if("number"!=typeof a)return e._orientation;else e._orientation=[a,b,c];for(var f=e._getSoundIds(d),g=0;g<f.length;g++){var h=e._soundById(f[g]);if(h)if("number"!=typeof a)return h._orientation;else h._orientation=[a,b,c],h._node&&(h._panner||(h._pos||(h._pos=e._pos||[0,0,-0.5]),o(h,"spatial")),"u">typeof h._panner.orientationX?(h._panner.orientationX.setValueAtTime(a,Howler.ctx.currentTime),h._panner.orientationY.setValueAtTime(b,Howler.ctx.currentTime),h._panner.orientationZ.setValueAtTime(c,Howler.ctx.currentTime)):h._panner.setOrientation(a,b,c)),e._emit("orientation",h._id)}return e},Howl.prototype.pannerAttr=function(){var a,b,c,d=this,e=arguments;if(!d._webAudio)return d;if(0===e.length)return d._pannerAttr;if(1===e.length)if("object"!=typeof e[0])return(c=d._soundById(parseInt(e[0],10)))?c._pannerAttr:d._pannerAttr;else a=e[0],typeof b>"u"&&(a.pannerAttr||(a.pannerAttr={coneInnerAngle:a.coneInnerAngle,coneOuterAngle:a.coneOuterAngle,coneOuterGain:a.coneOuterGain,distanceModel:a.distanceModel,maxDistance:a.maxDistance,refDistance:a.refDistance,rolloffFactor:a.rolloffFactor,panningModel:a.panningModel}),d._pannerAttr={coneInnerAngle:"u">typeof a.pannerAttr.coneInnerAngle?a.pannerAttr.coneInnerAngle:d._coneInnerAngle,coneOuterAngle:"u">typeof a.pannerAttr.coneOuterAngle?a.pannerAttr.coneOuterAngle:d._coneOuterAngle,coneOuterGain:"u">typeof a.pannerAttr.coneOuterGain?a.pannerAttr.coneOuterGain:d._coneOuterGain,distanceModel:"u">typeof a.pannerAttr.distanceModel?a.pannerAttr.distanceModel:d._distanceModel,maxDistance:"u">typeof a.pannerAttr.maxDistance?a.pannerAttr.maxDistance:d._maxDistance,refDistance:"u">typeof a.pannerAttr.refDistance?a.pannerAttr.refDistance:d._refDistance,rolloffFactor:"u">typeof a.pannerAttr.rolloffFactor?a.pannerAttr.rolloffFactor:d._rolloffFactor,panningModel:"u">typeof a.pannerAttr.panningModel?a.pannerAttr.panningModel:d._panningModel});else 2===e.length&&(a=e[0],b=parseInt(e[1],10));for(var f=d._getSoundIds(b),g=0;g<f.length;g++)if(c=d._soundById(f[g])){var h=c._pannerAttr;h={coneInnerAngle:"u">typeof a.coneInnerAngle?a.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:"u">typeof a.coneOuterAngle?a.coneOuterAngle:h.coneOuterAngle,coneOuterGain:"u">typeof a.coneOuterGain?a.coneOuterGain:h.coneOuterGain,distanceModel:"u">typeof a.distanceModel?a.distanceModel:h.distanceModel,maxDistance:"u">typeof a.maxDistance?a.maxDistance:h.maxDistance,refDistance:"u">typeof a.refDistance?a.refDistance:h.refDistance,rolloffFactor:"u">typeof a.rolloffFactor?a.rolloffFactor:h.rolloffFactor,panningModel:"u">typeof a.panningModel?a.panningModel:h.panningModel};var i=c._panner;i?(i.coneInnerAngle=h.coneInnerAngle,i.coneOuterAngle=h.coneOuterAngle,i.coneOuterGain=h.coneOuterGain,i.distanceModel=h.distanceModel,i.maxDistance=h.maxDistance,i.refDistance=h.refDistance,i.rolloffFactor=h.rolloffFactor,i.panningModel=h.panningModel):(c._pos||(c._pos=d._pos||[0,0,-0.5]),o(c,"spatial"))}return d},m=Sound.prototype.init,Sound.prototype.init=function(){var a=this,b=a._parent;a._orientation=b._orientation,a._stereo=b._stereo,a._pos=b._pos,a._pannerAttr=b._pannerAttr,m.call(this),a._stereo?b.stereo(a._stereo):a._pos&&b.pos(a._pos[0],a._pos[1],a._pos[2],a._id)},n=Sound.prototype.reset,Sound.prototype.reset=function(){var a=this,b=a._parent;return a._orientation=b._orientation,a._stereo=b._stereo,a._pos=b._pos,a._pannerAttr=b._pannerAttr,a._stereo?b.stereo(a._stereo):a._pos?b.pos(a._pos[0],a._pos[1],a._pos[2],a._id):a._panner&&(a._panner.disconnect(0),a._panner=void 0,b._refreshBuffer(a)),n.call(this)},o=function(a,b){"spatial"===(b=b||"spatial")?(a._panner=Howler.ctx.createPanner(),a._panner.coneInnerAngle=a._pannerAttr.coneInnerAngle,a._panner.coneOuterAngle=a._pannerAttr.coneOuterAngle,a._panner.coneOuterGain=a._pannerAttr.coneOuterGain,a._panner.distanceModel=a._pannerAttr.distanceModel,a._panner.maxDistance=a._pannerAttr.maxDistance,a._panner.refDistance=a._pannerAttr.refDistance,a._panner.rolloffFactor=a._pannerAttr.rolloffFactor,a._panner.panningModel=a._pannerAttr.panningModel,"u">typeof a._panner.positionX?(a._panner.positionX.setValueAtTime(a._pos[0],Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(a._pos[1],Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(a._pos[2],Howler.ctx.currentTime)):a._panner.setPosition(a._pos[0],a._pos[1],a._pos[2]),"u">typeof a._panner.orientationX?(a._panner.orientationX.setValueAtTime(a._orientation[0],Howler.ctx.currentTime),a._panner.orientationY.setValueAtTime(a._orientation[1],Howler.ctx.currentTime),a._panner.orientationZ.setValueAtTime(a._orientation[2],Howler.ctx.currentTime)):a._panner.setOrientation(a._orientation[0],a._orientation[1],a._orientation[2])):(a._panner=Howler.ctx.createStereoPanner(),a._panner.pan.setValueAtTime(a._stereo,Howler.ctx.currentTime)),a._panner.connect(a._node),a._paused||a._parent.pause(a._id,!0).play(a._id,!0)}}),A=o((a,b)=>{"use strict";function c(a,b,d,e){this.message=a,this.expected=b,this.found=d,this.location=e,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,c)}(function(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c})(c,Error),c.buildMessage=function(a,b){var c,d={literal:function(a){return"\""+f(a.text)+"\""},class:function(a){var b,c="";for(b=0;b<a.parts.length;b++)c+=a.parts[b]instanceof Array?g(a.parts[b][0])+"-"+g(a.parts[b][1]):g(a.parts[b]);return"["+(a.inverted?"^":"")+c+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};function e(a){return a.charCodeAt(0).toString(16).toUpperCase()}function f(a){return a.replace(/\\/g,"\\\\").replace(/"/g,"\\\"").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+e(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+e(a)})}function g(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+e(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+e(a)})}function h(a){return d[a.type](a)}return"Expected "+(function(a){var b,c,d=new Array(a.length);for(b=0;b<a.length;b++)d[b]=h(a[b]);if(d.sort(),d.length>0){for(b=1,c=1;b<d.length;b++)d[b-1]!==d[b]&&(d[c]=d[b],c++);d.length=c}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}})(a)+" but "+((c=b)?"\""+f(c)+"\"":"end of input")+" found."},b.exports={SyntaxError:c,parse:function(a,b){b=void 0!==b?b:{};var d,e,f,g,h,i,j,k,l={},m={svg_path:wa},n=wa,o=function(a){if(!a)return[];for(var b=[],c=0;c<a.length;c++)b=b.concat.apply(b,a[c]);var d=b[0];return d&&"m"==d.code&&(delete d.relative,d.code="M"),b},p=function(a,b){return fb(a,b)},q=/^[Mm]/,r=ta(["M","m"],!1,!1),s=function(a,b,c){var d=ib(a,[b]);return c&&(d=d.concat(ib("M"==a?"L":"l",c[1]))),d},t=/^[Zz]/,u=ta(["Z","z"],!1,!1),v=function(){return ib("Z")},w=/^[Ll]/,x=ta(["L","l"],!1,!1),y=function(a,b){return ib(a,b)},z=/^[Hh]/,A=ta(["H","h"],!1,!1),B=function(a,b){return ib(a,b.map(function(a){return{x:a}}))},C=/^[Vv]/,D=ta(["V","v"],!1,!1),E=function(a,b){return ib(a,b.map(function(a){return{y:a}}))},F=/^[Cc]/,G=ta(["C","c"],!1,!1),H=function(a,b,c){return{x1:a.x,y1:a.y,x2:b.x,y2:b.y,x:c.x,y:c.y}},I=/^[Ss]/,J=ta(["S","s"],!1,!1),K=function(a,b){return{x2:a.x,y2:a.y,x:b.x,y:b.y}},L=/^[Qq]/,M=ta(["Q","q"],!1,!1),N=function(a,b){return{x1:a.x,y1:a.y,x:b.x,y:b.y}},O=/^[Tt]/,P=ta(["T","t"],!1,!1),Q=/^[Aa]/,R=ta(["A","a"],!1,!1),S=function(a,b,c,d,e,f){return{rx:a,ry:b,xAxisRotation:c,largeArc:d,sweep:e,x:f.x,y:f.y}},T=function(a,b){return{x:a,y:b}},U=function(a){return 1*a},V=function(a){return 1*a.join("")},W=/^[01]/,X=ta(["0","1"],!1,!1),Y=function(a){return"1"==a},Z=function(){return""},$=",",_=sa(",",!1),aa=function(a){return a.join("")},ba=".",ca=sa(".",!1),da=/^[eE]/,ea=ta(["e","E"],!1,!1),fa=/^[+\-]/,ga=ta(["+","-"],!1,!1),ha=/^[0-9]/,ia=ta([["0","9"]],!1,!1),ja=function(a){return a.join("")},ka=/^[ \t\n\r]/,la=ta([" ","\t",`
`,"\r"],!1,!1),ma=0,na=0,oa=[{line:1,column:1}],pa=0,qa=[],ra=0;if("startRule"in b){if(!(b.startRule in m))throw new Error("Can't start parsing from rule \""+b.startRule+"\".");n=m[b.startRule]}function sa(a,b){return{type:"literal",text:a,ignoreCase:b}}function ta(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function ua(b){var c,d=oa[b];if(d)return d;for(c=b-1;!oa[c];)c--;for(d={line:(d=oa[c]).line,column:d.column};c<b;)10===a.charCodeAt(c)?(d.line++,d.column=1):d.column++,c++;return oa[b]=d,d}function va(a){ma<pa||(ma>pa&&(pa=ma,qa=[]),qa.push(a))}function wa(){var a,b,c,d,e;for(a=ma,b=[],c=eb();c!==l;)b.push(c),c=eb();if(b!==l)if((c=xa())===l&&(c=null),c!==l){for(d=[],e=eb();e!==l;)d.push(e),e=eb();d!==l?(na=a,a=b=o(c)):(ma=a,a=l)}else ma=a,a=l;else ma=a,a=l;return a}function xa(){var a,b,c,d,e,f;if(a=ma,(b=ya())!==l){for(c=[],d=ma,e=[],f=eb();f!==l;)e.push(f),f=eb();for(e!==l&&(f=ya())!==l?d=e=[e,f]:(ma=d,d=l);d!==l;){for(c.push(d),d=ma,e=[],f=eb();f!==l;)e.push(f),f=eb();e!==l&&(f=ya())!==l?d=e=[e,f]:(ma=d,d=l)}c!==l?(na=a,a=b=p(b,c)):(ma=a,a=l)}else ma=a,a=l;return a}function ya(){var a,b,c,d,e,f;if(a=ma,(b=Aa())!==l){for(c=[],d=ma,e=[],f=eb();f!==l;)e.push(f),f=eb();for(e!==l&&(f=za())!==l?d=e=[e,f]:(ma=d,d=l);d!==l;){for(c.push(d),d=ma,e=[],f=eb();f!==l;)e.push(f),f=eb();e!==l&&(f=za())!==l?d=e=[e,f]:(ma=d,d=l)}c!==l?(na=a,a=b=p(b,c)):(ma=a,a=l)}else ma=a,a=l;return a}function za(){var a;return(a=Ba())===l&&(a=Ca())===l&&(a=Ea())===l&&(a=Ga())===l&&(a=Ha())===l&&(a=Ka())===l&&(a=Na())===l&&(a=Qa())===l&&(a=Sa()),a}function Aa(){var b,c,d,e,f,g,h;if(b=ma,q.test(a.charAt(ma))?(c=a.charAt(ma),ma++):(c=l,0===ra&&va(r)),c!==l){for(d=[],e=eb();e!==l;)d.push(e),e=eb();d!==l&&(e=Va())!==l?(f=ma,(g=Za())===l&&(g=null),g!==l&&(h=Da())!==l?f=g=[g,h]:(ma=f,f=l),f===l&&(f=null),f!==l?(na=b,b=c=s(c,e,f)):(ma=b,b=l)):(ma=b,b=l)}else ma=b,b=l;return b}function Ba(){var b,c;return b=ma,t.test(a.charAt(ma))?(c=a.charAt(ma),ma++):(c=l,0===ra&&va(u)),c!==l&&(na=b,c=v()),b=c}function Ca(){var b,c,d,e;if(b=ma,w.test(a.charAt(ma))?(c=a.charAt(ma),ma++):(c=l,0===ra&&va(x)),c!==l){for(d=[],e=eb();e!==l;)d.push(e),e=eb();d!==l&&(e=Da())!==l?(na=b,b=c=y(c,e)):(ma=b,b=l)}else ma=b,b=l;return b}function Da(){var a,b,c,d,e,f;if(a=ma,(b=Va())!==l){for(c=[],d=ma,(e=Za())===l&&(e=null),e!==l&&(f=Va())!==l?d=e=[e,f]:(ma=d,d=l);d!==l;)c.push(d),d=ma,(e=Za())===l&&(e=null),e!==l&&(f=Va())!==l?d=e=[e,f]:(ma=d,d=l);c!==l?(na=a,a=b=p(b,c)):(ma=a,a=l)}else ma=a,a=l;return a}function Ea(){var b,c,d,e;if(b=ma,z.test(a.charAt(ma))?(c=a.charAt(ma),ma++):(c=l,0===ra&&va(A)),c!==l){for(d=[],e=eb();e!==l;)d.push(e),e=eb();d!==l&&(e=Fa())!==l?(na=b,b=c=B(c,e)):(ma=b,b=l)}else ma=b,b=l;return b}function Fa(){var a,b,c,d,e,f;if(a=ma,(b=Xa())!==l){for(c=[],d=ma,(e=Za())===l&&(e=null),e!==l&&(f=Xa())!==l?d=e=[e,f]:(ma=d,d=l);d!==l;)c.push(d),d=ma,(e=Za())===l&&(e=null),e!==l&&(f=Xa())!==l?d=e=[e,f]:(ma=d,d=l);c!==l?(na=a,a=b=p(b,c)):(ma=a,a=l)}else ma=a,a=l;return a}function Ga(){var b,c,d,e;if(b=ma,C.test(a.charAt(ma))?(c=a.charAt(ma),ma++):(c=l,0===ra&&va(D)),c!==l){for(d=[],e=eb();e!==l;)d.push(e),e=eb();d!==l&&(e=Fa())!==l?(na=b,b=c=E(c,e)):(ma=b,b=l)}else ma=b,b=l;return b}function Ha(){var b,c,d,e;if(b=ma,F.test(a.charAt(ma))?(c=a.charAt(ma),ma++):(c=l,0===ra&&va(G)),c!==l){for(d=[],e=eb();e!==l;)d.push(e),e=eb();d!==l&&(e=Ia())!==l?(na=b,b=c=y(c,e)):(ma=b,b=l)}else ma=b,b=l;return b}function Ia(){var a,b,c,d,e,f;if(a=ma,(b=Ja())!==l){for(c=[],d=ma,(e=Za())===l&&(e=null),e!==l&&(f=Ja())!==l?d=e=[e,f]:(ma=d,d=l);d!==l;)c.push(d),d=ma,(e=Za())===l&&(e=null),e!==l&&(f=Ja())!==l?d=e=[e,f]:(ma=d,d=l);c!==l?(na=a,a=b=p(b,c)):(ma=a,a=l)}else ma=a,a=l;return a}function Ja(){var a,b,c,d,e,f;return a=ma,(b=Va())!==l?((c=Za())===l&&(c=null),c!==l&&(d=Va())!==l?((e=Za())===l&&(e=null),e!==l&&(f=Va())!==l?(na=a,a=b=H(b,d,f)):(ma=a,a=l)):(ma=a,a=l)):(ma=a,a=l),a}function Ka(){var b,c,d,e;if(b=ma,I.test(a.charAt(ma))?(c=a.charAt(ma),ma++):(c=l,0===ra&&va(J)),c!==l){for(d=[],e=eb();e!==l;)d.push(e),e=eb();d!==l&&(e=La())!==l?(na=b,b=c=y(c,e)):(ma=b,b=l)}else ma=b,b=l;return b}function La(){var a,b,c,d,e,f;if(a=ma,(b=Ma())!==l){for(c=[],d=ma,(e=Za())===l&&(e=null),e!==l&&(f=Ma())!==l?d=e=[e,f]:(ma=d,d=l);d!==l;)c.push(d),d=ma,(e=Za())===l&&(e=null),e!==l&&(f=Ma())!==l?d=e=[e,f]:(ma=d,d=l);c!==l?(na=a,a=b=p(b,c)):(ma=a,a=l)}else ma=a,a=l;return a}function Ma(){var a,b,c,d;return a=ma,(b=Va())!==l?((c=Za())===l&&(c=null),c!==l&&(d=Va())!==l?(na=a,a=b=K(b,d)):(ma=a,a=l)):(ma=a,a=l),a}function Na(){var b,c,d,e;if(b=ma,L.test(a.charAt(ma))?(c=a.charAt(ma),ma++):(c=l,0===ra&&va(M)),c!==l){for(d=[],e=eb();e!==l;)d.push(e),e=eb();d!==l&&(e=Oa())!==l?(na=b,b=c=y(c,e)):(ma=b,b=l)}else ma=b,b=l;return b}function Oa(){var a,b,c,d,e,f;if(a=ma,(b=Pa())!==l){for(c=[],d=ma,(e=Za())===l&&(e=null),e!==l&&(f=Pa())!==l?d=e=[e,f]:(ma=d,d=l);d!==l;)c.push(d),d=ma,(e=Za())===l&&(e=null),e!==l&&(f=Pa())!==l?d=e=[e,f]:(ma=d,d=l);c!==l?(na=a,a=b=p(b,c)):(ma=a,a=l)}else ma=a,a=l;return a}function Pa(){var a,b,c,d;return a=ma,(b=Va())!==l?((c=Za())===l&&(c=null),c!==l&&(d=Va())!==l?(na=a,a=b=N(b,d)):(ma=a,a=l)):(ma=a,a=l),a}function Qa(){var b,c,d,e;if(b=ma,O.test(a.charAt(ma))?(c=a.charAt(ma),ma++):(c=l,0===ra&&va(P)),c!==l){for(d=[],e=eb();e!==l;)d.push(e),e=eb();d!==l&&(e=Ra())!==l?(na=b,b=c=y(c,e)):(ma=b,b=l)}else ma=b,b=l;return b}function Ra(){var a,b,c,d,e,f;if(a=ma,(b=Va())!==l){for(c=[],d=ma,(e=Za())===l&&(e=null),e!==l&&(f=Va())!==l?d=e=[e,f]:(ma=d,d=l);d!==l;)c.push(d),d=ma,(e=Za())===l&&(e=null),e!==l&&(f=Va())!==l?d=e=[e,f]:(ma=d,d=l);c!==l?(na=a,a=b=p(b,c)):(ma=a,a=l)}else ma=a,a=l;return a}function Sa(){var b,c,d,e;if(b=ma,Q.test(a.charAt(ma))?(c=a.charAt(ma),ma++):(c=l,0===ra&&va(R)),c!==l){for(d=[],e=eb();e!==l;)d.push(e),e=eb();d!==l&&(e=Ta())!==l?(na=b,b=c=y(c,e)):(ma=b,b=l)}else ma=b,b=l;return b}function Ta(){var a,b,c,d,e,f;if(a=ma,(b=Ua())!==l){for(c=[],d=ma,(e=Za())===l&&(e=null),e!==l&&(f=Ua())!==l?d=e=[e,f]:(ma=d,d=l);d!==l;)c.push(d),d=ma,(e=Za())===l&&(e=null),e!==l&&(f=Ua())!==l?d=e=[e,f]:(ma=d,d=l);c!==l?(na=a,a=b=p(b,c)):(ma=a,a=l)}else ma=a,a=l;return a}function Ua(){var a,b,c,d,e,f,g,h,i,j,k;return a=ma,(b=Wa())!==l?((c=Za())===l&&(c=null),c!==l&&(d=Wa())!==l?((e=Za())===l&&(e=null),e!==l&&(f=Xa())!==l&&Za()!==l&&(g=Ya())!==l?((h=Za())===l&&(h=null),h!==l&&(i=Ya())!==l?((j=Za())===l&&(j=null),j!==l&&(k=Va())!==l?(na=a,a=b=S(b,d,f,g,i,k)):(ma=a,a=l)):(ma=a,a=l)):(ma=a,a=l)):(ma=a,a=l)):(ma=a,a=l),a}function Va(){var a,b,c,d;return a=ma,(b=Xa())!==l?((c=Za())===l&&(c=null),c!==l&&(d=Xa())!==l?(na=a,a=b=T(b,d)):(ma=a,a=l)):(ma=a,a=l),a}function Wa(){var a,b;return a=ma,(b=_a())===l&&(b=db()),b!==l&&(na=a,b=U(b)),a=b}function Xa(){var a,b,c,d;return a=ma,b=ma,c=cb(),c===l&&(c=null),c!==l&&(d=_a())!==l?b=c=[c,d]:(ma=b,b=l),b===l&&(b=ma,(c=cb())===l&&(c=null),c!==l&&(d=db())!==l?b=c=[c,d]:(ma=b,b=l)),b!==l&&(na=a,b=V(b)),a=b}function Ya(){var b,c;return b=ma,W.test(a.charAt(ma))?(c=a.charAt(ma),ma++):(c=l,0===ra&&va(X)),c!==l&&(na=b,c=Y(c)),b=c}function Za(){var a,b,c,d,e;if(a=ma,b=[],(c=eb())!==l)for(;c!==l;)b.push(c),c=eb();else b=l;if(b!==l)if((c=$a())===l&&(c=null),c!==l){for(d=[],e=eb();e!==l;)d.push(e),e=eb();d!==l?a=b=[b,c,d]:(ma=a,a=l)}else ma=a,a=l;else ma=a,a=l;if(a===l){if(a=ma,b=ma,c=$a(),c!==l){for(d=[],e=eb();e!==l;)d.push(e),e=eb();d!==l?b=c=[c,d]:(ma=b,b=l)}else ma=b,b=l;b!==l&&(na=a,b=Z()),a=b}return a}function $a(){var b;return 44===a.charCodeAt(ma)?(b=$,ma++):(b=l,0===ra&&va(_)),b}function _a(){var a,b,c,d;return a=ma,b=ma,c=ab(),c!==l?((d=bb())===l&&(d=null),d!==l?b=c=[c,d]:(ma=b,b=l)):(ma=b,b=l),b===l&&(b=ma,(c=db())!==l&&(d=bb())!==l?b=c=[c,d]:(ma=b,b=l)),b!==l&&(na=a,b=aa(b)),a=b}function ab(){var b,c,d,e,f;return b=ma,c=ma,d=db(),d===l&&(d=null),d!==l?(46===a.charCodeAt(ma)?(e=ba,ma++):(e=l,0===ra&&va(ca)),e!==l&&(f=db())!==l?c=d=[d,e,f]:(ma=c,c=l)):(ma=c,c=l),c===l&&(c=ma,(d=db())!==l?(46===a.charCodeAt(ma)?(e=ba,ma++):(e=l,0===ra&&va(ca)),e!==l?c=d=[d,e]:(ma=c,c=l)):(ma=c,c=l)),c!==l&&(na=b,c=aa(c)),b=c}function bb(){var b,c,d,e,f;return b=ma,c=ma,da.test(a.charAt(ma))?(d=a.charAt(ma),ma++):(d=l,0===ra&&va(ea)),d!==l?((e=cb())===l&&(e=null),e!==l&&(f=db())!==l?c=d=[d,e,f]:(ma=c,c=l)):(ma=c,c=l),c!==l&&(na=b,c=aa(c)),b=c}function cb(){var b;return fa.test(a.charAt(ma))?(b=a.charAt(ma),ma++):(b=l,0===ra&&va(ga)),b}function db(){var b,c,d;if(b=ma,c=[],ha.test(a.charAt(ma))?(d=a.charAt(ma),ma++):(d=l,0===ra&&va(ia)),d!==l)for(;d!==l;)c.push(d),ha.test(a.charAt(ma))?(d=a.charAt(ma),ma++):(d=l,0===ra&&va(ia));else c=l;return c!==l&&(na=b,c=ja(c)),b=c}function eb(){var b,c;return b=ma,ka.test(a.charAt(ma))?(c=a.charAt(ma),ma++):(c=l,0===ra&&va(la)),c!==l&&(na=b,c=Z()),b=c}function fb(a,b){if(!b)return[a];for(var c=[a],d=0,e=b.length;d<e;d++)c[d+1]=b[d][1];return c}var gb={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var hb in gb)gb[hb.toUpperCase()]=gb[hb];function ib(a,b){b||(b=[{}]);for(var c=b.length;c--;){var d={code:a,command:gb[a]};for(var e in a==a.toLowerCase()&&(d.relative=!0),b[c])d[e]=b[c][e];b[c]=d}return b}if((k=n())!==l&&ma===a.length)return k;throw k!==l&&ma<a.length&&va({type:"end"}),h=qa,i=pa<a.length?a.charAt(pa):null,d=pa,e=pa<a.length?pa+1:pa,f=ua(d),g=ua(e),j={start:{offset:d,line:f.line,column:f.column},end:{offset:e,line:g.line,column:g.column}},new c(c.buildMessage(h,i),h,i,j)}}}),B=o((a,b)=>{var c=A().parse;c.parseSVG=c,c.makeAbsolute=function(a){var b,c={x:0,y:0},d={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return a.forEach(function(a){for(var e in"moveto"===a.command&&(b=a),a.x0=c.x,a.y0=c.y,d)e in a&&(a[e]+=a.relative?a[d[e]]:0);"x"in a||(a.x=c.x),"y"in a||(a.y=c.y),a.relative=!1,a.code=a.code.toUpperCase(),"closepath"==a.command&&(a.x=b.x,a.y=b.y),c=a}),a},b.exports=c}),C=o((a,b)=>{"use strict";b.exports=function(a){for(var b=new Array(a),c=0;c<a;++c)b[c]=c;return b}}),D=o((a,b)=>{function c(a){return!!a.constructor&&"function"==typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}b.exports=function(a){var b;return null!=a&&(c(a)||"function"==typeof(b=a).readFloatLE&&"function"==typeof b.slice&&c(b.slice(0,0))||!!a._isBuffer)}}),E=o((a,b)=>{var c=C(),d=D(),e="u">typeof Float64Array;function f(a,b){return a[0]-b[0]}function g(){var a,b=this.stride,c=new Array(b.length);for(a=0;a<c.length;++a)c[a]=[Math.abs(b[a]),a];c.sort(f);var d=new Array(c.length);for(a=0;a<d.length;++a)d[a]=c[a][1];return d}function h(a,b){var d=["View",b,"d",a].join("");b<0&&(d="View_Nil"+a);var e="generic"===a;if(-1===b){var f="function "+d+"(a){this.data=a;};var proto="+d+".prototype;proto.dtype='"+a+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+d+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+d+"(a){return new "+d+"(a);}",h=new Function(f);return h()}if(0===b){var f="function "+d+"(a,d) {this.data = a;this.offset = d};var proto="+d+".prototype;proto.dtype='"+a+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+d+"_copy() {return new "+d+"(this.data,this.offset)};proto.pick=function "+d+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+d+"_get(){return "+(e?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+d+"_set(v){return "+(e?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+d+"(a,b,c,d){return new "+d+"(a,d)}",h=new Function("TrivialArray",f);return h(i[a][0])}var f=["'use strict'"],j=c(b),k=j.map(function(a){return"i"+a}),l="this.offset+"+j.map(function(a){return"this.stride["+a+"]*i"+a}).join("+"),m=j.map(function(a){return"b"+a}).join(","),n=j.map(function(a){return"c"+a}).join(",");f.push("function "+d+"(a,"+m+","+n+",d){this.data=a","this.shape=["+m+"]","this.stride=["+n+"]","this.offset=d|0}","var proto="+d+".prototype","proto.dtype='"+a+"'","proto.dimension="+b),f.push("Object.defineProperty(proto,'size',{get:function "+d+"_size(){return "+j.map(function(a){return"this.shape["+a+"]"}).join("*"),"}})"),1===b?f.push("proto.order=[0]"):(f.push("Object.defineProperty(proto,'order',{get:"),b<4?(f.push("function "+d+"_order(){"),2===b?f.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===b&&f.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):f.push("ORDER})")),f.push("proto.set=function "+d+"_set("+k.join(",")+",v){"),e?f.push("return this.data.set("+l+",v)}"):f.push("return this.data["+l+"]=v}"),f.push("proto.get=function "+d+"_get("+k.join(",")+"){"),e?f.push("return this.data.get("+l+")}"):f.push("return this.data["+l+"]}"),f.push("proto.index=function "+d+"_index(",k.join(),"){return "+l+"}"),f.push("proto.hi=function "+d+"_hi("+k.join(",")+"){return new "+d+"(this.data,"+j.map(function(a){return["(typeof i",a,"!=='number'||i",a,"<0)?this.shape[",a,"]:i",a,"|0"].join("")}).join(",")+","+j.map(function(a){return"this.stride["+a+"]"}).join(",")+",this.offset)}");var o=j.map(function(a){return"a"+a+"=this.shape["+a+"]"}),p=j.map(function(a){return"c"+a+"=this.stride["+a+"]"});f.push("proto.lo=function "+d+"_lo("+k.join(",")+"){var b=this.offset,d=0,"+o.join(",")+","+p.join(","));for(var q=0;q<b;++q)f.push("if(typeof i"+q+"==='number'&&i"+q+">=0){d=i"+q+"|0;b+=c"+q+"*d;a"+q+"-=d}");f.push("return new "+d+"(this.data,"+j.map(function(a){return"a"+a}).join(",")+","+j.map(function(a){return"c"+a}).join(",")+",b)}"),f.push("proto.step=function "+d+"_step("+k.join(",")+"){var "+j.map(function(a){return"a"+a+"=this.shape["+a+"]"}).join(",")+","+j.map(function(a){return"b"+a+"=this.stride["+a+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var q=0;q<b;++q)f.push("if(typeof i"+q+"==='number'){d=i"+q+"|0;if(d<0){c+=b"+q+"*(a"+q+"-1);a"+q+"=ceil(-a"+q+"/d)}else{a"+q+"=ceil(a"+q+"/d)}b"+q+"*=d}");f.push("return new "+d+"(this.data,"+j.map(function(a){return"a"+a}).join(",")+","+j.map(function(a){return"b"+a}).join(",")+",c)}");for(var r=new Array(b),s=new Array(b),q=0;q<b;++q)r[q]="a[i"+q+"]",s[q]="b[i"+q+"]";f.push("proto.transpose=function "+d+"_transpose("+k+"){"+k.map(function(a,b){return a+"=("+a+"===undefined?"+b+":"+a+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+d+"(this.data,"+r.join(",")+","+s.join(",")+",this.offset)}"),f.push("proto.pick=function "+d+"_pick("+k+"){var a=[],b=[],c=this.offset");for(var q=0;q<b;++q)f.push("if(typeof i"+q+"==='number'&&i"+q+">=0){c=(c+this.stride["+q+"]*i"+q+")|0}else{a.push(this.shape["+q+"]);b.push(this.stride["+q+"])}");f.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),f.push("return function construct_"+d+"(data,shape,stride,offset){return new "+d+"(data,"+j.map(function(a){return"shape["+a+"]"}).join(",")+","+j.map(function(a){return"stride["+a+"]"}).join(",")+",offset)}");var h=new Function("CTOR_LIST","ORDER",f.join(`
`));return h(i[a],g)}var i={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};b.exports=function(a,b,c,f){if(void 0===a){var g=i.array[0];return g([])}"number"==typeof a&&(a=[a]),void 0===b&&(b=[a.length]);var j=b.length;if(void 0===c){c=new Array(j);for(var k=j-1,l=1;k>=0;--k)c[k]=l,l*=b[k]}if(void 0===f){f=0;for(var k=0;k<j;++k)c[k]<0&&(f-=(b[k]-1)*c[k])}for(var m=function(a){if(d(a))return"buffer";if(e)switch(Object.prototype.toString.call(a)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(a)?"array":"generic"}(a),n=i[m];n.length<=j+1;)n.push(h(m,n.length-1));var g=n[j+1];return g(a,b,c,f)}}),F=o((a,b)=>{"use strict";b.exports=function(a,b,c){return 0===a.length?a:b?(c||a.sort(b),(function(a,b){for(var c=1,d=a.length,e=a[0],f=a[0],g=1;g<d;++g)if(f=e,b(e=a[g],f)){if(g===c){c++;continue}a[c++]=e}return a.length=c,a})(a,b)):(c||a.sort(),(function(a){for(var b=1,c=a.length,d=a[0],e=a[0],f=1;f<c;++f,e=d)if(e=d,(d=a[f])!==e){if(f===b){b++;continue}a[b++]=d}return a.length=b,a})(a))}}),G=o((a,b)=>{"use strict";var c=F();function d(a,b,c){var d,e,f=a.length,g=b.arrayArgs.length,h=b.indexArgs.length>0,i=[],j=[],k=0,l=0;for(d=0;d<f;++d)j.push(["i",d,"=0"].join(""));for(e=0;e<g;++e)for(d=0;d<f;++d)l=k,k=a[d],0===d?j.push(["d",e,"s",d,"=t",e,"p",k].join("")):j.push(["d",e,"s",d,"=(t",e,"p",k,"-s",l,"*t",e,"p",l,")"].join(""));for(j.length>0&&i.push("var "+j.join(",")),d=f-1;d>=0;--d)k=a[d],i.push(["for(i",d,"=0;i",d,"<s",k,";++i",d,"){"].join(""));for(i.push(c),d=0;d<f;++d){for(l=k,k=a[d],e=0;e<g;++e)i.push(["p",e,"+=d",e,"s",d].join(""));h&&(d>0&&i.push(["index[",l,"]-=s",l].join("")),i.push(["++index[",k,"]"].join(""))),i.push("}")}return i.join(`
`)}function e(a,b,c){for(var d=a.body,e=[],f=[],g=0;g<a.args.length;++g){var h=a.args[g];if(!(h.count<=0)){var i=new RegExp(h.name,"g"),j="",k=b.arrayArgs.indexOf(g);switch(b.argTypes[g]){case"offset":var l=b.offsetArgIndex.indexOf(g);k=b.offsetArgs[l].array,j="+q"+l;case"array":j="p"+k+j;var m="l"+g,n="a"+k;if(0===b.arrayBlockIndices[k])1===h.count?"generic"===c[k]?h.lvalue?(e.push(["var ",m,"=",n,".get(",j,")"].join("")),d=d.replace(i,m),f.push([n,".set(",j,",",m,")"].join(""))):d=d.replace(i,[n,".get(",j,")"].join("")):d=d.replace(i,[n,"[",j,"]"].join("")):"generic"===c[k]?(e.push(["var ",m,"=",n,".get(",j,")"].join("")),d=d.replace(i,m),h.lvalue&&f.push([n,".set(",j,",",m,")"].join(""))):(e.push(["var ",m,"=",n,"[",j,"]"].join("")),d=d.replace(i,m),h.lvalue&&f.push([n,"[",j,"]=",m].join("")));else{for(var o=[h.name],p=[j],q=0;q<Math.abs(b.arrayBlockIndices[k]);q++)o.push("\\s*\\[([^\\]]+)\\]"),p.push("$"+(q+1)+"*t"+k+"b"+q);if(i=new RegExp(o.join(""),"g"),j=p.join("+"),"generic"===c[k])throw new Error("cwise: Generic arrays not supported in combination with blocks!");d=d.replace(i,[n,"[",j,"]"].join(""))}break;case"scalar":d=d.replace(i,"Y"+b.scalarArgs.indexOf(g));break;case"index":d=d.replace(i,"index");break;case"shape":d=d.replace(i,"shape");break}}}return[e.join(`
`),d,f.join(`
`)].join(`
`).trim()}b.exports=function(a,b){for(var f=b[1].length-Math.abs(a.arrayBlockIndices[0])|0,g=new Array(a.arrayArgs.length),h=new Array(a.arrayArgs.length),i=0;i<a.arrayArgs.length;++i)h[i]=b[2*i],g[i]=b[2*i+1];for(var j=[],k=[],l=[],m=[],n=[],i=0;i<a.arrayArgs.length;++i){a.arrayBlockIndices[i]<0?(l.push(0),m.push(f),j.push(f),k.push(f+a.arrayBlockIndices[i])):(l.push(a.arrayBlockIndices[i]),m.push(a.arrayBlockIndices[i]+f),j.push(0),k.push(a.arrayBlockIndices[i]));for(var o=[],p=0;p<g[i].length;p++)l[i]<=g[i][p]&&g[i][p]<m[i]&&o.push(g[i][p]-l[i]);n.push(o)}for(var q=["SS"],r=["'use strict'"],s=[],p=0;p<f;++p)s.push(["s",p,"=SS[",p,"]"].join(""));for(var i=0;i<a.arrayArgs.length;++i){q.push("a"+i),q.push("t"+i),q.push("p"+i);for(var p=0;p<f;++p)s.push(["t",i,"p",p,"=t",i,"[",l[i]+p,"]"].join(""));for(var p=0;p<Math.abs(a.arrayBlockIndices[i]);++p)s.push(["t",i,"b",p,"=t",i,"[",j[i]+p,"]"].join(""))}for(var i=0;i<a.scalarArgs.length;++i)q.push("Y"+i);if(a.shapeArgs.length>0&&s.push("shape=SS.slice(0)"),a.indexArgs.length>0){for(var t=new Array(f),i=0;i<f;++i)t[i]="0";s.push(["index=[",t.join(","),"]"].join(""))}for(var i=0;i<a.offsetArgs.length;++i){for(var u=a.offsetArgs[i],v=[],p=0;p<u.offset.length;++p)0!==u.offset[p]&&(1===u.offset[p]?v.push(["t",u.array,"p",p].join("")):v.push([u.offset[p],"*t",u.array,"p",p].join("")));0===v.length?s.push("q"+i+"=0"):s.push(["q",i,"=",v.join("+")].join(""))}var w=c([].concat(a.pre.thisVars).concat(a.body.thisVars).concat(a.post.thisVars));(s=s.concat(w)).length>0&&r.push("var "+s.join(","));for(var i=0;i<a.arrayArgs.length;++i)r.push("p"+i+"|=0");a.pre.body.length>3&&r.push(e(a.pre,a,h));var x=e(a.body,a,h),y=function(a){for(var b=0,c=a[0].length;b<c;){for(var d=1;d<a.length;++d)if(a[d][b]!==a[0][b])return b;++b}return b}(n);y<f?r.push(function(a,b,c,e){for(var f=b.length,g=c.arrayArgs.length,h=c.blockSize,i=c.indexArgs.length>0,j=[],k=0;k<g;++k)j.push(["var offset",k,"=p",k].join(""));for(var k=a;k<f;++k)j.push(["for(var j"+k+"=SS[",b[k],"]|0;j",k,">0;){"].join("")),j.push(["if(j",k,"<",h,"){"].join("")),j.push(["s",b[k],"=j",k].join("")),j.push(["j",k,"=0"].join("")),j.push(["}else{s",b[k],"=",h].join("")),j.push(["j",k,"-=",h,"}"].join("")),i&&j.push(["index[",b[k],"]=j",k].join(""));for(var k=0;k<g;++k){for(var l=["offset"+k],m=a;m<f;++m)l.push(["j",m,"*t",k,"p",b[m]].join(""));j.push(["p",k,"=(",l.join("+"),")"].join(""))}j.push(d(b,c,e));for(var k=a;k<f;++k)j.push("}");return j.join(`
`)}(y,n[0],a,x)):r.push(d(n[0],a,x)),a.post.body.length>3&&r.push(e(a.post,a,h)),a.debug&&console.log("-----Generated cwise routine for ",b,`:
`+r.join(`
`)+`
----------`);var z=[a.funcName||"unnamed","_cwise_loop_",g[0].join("s"),"m",y,function(a){for(var b=new Array(a.length),c=!0,d=0;d<a.length;++d){var e=a[d],f=e.match(/\d+/);f=f?f[0]:"",0===e.charAt(0)?b[d]="u"+e.charAt(1)+f:b[d]=e.charAt(0)+f,d>0&&(c=c&&b[d]===b[d-1])}return c?b[0]:b.join("")}(h)].join("");return new Function(["function ",z,"(",q.join(","),"){",r.join(`
`),"} return ",z].join(""))()}}),H=o((a,b)=>{"use strict";var c=G();b.exports=function(a){var b=["'use strict'","var CACHED={}"],d=[],e=a.funcName+"_cwise_thunk";b.push(["return function ",e,"(",a.shimArgs.join(","),"){"].join(""));for(var f=[],g=[],h=[["array",a.arrayArgs[0],".shape.slice(",Math.max(0,a.arrayBlockIndices[0]),a.arrayBlockIndices[0]<0?","+a.arrayBlockIndices[0]+")":")"].join("")],i=[],j=[],k=0;k<a.arrayArgs.length;++k){var l=a.arrayArgs[k];d.push(["t",l,"=array",l,".dtype,","r",l,"=array",l,".order"].join("")),f.push("t"+l),f.push("r"+l),g.push("t"+l),g.push("r"+l+".join()"),h.push("array"+l+".data"),h.push("array"+l+".stride"),h.push("array"+l+".offset|0"),k>0&&(i.push("array"+a.arrayArgs[0]+".shape.length===array"+l+".shape.length+"+(Math.abs(a.arrayBlockIndices[0])-Math.abs(a.arrayBlockIndices[k]))),j.push("array"+a.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,a.arrayBlockIndices[0])+"]===array"+l+".shape[shapeIndex+"+Math.max(0,a.arrayBlockIndices[k])+"]"))}a.arrayArgs.length>1&&(b.push("if (!("+i.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),b.push("for(var shapeIndex=array"+a.arrayArgs[0]+".shape.length-"+Math.abs(a.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),b.push("if (!("+j.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),b.push("}"));for(var k=0;k<a.scalarArgs.length;++k)h.push("scalar"+a.scalarArgs[k]);return d.push(["type=[",g.join(","),"].join()"].join("")),d.push("proc=CACHED[type]"),b.push("var "+d.join(",")),b.push(["if(!proc){","CACHED[type]=proc=compile([",f.join(","),"])}","return proc(",h.join(","),")}"].join("")),a.debug&&console.log(`-----Generated thunk:
`+b.join(`
`)+`
----------`),new Function("compile",b.join(`
`))(c.bind(void 0,a))}}),I=o((a,b)=>{"use strict";var c=H();function d(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}b.exports=function(a){var b=new d;b.pre=a.pre,b.body=a.body,b.post=a.post;var e=a.args.slice(0);b.argTypes=e;for(var f=0;f<e.length;++f){var g=e[f];if("array"===g||"object"==typeof g&&g.blockIndices){if(b.argTypes[f]="array",b.arrayArgs.push(f),b.arrayBlockIndices.push(g.blockIndices?g.blockIndices:0),b.shimArgs.push("array"+f),f<b.pre.args.length&&b.pre.args[f].count>0)throw new Error("cwise: pre() block may not reference array args");if(f<b.post.args.length&&b.post.args[f].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===g)b.scalarArgs.push(f),b.shimArgs.push("scalar"+f);else if("index"===g){if(b.indexArgs.push(f),f<b.pre.args.length&&b.pre.args[f].count>0)throw new Error("cwise: pre() block may not reference array index");if(f<b.body.args.length&&b.body.args[f].lvalue)throw new Error("cwise: body() block may not write to array index");if(f<b.post.args.length&&b.post.args[f].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===g){if(b.shapeArgs.push(f),f<b.pre.args.length&&b.pre.args[f].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(f<b.body.args.length&&b.body.args[f].lvalue)throw new Error("cwise: body() block may not write to array shape");if(f<b.post.args.length&&b.post.args[f].lvalue)throw new Error("cwise: post() block may not write to array shape")}else if("object"==typeof g&&g.offset)b.argTypes[f]="offset",b.offsetArgs.push({array:g.array,offset:g.offset}),b.offsetArgIndex.push(f);else throw new Error("cwise: Unknown argument type "+e[f])}if(b.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(b.pre.args.length>e.length)throw new Error("cwise: Too many arguments in pre() block");if(b.body.args.length>e.length)throw new Error("cwise: Too many arguments in body() block");if(b.post.args.length>e.length)throw new Error("cwise: Too many arguments in post() block");return b.debug=!!a.printCode||!!a.debug,b.funcName=a.funcName||"cwise",b.blockSize=a.blockSize||64,c(b)}}),J=o(a=>{"use strict";var b=I(),c={body:"",args:[],thisVars:[],localVars:[]};function d(a){if(!a)return c;for(var b=0;b<a.args.length;++b){var d=a.args[b];0===b?a.args[b]={name:d,lvalue:!0,rvalue:!!a.rvalue,count:a.count||1}:a.args[b]={name:d,lvalue:!1,rvalue:!0,count:1}}return a.thisVars||(a.thisVars=[]),a.localVars||(a.localVars=[]),a}function e(a){for(var c,e=[],f=0;f<a.args.length;++f)e.push("a"+f);return new Function("P",["return function ",a.funcName,"_ndarrayops(",e.join(","),") {P(",e.join(","),");return a0}"].join(""))(b({args:(c=a).args,pre:d(c.pre),body:d(c.body),post:d(c.proc),funcName:c.funcName}))}var f={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var b in f){var c=f[b];a[b]=e({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+c+"c"},funcName:b}),a[b+"eq"]=e({args:["array","array"],body:{args:["a","b"],body:"a"+c+"=b"},rvalue:!0,funcName:b+"eq"}),a[b+"s"]=e({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+c+"s"},funcName:b+"s"}),a[b+"seq"]=e({args:["array","scalar"],body:{args:["a","s"],body:"a"+c+"=s"},rvalue:!0,funcName:b+"seq"})}}();var g={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var b in g){var c=g[b];a[b]=e({args:["array","array"],body:{args:["a","b"],body:"a="+c+"b"},funcName:b}),a[b+"eq"]=e({args:["array"],body:{args:["a"],body:"a="+c+"a"},rvalue:!0,count:2,funcName:b+"eq"})}}();var h={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var b in h){var c=h[b];a[b]=e({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+c+"c"},funcName:b}),a[b+"s"]=e({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+c+"s"},funcName:b+"s"}),a[b+"eq"]=e({args:["array","array"],body:{args:["a","b"],body:"a=a"+c+"b"},rvalue:!0,count:2,funcName:b+"eq"}),a[b+"seq"]=e({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+c+"s"},rvalue:!0,count:2,funcName:b+"seq"})}}();var i=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var b=0;b<i.length;++b){var c=i[b];a[c]=e({args:["array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:c}),a[c+"eq"]=e({args:["array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"eq"})}}();var j=["max","min","atan2","pow"];!function(){for(var b=0;b<j.length;++b){var c=j[b];a[c]=e({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:c}),a[c+"s"]=e({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:c+"s"}),a[c+"eq"]=e({args:["array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"eq"}),a[c+"seq"]=e({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"seq"})}}();var k=["atan2","pow"];!function(){for(var b=0;b<k.length;++b){var c=k[b];a[c+"op"]=e({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:c+"op"}),a[c+"ops"]=e({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:c+"ops"}),a[c+"opeq"]=e({args:["array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"opeq"}),a[c+"opseq"]=e({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"opseq"})}}(),a.any=b({args:["array"],pre:c,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),a.all=b({args:["array"],pre:c,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),a.sum=b({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),a.prod=b({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),a.norm2squared=b({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),a.norm2=b({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),a.norminf=b({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),a.norm1=b({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),a.sup=b({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),a.inf=b({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),a.argmin=b({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),a.argmax=b({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),a.random=e({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),a.assign=e({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),a.assigns=e({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),a.equals=b({args:["array","array"],pre:c,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}),K=o((a,b)=>{b.exports=function(a,b){for(var c=a.split("."),d=b.split("."),e=0;e<3;e++){var f=Number(c[e]),g=Number(d[e]);if(f>g)return 1;if(g>f)return -1;if(!isNaN(f)&&isNaN(g))return 1;if(isNaN(f)&&!isNaN(g))return -1}return 0}}),L="149",M={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},N=1,O=3,P=0,Q=1,R=2,S=0,T=1,U=100,V=101,W=102,X=200,Y=201,Z=202,$=203,_=204,aa=205,ba=206,ca=207,da=208,ea=209,fa=210,ga=3,ha=0,ia=0,ja=300,ka=301,la=302,ma=303,na=304,oa=306,pa=1e3,qa=1001,ra=1002,sa=1003,ta=1004,ua=1005,va=1006,wa=1007,xa=1008,ya=1009,za=1014,Aa=1015,Ba=1016,Ca=1020,Da=1023,Ea=1026,Fa=1027,Ga=1030,Ha=2200,Ia=2201,Ja=2202,Ka=2300,La=2301,Ma=2302,Na=2400,Oa=2401,Pa=2402,Qa=2500,Ra=2501,Sa=3e3,Ta=3001,Ua=3200,Va=3201,Wa="srgb",Xa="srgb-linear",Ya=7680,Za=519,$a=35044,_a="300 es",ab=class{addEventListener(bb,cb){void 0===this._listeners&&(this._listeners={});let db=this._listeners;void 0===db[bb]&&(db[bb]=[]),-1===db[bb].indexOf(cb)&&db[bb].push(cb)}hasEventListener(eb,fb){if(void 0===this._listeners)return!1;let gb=this._listeners;return void 0!==gb[eb]&& -1!==gb[eb].indexOf(fb)}removeEventListener(hb,ib){if(void 0===this._listeners)return;let jb=this._listeners[hb];if(void 0!==jb){let kb=jb.indexOf(ib);-1!==kb&&jb.splice(kb,1)}}dispatchEvent(lb){if(void 0===this._listeners)return;let mb=this._listeners[lb.type];if(void 0!==mb){lb.target=this;let nb=mb.slice(0);for(let ob=0,pb=nb.length;ob<pb;ob++)nb[ob].call(this,lb);lb.target=null}}},qb=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],rb=1234567,sb=Math.PI/180,tb=180/Math.PI;function ub(){let a=4294967295*Math.random()|0,b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return(qb[255&a]+qb[a>>8&255]+qb[a>>16&255]+qb[a>>24&255]+"-"+qb[255&b]+qb[b>>8&255]+"-"+qb[b>>16&15|64]+qb[b>>24&255]+"-"+qb[63&c|128]+qb[c>>8&255]+"-"+qb[c>>16&255]+qb[c>>24&255]+qb[255&d]+qb[d>>8&255]+qb[d>>16&255]+qb[d>>24&255]).toLowerCase()}function vb(a,b,c){return Math.max(b,Math.min(c,a))}function wb(a,b){return(a%b+b)%b}function xb(a,b,c){return(1-c)*a+c*b}function yb(a){return(a&a-1)==0&&0!==a}function zb(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function Ab(a){return Math.pow(2,Math.floor(Math.log(a)/Math.LN2))}function Bb(a,b){switch(b.constructor){case Float32Array:return a;case Uint16Array:return a/65535;case Uint8Array:return a/255;case Int16Array:return Math.max(a/32767,-1);case Int8Array:return Math.max(a/127,-1);default:throw new Error("Invalid component type.")}}function Cb(a,b){switch(b.constructor){case Float32Array:return a;case Uint16Array:return Math.round(65535*a);case Uint8Array:return Math.round(255*a);case Int16Array:return Math.round(32767*a);case Int8Array:return Math.round(127*a);default:throw new Error("Invalid component type.")}}var Db=Object.freeze({__proto__:null,DEG2RAD:sb,RAD2DEG:tb,ceilPowerOfTwo:zb,clamp:vb,damp:function(a,b,c,d){return xb(a,b,1-Math.exp(-c*d))},degToRad:function(a){return a*sb},denormalize:Bb,euclideanModulo:wb,floorPowerOfTwo:Ab,generateUUID:ub,inverseLerp:function(a,b,c){return a!==b?(c-a)/(b-a):0},isPowerOfTwo:yb,lerp:xb,mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},normalize:Cb,pingpong:function(a,b=1){return b-Math.abs(wb(a,2*b)-b)},radToDeg:function(a){return a*tb},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},seededRandom:function(a){void 0!==a&&(rb=a);let b=rb+=1831565813;return b=Math.imul(b^b>>>15,1|b),b^=b+Math.imul(b^b>>>7,61|b),((b^b>>>14)>>>0)/4294967296},setQuaternionFromProperEuler:function(a,b,c,d,e){let f=Math.cos,g=Math.sin,h=f(c/2),i=g(c/2),j=f((b+d)/2),k=g((b+d)/2),l=f((b-d)/2),m=g((b-d)/2),n=f((d-b)/2),o=g((d-b)/2);switch(e){case"XYX":a.set(h*k,i*l,i*m,h*j);break;case"YZY":a.set(i*m,h*k,i*l,h*j);break;case"ZXZ":a.set(i*l,i*m,h*k,h*j);break;case"XZX":a.set(h*k,i*o,i*n,h*j);break;case"YXY":a.set(i*n,h*k,i*o,h*j);break;case"ZYZ":a.set(i*o,i*n,h*k,h*j);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+e)}},smootherstep:function(a,b,c){return a<=b?0:a>=c?1:(a=(a-b)/(c-b))*a*a*(a*(6*a-15)+10)},smoothstep:function(a,b,c){return a<=b?0:a>=c?1:(a=(a-b)/(c-b))*a*(3-2*a)}}),Eb=class{constructor(Fb=0,Gb=0){Eb.prototype.isVector2=!0,this.x=Fb,this.y=Gb}get width(){return this.x}set width(Hb){this.x=Hb}get height(){return this.y}set height(Ib){this.y=Ib}set(Jb,Kb){return this.x=Jb,this.y=Kb,this}setScalar(Lb){return this.x=Lb,this.y=Lb,this}setX(Mb){return this.x=Mb,this}setY(Nb){return this.y=Nb,this}setComponent(Ob,Pb){switch(Ob){case 0:this.x=Pb;break;case 1:this.y=Pb;break;default:throw new Error("index is out of range: "+Ob)}return this}getComponent(Qb){switch(Qb){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+Qb)}}clone(){return new this.constructor(this.x,this.y)}copy(Rb){return this.x=Rb.x,this.y=Rb.y,this}add(Sb){return this.x+=Sb.x,this.y+=Sb.y,this}addScalar(Tb){return this.x+=Tb,this.y+=Tb,this}addVectors(Ub,Vb){return this.x=Ub.x+Vb.x,this.y=Ub.y+Vb.y,this}addScaledVector(Wb,Xb){return this.x+=Wb.x*Xb,this.y+=Wb.y*Xb,this}sub(Yb){return this.x-=Yb.x,this.y-=Yb.y,this}subScalar(Zb){return this.x-=Zb,this.y-=Zb,this}subVectors($b,_b){return this.x=$b.x-_b.x,this.y=$b.y-_b.y,this}multiply(ac){return this.x*=ac.x,this.y*=ac.y,this}multiplyScalar(bc){return this.x*=bc,this.y*=bc,this}divide(cc){return this.x/=cc.x,this.y/=cc.y,this}divideScalar(dc){return this.multiplyScalar(1/dc)}applyMatrix3(ec){let fc=this.x,gc=this.y,hc=ec.elements;return this.x=hc[0]*fc+hc[3]*gc+hc[6],this.y=hc[1]*fc+hc[4]*gc+hc[7],this}min(ic){return this.x=Math.min(this.x,ic.x),this.y=Math.min(this.y,ic.y),this}max(jc){return this.x=Math.max(this.x,jc.x),this.y=Math.max(this.y,jc.y),this}clamp(kc,lc){return this.x=Math.max(kc.x,Math.min(lc.x,this.x)),this.y=Math.max(kc.y,Math.min(lc.y,this.y)),this}clampScalar(mc,nc){return this.x=Math.max(mc,Math.min(nc,this.x)),this.y=Math.max(mc,Math.min(nc,this.y)),this}clampLength(oc,pc){let qc=this.length();return this.divideScalar(qc||1).multiplyScalar(Math.max(oc,Math.min(pc,qc)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(rc){return this.x*rc.x+this.y*rc.y}cross(sc){return this.x*sc.y-this.y*sc.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(tc){return Math.sqrt(this.distanceToSquared(tc))}distanceToSquared(uc){let vc=this.x-uc.x,wc=this.y-uc.y;return vc*vc+wc*wc}manhattanDistanceTo(xc){return Math.abs(this.x-xc.x)+Math.abs(this.y-xc.y)}setLength(yc){return this.normalize().multiplyScalar(yc)}lerp(zc,Ac){return this.x+=(zc.x-this.x)*Ac,this.y+=(zc.y-this.y)*Ac,this}lerpVectors(Bc,Cc,Dc){return this.x=Bc.x+(Cc.x-Bc.x)*Dc,this.y=Bc.y+(Cc.y-Bc.y)*Dc,this}equals(Ec){return Ec.x===this.x&&Ec.y===this.y}fromArray(Fc,Gc=0){return this.x=Fc[Gc],this.y=Fc[Gc+1],this}toArray(Hc=[],Ic=0){return Hc[Ic]=this.x,Hc[Ic+1]=this.y,Hc}fromBufferAttribute(Jc,Kc){return this.x=Jc.getX(Kc),this.y=Jc.getY(Kc),this}rotateAround(Lc,Mc){let Nc=Math.cos(Mc),Oc=Math.sin(Mc),Pc=this.x-Lc.x,Qc=this.y-Lc.y;return this.x=Pc*Nc-Qc*Oc+Lc.x,this.y=Pc*Oc+Qc*Nc+Lc.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Rc=class{constructor(){Rc.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(Sc,Tc,Uc,Vc,Wc,Xc,Yc,Zc,$c){let _c=this.elements;return _c[0]=Sc,_c[1]=Vc,_c[2]=Yc,_c[3]=Tc,_c[4]=Wc,_c[5]=Zc,_c[6]=Uc,_c[7]=Xc,_c[8]=$c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(ad){let bd=this.elements,cd=ad.elements;return bd[0]=cd[0],bd[1]=cd[1],bd[2]=cd[2],bd[3]=cd[3],bd[4]=cd[4],bd[5]=cd[5],bd[6]=cd[6],bd[7]=cd[7],bd[8]=cd[8],this}extractBasis(dd,ed,fd){return dd.setFromMatrix3Column(this,0),ed.setFromMatrix3Column(this,1),fd.setFromMatrix3Column(this,2),this}setFromMatrix4(gd){let hd=gd.elements;return this.set(hd[0],hd[4],hd[8],hd[1],hd[5],hd[9],hd[2],hd[6],hd[10]),this}multiply(id){return this.multiplyMatrices(this,id)}premultiply(jd){return this.multiplyMatrices(jd,this)}multiplyMatrices(kd,ld){let md=kd.elements,nd=ld.elements,od=this.elements,pd=md[0],qd=md[3],rd=md[6],sd=md[1],td=md[4],ud=md[7],vd=md[2],wd=md[5],xd=md[8],yd=nd[0],zd=nd[3],Ad=nd[6],Bd=nd[1],Cd=nd[4],Dd=nd[7],Ed=nd[2],Fd=nd[5],Gd=nd[8];return od[0]=pd*yd+qd*Bd+rd*Ed,od[3]=pd*zd+qd*Cd+rd*Fd,od[6]=pd*Ad+qd*Dd+rd*Gd,od[1]=sd*yd+td*Bd+ud*Ed,od[4]=sd*zd+td*Cd+ud*Fd,od[7]=sd*Ad+td*Dd+ud*Gd,od[2]=vd*yd+wd*Bd+xd*Ed,od[5]=vd*zd+wd*Cd+xd*Fd,od[8]=vd*Ad+wd*Dd+xd*Gd,this}multiplyScalar(Hd){let Id=this.elements;return Id[0]*=Hd,Id[3]*=Hd,Id[6]*=Hd,Id[1]*=Hd,Id[4]*=Hd,Id[7]*=Hd,Id[2]*=Hd,Id[5]*=Hd,Id[8]*=Hd,this}determinant(){let Jd=this.elements,Kd=Jd[0],Ld=Jd[1],Md=Jd[2],Nd=Jd[3],Od=Jd[4],Pd=Jd[5],Qd=Jd[6],Rd=Jd[7],Sd=Jd[8];return Kd*Od*Sd-Kd*Pd*Rd-Ld*Nd*Sd+Ld*Pd*Qd+Md*Nd*Rd-Md*Od*Qd}invert(){let Td=this.elements,Ud=Td[0],Vd=Td[1],Wd=Td[2],Xd=Td[3],Yd=Td[4],Zd=Td[5],$d=Td[6],_d=Td[7],ae=Td[8],be=ae*Yd-Zd*_d,ce=Zd*$d-ae*Xd,de=_d*Xd-Yd*$d,ee=Ud*be+Vd*ce+Wd*de;if(0===ee)return this.set(0,0,0,0,0,0,0,0,0);let fe=1/ee;return Td[0]=be*fe,Td[1]=(Wd*_d-ae*Vd)*fe,Td[2]=(Zd*Vd-Wd*Yd)*fe,Td[3]=ce*fe,Td[4]=(ae*Ud-Wd*$d)*fe,Td[5]=(Wd*Xd-Zd*Ud)*fe,Td[6]=de*fe,Td[7]=(Vd*$d-_d*Ud)*fe,Td[8]=(Yd*Ud-Vd*Xd)*fe,this}transpose(){let ge,he=this.elements;return ge=he[1],he[1]=he[3],he[3]=ge,ge=he[2],he[2]=he[6],he[6]=ge,ge=he[5],he[5]=he[7],he[7]=ge,this}getNormalMatrix(ie){return this.setFromMatrix4(ie).invert().transpose()}transposeIntoArray(je){let ke=this.elements;return je[0]=ke[0],je[1]=ke[3],je[2]=ke[6],je[3]=ke[1],je[4]=ke[4],je[5]=ke[7],je[6]=ke[2],je[7]=ke[5],je[8]=ke[8],this}setUvTransform(le,me,ne,oe,pe,qe,re){let se=Math.cos(pe),te=Math.sin(pe);return this.set(ne*se,ne*te,-ne*(se*qe+te*re)+qe+le,-oe*te,oe*se,-oe*(-te*qe+se*re)+re+me,0,0,1),this}scale(ue,ve){return this.premultiply(Qe.makeScale(ue,ve)),this}rotate(we){return this.premultiply(Qe.makeRotation(-we)),this}translate(xe,ye){return this.premultiply(Qe.makeTranslation(xe,ye)),this}makeTranslation(ze,Ae){return this.set(1,0,ze,0,1,Ae,0,0,1),this}makeRotation(Be){let Ce=Math.cos(Be),De=Math.sin(Be);return this.set(Ce,-De,0,De,Ce,0,0,0,1),this}makeScale(Ee,Fe){return this.set(Ee,0,0,0,Fe,0,0,0,1),this}equals(Ge){let He=this.elements,Ie=Ge.elements;for(let Je=0;Je<9;Je++)if(He[Je]!==Ie[Je])return!1;return!0}fromArray(Ke,Le=0){for(let Me=0;Me<9;Me++)this.elements[Me]=Ke[Me+Le];return this}toArray(Ne=[],Oe=0){let Pe=this.elements;return Ne[Oe]=Pe[0],Ne[Oe+1]=Pe[1],Ne[Oe+2]=Pe[2],Ne[Oe+3]=Pe[3],Ne[Oe+4]=Pe[4],Ne[Oe+5]=Pe[5],Ne[Oe+6]=Pe[6],Ne[Oe+7]=Pe[7],Ne[Oe+8]=Pe[8],Ne}clone(){return new this.constructor().fromArray(this.elements)}},Qe=new Rc;function Re(a){for(let b=a.length-1;b>=0;--b)if(a[b]>=65535)return!0;return!1}var Se={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Te(a,b){return new Se[a](b)}function Ue(a){return document.createElementNS("http://www.w3.org/1999/xhtml",a)}function Ve(a){return a<.04045?.0773993808*a:Math.pow(.9478672986*a+.0521327014,2.4)}function We(a){return a<.0031308?12.92*a:1.055*Math.pow(a,.41666)-.055}var Xe={[Wa]:{[Xa]:Ve},[Xa]:{[Wa]:We}},Ye={legacyMode:!0,get workingColorSpace(){return Xa},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(a,b,c){if(this.legacyMode||b===c||!b||!c)return a;if(Xe[b]&& void 0!==Xe[b][c]){let d=Xe[b][c];return a.r=d(a.r),a.g=d(a.g),a.b=d(a.b),a}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(a,b){return this.convert(a,this.workingColorSpace,b)},toWorkingColorSpace:function(a,b){return this.convert(a,b,this.workingColorSpace)}},Ze={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},$e={r:0,g:0,b:0},_e={h:0,s:0,l:0},af={h:0,s:0,l:0};function bf(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+(b-a)*6*c:c<.5?b:c<2/3?a+(b-a)*6*(2/3-c):a}function cf(a,b){return b.r=a.r,b.g=a.g,b.b=a.b,b}var df=class{constructor(ef,ff,gf){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===ff&& void 0===gf?this.set(ef):this.setRGB(ef,ff,gf)}set(hf){return hf&&hf.isColor?this.copy(hf):"number"==typeof hf?this.setHex(hf):"string"==typeof hf&&this.setStyle(hf),this}setScalar(jf){return this.r=jf,this.g=jf,this.b=jf,this}setHex(kf,lf=Wa){return kf=Math.floor(kf),this.r=(kf>>16&255)/255,this.g=(kf>>8&255)/255,this.b=(255&kf)/255,Ye.toWorkingColorSpace(this,lf),this}setRGB(mf,nf,of,pf=Ye.workingColorSpace){return this.r=mf,this.g=nf,this.b=of,Ye.toWorkingColorSpace(this,pf),this}setHSL(qf,rf,sf,tf=Ye.workingColorSpace){if(qf=wb(qf,1),rf=vb(rf,0,1),sf=vb(sf,0,1),0===rf)this.r=this.g=this.b=sf;else{let uf=sf<=.5?sf*(1+rf):sf+rf-sf*rf,vf=2*sf-uf;this.r=bf(vf,uf,qf+1/3),this.g=bf(vf,uf,qf),this.b=bf(vf,uf,qf-1/3)}return Ye.toWorkingColorSpace(this,tf),this}setStyle(wf,xf=Wa){function yf(a){void 0!==a&&1>parseFloat(a)&&console.warn("THREE.Color: Alpha component of "+wf+" will be ignored.")}let zf;if(zf=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(wf)){let Af,Bf=zf[1],Cf=zf[2];switch(Bf){case"rgb":case"rgba":if(Af=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(Cf))return this.r=Math.min(255,parseInt(Af[1],10))/255,this.g=Math.min(255,parseInt(Af[2],10))/255,this.b=Math.min(255,parseInt(Af[3],10))/255,Ye.toWorkingColorSpace(this,xf),yf(Af[4]),this;if(Af=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(Cf))return this.r=Math.min(100,parseInt(Af[1],10))/100,this.g=Math.min(100,parseInt(Af[2],10))/100,this.b=Math.min(100,parseInt(Af[3],10))/100,Ye.toWorkingColorSpace(this,xf),yf(Af[4]),this;break;case"hsl":case"hsla":if(Af=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(Cf)){let Df=parseFloat(Af[1])/360,Ef=parseFloat(Af[2])/100,Ff=parseFloat(Af[3])/100;return yf(Af[4]),this.setHSL(Df,Ef,Ff,xf)}break}}else if(zf=/^\#([A-Fa-f\d]+)$/.exec(wf)){let Gf=zf[1],Hf=Gf.length;if(3===Hf)return this.r=parseInt(Gf.charAt(0)+Gf.charAt(0),16)/255,this.g=parseInt(Gf.charAt(1)+Gf.charAt(1),16)/255,this.b=parseInt(Gf.charAt(2)+Gf.charAt(2),16)/255,Ye.toWorkingColorSpace(this,xf),this;if(6===Hf)return this.r=parseInt(Gf.charAt(0)+Gf.charAt(1),16)/255,this.g=parseInt(Gf.charAt(2)+Gf.charAt(3),16)/255,this.b=parseInt(Gf.charAt(4)+Gf.charAt(5),16)/255,Ye.toWorkingColorSpace(this,xf),this}return wf&&wf.length>0?this.setColorName(wf,xf):this}setColorName(If,Jf=Wa){let Kf=Ze[If.toLowerCase()];return void 0!==Kf?this.setHex(Kf,Jf):console.warn("THREE.Color: Unknown color "+If),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(Lf){return this.r=Lf.r,this.g=Lf.g,this.b=Lf.b,this}copySRGBToLinear(Mf){return this.r=Ve(Mf.r),this.g=Ve(Mf.g),this.b=Ve(Mf.b),this}copyLinearToSRGB(Nf){return this.r=We(Nf.r),this.g=We(Nf.g),this.b=We(Nf.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(Of=Wa){return Ye.fromWorkingColorSpace(cf(this,$e),Of),vb(255*$e.r,0,255)<<16^vb(255*$e.g,0,255)<<8^vb(255*$e.b,0,255)<<0}getHexString(Pf=Wa){return("000000"+this.getHex(Pf).toString(16)).slice(-6)}getHSL(Qf,Rf=Ye.workingColorSpace){Ye.fromWorkingColorSpace(cf(this,$e),Rf);let Sf=$e.r,Tf=$e.g,Uf=$e.b,Vf=Math.max(Sf,Tf,Uf),Wf=Math.min(Sf,Tf,Uf),Xf,Yf,Zf=(Wf+Vf)/2;if(Wf===Vf)Xf=0,Yf=0;else{let $f=Vf-Wf;switch(Yf=Zf<=.5?$f/(Vf+Wf):$f/(2-Vf-Wf),Vf){case Sf:Xf=(Tf-Uf)/$f+(Tf<Uf?6:0);break;case Tf:Xf=(Uf-Sf)/$f+2;break;case Uf:Xf=(Sf-Tf)/$f+4;break}Xf/=6}return Qf.h=Xf,Qf.s=Yf,Qf.l=Zf,Qf}getRGB(_f,ag=Ye.workingColorSpace){return Ye.fromWorkingColorSpace(cf(this,$e),ag),_f.r=$e.r,_f.g=$e.g,_f.b=$e.b,_f}getStyle(bg=Wa){return Ye.fromWorkingColorSpace(cf(this,$e),bg),bg!==Wa?`color(${bg} ${$e.r} ${$e.g} ${$e.b})`:`rgb(${255*$e.r|0},${255*$e.g|0},${255*$e.b|0})`}offsetHSL(cg,dg,eg){return this.getHSL(_e),_e.h+=cg,_e.s+=dg,_e.l+=eg,this.setHSL(_e.h,_e.s,_e.l),this}add(fg){return this.r+=fg.r,this.g+=fg.g,this.b+=fg.b,this}addColors(gg,hg){return this.r=gg.r+hg.r,this.g=gg.g+hg.g,this.b=gg.b+hg.b,this}addScalar(ig){return this.r+=ig,this.g+=ig,this.b+=ig,this}sub(jg){return this.r=Math.max(0,this.r-jg.r),this.g=Math.max(0,this.g-jg.g),this.b=Math.max(0,this.b-jg.b),this}multiply(kg){return this.r*=kg.r,this.g*=kg.g,this.b*=kg.b,this}multiplyScalar(lg){return this.r*=lg,this.g*=lg,this.b*=lg,this}lerp(mg,ng){return this.r+=(mg.r-this.r)*ng,this.g+=(mg.g-this.g)*ng,this.b+=(mg.b-this.b)*ng,this}lerpColors(og,pg,qg){return this.r=og.r+(pg.r-og.r)*qg,this.g=og.g+(pg.g-og.g)*qg,this.b=og.b+(pg.b-og.b)*qg,this}lerpHSL(rg,sg){this.getHSL(_e),rg.getHSL(af);let tg=xb(_e.h,af.h,sg),ug=xb(_e.s,af.s,sg),vg=xb(_e.l,af.l,sg);return this.setHSL(tg,ug,vg),this}equals(wg){return wg.r===this.r&&wg.g===this.g&&wg.b===this.b}fromArray(xg,yg=0){return this.r=xg[yg],this.g=xg[yg+1],this.b=xg[yg+2],this}toArray(zg=[],Ag=0){return zg[Ag]=this.r,zg[Ag+1]=this.g,zg[Ag+2]=this.b,zg}fromBufferAttribute(Bg,Cg){return this.r=Bg.getX(Cg),this.g=Bg.getY(Cg),this.b=Bg.getZ(Cg),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};df.NAMES=Ze;var Dg,Eg=class{static getDataURL(Fg){if(/^data:/i.test(Fg.src)|| typeof HTMLCanvasElement>"u")return Fg.src;let Gg;if(Fg instanceof HTMLCanvasElement)Gg=Fg;else{void 0===Dg&&(Dg=Ue("canvas")),Dg.width=Fg.width,Dg.height=Fg.height;let Hg=Dg.getContext("2d");Fg instanceof ImageData?Hg.putImageData(Fg,0,0):Hg.drawImage(Fg,0,0,Fg.width,Fg.height),Gg=Dg}return Gg.width>2048||Gg.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",Fg),Gg.toDataURL("image/jpeg",.6)):Gg.toDataURL("image/png")}static sRGBToLinear(Ig){if("u">typeof HTMLImageElement&&Ig instanceof HTMLImageElement||"u">typeof HTMLCanvasElement&&Ig instanceof HTMLCanvasElement||"u">typeof ImageBitmap&&Ig instanceof ImageBitmap){let Jg=Ue("canvas");Jg.width=Ig.width,Jg.height=Ig.height;let Kg=Jg.getContext("2d");Kg.drawImage(Ig,0,0,Ig.width,Ig.height);let Lg=Kg.getImageData(0,0,Ig.width,Ig.height),Mg=Lg.data;for(let Ng=0;Ng<Mg.length;Ng++)Mg[Ng]=255*Ve(Mg[Ng]/255);return Kg.putImageData(Lg,0,0),Jg}{if(!Ig.data)return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),Ig;let Og=Ig.data.slice(0);for(let Pg=0;Pg<Og.length;Pg++)Og instanceof Uint8Array||Og instanceof Uint8ClampedArray?Og[Pg]=Math.floor(255*Ve(Og[Pg]/255)):Og[Pg]=Ve(Og[Pg]);return{data:Og,width:Ig.width,height:Ig.height}}}},Qg=class{constructor(Rg=null){this.isSource=!0,this.uuid=ub(),this.data=Rg,this.version=0}set needsUpdate(Sg){!0===Sg&&this.version++}toJSON(Tg){let Ug=void 0===Tg||"string"==typeof Tg;if(!Ug&& void 0!==Tg.images[this.uuid])return Tg.images[this.uuid];let Vg={uuid:this.uuid,url:""},Wg=this.data;if(null!==Wg){let Xg;if(Array.isArray(Wg)){Xg=[];for(let Yg=0,Zg=Wg.length;Yg<Zg;Yg++)Wg[Yg].isDataTexture?Xg.push($g(Wg[Yg].image)):Xg.push($g(Wg[Yg]))}else Xg=$g(Wg);Vg.url=Xg}return Ug||(Tg.images[this.uuid]=Vg),Vg}};function $g(a){return"u">typeof HTMLImageElement&&a instanceof HTMLImageElement||"u">typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"u">typeof ImageBitmap&&a instanceof ImageBitmap?Eg.getDataURL(a):a.data?{data:Array.from(a.data),width:a.width,height:a.height,type:a.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var _g=0,ah=class extends ab{constructor(bh=ah.DEFAULT_IMAGE,ch=ah.DEFAULT_MAPPING,dh=qa,eh=qa,fh=va,gh=xa,hh=Da,ih=ya,jh=ah.DEFAULT_ANISOTROPY,kh=Sa){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_g++}),this.uuid=ub(),this.name="",this.source=new Qg(bh),this.mipmaps=[],this.mapping=ch,this.wrapS=dh,this.wrapT=eh,this.magFilter=fh,this.minFilter=gh,this.anisotropy=jh,this.format=hh,this.internalFormat=null,this.type=ih,this.offset=new Eb(0,0),this.repeat=new Eb(1,1),this.center=new Eb(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Rc,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=kh,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(lh){this.source.data=lh}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(mh){return this.name=mh.name,this.source=mh.source,this.mipmaps=mh.mipmaps.slice(0),this.mapping=mh.mapping,this.wrapS=mh.wrapS,this.wrapT=mh.wrapT,this.magFilter=mh.magFilter,this.minFilter=mh.minFilter,this.anisotropy=mh.anisotropy,this.format=mh.format,this.internalFormat=mh.internalFormat,this.type=mh.type,this.offset.copy(mh.offset),this.repeat.copy(mh.repeat),this.center.copy(mh.center),this.rotation=mh.rotation,this.matrixAutoUpdate=mh.matrixAutoUpdate,this.matrix.copy(mh.matrix),this.generateMipmaps=mh.generateMipmaps,this.premultiplyAlpha=mh.premultiplyAlpha,this.flipY=mh.flipY,this.unpackAlignment=mh.unpackAlignment,this.encoding=mh.encoding,this.userData=JSON.parse(JSON.stringify(mh.userData)),this.needsUpdate=!0,this}toJSON(nh){let oh=void 0===nh||"string"==typeof nh;if(!oh&& void 0!==nh.textures[this.uuid])return nh.textures[this.uuid];let ph={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(nh).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(ph.userData=this.userData),oh||(nh.textures[this.uuid]=ph),ph}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(qh){if(this.mapping!==ja)return qh;if(qh.applyMatrix3(this.matrix),qh.x<0||qh.x>1)switch(this.wrapS){case pa:qh.x=qh.x-Math.floor(qh.x);break;case qa:qh.x=qh.x<0?0:1;break;case ra:1===Math.abs(Math.floor(qh.x)%2)?qh.x=Math.ceil(qh.x)-qh.x:qh.x=qh.x-Math.floor(qh.x);break}if(qh.y<0||qh.y>1)switch(this.wrapT){case pa:qh.y=qh.y-Math.floor(qh.y);break;case qa:qh.y=qh.y<0?0:1;break;case ra:1===Math.abs(Math.floor(qh.y)%2)?qh.y=Math.ceil(qh.y)-qh.y:qh.y=qh.y-Math.floor(qh.y);break}return this.flipY&&(qh.y=1-qh.y),qh}set needsUpdate(rh){!0===rh&&(this.version++,this.source.needsUpdate=!0)}};ah.DEFAULT_IMAGE=null,ah.DEFAULT_MAPPING=ja,ah.DEFAULT_ANISOTROPY=1;var sh=class{constructor(th=0,uh=0,vh=0,wh=1){sh.prototype.isVector4=!0,this.x=th,this.y=uh,this.z=vh,this.w=wh}get width(){return this.z}set width(xh){this.z=xh}get height(){return this.w}set height(yh){this.w=yh}set(zh,Ah,Bh,Ch){return this.x=zh,this.y=Ah,this.z=Bh,this.w=Ch,this}setScalar(Dh){return this.x=Dh,this.y=Dh,this.z=Dh,this.w=Dh,this}setX(Eh){return this.x=Eh,this}setY(Fh){return this.y=Fh,this}setZ(Gh){return this.z=Gh,this}setW(Hh){return this.w=Hh,this}setComponent(Ih,Jh){switch(Ih){case 0:this.x=Jh;break;case 1:this.y=Jh;break;case 2:this.z=Jh;break;case 3:this.w=Jh;break;default:throw new Error("index is out of range: "+Ih)}return this}getComponent(Kh){switch(Kh){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+Kh)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(Lh){return this.x=Lh.x,this.y=Lh.y,this.z=Lh.z,this.w=void 0!==Lh.w?Lh.w:1,this}add(Mh){return this.x+=Mh.x,this.y+=Mh.y,this.z+=Mh.z,this.w+=Mh.w,this}addScalar(Nh){return this.x+=Nh,this.y+=Nh,this.z+=Nh,this.w+=Nh,this}addVectors(Oh,Ph){return this.x=Oh.x+Ph.x,this.y=Oh.y+Ph.y,this.z=Oh.z+Ph.z,this.w=Oh.w+Ph.w,this}addScaledVector(Qh,Rh){return this.x+=Qh.x*Rh,this.y+=Qh.y*Rh,this.z+=Qh.z*Rh,this.w+=Qh.w*Rh,this}sub(Sh){return this.x-=Sh.x,this.y-=Sh.y,this.z-=Sh.z,this.w-=Sh.w,this}subScalar(Th){return this.x-=Th,this.y-=Th,this.z-=Th,this.w-=Th,this}subVectors(Uh,Vh){return this.x=Uh.x-Vh.x,this.y=Uh.y-Vh.y,this.z=Uh.z-Vh.z,this.w=Uh.w-Vh.w,this}multiply(Wh){return this.x*=Wh.x,this.y*=Wh.y,this.z*=Wh.z,this.w*=Wh.w,this}multiplyScalar(Xh){return this.x*=Xh,this.y*=Xh,this.z*=Xh,this.w*=Xh,this}applyMatrix4(Yh){let Zh=this.x,$h=this.y,_h=this.z,ai=this.w,bi=Yh.elements;return this.x=bi[0]*Zh+bi[4]*$h+bi[8]*_h+bi[12]*ai,this.y=bi[1]*Zh+bi[5]*$h+bi[9]*_h+bi[13]*ai,this.z=bi[2]*Zh+bi[6]*$h+bi[10]*_h+bi[14]*ai,this.w=bi[3]*Zh+bi[7]*$h+bi[11]*_h+bi[15]*ai,this}divideScalar(ci){return this.multiplyScalar(1/ci)}setAxisAngleFromQuaternion(di){this.w=2*Math.acos(di.w);let ei=Math.sqrt(1-di.w*di.w);return ei<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=di.x/ei,this.y=di.y/ei,this.z=di.z/ei),this}setAxisAngleFromRotationMatrix(fi){let gi,hi,ii,ji,ki=fi.elements,li=ki[0],mi=ki[4],ni=ki[8],oi=ki[1],pi=ki[5],qi=ki[9],ri=ki[2],si=ki[6],ti=ki[10];if(.01>Math.abs(mi-oi)&&.01>Math.abs(ni-ri)&&.01>Math.abs(qi-si)){if(.1>Math.abs(mi+oi)&&.1>Math.abs(ni+ri)&&.1>Math.abs(qi+si)&&.1>Math.abs(li+pi+ti-3))return this.set(1,0,0,0),this;gi=Math.PI;let ui=(li+1)/2,vi=(pi+1)/2,wi=(ti+1)/2,xi=(mi+oi)/4,yi=(ni+ri)/4,zi=(qi+si)/4;return ui>vi&&ui>wi?ui<.01?(hi=0,ii=.707106781,ji=.707106781):(ii=xi/(hi=Math.sqrt(ui)),ji=yi/hi):vi>wi?vi<.01?(hi=.707106781,ii=0,ji=.707106781):(hi=xi/(ii=Math.sqrt(vi)),ji=zi/ii):wi<.01?(hi=.707106781,ii=.707106781,ji=0):(hi=yi/(ji=Math.sqrt(wi)),ii=zi/ji),this.set(hi,ii,ji,gi),this}let Ai=Math.sqrt((si-qi)*(si-qi)+(ni-ri)*(ni-ri)+(oi-mi)*(oi-mi));return .001>Math.abs(Ai)&&(Ai=1),this.x=(si-qi)/Ai,this.y=(ni-ri)/Ai,this.z=(oi-mi)/Ai,this.w=Math.acos((li+pi+ti-1)/2),this}min(Bi){return this.x=Math.min(this.x,Bi.x),this.y=Math.min(this.y,Bi.y),this.z=Math.min(this.z,Bi.z),this.w=Math.min(this.w,Bi.w),this}max(Ci){return this.x=Math.max(this.x,Ci.x),this.y=Math.max(this.y,Ci.y),this.z=Math.max(this.z,Ci.z),this.w=Math.max(this.w,Ci.w),this}clamp(Di,Ei){return this.x=Math.max(Di.x,Math.min(Ei.x,this.x)),this.y=Math.max(Di.y,Math.min(Ei.y,this.y)),this.z=Math.max(Di.z,Math.min(Ei.z,this.z)),this.w=Math.max(Di.w,Math.min(Ei.w,this.w)),this}clampScalar(Fi,Gi){return this.x=Math.max(Fi,Math.min(Gi,this.x)),this.y=Math.max(Fi,Math.min(Gi,this.y)),this.z=Math.max(Fi,Math.min(Gi,this.z)),this.w=Math.max(Fi,Math.min(Gi,this.w)),this}clampLength(Hi,Ii){let Ji=this.length();return this.divideScalar(Ji||1).multiplyScalar(Math.max(Hi,Math.min(Ii,Ji)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(Ki){return this.x*Ki.x+this.y*Ki.y+this.z*Ki.z+this.w*Ki.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(Li){return this.normalize().multiplyScalar(Li)}lerp(Mi,Ni){return this.x+=(Mi.x-this.x)*Ni,this.y+=(Mi.y-this.y)*Ni,this.z+=(Mi.z-this.z)*Ni,this.w+=(Mi.w-this.w)*Ni,this}lerpVectors(Oi,Pi,Qi){return this.x=Oi.x+(Pi.x-Oi.x)*Qi,this.y=Oi.y+(Pi.y-Oi.y)*Qi,this.z=Oi.z+(Pi.z-Oi.z)*Qi,this.w=Oi.w+(Pi.w-Oi.w)*Qi,this}equals(Ri){return Ri.x===this.x&&Ri.y===this.y&&Ri.z===this.z&&Ri.w===this.w}fromArray(Si,Ti=0){return this.x=Si[Ti],this.y=Si[Ti+1],this.z=Si[Ti+2],this.w=Si[Ti+3],this}toArray(Ui=[],Vi=0){return Ui[Vi]=this.x,Ui[Vi+1]=this.y,Ui[Vi+2]=this.z,Ui[Vi+3]=this.w,Ui}fromBufferAttribute(Wi,Xi){return this.x=Wi.getX(Xi),this.y=Wi.getY(Xi),this.z=Wi.getZ(Xi),this.w=Wi.getW(Xi),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Yi=class extends ab{constructor(Zi=1,$i=1,_i={}){super(),this.isWebGLRenderTarget=!0,this.width=Zi,this.height=$i,this.depth=1,this.scissor=new sh(0,0,Zi,$i),this.scissorTest=!1,this.viewport=new sh(0,0,Zi,$i);let aj={width:Zi,height:$i,depth:1};this.texture=new ah(aj,_i.mapping,_i.wrapS,_i.wrapT,_i.magFilter,_i.minFilter,_i.format,_i.type,_i.anisotropy,_i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==_i.generateMipmaps&&_i.generateMipmaps,this.texture.internalFormat=void 0!==_i.internalFormat?_i.internalFormat:null,this.texture.minFilter=void 0!==_i.minFilter?_i.minFilter:va,this.depthBuffer=void 0===_i.depthBuffer||_i.depthBuffer,this.stencilBuffer=void 0!==_i.stencilBuffer&&_i.stencilBuffer,this.depthTexture=void 0!==_i.depthTexture?_i.depthTexture:null,this.samples=void 0!==_i.samples?_i.samples:0}setSize(bj,cj,dj=1){(this.width!==bj||this.height!==cj||this.depth!==dj)&&(this.width=bj,this.height=cj,this.depth=dj,this.texture.image.width=bj,this.texture.image.height=cj,this.texture.image.depth=dj,this.dispose()),this.viewport.set(0,0,bj,cj),this.scissor.set(0,0,bj,cj)}clone(){return new this.constructor().copy(this)}copy(ej){this.width=ej.width,this.height=ej.height,this.depth=ej.depth,this.viewport.copy(ej.viewport),this.texture=ej.texture.clone(),this.texture.isRenderTargetTexture=!0;let fj=Object.assign({},ej.texture.image);return this.texture.source=new Qg(fj),this.depthBuffer=ej.depthBuffer,this.stencilBuffer=ej.stencilBuffer,null!==ej.depthTexture&&(this.depthTexture=ej.depthTexture.clone()),this.samples=ej.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},gj=class extends ah{constructor(hj=null,ij=1,jj=1,kj=1){super(null),this.isDataArrayTexture=!0,this.image={data:hj,width:ij,height:jj,depth:kj},this.magFilter=sa,this.minFilter=sa,this.wrapR=qa,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},lj=class extends ah{constructor(mj=null,nj=1,oj=1,pj=1){super(null),this.isData3DTexture=!0,this.image={data:mj,width:nj,height:oj,depth:pj},this.magFilter=sa,this.minFilter=sa,this.wrapR=qa,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},qj=class extends Yi{constructor(rj=1,sj=1,tj=1,uj={}){super(rj,sj,uj),this.isWebGLMultipleRenderTargets=!0;let vj=this.texture;this.texture=[];for(let wj=0;wj<tj;wj++)this.texture[wj]=vj.clone(),this.texture[wj].isRenderTargetTexture=!0}setSize(xj,yj,zj=1){if(this.width!==xj||this.height!==yj||this.depth!==zj){this.width=xj,this.height=yj,this.depth=zj;for(let Aj=0,Bj=this.texture.length;Aj<Bj;Aj++)this.texture[Aj].image.width=xj,this.texture[Aj].image.height=yj,this.texture[Aj].image.depth=zj;this.dispose()}return this.viewport.set(0,0,xj,yj),this.scissor.set(0,0,xj,yj),this}copy(Cj){this.dispose(),this.width=Cj.width,this.height=Cj.height,this.depth=Cj.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=Cj.depthBuffer,this.stencilBuffer=Cj.stencilBuffer,null!==Cj.depthTexture&&(this.depthTexture=Cj.depthTexture.clone()),this.texture.length=0;for(let Dj=0,Ej=Cj.texture.length;Dj<Ej;Dj++)this.texture[Dj]=Cj.texture[Dj].clone(),this.texture[Dj].isRenderTargetTexture=!0;return this}},Fj=class{constructor(Gj=0,Hj=0,Ij=0,Jj=1){this.isQuaternion=!0,this._x=Gj,this._y=Hj,this._z=Ij,this._w=Jj}static slerpFlat(Kj,Lj,Mj,Nj,Oj,Pj,Qj){let Rj=Mj[Nj+0],Sj=Mj[Nj+1],Tj=Mj[Nj+2],Uj=Mj[Nj+3],Vj=Oj[Pj+0],Wj=Oj[Pj+1],Xj=Oj[Pj+2],Yj=Oj[Pj+3];if(0===Qj){Kj[Lj+0]=Rj,Kj[Lj+1]=Sj,Kj[Lj+2]=Tj,Kj[Lj+3]=Uj;return}if(1===Qj){Kj[Lj+0]=Vj,Kj[Lj+1]=Wj,Kj[Lj+2]=Xj,Kj[Lj+3]=Yj;return}if(Uj!==Yj||Rj!==Vj||Sj!==Wj||Tj!==Xj){let Zj=1-Qj,$j=Rj*Vj+Sj*Wj+Tj*Xj+Uj*Yj,_j=$j>=0?1:-1,ak=1-$j*$j;if(ak>Number.EPSILON){let bk=Math.sqrt(ak),ck=Math.atan2(bk,$j*_j);Zj=Math.sin(Zj*ck)/bk,Qj=Math.sin(Qj*ck)/bk}let dk=Qj*_j;if(Rj=Rj*Zj+Vj*dk,Sj=Sj*Zj+Wj*dk,Tj=Tj*Zj+Xj*dk,Uj=Uj*Zj+Yj*dk,Zj===1-Qj){let ek=1/Math.sqrt(Rj*Rj+Sj*Sj+Tj*Tj+Uj*Uj);Rj*=ek,Sj*=ek,Tj*=ek,Uj*=ek}}Kj[Lj]=Rj,Kj[Lj+1]=Sj,Kj[Lj+2]=Tj,Kj[Lj+3]=Uj}static multiplyQuaternionsFlat(fk,gk,hk,ik,jk,kk){let lk=hk[ik],mk=hk[ik+1],nk=hk[ik+2],ok=hk[ik+3],pk=jk[kk],qk=jk[kk+1],rk=jk[kk+2],sk=jk[kk+3];return fk[gk]=lk*sk+ok*pk+mk*rk-nk*qk,fk[gk+1]=mk*sk+ok*qk+nk*pk-lk*rk,fk[gk+2]=nk*sk+ok*rk+lk*qk-mk*pk,fk[gk+3]=ok*sk-lk*pk-mk*qk-nk*rk,fk}get x(){return this._x}set x(tk){this._x=tk,this._onChangeCallback()}get y(){return this._y}set y(uk){this._y=uk,this._onChangeCallback()}get z(){return this._z}set z(vk){this._z=vk,this._onChangeCallback()}get w(){return this._w}set w(wk){this._w=wk,this._onChangeCallback()}set(xk,yk,zk,Ak){return this._x=xk,this._y=yk,this._z=zk,this._w=Ak,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(Bk){return this._x=Bk.x,this._y=Bk.y,this._z=Bk.z,this._w=Bk.w,this._onChangeCallback(),this}setFromEuler(Ck,Dk){let Ek=Ck._x,Fk=Ck._y,Gk=Ck._z,Hk=Ck._order,Ik=Math.cos,Jk=Math.sin,Kk=Ik(Ek/2),Lk=Ik(Fk/2),Mk=Ik(Gk/2),Nk=Jk(Ek/2),Ok=Jk(Fk/2),Pk=Jk(Gk/2);switch(Hk){case"XYZ":this._x=Nk*Lk*Mk+Kk*Ok*Pk,this._y=Kk*Ok*Mk-Nk*Lk*Pk,this._z=Kk*Lk*Pk+Nk*Ok*Mk,this._w=Kk*Lk*Mk-Nk*Ok*Pk;break;case"YXZ":this._x=Nk*Lk*Mk+Kk*Ok*Pk,this._y=Kk*Ok*Mk-Nk*Lk*Pk,this._z=Kk*Lk*Pk-Nk*Ok*Mk,this._w=Kk*Lk*Mk+Nk*Ok*Pk;break;case"ZXY":this._x=Nk*Lk*Mk-Kk*Ok*Pk,this._y=Kk*Ok*Mk+Nk*Lk*Pk,this._z=Kk*Lk*Pk+Nk*Ok*Mk,this._w=Kk*Lk*Mk-Nk*Ok*Pk;break;case"ZYX":this._x=Nk*Lk*Mk-Kk*Ok*Pk,this._y=Kk*Ok*Mk+Nk*Lk*Pk,this._z=Kk*Lk*Pk-Nk*Ok*Mk,this._w=Kk*Lk*Mk+Nk*Ok*Pk;break;case"YZX":this._x=Nk*Lk*Mk+Kk*Ok*Pk,this._y=Kk*Ok*Mk+Nk*Lk*Pk,this._z=Kk*Lk*Pk-Nk*Ok*Mk,this._w=Kk*Lk*Mk-Nk*Ok*Pk;break;case"XZY":this._x=Nk*Lk*Mk-Kk*Ok*Pk,this._y=Kk*Ok*Mk-Nk*Lk*Pk,this._z=Kk*Lk*Pk+Nk*Ok*Mk,this._w=Kk*Lk*Mk+Nk*Ok*Pk;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+Hk)}return!1!==Dk&&this._onChangeCallback(),this}setFromAxisAngle(Qk,Rk){let Sk=Rk/2,Tk=Math.sin(Sk);return this._x=Qk.x*Tk,this._y=Qk.y*Tk,this._z=Qk.z*Tk,this._w=Math.cos(Sk),this._onChangeCallback(),this}setFromRotationMatrix(Uk){let Vk=Uk.elements,Wk=Vk[0],Xk=Vk[4],Yk=Vk[8],Zk=Vk[1],$k=Vk[5],_k=Vk[9],al=Vk[2],bl=Vk[6],cl=Vk[10],dl=Wk+$k+cl;if(dl>0){let el=.5/Math.sqrt(dl+1);this._w=.25/el,this._x=(bl-_k)*el,this._y=(Yk-al)*el,this._z=(Zk-Xk)*el}else if(Wk>$k&&Wk>cl){let fl=2*Math.sqrt(1+Wk-$k-cl);this._w=(bl-_k)/fl,this._x=.25*fl,this._y=(Xk+Zk)/fl,this._z=(Yk+al)/fl}else if($k>cl){let gl=2*Math.sqrt(1+$k-Wk-cl);this._w=(Yk-al)/gl,this._x=(Xk+Zk)/gl,this._y=.25*gl,this._z=(_k+bl)/gl}else{let hl=2*Math.sqrt(1+cl-Wk-$k);this._w=(Zk-Xk)/hl,this._x=(Yk+al)/hl,this._y=(_k+bl)/hl,this._z=.25*hl}return this._onChangeCallback(),this}setFromUnitVectors(il,jl){let kl=il.dot(jl)+1;return kl<Number.EPSILON?(kl=0,Math.abs(il.x)>Math.abs(il.z)?(this._x=-il.y,this._y=il.x,this._z=0,this._w=kl):(this._x=0,this._y=-il.z,this._z=il.y,this._w=kl)):(this._x=il.y*jl.z-il.z*jl.y,this._y=il.z*jl.x-il.x*jl.z,this._z=il.x*jl.y-il.y*jl.x,this._w=kl),this.normalize()}angleTo(ll){return 2*Math.acos(Math.abs(vb(this.dot(ll),-1,1)))}rotateTowards(ml,nl){let ol=this.angleTo(ml);if(0===ol)return this;let pl=Math.min(1,nl/ol);return this.slerp(ml,pl),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(ql){return this._x*ql._x+this._y*ql._y+this._z*ql._z+this._w*ql._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let rl=this.length();return 0===rl?(this._x=0,this._y=0,this._z=0,this._w=1):(rl=1/rl,this._x=this._x*rl,this._y=this._y*rl,this._z=this._z*rl,this._w=this._w*rl),this._onChangeCallback(),this}multiply(sl){return this.multiplyQuaternions(this,sl)}premultiply(tl){return this.multiplyQuaternions(tl,this)}multiplyQuaternions(ul,vl){let wl=ul._x,xl=ul._y,yl=ul._z,zl=ul._w,Al=vl._x,Bl=vl._y,Cl=vl._z,Dl=vl._w;return this._x=wl*Dl+zl*Al+xl*Cl-yl*Bl,this._y=xl*Dl+zl*Bl+yl*Al-wl*Cl,this._z=yl*Dl+zl*Cl+wl*Bl-xl*Al,this._w=zl*Dl-wl*Al-xl*Bl-yl*Cl,this._onChangeCallback(),this}slerp(El,Fl){if(0===Fl)return this;if(1===Fl)return this.copy(El);let Gl=this._x,Hl=this._y,Il=this._z,Jl=this._w,Kl=Jl*El._w+Gl*El._x+Hl*El._y+Il*El._z;if(Kl<0?(this._w=-El._w,this._x=-El._x,this._y=-El._y,this._z=-El._z,Kl=-Kl):this.copy(El),Kl>=1)return this._w=Jl,this._x=Gl,this._y=Hl,this._z=Il,this;let Ll=1-Kl*Kl;if(Ll<=Number.EPSILON){let Ml=1-Fl;return this._w=Ml*Jl+Fl*this._w,this._x=Ml*Gl+Fl*this._x,this._y=Ml*Hl+Fl*this._y,this._z=Ml*Il+Fl*this._z,this.normalize(),this._onChangeCallback(),this}let Nl=Math.sqrt(Ll),Ol=Math.atan2(Nl,Kl),Pl=Math.sin((1-Fl)*Ol)/Nl,Ql=Math.sin(Fl*Ol)/Nl;return this._w=Jl*Pl+this._w*Ql,this._x=Gl*Pl+this._x*Ql,this._y=Hl*Pl+this._y*Ql,this._z=Il*Pl+this._z*Ql,this._onChangeCallback(),this}slerpQuaternions(Rl,Sl,Tl){return this.copy(Rl).slerp(Sl,Tl)}random(){let Ul=Math.random(),Vl=Math.sqrt(1-Ul),Wl=Math.sqrt(Ul),Xl=2*Math.PI*Math.random(),Yl=2*Math.PI*Math.random();return this.set(Vl*Math.cos(Xl),Wl*Math.sin(Yl),Wl*Math.cos(Yl),Vl*Math.sin(Xl))}equals(Zl){return Zl._x===this._x&&Zl._y===this._y&&Zl._z===this._z&&Zl._w===this._w}fromArray($l,_l=0){return this._x=$l[_l],this._y=$l[_l+1],this._z=$l[_l+2],this._w=$l[_l+3],this._onChangeCallback(),this}toArray(am=[],bm=0){return am[bm]=this._x,am[bm+1]=this._y,am[bm+2]=this._z,am[bm+3]=this._w,am}fromBufferAttribute(cm,dm){return this._x=cm.getX(dm),this._y=cm.getY(dm),this._z=cm.getZ(dm),this._w=cm.getW(dm),this}_onChange(em){return this._onChangeCallback=em,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},fm=class{constructor(gm=0,hm=0,im=0){fm.prototype.isVector3=!0,this.x=gm,this.y=hm,this.z=im}set(jm,km,lm){return void 0===lm&&(lm=this.z),this.x=jm,this.y=km,this.z=lm,this}setScalar(mm){return this.x=mm,this.y=mm,this.z=mm,this}setX(nm){return this.x=nm,this}setY(om){return this.y=om,this}setZ(pm){return this.z=pm,this}setComponent(qm,rm){switch(qm){case 0:this.x=rm;break;case 1:this.y=rm;break;case 2:this.z=rm;break;default:throw new Error("index is out of range: "+qm)}return this}getComponent(sm){switch(sm){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+sm)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(tm){return this.x=tm.x,this.y=tm.y,this.z=tm.z,this}add(um){return this.x+=um.x,this.y+=um.y,this.z+=um.z,this}addScalar(vm){return this.x+=vm,this.y+=vm,this.z+=vm,this}addVectors(wm,xm){return this.x=wm.x+xm.x,this.y=wm.y+xm.y,this.z=wm.z+xm.z,this}addScaledVector(ym,zm){return this.x+=ym.x*zm,this.y+=ym.y*zm,this.z+=ym.z*zm,this}sub(Am){return this.x-=Am.x,this.y-=Am.y,this.z-=Am.z,this}subScalar(Bm){return this.x-=Bm,this.y-=Bm,this.z-=Bm,this}subVectors(Cm,Dm){return this.x=Cm.x-Dm.x,this.y=Cm.y-Dm.y,this.z=Cm.z-Dm.z,this}multiply(Em){return this.x*=Em.x,this.y*=Em.y,this.z*=Em.z,this}multiplyScalar(Fm){return this.x*=Fm,this.y*=Fm,this.z*=Fm,this}multiplyVectors(Gm,Hm){return this.x=Gm.x*Hm.x,this.y=Gm.y*Hm.y,this.z=Gm.z*Hm.z,this}applyEuler(Im){return this.applyQuaternion(Ho.setFromEuler(Im))}applyAxisAngle(Jm,Km){return this.applyQuaternion(Ho.setFromAxisAngle(Jm,Km))}applyMatrix3(Lm){let Mm=this.x,Nm=this.y,Om=this.z,Pm=Lm.elements;return this.x=Pm[0]*Mm+Pm[3]*Nm+Pm[6]*Om,this.y=Pm[1]*Mm+Pm[4]*Nm+Pm[7]*Om,this.z=Pm[2]*Mm+Pm[5]*Nm+Pm[8]*Om,this}applyNormalMatrix(Qm){return this.applyMatrix3(Qm).normalize()}applyMatrix4(Rm){let Sm=this.x,Tm=this.y,Um=this.z,Vm=Rm.elements,Wm=1/(Vm[3]*Sm+Vm[7]*Tm+Vm[11]*Um+Vm[15]);return this.x=(Vm[0]*Sm+Vm[4]*Tm+Vm[8]*Um+Vm[12])*Wm,this.y=(Vm[1]*Sm+Vm[5]*Tm+Vm[9]*Um+Vm[13])*Wm,this.z=(Vm[2]*Sm+Vm[6]*Tm+Vm[10]*Um+Vm[14])*Wm,this}applyQuaternion(Xm){let Ym=this.x,Zm=this.y,$m=this.z,_m=Xm.x,an=Xm.y,bn=Xm.z,cn=Xm.w,dn=cn*Ym+an*$m-bn*Zm,en=cn*Zm+bn*Ym-_m*$m,fn=cn*$m+_m*Zm-an*Ym,gn=-_m*Ym-an*Zm-bn*$m;return this.x=dn*cn+ -(gn*_m)+ -(en*bn)- -(fn*an),this.y=en*cn+ -(gn*an)+ -(fn*_m)- -(dn*bn),this.z=fn*cn+ -(gn*bn)+ -(dn*an)- -(en*_m),this}project(hn){return this.applyMatrix4(hn.matrixWorldInverse).applyMatrix4(hn.projectionMatrix)}unproject(jn){return this.applyMatrix4(jn.projectionMatrixInverse).applyMatrix4(jn.matrixWorld)}transformDirection(kn){let ln=this.x,mn=this.y,nn=this.z,on=kn.elements;return this.x=on[0]*ln+on[4]*mn+on[8]*nn,this.y=on[1]*ln+on[5]*mn+on[9]*nn,this.z=on[2]*ln+on[6]*mn+on[10]*nn,this.normalize()}divide(pn){return this.x/=pn.x,this.y/=pn.y,this.z/=pn.z,this}divideScalar(qn){return this.multiplyScalar(1/qn)}min(rn){return this.x=Math.min(this.x,rn.x),this.y=Math.min(this.y,rn.y),this.z=Math.min(this.z,rn.z),this}max(sn){return this.x=Math.max(this.x,sn.x),this.y=Math.max(this.y,sn.y),this.z=Math.max(this.z,sn.z),this}clamp(tn,un){return this.x=Math.max(tn.x,Math.min(un.x,this.x)),this.y=Math.max(tn.y,Math.min(un.y,this.y)),this.z=Math.max(tn.z,Math.min(un.z,this.z)),this}clampScalar(vn,wn){return this.x=Math.max(vn,Math.min(wn,this.x)),this.y=Math.max(vn,Math.min(wn,this.y)),this.z=Math.max(vn,Math.min(wn,this.z)),this}clampLength(xn,yn){let zn=this.length();return this.divideScalar(zn||1).multiplyScalar(Math.max(xn,Math.min(yn,zn)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(An){return this.x*An.x+this.y*An.y+this.z*An.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(Bn){return this.normalize().multiplyScalar(Bn)}lerp(Cn,Dn){return this.x+=(Cn.x-this.x)*Dn,this.y+=(Cn.y-this.y)*Dn,this.z+=(Cn.z-this.z)*Dn,this}lerpVectors(En,Fn,Gn){return this.x=En.x+(Fn.x-En.x)*Gn,this.y=En.y+(Fn.y-En.y)*Gn,this.z=En.z+(Fn.z-En.z)*Gn,this}cross(Hn){return this.crossVectors(this,Hn)}crossVectors(In,Jn){let Kn=In.x,Ln=In.y,Mn=In.z,Nn=Jn.x,On=Jn.y,Pn=Jn.z;return this.x=Ln*Pn-Mn*On,this.y=Mn*Nn-Kn*Pn,this.z=Kn*On-Ln*Nn,this}projectOnVector(Qn){let Rn=Qn.lengthSq();if(0===Rn)return this.set(0,0,0);let Sn=Qn.dot(this)/Rn;return this.copy(Qn).multiplyScalar(Sn)}projectOnPlane(Tn){return Go.copy(this).projectOnVector(Tn),this.sub(Go)}reflect(Un){return this.sub(Go.copy(Un).multiplyScalar(2*this.dot(Un)))}angleTo(Vn){let Wn=Math.sqrt(this.lengthSq()*Vn.lengthSq());return 0===Wn?Math.PI/2:Math.acos(vb(this.dot(Vn)/Wn,-1,1))}distanceTo(Xn){return Math.sqrt(this.distanceToSquared(Xn))}distanceToSquared(Yn){let Zn=this.x-Yn.x,$n=this.y-Yn.y,_n=this.z-Yn.z;return Zn*Zn+$n*$n+_n*_n}manhattanDistanceTo(ao){return Math.abs(this.x-ao.x)+Math.abs(this.y-ao.y)+Math.abs(this.z-ao.z)}setFromSpherical(bo){return this.setFromSphericalCoords(bo.radius,bo.phi,bo.theta)}setFromSphericalCoords(co,eo,fo){let go=Math.sin(eo)*co;return this.x=go*Math.sin(fo),this.y=Math.cos(eo)*co,this.z=go*Math.cos(fo),this}setFromCylindrical(ho){return this.setFromCylindricalCoords(ho.radius,ho.theta,ho.y)}setFromCylindricalCoords(io,jo,ko){return this.x=io*Math.sin(jo),this.y=ko,this.z=io*Math.cos(jo),this}setFromMatrixPosition(lo){let mo=lo.elements;return this.x=mo[12],this.y=mo[13],this.z=mo[14],this}setFromMatrixScale(no){let oo=this.setFromMatrixColumn(no,0).length(),po=this.setFromMatrixColumn(no,1).length(),qo=this.setFromMatrixColumn(no,2).length();return this.x=oo,this.y=po,this.z=qo,this}setFromMatrixColumn(ro,so){return this.fromArray(ro.elements,4*so)}setFromMatrix3Column(to,uo){return this.fromArray(to.elements,3*uo)}setFromEuler(vo){return this.x=vo._x,this.y=vo._y,this.z=vo._z,this}equals(wo){return wo.x===this.x&&wo.y===this.y&&wo.z===this.z}fromArray(xo,yo=0){return this.x=xo[yo],this.y=xo[yo+1],this.z=xo[yo+2],this}toArray(zo=[],Ao=0){return zo[Ao]=this.x,zo[Ao+1]=this.y,zo[Ao+2]=this.z,zo}fromBufferAttribute(Bo,Co){return this.x=Bo.getX(Co),this.y=Bo.getY(Co),this.z=Bo.getZ(Co),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let Do=(Math.random()-.5)*2,Eo=Math.random()*Math.PI*2,Fo=Math.sqrt(1-Do**2);return this.x=Fo*Math.cos(Eo),this.y=Fo*Math.sin(Eo),this.z=Do,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},Go=new fm,Ho=new Fj,Io=class{constructor(Jo=new fm(1/0,1/0,1/0),Ko=new fm(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=Jo,this.max=Ko}set(Lo,Mo){return this.min.copy(Lo),this.max.copy(Mo),this}setFromArray(No){let Oo=1/0,Po=1/0,Qo=1/0,Ro=-1/0,So=-1/0,To=-1/0;for(let Uo=0,Vo=No.length;Uo<Vo;Uo+=3){let Wo=No[Uo],Xo=No[Uo+1],Yo=No[Uo+2];Wo<Oo&&(Oo=Wo),Xo<Po&&(Po=Xo),Yo<Qo&&(Qo=Yo),Wo>Ro&&(Ro=Wo),Xo>So&&(So=Xo),Yo>To&&(To=Yo)}return this.min.set(Oo,Po,Qo),this.max.set(Ro,So,To),this}setFromBufferAttribute(Zo){let $o=1/0,_o=1/0,ap=1/0,bp=-1/0,cp=-1/0,dp=-1/0;for(let ep=0,fp=Zo.count;ep<fp;ep++){let gp=Zo.getX(ep),hp=Zo.getY(ep),ip=Zo.getZ(ep);gp<$o&&($o=gp),hp<_o&&(_o=hp),ip<ap&&(ap=ip),gp>bp&&(bp=gp),hp>cp&&(cp=hp),ip>dp&&(dp=ip)}return this.min.set($o,_o,ap),this.max.set(bp,cp,dp),this}setFromPoints(jp){this.makeEmpty();for(let kp=0,lp=jp.length;kp<lp;kp++)this.expandByPoint(jp[kp]);return this}setFromCenterAndSize(mp,np){let op=_p.copy(np).multiplyScalar(.5);return this.min.copy(mp).sub(op),this.max.copy(mp).add(op),this}setFromObject(pp,qp=!1){return this.makeEmpty(),this.expandByObject(pp,qp)}clone(){return new this.constructor().copy(this)}copy(rp){return this.min.copy(rp.min),this.max.copy(rp.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(sp){return this.isEmpty()?sp.set(0,0,0):sp.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(tp){return this.isEmpty()?tp.set(0,0,0):tp.subVectors(this.max,this.min)}expandByPoint(up){return this.min.min(up),this.max.max(up),this}expandByVector(vp){return this.min.sub(vp),this.max.add(vp),this}expandByScalar(wp){return this.min.addScalar(-wp),this.max.addScalar(wp),this}expandByObject(xp,yp=!1){xp.updateWorldMatrix(!1,!1);let zp=xp.geometry;if(void 0!==zp)if(yp&&null!=zp.attributes&& void 0!==zp.attributes.position){let Ap=zp.attributes.position;for(let Bp=0,Cp=Ap.count;Bp<Cp;Bp++)_p.fromBufferAttribute(Ap,Bp).applyMatrix4(xp.matrixWorld),this.expandByPoint(_p)}else null===zp.boundingBox&&zp.computeBoundingBox(),aq.copy(zp.boundingBox),aq.applyMatrix4(xp.matrixWorld),this.union(aq);let Dp=xp.children;for(let Ep=0,Fp=Dp.length;Ep<Fp;Ep++)this.expandByObject(Dp[Ep],yp);return this}containsPoint(Gp){return!(Gp.x<this.min.x||Gp.x>this.max.x||Gp.y<this.min.y||Gp.y>this.max.y||Gp.z<this.min.z||Gp.z>this.max.z)}containsBox(Hp){return this.min.x<=Hp.min.x&&Hp.max.x<=this.max.x&&this.min.y<=Hp.min.y&&Hp.max.y<=this.max.y&&this.min.z<=Hp.min.z&&Hp.max.z<=this.max.z}getParameter(Ip,Jp){return Jp.set((Ip.x-this.min.x)/(this.max.x-this.min.x),(Ip.y-this.min.y)/(this.max.y-this.min.y),(Ip.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(Kp){return!(Kp.max.x<this.min.x||Kp.min.x>this.max.x||Kp.max.y<this.min.y||Kp.min.y>this.max.y||Kp.max.z<this.min.z||Kp.min.z>this.max.z)}intersectsSphere(Lp){return this.clampPoint(Lp.center,_p),_p.distanceToSquared(Lp.center)<=Lp.radius*Lp.radius}intersectsPlane(Mp){let Np,Op;return Mp.normal.x>0?(Np=Mp.normal.x*this.min.x,Op=Mp.normal.x*this.max.x):(Np=Mp.normal.x*this.max.x,Op=Mp.normal.x*this.min.x),Mp.normal.y>0?(Np+=Mp.normal.y*this.min.y,Op+=Mp.normal.y*this.max.y):(Np+=Mp.normal.y*this.max.y,Op+=Mp.normal.y*this.min.y),Mp.normal.z>0?(Np+=Mp.normal.z*this.min.z,Op+=Mp.normal.z*this.max.z):(Np+=Mp.normal.z*this.max.z,Op+=Mp.normal.z*this.min.z),Np<= -Mp.constant&&Op>= -Mp.constant}intersectsTriangle(Pp){if(this.isEmpty())return!1;this.getCenter(hq),iq.subVectors(this.max,hq),bq.subVectors(Pp.a,hq),cq.subVectors(Pp.b,hq),dq.subVectors(Pp.c,hq),eq.subVectors(cq,bq),fq.subVectors(dq,cq),gq.subVectors(bq,dq);let Qp=[0,-eq.z,eq.y,0,-fq.z,fq.y,0,-gq.z,gq.y,eq.z,0,-eq.x,fq.z,0,-fq.x,gq.z,0,-gq.x,-eq.y,eq.x,0,-fq.y,fq.x,0,-gq.y,gq.x,0];return!!(lq(Qp,bq,cq,dq,iq)&&lq(Qp=[1,0,0,0,1,0,0,0,1],bq,cq,dq,iq))&&(jq.crossVectors(eq,fq),lq(Qp=[jq.x,jq.y,jq.z],bq,cq,dq,iq))}clampPoint(Rp,Sp){return Sp.copy(Rp).clamp(this.min,this.max)}distanceToPoint(Tp){return _p.copy(Tp).clamp(this.min,this.max).sub(Tp).length()}getBoundingSphere(Up){return this.getCenter(Up.center),Up.radius=.5*this.getSize(_p).length(),Up}intersect(Vp){return this.min.max(Vp.min),this.max.min(Vp.max),this.isEmpty()&&this.makeEmpty(),this}union(Wp){return this.min.min(Wp.min),this.max.max(Wp.max),this}applyMatrix4(Xp){return this.isEmpty()||($p[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(Xp),$p[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(Xp),$p[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(Xp),$p[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(Xp),$p[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(Xp),$p[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(Xp),$p[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(Xp),$p[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(Xp),this.setFromPoints($p)),this}translate(Yp){return this.min.add(Yp),this.max.add(Yp),this}equals(Zp){return Zp.min.equals(this.min)&&Zp.max.equals(this.max)}},$p=[new fm,new fm,new fm,new fm,new fm,new fm,new fm,new fm],_p=new fm,aq=new Io,bq=new fm,cq=new fm,dq=new fm,eq=new fm,fq=new fm,gq=new fm,hq=new fm,iq=new fm,jq=new fm,kq=new fm;function lq(a,b,c,d,e){for(let f=0,g=a.length-3;f<=g;f+=3){kq.fromArray(a,f);let h=e.x*Math.abs(kq.x)+e.y*Math.abs(kq.y)+e.z*Math.abs(kq.z),i=b.dot(kq),j=c.dot(kq),k=d.dot(kq);if(Math.max(-Math.max(i,j,k),Math.min(i,j,k))>h)return!1}return!0}var mq=new Io,nq=new fm,oq=new fm,pq=class{constructor(qq=new fm,rq=-1){this.center=qq,this.radius=rq}set(sq,tq){return this.center.copy(sq),this.radius=tq,this}setFromPoints(uq,vq){let wq=this.center;void 0!==vq?wq.copy(vq):mq.setFromPoints(uq).getCenter(wq);let xq=0;for(let yq=0,zq=uq.length;yq<zq;yq++)xq=Math.max(xq,wq.distanceToSquared(uq[yq]));return this.radius=Math.sqrt(xq),this}copy(Aq){return this.center.copy(Aq.center),this.radius=Aq.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(Bq){return Bq.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(Cq){return Cq.distanceTo(this.center)-this.radius}intersectsSphere(Dq){let Eq=this.radius+Dq.radius;return Dq.center.distanceToSquared(this.center)<=Eq*Eq}intersectsBox(Fq){return Fq.intersectsSphere(this)}intersectsPlane(Gq){return Math.abs(Gq.distanceToPoint(this.center))<=this.radius}clampPoint(Hq,Iq){let Jq=this.center.distanceToSquared(Hq);return Iq.copy(Hq),Jq>this.radius*this.radius&&(Iq.sub(this.center).normalize(),Iq.multiplyScalar(this.radius).add(this.center)),Iq}getBoundingBox(Kq){return this.isEmpty()?(Kq.makeEmpty(),Kq):(Kq.set(this.center,this.center),Kq.expandByScalar(this.radius),Kq)}applyMatrix4(Lq){return this.center.applyMatrix4(Lq),this.radius=this.radius*Lq.getMaxScaleOnAxis(),this}translate(Mq){return this.center.add(Mq),this}expandByPoint(Nq){if(this.isEmpty())return this.center.copy(Nq),this.radius=0,this;nq.subVectors(Nq,this.center);let Oq=nq.lengthSq();if(Oq>this.radius*this.radius){let Pq=Math.sqrt(Oq),Qq=(Pq-this.radius)*.5;this.center.addScaledVector(nq,Qq/Pq),this.radius+=Qq}return this}union(Rq){return Rq.isEmpty()?this:this.isEmpty()?(this.copy(Rq),this):(!0===this.center.equals(Rq.center)?this.radius=Math.max(this.radius,Rq.radius):(oq.subVectors(Rq.center,this.center).setLength(Rq.radius),this.expandByPoint(nq.copy(Rq.center).add(oq)),this.expandByPoint(nq.copy(Rq.center).sub(oq))),this)}equals(Sq){return Sq.center.equals(this.center)&&Sq.radius===this.radius}clone(){return new this.constructor().copy(this)}},Tq=new fm,Uq=new fm,Vq=new fm,Wq=new fm,Xq=new fm,Yq=new fm,Zq=new fm,$q=class{constructor(_q=new fm,ar=new fm(0,0,-1)){this.origin=_q,this.direction=ar}set(br,cr){return this.origin.copy(br),this.direction.copy(cr),this}copy(dr){return this.origin.copy(dr.origin),this.direction.copy(dr.direction),this}at(er,fr){return fr.copy(this.direction).multiplyScalar(er).add(this.origin)}lookAt(gr){return this.direction.copy(gr).sub(this.origin).normalize(),this}recast(hr){return this.origin.copy(this.at(hr,Tq)),this}closestPointToPoint(ir,jr){jr.subVectors(ir,this.origin);let kr=jr.dot(this.direction);return kr<0?jr.copy(this.origin):jr.copy(this.direction).multiplyScalar(kr).add(this.origin)}distanceToPoint(lr){return Math.sqrt(this.distanceSqToPoint(lr))}distanceSqToPoint(mr){let nr=Tq.subVectors(mr,this.origin).dot(this.direction);return nr<0?this.origin.distanceToSquared(mr):(Tq.copy(this.direction).multiplyScalar(nr).add(this.origin),Tq.distanceToSquared(mr))}distanceSqToSegment(or,pr,qr,rr){Uq.copy(or).add(pr).multiplyScalar(.5),Vq.copy(pr).sub(or).normalize(),Wq.copy(this.origin).sub(Uq);let sr=.5*or.distanceTo(pr),tr=-this.direction.dot(Vq),ur=Wq.dot(this.direction),vr=-Wq.dot(Vq),wr=Wq.lengthSq(),xr=Math.abs(1-tr*tr),yr,zr,Ar,Br;if(xr>0)if(yr=tr*vr-ur,zr=tr*ur-vr,Br=sr*xr,yr>=0)if(zr>= -Br)if(zr<=Br){let Cr=1/xr;yr*=Cr,zr*=Cr,Ar=yr*(yr+tr*zr+2*ur)+zr*(tr*yr+zr+2*vr)+wr}else Ar=-(yr=Math.max(0,-(tr*(zr=sr)+ur)))*yr+zr*(zr+2*vr)+wr;else Ar=-(yr=Math.max(0,-(tr*(zr=-sr)+ur)))*yr+zr*(zr+2*vr)+wr;else zr<= -Br?(zr=(yr=Math.max(0,-(-tr*sr+ur)))>0?-sr:Math.min(Math.max(-sr,-vr),sr),Ar=-yr*yr+zr*(zr+2*vr)+wr):zr<=Br?(yr=0,Ar=(zr=Math.min(Math.max(-sr,-vr),sr))*(zr+2*vr)+wr):(zr=(yr=Math.max(0,-(tr*sr+ur)))>0?sr:Math.min(Math.max(-sr,-vr),sr),Ar=-yr*yr+zr*(zr+2*vr)+wr);else zr=tr>0?-sr:sr,yr=Math.max(0,-(tr*zr+ur)),Ar=-yr*yr+zr*(zr+2*vr)+wr;return qr&&qr.copy(this.direction).multiplyScalar(yr).add(this.origin),rr&&rr.copy(Vq).multiplyScalar(zr).add(Uq),Ar}intersectSphere(Dr,Er){Tq.subVectors(Dr.center,this.origin);let Fr=Tq.dot(this.direction),Gr=Tq.dot(Tq)-Fr*Fr,Hr=Dr.radius*Dr.radius;if(Gr>Hr)return null;let Ir=Math.sqrt(Hr-Gr),Jr=Fr-Ir,Kr=Fr+Ir;return Jr<0&&Kr<0?null:Jr<0?this.at(Kr,Er):this.at(Jr,Er)}intersectsSphere(Lr){return this.distanceSqToPoint(Lr.center)<=Lr.radius*Lr.radius}distanceToPlane(Mr){let Nr=Mr.normal.dot(this.direction);if(0===Nr)return 0===Mr.distanceToPoint(this.origin)?0:null;let Or=-(this.origin.dot(Mr.normal)+Mr.constant)/Nr;return Or>=0?Or:null}intersectPlane(Pr,Qr){let Rr=this.distanceToPlane(Pr);return null===Rr?null:this.at(Rr,Qr)}intersectsPlane(Sr){let Tr=Sr.distanceToPoint(this.origin);return 0===Tr||Sr.normal.dot(this.direction)*Tr<0}intersectBox(Ur,Vr){let Wr,Xr,Yr,Zr,$r,_r,as=1/this.direction.x,bs=1/this.direction.y,cs=1/this.direction.z,ds=this.origin;return as>=0?(Wr=(Ur.min.x-ds.x)*as,Xr=(Ur.max.x-ds.x)*as):(Wr=(Ur.max.x-ds.x)*as,Xr=(Ur.min.x-ds.x)*as),bs>=0?(Yr=(Ur.min.y-ds.y)*bs,Zr=(Ur.max.y-ds.y)*bs):(Yr=(Ur.max.y-ds.y)*bs,Zr=(Ur.min.y-ds.y)*bs),Wr>Zr||Yr>Xr||((Yr>Wr||isNaN(Wr))&&(Wr=Yr),(Zr<Xr||isNaN(Xr))&&(Xr=Zr),cs>=0?($r=(Ur.min.z-ds.z)*cs,_r=(Ur.max.z-ds.z)*cs):($r=(Ur.max.z-ds.z)*cs,_r=(Ur.min.z-ds.z)*cs),Wr>_r||$r>Xr)||(($r>Wr||Wr!=Wr)&&(Wr=$r),(_r<Xr||Xr!=Xr)&&(Xr=_r),Xr<0)?null:this.at(Wr>=0?Wr:Xr,Vr)}intersectsBox(es){return null!==this.intersectBox(es,Tq)}intersectTriangle(fs,gs,hs,is,js){Xq.subVectors(gs,fs),Yq.subVectors(hs,fs),Zq.crossVectors(Xq,Yq);let ks=this.direction.dot(Zq),ls;if(ks>0){if(is)return null;ls=1}else{if(!(ks<0))return null;ls=-1,ks=-ks}Wq.subVectors(this.origin,fs);let ms=ls*this.direction.dot(Yq.crossVectors(Wq,Yq));if(ms<0)return null;let ns=ls*this.direction.dot(Xq.cross(Wq));if(ns<0||ms+ns>ks)return null;let os=-ls*Wq.dot(Zq);return os<0?null:this.at(os/ks,js)}applyMatrix4(ps){return this.origin.applyMatrix4(ps),this.direction.transformDirection(ps),this}equals(qs){return qs.origin.equals(this.origin)&&qs.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},rs=class{constructor(){rs.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(ss,ts,us,vs,ws,xs,ys,zs,As,Bs,Cs,Ds,Es,Fs,Gs,Hs){let Is=this.elements;return Is[0]=ss,Is[4]=ts,Is[8]=us,Is[12]=vs,Is[1]=ws,Is[5]=xs,Is[9]=ys,Is[13]=zs,Is[2]=As,Is[6]=Bs,Is[10]=Cs,Is[14]=Ds,Is[3]=Es,Is[7]=Fs,Is[11]=Gs,Is[15]=Hs,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new rs().fromArray(this.elements)}copy(Js){let Ks=this.elements,Ls=Js.elements;return Ks[0]=Ls[0],Ks[1]=Ls[1],Ks[2]=Ls[2],Ks[3]=Ls[3],Ks[4]=Ls[4],Ks[5]=Ls[5],Ks[6]=Ls[6],Ks[7]=Ls[7],Ks[8]=Ls[8],Ks[9]=Ls[9],Ks[10]=Ls[10],Ks[11]=Ls[11],Ks[12]=Ls[12],Ks[13]=Ls[13],Ks[14]=Ls[14],Ks[15]=Ls[15],this}copyPosition(Ms){let Ns=this.elements,Os=Ms.elements;return Ns[12]=Os[12],Ns[13]=Os[13],Ns[14]=Os[14],this}setFromMatrix3(Ps){let Qs=Ps.elements;return this.set(Qs[0],Qs[3],Qs[6],0,Qs[1],Qs[4],Qs[7],0,Qs[2],Qs[5],Qs[8],0,0,0,0,1),this}extractBasis(Rs,Ss,Ts){return Rs.setFromMatrixColumn(this,0),Ss.setFromMatrixColumn(this,1),Ts.setFromMatrixColumn(this,2),this}makeBasis(Us,Vs,Ws){return this.set(Us.x,Vs.x,Ws.x,0,Us.y,Vs.y,Ws.y,0,Us.z,Vs.z,Ws.z,0,0,0,0,1),this}extractRotation(Xs){let Ys=this.elements,Zs=Xs.elements,$s=1/vx.setFromMatrixColumn(Xs,0).length(),_s=1/vx.setFromMatrixColumn(Xs,1).length(),at=1/vx.setFromMatrixColumn(Xs,2).length();return Ys[0]=Zs[0]*$s,Ys[1]=Zs[1]*$s,Ys[2]=Zs[2]*$s,Ys[3]=0,Ys[4]=Zs[4]*_s,Ys[5]=Zs[5]*_s,Ys[6]=Zs[6]*_s,Ys[7]=0,Ys[8]=Zs[8]*at,Ys[9]=Zs[9]*at,Ys[10]=Zs[10]*at,Ys[11]=0,Ys[12]=0,Ys[13]=0,Ys[14]=0,Ys[15]=1,this}makeRotationFromEuler(bt){let ct=this.elements,dt=bt.x,et=bt.y,ft=bt.z,gt=Math.cos(dt),ht=Math.sin(dt),it=Math.cos(et),jt=Math.sin(et),kt=Math.cos(ft),lt=Math.sin(ft);if("XYZ"===bt.order){let mt=gt*kt,nt=gt*lt,ot=ht*kt,pt=ht*lt;ct[0]=it*kt,ct[4]=-it*lt,ct[8]=jt,ct[1]=nt+ot*jt,ct[5]=mt-pt*jt,ct[9]=-ht*it,ct[2]=pt-mt*jt,ct[6]=ot+nt*jt,ct[10]=gt*it}else if("YXZ"===bt.order){let qt=it*kt,rt=it*lt,st=jt*kt,tt=jt*lt;ct[0]=qt+tt*ht,ct[4]=st*ht-rt,ct[8]=gt*jt,ct[1]=gt*lt,ct[5]=gt*kt,ct[9]=-ht,ct[2]=rt*ht-st,ct[6]=tt+qt*ht,ct[10]=gt*it}else if("ZXY"===bt.order){let ut=it*kt,vt=it*lt,wt=jt*kt,xt=jt*lt;ct[0]=ut-xt*ht,ct[4]=-gt*lt,ct[8]=wt+vt*ht,ct[1]=vt+wt*ht,ct[5]=gt*kt,ct[9]=xt-ut*ht,ct[2]=-gt*jt,ct[6]=ht,ct[10]=gt*it}else if("ZYX"===bt.order){let yt=gt*kt,zt=gt*lt,At=ht*kt,Bt=ht*lt;ct[0]=it*kt,ct[4]=At*jt-zt,ct[8]=yt*jt+Bt,ct[1]=it*lt,ct[5]=Bt*jt+yt,ct[9]=zt*jt-At,ct[2]=-jt,ct[6]=ht*it,ct[10]=gt*it}else if("YZX"===bt.order){let Ct=gt*it,Dt=gt*jt,Et=ht*it,Ft=ht*jt;ct[0]=it*kt,ct[4]=Ft-Ct*lt,ct[8]=Et*lt+Dt,ct[1]=lt,ct[5]=gt*kt,ct[9]=-ht*kt,ct[2]=-jt*kt,ct[6]=Dt*lt+Et,ct[10]=Ct-Ft*lt}else if("XZY"===bt.order){let Gt=gt*it,Ht=gt*jt,It=ht*it,Jt=ht*jt;ct[0]=it*kt,ct[4]=-lt,ct[8]=jt*kt,ct[1]=Gt*lt+Jt,ct[5]=gt*kt,ct[9]=Ht*lt-It,ct[2]=It*lt-Ht,ct[6]=ht*kt,ct[10]=Jt*lt+Gt}return ct[3]=0,ct[7]=0,ct[11]=0,ct[12]=0,ct[13]=0,ct[14]=0,ct[15]=1,this}makeRotationFromQuaternion(Kt){return this.compose(xx,Kt,yx)}lookAt(Lt,Mt,Nt){let Ot=this.elements;return Bx.subVectors(Lt,Mt),0===Bx.lengthSq()&&(Bx.z=1),Bx.normalize(),zx.crossVectors(Nt,Bx),0===zx.lengthSq()&&(1===Math.abs(Nt.z)?Bx.x+=1e-4:Bx.z+=1e-4,Bx.normalize(),zx.crossVectors(Nt,Bx)),zx.normalize(),Ax.crossVectors(Bx,zx),Ot[0]=zx.x,Ot[4]=Ax.x,Ot[8]=Bx.x,Ot[1]=zx.y,Ot[5]=Ax.y,Ot[9]=Bx.y,Ot[2]=zx.z,Ot[6]=Ax.z,Ot[10]=Bx.z,this}multiply(Pt){return this.multiplyMatrices(this,Pt)}premultiply(Qt){return this.multiplyMatrices(Qt,this)}multiplyMatrices(Rt,St){let Tt=Rt.elements,Ut=St.elements,Vt=this.elements,Wt=Tt[0],Xt=Tt[4],Yt=Tt[8],Zt=Tt[12],$t=Tt[1],_t=Tt[5],au=Tt[9],bu=Tt[13],cu=Tt[2],du=Tt[6],eu=Tt[10],fu=Tt[14],gu=Tt[3],hu=Tt[7],iu=Tt[11],ju=Tt[15],ku=Ut[0],lu=Ut[4],mu=Ut[8],nu=Ut[12],ou=Ut[1],pu=Ut[5],qu=Ut[9],ru=Ut[13],su=Ut[2],tu=Ut[6],uu=Ut[10],vu=Ut[14],wu=Ut[3],xu=Ut[7],yu=Ut[11],zu=Ut[15];return Vt[0]=Wt*ku+Xt*ou+Yt*su+Zt*wu,Vt[4]=Wt*lu+Xt*pu+Yt*tu+Zt*xu,Vt[8]=Wt*mu+Xt*qu+Yt*uu+Zt*yu,Vt[12]=Wt*nu+Xt*ru+Yt*vu+Zt*zu,Vt[1]=$t*ku+_t*ou+au*su+bu*wu,Vt[5]=$t*lu+_t*pu+au*tu+bu*xu,Vt[9]=$t*mu+_t*qu+au*uu+bu*yu,Vt[13]=$t*nu+_t*ru+au*vu+bu*zu,Vt[2]=cu*ku+du*ou+eu*su+fu*wu,Vt[6]=cu*lu+du*pu+eu*tu+fu*xu,Vt[10]=cu*mu+du*qu+eu*uu+fu*yu,Vt[14]=cu*nu+du*ru+eu*vu+fu*zu,Vt[3]=gu*ku+hu*ou+iu*su+ju*wu,Vt[7]=gu*lu+hu*pu+iu*tu+ju*xu,Vt[11]=gu*mu+hu*qu+iu*uu+ju*yu,Vt[15]=gu*nu+hu*ru+iu*vu+ju*zu,this}multiplyScalar(Au){let Bu=this.elements;return Bu[0]*=Au,Bu[4]*=Au,Bu[8]*=Au,Bu[12]*=Au,Bu[1]*=Au,Bu[5]*=Au,Bu[9]*=Au,Bu[13]*=Au,Bu[2]*=Au,Bu[6]*=Au,Bu[10]*=Au,Bu[14]*=Au,Bu[3]*=Au,Bu[7]*=Au,Bu[11]*=Au,Bu[15]*=Au,this}determinant(){let Cu=this.elements,Du=Cu[0],Eu=Cu[4],Fu=Cu[8],Gu=Cu[12],Hu=Cu[1],Iu=Cu[5],Ju=Cu[9],Ku=Cu[13],Lu=Cu[2],Mu=Cu[6],Nu=Cu[10],Ou=Cu[14],Pu=Cu[3],Qu=Cu[7],Ru=Cu[11],Su=Cu[15];return Pu*(+Gu*Ju*Mu-Fu*Ku*Mu-Gu*Iu*Nu+Eu*Ku*Nu+Fu*Iu*Ou-Eu*Ju*Ou)+Qu*(+Du*Ju*Ou-Du*Ku*Nu+Gu*Hu*Nu-Fu*Hu*Ou+Fu*Ku*Lu-Gu*Ju*Lu)+Ru*(+Du*Ku*Mu-Du*Iu*Ou-Gu*Hu*Mu+Eu*Hu*Ou+Gu*Iu*Lu-Eu*Ku*Lu)+Su*(-Fu*Iu*Lu-Du*Ju*Mu+Du*Iu*Nu+Fu*Hu*Mu-Eu*Hu*Nu+Eu*Ju*Lu)}transpose(){let Tu=this.elements,Uu;return Uu=Tu[1],Tu[1]=Tu[4],Tu[4]=Uu,Uu=Tu[2],Tu[2]=Tu[8],Tu[8]=Uu,Uu=Tu[6],Tu[6]=Tu[9],Tu[9]=Uu,Uu=Tu[3],Tu[3]=Tu[12],Tu[12]=Uu,Uu=Tu[7],Tu[7]=Tu[13],Tu[13]=Uu,Uu=Tu[11],Tu[11]=Tu[14],Tu[14]=Uu,this}setPosition(Vu,Wu,Xu){let Yu=this.elements;return Vu.isVector3?(Yu[12]=Vu.x,Yu[13]=Vu.y,Yu[14]=Vu.z):(Yu[12]=Vu,Yu[13]=Wu,Yu[14]=Xu),this}invert(){let Zu=this.elements,$u=Zu[0],_u=Zu[1],av=Zu[2],bv=Zu[3],cv=Zu[4],dv=Zu[5],ev=Zu[6],fv=Zu[7],gv=Zu[8],hv=Zu[9],iv=Zu[10],jv=Zu[11],kv=Zu[12],lv=Zu[13],mv=Zu[14],nv=Zu[15],ov=hv*mv*fv-lv*iv*fv+lv*ev*jv-dv*mv*jv-hv*ev*nv+dv*iv*nv,pv=kv*iv*fv-gv*mv*fv-kv*ev*jv+cv*mv*jv+gv*ev*nv-cv*iv*nv,qv=gv*lv*fv-kv*hv*fv+kv*dv*jv-cv*lv*jv-gv*dv*nv+cv*hv*nv,rv=kv*hv*ev-gv*lv*ev-kv*dv*iv+cv*lv*iv+gv*dv*mv-cv*hv*mv,sv=$u*ov+_u*pv+av*qv+bv*rv;if(0===sv)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let tv=1/sv;return Zu[0]=ov*tv,Zu[1]=(lv*iv*bv-hv*mv*bv-lv*av*jv+_u*mv*jv+hv*av*nv-_u*iv*nv)*tv,Zu[2]=(dv*mv*bv-lv*ev*bv+lv*av*fv-_u*mv*fv-dv*av*nv+_u*ev*nv)*tv,Zu[3]=(hv*ev*bv-dv*iv*bv-hv*av*fv+_u*iv*fv+dv*av*jv-_u*ev*jv)*tv,Zu[4]=pv*tv,Zu[5]=(gv*mv*bv-kv*iv*bv+kv*av*jv-$u*mv*jv-gv*av*nv+$u*iv*nv)*tv,Zu[6]=(kv*ev*bv-cv*mv*bv-kv*av*fv+$u*mv*fv+cv*av*nv-$u*ev*nv)*tv,Zu[7]=(cv*iv*bv-gv*ev*bv+gv*av*fv-$u*iv*fv-cv*av*jv+$u*ev*jv)*tv,Zu[8]=qv*tv,Zu[9]=(kv*hv*bv-gv*lv*bv-kv*_u*jv+$u*lv*jv+gv*_u*nv-$u*hv*nv)*tv,Zu[10]=(cv*lv*bv-kv*dv*bv+kv*_u*fv-$u*lv*fv-cv*_u*nv+$u*dv*nv)*tv,Zu[11]=(gv*dv*bv-cv*hv*bv-gv*_u*fv+$u*hv*fv+cv*_u*jv-$u*dv*jv)*tv,Zu[12]=rv*tv,Zu[13]=(gv*lv*av-kv*hv*av+kv*_u*iv-$u*lv*iv-gv*_u*mv+$u*hv*mv)*tv,Zu[14]=(kv*dv*av-cv*lv*av-kv*_u*ev+$u*lv*ev+cv*_u*mv-$u*dv*mv)*tv,Zu[15]=(cv*hv*av-gv*dv*av+gv*_u*ev-$u*hv*ev-cv*_u*iv+$u*dv*iv)*tv,this}scale(uv){let vv=this.elements,wv=uv.x,xv=uv.y,yv=uv.z;return vv[0]*=wv,vv[4]*=xv,vv[8]*=yv,vv[1]*=wv,vv[5]*=xv,vv[9]*=yv,vv[2]*=wv,vv[6]*=xv,vv[10]*=yv,vv[3]*=wv,vv[7]*=xv,vv[11]*=yv,this}getMaxScaleOnAxis(){let zv=this.elements,Av=zv[0]*zv[0]+zv[1]*zv[1]+zv[2]*zv[2],Bv=zv[4]*zv[4]+zv[5]*zv[5]+zv[6]*zv[6],Cv=zv[8]*zv[8]+zv[9]*zv[9]+zv[10]*zv[10];return Math.sqrt(Math.max(Av,Bv,Cv))}makeTranslation(Dv,Ev,Fv){return this.set(1,0,0,Dv,0,1,0,Ev,0,0,1,Fv,0,0,0,1),this}makeRotationX(Gv){let Hv=Math.cos(Gv),Iv=Math.sin(Gv);return this.set(1,0,0,0,0,Hv,-Iv,0,0,Iv,Hv,0,0,0,0,1),this}makeRotationY(Jv){let Kv=Math.cos(Jv),Lv=Math.sin(Jv);return this.set(Kv,0,Lv,0,0,1,0,0,-Lv,0,Kv,0,0,0,0,1),this}makeRotationZ(Mv){let Nv=Math.cos(Mv),Ov=Math.sin(Mv);return this.set(Nv,-Ov,0,0,Ov,Nv,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(Pv,Qv){let Rv=Math.cos(Qv),Sv=Math.sin(Qv),Tv=1-Rv,Uv=Pv.x,Vv=Pv.y,Wv=Pv.z,Xv=Tv*Uv,Yv=Tv*Vv;return this.set(Xv*Uv+Rv,Xv*Vv-Sv*Wv,Xv*Wv+Sv*Vv,0,Xv*Vv+Sv*Wv,Yv*Vv+Rv,Yv*Wv-Sv*Uv,0,Xv*Wv-Sv*Vv,Yv*Wv+Sv*Uv,Tv*Wv*Wv+Rv,0,0,0,0,1),this}makeScale(Zv,$v,_v){return this.set(Zv,0,0,0,0,$v,0,0,0,0,_v,0,0,0,0,1),this}makeShear(aw,bw,cw,dw,ew,fw){return this.set(1,cw,ew,0,aw,1,fw,0,bw,dw,1,0,0,0,0,1),this}compose(gw,hw,iw){let jw=this.elements,kw=hw._x,lw=hw._y,mw=hw._z,nw=hw._w,ow=kw+kw,pw=lw+lw,qw=mw+mw,rw=kw*ow,sw=kw*pw,tw=kw*qw,uw=lw*pw,vw=lw*qw,ww=mw*qw,xw=nw*ow,yw=nw*pw,zw=nw*qw,Aw=iw.x,Bw=iw.y,Cw=iw.z;return jw[0]=(1-(uw+ww))*Aw,jw[1]=(sw+zw)*Aw,jw[2]=(tw-yw)*Aw,jw[3]=0,jw[4]=(sw-zw)*Bw,jw[5]=(1-(rw+ww))*Bw,jw[6]=(vw+xw)*Bw,jw[7]=0,jw[8]=(tw+yw)*Cw,jw[9]=(vw-xw)*Cw,jw[10]=(1-(rw+uw))*Cw,jw[11]=0,jw[12]=gw.x,jw[13]=gw.y,jw[14]=gw.z,jw[15]=1,this}decompose(Dw,Ew,Fw){let Gw=this.elements,Hw=vx.set(Gw[0],Gw[1],Gw[2]).length(),Iw=vx.set(Gw[4],Gw[5],Gw[6]).length(),Jw=vx.set(Gw[8],Gw[9],Gw[10]).length();0>this.determinant()&&(Hw=-Hw),Dw.x=Gw[12],Dw.y=Gw[13],Dw.z=Gw[14],wx.copy(this);let Kw=1/Hw,Lw=1/Iw,Mw=1/Jw;return wx.elements[0]*=Kw,wx.elements[1]*=Kw,wx.elements[2]*=Kw,wx.elements[4]*=Lw,wx.elements[5]*=Lw,wx.elements[6]*=Lw,wx.elements[8]*=Mw,wx.elements[9]*=Mw,wx.elements[10]*=Mw,Ew.setFromRotationMatrix(wx),Fw.x=Hw,Fw.y=Iw,Fw.z=Jw,this}makePerspective(Nw,Ow,Pw,Qw,Rw,Sw){let Tw=this.elements,Uw=2*Rw/(Ow-Nw),Vw=2*Rw/(Pw-Qw),Ww=(Ow+Nw)/(Ow-Nw),Xw=(Pw+Qw)/(Pw-Qw),Yw=-(Sw+Rw)/(Sw-Rw),Zw=-2*Sw*Rw/(Sw-Rw);return Tw[0]=Uw,Tw[4]=0,Tw[8]=Ww,Tw[12]=0,Tw[1]=0,Tw[5]=Vw,Tw[9]=Xw,Tw[13]=0,Tw[2]=0,Tw[6]=0,Tw[10]=Yw,Tw[14]=Zw,Tw[3]=0,Tw[7]=0,Tw[11]=-1,Tw[15]=0,this}makeOrthographic($w,_w,ax,bx,cx,dx){let ex=this.elements,fx=1/(_w-$w),gx=1/(ax-bx),hx=1/(dx-cx),ix=(_w+$w)*fx,jx=(ax+bx)*gx,kx=(dx+cx)*hx;return ex[0]=2*fx,ex[4]=0,ex[8]=0,ex[12]=-ix,ex[1]=0,ex[5]=2*gx,ex[9]=0,ex[13]=-jx,ex[2]=0,ex[6]=0,ex[10]=-2*hx,ex[14]=-kx,ex[3]=0,ex[7]=0,ex[11]=0,ex[15]=1,this}equals(lx){let mx=this.elements,nx=lx.elements;for(let ox=0;ox<16;ox++)if(mx[ox]!==nx[ox])return!1;return!0}fromArray(px,qx=0){for(let rx=0;rx<16;rx++)this.elements[rx]=px[rx+qx];return this}toArray(sx=[],tx=0){let ux=this.elements;return sx[tx]=ux[0],sx[tx+1]=ux[1],sx[tx+2]=ux[2],sx[tx+3]=ux[3],sx[tx+4]=ux[4],sx[tx+5]=ux[5],sx[tx+6]=ux[6],sx[tx+7]=ux[7],sx[tx+8]=ux[8],sx[tx+9]=ux[9],sx[tx+10]=ux[10],sx[tx+11]=ux[11],sx[tx+12]=ux[12],sx[tx+13]=ux[13],sx[tx+14]=ux[14],sx[tx+15]=ux[15],sx}},vx=new fm,wx=new rs,xx=new fm(0,0,0),yx=new fm(1,1,1),zx=new fm,Ax=new fm,Bx=new fm,Cx=new rs,Dx=new Fj,Ex=class{constructor(Fx=0,Gx=0,Hx=0,Ix=Ex.DEFAULT_ORDER){this.isEuler=!0,this._x=Fx,this._y=Gx,this._z=Hx,this._order=Ix}get x(){return this._x}set x(Jx){this._x=Jx,this._onChangeCallback()}get y(){return this._y}set y(Kx){this._y=Kx,this._onChangeCallback()}get z(){return this._z}set z(Lx){this._z=Lx,this._onChangeCallback()}get order(){return this._order}set order(Mx){this._order=Mx,this._onChangeCallback()}set(Nx,Ox,Px,Qx=this._order){return this._x=Nx,this._y=Ox,this._z=Px,this._order=Qx,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(Rx){return this._x=Rx._x,this._y=Rx._y,this._z=Rx._z,this._order=Rx._order,this._onChangeCallback(),this}setFromRotationMatrix(Sx,Tx=this._order,Ux=!0){let Vx=Sx.elements,Wx=Vx[0],Xx=Vx[4],Yx=Vx[8],Zx=Vx[1],$x=Vx[5],_x=Vx[9],ay=Vx[2],by=Vx[6],cy=Vx[10];switch(Tx){case"XYZ":this._y=Math.asin(vb(Yx,-1,1)),.9999999>Math.abs(Yx)?(this._x=Math.atan2(-_x,cy),this._z=Math.atan2(-Xx,Wx)):(this._x=Math.atan2(by,$x),this._z=0);break;case"YXZ":this._x=Math.asin(-vb(_x,-1,1)),.9999999>Math.abs(_x)?(this._y=Math.atan2(Yx,cy),this._z=Math.atan2(Zx,$x)):(this._y=Math.atan2(-ay,Wx),this._z=0);break;case"ZXY":this._x=Math.asin(vb(by,-1,1)),.9999999>Math.abs(by)?(this._y=Math.atan2(-ay,cy),this._z=Math.atan2(-Xx,$x)):(this._y=0,this._z=Math.atan2(Zx,Wx));break;case"ZYX":this._y=Math.asin(-vb(ay,-1,1)),.9999999>Math.abs(ay)?(this._x=Math.atan2(by,cy),this._z=Math.atan2(Zx,Wx)):(this._x=0,this._z=Math.atan2(-Xx,$x));break;case"YZX":this._z=Math.asin(vb(Zx,-1,1)),.9999999>Math.abs(Zx)?(this._x=Math.atan2(-_x,$x),this._y=Math.atan2(-ay,Wx)):(this._x=0,this._y=Math.atan2(Yx,cy));break;case"XZY":this._z=Math.asin(-vb(Xx,-1,1)),.9999999>Math.abs(Xx)?(this._x=Math.atan2(by,$x),this._y=Math.atan2(Yx,Wx)):(this._x=Math.atan2(-_x,cy),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+Tx)}return this._order=Tx,!0===Ux&&this._onChangeCallback(),this}setFromQuaternion(dy,ey,fy){return Cx.makeRotationFromQuaternion(dy),this.setFromRotationMatrix(Cx,ey,fy)}setFromVector3(gy,hy=this._order){return this.set(gy.x,gy.y,gy.z,hy)}reorder(iy){return Dx.setFromEuler(this),this.setFromQuaternion(Dx,iy)}equals(jy){return jy._x===this._x&&jy._y===this._y&&jy._z===this._z&&jy._order===this._order}fromArray(ky){return this._x=ky[0],this._y=ky[1],this._z=ky[2],void 0!==ky[3]&&(this._order=ky[3]),this._onChangeCallback(),this}toArray(ly=[],my=0){return ly[my]=this._x,ly[my+1]=this._y,ly[my+2]=this._z,ly[my+3]=this._order,ly}_onChange(ny){return this._onChangeCallback=ny,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Ex.DEFAULT_ORDER="XYZ";var oy=class{constructor(){this.mask=1}set(py){this.mask=(1<<py|0)>>>0}enable(qy){this.mask|=1<<qy|0}enableAll(){this.mask=-1}toggle(ry){this.mask^=1<<ry|0}disable(sy){this.mask&=~(1<<sy|0)}disableAll(){this.mask=0}test(ty){return(this.mask&ty.mask)!=0}isEnabled(uy){return(this.mask&(1<<uy|0))!=0}},vy=0,wy=new fm,xy=new Fj,yy=new rs,zy=new fm,Ay=new fm,By=new fm,Cy=new Fj,Dy=new fm(1,0,0),Ey=new fm(0,1,0),Fy=new fm(0,0,1),Gy={type:"added"},Hy={type:"removed"},Iy=class extends ab{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:vy++}),this.uuid=ub(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Iy.DEFAULT_UP.clone();let Jy=new fm,Ky=new Ex,Ly=new Fj,My=new fm(1,1,1);Ky._onChange(function(){Ly.setFromEuler(Ky,!1)}),Ly._onChange(function(){Ky.setFromQuaternion(Ly,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:Jy},rotation:{configurable:!0,enumerable:!0,value:Ky},quaternion:{configurable:!0,enumerable:!0,value:Ly},scale:{configurable:!0,enumerable:!0,value:My},modelViewMatrix:{value:new rs},normalMatrix:{value:new Rc}}),this.matrix=new rs,this.matrixWorld=new rs,this.matrixAutoUpdate=Iy.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Iy.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new oy,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(Ny){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(Ny),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(Oy){return this.quaternion.premultiply(Oy),this}setRotationFromAxisAngle(Py,Qy){this.quaternion.setFromAxisAngle(Py,Qy)}setRotationFromEuler(Ry){this.quaternion.setFromEuler(Ry,!0)}setRotationFromMatrix(Sy){this.quaternion.setFromRotationMatrix(Sy)}setRotationFromQuaternion(Ty){this.quaternion.copy(Ty)}rotateOnAxis(Uy,Vy){return xy.setFromAxisAngle(Uy,Vy),this.quaternion.multiply(xy),this}rotateOnWorldAxis(Wy,Xy){return xy.setFromAxisAngle(Wy,Xy),this.quaternion.premultiply(xy),this}rotateX(Yy){return this.rotateOnAxis(Dy,Yy)}rotateY(Zy){return this.rotateOnAxis(Ey,Zy)}rotateZ($y){return this.rotateOnAxis(Fy,$y)}translateOnAxis(_y,az){return wy.copy(_y).applyQuaternion(this.quaternion),this.position.add(wy.multiplyScalar(az)),this}translateX(bz){return this.translateOnAxis(Dy,bz)}translateY(cz){return this.translateOnAxis(Ey,cz)}translateZ(dz){return this.translateOnAxis(Fy,dz)}localToWorld(ez){return this.updateWorldMatrix(!0,!1),ez.applyMatrix4(this.matrixWorld)}worldToLocal(fz){return this.updateWorldMatrix(!0,!1),fz.applyMatrix4(yy.copy(this.matrixWorld).invert())}lookAt(gz,hz,iz){gz.isVector3?zy.copy(gz):zy.set(gz,hz,iz);let jz=this.parent;this.updateWorldMatrix(!0,!1),Ay.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?yy.lookAt(Ay,zy,this.up):yy.lookAt(zy,Ay,this.up),this.quaternion.setFromRotationMatrix(yy),jz&&(yy.extractRotation(jz.matrixWorld),xy.setFromRotationMatrix(yy),this.quaternion.premultiply(xy.invert()))}add(kz){if(arguments.length>1){for(let lz=0;lz<arguments.length;lz++)this.add(arguments[lz]);return this}return kz===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",kz),this):(kz&&kz.isObject3D?(null!==kz.parent&&kz.parent.remove(kz),kz.parent=this,this.children.push(kz),kz.dispatchEvent(Gy)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",kz),this)}remove(mz){if(arguments.length>1){for(let nz=0;nz<arguments.length;nz++)this.remove(arguments[nz]);return this}let oz=this.children.indexOf(mz);return -1!==oz&&(mz.parent=null,this.children.splice(oz,1),mz.dispatchEvent(Hy)),this}removeFromParent(){let pz=this.parent;return null!==pz&&pz.remove(this),this}clear(){for(let qz=0;qz<this.children.length;qz++){let rz=this.children[qz];rz.parent=null,rz.dispatchEvent(Hy)}return this.children.length=0,this}attach(sz){return this.updateWorldMatrix(!0,!1),yy.copy(this.matrixWorld).invert(),null!==sz.parent&&(sz.parent.updateWorldMatrix(!0,!1),yy.multiply(sz.parent.matrixWorld)),sz.applyMatrix4(yy),this.add(sz),sz.updateWorldMatrix(!1,!0),this}getObjectById(tz){return this.getObjectByProperty("id",tz)}getObjectByName(uz){return this.getObjectByProperty("name",uz)}getObjectByProperty(vz,wz){if(this[vz]===wz)return this;for(let xz=0,yz=this.children.length;xz<yz;xz++){let zz=this.children[xz].getObjectByProperty(vz,wz);if(void 0!==zz)return zz}}getObjectsByProperty(Az,Bz){let Cz=[];this[Az]===Bz&&Cz.push(this);for(let Dz=0,Ez=this.children.length;Dz<Ez;Dz++){let Fz=this.children[Dz].getObjectsByProperty(Az,Bz);Fz.length>0&&(Cz=Cz.concat(Fz))}return Cz}getWorldPosition(Gz){return this.updateWorldMatrix(!0,!1),Gz.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(Hz){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ay,Hz,By),Hz}getWorldScale(Iz){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ay,Cy,Iz),Iz}getWorldDirection(Jz){this.updateWorldMatrix(!0,!1);let Kz=this.matrixWorld.elements;return Jz.set(Kz[8],Kz[9],Kz[10]).normalize()}raycast(){}traverse(Lz){Lz(this);let Mz=this.children;for(let Nz=0,Oz=Mz.length;Nz<Oz;Nz++)Mz[Nz].traverse(Lz)}traverseVisible(Pz){if(!1===this.visible)return;Pz(this);let Qz=this.children;for(let Rz=0,Sz=Qz.length;Rz<Sz;Rz++)Qz[Rz].traverseVisible(Pz)}traverseAncestors(Tz){let Uz=this.parent;null!==Uz&&(Tz(Uz),Uz.traverseAncestors(Tz))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(Vz){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||Vz)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,Vz=!0);let Wz=this.children;for(let Xz=0,Yz=Wz.length;Xz<Yz;Xz++){let Zz=Wz[Xz];(!0===Zz.matrixWorldAutoUpdate|| !0===Vz)&&Zz.updateMatrixWorld(Vz)}}updateWorldMatrix($z,_z){let aA=this.parent;if(!0===$z&&null!==aA&& !0===aA.matrixWorldAutoUpdate&&aA.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===_z){let bA=this.children;for(let cA=0,dA=bA.length;cA<dA;cA++){let eA=bA[cA];!0===eA.matrixWorldAutoUpdate&&eA.updateWorldMatrix(!1,!0)}}}toJSON(fA){let gA=void 0===fA||"string"==typeof fA,hA={};gA&&(fA={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},hA.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let iA={};function jA(a,b){return void 0===a[b.uuid]&&(a[b.uuid]=b.toJSON(fA)),b.uuid}if(iA.uuid=this.uuid,iA.type=this.type,""!==this.name&&(iA.name=this.name),!0===this.castShadow&&(iA.castShadow=!0),!0===this.receiveShadow&&(iA.receiveShadow=!0),!1===this.visible&&(iA.visible=!1),!1===this.frustumCulled&&(iA.frustumCulled=!1),0!==this.renderOrder&&(iA.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(iA.userData=this.userData),iA.layers=this.layers.mask,iA.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(iA.matrixAutoUpdate=!1),this.isInstancedMesh&&(iA.type="InstancedMesh",iA.count=this.count,iA.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(iA.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?iA.background=this.background.toJSON():this.background.isTexture&&(iA.background=this.background.toJSON(fA).uuid)),this.environment&&this.environment.isTexture&& !0!==this.environment.isRenderTargetTexture&&(iA.environment=this.environment.toJSON(fA).uuid);else if(this.isMesh||this.isLine||this.isPoints){iA.geometry=jA(fA.geometries,this.geometry);let kA=this.geometry.parameters;if(void 0!==kA&& void 0!==kA.shapes){let lA=kA.shapes;if(Array.isArray(lA))for(let mA=0,nA=lA.length;mA<nA;mA++){let oA=lA[mA];jA(fA.shapes,oA)}else jA(fA.shapes,lA)}}if(this.isSkinnedMesh&&(iA.bindMode=this.bindMode,iA.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(jA(fA.skeletons,this.skeleton),iA.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){let pA=[];for(let qA=0,rA=this.material.length;qA<rA;qA++)pA.push(jA(fA.materials,this.material[qA]));iA.material=pA}else iA.material=jA(fA.materials,this.material);if(this.children.length>0){iA.children=[];for(let sA=0;sA<this.children.length;sA++)iA.children.push(this.children[sA].toJSON(fA).object)}if(this.animations.length>0){iA.animations=[];for(let tA=0;tA<this.animations.length;tA++){let uA=this.animations[tA];iA.animations.push(jA(fA.animations,uA))}}if(gA){let vA=DA(fA.geometries),wA=DA(fA.materials),xA=DA(fA.textures),yA=DA(fA.images),zA=DA(fA.shapes),AA=DA(fA.skeletons),BA=DA(fA.animations),CA=DA(fA.nodes);vA.length>0&&(hA.geometries=vA),wA.length>0&&(hA.materials=wA),xA.length>0&&(hA.textures=xA),yA.length>0&&(hA.images=yA),zA.length>0&&(hA.shapes=zA),AA.length>0&&(hA.skeletons=AA),BA.length>0&&(hA.animations=BA),CA.length>0&&(hA.nodes=CA)}return hA.object=iA,hA;function DA(a){let b=[];for(let c in a){let d=a[c];delete d.metadata,b.push(d)}return b}}clone(EA){return new this.constructor().copy(this,EA)}copy(FA,GA=!0){if(this.name=FA.name,this.up.copy(FA.up),this.position.copy(FA.position),this.rotation.order=FA.rotation.order,this.quaternion.copy(FA.quaternion),this.scale.copy(FA.scale),this.matrix.copy(FA.matrix),this.matrixWorld.copy(FA.matrixWorld),this.matrixAutoUpdate=FA.matrixAutoUpdate,this.matrixWorldNeedsUpdate=FA.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=FA.matrixWorldAutoUpdate,this.layers.mask=FA.layers.mask,this.visible=FA.visible,this.castShadow=FA.castShadow,this.receiveShadow=FA.receiveShadow,this.frustumCulled=FA.frustumCulled,this.renderOrder=FA.renderOrder,this.userData=JSON.parse(JSON.stringify(FA.userData)),!0===GA)for(let HA=0;HA<FA.children.length;HA++){let IA=FA.children[HA];this.add(IA.clone())}return this}};Iy.DEFAULT_UP=new fm(0,1,0),Iy.DEFAULT_MATRIX_AUTO_UPDATE=!0,Iy.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var JA=new fm,KA=new fm,LA=new fm,MA=new fm,NA=new fm,OA=new fm,PA=new fm,QA=new fm,RA=new fm,SA=new fm,TA=class{constructor(UA=new fm,VA=new fm,WA=new fm){this.a=UA,this.b=VA,this.c=WA}static getNormal(XA,YA,ZA,$A){$A.subVectors(ZA,YA),JA.subVectors(XA,YA),$A.cross(JA);let _A=$A.lengthSq();return _A>0?$A.multiplyScalar(1/Math.sqrt(_A)):$A.set(0,0,0)}static getBarycoord(aB,bB,cB,dB,eB){JA.subVectors(dB,bB),KA.subVectors(cB,bB),LA.subVectors(aB,bB);let fB=JA.dot(JA),gB=JA.dot(KA),hB=JA.dot(LA),iB=KA.dot(KA),jB=KA.dot(LA),kB=fB*iB-gB*gB;if(0===kB)return eB.set(-2,-1,-1);let lB=1/kB,mB=(iB*hB-gB*jB)*lB,nB=(fB*jB-gB*hB)*lB;return eB.set(1-mB-nB,nB,mB)}static containsPoint(oB,pB,qB,rB){return this.getBarycoord(oB,pB,qB,rB,MA),MA.x>=0&&MA.y>=0&&MA.x+MA.y<=1}static getUV(sB,tB,uB,vB,wB,xB,yB,zB){return this.getBarycoord(sB,tB,uB,vB,MA),zB.set(0,0),zB.addScaledVector(wB,MA.x),zB.addScaledVector(xB,MA.y),zB.addScaledVector(yB,MA.z),zB}static isFrontFacing(AB,BB,CB,DB){return JA.subVectors(CB,BB),KA.subVectors(AB,BB),0>JA.cross(KA).dot(DB)}set(EB,FB,GB){return this.a.copy(EB),this.b.copy(FB),this.c.copy(GB),this}setFromPointsAndIndices(HB,IB,JB,KB){return this.a.copy(HB[IB]),this.b.copy(HB[JB]),this.c.copy(HB[KB]),this}setFromAttributeAndIndices(LB,MB,NB,OB){return this.a.fromBufferAttribute(LB,MB),this.b.fromBufferAttribute(LB,NB),this.c.fromBufferAttribute(LB,OB),this}clone(){return new this.constructor().copy(this)}copy(PB){return this.a.copy(PB.a),this.b.copy(PB.b),this.c.copy(PB.c),this}getArea(){return JA.subVectors(this.c,this.b),KA.subVectors(this.a,this.b),.5*JA.cross(KA).length()}getMidpoint(QB){return QB.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(RB){return TA.getNormal(this.a,this.b,this.c,RB)}getPlane(SB){return SB.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(TB,UB){return TA.getBarycoord(TB,this.a,this.b,this.c,UB)}getUV(VB,WB,XB,YB,ZB){return TA.getUV(VB,this.a,this.b,this.c,WB,XB,YB,ZB)}containsPoint($B){return TA.containsPoint($B,this.a,this.b,this.c)}isFrontFacing(_B){return TA.isFrontFacing(this.a,this.b,this.c,_B)}intersectsBox(aC){return aC.intersectsTriangle(this)}closestPointToPoint(bC,cC){let dC=this.a,eC=this.b,fC=this.c,gC,hC;NA.subVectors(eC,dC),OA.subVectors(fC,dC),QA.subVectors(bC,dC);let iC=NA.dot(QA),jC=OA.dot(QA);if(iC<=0&&jC<=0)return cC.copy(dC);RA.subVectors(bC,eC);let kC=NA.dot(RA),lC=OA.dot(RA);if(kC>=0&&lC<=kC)return cC.copy(eC);let mC=iC*lC-kC*jC;if(mC<=0&&iC>=0&&kC<=0)return gC=iC/(iC-kC),cC.copy(dC).addScaledVector(NA,gC);SA.subVectors(bC,fC);let nC=NA.dot(SA),oC=OA.dot(SA);if(oC>=0&&nC<=oC)return cC.copy(fC);let pC=nC*jC-iC*oC;if(pC<=0&&jC>=0&&oC<=0)return hC=jC/(jC-oC),cC.copy(dC).addScaledVector(OA,hC);let qC=kC*oC-nC*lC;if(qC<=0&&lC-kC>=0&&nC-oC>=0)return PA.subVectors(fC,eC),hC=(lC-kC)/(lC-kC+(nC-oC)),cC.copy(eC).addScaledVector(PA,hC);let rC=1/(qC+pC+mC);return gC=pC*rC,hC=mC*rC,cC.copy(dC).addScaledVector(NA,gC).addScaledVector(OA,hC)}equals(sC){return sC.a.equals(this.a)&&sC.b.equals(this.b)&&sC.c.equals(this.c)}},tC=0,uC=class extends ab{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:tC++}),this.uuid=ub(),this.name="",this.type="Material",this.blending=T,this.side=P,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=_,this.blendDst=aa,this.blendEquation=U,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=ga,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Za,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ya,this.stencilZFail=Ya,this.stencilZPass=Ya,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(vC){this._alphaTest>0!=vC>0&&this.version++,this._alphaTest=vC}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(wC){if(void 0!==wC)for(let xC in wC){let yC=wC[xC];if(void 0===yC){console.warn("THREE.Material: '"+xC+"' parameter is undefined.");continue}let zC=this[xC];if(void 0===zC){console.warn("THREE."+this.type+": '"+xC+"' is not a property of this material.");continue}zC&&zC.isColor?zC.set(yC):zC&&zC.isVector3&&yC&&yC.isVector3?zC.copy(yC):this[xC]=yC}}toJSON(AC){let BC=void 0===AC||"string"==typeof AC;BC&&(AC={textures:{},images:{}});let CC={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function DC(a){let b=[];for(let c in a){let d=a[c];delete d.metadata,b.push(d)}return b}if(CC.uuid=this.uuid,CC.type=this.type,""!==this.name&&(CC.name=this.name),this.color&&this.color.isColor&&(CC.color=this.color.getHex()),void 0!==this.roughness&&(CC.roughness=this.roughness),void 0!==this.metalness&&(CC.metalness=this.metalness),void 0!==this.sheen&&(CC.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(CC.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(CC.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(CC.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(CC.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(CC.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(CC.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(CC.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(CC.shininess=this.shininess),void 0!==this.clearcoat&&(CC.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(CC.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(CC.clearcoatMap=this.clearcoatMap.toJSON(AC).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(CC.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(AC).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(CC.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(AC).uuid,CC.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(CC.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(CC.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(CC.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(CC.iridescenceMap=this.iridescenceMap.toJSON(AC).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(CC.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(AC).uuid),this.map&&this.map.isTexture&&(CC.map=this.map.toJSON(AC).uuid),this.matcap&&this.matcap.isTexture&&(CC.matcap=this.matcap.toJSON(AC).uuid),this.alphaMap&&this.alphaMap.isTexture&&(CC.alphaMap=this.alphaMap.toJSON(AC).uuid),this.lightMap&&this.lightMap.isTexture&&(CC.lightMap=this.lightMap.toJSON(AC).uuid,CC.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(CC.aoMap=this.aoMap.toJSON(AC).uuid,CC.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(CC.bumpMap=this.bumpMap.toJSON(AC).uuid,CC.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(CC.normalMap=this.normalMap.toJSON(AC).uuid,CC.normalMapType=this.normalMapType,CC.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(CC.displacementMap=this.displacementMap.toJSON(AC).uuid,CC.displacementScale=this.displacementScale,CC.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(CC.roughnessMap=this.roughnessMap.toJSON(AC).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(CC.metalnessMap=this.metalnessMap.toJSON(AC).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(CC.emissiveMap=this.emissiveMap.toJSON(AC).uuid),this.specularMap&&this.specularMap.isTexture&&(CC.specularMap=this.specularMap.toJSON(AC).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(CC.specularIntensityMap=this.specularIntensityMap.toJSON(AC).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(CC.specularColorMap=this.specularColorMap.toJSON(AC).uuid),this.envMap&&this.envMap.isTexture&&(CC.envMap=this.envMap.toJSON(AC).uuid,void 0!==this.combine&&(CC.combine=this.combine)),void 0!==this.envMapIntensity&&(CC.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(CC.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(CC.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(CC.gradientMap=this.gradientMap.toJSON(AC).uuid),void 0!==this.transmission&&(CC.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(CC.transmissionMap=this.transmissionMap.toJSON(AC).uuid),void 0!==this.thickness&&(CC.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(CC.thicknessMap=this.thicknessMap.toJSON(AC).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(CC.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(CC.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(CC.size=this.size),null!==this.shadowSide&&(CC.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(CC.sizeAttenuation=this.sizeAttenuation),this.blending!==T&&(CC.blending=this.blending),this.side!==P&&(CC.side=this.side),this.vertexColors&&(CC.vertexColors=!0),this.opacity<1&&(CC.opacity=this.opacity),!0===this.transparent&&(CC.transparent=this.transparent),CC.depthFunc=this.depthFunc,CC.depthTest=this.depthTest,CC.depthWrite=this.depthWrite,CC.colorWrite=this.colorWrite,CC.stencilWrite=this.stencilWrite,CC.stencilWriteMask=this.stencilWriteMask,CC.stencilFunc=this.stencilFunc,CC.stencilRef=this.stencilRef,CC.stencilFuncMask=this.stencilFuncMask,CC.stencilFail=this.stencilFail,CC.stencilZFail=this.stencilZFail,CC.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(CC.rotation=this.rotation),!0===this.polygonOffset&&(CC.polygonOffset=!0),0!==this.polygonOffsetFactor&&(CC.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(CC.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(CC.linewidth=this.linewidth),void 0!==this.dashSize&&(CC.dashSize=this.dashSize),void 0!==this.gapSize&&(CC.gapSize=this.gapSize),void 0!==this.scale&&(CC.scale=this.scale),!0===this.dithering&&(CC.dithering=!0),this.alphaTest>0&&(CC.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(CC.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(CC.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(CC.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(CC.wireframe=this.wireframe),this.wireframeLinewidth>1&&(CC.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(CC.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(CC.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(CC.flatShading=this.flatShading),!1===this.visible&&(CC.visible=!1),!1===this.toneMapped&&(CC.toneMapped=!1),!1===this.fog&&(CC.fog=!1),Object.keys(this.userData).length>0&&(CC.userData=this.userData),BC){let EC=DC(AC.textures),FC=DC(AC.images);EC.length>0&&(CC.textures=EC),FC.length>0&&(CC.images=FC)}return CC}clone(){return new this.constructor().copy(this)}copy(GC){this.name=GC.name,this.blending=GC.blending,this.side=GC.side,this.vertexColors=GC.vertexColors,this.opacity=GC.opacity,this.transparent=GC.transparent,this.blendSrc=GC.blendSrc,this.blendDst=GC.blendDst,this.blendEquation=GC.blendEquation,this.blendSrcAlpha=GC.blendSrcAlpha,this.blendDstAlpha=GC.blendDstAlpha,this.blendEquationAlpha=GC.blendEquationAlpha,this.depthFunc=GC.depthFunc,this.depthTest=GC.depthTest,this.depthWrite=GC.depthWrite,this.stencilWriteMask=GC.stencilWriteMask,this.stencilFunc=GC.stencilFunc,this.stencilRef=GC.stencilRef,this.stencilFuncMask=GC.stencilFuncMask,this.stencilFail=GC.stencilFail,this.stencilZFail=GC.stencilZFail,this.stencilZPass=GC.stencilZPass,this.stencilWrite=GC.stencilWrite;let HC=GC.clippingPlanes,IC=null;if(null!==HC){let JC=HC.length;IC=new Array(JC);for(let KC=0;KC!==JC;++KC)IC[KC]=HC[KC].clone()}return this.clippingPlanes=IC,this.clipIntersection=GC.clipIntersection,this.clipShadows=GC.clipShadows,this.shadowSide=GC.shadowSide,this.colorWrite=GC.colorWrite,this.precision=GC.precision,this.polygonOffset=GC.polygonOffset,this.polygonOffsetFactor=GC.polygonOffsetFactor,this.polygonOffsetUnits=GC.polygonOffsetUnits,this.dithering=GC.dithering,this.alphaTest=GC.alphaTest,this.alphaToCoverage=GC.alphaToCoverage,this.premultipliedAlpha=GC.premultipliedAlpha,this.forceSinglePass=GC.forceSinglePass,this.visible=GC.visible,this.toneMapped=GC.toneMapped,this.userData=JSON.parse(JSON.stringify(GC.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(LC){!0===LC&&this.version++}},MC=class extends uC{constructor(NC){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new df(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ha,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(NC)}copy(OC){return super.copy(OC),this.color.copy(OC.color),this.map=OC.map,this.lightMap=OC.lightMap,this.lightMapIntensity=OC.lightMapIntensity,this.aoMap=OC.aoMap,this.aoMapIntensity=OC.aoMapIntensity,this.specularMap=OC.specularMap,this.alphaMap=OC.alphaMap,this.envMap=OC.envMap,this.combine=OC.combine,this.reflectivity=OC.reflectivity,this.refractionRatio=OC.refractionRatio,this.wireframe=OC.wireframe,this.wireframeLinewidth=OC.wireframeLinewidth,this.wireframeLinecap=OC.wireframeLinecap,this.wireframeLinejoin=OC.wireframeLinejoin,this.fog=OC.fog,this}},PC=new fm,QC=new Eb,RC=class{constructor(SC,TC,UC=!1){if(Array.isArray(SC))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=SC,this.itemSize=TC,this.count=void 0!==SC?SC.length/TC:0,this.normalized=UC,this.usage=$a,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(VC){!0===VC&&this.version++}setUsage(WC){return this.usage=WC,this}copy(XC){return this.name=XC.name,this.array=new XC.array.constructor(XC.array),this.itemSize=XC.itemSize,this.count=XC.count,this.normalized=XC.normalized,this.usage=XC.usage,this}copyAt(YC,ZC,$C){YC*=this.itemSize,$C*=ZC.itemSize;for(let _C=0,aD=this.itemSize;_C<aD;_C++)this.array[YC+_C]=ZC.array[$C+_C];return this}copyArray(bD){return this.array.set(bD),this}applyMatrix3(cD){if(2===this.itemSize)for(let dD=0,eD=this.count;dD<eD;dD++)QC.fromBufferAttribute(this,dD),QC.applyMatrix3(cD),this.setXY(dD,QC.x,QC.y);else if(3===this.itemSize)for(let fD=0,gD=this.count;fD<gD;fD++)PC.fromBufferAttribute(this,fD),PC.applyMatrix3(cD),this.setXYZ(fD,PC.x,PC.y,PC.z);return this}applyMatrix4(hD){for(let iD=0,jD=this.count;iD<jD;iD++)PC.fromBufferAttribute(this,iD),PC.applyMatrix4(hD),this.setXYZ(iD,PC.x,PC.y,PC.z);return this}applyNormalMatrix(kD){for(let lD=0,mD=this.count;lD<mD;lD++)PC.fromBufferAttribute(this,lD),PC.applyNormalMatrix(kD),this.setXYZ(lD,PC.x,PC.y,PC.z);return this}transformDirection(nD){for(let oD=0,pD=this.count;oD<pD;oD++)PC.fromBufferAttribute(this,oD),PC.transformDirection(nD),this.setXYZ(oD,PC.x,PC.y,PC.z);return this}set(qD,rD=0){return this.array.set(qD,rD),this}getX(sD){let tD=this.array[sD*this.itemSize];return this.normalized&&(tD=Bb(tD,this.array)),tD}setX(uD,vD){return this.normalized&&(vD=Cb(vD,this.array)),this.array[uD*this.itemSize]=vD,this}getY(wD){let xD=this.array[wD*this.itemSize+1];return this.normalized&&(xD=Bb(xD,this.array)),xD}setY(yD,zD){return this.normalized&&(zD=Cb(zD,this.array)),this.array[yD*this.itemSize+1]=zD,this}getZ(AD){let BD=this.array[AD*this.itemSize+2];return this.normalized&&(BD=Bb(BD,this.array)),BD}setZ(CD,DD){return this.normalized&&(DD=Cb(DD,this.array)),this.array[CD*this.itemSize+2]=DD,this}getW(ED){let FD=this.array[ED*this.itemSize+3];return this.normalized&&(FD=Bb(FD,this.array)),FD}setW(GD,HD){return this.normalized&&(HD=Cb(HD,this.array)),this.array[GD*this.itemSize+3]=HD,this}setXY(ID,JD,KD){return ID*=this.itemSize,this.normalized&&(JD=Cb(JD,this.array),KD=Cb(KD,this.array)),this.array[ID+0]=JD,this.array[ID+1]=KD,this}setXYZ(LD,MD,ND,OD){return LD*=this.itemSize,this.normalized&&(MD=Cb(MD,this.array),ND=Cb(ND,this.array),OD=Cb(OD,this.array)),this.array[LD+0]=MD,this.array[LD+1]=ND,this.array[LD+2]=OD,this}setXYZW(PD,QD,RD,SD,TD){return PD*=this.itemSize,this.normalized&&(QD=Cb(QD,this.array),RD=Cb(RD,this.array),SD=Cb(SD,this.array),TD=Cb(TD,this.array)),this.array[PD+0]=QD,this.array[PD+1]=RD,this.array[PD+2]=SD,this.array[PD+3]=TD,this}onUpload(UD){return this.onUploadCallback=UD,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let VD={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(VD.name=this.name),this.usage!==$a&&(VD.usage=this.usage),(0!==this.updateRange.offset|| -1!==this.updateRange.count)&&(VD.updateRange=this.updateRange),VD}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},WD=class extends RC{constructor(XD,YD,ZD){super(new Uint16Array(XD),YD,ZD)}},$D=class extends RC{constructor(_D,aE,bE){super(new Uint32Array(_D),aE,bE)}},cE=class extends RC{constructor(dE,eE,fE){super(new Float32Array(dE),eE,fE)}},gE=0,hE=new rs,iE=new Iy,jE=new fm,kE=new Io,lE=new Io,mE=new fm,nE=class extends ab{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:gE++}),this.uuid=ub(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(oE){return Array.isArray(oE)?this.index=new(Re(oE)?$D:WD)(oE,1):this.index=oE,this}getAttribute(pE){return this.attributes[pE]}setAttribute(qE,rE){return this.attributes[qE]=rE,this}deleteAttribute(sE){return delete this.attributes[sE],this}hasAttribute(tE){return void 0!==this.attributes[tE]}addGroup(uE,vE,wE=0){this.groups.push({start:uE,count:vE,materialIndex:wE})}clearGroups(){this.groups=[]}setDrawRange(xE,yE){this.drawRange.start=xE,this.drawRange.count=yE}applyMatrix4(zE){let AE=this.attributes.position;void 0!==AE&&(AE.applyMatrix4(zE),AE.needsUpdate=!0);let BE=this.attributes.normal;if(void 0!==BE){let CE=new Rc().getNormalMatrix(zE);BE.applyNormalMatrix(CE),BE.needsUpdate=!0}let DE=this.attributes.tangent;return void 0!==DE&&(DE.transformDirection(zE),DE.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(EE){return hE.makeRotationFromQuaternion(EE),this.applyMatrix4(hE),this}rotateX(FE){return hE.makeRotationX(FE),this.applyMatrix4(hE),this}rotateY(GE){return hE.makeRotationY(GE),this.applyMatrix4(hE),this}rotateZ(HE){return hE.makeRotationZ(HE),this.applyMatrix4(hE),this}translate(IE,JE,KE){return hE.makeTranslation(IE,JE,KE),this.applyMatrix4(hE),this}scale(LE,ME,NE){return hE.makeScale(LE,ME,NE),this.applyMatrix4(hE),this}lookAt(OE){return iE.lookAt(OE),iE.updateMatrix(),this.applyMatrix4(iE.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(jE).negate(),this.translate(jE.x,jE.y,jE.z),this}setFromPoints(PE){let QE=[];for(let RE=0,SE=PE.length;RE<SE;RE++){let TE=PE[RE];QE.push(TE.x,TE.y,TE.z||0)}return this.setAttribute("position",new cE(QE,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Io);let UE=this.attributes.position,VE=this.morphAttributes.position;if(UE&&UE.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set \"mesh.frustumCulled\" to \"false\".",this),this.boundingBox.set(new fm(-1/0,-1/0,-1/0),new fm(1/0,1/0,1/0));return}if(void 0!==UE){if(this.boundingBox.setFromBufferAttribute(UE),VE)for(let WE=0,XE=VE.length;WE<XE;WE++){let YE=VE[WE];kE.setFromBufferAttribute(YE),this.morphTargetsRelative?(mE.addVectors(this.boundingBox.min,kE.min),this.boundingBox.expandByPoint(mE),mE.addVectors(this.boundingBox.max,kE.max),this.boundingBox.expandByPoint(mE)):(this.boundingBox.expandByPoint(kE.min),this.boundingBox.expandByPoint(kE.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error("THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.",this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new pq);let ZE=this.attributes.position,$E=this.morphAttributes.position;if(ZE&&ZE.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set \"mesh.frustumCulled\" to \"false\".",this),this.boundingSphere.set(new fm,1/0);return}if(ZE){let _E=this.boundingSphere.center;if(kE.setFromBufferAttribute(ZE),$E)for(let aF=0,bF=$E.length;aF<bF;aF++){let cF=$E[aF];lE.setFromBufferAttribute(cF),this.morphTargetsRelative?(mE.addVectors(kE.min,lE.min),kE.expandByPoint(mE),mE.addVectors(kE.max,lE.max),kE.expandByPoint(mE)):(kE.expandByPoint(lE.min),kE.expandByPoint(lE.max))}kE.getCenter(_E);let dF=0;for(let eF=0,fF=ZE.count;eF<fF;eF++)mE.fromBufferAttribute(ZE,eF),dF=Math.max(dF,_E.distanceToSquared(mE));if($E)for(let gF=0,hF=$E.length;gF<hF;gF++){let iF=$E[gF],jF=this.morphTargetsRelative;for(let kF=0,lF=iF.count;kF<lF;kF++)mE.fromBufferAttribute(iF,kF),jF&&(jE.fromBufferAttribute(ZE,kF),mE.add(jE)),dF=Math.max(dF,_E.distanceToSquared(mE))}this.boundingSphere.radius=Math.sqrt(dF),isNaN(this.boundingSphere.radius)&&console.error("THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.",this)}}computeTangents(){let mF=this.index,nF=this.attributes;if(null===mF|| void 0===nF.position|| void 0===nF.normal|| void 0===nF.uv){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let oF=mF.array,pF=nF.position.array,qF=nF.normal.array,rF=nF.uv.array,sF=pF.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new RC(new Float32Array(4*sF),4));let tF=this.getAttribute("tangent").array,uF=[],vF=[];for(let wF=0;wF<sF;wF++)uF[wF]=new fm,vF[wF]=new fm;let xF=new fm,yF=new fm,zF=new fm,AF=new Eb,BF=new Eb,CF=new Eb,DF=new fm,EF=new fm;function FF(a,b,c){xF.fromArray(pF,3*a),yF.fromArray(pF,3*b),zF.fromArray(pF,3*c),AF.fromArray(rF,2*a),BF.fromArray(rF,2*b),CF.fromArray(rF,2*c),yF.sub(xF),zF.sub(xF),BF.sub(AF),CF.sub(AF);let d=1/(BF.x*CF.y-CF.x*BF.y);isFinite(d)&&(DF.copy(yF).multiplyScalar(CF.y).addScaledVector(zF,-BF.y).multiplyScalar(d),EF.copy(zF).multiplyScalar(BF.x).addScaledVector(yF,-CF.x).multiplyScalar(d),uF[a].add(DF),uF[b].add(DF),uF[c].add(DF),vF[a].add(EF),vF[b].add(EF),vF[c].add(EF))}let GF=this.groups;0===GF.length&&(GF=[{start:0,count:oF.length}]);for(let HF=0,IF=GF.length;HF<IF;++HF){let JF=GF[HF],KF=JF.start,LF=JF.count;for(let MF=KF,NF=KF+LF;MF<NF;MF+=3)FF(oF[MF+0],oF[MF+1],oF[MF+2])}let OF=new fm,PF=new fm,QF=new fm,RF=new fm;function SF(a){QF.fromArray(qF,3*a),RF.copy(QF);let b=uF[a];OF.copy(b),OF.sub(QF.multiplyScalar(QF.dot(b))).normalize(),PF.crossVectors(RF,b);let c=0>PF.dot(vF[a])?-1:1;tF[4*a]=OF.x,tF[4*a+1]=OF.y,tF[4*a+2]=OF.z,tF[4*a+3]=c}for(let TF=0,UF=GF.length;TF<UF;++TF){let VF=GF[TF],WF=VF.start,XF=VF.count;for(let YF=WF,ZF=WF+XF;YF<ZF;YF+=3)SF(oF[YF+0]),SF(oF[YF+1]),SF(oF[YF+2])}}computeVertexNormals(){let $F=this.index,_F=this.getAttribute("position");if(void 0!==_F){let aG=this.getAttribute("normal");if(void 0===aG)aG=new RC(new Float32Array(3*_F.count),3),this.setAttribute("normal",aG);else for(let bG=0,cG=aG.count;bG<cG;bG++)aG.setXYZ(bG,0,0,0);let dG=new fm,eG=new fm,fG=new fm,gG=new fm,hG=new fm,iG=new fm,jG=new fm,kG=new fm;if($F)for(let lG=0,mG=$F.count;lG<mG;lG+=3){let nG=$F.getX(lG+0),oG=$F.getX(lG+1),pG=$F.getX(lG+2);dG.fromBufferAttribute(_F,nG),eG.fromBufferAttribute(_F,oG),fG.fromBufferAttribute(_F,pG),jG.subVectors(fG,eG),kG.subVectors(dG,eG),jG.cross(kG),gG.fromBufferAttribute(aG,nG),hG.fromBufferAttribute(aG,oG),iG.fromBufferAttribute(aG,pG),gG.add(jG),hG.add(jG),iG.add(jG),aG.setXYZ(nG,gG.x,gG.y,gG.z),aG.setXYZ(oG,hG.x,hG.y,hG.z),aG.setXYZ(pG,iG.x,iG.y,iG.z)}else for(let qG=0,rG=_F.count;qG<rG;qG+=3)dG.fromBufferAttribute(_F,qG+0),eG.fromBufferAttribute(_F,qG+1),fG.fromBufferAttribute(_F,qG+2),jG.subVectors(fG,eG),kG.subVectors(dG,eG),jG.cross(kG),aG.setXYZ(qG+0,jG.x,jG.y,jG.z),aG.setXYZ(qG+1,jG.x,jG.y,jG.z),aG.setXYZ(qG+2,jG.x,jG.y,jG.z);this.normalizeNormals(),aG.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let sG=this.attributes.normal;for(let tG=0,uG=sG.count;tG<uG;tG++)mE.fromBufferAttribute(sG,tG),mE.normalize(),sG.setXYZ(tG,mE.x,mE.y,mE.z)}toNonIndexed(){function vG(a,b){let c=a.array,d=a.itemSize,e=a.normalized,f=new c.constructor(b.length*d),g=0,h=0;for(let i=0,j=b.length;i<j;i++){g=a.isInterleavedBufferAttribute?b[i]*a.data.stride+a.offset:b[i]*d;for(let k=0;k<d;k++)f[h++]=c[g++]}return new RC(f,d,e)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let wG=new nE,xG=this.index.array,yG=this.attributes;for(let zG in yG){let AG=vG(yG[zG],xG);wG.setAttribute(zG,AG)}let BG=this.morphAttributes;for(let CG in BG){let DG=[],EG=BG[CG];for(let FG=0,GG=EG.length;FG<GG;FG++){let HG=vG(EG[FG],xG);DG.push(HG)}wG.morphAttributes[CG]=DG}wG.morphTargetsRelative=this.morphTargetsRelative;let IG=this.groups;for(let JG=0,KG=IG.length;JG<KG;JG++){let LG=IG[JG];wG.addGroup(LG.start,LG.count,LG.materialIndex)}return wG}toJSON(){let MG={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(MG.uuid=this.uuid,MG.type=this.type,""!==this.name&&(MG.name=this.name),Object.keys(this.userData).length>0&&(MG.userData=this.userData),void 0!==this.parameters){let NG=this.parameters;for(let OG in NG)void 0!==NG[OG]&&(MG[OG]=NG[OG]);return MG}MG.data={attributes:{}};let PG=this.index;null!==PG&&(MG.data.index={type:PG.array.constructor.name,array:Array.prototype.slice.call(PG.array)});let QG=this.attributes;for(let RG in QG){let SG=QG[RG];MG.data.attributes[RG]=SG.toJSON(MG.data)}let TG={},UG=!1;for(let VG in this.morphAttributes){let WG=this.morphAttributes[VG],XG=[];for(let YG=0,ZG=WG.length;YG<ZG;YG++){let $G=WG[YG];XG.push($G.toJSON(MG.data))}XG.length>0&&(TG[VG]=XG,UG=!0)}UG&&(MG.data.morphAttributes=TG,MG.data.morphTargetsRelative=this.morphTargetsRelative);let _G=this.groups;_G.length>0&&(MG.data.groups=JSON.parse(JSON.stringify(_G)));let aH=this.boundingSphere;return null!==aH&&(MG.data.boundingSphere={center:aH.center.toArray(),radius:aH.radius}),MG}clone(){return new this.constructor().copy(this)}copy(bH){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let cH={};this.name=bH.name;let dH=bH.index;null!==dH&&this.setIndex(dH.clone(cH));let eH=bH.attributes;for(let fH in eH){let gH=eH[fH];this.setAttribute(fH,gH.clone(cH))}let hH=bH.morphAttributes;for(let iH in hH){let jH=[],kH=hH[iH];for(let lH=0,mH=kH.length;lH<mH;lH++)jH.push(kH[lH].clone(cH));this.morphAttributes[iH]=jH}this.morphTargetsRelative=bH.morphTargetsRelative;let nH=bH.groups;for(let oH=0,pH=nH.length;oH<pH;oH++){let qH=nH[oH];this.addGroup(qH.start,qH.count,qH.materialIndex)}let rH=bH.boundingBox;null!==rH&&(this.boundingBox=rH.clone());let sH=bH.boundingSphere;return null!==sH&&(this.boundingSphere=sH.clone()),this.drawRange.start=bH.drawRange.start,this.drawRange.count=bH.drawRange.count,this.userData=bH.userData,void 0!==bH.parameters&&(this.parameters=Object.assign({},bH.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},tH=new rs,uH=new $q,vH=new pq,wH=new fm,xH=new fm,yH=new fm,zH=new fm,AH=new fm,BH=new Eb,CH=new Eb,DH=new Eb,EH=new fm,FH=new fm,GH=class extends Iy{constructor(HH=new nE,IH=new MC){super(),this.isMesh=!0,this.type="Mesh",this.geometry=HH,this.material=IH,this.updateMorphTargets()}copy(JH,KH){return super.copy(JH,KH),void 0!==JH.morphTargetInfluences&&(this.morphTargetInfluences=JH.morphTargetInfluences.slice()),void 0!==JH.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},JH.morphTargetDictionary)),this.material=JH.material,this.geometry=JH.geometry,this}updateMorphTargets(){let LH=this.geometry.morphAttributes,MH=Object.keys(LH);if(MH.length>0){let NH=LH[MH[0]];if(void 0!==NH){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let OH=0,PH=NH.length;OH<PH;OH++){let QH=NH[OH].name||String(OH);this.morphTargetInfluences.push(0),this.morphTargetDictionary[QH]=OH}}}}getVertexPosition(RH,SH){let TH=this.geometry,UH=TH.attributes.position,VH=TH.morphAttributes.position,WH=TH.morphTargetsRelative;SH.fromBufferAttribute(UH,RH);let XH=this.morphTargetInfluences;if(VH&&XH){AH.set(0,0,0);for(let YH=0,ZH=VH.length;YH<ZH;YH++){let $H=XH[YH],_H=VH[YH];0!==$H&&(zH.fromBufferAttribute(_H,RH),WH?AH.addScaledVector(zH,$H):AH.addScaledVector(zH.sub(SH),$H))}SH.add(AH)}return this.isSkinnedMesh&&this.boneTransform(RH,SH),SH}raycast(aI,bI){let cI=this.geometry,dI=this.material,eI=this.matrixWorld;if(void 0===dI||(null===cI.boundingSphere&&cI.computeBoundingSphere(),vH.copy(cI.boundingSphere),vH.applyMatrix4(eI),!1===aI.ray.intersectsSphere(vH))||(tH.copy(eI).invert(),uH.copy(aI.ray).applyMatrix4(tH),null!==cI.boundingBox&& !1===uH.intersectsBox(cI.boundingBox)))return;let fI,gI=cI.index,hI=cI.attributes.position,iI=cI.attributes.uv,jI=cI.attributes.uv2,kI=cI.groups,lI=cI.drawRange;if(null!==gI)if(Array.isArray(dI))for(let mI=0,nI=kI.length;mI<nI;mI++){let oI=kI[mI],pI=dI[oI.materialIndex],qI=Math.max(oI.start,lI.start),rI=Math.min(gI.count,Math.min(oI.start+oI.count,lI.start+lI.count));for(let sI=qI,tI=rI;sI<tI;sI+=3){let uI=gI.getX(sI),vI=gI.getX(sI+1),wI=gI.getX(sI+2);(fI=WI(this,pI,aI,uH,iI,jI,uI,vI,wI))&&(fI.faceIndex=Math.floor(sI/3),fI.face.materialIndex=oI.materialIndex,bI.push(fI))}}else{let xI=Math.max(0,lI.start),yI=Math.min(gI.count,lI.start+lI.count);for(let zI=xI,AI=yI;zI<AI;zI+=3){let BI=gI.getX(zI),CI=gI.getX(zI+1),DI=gI.getX(zI+2);(fI=WI(this,dI,aI,uH,iI,jI,BI,CI,DI))&&(fI.faceIndex=Math.floor(zI/3),bI.push(fI))}}else if(void 0!==hI)if(Array.isArray(dI))for(let EI=0,FI=kI.length;EI<FI;EI++){let GI=kI[EI],HI=dI[GI.materialIndex],II=Math.max(GI.start,lI.start),JI=Math.min(hI.count,Math.min(GI.start+GI.count,lI.start+lI.count));for(let KI=II,LI=JI;KI<LI;KI+=3){let MI=KI,NI=KI+1,OI=KI+2;(fI=WI(this,HI,aI,uH,iI,jI,MI,NI,OI))&&(fI.faceIndex=Math.floor(KI/3),fI.face.materialIndex=GI.materialIndex,bI.push(fI))}}else{let PI=Math.max(0,lI.start),QI=Math.min(hI.count,lI.start+lI.count);for(let RI=PI,SI=QI;RI<SI;RI+=3){let TI=RI,UI=RI+1,VI=RI+2;(fI=WI(this,dI,aI,uH,iI,jI,TI,UI,VI))&&(fI.faceIndex=Math.floor(RI/3),bI.push(fI))}}}};function WI(a,b,c,d,e,f,g,h,i){a.getVertexPosition(g,wH),a.getVertexPosition(h,xH),a.getVertexPosition(i,yH);let j=function(a,b,c,d,e,f,g,h){if(null===(b.side===Q?d.intersectTriangle(g,f,e,!0,h):d.intersectTriangle(e,f,g,b.side===P,h)))return null;FH.copy(h),FH.applyMatrix4(a.matrixWorld);let i=c.ray.origin.distanceTo(FH);return i<c.near||i>c.far?null:{distance:i,point:FH.clone(),object:a}}(a,b,c,d,wH,xH,yH,EH);if(j){e&&(BH.fromBufferAttribute(e,g),CH.fromBufferAttribute(e,h),DH.fromBufferAttribute(e,i),j.uv=TA.getUV(EH,wH,xH,yH,BH,CH,DH,new Eb)),f&&(BH.fromBufferAttribute(f,g),CH.fromBufferAttribute(f,h),DH.fromBufferAttribute(f,i),j.uv2=TA.getUV(EH,wH,xH,yH,BH,CH,DH,new Eb));let k={a:g,b:h,c:i,normal:new fm,materialIndex:0};TA.getNormal(wH,xH,yH,k.normal),j.face=k}return j}var XI=class extends nE{constructor(YI=1,ZI=1,$I=1,_I=1,aJ=1,bJ=1){super(),this.type="BoxGeometry",this.parameters={width:YI,height:ZI,depth:$I,widthSegments:_I,heightSegments:aJ,depthSegments:bJ};let cJ=this;_I=Math.floor(_I),aJ=Math.floor(aJ),bJ=Math.floor(bJ);let dJ=[],eJ=[],fJ=[],gJ=[],hJ=0,iJ=0;function jJ(a,b,c,d,e,f,g,h,i,j,k){let l=f/i,m=g/j,n=f/2,o=g/2,p=h/2,q=i+1,r=j+1,s=0,t=0,u=new fm;for(let v=0;v<r;v++){let w=v*m-o;for(let x=0;x<q;x++){let y=x*l-n;u[a]=y*d,u[b]=w*e,u[c]=p,eJ.push(u.x,u.y,u.z),u[a]=0,u[b]=0,u[c]=h>0?1:-1,fJ.push(u.x,u.y,u.z),gJ.push(x/i),gJ.push(1-v/j),s+=1}}for(let z=0;z<j;z++)for(let A=0;A<i;A++){let B=hJ+A+q*z,C=hJ+A+q*(z+1),D=hJ+(A+1)+q*(z+1),E=hJ+(A+1)+q*z;dJ.push(B,C,E),dJ.push(C,D,E),t+=6}cJ.addGroup(iJ,t,k),iJ+=t,hJ+=s}jJ("z","y","x",-1,-1,$I,ZI,YI,bJ,aJ,0),jJ("z","y","x",1,-1,$I,ZI,-YI,bJ,aJ,1),jJ("x","z","y",1,1,YI,$I,ZI,_I,bJ,2),jJ("x","z","y",1,-1,YI,$I,-ZI,_I,bJ,3),jJ("x","y","z",1,-1,YI,ZI,$I,_I,aJ,4),jJ("x","y","z",-1,-1,YI,ZI,-$I,_I,aJ,5),this.setIndex(dJ),this.setAttribute("position",new cE(eJ,3)),this.setAttribute("normal",new cE(fJ,3)),this.setAttribute("uv",new cE(gJ,2))}static fromJSON(kJ){return new XI(kJ.width,kJ.height,kJ.depth,kJ.widthSegments,kJ.heightSegments,kJ.depthSegments)}};function lJ(a){let b={};for(let c in a)for(let d in b[c]={},a[c]){let e=a[c][d];e&&(e.isColor||e.isMatrix3||e.isMatrix4||e.isVector2||e.isVector3||e.isVector4||e.isTexture||e.isQuaternion)?b[c][d]=e.clone():Array.isArray(e)?b[c][d]=e.slice():b[c][d]=e}return b}function mJ(a){let b={};for(let c=0;c<a.length;c++){let d=lJ(a[c]);for(let e in d)b[e]=d[e]}return b}function nJ(a){return null===a.getRenderTarget()&&a.outputEncoding===Ta?Wa:Xa}var oJ={clone:lJ,merge:mJ},pJ=class extends uC{constructor(qJ){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==qJ&&this.setValues(qJ)}copy(rJ){return super.copy(rJ),this.fragmentShader=rJ.fragmentShader,this.vertexShader=rJ.vertexShader,this.uniforms=lJ(rJ.uniforms),this.uniformsGroups=(function(a){let b=[];for(let c=0;c<a.length;c++)b.push(a[c].clone());return b})(rJ.uniformsGroups),this.defines=Object.assign({},rJ.defines),this.wireframe=rJ.wireframe,this.wireframeLinewidth=rJ.wireframeLinewidth,this.fog=rJ.fog,this.lights=rJ.lights,this.clipping=rJ.clipping,this.extensions=Object.assign({},rJ.extensions),this.glslVersion=rJ.glslVersion,this}toJSON(sJ){let tJ=super.toJSON(sJ);for(let uJ in tJ.glslVersion=this.glslVersion,tJ.uniforms={},this.uniforms){let vJ=this.uniforms[uJ].value;vJ&&vJ.isTexture?tJ.uniforms[uJ]={type:"t",value:vJ.toJSON(sJ).uuid}:vJ&&vJ.isColor?tJ.uniforms[uJ]={type:"c",value:vJ.getHex()}:vJ&&vJ.isVector2?tJ.uniforms[uJ]={type:"v2",value:vJ.toArray()}:vJ&&vJ.isVector3?tJ.uniforms[uJ]={type:"v3",value:vJ.toArray()}:vJ&&vJ.isVector4?tJ.uniforms[uJ]={type:"v4",value:vJ.toArray()}:vJ&&vJ.isMatrix3?tJ.uniforms[uJ]={type:"m3",value:vJ.toArray()}:vJ&&vJ.isMatrix4?tJ.uniforms[uJ]={type:"m4",value:vJ.toArray()}:tJ.uniforms[uJ]={value:vJ}}Object.keys(this.defines).length>0&&(tJ.defines=this.defines),tJ.vertexShader=this.vertexShader,tJ.fragmentShader=this.fragmentShader;let wJ={};for(let xJ in this.extensions)!0===this.extensions[xJ]&&(wJ[xJ]=!0);return Object.keys(wJ).length>0&&(tJ.extensions=wJ),tJ}},yJ=class extends Iy{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new rs,this.projectionMatrix=new rs,this.projectionMatrixInverse=new rs}copy(zJ,AJ){return super.copy(zJ,AJ),this.matrixWorldInverse.copy(zJ.matrixWorldInverse),this.projectionMatrix.copy(zJ.projectionMatrix),this.projectionMatrixInverse.copy(zJ.projectionMatrixInverse),this}getWorldDirection(BJ){this.updateWorldMatrix(!0,!1);let CJ=this.matrixWorld.elements;return BJ.set(-CJ[8],-CJ[9],-CJ[10]).normalize()}updateMatrixWorld(DJ){super.updateMatrixWorld(DJ),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(EJ,FJ){super.updateWorldMatrix(EJ,FJ),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},GJ=class extends yJ{constructor(HJ=50,IJ=1,JJ=.1,KJ=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=HJ,this.zoom=1,this.near=JJ,this.far=KJ,this.focus=10,this.aspect=IJ,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(LJ,MJ){return super.copy(LJ,MJ),this.fov=LJ.fov,this.zoom=LJ.zoom,this.near=LJ.near,this.far=LJ.far,this.focus=LJ.focus,this.aspect=LJ.aspect,this.view=null===LJ.view?null:Object.assign({},LJ.view),this.filmGauge=LJ.filmGauge,this.filmOffset=LJ.filmOffset,this}setFocalLength(NJ){let OJ=.5*this.getFilmHeight()/NJ;this.fov=2*tb*Math.atan(OJ),this.updateProjectionMatrix()}getFocalLength(){let PJ=Math.tan(.5*sb*this.fov);return .5*this.getFilmHeight()/PJ}getEffectiveFOV(){return 2*tb*Math.atan(Math.tan(.5*sb*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(QJ,RJ,SJ,TJ,UJ,VJ){this.aspect=QJ/RJ,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=QJ,this.view.fullHeight=RJ,this.view.offsetX=SJ,this.view.offsetY=TJ,this.view.width=UJ,this.view.height=VJ,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let WJ=this.near,XJ=WJ*Math.tan(.5*sb*this.fov)/this.zoom,YJ=2*XJ,ZJ=this.aspect*YJ,$J=-0.5*ZJ,_J=this.view;if(null!==this.view&&this.view.enabled){let aK=_J.fullWidth,bK=_J.fullHeight;$J+=_J.offsetX*ZJ/aK,XJ-=_J.offsetY*YJ/bK,ZJ*=_J.width/aK,YJ*=_J.height/bK}let cK=this.filmOffset;0!==cK&&($J+=WJ*cK/this.getFilmWidth()),this.projectionMatrix.makePerspective($J,$J+ZJ,XJ,XJ-YJ,WJ,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(dK){let eK=super.toJSON(dK);return eK.object.fov=this.fov,eK.object.zoom=this.zoom,eK.object.near=this.near,eK.object.far=this.far,eK.object.focus=this.focus,eK.object.aspect=this.aspect,null!==this.view&&(eK.object.view=Object.assign({},this.view)),eK.object.filmGauge=this.filmGauge,eK.object.filmOffset=this.filmOffset,eK}},fK=-90,gK=1,hK=class extends Iy{constructor(iK,jK,kK){super(),this.type="CubeCamera",this.renderTarget=kK;let lK=new GJ(fK,gK,iK,jK);lK.layers=this.layers,lK.up.set(0,1,0),lK.lookAt(1,0,0),this.add(lK);let mK=new GJ(fK,gK,iK,jK);mK.layers=this.layers,mK.up.set(0,1,0),mK.lookAt(-1,0,0),this.add(mK);let nK=new GJ(fK,gK,iK,jK);nK.layers=this.layers,nK.up.set(0,0,-1),nK.lookAt(0,1,0),this.add(nK);let oK=new GJ(fK,gK,iK,jK);oK.layers=this.layers,oK.up.set(0,0,1),oK.lookAt(0,-1,0),this.add(oK);let pK=new GJ(fK,gK,iK,jK);pK.layers=this.layers,pK.up.set(0,1,0),pK.lookAt(0,0,1),this.add(pK);let qK=new GJ(fK,gK,iK,jK);qK.layers=this.layers,qK.up.set(0,1,0),qK.lookAt(0,0,-1),this.add(qK)}update(rK,sK){null===this.parent&&this.updateMatrixWorld();let tK=this.renderTarget,[uK,vK,wK,xK,yK,zK]=this.children,AK=rK.getRenderTarget(),BK=rK.toneMapping,CK=rK.xr.enabled;rK.toneMapping=ia,rK.xr.enabled=!1;let DK=tK.texture.generateMipmaps;tK.texture.generateMipmaps=!1,rK.setRenderTarget(tK,0),rK.render(sK,uK),rK.setRenderTarget(tK,1),rK.render(sK,vK),rK.setRenderTarget(tK,2),rK.render(sK,wK),rK.setRenderTarget(tK,3),rK.render(sK,xK),rK.setRenderTarget(tK,4),rK.render(sK,yK),tK.texture.generateMipmaps=DK,rK.setRenderTarget(tK,5),rK.render(sK,zK),rK.setRenderTarget(AK),rK.toneMapping=BK,rK.xr.enabled=CK,tK.texture.needsPMREMUpdate=!0}},EK=class extends ah{constructor(FK,GK,HK,IK,JK,KK,LK,MK,NK,OK){super(FK=void 0!==FK?FK:[],GK=void 0!==GK?GK:ka,HK,IK,JK,KK,LK,MK,NK,OK),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(PK){this.image=PK}},QK=class extends Yi{constructor(RK=1,SK={}){super(RK,RK,SK),this.isWebGLCubeRenderTarget=!0;let TK={width:RK,height:RK,depth:1},UK=[TK,TK,TK,TK,TK,TK];this.texture=new EK(UK,SK.mapping,SK.wrapS,SK.wrapT,SK.magFilter,SK.minFilter,SK.format,SK.type,SK.anisotropy,SK.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==SK.generateMipmaps&&SK.generateMipmaps,this.texture.minFilter=void 0!==SK.minFilter?SK.minFilter:va}fromEquirectangularTexture(VK,WK){this.texture.type=WK.type,this.texture.encoding=WK.encoding,this.texture.generateMipmaps=WK.generateMipmaps,this.texture.minFilter=WK.minFilter,this.texture.magFilter=WK.magFilter;let XK={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},YK=new XI(5,5,5),ZK=new pJ({name:"CubemapFromEquirect",uniforms:lJ(XK.uniforms),vertexShader:XK.vertexShader,fragmentShader:XK.fragmentShader,side:Q,blending:S});ZK.uniforms.tEquirect.value=WK;let $K=new GH(YK,ZK),_K=WK.minFilter;return WK.minFilter===xa&&(WK.minFilter=va),new hK(1,10,this).update(VK,$K),WK.minFilter=_K,$K.geometry.dispose(),$K.material.dispose(),this}clear(aL,bL,cL,dL){let eL=aL.getRenderTarget();for(let fL=0;fL<6;fL++)aL.setRenderTarget(this,fL),aL.clear(bL,cL,dL);aL.setRenderTarget(eL)}},gL=new fm,hL=new fm,iL=new Rc,jL=class{constructor(kL=new fm(1,0,0),lL=0){this.isPlane=!0,this.normal=kL,this.constant=lL}set(mL,nL){return this.normal.copy(mL),this.constant=nL,this}setComponents(oL,pL,qL,rL){return this.normal.set(oL,pL,qL),this.constant=rL,this}setFromNormalAndCoplanarPoint(sL,tL){return this.normal.copy(sL),this.constant=-tL.dot(this.normal),this}setFromCoplanarPoints(uL,vL,wL){let xL=gL.subVectors(wL,vL).cross(hL.subVectors(uL,vL)).normalize();return this.setFromNormalAndCoplanarPoint(xL,uL),this}copy(yL){return this.normal.copy(yL.normal),this.constant=yL.constant,this}normalize(){let zL=1/this.normal.length();return this.normal.multiplyScalar(zL),this.constant*=zL,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(AL){return this.normal.dot(AL)+this.constant}distanceToSphere(BL){return this.distanceToPoint(BL.center)-BL.radius}projectPoint(CL,DL){return DL.copy(this.normal).multiplyScalar(-this.distanceToPoint(CL)).add(CL)}intersectLine(EL,FL){let GL=EL.delta(gL),HL=this.normal.dot(GL);if(0===HL)return 0===this.distanceToPoint(EL.start)?FL.copy(EL.start):null;let IL=-(EL.start.dot(this.normal)+this.constant)/HL;return IL<0||IL>1?null:FL.copy(GL).multiplyScalar(IL).add(EL.start)}intersectsLine(JL){let KL=this.distanceToPoint(JL.start),LL=this.distanceToPoint(JL.end);return KL<0&&LL>0||LL<0&&KL>0}intersectsBox(ML){return ML.intersectsPlane(this)}intersectsSphere(NL){return NL.intersectsPlane(this)}coplanarPoint(OL){return OL.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(PL,QL){let RL=QL||iL.getNormalMatrix(PL),SL=this.coplanarPoint(gL).applyMatrix4(PL),TL=this.normal.applyMatrix3(RL).normalize();return this.constant=-SL.dot(TL),this}translate(UL){return this.constant-=UL.dot(this.normal),this}equals(VL){return VL.normal.equals(this.normal)&&VL.constant===this.constant}clone(){return new this.constructor().copy(this)}},WL=new pq,XL=new fm,YL=class{constructor(ZL=new jL,$L=new jL,_L=new jL,aM=new jL,bM=new jL,cM=new jL){this.planes=[ZL,$L,_L,aM,bM,cM]}set(dM,eM,fM,gM,hM,iM){let jM=this.planes;return jM[0].copy(dM),jM[1].copy(eM),jM[2].copy(fM),jM[3].copy(gM),jM[4].copy(hM),jM[5].copy(iM),this}copy(kM){let lM=this.planes;for(let mM=0;mM<6;mM++)lM[mM].copy(kM.planes[mM]);return this}setFromProjectionMatrix(nM){let oM=this.planes,pM=nM.elements,qM=pM[0],rM=pM[1],sM=pM[2],tM=pM[3],uM=pM[4],vM=pM[5],wM=pM[6],xM=pM[7],yM=pM[8],zM=pM[9],AM=pM[10],BM=pM[11],CM=pM[12],DM=pM[13],EM=pM[14],FM=pM[15];return oM[0].setComponents(tM-qM,xM-uM,BM-yM,FM-CM).normalize(),oM[1].setComponents(tM+qM,xM+uM,BM+yM,FM+CM).normalize(),oM[2].setComponents(tM+rM,xM+vM,BM+zM,FM+DM).normalize(),oM[3].setComponents(tM-rM,xM-vM,BM-zM,FM-DM).normalize(),oM[4].setComponents(tM-sM,xM-wM,BM-AM,FM-EM).normalize(),oM[5].setComponents(tM+sM,xM+wM,BM+AM,FM+EM).normalize(),this}intersectsObject(GM){let HM=GM.geometry;return null===HM.boundingSphere&&HM.computeBoundingSphere(),WL.copy(HM.boundingSphere).applyMatrix4(GM.matrixWorld),this.intersectsSphere(WL)}intersectsSprite(IM){return WL.center.set(0,0,0),WL.radius=.7071067811865476,WL.applyMatrix4(IM.matrixWorld),this.intersectsSphere(WL)}intersectsSphere(JM){let KM=this.planes,LM=JM.center,MM=-JM.radius;for(let NM=0;NM<6;NM++)if(KM[NM].distanceToPoint(LM)<MM)return!1;return!0}intersectsBox(OM){let PM=this.planes;for(let QM=0;QM<6;QM++){let RM=PM[QM];if(XL.x=RM.normal.x>0?OM.max.x:OM.min.x,XL.y=RM.normal.y>0?OM.max.y:OM.min.y,XL.z=RM.normal.z>0?OM.max.z:OM.min.z,0>RM.distanceToPoint(XL))return!1}return!0}containsPoint(SM){let TM=this.planes;for(let UM=0;UM<6;UM++)if(0>TM[UM].distanceToPoint(SM))return!1;return!0}clone(){return new this.constructor().copy(this)}};function VM(){let a=null,b=!1,c=null,d=null;function e(b,f){c(b,f),d=a.requestAnimationFrame(e)}return{start:function(){!0!==b&&null!==c&&(d=a.requestAnimationFrame(e),b=!0)},stop:function(){a.cancelAnimationFrame(d),b=!1},setAnimationLoop:function(a){c=a},setContext:function(b){a=b}}}function WM(a,b){let c=b.isWebGL2,d=new WeakMap;return{get:function(a){return a.isInterleavedBufferAttribute&&(a=a.data),d.get(a)},remove:function(b){b.isInterleavedBufferAttribute&&(b=b.data);let c=d.get(b);c&&(a.deleteBuffer(c.buffer),d.delete(b))},update:function(b,e){var f,g,h;if(b.isGLBufferAttribute){let i=d.get(b);(!i||i.version<b.version)&&d.set(b,{buffer:b.buffer,type:b.type,bytesPerElement:b.elementSize,version:b.version});return}b.isInterleavedBufferAttribute&&(b=b.data);let j=d.get(b),k,l;void 0===j?d.set(b,function(b,d){let e=b.array,f=b.usage,g=a.createBuffer();a.bindBuffer(d,g),a.bufferData(d,e,f),b.onUploadCallback();let h;if(e instanceof Float32Array)h=5126;else if(e instanceof Uint16Array)if(b.isFloat16BufferAttribute)if(c)h=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else h=5123;else if(e instanceof Int16Array)h=5122;else if(e instanceof Uint32Array)h=5125;else if(e instanceof Int32Array)h=5124;else if(e instanceof Int8Array)h=5120;else if(e instanceof Uint8Array)h=5121;else if(e instanceof Uint8ClampedArray)h=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+e);return{buffer:g,type:h,bytesPerElement:e.BYTES_PER_ELEMENT,version:b.version}}(b,e)):j.version<b.version&&(f=j.buffer,g=b,h=e,k=g.array,l=g.updateRange,a.bindBuffer(h,f),-1===l.count?a.bufferSubData(h,0,k):(c?a.bufferSubData(h,l.offset*k.BYTES_PER_ELEMENT,k,l.offset,l.count):a.bufferSubData(h,l.offset*k.BYTES_PER_ELEMENT,k.subarray(l.offset,l.offset+l.count)),l.count=-1),g.onUploadCallback(),j.version=b.version)}}}var XM=class extends nE{constructor(YM=1,ZM=1,$M=1,_M=1){super(),this.type="PlaneGeometry",this.parameters={width:YM,height:ZM,widthSegments:$M,heightSegments:_M};let aN=YM/2,bN=ZM/2,cN=Math.floor($M),dN=Math.floor(_M),eN=cN+1,fN=dN+1,gN=YM/cN,hN=ZM/dN,iN=[],jN=[],kN=[],lN=[];for(let mN=0;mN<fN;mN++){let nN=mN*hN-bN;for(let oN=0;oN<eN;oN++){let pN=oN*gN-aN;jN.push(pN,-nN,0),kN.push(0,0,1),lN.push(oN/cN),lN.push(1-mN/dN)}}for(let qN=0;qN<dN;qN++)for(let rN=0;rN<cN;rN++){let sN=rN+eN*qN,tN=rN+eN*(qN+1),uN=rN+1+eN*(qN+1),vN=rN+1+eN*qN;iN.push(sN,tN,vN),iN.push(tN,uN,vN)}this.setIndex(iN),this.setAttribute("position",new cE(jN,3)),this.setAttribute("normal",new cE(kN,3)),this.setAttribute("uv",new cE(lN,2))}static fromJSON(wN){return new XM(wN.width,wN.height,wN.widthSegments,wN.heightSegments)}},xN=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,yN=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,zN=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,AN=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,BN=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,CN=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,DN="vec3 transformed = vec3( position );",EN=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,FN=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,GN=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,HN=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,IN=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,JN=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,KN=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,LN=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,MN=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,NN=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,ON=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,PN=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,QN=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,RN=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,SN=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,TN=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,UN=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,VN=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,WN=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,XN="gl_FragColor = linearToOutputTexel( gl_FragColor );",YN=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,ZN=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,$N=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,_N=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,aO=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,bO=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,cO=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,dO=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,eO=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fO=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gO=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,hO=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,iO=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,jO=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,kO=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lO=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,mO={alphamap_fragment:xN,alphamap_pars_fragment:yN,alphatest_fragment:zN,alphatest_pars_fragment:AN,aomap_fragment:BN,aomap_pars_fragment:CN,begin_vertex:DN,beginnormal_vertex:EN,bsdfs:FN,iridescence_fragment:GN,bumpmap_pars_fragment:HN,clipping_planes_fragment:IN,clipping_planes_pars_fragment:JN,clipping_planes_pars_vertex:KN,clipping_planes_vertex:LN,color_fragment:MN,color_pars_fragment:NN,color_pars_vertex:ON,color_vertex:PN,common:QN,cube_uv_reflection_fragment:RN,defaultnormal_vertex:SN,displacementmap_pars_vertex:TN,displacementmap_vertex:UN,emissivemap_fragment:VN,emissivemap_pars_fragment:WN,encodings_fragment:XN,encodings_pars_fragment:YN,envmap_fragment:ZN,envmap_common_pars_fragment:$N,envmap_pars_fragment:_N,envmap_pars_vertex:aO,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:bO,fog_vertex:cO,fog_pars_vertex:dO,fog_fragment:eO,fog_pars_fragment:fO,gradientmap_pars_fragment:gO,lightmap_fragment:hO,lightmap_pars_fragment:iO,lights_lambert_fragment:jO,lights_lambert_pars_fragment:kO,lights_pars_begin:lO,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},nO={common:{diffuse:{value:new df(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Rc},uv2Transform:{value:new Rc},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Eb(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new df(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new df(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Rc}},sprite:{diffuse:{value:new df(16777215)},opacity:{value:1},center:{value:new Eb(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Rc}}},oO={basic:{uniforms:mJ([nO.common,nO.specularmap,nO.envmap,nO.aomap,nO.lightmap,nO.fog]),vertexShader:mO.meshbasic_vert,fragmentShader:mO.meshbasic_frag},lambert:{uniforms:mJ([nO.common,nO.specularmap,nO.envmap,nO.aomap,nO.lightmap,nO.emissivemap,nO.bumpmap,nO.normalmap,nO.displacementmap,nO.fog,nO.lights,{emissive:{value:new df(0)}}]),vertexShader:mO.meshlambert_vert,fragmentShader:mO.meshlambert_frag},phong:{uniforms:mJ([nO.common,nO.specularmap,nO.envmap,nO.aomap,nO.lightmap,nO.emissivemap,nO.bumpmap,nO.normalmap,nO.displacementmap,nO.fog,nO.lights,{emissive:{value:new df(0)},specular:{value:new df(1118481)},shininess:{value:30}}]),vertexShader:mO.meshphong_vert,fragmentShader:mO.meshphong_frag},standard:{uniforms:mJ([nO.common,nO.envmap,nO.aomap,nO.lightmap,nO.emissivemap,nO.bumpmap,nO.normalmap,nO.displacementmap,nO.roughnessmap,nO.metalnessmap,nO.fog,nO.lights,{emissive:{value:new df(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:mO.meshphysical_vert,fragmentShader:mO.meshphysical_frag},toon:{uniforms:mJ([nO.common,nO.aomap,nO.lightmap,nO.emissivemap,nO.bumpmap,nO.normalmap,nO.displacementmap,nO.gradientmap,nO.fog,nO.lights,{emissive:{value:new df(0)}}]),vertexShader:mO.meshtoon_vert,fragmentShader:mO.meshtoon_frag},matcap:{uniforms:mJ([nO.common,nO.bumpmap,nO.normalmap,nO.displacementmap,nO.fog,{matcap:{value:null}}]),vertexShader:mO.meshmatcap_vert,fragmentShader:mO.meshmatcap_frag},points:{uniforms:mJ([nO.points,nO.fog]),vertexShader:mO.points_vert,fragmentShader:mO.points_frag},dashed:{uniforms:mJ([nO.common,nO.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:mO.linedashed_vert,fragmentShader:mO.linedashed_frag},depth:{uniforms:mJ([nO.common,nO.displacementmap]),vertexShader:mO.depth_vert,fragmentShader:mO.depth_frag},normal:{uniforms:mJ([nO.common,nO.bumpmap,nO.normalmap,nO.displacementmap,{opacity:{value:1}}]),vertexShader:mO.meshnormal_vert,fragmentShader:mO.meshnormal_frag},sprite:{uniforms:mJ([nO.sprite,nO.fog]),vertexShader:mO.sprite_vert,fragmentShader:mO.sprite_frag},background:{uniforms:{uvTransform:{value:new Rc},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:mO.background_vert,fragmentShader:mO.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:mO.backgroundCube_vert,fragmentShader:mO.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:mO.cube_vert,fragmentShader:mO.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:mO.equirect_vert,fragmentShader:mO.equirect_frag},distanceRGBA:{uniforms:mJ([nO.common,nO.displacementmap,{referencePosition:{value:new fm},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:mO.distanceRGBA_vert,fragmentShader:mO.distanceRGBA_frag},shadow:{uniforms:mJ([nO.lights,nO.fog,{color:{value:new df(0)},opacity:{value:1}}]),vertexShader:mO.shadow_vert,fragmentShader:mO.shadow_frag}};oO.physical={uniforms:mJ([oO.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Eb(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new df(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Eb},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new df(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new df(1,1,1)},specularColorMap:{value:null}}]),vertexShader:mO.meshphysical_vert,fragmentShader:mO.meshphysical_frag};var pO={r:0,b:0,g:0};function qO(a,b,c,d,e,f,g){let h=new df(0),i=!0===f?0:1,j,k,l=null,m=0,n=null;function o(b,c){b.getRGB(pO,nJ(a)),d.buffers.color.setClear(pO.r,pO.g,pO.b,c,g)}return{getClearColor:function(){return h},setClearColor:function(a,b=1){h.set(a),o(h,i=b)},getClearAlpha:function(){return i},setClearAlpha:function(a){o(h,i=a)},render:function(d,f){let g=!1,p=!0===f.isScene?f.background:null;p&&p.isTexture&&(p=(f.backgroundBlurriness>0?c:b).get(p));let q=a.xr,r=q.getSession&&q.getSession();r&&"additive"===r.environmentBlendMode&&(p=null),null===p?o(h,i):p&&p.isColor&&(o(p,1),g=!0),(a.autoClear||g)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil),p&&(p.isCubeTexture||p.mapping===oa)?(void 0===k&&((k=new GH(new XI(1,1,1),new pJ({name:"BackgroundCubeMaterial",uniforms:lJ(oO.backgroundCube.uniforms),vertexShader:oO.backgroundCube.vertexShader,fragmentShader:oO.backgroundCube.fragmentShader,side:Q,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),k.geometry.deleteAttribute("uv"),k.onBeforeRender=function(a,b,c){this.matrixWorld.copyPosition(c.matrixWorld)},Object.defineProperty(k.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),e.update(k)),k.material.uniforms.envMap.value=p,k.material.uniforms.flipEnvMap.value=p.isCubeTexture&& !1===p.isRenderTargetTexture?-1:1,k.material.uniforms.backgroundBlurriness.value=f.backgroundBlurriness,k.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,k.material.toneMapped=p.encoding!==Ta,(l!==p||m!==p.version||n!==a.toneMapping)&&(k.material.needsUpdate=!0,l=p,m=p.version,n=a.toneMapping),k.layers.enableAll(),d.unshift(k,k.geometry,k.material,0,0,null)):p&&p.isTexture&&(void 0===j&&((j=new GH(new XM(2,2),new pJ({name:"BackgroundMaterial",uniforms:lJ(oO.background.uniforms),vertexShader:oO.background.vertexShader,fragmentShader:oO.background.fragmentShader,side:P,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(j.material,"map",{get:function(){return this.uniforms.t2D.value}}),e.update(j)),j.material.uniforms.t2D.value=p,j.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,j.material.toneMapped=p.encoding!==Ta,!0===p.matrixAutoUpdate&&p.updateMatrix(),j.material.uniforms.uvTransform.value.copy(p.matrix),(l!==p||m!==p.version||n!==a.toneMapping)&&(j.material.needsUpdate=!0,l=p,m=p.version,n=a.toneMapping),j.layers.enableAll(),d.unshift(j,j.geometry,j.material,0,0,null))}}}function rO(a,b,c,d){let e=a.getParameter(34921),f=d.isWebGL2?null:b.get("OES_vertex_array_object"),g=d.isWebGL2||null!==f,h={},i=n(null),j=i,k=!1;function l(b){return d.isWebGL2?a.bindVertexArray(b):f.bindVertexArrayOES(b)}function m(b){return d.isWebGL2?a.deleteVertexArray(b):f.deleteVertexArrayOES(b)}function n(a){let b=[],c=[],d=[];for(let f=0;f<e;f++)b[f]=0,c[f]=0,d[f]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:b,enabledAttributes:c,attributeDivisors:d,object:a,attributes:{},index:null}}function o(){let a=j.newAttributes;for(let b=0,c=a.length;b<c;b++)a[b]=0}function p(a){q(a,0)}function q(c,e){let f=j.newAttributes,g=j.enabledAttributes,h=j.attributeDivisors;f[c]=1,0===g[c]&&(a.enableVertexAttribArray(c),g[c]=1),h[c]!==e&&((d.isWebGL2?a:b.get("ANGLE_instanced_arrays"))[d.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](c,e),h[c]=e)}function r(){let b=j.newAttributes,c=j.enabledAttributes;for(let d=0,e=c.length;d<e;d++)c[d]!==b[d]&&(a.disableVertexAttribArray(d),c[d]=0)}function s(b,c,e,f,g,h){!0===d.isWebGL2&&(5124===e||5125===e)?a.vertexAttribIPointer(b,c,e,g,h):a.vertexAttribPointer(b,c,e,f,g,h)}function t(){u(),k=!0,j!==i&&l((j=i).object)}function u(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:function(e,i,m,t,u){let v=!1;if(g){var w,x;let y,z,A,B,C=(w=t,x=m,y=!0===i.wireframe,void 0===(z=h[w.id])&&(z={},h[w.id]=z),void 0===(A=z[x.id])&&(A={},z[x.id]=A),void 0===(B=A[y])&&(B=n(d.isWebGL2?a.createVertexArray():f.createVertexArrayOES()),A[y]=B),B);j!==C&&l((j=C).object),(v=(function(a,b,c,d){let e=j.attributes,f=b.attributes,g=0,h=c.getAttributes();for(let i in h)if(h[i].location>=0){let k=e[i],l=f[i];if(void 0===l&&("instanceMatrix"===i&&a.instanceMatrix&&(l=a.instanceMatrix),"instanceColor"===i&&a.instanceColor&&(l=a.instanceColor)),void 0===k||k.attribute!==l||l&&k.data!==l.data)return!0;g++}return j.attributesNum!==g||j.index!==d})(e,t,m,u))&&(function(a,b,c,d){let e={},f=b.attributes,g=0,h=c.getAttributes();for(let i in h)if(h[i].location>=0){let k=f[i];void 0===k&&("instanceMatrix"===i&&a.instanceMatrix&&(k=a.instanceMatrix),"instanceColor"===i&&a.instanceColor&&(k=a.instanceColor));let l={};l.attribute=k,k&&k.data&&(l.data=k.data),e[i]=l,g++}j.attributes=e,j.attributesNum=g,j.index=d})(e,t,m,u)}else{let D=!0===i.wireframe;(j.geometry!==t.id||j.program!==m.id||j.wireframe!==D)&&(j.geometry=t.id,j.program=m.id,j.wireframe=D,v=!0)}null!==u&&c.update(u,34963),(v||k)&&(k=!1,(function(e,f,g,h){if(!1===d.isWebGL2&&(e.isInstancedMesh||h.isInstancedBufferGeometry)&&null===b.get("ANGLE_instanced_arrays"))return;o();let i=h.attributes,j=g.getAttributes(),k=f.defaultAttributeValues;for(let l in j){let m=j[l];if(m.location>=0){let n=i[l];if(void 0===n&&("instanceMatrix"===l&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(n=e.instanceColor)),void 0!==n){let t=n.normalized,u=n.itemSize,v=c.get(n);if(void 0===v)continue;let w=v.buffer,x=v.type,y=v.bytesPerElement;if(n.isInterleavedBufferAttribute){let z=n.data,A=z.stride,B=n.offset;if(z.isInstancedInterleavedBuffer){for(let C=0;C<m.locationSize;C++)q(m.location+C,z.meshPerAttribute);!0!==e.isInstancedMesh&& void 0===h._maxInstanceCount&&(h._maxInstanceCount=z.meshPerAttribute*z.count)}else for(let D=0;D<m.locationSize;D++)p(m.location+D);a.bindBuffer(34962,w);for(let E=0;E<m.locationSize;E++)s(m.location+E,u/m.locationSize,x,t,A*y,(B+u/m.locationSize*E)*y)}else{if(n.isInstancedBufferAttribute){for(let F=0;F<m.locationSize;F++)q(m.location+F,n.meshPerAttribute);!0!==e.isInstancedMesh&& void 0===h._maxInstanceCount&&(h._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let G=0;G<m.locationSize;G++)p(m.location+G);a.bindBuffer(34962,w);for(let H=0;H<m.locationSize;H++)s(m.location+H,u/m.locationSize,x,t,u*y,u/m.locationSize*H*y)}}else if(void 0!==k){let I=k[l];if(void 0!==I)switch(I.length){case 2:a.vertexAttrib2fv(m.location,I);break;case 3:a.vertexAttrib3fv(m.location,I);break;case 4:a.vertexAttrib4fv(m.location,I);break;default:a.vertexAttrib1fv(m.location,I)}}}}r()})(e,i,m,t),null!==u&&a.bindBuffer(34963,c.get(u).buffer))},reset:t,resetDefaultState:u,dispose:function(){for(let a in t(),h){let b=h[a];for(let c in b){let d=b[c];for(let e in d)m(d[e].object),delete d[e];delete b[c]}delete h[a]}},releaseStatesOfGeometry:function(a){if(void 0===h[a.id])return;let b=h[a.id];for(let c in b){let d=b[c];for(let e in d)m(d[e].object),delete d[e];delete b[c]}delete h[a.id]},releaseStatesOfProgram:function(a){for(let b in h){let c=h[b];if(void 0===c[a.id])continue;let d=c[a.id];for(let e in d)m(d[e].object),delete d[e];delete c[a.id]}},initAttributes:o,enableAttribute:p,disableUnusedAttributes:r}}function sO(a,b,c,d){let e=d.isWebGL2,f;this.setMode=function(a){f=a},this.render=function(b,d){a.drawArrays(f,b,d),c.update(d,f,1)},this.renderInstances=function(d,g,h){if(0===h)return;let i,j;if(e)i=a,j="drawArraysInstanced";else if(j="drawArraysInstancedANGLE",null===(i=b.get("ANGLE_instanced_arrays"))){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}i[j](f,d,g,h),c.update(g,f,h)}}function tO(a,b,c){let d;function e(b){if("highp"===b){if(a.getShaderPrecisionFormat(35633,36338).precision>0&&a.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";b="mediump"}return"mediump"===b&&a.getShaderPrecisionFormat(35633,36337).precision>0&&a.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let f="u">typeof WebGL2RenderingContext&&a instanceof WebGL2RenderingContext,g=void 0!==c.precision?c.precision:"highp",h=e(g);h!==g&&(console.warn("THREE.WebGLRenderer:",g,"not supported, using",h,"instead."),g=h);let i=f||b.has("WEBGL_draw_buffers"),j=!0===c.logarithmicDepthBuffer,k=a.getParameter(34930),l=a.getParameter(35660),m=a.getParameter(3379),n=a.getParameter(34076),o=a.getParameter(34921),p=a.getParameter(36347),q=a.getParameter(36348),r=a.getParameter(36349),s=l>0,t=f||b.has("OES_texture_float"),u=f?a.getParameter(36183):0;return{isWebGL2:f,drawBuffers:i,getMaxAnisotropy:function(){if(void 0!==d)return d;if(!0===b.has("EXT_texture_filter_anisotropic")){let c=b.get("EXT_texture_filter_anisotropic");d=a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else d=0;return d},getMaxPrecision:e,precision:g,logarithmicDepthBuffer:j,maxTextures:k,maxVertexTextures:l,maxTextureSize:m,maxCubemapSize:n,maxAttributes:o,maxVertexUniforms:p,maxVaryings:q,maxFragmentUniforms:r,vertexTextures:s,floatFragmentTextures:t,floatVertexTextures:s&&t,maxSamples:u}}function uO(a){let b=this,c=null,d=0,e=!1,f=!1,g=new jL,h=new Rc,i={value:null,needsUpdate:!1};function j(a,c,d,e){let f=null!==a?a.length:0,j=null;if(0!==f){if(j=i.value,!0!==e||null===j){let k=d+4*f,l=c.matrixWorldInverse;h.getNormalMatrix(l),(null===j||j.length<k)&&(j=new Float32Array(k));for(let m=0,n=d;m!==f;++m,n+=4)g.copy(a[m]).applyMatrix4(l,h),g.normal.toArray(j,n),j[n+3]=g.constant}i.value=j,i.needsUpdate=!0}return b.numPlanes=f,b.numIntersection=0,j}this.uniform=i,this.numPlanes=0,this.numIntersection=0,this.init=function(a,b){let c=0!==a.length||b||0!==d||e;return e=b,d=a.length,c},this.beginShadows=function(){f=!0,j(null)},this.endShadows=function(){f=!1},this.setGlobalState=function(a,b){c=j(a,b,0)},this.setState=function(g,h,k){let l=g.clippingPlanes,m=g.clipIntersection,n=g.clipShadows,o=a.get(g);if(e&&null!==l&&0!==l.length&&(!f||n)){let p=f?0:d,q=4*p,r=o.clippingState||null;i.value=r,r=j(l,h,q,k);for(let s=0;s!==q;++s)r[s]=c[s];o.clippingState=r,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=p}else f?j(null):(i.value!==c&&(i.value=c,i.needsUpdate=d>0),b.numPlanes=d,b.numIntersection=0)}}function vO(a){let b=new WeakMap;function c(a,b){return b===ma?a.mapping=ka:b===na&&(a.mapping=la),a}function d(a){let c=a.target;c.removeEventListener("dispose",d);let e=b.get(c);void 0!==e&&(b.delete(c),e.dispose())}return{get:function(e){if(e&&e.isTexture&& !1===e.isRenderTargetTexture){let f=e.mapping;if(f===ma||f===na)if(b.has(e))return c(b.get(e).texture,e.mapping);else{let g=e.image;if(!g||!(g.height>0))return null;{let h=new QK(g.height/2);return h.fromEquirectangularTexture(a,e),b.set(e,h),e.addEventListener("dispose",d),c(h.texture,e.mapping)}}}return e},dispose:function(){b=new WeakMap}}}var wO=class extends yJ{constructor(xO=-1,yO=1,zO=1,AO=-1,BO=.1,CO=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=xO,this.right=yO,this.top=zO,this.bottom=AO,this.near=BO,this.far=CO,this.updateProjectionMatrix()}copy(DO,EO){return super.copy(DO,EO),this.left=DO.left,this.right=DO.right,this.top=DO.top,this.bottom=DO.bottom,this.near=DO.near,this.far=DO.far,this.zoom=DO.zoom,this.view=null===DO.view?null:Object.assign({},DO.view),this}setViewOffset(FO,GO,HO,IO,JO,KO){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=FO,this.view.fullHeight=GO,this.view.offsetX=HO,this.view.offsetY=IO,this.view.width=JO,this.view.height=KO,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let LO=(this.right-this.left)/(2*this.zoom),MO=(this.top-this.bottom)/(2*this.zoom),NO=(this.right+this.left)/2,OO=(this.top+this.bottom)/2,PO=NO-LO,QO=NO+LO,RO=OO+MO,SO=OO-MO;if(null!==this.view&&this.view.enabled){let TO=(this.right-this.left)/this.view.fullWidth/this.zoom,UO=(this.top-this.bottom)/this.view.fullHeight/this.zoom;QO=(PO+=TO*this.view.offsetX)+TO*this.view.width,SO=(RO-=UO*this.view.offsetY)-UO*this.view.height}this.projectionMatrix.makeOrthographic(PO,QO,RO,SO,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(VO){let WO=super.toJSON(VO);return WO.object.zoom=this.zoom,WO.object.left=this.left,WO.object.right=this.right,WO.object.top=this.top,WO.object.bottom=this.bottom,WO.object.near=this.near,WO.object.far=this.far,null!==this.view&&(WO.object.view=Object.assign({},this.view)),WO}},XO=4,YO=[.125,.215,.35,.446,.526,.582],ZO=20,$O=new wO,_O=new df,aP=null,bP=(1+Math.sqrt(5))/2,cP=1/bP,dP=[new fm(1,1,1),new fm(-1,1,1),new fm(1,1,-1),new fm(-1,1,-1),new fm(0,bP,cP),new fm(0,bP,-cP),new fm(cP,0,bP),new fm(-cP,0,bP),new fm(bP,cP,0),new fm(-bP,cP,0)],eP=class{constructor(fP){this._renderer=fP,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(gP,hP=0,iP=.1,jP=100){aP=this._renderer.getRenderTarget(),this._setSize(256);let kP=this._allocateTargets();return kP.depthBuffer=!0,this._sceneToCubeUV(gP,iP,jP,kP),hP>0&&this._blur(kP,0,0,hP),this._applyPMREM(kP),this._cleanup(kP),kP}fromEquirectangular(lP,mP=null){return this._fromTexture(lP,mP)}fromCubemap(nP,oP=null){return this._fromTexture(nP,oP)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=OQ(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=NQ(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(pP){this._lodMax=Math.floor(Math.log2(pP)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let qP=0;qP<this._lodPlanes.length;qP++)this._lodPlanes[qP].dispose()}_cleanup(rP){this._renderer.setRenderTarget(aP),rP.scissorTest=!1,LQ(rP,0,0,rP.width,rP.height)}_fromTexture(sP,tP){sP.mapping===ka||sP.mapping===la?this._setSize(0===sP.image.length?16:sP.image[0].width||sP.image[0].image.width):this._setSize(sP.image.width/4),aP=this._renderer.getRenderTarget();let uP=tP||this._allocateTargets();return this._textureToCubeUV(sP,uP),this._applyPMREM(uP),this._cleanup(uP),uP}_allocateTargets(){let vP=3*Math.max(this._cubeSize,112),wP=4*this._cubeSize,xP={magFilter:va,minFilter:va,generateMipmaps:!1,type:Ba,format:Da,encoding:Sa,depthBuffer:!1},yP=KQ(vP,wP,xP);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==vP||this._pingPongRenderTarget.height!==wP){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=KQ(vP,wP,xP);let{_lodMax:zP}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=JQ(zP)),this._blurMaterial=MQ(zP,vP,wP)}return yP}_compileMaterial(AP){let BP=new GH(this._lodPlanes[0],AP);this._renderer.compile(BP,$O)}_sceneToCubeUV(CP,DP,EP,FP){let GP=new GJ(90,1,DP,EP),HP=[1,-1,1,1,1,1],IP=[1,1,1,-1,-1,-1],JP=this._renderer,KP=JP.autoClear,LP=JP.toneMapping;JP.getClearColor(_O),JP.toneMapping=ia,JP.autoClear=!1;let MP=new MC({name:"PMREM.Background",side:Q,depthWrite:!1,depthTest:!1}),NP=new GH(new XI,MP),OP=!1,PP=CP.background;PP?PP.isColor&&(MP.color.copy(PP),CP.background=null,OP=!0):(MP.color.copy(_O),OP=!0);for(let QP=0;QP<6;QP++){let RP=QP%3;0===RP?(GP.up.set(0,HP[QP],0),GP.lookAt(IP[QP],0,0)):1===RP?(GP.up.set(0,0,HP[QP]),GP.lookAt(0,IP[QP],0)):(GP.up.set(0,HP[QP],0),GP.lookAt(0,0,IP[QP]));let SP=this._cubeSize;LQ(FP,RP*SP,QP>2?SP:0,SP,SP),JP.setRenderTarget(FP),OP&&JP.render(NP,GP),JP.render(CP,GP)}NP.geometry.dispose(),NP.material.dispose(),JP.toneMapping=LP,JP.autoClear=KP,CP.background=PP}_textureToCubeUV(TP,UP){let VP=this._renderer,WP=TP.mapping===ka||TP.mapping===la;WP?(null===this._cubemapMaterial&&(this._cubemapMaterial=OQ()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===TP.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=NQ());let XP=WP?this._cubemapMaterial:this._equirectMaterial,YP=new GH(this._lodPlanes[0],XP),ZP=XP.uniforms;ZP.envMap.value=TP;let $P=this._cubeSize;LQ(UP,0,0,3*$P,2*$P),VP.setRenderTarget(UP),VP.render(YP,$O)}_applyPMREM(_P){let aQ=this._renderer,bQ=aQ.autoClear;aQ.autoClear=!1;for(let cQ=1;cQ<this._lodPlanes.length;cQ++){let dQ=Math.sqrt(this._sigmas[cQ]*this._sigmas[cQ]-this._sigmas[cQ-1]*this._sigmas[cQ-1]),eQ=dP[(cQ-1)%dP.length];this._blur(_P,cQ-1,cQ,dQ,eQ)}aQ.autoClear=bQ}_blur(fQ,gQ,hQ,iQ,jQ){let kQ=this._pingPongRenderTarget;this._halfBlur(fQ,kQ,gQ,hQ,iQ,"latitudinal",jQ),this._halfBlur(kQ,fQ,hQ,hQ,iQ,"longitudinal",jQ)}_halfBlur(lQ,mQ,nQ,oQ,pQ,qQ,rQ){let sQ=this._renderer,tQ=this._blurMaterial;"latitudinal"!==qQ&&"longitudinal"!==qQ&&console.error("blur direction must be either latitudinal or longitudinal!");let uQ=3,vQ=new GH(this._lodPlanes[oQ],tQ),wQ=tQ.uniforms,xQ=this._sizeLods[nQ]-1,yQ=isFinite(pQ)?Math.PI/(2*xQ):2*Math.PI/(2*ZO-1),zQ=pQ/yQ,AQ=isFinite(pQ)?1+Math.floor(uQ*zQ):ZO;AQ>ZO&&console.warn(`sigmaRadians, ${pQ}, is too large and will clip, as it requested ${AQ} samples when the maximum is set to ${ZO}`);let BQ=[],CQ=0;for(let DQ=0;DQ<ZO;++DQ){let EQ=DQ/zQ,FQ=Math.exp(-EQ*EQ/2);BQ.push(FQ),0===DQ?CQ+=FQ:DQ<AQ&&(CQ+=2*FQ)}for(let GQ=0;GQ<BQ.length;GQ++)BQ[GQ]=BQ[GQ]/CQ;wQ.envMap.value=lQ.texture,wQ.samples.value=AQ,wQ.weights.value=BQ,wQ.latitudinal.value="latitudinal"===qQ,rQ&&(wQ.poleAxis.value=rQ);let{_lodMax:HQ}=this;wQ.dTheta.value=yQ,wQ.mipInt.value=HQ-nQ;let IQ=this._sizeLods[oQ];LQ(mQ,3*IQ*(oQ>HQ-XO?oQ-HQ+XO:0),4*(this._cubeSize-IQ),3*IQ,2*IQ),sQ.setRenderTarget(mQ),sQ.render(vQ,$O)}};function JQ(a){let b=[],c=[],d=[],e=a,f=a-XO+1+YO.length;for(let g=0;g<f;g++){let h=Math.pow(2,e);c.push(h);let i=1/h;g>a-XO?i=YO[g-a+XO-1]:0===g&&(i=0),d.push(i);let j=1/(h-2),k=-j,l=1+j,m=[k,k,l,k,l,l,k,k,l,l,k,l],n=6,o=6,p=3,q=2,r=1,s=new Float32Array(p*o*n),t=new Float32Array(q*o*n),u=new Float32Array(r*o*n);for(let v=0;v<n;v++){let w=v%3*2/3-1,x=v>2?0:-1,y=[w,x,0,w+2/3,x,0,w+2/3,x+1,0,w,x,0,w+2/3,x+1,0,w,x+1,0];s.set(y,p*o*v),t.set(m,q*o*v);let z=[v,v,v,v,v,v];u.set(z,r*o*v)}let A=new nE;A.setAttribute("position",new RC(s,p)),A.setAttribute("uv",new RC(t,q)),A.setAttribute("faceIndex",new RC(u,r)),b.push(A),e>XO&&e--}return{lodPlanes:b,sizeLods:c,sigmas:d}}function KQ(a,b,c){let d=new Yi(a,b,c);return d.texture.mapping=oa,d.texture.name="PMREM.cubeUv",d.scissorTest=!0,d}function LQ(a,b,c,d,e){a.viewport.set(b,c,d,e),a.scissor.set(b,c,d,e)}function MQ(a,b,c){let d=new Float32Array(ZO),e=new fm(0,1,0);return new pJ({name:"SphericalGaussianBlur",defines:{n:ZO,CUBEUV_TEXEL_WIDTH:1/b,CUBEUV_TEXEL_HEIGHT:1/c,CUBEUV_MAX_MIP:`${a}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:d},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:e}},vertexShader:PQ(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:S,depthTest:!1,depthWrite:!1})}function NQ(){return new pJ({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:PQ(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:S,depthTest:!1,depthWrite:!1})}function OQ(){return new pJ({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:PQ(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:S,depthTest:!1,depthWrite:!1})}function PQ(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function QQ(a){let b=new WeakMap,c=null;function d(a){let c=a.target;c.removeEventListener("dispose",d);let e=b.get(c);void 0!==e&&(b.delete(c),e.dispose())}return{get:function(e){if(e&&e.isTexture){let f=e.mapping,g=f===ma||f===na,h=f===ka||f===la;if(g||h)if(e.isRenderTargetTexture&& !0===e.needsPMREMUpdate){e.needsPMREMUpdate=!1;let i=b.get(e);return null===c&&(c=new eP(a)),i=g?c.fromEquirectangular(e,i):c.fromCubemap(e,i),b.set(e,i),i.texture}else{if(b.has(e))return b.get(e).texture;{let j=e.image;if(!(g&&j&&j.height>0||h&&j&&function(a){let b=0;for(let c=0;c<6;c++)void 0!==a[c]&&b++;return 6===b}(j)))return null;{null===c&&(c=new eP(a));let k=g?c.fromEquirectangular(e):c.fromCubemap(e);return b.set(e,k),e.addEventListener("dispose",d),k.texture}}}}return e},dispose:function(){b=new WeakMap,null!==c&&(c.dispose(),c=null)}}}function RQ(a){let b={};function c(c){if(void 0!==b[c])return b[c];let d;switch(c){case"WEBGL_depth_texture":d=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":d=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":d=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":d=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:d=a.getExtension(c)}return b[c]=d,d}return{has:function(a){return null!==c(a)},init:function(a){a.isWebGL2?c("EXT_color_buffer_float"):(c("WEBGL_depth_texture"),c("OES_texture_float"),c("OES_texture_half_float"),c("OES_texture_half_float_linear"),c("OES_standard_derivatives"),c("OES_element_index_uint"),c("OES_vertex_array_object"),c("ANGLE_instanced_arrays")),c("OES_texture_float_linear"),c("EXT_color_buffer_half_float"),c("WEBGL_multisampled_render_to_texture")},get:function(a){let b=c(a);return null===b&&console.warn("THREE.WebGLRenderer: "+a+" extension not supported."),b}}}function SQ(a,b,c,d){let e={},f=new WeakMap;function g(a){let h=a.target;for(let i in null!==h.index&&b.remove(h.index),h.attributes)b.remove(h.attributes[i]);h.removeEventListener("dispose",g),delete e[h.id];let j=f.get(h);j&&(b.remove(j),f.delete(h)),d.releaseStatesOfGeometry(h),!0===h.isInstancedBufferGeometry&&delete h._maxInstanceCount,c.memory.geometries--}function h(a){let c=[],d=a.index,e=a.attributes.position,g=0;if(null!==d){let h=d.array;g=d.version;for(let i=0,j=h.length;i<j;i+=3){let k=h[i+0],l=h[i+1],m=h[i+2];c.push(k,l,l,m,m,k)}}else{let n=e.array;g=e.version;for(let o=0,p=n.length/3-1;o<p;o+=3){let q=o+0,r=o+1,s=o+2;c.push(q,r,r,s,s,q)}}let t=new(Re(c)?$D:WD)(c,1);t.version=g;let u=f.get(a);u&&b.remove(u),f.set(a,t)}return{get:function(a,b){return!0===e[b.id]||(b.addEventListener("dispose",g),e[b.id]=!0,c.memory.geometries++),b},update:function(a){let c=a.attributes;for(let d in c)b.update(c[d],34962);let e=a.morphAttributes;for(let f in e){let g=e[f];for(let h=0,i=g.length;h<i;h++)b.update(g[h],34962)}},getWireframeAttribute:function(a){let b=f.get(a);if(b){let c=a.index;null!==c&&b.version<c.version&&h(a)}else h(a);return f.get(a)}}}function TQ(a,b,c,d){let e=d.isWebGL2,f,g,h;this.setMode=function(a){f=a},this.setIndex=function(a){g=a.type,h=a.bytesPerElement},this.render=function(b,d){a.drawElements(f,d,g,b*h),c.update(d,f,1)},this.renderInstances=function(d,i,j){if(0===j)return;let k,l;if(e)k=a,l="drawElementsInstanced";else if(l="drawElementsInstancedANGLE",null===(k=b.get("ANGLE_instanced_arrays"))){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}k[l](f,i,g,d*h,j),c.update(i,f,j)}}function UQ(a){let b={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:b,programs:null,autoReset:!0,reset:function(){b.frame++,b.calls=0,b.triangles=0,b.points=0,b.lines=0},update:function(a,c,d){switch(b.calls++,c){case 4:b.triangles+=d*(a/3);break;case 1:b.lines+=d*(a/2);break;case 3:b.lines+=d*(a-1);break;case 2:b.lines+=d*a;break;case 0:b.points+=d*a;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",c);break}}}}function VQ(a,b){return a[0]-b[0]}function WQ(a,b){return Math.abs(b[1])-Math.abs(a[1])}function XQ(a,b,c){let d={},e=new Float32Array(8),f=new WeakMap,g=new sh,h=[];for(let i=0;i<8;i++)h[i]=[i,0];return{update:function(i,j,k,l){let m=i.morphTargetInfluences;if(!0===b.isWebGL2){let n=j.morphAttributes.position||j.morphAttributes.normal||j.morphAttributes.color,o=void 0!==n?n.length:0,p=f.get(j);if(void 0===p||p.count!==o){let q=function(){B.dispose(),f.delete(j),j.removeEventListener("dispose",q)};void 0!==p&&p.texture.dispose();let r=void 0!==j.morphAttributes.position,s=void 0!==j.morphAttributes.normal,t=void 0!==j.morphAttributes.color,u=j.morphAttributes.position||[],v=j.morphAttributes.normal||[],w=j.morphAttributes.color||[],x=0;!0===r&&(x=1),!0===s&&(x=2),!0===t&&(x=3);let y=j.attributes.position.count*x,z=1;y>b.maxTextureSize&&(z=Math.ceil(y/b.maxTextureSize),y=b.maxTextureSize);let A=new Float32Array(y*z*4*o),B=new gj(A,y,z,o);B.type=Aa,B.needsUpdate=!0;let C=4*x;for(let D=0;D<o;D++){let E=u[D],F=v[D],G=w[D],H=y*z*4*D;for(let I=0;I<E.count;I++){let J=I*C;!0===r&&(g.fromBufferAttribute(E,I),A[H+J+0]=g.x,A[H+J+1]=g.y,A[H+J+2]=g.z,A[H+J+3]=0),!0===s&&(g.fromBufferAttribute(F,I),A[H+J+4]=g.x,A[H+J+5]=g.y,A[H+J+6]=g.z,A[H+J+7]=0),!0===t&&(g.fromBufferAttribute(G,I),A[H+J+8]=g.x,A[H+J+9]=g.y,A[H+J+10]=g.z,A[H+J+11]=4===G.itemSize?g.w:1)}}p={count:o,texture:B,size:new Eb(y,z)},f.set(j,p),j.addEventListener("dispose",q)}let K=0;for(let L=0;L<m.length;L++)K+=m[L];let M=j.morphTargetsRelative?1:1-K;l.getUniforms().setValue(a,"morphTargetBaseInfluence",M),l.getUniforms().setValue(a,"morphTargetInfluences",m),l.getUniforms().setValue(a,"morphTargetsTexture",p.texture,c),l.getUniforms().setValue(a,"morphTargetsTextureSize",p.size)}else{let N=void 0===m?0:m.length,O=d[j.id];if(void 0===O||O.length!==N){O=[];for(let P=0;P<N;P++)O[P]=[P,0];d[j.id]=O}for(let Q=0;Q<N;Q++){let R=O[Q];R[0]=Q,R[1]=m[Q]}O.sort(WQ);for(let S=0;S<8;S++)S<N&&O[S][1]?(h[S][0]=O[S][0],h[S][1]=O[S][1]):(h[S][0]=Number.MAX_SAFE_INTEGER,h[S][1]=0);h.sort(VQ);let T=j.morphAttributes.position,U=j.morphAttributes.normal,V=0;for(let W=0;W<8;W++){let X=h[W],Y=X[0],Z=X[1];Y!==Number.MAX_SAFE_INTEGER&&Z?(T&&j.getAttribute("morphTarget"+W)!==T[Y]&&j.setAttribute("morphTarget"+W,T[Y]),U&&j.getAttribute("morphNormal"+W)!==U[Y]&&j.setAttribute("morphNormal"+W,U[Y]),e[W]=Z,V+=Z):(T&& !0===j.hasAttribute("morphTarget"+W)&&j.deleteAttribute("morphTarget"+W),U&& !0===j.hasAttribute("morphNormal"+W)&&j.deleteAttribute("morphNormal"+W),e[W]=0)}let $=j.morphTargetsRelative?1:1-V;l.getUniforms().setValue(a,"morphTargetBaseInfluence",$),l.getUniforms().setValue(a,"morphTargetInfluences",e)}}}}function YQ(a,b,c,d){let e=new WeakMap;function f(a){let b=a.target;b.removeEventListener("dispose",f),c.remove(b.instanceMatrix),null!==b.instanceColor&&c.remove(b.instanceColor)}return{update:function(a){let g=d.render.frame,h=a.geometry,i=b.get(a,h);return e.get(i)!==g&&(b.update(i),e.set(i,g)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",f)&&a.addEventListener("dispose",f),c.update(a.instanceMatrix,34962),null!==a.instanceColor&&c.update(a.instanceColor,34962)),i},dispose:function(){e=new WeakMap}}}var ZQ=new ah,$Q=new gj,_Q=new lj,aR=new EK,bR=[],cR=[],dR=new Float32Array(16),eR=new Float32Array(9),fR=new Float32Array(4);function gR(a,b,c){let d=a[0];if(d<=0||d>0)return a;let e=b*c,f=bR[e];if(void 0===f&&(f=new Float32Array(e),bR[e]=f),0!==b){d.toArray(f,0);for(let g=1,h=0;g!==b;++g)h+=c,a[g].toArray(f,h)}return f}function hR(a,b){if(a.length!==b.length)return!1;for(let c=0,d=a.length;c<d;c++)if(a[c]!==b[c])return!1;return!0}function iR(a,b){for(let c=0,d=b.length;c<d;c++)a[c]=b[c]}function jR(a,b){let c=cR[b];void 0===c&&(c=new Int32Array(b),cR[b]=c);for(let d=0;d!==b;++d)c[d]=a.allocateTextureUnit();return c}function kR(a,b){let c=this.cache;c[0]!==b&&(a.uniform1f(this.addr,b),c[0]=b)}function lR(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y)&&(a.uniform2f(this.addr,b.x,b.y),c[0]=b.x,c[1]=b.y);else{if(hR(c,b))return;a.uniform2fv(this.addr,b),iR(c,b)}}function mR(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z)&&(a.uniform3f(this.addr,b.x,b.y,b.z),c[0]=b.x,c[1]=b.y,c[2]=b.z);else if(void 0!==b.r)(c[0]!==b.r||c[1]!==b.g||c[2]!==b.b)&&(a.uniform3f(this.addr,b.r,b.g,b.b),c[0]=b.r,c[1]=b.g,c[2]=b.b);else{if(hR(c,b))return;a.uniform3fv(this.addr,b),iR(c,b)}}function nR(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z||c[3]!==b.w)&&(a.uniform4f(this.addr,b.x,b.y,b.z,b.w),c[0]=b.x,c[1]=b.y,c[2]=b.z,c[3]=b.w);else{if(hR(c,b))return;a.uniform4fv(this.addr,b),iR(c,b)}}function oR(a,b){let c=this.cache,d=b.elements;if(void 0===d){if(hR(c,b))return;a.uniformMatrix2fv(this.addr,!1,b),iR(c,b)}else{if(hR(c,d))return;fR.set(d),a.uniformMatrix2fv(this.addr,!1,fR),iR(c,d)}}function pR(a,b){let c=this.cache,d=b.elements;if(void 0===d){if(hR(c,b))return;a.uniformMatrix3fv(this.addr,!1,b),iR(c,b)}else{if(hR(c,d))return;eR.set(d),a.uniformMatrix3fv(this.addr,!1,eR),iR(c,d)}}function qR(a,b){let c=this.cache,d=b.elements;if(void 0===d){if(hR(c,b))return;a.uniformMatrix4fv(this.addr,!1,b),iR(c,b)}else{if(hR(c,d))return;dR.set(d),a.uniformMatrix4fv(this.addr,!1,dR),iR(c,d)}}function rR(a,b){let c=this.cache;c[0]!==b&&(a.uniform1i(this.addr,b),c[0]=b)}function sR(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y)&&(a.uniform2i(this.addr,b.x,b.y),c[0]=b.x,c[1]=b.y);else{if(hR(c,b))return;a.uniform2iv(this.addr,b),iR(c,b)}}function tR(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z)&&(a.uniform3i(this.addr,b.x,b.y,b.z),c[0]=b.x,c[1]=b.y,c[2]=b.z);else{if(hR(c,b))return;a.uniform3iv(this.addr,b),iR(c,b)}}function uR(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z||c[3]!==b.w)&&(a.uniform4i(this.addr,b.x,b.y,b.z,b.w),c[0]=b.x,c[1]=b.y,c[2]=b.z,c[3]=b.w);else{if(hR(c,b))return;a.uniform4iv(this.addr,b),iR(c,b)}}function vR(a,b){let c=this.cache;c[0]!==b&&(a.uniform1ui(this.addr,b),c[0]=b)}function wR(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y)&&(a.uniform2ui(this.addr,b.x,b.y),c[0]=b.x,c[1]=b.y);else{if(hR(c,b))return;a.uniform2uiv(this.addr,b),iR(c,b)}}function xR(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z)&&(a.uniform3ui(this.addr,b.x,b.y,b.z),c[0]=b.x,c[1]=b.y,c[2]=b.z);else{if(hR(c,b))return;a.uniform3uiv(this.addr,b),iR(c,b)}}function yR(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z||c[3]!==b.w)&&(a.uniform4ui(this.addr,b.x,b.y,b.z,b.w),c[0]=b.x,c[1]=b.y,c[2]=b.z,c[3]=b.w);else{if(hR(c,b))return;a.uniform4uiv(this.addr,b),iR(c,b)}}function zR(a,b,c){let d=this.cache,e=c.allocateTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e),c.setTexture2D(b||ZQ,e)}function AR(a,b,c){let d=this.cache,e=c.allocateTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e),c.setTexture3D(b||_Q,e)}function BR(a,b,c){let d=this.cache,e=c.allocateTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e),c.setTextureCube(b||aR,e)}function CR(a,b,c){let d=this.cache,e=c.allocateTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e),c.setTexture2DArray(b||$Q,e)}function DR(a,b){a.uniform1fv(this.addr,b)}function ER(a,b){let c=gR(b,this.size,2);a.uniform2fv(this.addr,c)}function FR(a,b){let c=gR(b,this.size,3);a.uniform3fv(this.addr,c)}function GR(a,b){let c=gR(b,this.size,4);a.uniform4fv(this.addr,c)}function HR(a,b){let c=gR(b,this.size,4);a.uniformMatrix2fv(this.addr,!1,c)}function IR(a,b){let c=gR(b,this.size,9);a.uniformMatrix3fv(this.addr,!1,c)}function JR(a,b){let c=gR(b,this.size,16);a.uniformMatrix4fv(this.addr,!1,c)}function KR(a,b){a.uniform1iv(this.addr,b)}function LR(a,b){a.uniform2iv(this.addr,b)}function MR(a,b){a.uniform3iv(this.addr,b)}function NR(a,b){a.uniform4iv(this.addr,b)}function OR(a,b){a.uniform1uiv(this.addr,b)}function PR(a,b){a.uniform2uiv(this.addr,b)}function QR(a,b){a.uniform3uiv(this.addr,b)}function RR(a,b){a.uniform4uiv(this.addr,b)}function SR(a,b,c){let d=this.cache,e=b.length,f=jR(c,e);hR(d,f)||(a.uniform1iv(this.addr,f),iR(d,f));for(let g=0;g!==e;++g)c.setTexture2D(b[g]||ZQ,f[g])}function TR(a,b,c){let d=this.cache,e=b.length,f=jR(c,e);hR(d,f)||(a.uniform1iv(this.addr,f),iR(d,f));for(let g=0;g!==e;++g)c.setTexture3D(b[g]||_Q,f[g])}function UR(a,b,c){let d=this.cache,e=b.length,f=jR(c,e);hR(d,f)||(a.uniform1iv(this.addr,f),iR(d,f));for(let g=0;g!==e;++g)c.setTextureCube(b[g]||aR,f[g])}function VR(a,b,c){let d=this.cache,e=b.length,f=jR(c,e);hR(d,f)||(a.uniform1iv(this.addr,f),iR(d,f));for(let g=0;g!==e;++g)c.setTexture2DArray(b[g]||$Q,f[g])}var WR=class{constructor(XR,YR,ZR){this.id=XR,this.addr=ZR,this.cache=[],this.setValue=(function(a){switch(a){case 5126:return kR;case 35664:return lR;case 35665:return mR;case 35666:return nR;case 35674:return oR;case 35675:return pR;case 35676:return qR;case 5124:case 35670:return rR;case 35667:case 35671:return sR;case 35668:case 35672:return tR;case 35669:case 35673:return uR;case 5125:return vR;case 36294:return wR;case 36295:return xR;case 36296:return yR;case 35678:case 36198:case 36298:case 36306:case 35682:return zR;case 35679:case 36299:case 36307:return AR;case 35680:case 36300:case 36308:case 36293:return BR;case 36289:case 36303:case 36311:case 36292:return CR}})(YR.type)}},$R=class{constructor(_R,aS,bS){this.id=_R,this.addr=bS,this.cache=[],this.size=aS.size,this.setValue=(function(a){switch(a){case 5126:return DR;case 35664:return ER;case 35665:return FR;case 35666:return GR;case 35674:return HR;case 35675:return IR;case 35676:return JR;case 5124:case 35670:return KR;case 35667:case 35671:return LR;case 35668:case 35672:return MR;case 35669:case 35673:return NR;case 5125:return OR;case 36294:return PR;case 36295:return QR;case 36296:return RR;case 35678:case 36198:case 36298:case 36306:case 35682:return SR;case 35679:case 36299:case 36307:return TR;case 35680:case 36300:case 36308:case 36293:return UR;case 36289:case 36303:case 36311:case 36292:return VR}})(aS.type)}},cS=class{constructor(dS){this.id=dS,this.seq=[],this.map={}}setValue(eS,fS,gS){let hS=this.seq;for(let iS=0,jS=hS.length;iS!==jS;++iS){let kS=hS[iS];kS.setValue(eS,fS[kS.id],gS)}}},lS=/(\w+)(\])?(\[|\.)?/g;function mS(a,b){a.seq.push(b),a.map[b.id]=b}function nS(a,b,c){let d=a.name,e=d.length;for(lS.lastIndex=0;;){let f=lS.exec(d),g=lS.lastIndex,h=f[1],i="]"===f[2],j=f[3];if(i&&(h|=0),void 0===j||"["===j&&g+2===e){mS(c,void 0===j?new WR(h,a,b):new $R(h,a,b));break}{let k=c.map[h];void 0===k&&mS(c,k=new cS(h)),c=k}}}var oS=class{constructor(pS,qS){this.seq=[],this.map={};let rS=pS.getProgramParameter(qS,35718);for(let sS=0;sS<rS;++sS){let tS=pS.getActiveUniform(qS,sS),uS=pS.getUniformLocation(qS,tS.name);nS(tS,uS,this)}}setValue(vS,wS,xS,yS){let zS=this.map[wS];void 0!==zS&&zS.setValue(vS,xS,yS)}setOptional(AS,BS,CS){let DS=BS[CS];void 0!==DS&&this.setValue(AS,CS,DS)}static upload(ES,FS,GS,HS){for(let IS=0,JS=FS.length;IS!==JS;++IS){let KS=FS[IS],LS=GS[KS.id];!1!==LS.needsUpdate&&KS.setValue(ES,LS.value,HS)}}static seqWithValue(MS,NS){let OS=[];for(let PS=0,QS=MS.length;PS!==QS;++PS){let RS=MS[PS];RS.id in NS&&OS.push(RS)}return OS}};function SS(a,b,c){let d=a.createShader(b);return a.shaderSource(d,c),a.compileShader(d),d}var TS=0;function US(a,b,c){let d=a.getShaderParameter(b,35713),e=a.getShaderInfoLog(b).trim();if(d&&""===e)return"";let f=/ERROR: 0:(\d+)/.exec(e);if(!f)return e;{let g=parseInt(f[1]);return c.toUpperCase()+`

`+e+`

`+(function(a,b){let c=a.split(`
`),d=[],e=Math.max(b-6,0),f=Math.min(b+6,c.length);for(let g=e;g<f;g++){let h=g+1;d.push(`${h===b?">":" "} ${h}: ${c[g]}`)}return d.join(`
`)})(a.getShaderSource(b),g)}}function VS(a){return""!==a}function WS(a,b){let c=b.numSpotLightShadows+b.numSpotLightMaps-b.numSpotLightShadowsWithMaps;return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,b.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,c).replace(/NUM_RECT_AREA_LIGHTS/g,b.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,b.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,b.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,b.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,b.numPointLightShadows)}function XS(a,b){return a.replace(/NUM_CLIPPING_PLANES/g,b.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,b.numClippingPlanes-b.numClipIntersection)}var YS=/^[ \t]*#include +<([\w\d./]+)>/gm;function ZS(a){return a.replace(YS,$S)}function $S(a,b){let c=mO[b];if(void 0===c)throw new Error("Can not resolve #include <"+b+">");return ZS(c)}var _S=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function aT(a){return a.replace(_S,bT)}function bT(a,b,c,d){let e="";for(let f=parseInt(b);f<parseInt(c);f++)e+=d.replace(/\[\s*i\s*\]/g,"[ "+f+" ]").replace(/UNROLLED_LOOP_INDEX/g,f);return e}function cT(a){let b="precision "+a.precision+` float;
precision `+a.precision+" int;";return"highp"===a.precision?b+=`
#define HIGH_PRECISION`:"mediump"===a.precision?b+=`
#define MEDIUM_PRECISION`:"lowp"===a.precision&&(b+=`
#define LOW_PRECISION`),b}function dT(a,b,c,d){var e,f;let g,h=a.getContext(),i=c.defines,j=c.vertexShader,k=c.fragmentShader,l=(g="SHADOWMAP_TYPE_BASIC",(e=c).shadowMapType===N?g="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?g="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===O&&(g="SHADOWMAP_TYPE_VSM"),g),m=function(a){let b="ENVMAP_TYPE_CUBE";if(a.envMap)switch(a.envMapMode){case ka:case la:b="ENVMAP_TYPE_CUBE";break;case oa:b="ENVMAP_TYPE_CUBE_UV";break}return b}(c),n=function(a){let b="ENVMAP_MODE_REFLECTION";if(a.envMap)switch(a.envMapMode){case la:b="ENVMAP_MODE_REFRACTION";break}return b}(c),o=function(a){let b="ENVMAP_BLENDING_NONE";if(a.envMap)switch(a.combine){case ha:b="ENVMAP_BLENDING_MULTIPLY";break;case 1:b="ENVMAP_BLENDING_MIX";break;case 2:b="ENVMAP_BLENDING_ADD";break}return b}(c),p=function(a){let b=a.envMapCubeUVHeight;if(null===b)return null;let c=Math.log2(b)-2;return{texelWidth:1/(3*Math.max(Math.pow(2,c),112)),texelHeight:1/b,maxMip:c}}(c),q=c.isWebGL2?"":[(f=c).extensionDerivatives||f.envMapCubeUVHeight||f.bumpMap||f.tangentSpaceNormalMap||f.clearcoatNormalMap||f.flatShading||"physical"===f.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(f.extensionFragDepth||f.logarithmicDepthBuffer)&&f.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",f.extensionDrawBuffers&&f.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(f.extensionShaderTextureLOD||f.envMap||f.transmission)&&f.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(VS).join(`
`),r=function(a){let b=[];for(let c in a){let d=a[c];!1!==d&&b.push("#define "+c+" "+d)}return b.join(`
`)}(i),s=h.createProgram(),t,u,v=c.glslVersion?"#version "+c.glslVersion+`
`:"",w;c.isRawShaderMaterial?((t=[r].filter(VS).join(`
`)).length>0&&(t+=`
`),(u=[q,r].filter(VS).join(`
`)).length>0&&(u+=`
`)):(t=[cT(c),"#define SHADER_NAME "+c.shaderName,r,c.instancing?"#define USE_INSTANCING":"",c.instancingColor?"#define USE_INSTANCING_COLOR":"",c.supportsVertexTextures?"#define VERTEX_TEXTURES":"",c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+n:"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMap&&c.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",c.normalMap&&c.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",c.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",c.displacementMap&&c.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",c.specularColorMap?"#define USE_SPECULARCOLORMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.transmission?"#define USE_TRANSMISSION":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.thicknessMap?"#define USE_THICKNESSMAP":"",c.sheenColorMap?"#define USE_SHEENCOLORMAP":"",c.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",c.vertexTangents?"#define USE_TANGENT":"",c.vertexColors?"#define USE_COLOR":"",c.vertexAlphas?"#define USE_COLOR_ALPHA":"",c.vertexUvs?"#define USE_UV":"",c.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",c.flatShading?"#define FLAT_SHADED":"",c.skinning?"#define USE_SKINNING":"",c.morphTargets?"#define USE_MORPHTARGETS":"",c.morphNormals&& !1===c.flatShading?"#define USE_MORPHNORMALS":"",c.morphColors&&c.isWebGL2?"#define USE_MORPHCOLORS":"",c.morphTargetsCount>0&&c.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",c.morphTargetsCount>0&&c.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+c.morphTextureStride:"",c.morphTargetsCount>0&&c.isWebGL2?"#define MORPHTARGETS_COUNT "+c.morphTargetsCount:"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+l:"",c.sizeAttenuation?"#define USE_SIZEATTENUATION":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif",`
`].filter(VS).join(`
`),u=[q,cT(c),"#define SHADER_NAME "+c.shaderName,r,c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.matcap?"#define USE_MATCAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+m:"",c.envMap?"#define "+n:"",c.envMap?"#define "+o:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMap&&c.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",c.normalMap&&c.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",c.clearcoat?"#define USE_CLEARCOAT":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.iridescence?"#define USE_IRIDESCENCE":"",c.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",c.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",c.specularColorMap?"#define USE_SPECULARCOLORMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.alphaTest?"#define USE_ALPHATEST":"",c.sheen?"#define USE_SHEEN":"",c.sheenColorMap?"#define USE_SHEENCOLORMAP":"",c.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",c.transmission?"#define USE_TRANSMISSION":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.thicknessMap?"#define USE_THICKNESSMAP":"",c.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",c.vertexTangents?"#define USE_TANGENT":"",c.vertexColors||c.instancingColor?"#define USE_COLOR":"",c.vertexAlphas?"#define USE_COLOR_ALPHA":"",c.vertexUvs?"#define USE_UV":"",c.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",c.gradientMap?"#define USE_GRADIENTMAP":"",c.flatShading?"#define FLAT_SHADED":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+l:"",c.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",c.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",c.toneMapping!==ia?"#define TONE_MAPPING":"",c.toneMapping!==ia?mO.tonemapping_pars_fragment:"",c.toneMapping!==ia?function(a,b){let c;switch(b){case 1:c="Linear";break;case 2:c="Reinhard";break;case 3:c="OptimizedCineon";break;case 4:c="ACESFilmic";break;case 5:c="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",b),c="Linear"}return"vec3 "+a+"( vec3 color ) { return "+c+"ToneMapping( color ); }"}("toneMapping",c.toneMapping):"",c.dithering?"#define DITHERING":"",c.opaque?"#define OPAQUE":"",mO.encodings_pars_fragment,"vec4 linearToOutputTexel( vec4 value ) { return LinearTo"+(w=function(a){switch(a){case Sa:return["Linear","( value )"];case Ta:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",a),["Linear","( value )"]}}(c.outputEncoding))[0]+w[1]+"; }",c.useDepthPacking?"#define DEPTH_PACKING "+c.depthPacking:"",`
`].filter(VS).join(`
`)),j=XS(j=WS(j=ZS(j),c),c),k=ZS(k),k=WS(k,c),k=XS(k,c),j=aT(j),k=aT(k),c.isWebGL2&& !0!==c.isRawShaderMaterial&&(v=`#version 300 es
`,t=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+t,u=["#define varying in",c.glslVersion===_a?"":"layout(location = 0) out highp vec4 pc_fragColor;",c.glslVersion===_a?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+u);let x=SS(h,35633,v+t+j),y=SS(h,35632,v+u+k);if(h.attachShader(s,x),h.attachShader(s,y),void 0!==c.index0AttributeName?h.bindAttribLocation(s,0,c.index0AttributeName):!0===c.morphTargets&&h.bindAttribLocation(s,0,"position"),h.linkProgram(s),a.debug.checkShaderErrors){let z=h.getProgramInfoLog(s).trim(),A=h.getShaderInfoLog(x).trim(),B=h.getShaderInfoLog(y).trim(),C=!0,D=!0;if(!1===h.getProgramParameter(s,35714)){C=!1;let E=US(h,x,"vertex"),F=US(h,y,"fragment");console.error("THREE.WebGLProgram: Shader Error "+h.getError()+" - VALIDATE_STATUS "+h.getProgramParameter(s,35715)+`

Program Info Log: `+z+`
`+E+`
`+F)}else""!==z?console.warn("THREE.WebGLProgram: Program Info Log:",z):(""===A||""===B)&&(D=!1);D&&(this.diagnostics={runnable:C,programLog:z,vertexShader:{log:A,prefix:t},fragmentShader:{log:B,prefix:u}})}h.deleteShader(x),h.deleteShader(y);let G;this.getUniforms=function(){return void 0===G&&(G=new oS(h,s)),G};let H;return this.getAttributes=function(){return void 0===H&&(H=(function(a,b){let c={},d=a.getProgramParameter(b,35721);for(let e=0;e<d;e++){let f=a.getActiveAttrib(b,e),g=f.name,h=1;35674===f.type&&(h=2),35675===f.type&&(h=3),35676===f.type&&(h=4),c[g]={type:f.type,location:a.getAttribLocation(b,g),locationSize:h}}return c})(h,s)),H},this.destroy=function(){d.releaseStatesOfProgram(this),h.deleteProgram(s),this.program=void 0},this.name=c.shaderName,this.id=TS++,this.cacheKey=b,this.usedTimes=1,this.program=s,this.vertexShader=x,this.fragmentShader=y,this}var eT=0,fT=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(gT){let hT=gT.vertexShader,iT=gT.fragmentShader,jT=this._getShaderStage(hT),kT=this._getShaderStage(iT),lT=this._getShaderCacheForMaterial(gT);return!1===lT.has(jT)&&(lT.add(jT),jT.usedTimes++),!1===lT.has(kT)&&(lT.add(kT),kT.usedTimes++),this}remove(mT){let nT=this.materialCache.get(mT);for(let oT of nT)oT.usedTimes--,0===oT.usedTimes&&this.shaderCache.delete(oT.code);return this.materialCache.delete(mT),this}getVertexShaderID(pT){return this._getShaderStage(pT.vertexShader).id}getFragmentShaderID(qT){return this._getShaderStage(qT.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(rT){let sT=this.materialCache,tT=sT.get(rT);return void 0===tT&&(tT=new Set,sT.set(rT,tT)),tT}_getShaderStage(uT){let vT=this.shaderCache,wT=vT.get(uT);return void 0===wT&&(wT=new xT(uT),vT.set(uT,wT)),wT}},xT=class{constructor(yT){this.id=eT++,this.code=yT,this.usedTimes=0}};function zT(a,b,c,d,e,f,g){let h=new oy,i=new fT,j=[],k=e.isWebGL2,l=e.logarithmicDepthBuffer,m=e.vertexTextures,n=e.precision,o={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(f,h,j,p,q){let r=p.fog,s=q.geometry,t=f.isMeshStandardMaterial?p.environment:null,u=(f.isMeshStandardMaterial?c:b).get(f.envMap||t),v=u&&u.mapping===oa?u.image.height:null,w=o[f.type];null!==f.precision&&(n=e.getMaxPrecision(f.precision))!==f.precision&&console.warn("THREE.WebGLProgram.getParameters:",f.precision,"not supported, using",n,"instead.");let x=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,y=void 0!==x?x.length:0,z=0;void 0!==s.morphAttributes.position&&(z=1),void 0!==s.morphAttributes.normal&&(z=2),void 0!==s.morphAttributes.color&&(z=3);let A,B,C,D;if(w){let E=oO[w];A=E.vertexShader,B=E.fragmentShader}else A=f.vertexShader,B=f.fragmentShader,i.update(f),C=i.getVertexShaderID(f),D=i.getFragmentShaderID(f);let F=a.getRenderTarget(),G=f.alphaTest>0,H=f.clearcoat>0,I=f.iridescence>0;return{isWebGL2:k,shaderID:w,shaderName:f.type,vertexShader:A,fragmentShader:B,defines:f.defines,customVertexShaderID:C,customFragmentShaderID:D,isRawShaderMaterial:!0===f.isRawShaderMaterial,glslVersion:f.glslVersion,precision:n,instancing:!0===q.isInstancedMesh,instancingColor:!0===q.isInstancedMesh&&null!==q.instanceColor,supportsVertexTextures:m,outputEncoding:null===F?a.outputEncoding:!0===F.isXRRenderTarget?F.texture.encoding:Sa,map:!!f.map,matcap:!!f.matcap,envMap:!!u,envMapMode:u&&u.mapping,envMapCubeUVHeight:v,lightMap:!!f.lightMap,aoMap:!!f.aoMap,emissiveMap:!!f.emissiveMap,bumpMap:!!f.bumpMap,normalMap:!!f.normalMap,objectSpaceNormalMap:1===f.normalMapType,tangentSpaceNormalMap:0===f.normalMapType,decodeVideoTexture:!!f.map&& !0===f.map.isVideoTexture&&f.map.encoding===Ta,clearcoat:H,clearcoatMap:H&&!!f.clearcoatMap,clearcoatRoughnessMap:H&&!!f.clearcoatRoughnessMap,clearcoatNormalMap:H&&!!f.clearcoatNormalMap,iridescence:I,iridescenceMap:I&&!!f.iridescenceMap,iridescenceThicknessMap:I&&!!f.iridescenceThicknessMap,displacementMap:!!f.displacementMap,roughnessMap:!!f.roughnessMap,metalnessMap:!!f.metalnessMap,specularMap:!!f.specularMap,specularIntensityMap:!!f.specularIntensityMap,specularColorMap:!!f.specularColorMap,opaque:!1===f.transparent&&f.blending===T,alphaMap:!!f.alphaMap,alphaTest:G,gradientMap:!!f.gradientMap,sheen:f.sheen>0,sheenColorMap:!!f.sheenColorMap,sheenRoughnessMap:!!f.sheenRoughnessMap,transmission:f.transmission>0,transmissionMap:!!f.transmissionMap,thicknessMap:!!f.thicknessMap,combine:f.combine,vertexTangents:!!f.normalMap&&!!s.attributes.tangent,vertexColors:f.vertexColors,vertexAlphas:!0===f.vertexColors&&!!s.attributes.color&&4===s.attributes.color.itemSize,vertexUvs:!!f.map||!!f.bumpMap||!!f.normalMap||!!f.specularMap||!!f.alphaMap||!!f.emissiveMap||!!f.roughnessMap||!!f.metalnessMap||!!f.clearcoatMap||!!f.clearcoatRoughnessMap||!!f.clearcoatNormalMap||!!f.iridescenceMap||!!f.iridescenceThicknessMap||!!f.displacementMap||!!f.transmissionMap||!!f.thicknessMap||!!f.specularIntensityMap||!!f.specularColorMap||!!f.sheenColorMap||!!f.sheenRoughnessMap,uvsVertexOnly:!(f.map||f.bumpMap||f.normalMap||f.specularMap||f.alphaMap||f.emissiveMap||f.roughnessMap||f.metalnessMap||f.clearcoatNormalMap||f.iridescenceMap||f.iridescenceThicknessMap||f.transmission>0||f.transmissionMap||f.thicknessMap||f.specularIntensityMap||f.specularColorMap||f.sheen>0||f.sheenColorMap||f.sheenRoughnessMap)&&!!f.displacementMap,fog:!!r,useFog:!0===f.fog,fogExp2:r&&r.isFogExp2,flatShading:!!f.flatShading,sizeAttenuation:f.sizeAttenuation,logarithmicDepthBuffer:l,skinning:!0===q.isSkinnedMesh,morphTargets:void 0!==s.morphAttributes.position,morphNormals:void 0!==s.morphAttributes.normal,morphColors:void 0!==s.morphAttributes.color,morphTargetsCount:y,morphTextureStride:z,numDirLights:h.directional.length,numPointLights:h.point.length,numSpotLights:h.spot.length,numSpotLightMaps:h.spotLightMap.length,numRectAreaLights:h.rectArea.length,numHemiLights:h.hemi.length,numDirLightShadows:h.directionalShadowMap.length,numPointLightShadows:h.pointShadowMap.length,numSpotLightShadows:h.spotShadowMap.length,numSpotLightShadowsWithMaps:h.numSpotLightShadowsWithMaps,numClippingPlanes:g.numPlanes,numClipIntersection:g.numIntersection,dithering:f.dithering,shadowMapEnabled:a.shadowMap.enabled&&j.length>0,shadowMapType:a.shadowMap.type,toneMapping:f.toneMapped?a.toneMapping:ia,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:f.premultipliedAlpha,doubleSided:f.side===R,flipSided:f.side===Q,useDepthPacking:!!f.depthPacking,depthPacking:f.depthPacking||0,index0AttributeName:f.index0AttributeName,extensionDerivatives:f.extensions&&f.extensions.derivatives,extensionFragDepth:f.extensions&&f.extensions.fragDepth,extensionDrawBuffers:f.extensions&&f.extensions.drawBuffers,extensionShaderTextureLOD:f.extensions&&f.extensions.shaderTextureLOD,rendererExtensionFragDepth:k||d.has("EXT_frag_depth"),rendererExtensionDrawBuffers:k||d.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:k||d.has("EXT_shader_texture_lod"),customProgramCacheKey:f.customProgramCacheKey()}},getProgramCacheKey:function(b){var c,d,e,f;let g=[];if(b.shaderID?g.push(b.shaderID):(g.push(b.customVertexShaderID),g.push(b.customFragmentShaderID)),void 0!==b.defines)for(let i in b.defines)g.push(i),g.push(b.defines[i]);return!1===b.isRawShaderMaterial&&(c=g,d=b,c.push(d.precision),c.push(d.outputEncoding),c.push(d.envMapMode),c.push(d.envMapCubeUVHeight),c.push(d.combine),c.push(d.vertexUvs),c.push(d.fogExp2),c.push(d.sizeAttenuation),c.push(d.morphTargetsCount),c.push(d.morphAttributeCount),c.push(d.numDirLights),c.push(d.numPointLights),c.push(d.numSpotLights),c.push(d.numSpotLightMaps),c.push(d.numHemiLights),c.push(d.numRectAreaLights),c.push(d.numDirLightShadows),c.push(d.numPointLightShadows),c.push(d.numSpotLightShadows),c.push(d.numSpotLightShadowsWithMaps),c.push(d.shadowMapType),c.push(d.toneMapping),c.push(d.numClippingPlanes),c.push(d.numClipIntersection),c.push(d.depthPacking),e=g,f=b,h.disableAll(),f.isWebGL2&&h.enable(0),f.supportsVertexTextures&&h.enable(1),f.instancing&&h.enable(2),f.instancingColor&&h.enable(3),f.map&&h.enable(4),f.matcap&&h.enable(5),f.envMap&&h.enable(6),f.lightMap&&h.enable(7),f.aoMap&&h.enable(8),f.emissiveMap&&h.enable(9),f.bumpMap&&h.enable(10),f.normalMap&&h.enable(11),f.objectSpaceNormalMap&&h.enable(12),f.tangentSpaceNormalMap&&h.enable(13),f.clearcoat&&h.enable(14),f.clearcoatMap&&h.enable(15),f.clearcoatRoughnessMap&&h.enable(16),f.clearcoatNormalMap&&h.enable(17),f.iridescence&&h.enable(18),f.iridescenceMap&&h.enable(19),f.iridescenceThicknessMap&&h.enable(20),f.displacementMap&&h.enable(21),f.specularMap&&h.enable(22),f.roughnessMap&&h.enable(23),f.metalnessMap&&h.enable(24),f.gradientMap&&h.enable(25),f.alphaMap&&h.enable(26),f.alphaTest&&h.enable(27),f.vertexColors&&h.enable(28),f.vertexAlphas&&h.enable(29),f.vertexUvs&&h.enable(30),f.vertexTangents&&h.enable(31),f.uvsVertexOnly&&h.enable(32),e.push(h.mask),h.disableAll(),f.fog&&h.enable(0),f.useFog&&h.enable(1),f.flatShading&&h.enable(2),f.logarithmicDepthBuffer&&h.enable(3),f.skinning&&h.enable(4),f.morphTargets&&h.enable(5),f.morphNormals&&h.enable(6),f.morphColors&&h.enable(7),f.premultipliedAlpha&&h.enable(8),f.shadowMapEnabled&&h.enable(9),f.physicallyCorrectLights&&h.enable(10),f.doubleSided&&h.enable(11),f.flipSided&&h.enable(12),f.useDepthPacking&&h.enable(13),f.dithering&&h.enable(14),f.specularIntensityMap&&h.enable(15),f.specularColorMap&&h.enable(16),f.transmission&&h.enable(17),f.transmissionMap&&h.enable(18),f.thicknessMap&&h.enable(19),f.sheen&&h.enable(20),f.sheenColorMap&&h.enable(21),f.sheenRoughnessMap&&h.enable(22),f.decodeVideoTexture&&h.enable(23),f.opaque&&h.enable(24),e.push(h.mask),g.push(a.outputEncoding)),g.push(b.customProgramCacheKey),g.join()},getUniforms:function(a){let b=o[a.type],c;if(b){let d=oO[b];c=oJ.clone(d.uniforms)}else c=a.uniforms;return c},acquireProgram:function(b,c){let d;for(let e=0,g=j.length;e<g;e++){let h=j[e];if(h.cacheKey===c){d=h,++d.usedTimes;break}}return void 0===d&&(d=new dT(a,c,b,f),j.push(d)),d},releaseProgram:function(a){if(0== --a.usedTimes){let b=j.indexOf(a);j[b]=j[j.length-1],j.pop(),a.destroy()}},releaseShaderCache:function(a){i.remove(a)},programs:j,dispose:function(){i.dispose()}}}function AT(){let a=new WeakMap;return{get:function(b){let c=a.get(b);return void 0===c&&(c={},a.set(b,c)),c},remove:function(b){a.delete(b)},update:function(b,c,d){a.get(b)[c]=d},dispose:function(){a=new WeakMap}}}function BT(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function CT(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function DT(){let a=[],b=0,c=[],d=[],e=[];function f(c,d,e,f,g,h){let i=a[b];return void 0===i?(i={id:c.id,object:c,geometry:d,material:e,groupOrder:f,renderOrder:c.renderOrder,z:g,group:h},a[b]=i):(i.id=c.id,i.object=c,i.geometry=d,i.material=e,i.groupOrder=f,i.renderOrder=c.renderOrder,i.z=g,i.group=h),b++,i}return{opaque:c,transmissive:d,transparent:e,init:function(){b=0,c.length=0,d.length=0,e.length=0},push:function(a,b,g,h,i,j){let k=f(a,b,g,h,i,j);g.transmission>0?d.push(k):!0===g.transparent?e.push(k):c.push(k)},unshift:function(a,b,g,h,i,j){let k=f(a,b,g,h,i,j);g.transmission>0?d.unshift(k):!0===g.transparent?e.unshift(k):c.unshift(k)},finish:function(){for(let c=b,d=a.length;c<d;c++){let e=a[c];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(a,b){c.length>1&&c.sort(a||BT),d.length>1&&d.sort(b||CT),e.length>1&&e.sort(b||CT)}}}function ET(){let a=new WeakMap;return{get:function(b,c){let d=a.get(b),e;return void 0===d?(e=new DT,a.set(b,[e])):c>=d.length?(e=new DT,d.push(e)):e=d[c],e},dispose:function(){a=new WeakMap}}}function FT(){let a={};return{get:function(b){if(void 0!==a[b.id])return a[b.id];let c;switch(b.type){case"DirectionalLight":c={direction:new fm,color:new df};break;case"SpotLight":c={position:new fm,direction:new fm,color:new df,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":c={position:new fm,color:new df,distance:0,decay:0};break;case"HemisphereLight":c={direction:new fm,skyColor:new df,groundColor:new df};break;case"RectAreaLight":c={color:new df,position:new fm,halfWidth:new fm,halfHeight:new fm};break}return a[b.id]=c,c}}}var GT=0;function HT(a,b){return(b.castShadow?2:0)-(a.castShadow?2:0)+(b.map?1:0)-(a.map?1:0)}function IT(a,b){let c,d=new FT,e=(c={},{get:function(a){if(void 0!==c[a.id])return c[a.id];let b;switch(a.type){case"DirectionalLight":b={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Eb};break;case"SpotLight":b={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Eb};break;case"PointLight":b={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Eb,shadowCameraNear:1,shadowCameraFar:1e3};break}return c[a.id]=b,b}}),f={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let g=0;g<9;g++)f.probe.push(new fm);let h=new fm,i=new rs,j=new rs;return{setup:function(c,g){let h=0,i=0,j=0;for(let k=0;k<9;k++)f.probe[k].set(0,0,0);let l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0;c.sort(HT);let v=!0!==g?Math.PI:1;for(let w=0,x=c.length;w<x;w++){let y=c[w],z=y.color,A=y.intensity,B=y.distance,C=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)h+=z.r*A*v,i+=z.g*A*v,j+=z.b*A*v;else if(y.isLightProbe)for(let D=0;D<9;D++)f.probe[D].addScaledVector(y.sh.coefficients[D],A);else if(y.isDirectionalLight){let E=d.get(y);if(E.color.copy(y.color).multiplyScalar(y.intensity*v),y.castShadow){let F=y.shadow,G=e.get(y);G.shadowBias=F.bias,G.shadowNormalBias=F.normalBias,G.shadowRadius=F.radius,G.shadowMapSize=F.mapSize,f.directionalShadow[l]=G,f.directionalShadowMap[l]=C,f.directionalShadowMatrix[l]=y.shadow.matrix,q++}f.directional[l]=E,l++}else if(y.isSpotLight){let H=d.get(y);H.position.setFromMatrixPosition(y.matrixWorld),H.color.copy(z).multiplyScalar(A*v),H.distance=B,H.coneCos=Math.cos(y.angle),H.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),H.decay=y.decay,f.spot[n]=H;let I=y.shadow;if(y.map&&(f.spotLightMap[t]=y.map,t++,I.updateMatrices(y),y.castShadow&&u++),f.spotLightMatrix[n]=I.matrix,y.castShadow){let J=e.get(y);J.shadowBias=I.bias,J.shadowNormalBias=I.normalBias,J.shadowRadius=I.radius,J.shadowMapSize=I.mapSize,f.spotShadow[n]=J,f.spotShadowMap[n]=C,s++}n++}else if(y.isRectAreaLight){let K=d.get(y);K.color.copy(z).multiplyScalar(A),K.halfWidth.set(.5*y.width,0,0),K.halfHeight.set(0,.5*y.height,0),f.rectArea[o]=K,o++}else if(y.isPointLight){let L=d.get(y);if(L.color.copy(y.color).multiplyScalar(y.intensity*v),L.distance=y.distance,L.decay=y.decay,y.castShadow){let M=y.shadow,N=e.get(y);N.shadowBias=M.bias,N.shadowNormalBias=M.normalBias,N.shadowRadius=M.radius,N.shadowMapSize=M.mapSize,N.shadowCameraNear=M.camera.near,N.shadowCameraFar=M.camera.far,f.pointShadow[m]=N,f.pointShadowMap[m]=C,f.pointShadowMatrix[m]=y.shadow.matrix,r++}f.point[m]=L,m++}else if(y.isHemisphereLight){let O=d.get(y);O.skyColor.copy(y.color).multiplyScalar(A*v),O.groundColor.copy(y.groundColor).multiplyScalar(A*v),f.hemi[p]=O,p++}}o>0&&(b.isWebGL2|| !0===a.has("OES_texture_float_linear")?(f.rectAreaLTC1=nO.LTC_FLOAT_1,f.rectAreaLTC2=nO.LTC_FLOAT_2):!0===a.has("OES_texture_half_float_linear")?(f.rectAreaLTC1=nO.LTC_HALF_1,f.rectAreaLTC2=nO.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),f.ambient[0]=h,f.ambient[1]=i,f.ambient[2]=j;let P=f.hash;(P.directionalLength!==l||P.pointLength!==m||P.spotLength!==n||P.rectAreaLength!==o||P.hemiLength!==p||P.numDirectionalShadows!==q||P.numPointShadows!==r||P.numSpotShadows!==s||P.numSpotMaps!==t)&&(f.directional.length=l,f.spot.length=n,f.rectArea.length=o,f.point.length=m,f.hemi.length=p,f.directionalShadow.length=q,f.directionalShadowMap.length=q,f.pointShadow.length=r,f.pointShadowMap.length=r,f.spotShadow.length=s,f.spotShadowMap.length=s,f.directionalShadowMatrix.length=q,f.pointShadowMatrix.length=r,f.spotLightMatrix.length=s+t-u,f.spotLightMap.length=t,f.numSpotLightShadowsWithMaps=u,P.directionalLength=l,P.pointLength=m,P.spotLength=n,P.rectAreaLength=o,P.hemiLength=p,P.numDirectionalShadows=q,P.numPointShadows=r,P.numSpotShadows=s,P.numSpotMaps=t,f.version=GT++)},setupView:function(a,b){let c=0,d=0,e=0,g=0,k=0,l=b.matrixWorldInverse;for(let m=0,n=a.length;m<n;m++){let o=a[m];if(o.isDirectionalLight){let p=f.directional[c];p.direction.setFromMatrixPosition(o.matrixWorld),h.setFromMatrixPosition(o.target.matrixWorld),p.direction.sub(h),p.direction.transformDirection(l),c++}else if(o.isSpotLight){let q=f.spot[e];q.position.setFromMatrixPosition(o.matrixWorld),q.position.applyMatrix4(l),q.direction.setFromMatrixPosition(o.matrixWorld),h.setFromMatrixPosition(o.target.matrixWorld),q.direction.sub(h),q.direction.transformDirection(l),e++}else if(o.isRectAreaLight){let r=f.rectArea[g];r.position.setFromMatrixPosition(o.matrixWorld),r.position.applyMatrix4(l),j.identity(),i.copy(o.matrixWorld),i.premultiply(l),j.extractRotation(i),r.halfWidth.set(.5*o.width,0,0),r.halfHeight.set(0,.5*o.height,0),r.halfWidth.applyMatrix4(j),r.halfHeight.applyMatrix4(j),g++}else if(o.isPointLight){let s=f.point[d];s.position.setFromMatrixPosition(o.matrixWorld),s.position.applyMatrix4(l),d++}else if(o.isHemisphereLight){let t=f.hemi[k];t.direction.setFromMatrixPosition(o.matrixWorld),t.direction.transformDirection(l),k++}}},state:f}}function JT(a,b){let c=new IT(a,b),d=[],e=[];return{init:function(){d.length=0,e.length=0},state:{lightsArray:d,shadowsArray:e,lights:c},setupLights:function(a){c.setup(d,a)},setupLightsView:function(a){c.setupView(d,a)},pushLight:function(a){d.push(a)},pushShadow:function(a){e.push(a)}}}function KT(a,b){let c=new WeakMap;return{get:function(d,e=0){let f=c.get(d),g;return void 0===f?(g=new JT(a,b),c.set(d,[g])):e>=f.length?(g=new JT(a,b),f.push(g)):g=f[e],g},dispose:function(){c=new WeakMap}}}var LT=class extends uC{constructor(MT){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Ua,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(MT)}copy(NT){return super.copy(NT),this.depthPacking=NT.depthPacking,this.map=NT.map,this.alphaMap=NT.alphaMap,this.displacementMap=NT.displacementMap,this.displacementScale=NT.displacementScale,this.displacementBias=NT.displacementBias,this.wireframe=NT.wireframe,this.wireframeLinewidth=NT.wireframeLinewidth,this}},OT=class extends uC{constructor(PT){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new fm,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(PT)}copy(QT){return super.copy(QT),this.referencePosition.copy(QT.referencePosition),this.nearDistance=QT.nearDistance,this.farDistance=QT.farDistance,this.map=QT.map,this.alphaMap=QT.alphaMap,this.displacementMap=QT.displacementMap,this.displacementScale=QT.displacementScale,this.displacementBias=QT.displacementBias,this}},RT=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,ST=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function TT(a,b,c){let d=new YL,e=new Eb,f=new Eb,g=new sh,h=new LT({depthPacking:Va}),i=new OT,j={},k=c.maxTextureSize,l={[P]:Q,[Q]:P,[R]:R},m=new pJ({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Eb},radius:{value:4}},vertexShader:RT,fragmentShader:ST}),n=m.clone();n.defines.HORIZONTAL_PASS=1;let o=new nE;o.setAttribute("position",new RC(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let p=new GH(o,m),q=this;function r(c,d){let f=b.update(p);m.defines.VSM_SAMPLES!==c.blurSamples&&(m.defines.VSM_SAMPLES=c.blurSamples,n.defines.VSM_SAMPLES=c.blurSamples,m.needsUpdate=!0,n.needsUpdate=!0),null===c.mapPass&&(c.mapPass=new Yi(e.x,e.y)),m.uniforms.shadow_pass.value=c.map.texture,m.uniforms.resolution.value=c.mapSize,m.uniforms.radius.value=c.radius,a.setRenderTarget(c.mapPass),a.clear(),a.renderBufferDirect(d,null,f,m,p,null),n.uniforms.shadow_pass.value=c.mapPass.texture,n.uniforms.resolution.value=c.mapSize,n.uniforms.radius.value=c.radius,a.setRenderTarget(c.map),a.clear(),a.renderBufferDirect(d,null,f,n,p,null)}function s(b,c,d,e,f,g){let k=null,m=!0===d.isPointLight?b.customDistanceMaterial:b.customDepthMaterial;if(void 0!==m)k=m;else if(k=!0===d.isPointLight?i:h,a.localClippingEnabled&& !0===c.clipShadows&&Array.isArray(c.clippingPlanes)&&0!==c.clippingPlanes.length||c.displacementMap&&0!==c.displacementScale||c.alphaMap&&c.alphaTest>0||c.map&&c.alphaTest>0){let n=k.uuid,o=c.uuid,p=j[n];void 0===p&&(p={},j[n]=p);let q=p[o];void 0===q&&(q=k.clone(),p[o]=q),k=q}return k.visible=c.visible,k.wireframe=c.wireframe,g===O?k.side=null!==c.shadowSide?c.shadowSide:c.side:k.side=null!==c.shadowSide?c.shadowSide:l[c.side],k.alphaMap=c.alphaMap,k.alphaTest=c.alphaTest,k.map=c.map,k.clipShadows=c.clipShadows,k.clippingPlanes=c.clippingPlanes,k.clipIntersection=c.clipIntersection,k.displacementMap=c.displacementMap,k.displacementScale=c.displacementScale,k.displacementBias=c.displacementBias,k.wireframeLinewidth=c.wireframeLinewidth,k.linewidth=c.linewidth,!0===d.isPointLight&& !0===k.isMeshDistanceMaterial&&(k.referencePosition.setFromMatrixPosition(d.matrixWorld),k.nearDistance=e,k.farDistance=f),k}function t(c,e,f,g,h){if(!1===c.visible)return;if(c.layers.test(e.layers)&&(c.isMesh||c.isLine||c.isPoints)&&(c.castShadow||c.receiveShadow&&h===O)&&(!c.frustumCulled||d.intersectsObject(c))){c.modelViewMatrix.multiplyMatrices(f.matrixWorldInverse,c.matrixWorld);let i=b.update(c),j=c.material;if(Array.isArray(j)){let k=i.groups;for(let l=0,m=k.length;l<m;l++){let n=k[l],o=j[n.materialIndex];if(o&&o.visible){let p=s(c,o,g,f.near,f.far,h);a.renderBufferDirect(f,null,i,p,c,n)}}}else if(j.visible){let q=s(c,j,g,f.near,f.far,h);a.renderBufferDirect(f,null,i,q,c,null)}}let r=c.children;for(let u=0,v=r.length;u<v;u++)t(r[u],e,f,g,h)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=N,this.render=function(b,c,h){if(!1===q.enabled|| !1===q.autoUpdate&& !1===q.needsUpdate||0===b.length)return;let i=a.getRenderTarget(),j=a.getActiveCubeFace(),l=a.getActiveMipmapLevel(),m=a.state;m.setBlending(S),m.buffers.color.setClear(1,1,1,1),m.buffers.depth.setTest(!0),m.setScissorTest(!1);for(let n=0,o=b.length;n<o;n++){let p=b[n],s=p.shadow;if(void 0===s){console.warn("THREE.WebGLShadowMap:",p,"has no shadow.");continue}if(!1===s.autoUpdate&& !1===s.needsUpdate)continue;e.copy(s.mapSize);let u=s.getFrameExtents();if(e.multiply(u),f.copy(s.mapSize),(e.x>k||e.y>k)&&(e.x>k&&(f.x=Math.floor(k/u.x),e.x=f.x*u.x,s.mapSize.x=f.x),e.y>k&&(f.y=Math.floor(k/u.y),e.y=f.y*u.y,s.mapSize.y=f.y)),null===s.map){let v=this.type!==O?{minFilter:sa,magFilter:sa}:{};s.map=new Yi(e.x,e.y,v),s.map.texture.name=p.name+".shadowMap",s.camera.updateProjectionMatrix()}a.setRenderTarget(s.map),a.clear();let w=s.getViewportCount();for(let x=0;x<w;x++){let y=s.getViewport(x);g.set(f.x*y.x,f.y*y.y,f.x*y.z,f.y*y.w),m.viewport(g),s.updateMatrices(p,x),d=s.getFrustum(),t(c,h,s.camera,p,this.type)}!0!==s.isPointLightShadow&&this.type===O&&r(s,h),s.needsUpdate=!1}q.needsUpdate=!1,a.setRenderTarget(i,j,l)}}function UT(a,b,c){let d=c.isWebGL2,e=new function(){let b=!1,c=new sh,d=null,e=new sh(0,0,0,0);return{setMask:function(c){d===c||b||(a.colorMask(c,c,c,c),d=c)},setLocked:function(a){b=a},setClear:function(b,d,f,g,h){!0===h&&(b*=g,d*=g,f*=g),c.set(b,d,f,g),!1===e.equals(c)&&(a.clearColor(b,d,f,g),e.copy(c))},reset:function(){b=!1,d=null,e.set(-1,0,0,0)}}},f=new function(){let b=!1,c=null,d=null,e=null;return{setTest:function(a){a?N(2929):O(2929)},setMask:function(d){c===d||b||(a.depthMask(d),c=d)},setFunc:function(b){if(d!==b){switch(b){case 0:a.depthFunc(512);break;case 1:a.depthFunc(519);break;case 2:a.depthFunc(513);break;case ga:a.depthFunc(515);break;case 4:a.depthFunc(514);break;case 5:a.depthFunc(518);break;case 6:a.depthFunc(516);break;case 7:a.depthFunc(517);break;default:a.depthFunc(515)}d=b}},setLocked:function(a){b=a},setClear:function(b){e!==b&&(a.clearDepth(b),e=b)},reset:function(){b=!1,c=null,d=null,e=null}}},g=new function(){let b=!1,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null;return{setTest:function(a){b||(a?N(2960):O(2960))},setMask:function(d){c===d||b||(a.stencilMask(d),c=d)},setFunc:function(b,c,g){(d!==b||e!==c||f!==g)&&(a.stencilFunc(b,c,g),d=b,e=c,f=g)},setOp:function(b,c,d){(g!==b||h!==c||i!==d)&&(a.stencilOp(b,c,d),g=b,h=c,i=d)},setLocked:function(a){b=a},setClear:function(b){j!==b&&(a.clearStencil(b),j=b)},reset:function(){b=!1,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null}}},h=new WeakMap,i=new WeakMap,j={},k={},l=new WeakMap,m=[],n=null,o=!1,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=!1,x=null,y=null,z=null,A=null,B=null,C=a.getParameter(35661),D=!1,E=a.getParameter(7938);-1!==E.indexOf("WebGL")?D=parseFloat(/^WebGL (\d)/.exec(E)[1])>=1:-1!==E.indexOf("OpenGL ES")&&(D=parseFloat(/^OpenGL ES (\d)/.exec(E)[1])>=2);let F=null,G={},H=a.getParameter(3088),I=a.getParameter(2978),J=new sh().fromArray(H),K=new sh().fromArray(I);function L(b,c,d){let e=new Uint8Array(4),f=a.createTexture();a.bindTexture(b,f),a.texParameteri(b,10241,9728),a.texParameteri(b,10240,9728);for(let g=0;g<d;g++)a.texImage2D(c+g,0,6408,1,1,0,6408,5121,e);return f}let M={};function N(b){!0!==j[b]&&(a.enable(b),j[b]=!0)}function O(b){!1!==j[b]&&(a.disable(b),j[b]=!1)}M[3553]=L(3553,3553,1),M[34067]=L(34067,34069,6),e.setClear(0,0,0,1),f.setClear(1),g.setClear(0),N(2929),f.setFunc(ga),ka(!1),la(1),N(2884),ja(S);let P={[U]:32774,[V]:32778,[W]:32779};if(d)P[103]=32775,P[104]=32776;else{let ha=b.get("EXT_blend_minmax");null!==ha&&(P[103]=ha.MIN_EXT,P[104]=ha.MAX_EXT)}let ia={[X]:0,[Y]:1,[Z]:768,[_]:770,[fa]:776,[da]:774,[ba]:772,[$]:769,[aa]:771,[ea]:775,[ca]:773};function ja(b,c,d,e,f,g,h,i){if(b===S){!0===o&&(O(3042),o=!1);return}if(!1===o&&(N(3042),o=!0),5!==b){if(b!==p||i!==w){if((q!==U||t!==U)&&(a.blendEquation(32774),q=U,t=U),i)switch(b){case T:a.blendFuncSeparate(1,771,1,771);break;case 2:a.blendFunc(1,1);break;case 3:a.blendFuncSeparate(0,769,0,1);break;case 4:a.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",b);break}else switch(b){case T:a.blendFuncSeparate(770,771,1,771);break;case 2:a.blendFunc(770,1);break;case 3:a.blendFuncSeparate(0,769,0,1);break;case 4:a.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",b);break}r=null,s=null,u=null,v=null,p=b,w=i}return}f=f||c,g=g||d,h=h||e,(c!==q||f!==t)&&(a.blendEquationSeparate(P[c],P[f]),q=c,t=f),(d!==r||e!==s||g!==u||h!==v)&&(a.blendFuncSeparate(ia[d],ia[e],ia[g],ia[h]),r=d,s=e,u=g,v=h),p=b,w=!1}function ka(b){x!==b&&(b?a.frontFace(2304):a.frontFace(2305),x=b)}function la(b){0!==b?(N(2884),b!==y&&(1===b?a.cullFace(1029):2===b?a.cullFace(1028):a.cullFace(1032))):O(2884),y=b}function ma(b,c,d){b?(N(32823),(A!==c||B!==d)&&(a.polygonOffset(c,d),A=c,B=d)):O(32823)}return{buffers:{color:e,depth:f,stencil:g},enable:N,disable:O,bindFramebuffer:function(b,c){return k[b]!==c&&(a.bindFramebuffer(b,c),k[b]=c,d&&(36009===b&&(k[36160]=c),36160===b&&(k[36009]=c)),!0)},drawBuffers:function(d,e){let f=m,g=!1;if(d)if(void 0===(f=l.get(e))&&(f=[],l.set(e,f)),d.isWebGLMultipleRenderTargets){let h=d.texture;if(f.length!==h.length||36064!==f[0]){for(let i=0,j=h.length;i<j;i++)f[i]=36064+i;f.length=h.length,g=!0}}else 36064!==f[0]&&(f[0]=36064,g=!0);else 1029!==f[0]&&(f[0]=1029,g=!0);g&&(c.isWebGL2?a.drawBuffers(f):b.get("WEBGL_draw_buffers").drawBuffersWEBGL(f))},useProgram:function(b){return n!==b&&(a.useProgram(b),n=b,!0)},setBlending:ja,setMaterial:function(a,b){a.side===R?O(2884):N(2884);let c=a.side===Q;b&&(c=!c),ka(c),a.blending===T&& !1===a.transparent?ja(S):ja(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha,a.premultipliedAlpha),f.setFunc(a.depthFunc),f.setTest(a.depthTest),f.setMask(a.depthWrite),e.setMask(a.colorWrite);let d=a.stencilWrite;g.setTest(d),d&&(g.setMask(a.stencilWriteMask),g.setFunc(a.stencilFunc,a.stencilRef,a.stencilFuncMask),g.setOp(a.stencilFail,a.stencilZFail,a.stencilZPass)),ma(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits),!0===a.alphaToCoverage?N(32926):O(32926)},setFlipSided:ka,setCullFace:la,setLineWidth:function(b){b!==z&&(D&&a.lineWidth(b),z=b)},setPolygonOffset:ma,setScissorTest:function(a){a?N(3089):O(3089)},activeTexture:function(b){void 0===b&&(b=33984+C-1),F!==b&&(a.activeTexture(b),F=b)},bindTexture:function(b,c,d){void 0===d&&(d=null===F?33984+C-1:F);let e=G[d];void 0===e&&(e={type:void 0,texture:void 0},G[d]=e),(e.type!==b||e.texture!==c)&&(F!==d&&(a.activeTexture(d),F=d),a.bindTexture(b,c||M[b]),e.type=b,e.texture=c)},unbindTexture:function(){let b=G[F];void 0!==b&& void 0!==b.type&&(a.bindTexture(b.type,null),b.type=void 0,b.texture=void 0)},compressedTexImage2D:function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(b){console.error("THREE.WebGLState:",b)}},compressedTexImage3D:function(){try{a.compressedTexImage3D.apply(a,arguments)}catch(b){console.error("THREE.WebGLState:",b)}},texImage2D:function(){try{a.texImage2D.apply(a,arguments)}catch(b){console.error("THREE.WebGLState:",b)}},texImage3D:function(){try{a.texImage3D.apply(a,arguments)}catch(b){console.error("THREE.WebGLState:",b)}},updateUBOMapping:function(b,c){let d=i.get(c);void 0===d&&(d=new WeakMap,i.set(c,d));let e=d.get(b);void 0===e&&(e=a.getUniformBlockIndex(c,b.name),d.set(b,e))},uniformBlockBinding:function(b,c){let d=i.get(c).get(b);h.get(c)!==d&&(a.uniformBlockBinding(c,d,b.__bindingPointIndex),h.set(c,d))},texStorage2D:function(){try{a.texStorage2D.apply(a,arguments)}catch(b){console.error("THREE.WebGLState:",b)}},texStorage3D:function(){try{a.texStorage3D.apply(a,arguments)}catch(b){console.error("THREE.WebGLState:",b)}},texSubImage2D:function(){try{a.texSubImage2D.apply(a,arguments)}catch(b){console.error("THREE.WebGLState:",b)}},texSubImage3D:function(){try{a.texSubImage3D.apply(a,arguments)}catch(b){console.error("THREE.WebGLState:",b)}},compressedTexSubImage2D:function(){try{a.compressedTexSubImage2D.apply(a,arguments)}catch(b){console.error("THREE.WebGLState:",b)}},compressedTexSubImage3D:function(){try{a.compressedTexSubImage3D.apply(a,arguments)}catch(b){console.error("THREE.WebGLState:",b)}},scissor:function(b){!1===J.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),J.copy(b))},viewport:function(b){!1===K.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),K.copy(b))},reset:function(){a.disable(3042),a.disable(2884),a.disable(2929),a.disable(32823),a.disable(3089),a.disable(2960),a.disable(32926),a.blendEquation(32774),a.blendFunc(1,0),a.blendFuncSeparate(1,0,1,0),a.colorMask(!0,!0,!0,!0),a.clearColor(0,0,0,0),a.depthMask(!0),a.depthFunc(513),a.clearDepth(1),a.stencilMask(4294967295),a.stencilFunc(519,0,4294967295),a.stencilOp(7680,7680,7680),a.clearStencil(0),a.cullFace(1029),a.frontFace(2305),a.polygonOffset(0,0),a.activeTexture(33984),a.bindFramebuffer(36160,null),!0===d&&(a.bindFramebuffer(36009,null),a.bindFramebuffer(36008,null)),a.useProgram(null),a.lineWidth(1),a.scissor(0,0,a.canvas.width,a.canvas.height),a.viewport(0,0,a.canvas.width,a.canvas.height),j={},F=null,G={},k={},l=new WeakMap,m=[],n=null,o=!1,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=!1,x=null,y=null,z=null,A=null,B=null,J.set(0,0,a.canvas.width,a.canvas.height),K.set(0,0,a.canvas.width,a.canvas.height),e.reset(),f.reset(),g.reset()}}}function VT(a,b,c,d,e,f,g){let h=e.isWebGL2,i=e.maxTextures,j=e.maxCubemapSize,k=e.maxTextureSize,l=e.maxSamples,m=b.has("WEBGL_multisampled_render_to_texture")?b.get("WEBGL_multisampled_render_to_texture"):null,n=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),o=new WeakMap,p,q=new WeakMap,r=!1;try{r="u">typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function s(a,b){return r?new OffscreenCanvas(a,b):Ue("canvas")}function t(a,b,c,d){let e=1;if((a.width>d||a.height>d)&&(e=d/Math.max(a.width,a.height)),e<1|| !0===b)if((!("u">typeof HTMLImageElement)||!(a instanceof HTMLImageElement))&&(!("u">typeof HTMLCanvasElement)||!(a instanceof HTMLCanvasElement))&&(!("u">typeof ImageBitmap)||!(a instanceof ImageBitmap)))return"data"in a&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+a.width+"x"+a.height+")."),a;else{let f=b?Ab:Math.floor,g=f(e*a.width),h=f(e*a.height);void 0===p&&(p=s(g,h));let i=c?s(g,h):p;return i.width=g,i.height=h,i.getContext("2d").drawImage(a,0,0,g,h),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+a.width+"x"+a.height+") to ("+g+"x"+h+")."),i}return a}function u(a){return yb(a.width)&&yb(a.height)}function v(a,b){return a.generateMipmaps&&b&&a.minFilter!==sa&&a.minFilter!==va}function w(b){a.generateMipmap(b)}function x(c,d,e,f,g=!1){if(!1===h)return d;if(null!==c){if(void 0!==a[c])return a[c];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+c+"'")}let i=d;return 6403===d&&(5126===e&&(i=33326),5131===e&&(i=33325),5121===e&&(i=33321)),33319===d&&(5126===e&&(i=33328),5131===e&&(i=33327),5121===e&&(i=33323)),6408===d&&(5126===e&&(i=34836),5131===e&&(i=34842),5121===e&&(i=f===Ta&& !1===g?35907:32856),32819===e&&(i=32854),32820===e&&(i=32855)),(33325===i||33326===i||33327===i||33328===i||34842===i||34836===i)&&b.get("EXT_color_buffer_float"),i}function y(a,b,c){return!0===v(a,c)||a.isFramebufferTexture&&a.minFilter!==sa&&a.minFilter!==va?Math.log2(Math.max(b.width,b.height))+1:void 0!==a.mipmaps&&a.mipmaps.length>0?a.mipmaps.length:a.isCompressedTexture&&Array.isArray(a.image)?b.mipmaps.length:1}function z(a){return a===sa||a===ta||a===ua?9728:9729}function A(a){let b=a.target;b.removeEventListener("dispose",A),C(b),b.isVideoTexture&&o.delete(b)}function B(a){let b=a.target;b.removeEventListener("dispose",B),E(b)}function C(a){let b=d.get(a);if(void 0===b.__webglInit)return;let c=a.source,e=q.get(c);if(e){let f=e[b.__cacheKey];f.usedTimes--,0===f.usedTimes&&D(a),0===Object.keys(e).length&&q.delete(c)}d.remove(a)}function D(b){let c=d.get(b);a.deleteTexture(c.__webglTexture);let e=b.source;delete q.get(e)[c.__cacheKey],g.memory.textures--}function E(b){let c=b.texture,e=d.get(b),f=d.get(c);if(void 0!==f.__webglTexture&&(a.deleteTexture(f.__webglTexture),g.memory.textures--),b.depthTexture&&b.depthTexture.dispose(),b.isWebGLCubeRenderTarget)for(let h=0;h<6;h++)a.deleteFramebuffer(e.__webglFramebuffer[h]),e.__webglDepthbuffer&&a.deleteRenderbuffer(e.__webglDepthbuffer[h]);else{if(a.deleteFramebuffer(e.__webglFramebuffer),e.__webglDepthbuffer&&a.deleteRenderbuffer(e.__webglDepthbuffer),e.__webglMultisampledFramebuffer&&a.deleteFramebuffer(e.__webglMultisampledFramebuffer),e.__webglColorRenderbuffer)for(let i=0;i<e.__webglColorRenderbuffer.length;i++)e.__webglColorRenderbuffer[i]&&a.deleteRenderbuffer(e.__webglColorRenderbuffer[i]);e.__webglDepthRenderbuffer&&a.deleteRenderbuffer(e.__webglDepthRenderbuffer)}if(b.isWebGLMultipleRenderTargets)for(let j=0,k=c.length;j<k;j++){let l=d.get(c[j]);l.__webglTexture&&(a.deleteTexture(l.__webglTexture),g.memory.textures--),d.remove(c[j])}d.remove(c),d.remove(b)}let F=0;function G(a,b){let e=d.get(a);if(a.isVideoTexture&&R(a),!1===a.isRenderTargetTexture&&a.version>0&&e.__version!==a.version){let f=a.image;if(null===f)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(!1===f.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{L(e,a,b);return}}c.bindTexture(3553,e.__webglTexture,33984+b)}let H={[pa]:10497,[qa]:33071,[ra]:33648},I={[sa]:9728,[ta]:9984,[ua]:9986,[va]:9729,[wa]:9985,[xa]:9987};function J(c,f,g){if(g?(a.texParameteri(c,10242,H[f.wrapS]),a.texParameteri(c,10243,H[f.wrapT]),(32879===c||35866===c)&&a.texParameteri(c,32882,H[f.wrapR]),a.texParameteri(c,10240,I[f.magFilter]),a.texParameteri(c,10241,I[f.minFilter])):(a.texParameteri(c,10242,33071),a.texParameteri(c,10243,33071),(32879===c||35866===c)&&a.texParameteri(c,32882,33071),(f.wrapS!==qa||f.wrapT!==qa)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),a.texParameteri(c,10240,z(f.magFilter)),a.texParameteri(c,10241,z(f.minFilter)),f.minFilter!==sa&&f.minFilter!==va&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===b.has("EXT_texture_filter_anisotropic")){let i=b.get("EXT_texture_filter_anisotropic");f.magFilter!==sa&&(f.minFilter===ua||f.minFilter===xa)&&(f.type!==Aa|| !1!==b.has("OES_texture_float_linear"))&&(!1!==h||f.type!==Ba|| !1!==b.has("OES_texture_half_float_linear"))&&(f.anisotropy>1||d.get(f).__currentAnisotropy)&&(a.texParameterf(c,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(f.anisotropy,e.getMaxAnisotropy())),d.get(f).__currentAnisotropy=f.anisotropy)}}function K(b,c){var d;let e=!1;void 0===b.__webglInit&&(b.__webglInit=!0,c.addEventListener("dispose",A));let f=c.source,h=q.get(f);void 0===h&&(h={},q.set(f,h));let i,j=(d=c,(i=[]).push(d.wrapS),i.push(d.wrapT),i.push(d.wrapR||0),i.push(d.magFilter),i.push(d.minFilter),i.push(d.anisotropy),i.push(d.internalFormat),i.push(d.format),i.push(d.type),i.push(d.generateMipmaps),i.push(d.premultiplyAlpha),i.push(d.flipY),i.push(d.unpackAlignment),i.push(d.encoding),i.join());if(j!==b.__cacheKey){void 0===h[j]&&(h[j]={texture:a.createTexture(),usedTimes:0},g.memory.textures++,e=!0),h[j].usedTimes++;let k=h[b.__cacheKey];void 0!==k&&(h[b.__cacheKey].usedTimes--,0===k.usedTimes&&D(c)),b.__cacheKey=j,b.__webglTexture=h[j].texture}return e}function L(b,e,g){let i=3553;(e.isDataArrayTexture||e.isCompressedArrayTexture)&&(i=35866),e.isData3DTexture&&(i=32879);let j=K(b,e),l=e.source;c.bindTexture(i,b.__webglTexture,33984+g);let m=d.get(l);if(l.version!==m.__version|| !0===j){var n;c.activeTexture(33984+g),a.pixelStorei(37440,e.flipY),a.pixelStorei(37441,e.premultiplyAlpha),a.pixelStorei(3317,e.unpackAlignment),a.pixelStorei(37443,0);let o=(n=e,!h&&(n.wrapS!==qa||n.wrapT!==qa||n.minFilter!==sa&&n.minFilter!==va)&& !1===u(e.image)),p=t(e.image,o,!1,k);p=S(e,p);let q=u(p)||h,r=f.convert(e.format,e.encoding),s=f.convert(e.type),z=x(e.internalFormat,r,s,e.encoding,e.isVideoTexture);J(i,e,q);let A,B=e.mipmaps,C=h&& !0!==e.isVideoTexture,D=void 0===m.__version|| !0===j,E=y(e,p,q);if(e.isDepthTexture)z=6402,h?z=e.type===Aa?36012:e.type===za?33190:e.type===Ca?35056:33189:e.type===Aa&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),e.format===Ea&&6402===z&&1012!==e.type&&e.type!==za&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),e.type=za,s=f.convert(e.type)),e.format===Fa&&6402===z&&(z=34041,e.type!==Ca&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),e.type=Ca,s=f.convert(e.type))),D&&(C?c.texStorage2D(3553,1,z,p.width,p.height):c.texImage2D(3553,0,z,p.width,p.height,0,r,s,null));else if(e.isDataTexture)if(B.length>0&&q){C&&D&&c.texStorage2D(3553,E,z,B[0].width,B[0].height);for(let F=0,G=B.length;F<G;F++)A=B[F],C?c.texSubImage2D(3553,F,0,0,A.width,A.height,r,s,A.data):c.texImage2D(3553,F,z,A.width,A.height,0,r,s,A.data);e.generateMipmaps=!1}else C?(D&&c.texStorage2D(3553,E,z,p.width,p.height),c.texSubImage2D(3553,0,0,0,p.width,p.height,r,s,p.data)):c.texImage2D(3553,0,z,p.width,p.height,0,r,s,p.data);else if(e.isCompressedTexture)if(e.isCompressedArrayTexture){C&&D&&c.texStorage3D(35866,E,z,B[0].width,B[0].height,p.depth);for(let H=0,I=B.length;H<I;H++)A=B[H],e.format!==Da?null!==r?C?c.compressedTexSubImage3D(35866,H,0,0,0,A.width,A.height,p.depth,r,A.data,0,0):c.compressedTexImage3D(35866,H,z,A.width,A.height,p.depth,0,A.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):C?c.texSubImage3D(35866,H,0,0,0,A.width,A.height,p.depth,r,s,A.data):c.texImage3D(35866,H,z,A.width,A.height,p.depth,0,r,s,A.data)}else{C&&D&&c.texStorage2D(3553,E,z,B[0].width,B[0].height);for(let L=0,M=B.length;L<M;L++)A=B[L],e.format!==Da?null!==r?C?c.compressedTexSubImage2D(3553,L,0,0,A.width,A.height,r,A.data):c.compressedTexImage2D(3553,L,z,A.width,A.height,0,A.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):C?c.texSubImage2D(3553,L,0,0,A.width,A.height,r,s,A.data):c.texImage2D(3553,L,z,A.width,A.height,0,r,s,A.data)}else if(e.isDataArrayTexture)C?(D&&c.texStorage3D(35866,E,z,p.width,p.height,p.depth),c.texSubImage3D(35866,0,0,0,0,p.width,p.height,p.depth,r,s,p.data)):c.texImage3D(35866,0,z,p.width,p.height,p.depth,0,r,s,p.data);else if(e.isData3DTexture)C?(D&&c.texStorage3D(32879,E,z,p.width,p.height,p.depth),c.texSubImage3D(32879,0,0,0,0,p.width,p.height,p.depth,r,s,p.data)):c.texImage3D(32879,0,z,p.width,p.height,p.depth,0,r,s,p.data);else if(e.isFramebufferTexture){if(D)if(C)c.texStorage2D(3553,E,z,p.width,p.height);else{let N=p.width,O=p.height;for(let P=0;P<E;P++)c.texImage2D(3553,P,z,N,O,0,r,s,null),N>>=1,O>>=1}}else if(B.length>0&&q){C&&D&&c.texStorage2D(3553,E,z,B[0].width,B[0].height);for(let Q=0,R=B.length;Q<R;Q++)A=B[Q],C?c.texSubImage2D(3553,Q,0,0,r,s,A):c.texImage2D(3553,Q,z,r,s,A);e.generateMipmaps=!1}else C?(D&&c.texStorage2D(3553,E,z,p.width,p.height),c.texSubImage2D(3553,0,0,0,r,s,p)):c.texImage2D(3553,0,z,r,s,p);v(e,q)&&w(i),m.__version=l.version,e.onUpdate&&e.onUpdate(e)}b.__version=e.version}function M(b,e,g,h,i){let j=f.convert(g.format,g.encoding),k=f.convert(g.type),l=x(g.internalFormat,j,k,g.encoding);d.get(e).__hasExternalTextures||(32879===i||35866===i?c.texImage3D(i,0,l,e.width,e.height,e.depth,0,j,k,null):c.texImage2D(i,0,l,e.width,e.height,0,j,k,null)),c.bindFramebuffer(36160,b),Q(e)?m.framebufferTexture2DMultisampleEXT(36160,h,i,d.get(g).__webglTexture,0,P(e)):(3553===i||i>=34069&&i<=34074)&&a.framebufferTexture2D(36160,h,i,d.get(g).__webglTexture,0),c.bindFramebuffer(36160,null)}function N(b,c,d){if(a.bindRenderbuffer(36161,b),c.depthBuffer&&!c.stencilBuffer){let e=33189;if(d||Q(c)){let g=c.depthTexture;g&&g.isDepthTexture&&(g.type===Aa?e=36012:g.type===za&&(e=33190));let h=P(c);Q(c)?m.renderbufferStorageMultisampleEXT(36161,h,e,c.width,c.height):a.renderbufferStorageMultisample(36161,h,e,c.width,c.height)}else a.renderbufferStorage(36161,e,c.width,c.height);a.framebufferRenderbuffer(36160,36096,36161,b)}else if(c.depthBuffer&&c.stencilBuffer){let i=P(c);d&& !1===Q(c)?a.renderbufferStorageMultisample(36161,i,35056,c.width,c.height):Q(c)?m.renderbufferStorageMultisampleEXT(36161,i,35056,c.width,c.height):a.renderbufferStorage(36161,34041,c.width,c.height),a.framebufferRenderbuffer(36160,33306,36161,b)}else{let j=!0===c.isWebGLMultipleRenderTargets?c.texture:[c.texture];for(let k=0;k<j.length;k++){let l=j[k],n=f.convert(l.format,l.encoding),o=f.convert(l.type),p=x(l.internalFormat,n,o,l.encoding),q=P(c);d&& !1===Q(c)?a.renderbufferStorageMultisample(36161,q,p,c.width,c.height):Q(c)?m.renderbufferStorageMultisampleEXT(36161,q,p,c.width,c.height):a.renderbufferStorage(36161,p,c.width,c.height)}}a.bindRenderbuffer(36161,null)}function O(b){let e=d.get(b),f=!0===b.isWebGLCubeRenderTarget;if(b.depthTexture&&!e.__autoAllocateDepthBuffer){if(f)throw new Error("target.depthTexture not supported in Cube render targets");!function(b,e){if(e&&e.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(c.bindFramebuffer(36160,b),!(e.depthTexture&&e.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");d.get(e.depthTexture).__webglTexture&&e.depthTexture.image.width===e.width&&e.depthTexture.image.height===e.height||(e.depthTexture.image.width=e.width,e.depthTexture.image.height=e.height,e.depthTexture.needsUpdate=!0),G(e.depthTexture,0);let f=d.get(e.depthTexture).__webglTexture,g=P(e);if(e.depthTexture.format===Ea)Q(e)?m.framebufferTexture2DMultisampleEXT(36160,36096,3553,f,0,g):a.framebufferTexture2D(36160,36096,3553,f,0);else if(e.depthTexture.format===Fa)Q(e)?m.framebufferTexture2DMultisampleEXT(36160,33306,3553,f,0,g):a.framebufferTexture2D(36160,33306,3553,f,0);else throw new Error("Unknown depthTexture format")}(e.__webglFramebuffer,b)}else if(f){e.__webglDepthbuffer=[];for(let g=0;g<6;g++)c.bindFramebuffer(36160,e.__webglFramebuffer[g]),e.__webglDepthbuffer[g]=a.createRenderbuffer(),N(e.__webglDepthbuffer[g],b,!1)}else c.bindFramebuffer(36160,e.__webglFramebuffer),e.__webglDepthbuffer=a.createRenderbuffer(),N(e.__webglDepthbuffer,b,!1);c.bindFramebuffer(36160,null)}function P(a){return Math.min(l,a.samples)}function Q(a){let c=d.get(a);return h&&a.samples>0&& !0===b.has("WEBGL_multisampled_render_to_texture")&& !1!==c.__useRenderToTexture}function R(a){let b=g.render.frame;o.get(a)!==b&&(o.set(a,b),a.update())}function S(a,c){let d=a.encoding,e=a.format,f=a.type;return!0===a.isCompressedTexture|| !0===a.isVideoTexture||1035===a.format||d!==Sa&&(d===Ta?!1===h?!0===b.has("EXT_sRGB")&&e===Da?(a.format=1035,a.minFilter=va,a.generateMipmaps=!1):c=Eg.sRGBToLinear(c):(e!==Da||f!==ya)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",d)),c}this.allocateTextureUnit=function(){let a=F;return a>=i&&console.warn("THREE.WebGLTextures: Trying to use "+a+" texture units while this GPU supports only "+i),F+=1,a},this.resetTextureUnits=function(){F=0},this.setTexture2D=G,this.setTexture2DArray=function(a,b){let e=d.get(a);if(a.version>0&&e.__version!==a.version){L(e,a,b);return}c.bindTexture(35866,e.__webglTexture,33984+b)},this.setTexture3D=function(a,b){let e=d.get(a);if(a.version>0&&e.__version!==a.version){L(e,a,b);return}c.bindTexture(32879,e.__webglTexture,33984+b)},this.setTextureCube=function(b,e){let g=d.get(b);if(b.version>0&&g.__version!==b.version){(function(b,e,g){if(6!==e.image.length)return;let i=K(b,e),k=e.source;c.bindTexture(34067,b.__webglTexture,33984+g);let l=d.get(k);if(k.version!==l.__version|| !0===i){c.activeTexture(33984+g),a.pixelStorei(37440,e.flipY),a.pixelStorei(37441,e.premultiplyAlpha),a.pixelStorei(3317,e.unpackAlignment),a.pixelStorei(37443,0);let m=e.isCompressedTexture||e.image[0].isCompressedTexture,n=e.image[0]&&e.image[0].isDataTexture,o=[];for(let p=0;p<6;p++)m||n?o[p]=n?e.image[p].image:e.image[p]:o[p]=t(e.image[p],!1,!0,j),o[p]=S(e,o[p]);let q=o[0],r=u(q)||h,s=f.convert(e.format,e.encoding),z=f.convert(e.type),A=x(e.internalFormat,s,z,e.encoding),B=h&& !0!==e.isVideoTexture,C=void 0===l.__version|| !0===i,D=y(e,q,r);J(34067,e,r);let E;if(m){B&&C&&c.texStorage2D(34067,D,A,q.width,q.height);for(let F=0;F<6;F++){E=o[F].mipmaps;for(let G=0;G<E.length;G++){let H=E[G];e.format!==Da?null!==s?B?c.compressedTexSubImage2D(34069+F,G,0,0,H.width,H.height,s,H.data):c.compressedTexImage2D(34069+F,G,A,H.width,H.height,0,H.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):B?c.texSubImage2D(34069+F,G,0,0,H.width,H.height,s,z,H.data):c.texImage2D(34069+F,G,A,H.width,H.height,0,s,z,H.data)}}}else{E=e.mipmaps,B&&C&&(E.length>0&&D++,c.texStorage2D(34067,D,A,o[0].width,o[0].height));for(let I=0;I<6;I++)if(n){B?c.texSubImage2D(34069+I,0,0,0,o[I].width,o[I].height,s,z,o[I].data):c.texImage2D(34069+I,0,A,o[I].width,o[I].height,0,s,z,o[I].data);for(let L=0;L<E.length;L++){let M=E[L].image[I].image;B?c.texSubImage2D(34069+I,L+1,0,0,M.width,M.height,s,z,M.data):c.texImage2D(34069+I,L+1,A,M.width,M.height,0,s,z,M.data)}}else{B?c.texSubImage2D(34069+I,0,0,0,s,z,o[I]):c.texImage2D(34069+I,0,A,s,z,o[I]);for(let N=0;N<E.length;N++){let O=E[N];B?c.texSubImage2D(34069+I,N+1,0,0,s,z,O.image[I]):c.texImage2D(34069+I,N+1,A,s,z,O.image[I])}}}v(e,r)&&w(34067),l.__version=k.version,e.onUpdate&&e.onUpdate(e)}b.__version=e.version})(g,b,e);return}c.bindTexture(34067,g.__webglTexture,33984+e)},this.rebindTextures=function(a,b,c){let e=d.get(a);void 0!==b&&M(e.__webglFramebuffer,a,a.texture,36064,3553),void 0!==c&&O(a)},this.setupRenderTarget=function(b){let i=b.texture,j=d.get(b),k=d.get(i);b.addEventListener("dispose",B),!0!==b.isWebGLMultipleRenderTargets&&(void 0===k.__webglTexture&&(k.__webglTexture=a.createTexture()),k.__version=i.version,g.memory.textures++);let l=!0===b.isWebGLCubeRenderTarget,m=!0===b.isWebGLMultipleRenderTargets,n=u(b)||h;if(l){j.__webglFramebuffer=[];for(let o=0;o<6;o++)j.__webglFramebuffer[o]=a.createFramebuffer()}else{if(j.__webglFramebuffer=a.createFramebuffer(),m)if(e.drawBuffers){let p=b.texture;for(let q=0,r=p.length;q<r;q++){let s=d.get(p[q]);void 0===s.__webglTexture&&(s.__webglTexture=a.createTexture(),g.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(h&&b.samples>0&& !1===Q(b)){let t=m?i:[i];j.__webglMultisampledFramebuffer=a.createFramebuffer(),j.__webglColorRenderbuffer=[],c.bindFramebuffer(36160,j.__webglMultisampledFramebuffer);for(let y=0;y<t.length;y++){let z=t[y];j.__webglColorRenderbuffer[y]=a.createRenderbuffer(),a.bindRenderbuffer(36161,j.__webglColorRenderbuffer[y]);let A=f.convert(z.format,z.encoding),C=f.convert(z.type),D=x(z.internalFormat,A,C,z.encoding,!0===b.isXRRenderTarget),E=P(b);a.renderbufferStorageMultisample(36161,E,D,b.width,b.height),a.framebufferRenderbuffer(36160,36064+y,36161,j.__webglColorRenderbuffer[y])}a.bindRenderbuffer(36161,null),b.depthBuffer&&(j.__webglDepthRenderbuffer=a.createRenderbuffer(),N(j.__webglDepthRenderbuffer,b,!0)),c.bindFramebuffer(36160,null)}}if(l){c.bindTexture(34067,k.__webglTexture),J(34067,i,n);for(let F=0;F<6;F++)M(j.__webglFramebuffer[F],b,i,36064,34069+F);v(i,n)&&w(34067),c.unbindTexture()}else if(m){let G=b.texture;for(let H=0,I=G.length;H<I;H++){let K=G[H],L=d.get(K);c.bindTexture(3553,L.__webglTexture),J(3553,K,n),M(j.__webglFramebuffer,b,K,36064+H,3553),v(K,n)&&w(3553)}c.unbindTexture()}else{let R=3553;(b.isWebGL3DRenderTarget||b.isWebGLArrayRenderTarget)&&(h?R=b.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),c.bindTexture(R,k.__webglTexture),J(R,i,n),M(j.__webglFramebuffer,b,i,36064,R),v(i,n)&&w(R),c.unbindTexture()}b.depthBuffer&&O(b)},this.updateRenderTargetMipmap=function(a){let b=u(a)||h,e=!0===a.isWebGLMultipleRenderTargets?a.texture:[a.texture];for(let f=0,g=e.length;f<g;f++){let i=e[f];if(v(i,b)){let j=a.isWebGLCubeRenderTarget?34067:3553,k=d.get(i).__webglTexture;c.bindTexture(j,k),w(j),c.unbindTexture()}}},this.updateMultisampleRenderTarget=function(b){if(h&&b.samples>0&& !1===Q(b)){let e=b.isWebGLMultipleRenderTargets?b.texture:[b.texture],f=b.width,g=b.height,i=16384,j=[],k=b.stencilBuffer?33306:36096,l=d.get(b),m=!0===b.isWebGLMultipleRenderTargets;if(m)for(let o=0;o<e.length;o++)c.bindFramebuffer(36160,l.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(36160,36064+o,36161,null),c.bindFramebuffer(36160,l.__webglFramebuffer),a.framebufferTexture2D(36009,36064+o,3553,null,0);c.bindFramebuffer(36008,l.__webglMultisampledFramebuffer),c.bindFramebuffer(36009,l.__webglFramebuffer);for(let p=0;p<e.length;p++){j.push(36064+p),b.depthBuffer&&j.push(k);let q=void 0!==l.__ignoreDepthValues&&l.__ignoreDepthValues;if(!1===q&&(b.depthBuffer&&(i|=256),b.stencilBuffer&&(i|=1024)),m&&a.framebufferRenderbuffer(36008,36064,36161,l.__webglColorRenderbuffer[p]),!0===q&&(a.invalidateFramebuffer(36008,[k]),a.invalidateFramebuffer(36009,[k])),m){let r=d.get(e[p]).__webglTexture;a.framebufferTexture2D(36009,36064,3553,r,0)}a.blitFramebuffer(0,0,f,g,0,0,f,g,i,9728),n&&a.invalidateFramebuffer(36008,j)}if(c.bindFramebuffer(36008,null),c.bindFramebuffer(36009,null),m)for(let s=0;s<e.length;s++){c.bindFramebuffer(36160,l.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(36160,36064+s,36161,l.__webglColorRenderbuffer[s]);let t=d.get(e[s]).__webglTexture;c.bindFramebuffer(36160,l.__webglFramebuffer),a.framebufferTexture2D(36009,36064+s,3553,t,0)}c.bindFramebuffer(36009,l.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=O,this.setupFrameBufferTexture=M,this.useMultisampledRTT=Q}function WT(a,b,c){let d=c.isWebGL2;return{convert:function(c,e=null){let f;if(c===ya)return 5121;if(1017===c)return 32819;if(1018===c)return 32820;if(1010===c)return 5120;if(1011===c)return 5122;if(1012===c)return 5123;if(1013===c)return 5124;if(c===za)return 5125;if(c===Aa)return 5126;if(c===Ba)return d?5131:null!==(f=b.get("OES_texture_half_float"))?f.HALF_FLOAT_OES:null;if(1021===c)return 6406;if(c===Da)return 6408;if(1024===c)return 6409;if(1025===c)return 6410;if(c===Ea)return 6402;if(c===Fa)return 34041;if(1035===c)return null!==(f=b.get("EXT_sRGB"))?f.SRGB_ALPHA_EXT:null;if(1028===c)return 6403;if(1029===c)return 36244;if(c===Ga)return 33319;if(1031===c)return 33320;if(1033===c)return 36249;if(33776===c||33777===c||33778===c||33779===c)if(e===Ta)if(null===(f=b.get("WEBGL_compressed_texture_s3tc_srgb")))return null;else{if(33776===c)return f.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===c)return f.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===c)return f.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===c)return f.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(f=b.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===c)return f.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===c)return f.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===c)return f.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===c)return f.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===c||35841===c||35842===c||35843===c)if(null===(f=b.get("WEBGL_compressed_texture_pvrtc")))return null;else{if(35840===c)return f.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===c)return f.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===c)return f.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===c)return f.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===c)return null!==(f=b.get("WEBGL_compressed_texture_etc1"))?f.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===c||37496===c)if(null===(f=b.get("WEBGL_compressed_texture_etc")))return null;else{if(37492===c)return e===Ta?f.COMPRESSED_SRGB8_ETC2:f.COMPRESSED_RGB8_ETC2;if(37496===c)return e===Ta?f.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:f.COMPRESSED_RGBA8_ETC2_EAC}if(37808===c||37809===c||37810===c||37811===c||37812===c||37813===c||37814===c||37815===c||37816===c||37817===c||37818===c||37819===c||37820===c||37821===c)if(null===(f=b.get("WEBGL_compressed_texture_astc")))return null;else{if(37808===c)return e===Ta?f.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:f.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===c)return e===Ta?f.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:f.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===c)return e===Ta?f.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:f.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===c)return e===Ta?f.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:f.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===c)return e===Ta?f.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:f.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===c)return e===Ta?f.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:f.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===c)return e===Ta?f.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:f.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===c)return e===Ta?f.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:f.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===c)return e===Ta?f.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:f.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===c)return e===Ta?f.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:f.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===c)return e===Ta?f.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:f.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===c)return e===Ta?f.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:f.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===c)return e===Ta?f.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:f.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===c)return e===Ta?f.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:f.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===c){if(null===(f=b.get("EXT_texture_compression_bptc")))return null;else if(36492===c)return e===Ta?f.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:f.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(36283===c||36284===c||36285===c||36286===c)if(null===(f=b.get("EXT_texture_compression_rgtc")))return null;else{if(36492===c)return f.COMPRESSED_RED_RGTC1_EXT;if(36284===c)return f.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===c)return f.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===c)return f.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return c===Ca?d?34042:null!==(f=b.get("WEBGL_depth_texture"))?f.UNSIGNED_INT_24_8_WEBGL:null:void 0!==a[c]?a[c]:null}}}var XT=class extends GJ{constructor(YT=[]){super(),this.isArrayCamera=!0,this.cameras=YT}},ZT=class extends Iy{constructor(){super(),this.isGroup=!0,this.type="Group"}},$T={type:"move"},_T=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new ZT,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new ZT,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new fm,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new fm),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new ZT,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new fm,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new fm),this._grip}dispatchEvent(aU){return null!==this._targetRay&&this._targetRay.dispatchEvent(aU),null!==this._grip&&this._grip.dispatchEvent(aU),null!==this._hand&&this._hand.dispatchEvent(aU),this}connect(bU){if(bU&&bU.hand){let cU=this._hand;if(cU)for(let dU of bU.hand.values())this._getHandJoint(cU,dU)}return this.dispatchEvent({type:"connected",data:bU}),this}disconnect(eU){return this.dispatchEvent({type:"disconnected",data:eU}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(fU,gU,hU){let iU=null,jU=null,kU=null,lU=this._targetRay,mU=this._grip,nU=this._hand;if(fU&&"visible-blurred"!==gU.session.visibilityState){if(nU&&fU.hand){for(let oU of(kU=!0,fU.hand.values())){let pU=gU.getJointPose(oU,hU),qU=this._getHandJoint(nU,oU);null!==pU&&(qU.matrix.fromArray(pU.transform.matrix),qU.matrix.decompose(qU.position,qU.rotation,qU.scale),qU.jointRadius=pU.radius),qU.visible=null!==pU}let rU=nU.joints["index-finger-tip"],sU=nU.joints["thumb-tip"],tU=rU.position.distanceTo(sU.position),uU=.02,vU=.005;nU.inputState.pinching&&tU>uU+vU?(nU.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:fU.handedness,target:this})):!nU.inputState.pinching&&tU<=uU-vU&&(nU.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:fU.handedness,target:this}))}else null!==mU&&fU.gripSpace&&null!==(jU=gU.getPose(fU.gripSpace,hU))&&(mU.matrix.fromArray(jU.transform.matrix),mU.matrix.decompose(mU.position,mU.rotation,mU.scale),jU.linearVelocity?(mU.hasLinearVelocity=!0,mU.linearVelocity.copy(jU.linearVelocity)):mU.hasLinearVelocity=!1,jU.angularVelocity?(mU.hasAngularVelocity=!0,mU.angularVelocity.copy(jU.angularVelocity)):mU.hasAngularVelocity=!1);null!==lU&&(null===(iU=gU.getPose(fU.targetRaySpace,hU))&&null!==jU&&(iU=jU),null!==iU&&(lU.matrix.fromArray(iU.transform.matrix),lU.matrix.decompose(lU.position,lU.rotation,lU.scale),iU.linearVelocity?(lU.hasLinearVelocity=!0,lU.linearVelocity.copy(iU.linearVelocity)):lU.hasLinearVelocity=!1,iU.angularVelocity?(lU.hasAngularVelocity=!0,lU.angularVelocity.copy(iU.angularVelocity)):lU.hasAngularVelocity=!1,this.dispatchEvent($T)))}return null!==lU&&(lU.visible=null!==iU),null!==mU&&(mU.visible=null!==jU),null!==nU&&(nU.visible=null!==kU),this}_getHandJoint(wU,xU){if(void 0===wU.joints[xU.jointName]){let yU=new ZT;yU.matrixAutoUpdate=!1,yU.visible=!1,wU.joints[xU.jointName]=yU,wU.add(yU)}return wU.joints[xU.jointName]}},zU=class extends ah{constructor(AU,BU,CU,DU,EU,FU,GU,HU,IU,JU){if((JU=void 0!==JU?JU:Ea)!==Ea&&JU!==Fa)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===CU&&JU===Ea&&(CU=za),void 0===CU&&JU===Fa&&(CU=Ca),super(null,DU,EU,FU,GU,HU,JU,CU,IU),this.isDepthTexture=!0,this.image={width:AU,height:BU},this.magFilter=void 0!==GU?GU:sa,this.minFilter=void 0!==HU?HU:sa,this.flipY=!1,this.generateMipmaps=!1}},KU=class extends ab{constructor(LU,MU){super();let NU=this,OU=null,PU=1,QU=null,RU="local-floor",SU=1,TU=null,UU=null,VU=null,WU=null,XU=null,YU=null,ZU=MU.getContextAttributes(),$U=null,_U=null,aV=[],bV=[],cV=new Set,dV=new Map,eV=new GJ;eV.layers.enable(1),eV.viewport=new sh;let fV=new GJ;fV.layers.enable(2),fV.viewport=new sh;let gV=[eV,fV],hV=new XT;hV.layers.enable(1),hV.layers.enable(2);let iV=null,jV=null;function kV(a){let b=bV.indexOf(a.inputSource);if(-1===b)return;let c=aV[b];void 0!==c&&c.dispatchEvent({type:a.type,data:a.inputSource})}function lV(){OU.removeEventListener("select",kV),OU.removeEventListener("selectstart",kV),OU.removeEventListener("selectend",kV),OU.removeEventListener("squeeze",kV),OU.removeEventListener("squeezestart",kV),OU.removeEventListener("squeezeend",kV),OU.removeEventListener("end",lV),OU.removeEventListener("inputsourceschange",mV);for(let a=0;a<aV.length;a++){let b=bV[a];null!==b&&(bV[a]=null,aV[a].disconnect(b))}iV=null,jV=null,LU.setRenderTarget($U),XU=null,WU=null,VU=null,OU=null,_U=null,rV.stop(),NU.isPresenting=!1,NU.dispatchEvent({type:"sessionend"})}function mV(a){for(let b=0;b<a.removed.length;b++){let c=a.removed[b],d=bV.indexOf(c);d>=0&&(bV[d]=null,aV[d].disconnect(c))}for(let e=0;e<a.added.length;e++){let f=a.added[e],g=bV.indexOf(f);if(-1===g){for(let h=0;h<aV.length;h++)if(h>=bV.length){bV.push(f),g=h;break}else if(null===bV[h]){bV[h]=f,g=h;break}if(-1===g)break}let i=aV[g];i&&i.connect(f)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(a){let b=aV[a];return void 0===b&&(b=new _T,aV[a]=b),b.getTargetRaySpace()},this.getControllerGrip=function(a){let b=aV[a];return void 0===b&&(b=new _T,aV[a]=b),b.getGripSpace()},this.getHand=function(a){let b=aV[a];return void 0===b&&(b=new _T,aV[a]=b),b.getHandSpace()},this.setFramebufferScaleFactor=function(a){PU=a,!0===NU.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(a){RU=a,!0===NU.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return TU||QU},this.setReferenceSpace=function(a){TU=a},this.getBaseLayer=function(){return null!==WU?WU:XU},this.getBinding=function(){return VU},this.getFrame=function(){return YU},this.getSession=function(){return OU},this.setSession=async function(a){if(null!==(OU=a)){if($U=LU.getRenderTarget(),OU.addEventListener("select",kV),OU.addEventListener("selectstart",kV),OU.addEventListener("selectend",kV),OU.addEventListener("squeeze",kV),OU.addEventListener("squeezestart",kV),OU.addEventListener("squeezeend",kV),OU.addEventListener("end",lV),OU.addEventListener("inputsourceschange",mV),!0!==ZU.xrCompatible&&await MU.makeXRCompatible(),void 0===OU.renderState.layers|| !1===LU.capabilities.isWebGL2){let b={antialias:void 0!==OU.renderState.layers||ZU.antialias,alpha:ZU.alpha,depth:ZU.depth,stencil:ZU.stencil,framebufferScaleFactor:PU};XU=new XRWebGLLayer(OU,MU,b),OU.updateRenderState({baseLayer:XU}),_U=new Yi(XU.framebufferWidth,XU.framebufferHeight,{format:Da,type:ya,encoding:LU.outputEncoding,stencilBuffer:ZU.stencil})}else{let c=null,d=null,e=null;ZU.depth&&(e=ZU.stencil?35056:33190,c=ZU.stencil?Fa:Ea,d=ZU.stencil?Ca:za);let f={colorFormat:32856,depthFormat:e,scaleFactor:PU};WU=(VU=new XRWebGLBinding(OU,MU)).createProjectionLayer(f),OU.updateRenderState({layers:[WU]}),_U=new Yi(WU.textureWidth,WU.textureHeight,{format:Da,type:ya,depthTexture:new zU(WU.textureWidth,WU.textureHeight,d,void 0,void 0,void 0,void 0,void 0,void 0,c),stencilBuffer:ZU.stencil,encoding:LU.outputEncoding,samples:ZU.antialias?4:0});let g=LU.properties.get(_U);g.__ignoreDepthValues=WU.ignoreDepthValues}_U.isXRRenderTarget=!0,this.setFoveation(SU),TU=null,QU=await OU.requestReferenceSpace(RU),rV.setContext(OU),rV.start(),NU.isPresenting=!0,NU.dispatchEvent({type:"sessionstart"})}};let nV=new fm,oV=new fm;function pV(a,b){null===b?a.matrixWorld.copy(a.matrix):a.matrixWorld.multiplyMatrices(b.matrixWorld,a.matrix),a.matrixWorldInverse.copy(a.matrixWorld).invert()}this.updateCamera=function(a){if(null===OU)return;hV.near=fV.near=eV.near=a.near,hV.far=fV.far=eV.far=a.far,(iV!==hV.near||jV!==hV.far)&&(OU.updateRenderState({depthNear:hV.near,depthFar:hV.far}),iV=hV.near,jV=hV.far);let b=a.parent,c=hV.cameras;pV(hV,b);for(let d=0;d<c.length;d++)pV(c[d],b);hV.matrixWorld.decompose(hV.position,hV.quaternion,hV.scale),a.matrix.copy(hV.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale);let e=a.children;for(let f=0,g=e.length;f<g;f++)e[f].updateMatrixWorld(!0);2===c.length?(function(a,b,c){nV.setFromMatrixPosition(b.matrixWorld),oV.setFromMatrixPosition(c.matrixWorld);let d=nV.distanceTo(oV),e=b.projectionMatrix.elements,f=c.projectionMatrix.elements,g=e[14]/(e[10]-1),h=e[14]/(e[10]+1),i=(e[9]+1)/e[5],j=(e[9]-1)/e[5],k=(e[8]-1)/e[0],l=(f[8]+1)/f[0],m=g*k,n=g*l,o=d/(-k+l),p=-(o*k);b.matrixWorld.decompose(a.position,a.quaternion,a.scale),a.translateX(p),a.translateZ(o),a.matrixWorld.compose(a.position,a.quaternion,a.scale),a.matrixWorldInverse.copy(a.matrixWorld).invert();let q=g+o,r=h+o,s=m-p,t=n+(d-p),u=i*h/r*q,v=j*h/r*q;a.projectionMatrix.makePerspective(s,t,u,v,q,r)})(hV,eV,fV):hV.projectionMatrix.copy(eV.projectionMatrix)},this.getCamera=function(){return hV},this.getFoveation=function(){if(!(null===WU&&null===XU))return SU},this.setFoveation=function(a){SU=a,null!==WU&&(WU.fixedFoveation=a),null!==XU&& void 0!==XU.fixedFoveation&&(XU.fixedFoveation=a)},this.getPlanes=function(){return cV};let qV=null,rV=new VM;rV.setAnimationLoop(function(a,b){if(UU=b.getViewerPose(TU||QU),YU=b,null!==UU){let c=UU.views;null!==XU&&(LU.setRenderTargetFramebuffer(_U,XU.framebuffer),LU.setRenderTarget(_U));let d=!1;c.length!==hV.cameras.length&&(hV.cameras.length=0,d=!0);for(let e=0;e<c.length;e++){let f=c[e],g=null;if(null!==XU)g=XU.getViewport(f);else{let h=VU.getViewSubImage(WU,f);g=h.viewport,0===e&&(LU.setRenderTargetTextures(_U,h.colorTexture,WU.ignoreDepthValues?void 0:h.depthStencilTexture),LU.setRenderTarget(_U))}let i=gV[e];void 0===i&&((i=new GJ).layers.enable(e),i.viewport=new sh,gV[e]=i),i.matrix.fromArray(f.transform.matrix),i.projectionMatrix.fromArray(f.projectionMatrix),i.viewport.set(g.x,g.y,g.width,g.height),0===e&&hV.matrix.copy(i.matrix),!0===d&&hV.cameras.push(i)}}for(let j=0;j<aV.length;j++){let k=bV[j],l=aV[j];null!==k&& void 0!==l&&l.update(k,b,TU||QU)}if(qV&&qV(a,b),b.detectedPlanes){NU.dispatchEvent({type:"planesdetected",data:b.detectedPlanes});let m=null;for(let n of cV)b.detectedPlanes.has(n)||(null===m&&(m=[]),m.push(n));if(null!==m)for(let o of m)cV.delete(o),dV.delete(o),NU.dispatchEvent({type:"planeremoved",data:o});for(let p of b.detectedPlanes)if(cV.has(p)){let q=dV.get(p);p.lastChangedTime>q&&(dV.set(p,p.lastChangedTime),NU.dispatchEvent({type:"planechanged",data:p}))}else cV.add(p),dV.set(p,b.lastChangedTime),NU.dispatchEvent({type:"planeadded",data:p})}YU=null}),this.setAnimationLoop=function(a){qV=a},this.dispose=function(){}}};function sV(a,b){function c(c,d){c.opacity.value=d.opacity,d.color&&c.diffuse.value.copy(d.color),d.emissive&&c.emissive.value.copy(d.emissive).multiplyScalar(d.emissiveIntensity),d.map&&(c.map.value=d.map),d.alphaMap&&(c.alphaMap.value=d.alphaMap),d.bumpMap&&(c.bumpMap.value=d.bumpMap,c.bumpScale.value=d.bumpScale,d.side===Q&&(c.bumpScale.value*=-1)),d.displacementMap&&(c.displacementMap.value=d.displacementMap,c.displacementScale.value=d.displacementScale,c.displacementBias.value=d.displacementBias),d.emissiveMap&&(c.emissiveMap.value=d.emissiveMap),d.normalMap&&(c.normalMap.value=d.normalMap,c.normalScale.value.copy(d.normalScale),d.side===Q&&c.normalScale.value.negate()),d.specularMap&&(c.specularMap.value=d.specularMap),d.alphaTest>0&&(c.alphaTest.value=d.alphaTest);let e=b.get(d).envMap;if(e&&(c.envMap.value=e,c.flipEnvMap.value=e.isCubeTexture&& !1===e.isRenderTargetTexture?-1:1,c.reflectivity.value=d.reflectivity,c.ior.value=d.ior,c.refractionRatio.value=d.refractionRatio),d.lightMap){c.lightMap.value=d.lightMap;let f=!0!==a.physicallyCorrectLights?Math.PI:1;c.lightMapIntensity.value=d.lightMapIntensity*f}d.aoMap&&(c.aoMap.value=d.aoMap,c.aoMapIntensity.value=d.aoMapIntensity);let g;d.map?g=d.map:d.specularMap?g=d.specularMap:d.displacementMap?g=d.displacementMap:d.normalMap?g=d.normalMap:d.bumpMap?g=d.bumpMap:d.roughnessMap?g=d.roughnessMap:d.metalnessMap?g=d.metalnessMap:d.alphaMap?g=d.alphaMap:d.emissiveMap?g=d.emissiveMap:d.clearcoatMap?g=d.clearcoatMap:d.clearcoatNormalMap?g=d.clearcoatNormalMap:d.clearcoatRoughnessMap?g=d.clearcoatRoughnessMap:d.iridescenceMap?g=d.iridescenceMap:d.iridescenceThicknessMap?g=d.iridescenceThicknessMap:d.specularIntensityMap?g=d.specularIntensityMap:d.specularColorMap?g=d.specularColorMap:d.transmissionMap?g=d.transmissionMap:d.thicknessMap?g=d.thicknessMap:d.sheenColorMap?g=d.sheenColorMap:d.sheenRoughnessMap&&(g=d.sheenRoughnessMap),void 0!==g&&(g.isWebGLRenderTarget&&(g=g.texture),!0===g.matrixAutoUpdate&&g.updateMatrix(),c.uvTransform.value.copy(g.matrix));let h;d.aoMap?h=d.aoMap:d.lightMap&&(h=d.lightMap),void 0!==h&&(h.isWebGLRenderTarget&&(h=h.texture),!0===h.matrixAutoUpdate&&h.updateMatrix(),c.uv2Transform.value.copy(h.matrix))}return{refreshFogUniforms:function(b,c){c.color.getRGB(b.fogColor.value,nJ(a)),c.isFog?(b.fogNear.value=c.near,b.fogFar.value=c.far):c.isFogExp2&&(b.fogDensity.value=c.density)},refreshMaterialUniforms:function(a,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;let E,F;d.isMeshBasicMaterial||d.isMeshLambertMaterial?c(a,d):d.isMeshToonMaterial?(c(a,d),h=a,(i=d).gradientMap&&(h.gradientMap.value=i.gradientMap)):d.isMeshPhongMaterial?(c(a,d),j=a,k=d,j.specular.value.copy(k.specular),j.shininess.value=Math.max(k.shininess,1e-4)):d.isMeshStandardMaterial?(c(a,d),l=a,m=d,l.roughness.value=m.roughness,l.metalness.value=m.metalness,m.roughnessMap&&(l.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(l.metalnessMap.value=m.metalnessMap),b.get(m).envMap&&(l.envMapIntensity.value=m.envMapIntensity),d.isMeshPhysicalMaterial&&(n=a,o=d,p=g,n.ior.value=o.ior,o.sheen>0&&(n.sheenColor.value.copy(o.sheenColor).multiplyScalar(o.sheen),n.sheenRoughness.value=o.sheenRoughness,o.sheenColorMap&&(n.sheenColorMap.value=o.sheenColorMap),o.sheenRoughnessMap&&(n.sheenRoughnessMap.value=o.sheenRoughnessMap)),o.clearcoat>0&&(n.clearcoat.value=o.clearcoat,n.clearcoatRoughness.value=o.clearcoatRoughness,o.clearcoatMap&&(n.clearcoatMap.value=o.clearcoatMap),o.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap.value=o.clearcoatRoughnessMap),o.clearcoatNormalMap&&(n.clearcoatNormalScale.value.copy(o.clearcoatNormalScale),n.clearcoatNormalMap.value=o.clearcoatNormalMap,o.side===Q&&n.clearcoatNormalScale.value.negate())),o.iridescence>0&&(n.iridescence.value=o.iridescence,n.iridescenceIOR.value=o.iridescenceIOR,n.iridescenceThicknessMinimum.value=o.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum.value=o.iridescenceThicknessRange[1],o.iridescenceMap&&(n.iridescenceMap.value=o.iridescenceMap),o.iridescenceThicknessMap&&(n.iridescenceThicknessMap.value=o.iridescenceThicknessMap)),o.transmission>0&&(n.transmission.value=o.transmission,n.transmissionSamplerMap.value=p.texture,n.transmissionSamplerSize.value.set(p.width,p.height),o.transmissionMap&&(n.transmissionMap.value=o.transmissionMap),n.thickness.value=o.thickness,o.thicknessMap&&(n.thicknessMap.value=o.thicknessMap),n.attenuationDistance.value=o.attenuationDistance,n.attenuationColor.value.copy(o.attenuationColor)),n.specularIntensity.value=o.specularIntensity,n.specularColor.value.copy(o.specularColor),o.specularIntensityMap&&(n.specularIntensityMap.value=o.specularIntensityMap),o.specularColorMap&&(n.specularColorMap.value=o.specularColorMap))):d.isMeshMatcapMaterial?(c(a,d),q=a,(r=d).matcap&&(q.matcap.value=r.matcap)):d.isMeshDepthMaterial?c(a,d):d.isMeshDistanceMaterial?(c(a,d),s=a,t=d,s.referencePosition.value.copy(t.referencePosition),s.nearDistance.value=t.nearDistance,s.farDistance.value=t.farDistance):d.isMeshNormalMaterial?c(a,d):d.isLineBasicMaterial?(u=a,v=d,u.diffuse.value.copy(v.color),u.opacity.value=v.opacity,d.isLineDashedMaterial&&(w=a,x=d,w.dashSize.value=x.dashSize,w.totalSize.value=x.dashSize+x.gapSize,w.scale.value=x.scale)):d.isPointsMaterial?(y=a,z=d,A=e,B=f,y.diffuse.value.copy(z.color),y.opacity.value=z.opacity,y.size.value=z.size*A,y.scale.value=.5*B,z.map&&(y.map.value=z.map),z.alphaMap&&(y.alphaMap.value=z.alphaMap),z.alphaTest>0&&(y.alphaTest.value=z.alphaTest),z.map?E=z.map:z.alphaMap&&(E=z.alphaMap),void 0!==E&&(!0===E.matrixAutoUpdate&&E.updateMatrix(),y.uvTransform.value.copy(E.matrix))):d.isSpriteMaterial?(C=a,D=d,C.diffuse.value.copy(D.color),C.opacity.value=D.opacity,C.rotation.value=D.rotation,D.map&&(C.map.value=D.map),D.alphaMap&&(C.alphaMap.value=D.alphaMap),D.alphaTest>0&&(C.alphaTest.value=D.alphaTest),D.map?F=D.map:D.alphaMap&&(F=D.alphaMap),void 0!==F&&(!0===F.matrixAutoUpdate&&F.updateMatrix(),C.uvTransform.value.copy(F.matrix))):d.isShadowMaterial?(a.color.value.copy(d.color),a.opacity.value=d.opacity):d.isShaderMaterial&&(d.uniformsNeedUpdate=!1)}}}function tV(a,b,c,d){let e={},f={},g=[],h=c.isWebGL2?a.getParameter(35375):0;function i(a,b,c){let d=a.value;if(void 0===c[b]){if("number"==typeof d)c[b]=d;else{let e=Array.isArray(d)?d:[d],f=[];for(let g=0;g<e.length;g++)f.push(e[g].clone());c[b]=f}return!0}if("number"==typeof d){if(c[b]!==d)return c[b]=d,!0}else{let h=Array.isArray(c[b])?c[b]:[c[b]],i=Array.isArray(d)?d:[d];for(let j=0;j<h.length;j++){let k=h[j];if(!1===k.equals(i[j]))return k.copy(i[j]),!0}}return!1}function j(a){let b={boundary:0,storage:0};return"number"==typeof a?(b.boundary=4,b.storage=4):a.isVector2?(b.boundary=8,b.storage=8):a.isVector3||a.isColor?(b.boundary=16,b.storage=12):a.isVector4?(b.boundary=16,b.storage=16):a.isMatrix3?(b.boundary=48,b.storage=48):a.isMatrix4?(b.boundary=64,b.storage=64):a.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",a),b}function k(b){let c=b.target;c.removeEventListener("dispose",k);let d=g.indexOf(c.__bindingPointIndex);g.splice(d,1),a.deleteBuffer(e[c.id]),delete e[c.id],delete f[c.id]}return{bind:function(a,b){let c=b.program;d.uniformBlockBinding(a,c)},update:function(c,l){var m;let n=e[c.id],o,p,q,r;void 0===n&&((function(a){let b=a.uniforms,c=0,d=16,e=0;for(let f=0,g=b.length;f<g;f++){let h=b[f],i={boundary:0,storage:0},k=Array.isArray(h.value)?h.value:[h.value];for(let l=0,m=k.length;l<m;l++){let n=j(k[l]);i.boundary+=n.boundary,i.storage+=n.storage}if(h.__data=new Float32Array(i.storage/Float32Array.BYTES_PER_ELEMENT),h.__offset=c,f>0){e=c%d;let o=d-e;0!==e&&o-i.boundary<0&&(c+=d-e,h.__offset=c)}c+=i.storage}(e=c%d)>0&&(c+=d-e),a.__size=c,a.__cache={}})(c),m=c,o=(function(){for(let a=0;a<h;a++)if(-1===g.indexOf(a))return g.push(a),a;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0})(),m.__bindingPointIndex=o,p=a.createBuffer(),q=m.__size,r=m.usage,a.bindBuffer(35345,p),a.bufferData(35345,q,r),a.bindBuffer(35345,null),a.bindBufferBase(35345,o,p),n=p,e[c.id]=n,c.addEventListener("dispose",k));let s=l.program;d.updateUBOMapping(c,s);let t=b.render.frame;f[c.id]!==t&&((function(b){let c=e[b.id],d=b.uniforms,f=b.__cache;a.bindBuffer(35345,c);for(let g=0,h=d.length;g<h;g++){let k=d[g];if(!0===i(k,g,f)){let l=k.__offset,m=Array.isArray(k.value)?k.value:[k.value],n=0;for(let o=0;o<m.length;o++){let p=m[o],q=j(p);"number"==typeof p?(k.__data[0]=p,a.bufferSubData(35345,l+n,k.__data)):p.isMatrix3?(k.__data[0]=p.elements[0],k.__data[1]=p.elements[1],k.__data[2]=p.elements[2],k.__data[3]=p.elements[0],k.__data[4]=p.elements[3],k.__data[5]=p.elements[4],k.__data[6]=p.elements[5],k.__data[7]=p.elements[0],k.__data[8]=p.elements[6],k.__data[9]=p.elements[7],k.__data[10]=p.elements[8],k.__data[11]=p.elements[0]):(p.toArray(k.__data,n),n+=q.storage/Float32Array.BYTES_PER_ELEMENT)}a.bufferSubData(35345,l,k.__data)}}a.bindBuffer(35345,null)})(c),f[c.id]=t)},dispose:function(){for(let b in e)a.deleteBuffer(e[b]);g=[],e={},f={}}}}function uV(a={}){this.isWebGLRenderer=!0;let b,c=void 0!==a.canvas?a.canvas:((b=Ue("canvas")).style.display="block",b),d=void 0!==a.context?a.context:null,e=void 0===a.depth||a.depth,f=void 0===a.stencil||a.stencil,g=void 0!==a.antialias&&a.antialias,h=void 0===a.premultipliedAlpha||a.premultipliedAlpha,i=void 0!==a.preserveDrawingBuffer&&a.preserveDrawingBuffer,j=void 0!==a.powerPreference?a.powerPreference:"default",k=void 0!==a.failIfMajorPerformanceCaveat&&a.failIfMajorPerformanceCaveat,l;l=null!==d?d.getContextAttributes().alpha:void 0!==a.alpha&&a.alpha;let m=null,n=null,o=[],p=[];this.domElement=c,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Sa,this.physicallyCorrectLights=!1,this.toneMapping=ia,this.toneMappingExposure=1;let q=this,r=!1,s=0,t=0,u=null,v=-1,w=null,x=new sh,y=new sh,z=null,A=c.width,B=c.height,C=1,D=null,E=null,F=new sh(0,0,A,B),G=new sh(0,0,A,B),H=!1,I=new YL,J=!1,K=!1,M=null,N=new rs,O=new Eb,S=new fm,T={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function U(){return null===u?C:1}let V=d;function W(a,b){for(let d=0;d<a.length;d++){let e=a[d],f=c.getContext(e,b);if(null!==f)return f}return null}try{let X={alpha:!0,depth:e,stencil:f,antialias:g,premultipliedAlpha:h,preserveDrawingBuffer:i,powerPreference:j,failIfMajorPerformanceCaveat:k};if("setAttribute"in c&&c.setAttribute("data-engine",`three.js r${L}`),c.addEventListener("webglcontextlost",Ea,!1),c.addEventListener("webglcontextrestored",Fa,!1),c.addEventListener("webglcontextcreationerror",Ga,!1),null===V){let Y=["webgl2","webgl","experimental-webgl"];if(!0===q.isWebGL1Renderer&&Y.shift(),V=W(Y,X),null===V)throw new Error(W(Y)?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.")}void 0===V.getShaderPrecisionFormat&&(V.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Z){throw console.error("THREE.WebGLRenderer: "+Z.message),Z}let $,_,aa,ba,ca,da,ea,fa,ga,ha,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa;function za(){$=new RQ(V),_=new tO(V,$,a),$.init(_),ua=new WT(V,$,_),aa=new UT(V,$,_),ba=new UQ,ca=new AT,da=new VT(V,$,aa,ca,_,ua,ba),ea=new vO(q),fa=new QQ(q),ga=new WM(V,_),va=new rO(V,$,ga,_),ha=new SQ(V,ga,ba,va),ja=new YQ(V,ha,ga,ba),ra=new XQ(V,_,da),oa=new uO(ca),ka=new zT(q,ea,fa,$,_,va,oa),la=new sV(q,ca),ma=new ET,na=new KT($,_),qa=new qO(q,ea,fa,aa,ja,l,h),pa=new TT(q,ja,_),wa=new tV(V,ba,_,aa),sa=new sO(V,$,ba,_),ta=new TQ(V,$,ba,_),ba.programs=ka.programs,q.capabilities=_,q.extensions=$,q.properties=ca,q.renderLists=ma,q.shadowMap=pa,q.state=aa,q.info=ba}za();let Ca=new KU(q,V);function Ea(a){a.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),r=!0}function Fa(){console.log("THREE.WebGLRenderer: Context Restored."),r=!1;let a=ba.autoReset,b=pa.enabled,c=pa.autoUpdate,d=pa.needsUpdate,e=pa.type;za(),ba.autoReset=a,pa.enabled=b,pa.autoUpdate=c,pa.needsUpdate=d,pa.type=e}function Ga(a){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",a.statusMessage)}function Ha(a){let b=a.target;b.removeEventListener("dispose",Ha),Ia(b)}function Ia(a){Ja(a),ca.remove(a)}function Ja(a){let b=ca.get(a).programs;void 0!==b&&(b.forEach(function(a){ka.releaseProgram(a)}),a.isShaderMaterial&&ka.releaseShaderCache(a))}this.xr=Ca,this.getContext=function(){return V},this.getContextAttributes=function(){return V.getContextAttributes()},this.forceContextLoss=function(){let a=$.get("WEBGL_lose_context");a&&a.loseContext()},this.forceContextRestore=function(){let a=$.get("WEBGL_lose_context");a&&a.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(a){void 0!==a&&(C=a,this.setSize(A,B,!1))},this.getSize=function(a){return a.set(A,B)},this.setSize=function(a,b,d){if(Ca.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}A=a,B=b,c.width=Math.floor(a*C),c.height=Math.floor(b*C),!1!==d&&(c.style.width=a+"px",c.style.height=b+"px"),this.setViewport(0,0,a,b)},this.getDrawingBufferSize=function(a){return a.set(A*C,B*C).floor()},this.setDrawingBufferSize=function(a,b,d){A=a,B=b,C=d,c.width=Math.floor(a*d),c.height=Math.floor(b*d),this.setViewport(0,0,a,b)},this.getCurrentViewport=function(a){return a.copy(x)},this.getViewport=function(a){return a.copy(F)},this.setViewport=function(a,b,c,d){a.isVector4?F.set(a.x,a.y,a.z,a.w):F.set(a,b,c,d),aa.viewport(x.copy(F).multiplyScalar(C).floor())},this.getScissor=function(a){return a.copy(G)},this.setScissor=function(a,b,c,d){a.isVector4?G.set(a.x,a.y,a.z,a.w):G.set(a,b,c,d),aa.scissor(y.copy(G).multiplyScalar(C).floor())},this.getScissorTest=function(){return H},this.setScissorTest=function(a){aa.setScissorTest(H=a)},this.setOpaqueSort=function(a){D=a},this.setTransparentSort=function(a){E=a},this.getClearColor=function(a){return a.copy(qa.getClearColor())},this.setClearColor=function(){qa.setClearColor.apply(qa,arguments)},this.getClearAlpha=function(){return qa.getClearAlpha()},this.setClearAlpha=function(){qa.setClearAlpha.apply(qa,arguments)},this.clear=function(a=!0,b=!0,c=!0){let d=0;a&&(d|=16384),b&&(d|=256),c&&(d|=1024),V.clear(d)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){c.removeEventListener("webglcontextlost",Ea,!1),c.removeEventListener("webglcontextrestored",Fa,!1),c.removeEventListener("webglcontextcreationerror",Ga,!1),ma.dispose(),na.dispose(),ca.dispose(),ea.dispose(),fa.dispose(),ja.dispose(),va.dispose(),wa.dispose(),ka.dispose(),Ca.dispose(),Ca.removeEventListener("sessionstart",La),Ca.removeEventListener("sessionend",Ma),M&&(M.dispose(),M=null),Na.stop()},this.renderBufferDirect=function(a,b,c,d,e,f){null===b&&(b=T);let g=e.isMesh&&0>e.matrixWorld.determinant(),h=Wa(a,b,c,d,e);aa.setMaterial(d,g);let i=c.index,j=1;!0===d.wireframe&&(i=ha.getWireframeAttribute(c),j=2);let k=c.drawRange,l=c.attributes.position,m=k.start*j,n=(k.start+k.count)*j;null!==f&&(m=Math.max(m,f.start*j),n=Math.min(n,(f.start+f.count)*j)),null!==i?(m=Math.max(m,0),n=Math.min(n,i.count)):null!=l&&(m=Math.max(m,0),n=Math.min(n,l.count));let o=n-m;if(o<0||o===1/0)return;va.setup(e,d,h,c,i);let p,q=sa;if(null!==i&&(p=ga.get(i),(q=ta).setIndex(p)),e.isMesh)!0===d.wireframe?(aa.setLineWidth(d.wireframeLinewidth*U()),q.setMode(1)):q.setMode(4);else if(e.isLine){let r=d.linewidth;void 0===r&&(r=1),aa.setLineWidth(r*U()),e.isLineSegments?q.setMode(1):e.isLineLoop?q.setMode(2):q.setMode(3)}else e.isPoints?q.setMode(0):e.isSprite&&q.setMode(4);if(e.isInstancedMesh)q.renderInstances(m,o,e.count);else if(c.isInstancedBufferGeometry){let s=void 0!==c._maxInstanceCount?c._maxInstanceCount:1/0,t=Math.min(c.instanceCount,s);q.renderInstances(m,o,t)}else q.render(m,o)},this.compile=function(a,b){function c(a,b,c){!0===a.transparent&&a.side===R&& !1===a.forceSinglePass?(a.side=Q,a.needsUpdate=!0,Ua(a,b,c),a.side=P,a.needsUpdate=!0,Ua(a,b,c),a.side=R):Ua(a,b,c)}(n=na.get(a)).init(),p.push(n),a.traverseVisible(function(a){a.isLight&&a.layers.test(b.layers)&&(n.pushLight(a),a.castShadow&&n.pushShadow(a))}),n.setupLights(q.physicallyCorrectLights),a.traverse(function(b){let d=b.material;if(d)if(Array.isArray(d))for(let e=0;e<d.length;e++)c(d[e],a,b);else c(d,a,b)}),p.pop(),n=null};let Ka=null;function La(){Na.stop()}function Ma(){Na.start()}let Na=new VM;function Oa(a,b,c,d){if(!1===a.visible)return;if(a.layers.test(b.layers)){if(a.isGroup)c=a.renderOrder;else if(a.isLOD)!0===a.autoUpdate&&a.update(b);else if(a.isLight)n.pushLight(a),a.castShadow&&n.pushShadow(a);else if(a.isSprite){if(!a.frustumCulled||I.intersectsSprite(a)){d&&S.setFromMatrixPosition(a.matrixWorld).applyMatrix4(N);let e=ja.update(a),f=a.material;f.visible&&m.push(a,e,f,c,S.z,null)}}else if((a.isMesh||a.isLine||a.isPoints)&&(a.isSkinnedMesh&&a.skeleton.frame!==ba.render.frame&&(a.skeleton.update(),a.skeleton.frame=ba.render.frame),!a.frustumCulled||I.intersectsObject(a))){d&&S.setFromMatrixPosition(a.matrixWorld).applyMatrix4(N);let g=ja.update(a),h=a.material;if(Array.isArray(h)){let i=g.groups;for(let j=0,k=i.length;j<k;j++){let l=i[j],o=h[l.materialIndex];o&&o.visible&&m.push(a,g,o,c,S.z,l)}}else h.visible&&m.push(a,g,h,c,S.z,null)}}let p=a.children;for(let q=0,r=p.length;q<r;q++)Oa(p[q],b,c,d)}function Pa(a,b,c,d){let e=a.opaque,f=a.transmissive,g=a.transparent;n.setupLightsView(c),!0===J&&oa.setGlobalState(q.clippingPlanes,c),f.length>0&&Qa(e,b,c),d&&aa.viewport(x.copy(d)),e.length>0&&Ra(e,b,c),f.length>0&&Ra(f,b,c),g.length>0&&Ra(g,b,c),aa.buffers.depth.setTest(!0),aa.buffers.depth.setMask(!0),aa.buffers.color.setMask(!0),aa.setPolygonOffset(!1)}function Qa(a,b,c){let d=_.isWebGL2;null===M&&(M=new Yi(1,1,{generateMipmaps:!0,type:$.has("EXT_color_buffer_half_float")?Ba:ya,minFilter:xa,samples:d&& !0===g?4:0})),q.getDrawingBufferSize(O),d?M.setSize(O.x,O.y):M.setSize(Ab(O.x),Ab(O.y));let e=q.getRenderTarget();q.setRenderTarget(M),q.clear();let f=q.toneMapping;q.toneMapping=ia,Ra(a,b,c),q.toneMapping=f,da.updateMultisampleRenderTarget(M),da.updateRenderTargetMipmap(M),q.setRenderTarget(e)}function Ra(a,b,c){let d=!0===b.isScene?b.overrideMaterial:null;for(let e=0,f=a.length;e<f;e++){let g=a[e],h=g.object,i=g.geometry,j=null===d?g.material:d,k=g.group;h.layers.test(c.layers)&&Ta(h,b,c,i,j,k)}}function Ta(a,b,c,d,e,f){a.onBeforeRender(q,b,c,d,e,f),a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld),a.normalMatrix.getNormalMatrix(a.modelViewMatrix),e.onBeforeRender(q,b,c,d,a,f),!0===e.transparent&&e.side===R&& !1===e.forceSinglePass?(e.side=Q,e.needsUpdate=!0,q.renderBufferDirect(c,b,d,e,a,f),e.side=P,e.needsUpdate=!0,q.renderBufferDirect(c,b,d,e,a,f),e.side=R):q.renderBufferDirect(c,b,d,e,a,f),a.onAfterRender(q,b,c,d,e,f)}function Ua(a,b,c){!0!==b.isScene&&(b=T);let d=ca.get(a),e=n.state.lights,f=n.state.shadowsArray,g=e.state.version,h=ka.getParameters(a,e.state,f,b,c),i=ka.getProgramCacheKey(h),j=d.programs;d.environment=a.isMeshStandardMaterial?b.environment:null,d.fog=b.fog,d.envMap=(a.isMeshStandardMaterial?fa:ea).get(a.envMap||d.environment),void 0===j&&(a.addEventListener("dispose",Ha),j=new Map,d.programs=j);let k=j.get(i);if(void 0!==k){if(d.currentProgram===k&&d.lightsStateVersion===g)return Va(a,h),k}else h.uniforms=ka.getUniforms(a),a.onBuild(c,h,q),a.onBeforeCompile(h,q),k=ka.acquireProgram(h,i),j.set(i,k),d.uniforms=h.uniforms;let l=d.uniforms;(a.isShaderMaterial||a.isRawShaderMaterial)&& !0!==a.clipping||(l.clippingPlanes=oa.uniform),Va(a,h),d.needsLights=Ya(a),d.lightsStateVersion=g,d.needsLights&&(l.ambientLightColor.value=e.state.ambient,l.lightProbe.value=e.state.probe,l.directionalLights.value=e.state.directional,l.directionalLightShadows.value=e.state.directionalShadow,l.spotLights.value=e.state.spot,l.spotLightShadows.value=e.state.spotShadow,l.rectAreaLights.value=e.state.rectArea,l.ltc_1.value=e.state.rectAreaLTC1,l.ltc_2.value=e.state.rectAreaLTC2,l.pointLights.value=e.state.point,l.pointLightShadows.value=e.state.pointShadow,l.hemisphereLights.value=e.state.hemi,l.directionalShadowMap.value=e.state.directionalShadowMap,l.directionalShadowMatrix.value=e.state.directionalShadowMatrix,l.spotShadowMap.value=e.state.spotShadowMap,l.spotLightMatrix.value=e.state.spotLightMatrix,l.spotLightMap.value=e.state.spotLightMap,l.pointShadowMap.value=e.state.pointShadowMap,l.pointShadowMatrix.value=e.state.pointShadowMatrix);let m=k.getUniforms(),o=oS.seqWithValue(m.seq,l);return d.currentProgram=k,d.uniformsList=o,k}function Va(a,b){let c=ca.get(a);c.outputEncoding=b.outputEncoding,c.instancing=b.instancing,c.skinning=b.skinning,c.morphTargets=b.morphTargets,c.morphNormals=b.morphNormals,c.morphColors=b.morphColors,c.morphTargetsCount=b.morphTargetsCount,c.numClippingPlanes=b.numClippingPlanes,c.numIntersection=b.numClipIntersection,c.vertexAlphas=b.vertexAlphas,c.vertexTangents=b.vertexTangents,c.toneMapping=b.toneMapping}function Wa(a,b,c,d,e){!0!==b.isScene&&(b=T),da.resetTextureUnits();let f=b.fog,g=d.isMeshStandardMaterial?b.environment:null,h=null===u?q.outputEncoding:!0===u.isXRRenderTarget?u.texture.encoding:Sa,i=(d.isMeshStandardMaterial?fa:ea).get(d.envMap||g),j=!0===d.vertexColors&&!!c.attributes.color&&4===c.attributes.color.itemSize,k=!!d.normalMap&&!!c.attributes.tangent,l=!!c.morphAttributes.position,m=!!c.morphAttributes.normal,o=!!c.morphAttributes.color,p=d.toneMapped?q.toneMapping:ia,r=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,s=void 0!==r?r.length:0,t=ca.get(d),x=n.state.lights;if(!0===J&&(!0===K||a!==w)){let y=a===w&&d.id===v;oa.setState(d,a,y)}let z=!1;d.version===t.__version?(t.needsLights&&t.lightsStateVersion!==x.state.version||t.outputEncoding!==h||e.isInstancedMesh&& !1===t.instancing|| !e.isInstancedMesh&& !0===t.instancing||e.isSkinnedMesh&& !1===t.skinning|| !e.isSkinnedMesh&& !0===t.skinning||t.envMap!==i|| !0===d.fog&&t.fog!==f|| void 0!==t.numClippingPlanes&&(t.numClippingPlanes!==oa.numPlanes||t.numIntersection!==oa.numIntersection)||t.vertexAlphas!==j||t.vertexTangents!==k||t.morphTargets!==l||t.morphNormals!==m||t.morphColors!==o||t.toneMapping!==p|| !0===_.isWebGL2&&t.morphTargetsCount!==s)&&(z=!0):(z=!0,t.__version=d.version);let A=t.currentProgram;!0===z&&(A=Ua(d,b,e));let D=!1,E=!1,F=!1,G=A.getUniforms(),H=t.uniforms;if(aa.useProgram(A.program)&&(D=!0,E=!0,F=!0),d.id!==v&&(v=d.id,E=!0),D||w!==a){if(G.setValue(V,"projectionMatrix",a.projectionMatrix),_.logarithmicDepthBuffer&&G.setValue(V,"logDepthBufFC",2/(Math.log(a.far+1)/Math.LN2)),w!==a&&(w=a,E=!0,F=!0),d.isShaderMaterial||d.isMeshPhongMaterial||d.isMeshToonMaterial||d.isMeshStandardMaterial||d.envMap){let I=G.map.cameraPosition;void 0!==I&&I.setValue(V,S.setFromMatrixPosition(a.matrixWorld))}(d.isMeshPhongMaterial||d.isMeshToonMaterial||d.isMeshLambertMaterial||d.isMeshBasicMaterial||d.isMeshStandardMaterial||d.isShaderMaterial)&&G.setValue(V,"isOrthographic",!0===a.isOrthographicCamera),(d.isMeshPhongMaterial||d.isMeshToonMaterial||d.isMeshLambertMaterial||d.isMeshBasicMaterial||d.isMeshStandardMaterial||d.isShaderMaterial||d.isShadowMaterial||e.isSkinnedMesh)&&G.setValue(V,"viewMatrix",a.matrixWorldInverse)}if(e.isSkinnedMesh){G.setOptional(V,e,"bindMatrix"),G.setOptional(V,e,"bindMatrixInverse");let L=e.skeleton;L&&(_.floatVertexTextures?(null===L.boneTexture&&L.computeBoneTexture(),G.setValue(V,"boneTexture",L.boneTexture,da),G.setValue(V,"boneTextureSize",L.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let N=c.morphAttributes;if((void 0!==N.position|| void 0!==N.normal|| void 0!==N.color&& !0===_.isWebGL2)&&ra.update(e,c,d,A),(E||t.receiveShadow!==e.receiveShadow)&&(t.receiveShadow=e.receiveShadow,G.setValue(V,"receiveShadow",e.receiveShadow)),d.isMeshGouraudMaterial&&null!==d.envMap&&(H.envMap.value=i,H.flipEnvMap.value=i.isCubeTexture&& !1===i.isRenderTargetTexture?-1:1),E&&(G.setValue(V,"toneMappingExposure",q.toneMappingExposure),t.needsLights&&Xa(H,F),f&& !0===d.fog&&la.refreshFogUniforms(H,f),la.refreshMaterialUniforms(H,d,C,B,M),oS.upload(V,t.uniformsList,H,da)),d.isShaderMaterial&& !0===d.uniformsNeedUpdate&&(oS.upload(V,t.uniformsList,H,da),d.uniformsNeedUpdate=!1),d.isSpriteMaterial&&G.setValue(V,"center",e.center),G.setValue(V,"modelViewMatrix",e.modelViewMatrix),G.setValue(V,"normalMatrix",e.normalMatrix),G.setValue(V,"modelMatrix",e.matrixWorld),e.previousModelViewMatrix&&G.setValue(V,"previousModelViewMatrix",e.previousModelViewMatrix),a.previousProjectionMatrix&&G.setValue(V,"previousProjectionMatrix",a.previousProjectionMatrix),d.isShaderMaterial||d.isRawShaderMaterial){let O=d.uniformsGroups;for(let P=0,Q=O.length;P<Q;P++)if(_.isWebGL2){let R=O[P];wa.update(R,A),wa.bind(R,A)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return A}function Xa(a,b){a.ambientLightColor.needsUpdate=b,a.lightProbe.needsUpdate=b,a.directionalLights.needsUpdate=b,a.directionalLightShadows.needsUpdate=b,a.pointLights.needsUpdate=b,a.pointLightShadows.needsUpdate=b,a.spotLights.needsUpdate=b,a.spotLightShadows.needsUpdate=b,a.rectAreaLights.needsUpdate=b,a.hemisphereLights.needsUpdate=b}function Ya(a){return a.isMeshLambertMaterial||a.isMeshToonMaterial||a.isMeshPhongMaterial||a.isMeshStandardMaterial||a.isShadowMaterial||a.isShaderMaterial&& !0===a.lights}Na.setAnimationLoop(function(a){Ka&&Ka(a)}),"u">typeof self&&Na.setContext(self),this.setAnimationLoop=function(a){Ka=a,Ca.setAnimationLoop(a),null===a?Na.stop():Na.start()},Ca.addEventListener("sessionstart",La),Ca.addEventListener("sessionend",Ma),this.render=function(a,b){if(void 0!==b&& !0!==b.isCamera){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!0===r)return;!0===a.matrixWorldAutoUpdate&&a.updateMatrixWorld(),null===b.parent&& !0===b.matrixWorldAutoUpdate&&b.updateMatrixWorld(),!0===Ca.enabled&& !0===Ca.isPresenting&&(!0===Ca.cameraAutoUpdate&&Ca.updateCamera(b),b=Ca.getCamera()),!0===a.isScene&&a.onBeforeRender(q,a,b,u),(n=na.get(a,p.length)).init(),p.push(n),N.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),I.setFromProjectionMatrix(N),K=this.localClippingEnabled,J=oa.init(this.clippingPlanes,K),(m=ma.get(a,o.length)).init(),o.push(m),Oa(a,b,0,q.sortObjects),m.finish(),!0===q.sortObjects&&m.sort(D,E),!0===J&&oa.beginShadows();let c=n.state.shadowsArray;if(pa.render(c,a,b),!0===J&&oa.endShadows(),!0===this.info.autoReset&&this.info.reset(),qa.render(m,a),n.setupLights(q.physicallyCorrectLights),b.isArrayCamera){let d=b.cameras;for(let e=0,f=d.length;e<f;e++){let g=d[e];Pa(m,a,g,g.viewport)}}else Pa(m,a,b);null!==u&&(da.updateMultisampleRenderTarget(u),da.updateRenderTargetMipmap(u)),!0===a.isScene&&a.onAfterRender(q,a,b),va.resetDefaultState(),v=-1,w=null,p.pop(),n=p.length>0?p[p.length-1]:null,o.pop(),m=o.length>0?o[o.length-1]:null},this.getActiveCubeFace=function(){return s},this.getActiveMipmapLevel=function(){return t},this.getRenderTarget=function(){return u},this.setRenderTargetTextures=function(a,b,c){ca.get(a.texture).__webglTexture=b,ca.get(a.depthTexture).__webglTexture=c;let d=ca.get(a);d.__hasExternalTextures=!0,d.__hasExternalTextures&&(d.__autoAllocateDepthBuffer=void 0===c,d.__autoAllocateDepthBuffer|| !0===$.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),d.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(a,b){let c=ca.get(a);c.__webglFramebuffer=b,c.__useDefaultFramebuffer=void 0===b},this.setRenderTarget=function(a,b=0,c=0){u=a,s=b,t=c;let d=!0,e=null,f=!1,g=!1;if(a){let h=ca.get(a);void 0!==h.__useDefaultFramebuffer?(aa.bindFramebuffer(36160,null),d=!1):void 0===h.__webglFramebuffer?da.setupRenderTarget(a):h.__hasExternalTextures&&da.rebindTextures(a,ca.get(a.texture).__webglTexture,ca.get(a.depthTexture).__webglTexture);let i=a.texture;(i.isData3DTexture||i.isDataArrayTexture||i.isCompressedArrayTexture)&&(g=!0);let j=ca.get(a).__webglFramebuffer;a.isWebGLCubeRenderTarget?(e=j[b],f=!0):e=_.isWebGL2&&a.samples>0&& !1===da.useMultisampledRTT(a)?ca.get(a).__webglMultisampledFramebuffer:j,x.copy(a.viewport),y.copy(a.scissor),z=a.scissorTest}else x.copy(F).multiplyScalar(C).floor(),y.copy(G).multiplyScalar(C).floor(),z=H;if(aa.bindFramebuffer(36160,e)&&_.drawBuffers&&d&&aa.drawBuffers(a,e),aa.viewport(x),aa.scissor(y),aa.setScissorTest(z),f){let k=ca.get(a.texture);V.framebufferTexture2D(36160,36064,34069+b,k.__webglTexture,c)}else if(g){let l=ca.get(a.texture),m=b||0;V.framebufferTextureLayer(36160,36064,l.__webglTexture,c||0,m)}v=-1},this.readRenderTargetPixels=function(a,b,c,d,e,f,g){if(!(a&&a.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let h=ca.get(a).__webglFramebuffer;if(a.isWebGLCubeRenderTarget&& void 0!==g&&(h=h[g]),h){aa.bindFramebuffer(36160,h);try{let i=a.texture,j=i.format,k=i.type;if(j!==Da&&ua.convert(j)!==V.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let l=k===Ba&&($.has("EXT_color_buffer_half_float")||_.isWebGL2&&$.has("EXT_color_buffer_float"));if(k!==ya&&ua.convert(k)!==V.getParameter(35738)&&!(k===Aa&&(_.isWebGL2||$.has("OES_texture_float")||$.has("WEBGL_color_buffer_float")))&&!l){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}b>=0&&b<=a.width-d&&c>=0&&c<=a.height-e&&V.readPixels(b,c,d,e,ua.convert(j),ua.convert(k),f)}finally{let m=null!==u?ca.get(u).__webglFramebuffer:null;aa.bindFramebuffer(36160,m)}}},this.copyFramebufferToTexture=function(a,b,c=0){let d=Math.pow(2,-c),e=Math.floor(b.image.width*d),f=Math.floor(b.image.height*d);da.setTexture2D(b,0),V.copyTexSubImage2D(3553,c,0,0,a.x,a.y,e,f),aa.unbindTexture()},this.copyTextureToTexture=function(a,b,c,d=0){let e=b.image.width,f=b.image.height,g=ua.convert(c.format),h=ua.convert(c.type);da.setTexture2D(c,0),V.pixelStorei(37440,c.flipY),V.pixelStorei(37441,c.premultiplyAlpha),V.pixelStorei(3317,c.unpackAlignment),b.isDataTexture?V.texSubImage2D(3553,d,a.x,a.y,e,f,g,h,b.image.data):b.isCompressedTexture?V.compressedTexSubImage2D(3553,d,a.x,a.y,b.mipmaps[0].width,b.mipmaps[0].height,g,b.mipmaps[0].data):V.texSubImage2D(3553,d,a.x,a.y,g,h,b.image),0===d&&c.generateMipmaps&&V.generateMipmap(3553),aa.unbindTexture()},this.copyTextureToTexture3D=function(a,b,c,d,e=0){if(q.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let f=a.max.x-a.min.x+1,g=a.max.y-a.min.y+1,h=a.max.z-a.min.z+1,i=ua.convert(d.format),j=ua.convert(d.type),k;if(d.isData3DTexture)da.setTexture3D(d,0),k=32879;else if(d.isDataArrayTexture)da.setTexture2DArray(d,0),k=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}V.pixelStorei(37440,d.flipY),V.pixelStorei(37441,d.premultiplyAlpha),V.pixelStorei(3317,d.unpackAlignment);let l=V.getParameter(3314),m=V.getParameter(32878),n=V.getParameter(3316),o=V.getParameter(3315),p=V.getParameter(32877),r=c.isCompressedTexture?c.mipmaps[0]:c.image;V.pixelStorei(3314,r.width),V.pixelStorei(32878,r.height),V.pixelStorei(3316,a.min.x),V.pixelStorei(3315,a.min.y),V.pixelStorei(32877,a.min.z),c.isDataTexture||c.isData3DTexture?V.texSubImage3D(k,e,b.x,b.y,b.z,f,g,h,i,j,r.data):c.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),V.compressedTexSubImage3D(k,e,b.x,b.y,b.z,f,g,h,i,r.data)):V.texSubImage3D(k,e,b.x,b.y,b.z,f,g,h,i,j,r),V.pixelStorei(3314,l),V.pixelStorei(32878,m),V.pixelStorei(3316,n),V.pixelStorei(3315,o),V.pixelStorei(32877,p),0===e&&d.generateMipmaps&&V.generateMipmap(k),aa.unbindTexture()},this.initTexture=function(a){a.isCubeTexture?da.setTextureCube(a,0):a.isData3DTexture?da.setTexture3D(a,0):a.isDataArrayTexture||a.isCompressedArrayTexture?da.setTexture2DArray(a,0):da.setTexture2D(a,0),aa.unbindTexture()},this.resetState=function(){s=0,t=0,u=null,aa.reset(),va.reset()},"u">typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class extends uV{}).prototype.isWebGL1Renderer=!0;var vV=class{constructor(wV,xV=1,yV=1e3){this.isFog=!0,this.name="",this.color=new df(wV),this.near=xV,this.far=yV}clone(){return new vV(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},zV=class extends Iy{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"u">typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(AV,BV){return super.copy(AV,BV),null!==AV.background&&(this.background=AV.background.clone()),null!==AV.environment&&(this.environment=AV.environment.clone()),null!==AV.fog&&(this.fog=AV.fog.clone()),this.backgroundBlurriness=AV.backgroundBlurriness,this.backgroundIntensity=AV.backgroundIntensity,null!==AV.overrideMaterial&&(this.overrideMaterial=AV.overrideMaterial.clone()),this.matrixAutoUpdate=AV.matrixAutoUpdate,this}toJSON(CV){let DV=super.toJSON(CV);return null!==this.fog&&(DV.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(DV.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(DV.object.backgroundIntensity=this.backgroundIntensity),DV}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(EV){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=EV}},FV=class{constructor(GV,HV){this.isInterleavedBuffer=!0,this.array=GV,this.stride=HV,this.count=void 0!==GV?GV.length/HV:0,this.usage=$a,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ub()}onUploadCallback(){}set needsUpdate(IV){!0===IV&&this.version++}setUsage(JV){return this.usage=JV,this}copy(KV){return this.array=new KV.array.constructor(KV.array),this.count=KV.count,this.stride=KV.stride,this.usage=KV.usage,this}copyAt(LV,MV,NV){LV*=this.stride,NV*=MV.stride;for(let OV=0,PV=this.stride;OV<PV;OV++)this.array[LV+OV]=MV.array[NV+OV];return this}set(QV,RV=0){return this.array.set(QV,RV),this}clone(SV){void 0===SV.arrayBuffers&&(SV.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ub()),void 0===SV.arrayBuffers[this.array.buffer._uuid]&&(SV.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let TV=new this.array.constructor(SV.arrayBuffers[this.array.buffer._uuid]),UV=new this.constructor(TV,this.stride);return UV.setUsage(this.usage),UV}onUpload(VV){return this.onUploadCallback=VV,this}toJSON(WV){return void 0===WV.arrayBuffers&&(WV.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ub()),void 0===WV.arrayBuffers[this.array.buffer._uuid]&&(WV.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},XV=new fm,YV=class{constructor(ZV,$V,_V,aW=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=ZV,this.itemSize=$V,this.offset=_V,this.normalized=aW}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(bW){this.data.needsUpdate=bW}applyMatrix4(cW){for(let dW=0,eW=this.data.count;dW<eW;dW++)XV.fromBufferAttribute(this,dW),XV.applyMatrix4(cW),this.setXYZ(dW,XV.x,XV.y,XV.z);return this}applyNormalMatrix(fW){for(let gW=0,hW=this.count;gW<hW;gW++)XV.fromBufferAttribute(this,gW),XV.applyNormalMatrix(fW),this.setXYZ(gW,XV.x,XV.y,XV.z);return this}transformDirection(iW){for(let jW=0,kW=this.count;jW<kW;jW++)XV.fromBufferAttribute(this,jW),XV.transformDirection(iW),this.setXYZ(jW,XV.x,XV.y,XV.z);return this}setX(lW,mW){return this.normalized&&(mW=Cb(mW,this.array)),this.data.array[lW*this.data.stride+this.offset]=mW,this}setY(nW,oW){return this.normalized&&(oW=Cb(oW,this.array)),this.data.array[nW*this.data.stride+this.offset+1]=oW,this}setZ(pW,qW){return this.normalized&&(qW=Cb(qW,this.array)),this.data.array[pW*this.data.stride+this.offset+2]=qW,this}setW(rW,sW){return this.normalized&&(sW=Cb(sW,this.array)),this.data.array[rW*this.data.stride+this.offset+3]=sW,this}getX(tW){let uW=this.data.array[tW*this.data.stride+this.offset];return this.normalized&&(uW=Bb(uW,this.array)),uW}getY(vW){let wW=this.data.array[vW*this.data.stride+this.offset+1];return this.normalized&&(wW=Bb(wW,this.array)),wW}getZ(xW){let yW=this.data.array[xW*this.data.stride+this.offset+2];return this.normalized&&(yW=Bb(yW,this.array)),yW}getW(zW){let AW=this.data.array[zW*this.data.stride+this.offset+3];return this.normalized&&(AW=Bb(AW,this.array)),AW}setXY(BW,CW,DW){return BW=BW*this.data.stride+this.offset,this.normalized&&(CW=Cb(CW,this.array),DW=Cb(DW,this.array)),this.data.array[BW+0]=CW,this.data.array[BW+1]=DW,this}setXYZ(EW,FW,GW,HW){return EW=EW*this.data.stride+this.offset,this.normalized&&(FW=Cb(FW,this.array),GW=Cb(GW,this.array),HW=Cb(HW,this.array)),this.data.array[EW+0]=FW,this.data.array[EW+1]=GW,this.data.array[EW+2]=HW,this}setXYZW(IW,JW,KW,LW,MW){return IW=IW*this.data.stride+this.offset,this.normalized&&(JW=Cb(JW,this.array),KW=Cb(KW,this.array),LW=Cb(LW,this.array),MW=Cb(MW,this.array)),this.data.array[IW+0]=JW,this.data.array[IW+1]=KW,this.data.array[IW+2]=LW,this.data.array[IW+3]=MW,this}clone(NW){if(void 0!==NW)return void 0===NW.interleavedBuffers&&(NW.interleavedBuffers={}),void 0===NW.interleavedBuffers[this.data.uuid]&&(NW.interleavedBuffers[this.data.uuid]=this.data.clone(NW)),new YV(NW.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let OW=[];for(let PW=0;PW<this.count;PW++){let QW=PW*this.data.stride+this.offset;for(let RW=0;RW<this.itemSize;RW++)OW.push(this.data.array[QW+RW])}return new RC(new this.array.constructor(OW),this.itemSize,this.normalized)}}toJSON(SW){if(void 0!==SW)return void 0===SW.interleavedBuffers&&(SW.interleavedBuffers={}),void 0===SW.interleavedBuffers[this.data.uuid]&&(SW.interleavedBuffers[this.data.uuid]=this.data.toJSON(SW)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let TW=[];for(let UW=0;UW<this.count;UW++){let VW=UW*this.data.stride+this.offset;for(let WW=0;WW<this.itemSize;WW++)TW.push(this.data.array[VW+WW])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:TW,normalized:this.normalized}}}},XW=class extends Iy{constructor(){super(),this.isBone=!0,this.type="Bone"}},YW=class extends ah{constructor(ZW=null,$W=1,_W=1,aX,bX,cX,dX,eX,fX=sa,gX=sa,hX,iX){super(null,cX,dX,eX,fX,gX,aX,bX,hX,iX),this.isDataTexture=!0,this.image={data:ZW,width:$W,height:_W},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},jX=new rs,kX=new rs,lX=class{constructor(mX=[],nX=[]){this.uuid=ub(),this.bones=mX.slice(0),this.boneInverses=nX,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let oX=this.bones,pX=this.boneInverses;if(this.boneMatrices=new Float32Array(16*oX.length),0===pX.length)this.calculateInverses();else if(oX.length!==pX.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let qX=0,rX=this.bones.length;qX<rX;qX++)this.boneInverses.push(new rs)}}calculateInverses(){this.boneInverses.length=0;for(let sX=0,tX=this.bones.length;sX<tX;sX++){let uX=new rs;this.bones[sX]&&uX.copy(this.bones[sX].matrixWorld).invert(),this.boneInverses.push(uX)}}pose(){for(let vX=0,wX=this.bones.length;vX<wX;vX++){let xX=this.bones[vX];xX&&xX.matrixWorld.copy(this.boneInverses[vX]).invert()}for(let yX=0,zX=this.bones.length;yX<zX;yX++){let AX=this.bones[yX];AX&&(AX.parent&&AX.parent.isBone?(AX.matrix.copy(AX.parent.matrixWorld).invert(),AX.matrix.multiply(AX.matrixWorld)):AX.matrix.copy(AX.matrixWorld),AX.matrix.decompose(AX.position,AX.quaternion,AX.scale))}}update(){let BX=this.bones,CX=this.boneInverses,DX=this.boneMatrices,EX=this.boneTexture;for(let FX=0,GX=BX.length;FX<GX;FX++){let HX=BX[FX]?BX[FX].matrixWorld:kX;jX.multiplyMatrices(HX,CX[FX]),jX.toArray(DX,16*FX)}null!==EX&&(EX.needsUpdate=!0)}clone(){return new lX(this.bones,this.boneInverses)}computeBoneTexture(){let IX=Math.sqrt(4*this.bones.length);IX=Math.max(IX=zb(IX),4);let JX=new Float32Array(IX*IX*4);JX.set(this.boneMatrices);let KX=new YW(JX,IX,IX,Da,Aa);return KX.needsUpdate=!0,this.boneMatrices=JX,this.boneTexture=KX,this.boneTextureSize=IX,this}getBoneByName(LX){for(let MX=0,NX=this.bones.length;MX<NX;MX++){let OX=this.bones[MX];if(OX.name===LX)return OX}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(PX,QX){this.uuid=PX.uuid;for(let RX=0,SX=PX.bones.length;RX<SX;RX++){let TX=PX.bones[RX],UX=QX[TX];void 0===UX&&(console.warn("THREE.Skeleton: No bone found with UUID:",TX),UX=new XW),this.bones.push(UX),this.boneInverses.push(new rs().fromArray(PX.boneInverses[RX]))}return this.init(),this}toJSON(){let VX={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};VX.uuid=this.uuid;let WX=this.bones,XX=this.boneInverses;for(let YX=0,ZX=WX.length;YX<ZX;YX++){let $X=WX[YX];VX.bones.push($X.uuid);let _X=XX[YX];VX.boneInverses.push(_X.toArray())}return VX}},aY=class extends RC{constructor(bY,cY,dY,eY=1){super(bY,cY,dY),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=eY}copy(fY){return super.copy(fY),this.meshPerAttribute=fY.meshPerAttribute,this}toJSON(){let gY=super.toJSON();return gY.meshPerAttribute=this.meshPerAttribute,gY.isInstancedBufferAttribute=!0,gY}},hY=new rs,iY=new rs,jY=[],kY=new rs,lY=new GH,mY=class extends GH{constructor(nY,oY,pY){super(nY,oY),this.isInstancedMesh=!0,this.instanceMatrix=new aY(new Float32Array(16*pY),16),this.instanceColor=null,this.count=pY,this.frustumCulled=!1;for(let qY=0;qY<pY;qY++)this.setMatrixAt(qY,kY)}copy(rY,sY){return super.copy(rY,sY),this.instanceMatrix.copy(rY.instanceMatrix),null!==rY.instanceColor&&(this.instanceColor=rY.instanceColor.clone()),this.count=rY.count,this}getColorAt(tY,uY){uY.fromArray(this.instanceColor.array,3*tY)}getMatrixAt(vY,wY){wY.fromArray(this.instanceMatrix.array,16*vY)}raycast(xY,yY){let zY=this.matrixWorld,AY=this.count;if(lY.geometry=this.geometry,lY.material=this.material,void 0!==lY.material)for(let BY=0;BY<AY;BY++){this.getMatrixAt(BY,hY),iY.multiplyMatrices(zY,hY),lY.matrixWorld=iY,lY.raycast(xY,jY);for(let CY=0,DY=jY.length;CY<DY;CY++){let EY=jY[CY];EY.instanceId=BY,EY.object=this,yY.push(EY)}jY.length=0}}setColorAt(FY,GY){null===this.instanceColor&&(this.instanceColor=new aY(new Float32Array(3*this.instanceMatrix.count),3)),GY.toArray(this.instanceColor.array,3*FY)}setMatrixAt(HY,IY){IY.toArray(this.instanceMatrix.array,16*HY)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},JY=class extends uC{constructor(KY){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new df(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(KY)}copy(LY){return super.copy(LY),this.color.copy(LY.color),this.linewidth=LY.linewidth,this.linecap=LY.linecap,this.linejoin=LY.linejoin,this.fog=LY.fog,this}},MY=new fm,NY=new fm,OY=new rs,PY=new $q,QY=new pq,RY=class extends Iy{constructor(SY=new nE,TY=new JY){super(),this.isLine=!0,this.type="Line",this.geometry=SY,this.material=TY,this.updateMorphTargets()}copy(UY,VY){return super.copy(UY,VY),this.material=UY.material,this.geometry=UY.geometry,this}computeLineDistances(){let WY=this.geometry;if(null===WY.index){let XY=WY.attributes.position,YY=[0];for(let ZY=1,$Y=XY.count;ZY<$Y;ZY++)MY.fromBufferAttribute(XY,ZY-1),NY.fromBufferAttribute(XY,ZY),YY[ZY]=YY[ZY-1],YY[ZY]+=MY.distanceTo(NY);WY.setAttribute("lineDistance",new cE(YY,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(_Y,aZ){let bZ=this.geometry,cZ=this.matrixWorld,dZ=_Y.params.Line.threshold,eZ=bZ.drawRange;if(null===bZ.boundingSphere&&bZ.computeBoundingSphere(),QY.copy(bZ.boundingSphere),QY.applyMatrix4(cZ),QY.radius+=dZ,!1===_Y.ray.intersectsSphere(QY))return;OY.copy(cZ).invert(),PY.copy(_Y.ray).applyMatrix4(OY);let fZ=dZ/((this.scale.x+this.scale.y+this.scale.z)/3),gZ=fZ*fZ,hZ=new fm,iZ=new fm,jZ=new fm,kZ=new fm,lZ=this.isLineSegments?2:1,mZ=bZ.index,nZ=bZ.attributes.position;if(null!==mZ){let oZ=Math.max(0,eZ.start),pZ=Math.min(mZ.count,eZ.start+eZ.count);for(let qZ=oZ,rZ=pZ-1;qZ<rZ;qZ+=lZ){let sZ=mZ.getX(qZ),tZ=mZ.getX(qZ+1);if(hZ.fromBufferAttribute(nZ,sZ),iZ.fromBufferAttribute(nZ,tZ),PY.distanceSqToSegment(hZ,iZ,kZ,jZ)>gZ)continue;kZ.applyMatrix4(this.matrixWorld);let uZ=_Y.ray.origin.distanceTo(kZ);uZ<_Y.near||uZ>_Y.far||aZ.push({distance:uZ,point:jZ.clone().applyMatrix4(this.matrixWorld),index:qZ,face:null,faceIndex:null,object:this})}}else{let vZ=Math.max(0,eZ.start),wZ=Math.min(nZ.count,eZ.start+eZ.count);for(let xZ=vZ,yZ=wZ-1;xZ<yZ;xZ+=lZ){if(hZ.fromBufferAttribute(nZ,xZ),iZ.fromBufferAttribute(nZ,xZ+1),PY.distanceSqToSegment(hZ,iZ,kZ,jZ)>gZ)continue;kZ.applyMatrix4(this.matrixWorld);let zZ=_Y.ray.origin.distanceTo(kZ);zZ<_Y.near||zZ>_Y.far||aZ.push({distance:zZ,point:jZ.clone().applyMatrix4(this.matrixWorld),index:xZ,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let AZ=this.geometry.morphAttributes,BZ=Object.keys(AZ);if(BZ.length>0){let CZ=AZ[BZ[0]];if(void 0!==CZ){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let DZ=0,EZ=CZ.length;DZ<EZ;DZ++){let FZ=CZ[DZ].name||String(DZ);this.morphTargetInfluences.push(0),this.morphTargetDictionary[FZ]=DZ}}}}},GZ=new fm,HZ=new fm,IZ=class extends RY{constructor(JZ,KZ){super(JZ,KZ),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let LZ=this.geometry;if(null===LZ.index){let MZ=LZ.attributes.position,NZ=[];for(let OZ=0,PZ=MZ.count;OZ<PZ;OZ+=2)GZ.fromBufferAttribute(MZ,OZ),HZ.fromBufferAttribute(MZ,OZ+1),NZ[OZ]=0===OZ?0:NZ[OZ-1],NZ[OZ+1]=NZ[OZ]+GZ.distanceTo(HZ);LZ.setAttribute("lineDistance",new cE(NZ,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},QZ=class extends ah{constructor(RZ,SZ,TZ,UZ,VZ,WZ,XZ,YZ,ZZ){super(RZ,SZ,TZ,UZ,VZ,WZ,XZ,YZ,ZZ),this.isVideoTexture=!0,this.minFilter=void 0!==WZ?WZ:va,this.magFilter=void 0!==VZ?VZ:va,this.generateMipmaps=!1;let $Z=this;function _Z(){$Z.needsUpdate=!0,RZ.requestVideoFrameCallback(_Z)}"requestVideoFrameCallback"in RZ&&RZ.requestVideoFrameCallback(_Z)}clone(){return new this.constructor(this.image).copy(this)}update(){let a$=this.image;"requestVideoFrameCallback"in a$== !1&&a$.readyState>=a$.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},b$=class extends ah{constructor(c$,d$,e$,f$,g$,h$,i$,j$,k$){super(c$,d$,e$,f$,g$,h$,i$,j$,k$),this.isCanvasTexture=!0,this.needsUpdate=!0}},l$=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(m$,n$){let o$=this.getUtoTmapping(m$);return this.getPoint(o$,n$)}getPoints(p$=5){let q$=[];for(let r$=0;r$<=p$;r$++)q$.push(this.getPoint(r$/p$));return q$}getSpacedPoints(s$=5){let t$=[];for(let u$=0;u$<=s$;u$++)t$.push(this.getPointAt(u$/s$));return t$}getLength(){let v$=this.getLengths();return v$[v$.length-1]}getLengths(w$=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===w$+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let x$=[],y$,z$=this.getPoint(0),A$=0;x$.push(0);for(let B$=1;B$<=w$;B$++)A$+=(y$=this.getPoint(B$/w$)).distanceTo(z$),x$.push(A$),z$=y$;return this.cacheArcLengths=x$,x$}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(C$,D$){let E$=this.getLengths(),F$=0,G$=E$.length,H$;H$=D$||C$*E$[G$-1];let I$=0,J$=G$-1,K$;for(;I$<=J$;)if((K$=E$[F$=Math.floor(I$+(J$-I$)/2)]-H$)<0)I$=F$+1;else if(K$>0)J$=F$-1;else{J$=F$;break}if(E$[F$=J$]===H$)return F$/(G$-1);let L$=E$[F$],M$=E$[F$+1]-L$,N$=(H$-L$)/M$;return(F$+N$)/(G$-1)}getTangent(O$,P$){let Q$=O$-1e-4,R$=O$+1e-4;Q$<0&&(Q$=0),R$>1&&(R$=1);let S$=this.getPoint(Q$),T$=this.getPoint(R$),U$=P$||(S$.isVector2?new Eb:new fm);return U$.copy(T$).sub(S$).normalize(),U$}getTangentAt(V$,W$){let X$=this.getUtoTmapping(V$);return this.getTangent(X$,W$)}computeFrenetFrames(Y$,Z$){let $$=new fm,_$=[],a_=[],b_=[],c_=new fm,d_=new rs;for(let e_=0;e_<=Y$;e_++){let f_=e_/Y$;_$[e_]=this.getTangentAt(f_,new fm)}a_[0]=new fm,b_[0]=new fm;let g_=Number.MAX_VALUE,h_=Math.abs(_$[0].x),i_=Math.abs(_$[0].y),j_=Math.abs(_$[0].z);h_<=g_&&(g_=h_,$$.set(1,0,0)),i_<=g_&&(g_=i_,$$.set(0,1,0)),j_<=g_&&$$.set(0,0,1),c_.crossVectors(_$[0],$$).normalize(),a_[0].crossVectors(_$[0],c_),b_[0].crossVectors(_$[0],a_[0]);for(let k_=1;k_<=Y$;k_++){if(a_[k_]=a_[k_-1].clone(),b_[k_]=b_[k_-1].clone(),c_.crossVectors(_$[k_-1],_$[k_]),c_.length()>Number.EPSILON){c_.normalize();let l_=Math.acos(vb(_$[k_-1].dot(_$[k_]),-1,1));a_[k_].applyMatrix4(d_.makeRotationAxis(c_,l_))}b_[k_].crossVectors(_$[k_],a_[k_])}if(!0===Z$){let m_=Math.acos(vb(a_[0].dot(a_[Y$]),-1,1));m_/=Y$,_$[0].dot(c_.crossVectors(a_[0],a_[Y$]))>0&&(m_=-m_);for(let n_=1;n_<=Y$;n_++)a_[n_].applyMatrix4(d_.makeRotationAxis(_$[n_],m_*n_)),b_[n_].crossVectors(_$[n_],a_[n_])}return{tangents:_$,normals:a_,binormals:b_}}clone(){return new this.constructor().copy(this)}copy(o_){return this.arcLengthDivisions=o_.arcLengthDivisions,this}toJSON(){let p_={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return p_.arcLengthDivisions=this.arcLengthDivisions,p_.type=this.type,p_}fromJSON(q_){return this.arcLengthDivisions=q_.arcLengthDivisions,this}},r_=class extends l${constructor(s_=0,t_=0,u_=1,v_=1,w_=0,x_=2*Math.PI,y_=!1,z_=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=s_,this.aY=t_,this.xRadius=u_,this.yRadius=v_,this.aStartAngle=w_,this.aEndAngle=x_,this.aClockwise=y_,this.aRotation=z_}getPoint(A_,B_){let C_=B_||new Eb,D_=2*Math.PI,E_=this.aEndAngle-this.aStartAngle,F_=Math.abs(E_)<Number.EPSILON;for(;E_<0;)E_+=D_;for(;E_>D_;)E_-=D_;E_<Number.EPSILON&&(E_=F_?0:D_),!0!==this.aClockwise||F_||(E_===D_?E_=-D_:E_-=D_);let G_=this.aStartAngle+A_*E_,H_=this.aX+this.xRadius*Math.cos(G_),I_=this.aY+this.yRadius*Math.sin(G_);if(0!==this.aRotation){let J_=Math.cos(this.aRotation),K_=Math.sin(this.aRotation),L_=H_-this.aX,M_=I_-this.aY;H_=L_*J_-M_*K_+this.aX,I_=L_*K_+M_*J_+this.aY}return C_.set(H_,I_)}copy(N_){return super.copy(N_),this.aX=N_.aX,this.aY=N_.aY,this.xRadius=N_.xRadius,this.yRadius=N_.yRadius,this.aStartAngle=N_.aStartAngle,this.aEndAngle=N_.aEndAngle,this.aClockwise=N_.aClockwise,this.aRotation=N_.aRotation,this}toJSON(){let O_=super.toJSON();return O_.aX=this.aX,O_.aY=this.aY,O_.xRadius=this.xRadius,O_.yRadius=this.yRadius,O_.aStartAngle=this.aStartAngle,O_.aEndAngle=this.aEndAngle,O_.aClockwise=this.aClockwise,O_.aRotation=this.aRotation,O_}fromJSON(P_){return super.fromJSON(P_),this.aX=P_.aX,this.aY=P_.aY,this.xRadius=P_.xRadius,this.yRadius=P_.yRadius,this.aStartAngle=P_.aStartAngle,this.aEndAngle=P_.aEndAngle,this.aClockwise=P_.aClockwise,this.aRotation=P_.aRotation,this}},Q_=class extends r_{constructor(R_,S_,T_,U_,V_,W_){super(R_,S_,T_,T_,U_,V_,W_),this.isArcCurve=!0,this.type="ArcCurve"}};function X_(){let a=0,b=0,c=0,d=0;function e(e,f,g,h){a=e,b=g,c=-3*e+3*f-2*g-h,d=2*e-2*f+g+h}return{initCatmullRom:function(a,b,c,d,f){e(b,c,f*(c-a),f*(d-b))},initNonuniformCatmullRom:function(a,b,c,d,f,g,h){let i=(b-a)/f-(c-a)/(f+g)+(c-b)/g,j=(c-b)/g-(d-b)/(g+h)+(d-c)/h;i*=g,j*=g,e(b,c,i,j)},calc:function(e){let f=e*e;return a+b*e+c*f+d*(f*e)}}}var Y_=new fm,Z_=new X_,$_=new X_,__=new X_,a0=class extends l${constructor(b0=[],c0=!1,d0="centripetal",e0=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=b0,this.closed=c0,this.curveType=d0,this.tension=e0}getPoint(f0,g0=new fm){let h0=g0,i0=this.points,j0=i0.length,k0=(j0-(this.closed?0:1))*f0,l0=Math.floor(k0),m0=k0-l0;this.closed?l0+=l0>0?0:(Math.floor(Math.abs(l0)/j0)+1)*j0:0===m0&&l0===j0-1&&(l0=j0-2,m0=1);let n0,o0;this.closed||l0>0?n0=i0[(l0-1)%j0]:(Y_.subVectors(i0[0],i0[1]).add(i0[0]),n0=Y_);let p0=i0[l0%j0],q0=i0[(l0+1)%j0];if(this.closed||l0+2<j0?o0=i0[(l0+2)%j0]:(Y_.subVectors(i0[j0-1],i0[j0-2]).add(i0[j0-1]),o0=Y_),"centripetal"===this.curveType||"chordal"===this.curveType){let r0="chordal"===this.curveType?.5:.25,s0=Math.pow(n0.distanceToSquared(p0),r0),t0=Math.pow(p0.distanceToSquared(q0),r0),u0=Math.pow(q0.distanceToSquared(o0),r0);t0<1e-4&&(t0=1),s0<1e-4&&(s0=t0),u0<1e-4&&(u0=t0),Z_.initNonuniformCatmullRom(n0.x,p0.x,q0.x,o0.x,s0,t0,u0),$_.initNonuniformCatmullRom(n0.y,p0.y,q0.y,o0.y,s0,t0,u0),__.initNonuniformCatmullRom(n0.z,p0.z,q0.z,o0.z,s0,t0,u0)}else"catmullrom"===this.curveType&&(Z_.initCatmullRom(n0.x,p0.x,q0.x,o0.x,this.tension),$_.initCatmullRom(n0.y,p0.y,q0.y,o0.y,this.tension),__.initCatmullRom(n0.z,p0.z,q0.z,o0.z,this.tension));return h0.set(Z_.calc(m0),$_.calc(m0),__.calc(m0)),h0}copy(v0){super.copy(v0),this.points=[];for(let w0=0,x0=v0.points.length;w0<x0;w0++){let y0=v0.points[w0];this.points.push(y0.clone())}return this.closed=v0.closed,this.curveType=v0.curveType,this.tension=v0.tension,this}toJSON(){let z0=super.toJSON();z0.points=[];for(let A0=0,B0=this.points.length;A0<B0;A0++){let C0=this.points[A0];z0.points.push(C0.toArray())}return z0.closed=this.closed,z0.curveType=this.curveType,z0.tension=this.tension,z0}fromJSON(D0){super.fromJSON(D0),this.points=[];for(let E0=0,F0=D0.points.length;E0<F0;E0++){let G0=D0.points[E0];this.points.push(new fm().fromArray(G0))}return this.closed=D0.closed,this.curveType=D0.curveType,this.tension=D0.tension,this}};function H0(a,b,c,d,e){let f=(d-b)*.5,g=(e-c)*.5,h=a*a;return(2*c-2*d+f+g)*(a*h)+(-3*c+3*d-2*f-g)*h+f*a+c}function I0(a,b,c,d){var e,f,g,h;let i;return e=a,f=b,(i=1-e)*i*f+2*(1-(g=a))*g*c+(h=a)*h*d}function J0(a,b,c,d,e){var f,g,h,i,j,k;let l,m;return f=a,g=b,(l=1-f)*l*l*g+(h=a,i=c,3*(m=1-h)*m*h*i)+3*(1-(j=a))*j*j*d+(k=a)*k*k*e}var K0=class extends l${constructor(L0=new Eb,M0=new Eb,N0=new Eb,O0=new Eb){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=L0,this.v1=M0,this.v2=N0,this.v3=O0}getPoint(P0,Q0=new Eb){let R0=Q0,S0=this.v0,T0=this.v1,U0=this.v2,V0=this.v3;return R0.set(J0(P0,S0.x,T0.x,U0.x,V0.x),J0(P0,S0.y,T0.y,U0.y,V0.y)),R0}copy(W0){return super.copy(W0),this.v0.copy(W0.v0),this.v1.copy(W0.v1),this.v2.copy(W0.v2),this.v3.copy(W0.v3),this}toJSON(){let X0=super.toJSON();return X0.v0=this.v0.toArray(),X0.v1=this.v1.toArray(),X0.v2=this.v2.toArray(),X0.v3=this.v3.toArray(),X0}fromJSON(Y0){return super.fromJSON(Y0),this.v0.fromArray(Y0.v0),this.v1.fromArray(Y0.v1),this.v2.fromArray(Y0.v2),this.v3.fromArray(Y0.v3),this}},Z0=class extends l${constructor($0=new fm,_0=new fm,a1=new fm,b1=new fm){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=$0,this.v1=_0,this.v2=a1,this.v3=b1}getPoint(c1,d1=new fm){let e1=d1,f1=this.v0,g1=this.v1,h1=this.v2,i1=this.v3;return e1.set(J0(c1,f1.x,g1.x,h1.x,i1.x),J0(c1,f1.y,g1.y,h1.y,i1.y),J0(c1,f1.z,g1.z,h1.z,i1.z)),e1}copy(j1){return super.copy(j1),this.v0.copy(j1.v0),this.v1.copy(j1.v1),this.v2.copy(j1.v2),this.v3.copy(j1.v3),this}toJSON(){let k1=super.toJSON();return k1.v0=this.v0.toArray(),k1.v1=this.v1.toArray(),k1.v2=this.v2.toArray(),k1.v3=this.v3.toArray(),k1}fromJSON(l1){return super.fromJSON(l1),this.v0.fromArray(l1.v0),this.v1.fromArray(l1.v1),this.v2.fromArray(l1.v2),this.v3.fromArray(l1.v3),this}},m1=class extends l${constructor(n1=new Eb,o1=new Eb){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=n1,this.v2=o1}getPoint(p1,q1=new Eb){let r1=q1;return 1===p1?r1.copy(this.v2):(r1.copy(this.v2).sub(this.v1),r1.multiplyScalar(p1).add(this.v1)),r1}getPointAt(s1,t1){return this.getPoint(s1,t1)}getTangent(u1,v1){let w1=v1||new Eb;return w1.copy(this.v2).sub(this.v1).normalize(),w1}copy(x1){return super.copy(x1),this.v1.copy(x1.v1),this.v2.copy(x1.v2),this}toJSON(){let y1=super.toJSON();return y1.v1=this.v1.toArray(),y1.v2=this.v2.toArray(),y1}fromJSON(z1){return super.fromJSON(z1),this.v1.fromArray(z1.v1),this.v2.fromArray(z1.v2),this}},A1=class extends l${constructor(B1=new fm,C1=new fm){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=B1,this.v2=C1}getPoint(D1,E1=new fm){let F1=E1;return 1===D1?F1.copy(this.v2):(F1.copy(this.v2).sub(this.v1),F1.multiplyScalar(D1).add(this.v1)),F1}getPointAt(G1,H1){return this.getPoint(G1,H1)}copy(I1){return super.copy(I1),this.v1.copy(I1.v1),this.v2.copy(I1.v2),this}toJSON(){let J1=super.toJSON();return J1.v1=this.v1.toArray(),J1.v2=this.v2.toArray(),J1}fromJSON(K1){return super.fromJSON(K1),this.v1.fromArray(K1.v1),this.v2.fromArray(K1.v2),this}},L1=class extends l${constructor(M1=new Eb,N1=new Eb,O1=new Eb){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=M1,this.v1=N1,this.v2=O1}getPoint(P1,Q1=new Eb){let R1=Q1,S1=this.v0,T1=this.v1,U1=this.v2;return R1.set(I0(P1,S1.x,T1.x,U1.x),I0(P1,S1.y,T1.y,U1.y)),R1}copy(V1){return super.copy(V1),this.v0.copy(V1.v0),this.v1.copy(V1.v1),this.v2.copy(V1.v2),this}toJSON(){let W1=super.toJSON();return W1.v0=this.v0.toArray(),W1.v1=this.v1.toArray(),W1.v2=this.v2.toArray(),W1}fromJSON(X1){return super.fromJSON(X1),this.v0.fromArray(X1.v0),this.v1.fromArray(X1.v1),this.v2.fromArray(X1.v2),this}},Y1=class extends l${constructor(Z1=new fm,$1=new fm,_1=new fm){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=Z1,this.v1=$1,this.v2=_1}getPoint(a2,b2=new fm){let c2=b2,d2=this.v0,e2=this.v1,f2=this.v2;return c2.set(I0(a2,d2.x,e2.x,f2.x),I0(a2,d2.y,e2.y,f2.y),I0(a2,d2.z,e2.z,f2.z)),c2}copy(g2){return super.copy(g2),this.v0.copy(g2.v0),this.v1.copy(g2.v1),this.v2.copy(g2.v2),this}toJSON(){let h2=super.toJSON();return h2.v0=this.v0.toArray(),h2.v1=this.v1.toArray(),h2.v2=this.v2.toArray(),h2}fromJSON(i2){return super.fromJSON(i2),this.v0.fromArray(i2.v0),this.v1.fromArray(i2.v1),this.v2.fromArray(i2.v2),this}},j2=class extends l${constructor(k2=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=k2}getPoint(l2,m2=new Eb){let n2=m2,o2=this.points,p2=(o2.length-1)*l2,q2=Math.floor(p2),r2=p2-q2,s2=o2[0===q2?q2:q2-1],t2=o2[q2],u2=o2[q2>o2.length-2?o2.length-1:q2+1],v2=o2[q2>o2.length-3?o2.length-1:q2+2];return n2.set(H0(r2,s2.x,t2.x,u2.x,v2.x),H0(r2,s2.y,t2.y,u2.y,v2.y)),n2}copy(w2){super.copy(w2),this.points=[];for(let x2=0,y2=w2.points.length;x2<y2;x2++){let z2=w2.points[x2];this.points.push(z2.clone())}return this}toJSON(){let A2=super.toJSON();A2.points=[];for(let B2=0,C2=this.points.length;B2<C2;B2++){let D2=this.points[B2];A2.points.push(D2.toArray())}return A2}fromJSON(E2){super.fromJSON(E2),this.points=[];for(let F2=0,G2=E2.points.length;F2<G2;F2++){let H2=E2.points[F2];this.points.push(new Eb().fromArray(H2))}return this}},I2=Object.freeze({__proto__:null,ArcCurve:Q_,CatmullRomCurve3:a0,CubicBezierCurve:K0,CubicBezierCurve3:Z0,EllipseCurve:r_,LineCurve:m1,LineCurve3:A1,QuadraticBezierCurve:L1,QuadraticBezierCurve3:Y1,SplineCurve:j2}),J2=class extends l${constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(K2){this.curves.push(K2)}closePath(){let L2=this.curves[0].getPoint(0),M2=this.curves[this.curves.length-1].getPoint(1);L2.equals(M2)||this.curves.push(new m1(M2,L2))}getPoint(N2,O2){let P2=N2*this.getLength(),Q2=this.getCurveLengths(),R2=0;for(;R2<Q2.length;){if(Q2[R2]>=P2){let S2=Q2[R2]-P2,T2=this.curves[R2],U2=T2.getLength(),V2=0===U2?0:1-S2/U2;return T2.getPointAt(V2,O2)}R2++}return null}getLength(){let W2=this.getCurveLengths();return W2[W2.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let X2=[],Y2=0;for(let Z2=0,$2=this.curves.length;Z2<$2;Z2++)Y2+=this.curves[Z2].getLength(),X2.push(Y2);return this.cacheLengths=X2,X2}getSpacedPoints(_2=40){let a3=[];for(let b3=0;b3<=_2;b3++)a3.push(this.getPoint(b3/_2));return this.autoClose&&a3.push(a3[0]),a3}getPoints(c3=12){let d3=[],e3;for(let f3=0,g3=this.curves;f3<g3.length;f3++){let h3=g3[f3],i3=h3.isEllipseCurve?2*c3:h3.isLineCurve||h3.isLineCurve3?1:h3.isSplineCurve?c3*h3.points.length:c3,j3=h3.getPoints(i3);for(let k3=0;k3<j3.length;k3++){let l3=j3[k3];e3&&e3.equals(l3)||(d3.push(l3),e3=l3)}}return this.autoClose&&d3.length>1&&!d3[d3.length-1].equals(d3[0])&&d3.push(d3[0]),d3}copy(m3){super.copy(m3),this.curves=[];for(let n3=0,o3=m3.curves.length;n3<o3;n3++){let p3=m3.curves[n3];this.curves.push(p3.clone())}return this.autoClose=m3.autoClose,this}toJSON(){let q3=super.toJSON();q3.autoClose=this.autoClose,q3.curves=[];for(let r3=0,s3=this.curves.length;r3<s3;r3++){let t3=this.curves[r3];q3.curves.push(t3.toJSON())}return q3}fromJSON(u3){super.fromJSON(u3),this.autoClose=u3.autoClose,this.curves=[];for(let v3=0,w3=u3.curves.length;v3<w3;v3++){let x3=u3.curves[v3];this.curves.push(new I2[x3.type]().fromJSON(x3))}return this}},y3=class extends J2{constructor(z3){super(),this.type="Path",this.currentPoint=new Eb,z3&&this.setFromPoints(z3)}setFromPoints(A3){this.moveTo(A3[0].x,A3[0].y);for(let B3=1,C3=A3.length;B3<C3;B3++)this.lineTo(A3[B3].x,A3[B3].y);return this}moveTo(D3,E3){return this.currentPoint.set(D3,E3),this}lineTo(F3,G3){let H3=new m1(this.currentPoint.clone(),new Eb(F3,G3));return this.curves.push(H3),this.currentPoint.set(F3,G3),this}quadraticCurveTo(I3,J3,K3,L3){let M3=new L1(this.currentPoint.clone(),new Eb(I3,J3),new Eb(K3,L3));return this.curves.push(M3),this.currentPoint.set(K3,L3),this}bezierCurveTo(N3,O3,P3,Q3,R3,S3){let T3=new K0(this.currentPoint.clone(),new Eb(N3,O3),new Eb(P3,Q3),new Eb(R3,S3));return this.curves.push(T3),this.currentPoint.set(R3,S3),this}splineThru(U3){let V3=[this.currentPoint.clone()].concat(U3),W3=new j2(V3);return this.curves.push(W3),this.currentPoint.copy(U3[U3.length-1]),this}arc(X3,Y3,Z3,$3,_3,a4){let b4=this.currentPoint.x,c4=this.currentPoint.y;return this.absarc(X3+b4,Y3+c4,Z3,$3,_3,a4),this}absarc(d4,e4,f4,g4,h4,i4){return this.absellipse(d4,e4,f4,f4,g4,h4,i4),this}ellipse(j4,k4,l4,m4,n4,o4,p4,q4){let r4=this.currentPoint.x,s4=this.currentPoint.y;return this.absellipse(j4+r4,k4+s4,l4,m4,n4,o4,p4,q4),this}absellipse(t4,u4,v4,w4,x4,y4,z4,A4){let B4=new r_(t4,u4,v4,w4,x4,y4,z4,A4);if(this.curves.length>0){let C4=B4.getPoint(0);C4.equals(this.currentPoint)||this.lineTo(C4.x,C4.y)}this.curves.push(B4);let D4=B4.getPoint(1);return this.currentPoint.copy(D4),this}copy(E4){return super.copy(E4),this.currentPoint.copy(E4.currentPoint),this}toJSON(){let F4=super.toJSON();return F4.currentPoint=this.currentPoint.toArray(),F4}fromJSON(G4){return super.fromJSON(G4),this.currentPoint.fromArray(G4.currentPoint),this}},H4=class extends nE{constructor(I4=[new Eb(0,-0.5),new Eb(.5,0),new Eb(0,.5)],J4=12,K4=0,L4=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:I4,segments:J4,phiStart:K4,phiLength:L4},J4=Math.floor(J4),L4=vb(L4,0,2*Math.PI);let M4=[],N4=[],O4=[],P4=[],Q4=[],R4=1/J4,S4=new fm,T4=new Eb,U4=new fm,V4=new fm,W4=new fm,X4=0,Y4=0;for(let Z4=0;Z4<=I4.length-1;Z4++)switch(Z4){case 0:X4=I4[Z4+1].x-I4[Z4].x,Y4=I4[Z4+1].y-I4[Z4].y,U4.x=1*Y4,U4.y=-X4,U4.z=0*Y4,W4.copy(U4),U4.normalize(),P4.push(U4.x,U4.y,U4.z);break;case I4.length-1:P4.push(W4.x,W4.y,W4.z);break;default:X4=I4[Z4+1].x-I4[Z4].x,Y4=I4[Z4+1].y-I4[Z4].y,U4.x=1*Y4,U4.y=-X4,U4.z=0*Y4,V4.copy(U4),U4.x+=W4.x,U4.y+=W4.y,U4.z+=W4.z,U4.normalize(),P4.push(U4.x,U4.y,U4.z),W4.copy(V4)}for(let $4=0;$4<=J4;$4++){let _4=K4+$4*R4*L4,a5=Math.sin(_4),b5=Math.cos(_4);for(let c5=0;c5<=I4.length-1;c5++){S4.x=I4[c5].x*a5,S4.y=I4[c5].y,S4.z=I4[c5].x*b5,N4.push(S4.x,S4.y,S4.z),T4.x=$4/J4,T4.y=c5/(I4.length-1),O4.push(T4.x,T4.y);let d5=P4[3*c5+0]*a5,e5=P4[3*c5+1],f5=P4[3*c5+0]*b5;Q4.push(d5,e5,f5)}}for(let g5=0;g5<J4;g5++)for(let h5=0;h5<I4.length-1;h5++){let i5=h5+g5*I4.length,j5=i5,k5=i5+I4.length,l5=i5+I4.length+1,m5=i5+1;M4.push(j5,k5,m5),M4.push(l5,m5,k5)}this.setIndex(M4),this.setAttribute("position",new cE(N4,3)),this.setAttribute("uv",new cE(O4,2)),this.setAttribute("normal",new cE(Q4,3))}static fromJSON(n5){return new H4(n5.points,n5.segments,n5.phiStart,n5.phiLength)}},o5=class extends nE{constructor(p5=1,q5=1,r5=1,s5=32,t5=1,u5=!1,v5=0,w5=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:p5,radiusBottom:q5,height:r5,radialSegments:s5,heightSegments:t5,openEnded:u5,thetaStart:v5,thetaLength:w5};let x5=this;s5=Math.floor(s5),t5=Math.floor(t5);let y5=[],z5=[],A5=[],B5=[],C5=0,D5=[],E5=r5/2,F5=0;function G5(a){let b=C5,c=new Eb,d=new fm,e=0,f=!0===a?p5:q5,g=!0===a?1:-1;for(let h=1;h<=s5;h++)z5.push(0,E5*g,0),A5.push(0,g,0),B5.push(.5,.5),C5++;let i=C5;for(let j=0;j<=s5;j++){let k=j/s5*w5+v5,l=Math.cos(k),m=Math.sin(k);d.x=f*m,d.y=E5*g,d.z=f*l,z5.push(d.x,d.y,d.z),A5.push(0,g,0),c.x=.5*l+.5,c.y=.5*m*g+.5,B5.push(c.x,c.y),C5++}for(let n=0;n<s5;n++){let o=b+n,p=i+n;!0===a?y5.push(p,p+1,o):y5.push(p+1,p,o),e+=3}x5.addGroup(F5,e,!0===a?1:2),F5+=e}(function(){let a=new fm,b=new fm,c=0,d=(q5-p5)/r5;for(let e=0;e<=t5;e++){let f=[],g=e/t5,h=g*(q5-p5)+p5;for(let i=0;i<=s5;i++){let j=i/s5,k=j*w5+v5,l=Math.sin(k),m=Math.cos(k);b.x=h*l,b.y=-g*r5+E5,b.z=h*m,z5.push(b.x,b.y,b.z),a.set(l,d,m).normalize(),A5.push(a.x,a.y,a.z),B5.push(j,1-g),f.push(C5++)}D5.push(f)}for(let n=0;n<s5;n++)for(let o=0;o<t5;o++){let p=D5[o][n],q=D5[o+1][n],r=D5[o+1][n+1],s=D5[o][n+1];y5.push(p,q,s),y5.push(q,r,s),c+=6}x5.addGroup(F5,c,0),F5+=c})(),!1===u5&&(p5>0&&G5(!0),q5>0&&G5(!1)),this.setIndex(y5),this.setAttribute("position",new cE(z5,3)),this.setAttribute("normal",new cE(A5,3)),this.setAttribute("uv",new cE(B5,2))}static fromJSON(H5){return new o5(H5.radiusTop,H5.radiusBottom,H5.height,H5.radialSegments,H5.heightSegments,H5.openEnded,H5.thetaStart,H5.thetaLength)}},I5=class extends o5{constructor(J5=1,K5=1,L5=32,M5=1,N5=!1,O5=0,P5=2*Math.PI){super(0,J5,K5,L5,M5,N5,O5,P5),this.type="ConeGeometry",this.parameters={radius:J5,height:K5,radialSegments:L5,heightSegments:M5,openEnded:N5,thetaStart:O5,thetaLength:P5}}static fromJSON(Q5){return new I5(Q5.radius,Q5.height,Q5.radialSegments,Q5.heightSegments,Q5.openEnded,Q5.thetaStart,Q5.thetaLength)}},R5=class extends nE{constructor(S5=[],T5=[],U5=1,V5=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:S5,indices:T5,radius:U5,detail:V5};let W5=[],X5=[];function Y5(a,b,c,d){let e=d+1,f=[];for(let g=0;g<=e;g++){f[g]=[];let h=a.clone().lerp(c,g/e),i=b.clone().lerp(c,g/e),j=e-g;for(let k=0;k<=j;k++)0===k&&g===e?f[g][k]=h:f[g][k]=h.clone().lerp(i,k/j)}for(let l=0;l<e;l++)for(let m=0;m<2*(e-l)-1;m++){let n=Math.floor(m/2);m%2==0?(Z5(f[l][n+1]),Z5(f[l+1][n]),Z5(f[l][n])):(Z5(f[l][n+1]),Z5(f[l+1][n+1]),Z5(f[l+1][n]))}}function Z5(a){W5.push(a.x,a.y,a.z)}function $5(a,b){let c=3*a;b.x=S5[c+0],b.y=S5[c+1],b.z=S5[c+2]}function _5(a,b,c,d){d<0&&1===a.x&&(X5[b]=a.x-1),0===c.x&&0===c.z&&(X5[b]=d/2/Math.PI+.5)}function a6(a){return Math.atan2(a.z,-a.x)}function b6(a){return Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))}(function(a){let b=new fm,c=new fm,d=new fm;for(let e=0;e<T5.length;e+=3)$5(T5[e+0],b),$5(T5[e+1],c),$5(T5[e+2],d),Y5(b,c,d,a)})(V5),(function(a){let b=new fm;for(let c=0;c<W5.length;c+=3)b.x=W5[c+0],b.y=W5[c+1],b.z=W5[c+2],b.normalize().multiplyScalar(a),W5[c+0]=b.x,W5[c+1]=b.y,W5[c+2]=b.z})(U5),(function(){let a=new fm;for(let b=0;b<W5.length;b+=3){a.x=W5[b+0],a.y=W5[b+1],a.z=W5[b+2];let c=a6(a)/2/Math.PI+.5,d=b6(a)/Math.PI+.5;X5.push(c,1-d)}(function(){let a=new fm,b=new fm,c=new fm,d=new fm,e=new Eb,f=new Eb,g=new Eb;for(let h=0,i=0;h<W5.length;h+=9,i+=6){a.set(W5[h+0],W5[h+1],W5[h+2]),b.set(W5[h+3],W5[h+4],W5[h+5]),c.set(W5[h+6],W5[h+7],W5[h+8]),e.set(X5[i+0],X5[i+1]),f.set(X5[i+2],X5[i+3]),g.set(X5[i+4],X5[i+5]),d.copy(a).add(b).add(c).divideScalar(3);let j=a6(d);_5(e,i+0,a,j),_5(f,i+2,b,j),_5(g,i+4,c,j)}})(),(function(){for(let a=0;a<X5.length;a+=6){let b=X5[a+0],c=X5[a+2],d=X5[a+4],e=Math.max(b,c,d),f=Math.min(b,c,d);e>.9&&f<.1&&(b<.2&&(X5[a+0]+=1),c<.2&&(X5[a+2]+=1),d<.2&&(X5[a+4]+=1))}})()})(),this.setAttribute("position",new cE(W5,3)),this.setAttribute("normal",new cE(W5.slice(),3)),this.setAttribute("uv",new cE(X5,2)),0===V5?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(c6){return new R5(c6.vertices,c6.indices,c6.radius,c6.details)}},d6=class extends R5{constructor(e6=1,f6=0){let g6=(1+Math.sqrt(5))/2,h6=1/g6;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-h6,-g6,0,-h6,g6,0,h6,-g6,0,h6,g6,-h6,-g6,0,-h6,g6,0,h6,-g6,0,h6,g6,0,-g6,0,-h6,g6,0,-h6,-g6,0,h6,g6,0,h6],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e6,f6),this.type="DodecahedronGeometry",this.parameters={radius:e6,detail:f6}}static fromJSON(i6){return new d6(i6.radius,i6.detail)}},j6=class extends y3{constructor(k6){super(k6),this.uuid=ub(),this.type="Shape",this.holes=[]}getPointsHoles(l6){let m6=[];for(let n6=0,o6=this.holes.length;n6<o6;n6++)m6[n6]=this.holes[n6].getPoints(l6);return m6}extractPoints(p6){return{shape:this.getPoints(p6),holes:this.getPointsHoles(p6)}}copy(q6){super.copy(q6),this.holes=[];for(let r6=0,s6=q6.holes.length;r6<s6;r6++){let t6=q6.holes[r6];this.holes.push(t6.clone())}return this}toJSON(){let u6=super.toJSON();u6.uuid=this.uuid,u6.holes=[];for(let v6=0,w6=this.holes.length;v6<w6;v6++){let x6=this.holes[v6];u6.holes.push(x6.toJSON())}return u6}fromJSON(y6){super.fromJSON(y6),this.uuid=y6.uuid,this.holes=[];for(let z6=0,A6=y6.holes.length;z6<A6;z6++){let B6=y6.holes[z6];this.holes.push(new y3().fromJSON(B6))}return this}},C6={triangulate:function(a,b,c=2){let d=b&&b.length,e=d?b[0]*c:a.length,f=D6(a,0,e,c,!0),g=[];if(!f||f.next===f.prev)return g;let h,i,j,k,l,m,n;if(d&&(f=K6(a,b,f,c)),a.length>80*c){h=j=a[0],i=k=a[1];for(let o=c;o<e;o+=c)l=a[o],m=a[o+1],l<h&&(h=l),m<i&&(i=m),l>j&&(j=l),m>k&&(k=m);n=0!==(n=Math.max(j-h,k-i))?32767/n:0}return F6(f,g,c,h,i,n,0),g}};function D6(a,b,c,d,e){let f,g;if(e===f7(a,b,c,d)>0)for(f=b;f<c;f+=d)g=c7(f,a[f],a[f+1],g);else for(f=c-d;f>=b;f-=d)g=c7(f,a[f],a[f+1],g);return g&&W6(g,g.next)&&(d7(g),g=g.next),g}function E6(a,b){if(!a)return a;b||(b=a);let c=a,d;do if(d=!1,!c.steiner&&(W6(c,c.next)||0===V6(c.prev,c,c.next))){if(d7(c),(c=b=c.prev)===c.next)break;d=!0}else c=c.next;while(d||c!==b);return b}function F6(a,b,c,d,e,f,g){if(!a)return;!g&&f&&P6(a,d,e,f);let h=a,i,j;for(;a.prev!==a.next;){if(i=a.prev,j=a.next,f?H6(a,d,e,f):G6(a)){b.push(i.i/c|0),b.push(a.i/c|0),b.push(j.i/c|0),d7(a),a=j.next,h=j.next;continue}if((a=j)===h){g?1===g?F6(a=I6(E6(a),b,c),b,c,d,e,f,2):2===g&&J6(a,b,c,d,e,f):F6(E6(a),b,c,d,e,f,1);break}}}function G6(a){let b=a.prev,c=a,d=a.next;if(V6(b,c,d)>=0)return!1;let e=b.x,f=c.x,g=d.x,h=b.y,i=c.y,j=d.y,k=e<f?e<g?e:g:f<g?f:g,l=h<i?h<j?h:j:i<j?i:j,m=e>f?e>g?e:g:f>g?f:g,n=h>i?h>j?h:j:i>j?i:j,o=d.next;for(;o!==b;){if(o.x>=k&&o.x<=m&&o.y>=l&&o.y<=n&&T6(e,h,f,i,g,j,o.x,o.y)&&V6(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function H6(a,b,c,d){let e=a.prev,f=a,g=a.next;if(V6(e,f,g)>=0)return!1;let h=e.x,i=f.x,j=g.x,k=e.y,l=f.y,m=g.y,n=h<i?h<j?h:j:i<j?i:j,o=k<l?k<m?k:m:l<m?l:m,p=h>i?h>j?h:j:i>j?i:j,q=k>l?k>m?k:m:l>m?l:m,r=R6(n,o,b,c,d),s=R6(p,q,b,c,d),t=a.prevZ,u=a.nextZ;for(;t&&t.z>=r&&u&&u.z<=s;){if(t.x>=n&&t.x<=p&&t.y>=o&&t.y<=q&&t!==e&&t!==g&&T6(h,k,i,l,j,m,t.x,t.y)&&V6(t.prev,t,t.next)>=0||(t=t.prevZ,u.x>=n&&u.x<=p&&u.y>=o&&u.y<=q&&u!==e&&u!==g&&T6(h,k,i,l,j,m,u.x,u.y)&&V6(u.prev,u,u.next)>=0))return!1;u=u.nextZ}for(;t&&t.z>=r;){if(t.x>=n&&t.x<=p&&t.y>=o&&t.y<=q&&t!==e&&t!==g&&T6(h,k,i,l,j,m,t.x,t.y)&&V6(t.prev,t,t.next)>=0)return!1;t=t.prevZ}for(;u&&u.z<=s;){if(u.x>=n&&u.x<=p&&u.y>=o&&u.y<=q&&u!==e&&u!==g&&T6(h,k,i,l,j,m,u.x,u.y)&&V6(u.prev,u,u.next)>=0)return!1;u=u.nextZ}return!0}function I6(a,b,c){let d=a;do{let e=d.prev,f=d.next.next;!W6(e,f)&&X6(e,d,d.next,f)&&_6(e,f)&&_6(f,e)&&(b.push(e.i/c|0),b.push(d.i/c|0),b.push(f.i/c|0),d7(d),d7(d.next),d=a=f),d=d.next}while(d!==a);return E6(d)}function J6(a,b,c,d,e,f){let g=a;do{let h=g.next.next;for(;h!==g.prev;){if(g.i!==h.i&&U6(g,h)){let i=b7(g,h);g=E6(g,g.next),i=E6(i,i.next),F6(g,b,c,d,e,f,0),F6(i,b,c,d,e,f,0);return}h=h.next}g=g.next}while(g!==a)}function K6(a,b,c,d){let e=[],f,g,h,i,j;for(f=0,g=b.length;f<g;f++)h=b[f]*d,i=f<g-1?b[f+1]*d:a.length,j=D6(a,h,i,d,!1),j===j.next&&(j.steiner=!0),e.push(S6(j));for(e.sort(L6),f=0;f<e.length;f++)c=M6(e[f],c);return c}function L6(a,b){return a.x-b.x}function M6(a,b){let c=N6(a,b);if(!c)return b;let d=b7(c,a);return E6(d,d.next),E6(c,c.next)}function N6(a,b){let c=b,d=-1/0,e,f=a.x,g=a.y;do{if(g<=c.y&&g>=c.next.y&&c.next.y!==c.y){let h=c.x+(g-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(h<=f&&h>d&&(d=h,e=c.x<c.next.x?c:c.next,h===f))return e}c=c.next}while(c!==b);if(!e)return null;let i=e,j=e.x,k=e.y,l=1/0,m;c=e;do f>=c.x&&c.x>=j&&f!==c.x&&T6(g<k?f:d,g,j,k,g<k?d:f,g,c.x,c.y)&&(m=Math.abs(g-c.y)/(f-c.x),_6(c,a)&&(m<l||m===l&&(c.x>e.x||c.x===e.x&&O6(e,c)))&&(e=c,l=m)),c=c.next;while(c!==i);return e}function O6(a,b){return 0>V6(a.prev,a,b.prev)&&0>V6(b.next,a,a.next)}function P6(a,b,c,d){let e=a;do 0===e.z&&(e.z=R6(e.x,e.y,b,c,d)),e.prevZ=e.prev,e.nextZ=e.next,e=e.next;while(e!==a);e.prevZ.nextZ=null,e.prevZ=null,Q6(e)}function Q6(a){let b,c,d,e,f,g,h,i,j=1;do{for(c=a,a=null,f=null,g=0;c;){for(g++,d=c,h=0,b=0;b<j&&(h++,d=d.nextZ);b++);for(i=j;h>0||i>0&&d;)0!==h&&(0===i||!d||c.z<=d.z)?(e=c,c=c.nextZ,h--):(e=d,d=d.nextZ,i--),f?f.nextZ=e:a=e,e.prevZ=f,f=e;c=d}f.nextZ=null,j*=2}while(g>1);return a}function R6(a,b,c,d,e){return a=(a-c)*e|0,b=(b-d)*e|0,a=(a|a<<8)&16711935,a=(a|a<<4)&252645135,a=(a|a<<2)&858993459,a=(a|a<<1)&1431655765,b=(b|b<<8)&16711935,b=(b|b<<4)&252645135,b=(b|b<<2)&858993459,b=(b|b<<1)&1431655765,a|b<<1}function S6(a){let b=a,c=a;do(b.x<c.x||b.x===c.x&&b.y<c.y)&&(c=b),b=b.next;while(b!==a);return c}function T6(a,b,c,d,e,f,g,h){return(e-g)*(b-h)>=(a-g)*(f-h)&&(a-g)*(d-h)>=(c-g)*(b-h)&&(c-g)*(f-h)>=(e-g)*(d-h)}function U6(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!$6(a,b)&&(_6(a,b)&&_6(b,a)&&a7(a,b)&&(V6(a.prev,a,b.prev)||V6(a,b.prev,b))||W6(a,b)&&V6(a.prev,a,a.next)>0&&V6(b.prev,b,b.next)>0)}function V6(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function W6(a,b){return a.x===b.x&&a.y===b.y}function X6(a,b,c,d){let e=Z6(V6(a,b,c)),f=Z6(V6(a,b,d)),g=Z6(V6(c,d,a)),h=Z6(V6(c,d,b));return!!(e!==f&&g!==h||0===e&&Y6(a,c,b)||0===f&&Y6(a,d,b)||0===g&&Y6(c,a,d)||0===h&&Y6(c,b,d))}function Y6(a,b,c){return b.x<=Math.max(a.x,c.x)&&b.x>=Math.min(a.x,c.x)&&b.y<=Math.max(a.y,c.y)&&b.y>=Math.min(a.y,c.y)}function Z6(a){return a>0?1:a<0?-1:0}function $6(a,b){let c=a;do{if(c.i!==a.i&&c.next.i!==a.i&&c.i!==b.i&&c.next.i!==b.i&&X6(c,c.next,a,b))return!0;c=c.next}while(c!==a);return!1}function _6(a,b){return 0>V6(a.prev,a,a.next)?V6(a,b,a.next)>=0&&V6(a,a.prev,b)>=0:0>V6(a,b,a.prev)||0>V6(a,a.next,b)}function a7(a,b){let c=a,d=!1,e=(a.x+b.x)/2,f=(a.y+b.y)/2;do c.y>f!=c.next.y>f&&c.next.y!==c.y&&e<(c.next.x-c.x)*(f-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==a);return d}function b7(a,b){let c=new e7(a.i,a.x,a.y),d=new e7(b.i,b.x,b.y),e=a.next,f=b.prev;return a.next=b,b.prev=a,c.next=e,e.prev=c,d.next=c,c.prev=d,f.next=d,d.prev=f,d}function c7(a,b,c,d){let e=new e7(a,b,c);return d?(e.next=d.next,e.prev=d,d.next.prev=e,d.next=e):(e.prev=e,e.next=e),e}function d7(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function e7(a,b,c){this.i=a,this.x=b,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function f7(a,b,c,d){let e=0;for(let f=b,g=c-d;f<c;f+=d)e+=(a[g]-a[f])*(a[f+1]+a[g+1]),g=f;return e}var g7=class{static area(h7){let i7=h7.length,j7=0;for(let k7=i7-1,l7=0;l7<i7;k7=l7++)j7+=h7[k7].x*h7[l7].y-h7[l7].x*h7[k7].y;return .5*j7}static isClockWise(m7){return 0>g7.area(m7)}static triangulateShape(n7,o7){let p7=[],q7=[],r7=[];w7(n7),x7(p7,n7);let s7=n7.length;o7.forEach(w7);for(let t7=0;t7<o7.length;t7++)q7.push(s7),s7+=o7[t7].length,x7(p7,o7[t7]);let u7=C6.triangulate(p7,q7);for(let v7=0;v7<u7.length;v7+=3)r7.push(u7.slice(v7,v7+3));return r7}};function w7(a){let b=a.length;b>2&&a[b-1].equals(a[0])&&a.pop()}function x7(a,b){for(let c=0;c<b.length;c++)a.push(b[c].x),a.push(b[c].y)}var y7=class extends R5{constructor(z7=1,A7=0){let B7=(1+Math.sqrt(5))/2;super([-1,B7,0,1,B7,0,-1,-B7,0,1,-B7,0,0,-1,B7,0,1,B7,0,-1,-B7,0,1,-B7,B7,0,-1,B7,0,1,-B7,0,-1,-B7,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],z7,A7),this.type="IcosahedronGeometry",this.parameters={radius:z7,detail:A7}}static fromJSON(C7){return new y7(C7.radius,C7.detail)}},D7=class extends nE{constructor(E7=1,F7=32,G7=16,H7=0,I7=2*Math.PI,J7=0,K7=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:E7,widthSegments:F7,heightSegments:G7,phiStart:H7,phiLength:I7,thetaStart:J7,thetaLength:K7},F7=Math.max(3,Math.floor(F7)),G7=Math.max(2,Math.floor(G7));let L7=Math.min(J7+K7,Math.PI),M7=0,N7=[],O7=new fm,P7=new fm,Q7=[],R7=[],S7=[],T7=[];for(let U7=0;U7<=G7;U7++){let V7=[],W7=U7/G7,X7=0;0==U7&&0==J7?X7=.5/F7:U7==G7&&L7==Math.PI&&(X7=-0.5/F7);for(let Y7=0;Y7<=F7;Y7++){let Z7=Y7/F7;O7.x=-E7*Math.cos(H7+Z7*I7)*Math.sin(J7+W7*K7),O7.y=E7*Math.cos(J7+W7*K7),O7.z=E7*Math.sin(H7+Z7*I7)*Math.sin(J7+W7*K7),R7.push(O7.x,O7.y,O7.z),P7.copy(O7).normalize(),S7.push(P7.x,P7.y,P7.z),T7.push(Z7+X7,1-W7),V7.push(M7++)}N7.push(V7)}for(let $7=0;$7<G7;$7++)for(let _7=0;_7<F7;_7++){let a8=N7[$7][_7+1],b8=N7[$7][_7],c8=N7[$7+1][_7],d8=N7[$7+1][_7+1];(0!==$7||J7>0)&&Q7.push(a8,b8,d8),($7!==G7-1||L7<Math.PI)&&Q7.push(b8,c8,d8)}this.setIndex(Q7),this.setAttribute("position",new cE(R7,3)),this.setAttribute("normal",new cE(S7,3)),this.setAttribute("uv",new cE(T7,2))}static fromJSON(e8){return new D7(e8.radius,e8.widthSegments,e8.heightSegments,e8.phiStart,e8.phiLength,e8.thetaStart,e8.thetaLength)}},f8=class extends nE{constructor(g8=1,h8=.4,i8=12,j8=48,k8=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:g8,tube:h8,radialSegments:i8,tubularSegments:j8,arc:k8},i8=Math.floor(i8),j8=Math.floor(j8);let l8=[],m8=[],n8=[],o8=[],p8=new fm,q8=new fm,r8=new fm;for(let s8=0;s8<=i8;s8++)for(let t8=0;t8<=j8;t8++){let u8=t8/j8*k8,v8=s8/i8*Math.PI*2;q8.x=(g8+h8*Math.cos(v8))*Math.cos(u8),q8.y=(g8+h8*Math.cos(v8))*Math.sin(u8),q8.z=h8*Math.sin(v8),m8.push(q8.x,q8.y,q8.z),p8.x=g8*Math.cos(u8),p8.y=g8*Math.sin(u8),r8.subVectors(q8,p8).normalize(),n8.push(r8.x,r8.y,r8.z),o8.push(t8/j8),o8.push(s8/i8)}for(let w8=1;w8<=i8;w8++)for(let x8=1;x8<=j8;x8++){let y8=(j8+1)*w8+x8-1,z8=(j8+1)*(w8-1)+x8-1,A8=(j8+1)*(w8-1)+x8,B8=(j8+1)*w8+x8;l8.push(y8,z8,B8),l8.push(z8,A8,B8)}this.setIndex(l8),this.setAttribute("position",new cE(m8,3)),this.setAttribute("normal",new cE(n8,3)),this.setAttribute("uv",new cE(o8,2))}static fromJSON(C8){return new f8(C8.radius,C8.tube,C8.radialSegments,C8.tubularSegments,C8.arc)}},D8=class extends nE{constructor(E8=1,F8=.4,G8=64,H8=8,I8=2,J8=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:E8,tube:F8,tubularSegments:G8,radialSegments:H8,p:I8,q:J8},G8=Math.floor(G8),H8=Math.floor(H8);let K8=[],L8=[],M8=[],N8=[],O8=new fm,P8=new fm,Q8=new fm,R8=new fm,S8=new fm,T8=new fm,U8=new fm;for(let V8=0;V8<=G8;++V8){let W8=V8/G8*I8*Math.PI*2;f9(W8,I8,J8,E8,Q8),f9(W8+.01,I8,J8,E8,R8),T8.subVectors(R8,Q8),U8.addVectors(R8,Q8),S8.crossVectors(T8,U8),U8.crossVectors(S8,T8),S8.normalize(),U8.normalize();for(let X8=0;X8<=H8;++X8){let Y8=X8/H8*Math.PI*2,Z8=-F8*Math.cos(Y8),$8=F8*Math.sin(Y8);O8.x=Q8.x+(Z8*U8.x+$8*S8.x),O8.y=Q8.y+(Z8*U8.y+$8*S8.y),O8.z=Q8.z+(Z8*U8.z+$8*S8.z),L8.push(O8.x,O8.y,O8.z),P8.subVectors(O8,Q8).normalize(),M8.push(P8.x,P8.y,P8.z),N8.push(V8/G8),N8.push(X8/H8)}}for(let _8=1;_8<=G8;_8++)for(let a9=1;a9<=H8;a9++){let b9=(H8+1)*(_8-1)+(a9-1),c9=(H8+1)*_8+(a9-1),d9=(H8+1)*_8+a9,e9=(H8+1)*(_8-1)+a9;K8.push(b9,c9,e9),K8.push(c9,d9,e9)}function f9(a,b,c,d,e){let f=Math.cos(a),g=Math.sin(a),h=c/b*a,i=Math.cos(h);e.x=d*(2+i)*.5*f,e.y=d*(2+i)*g*.5,e.z=d*Math.sin(h)*.5}this.setIndex(K8),this.setAttribute("position",new cE(L8,3)),this.setAttribute("normal",new cE(M8,3)),this.setAttribute("uv",new cE(N8,2))}static fromJSON(g9){return new D8(g9.radius,g9.tube,g9.tubularSegments,g9.radialSegments,g9.p,g9.q)}};function h9(a,b,c){return j9(a)?new a.constructor(a.subarray(b,void 0!==c?c:a.length)):a.slice(b,c)}function i9(a,b,c){return a&&(c||a.constructor!==b)?"number"==typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a):a}function j9(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}function k9(a){let b=a.length,c=new Array(b);for(let d=0;d!==b;++d)c[d]=d;return c.sort(function(b,c){return a[b]-a[c]}),c}function l9(a,b,c){let d=a.length,e=new a.constructor(d);for(let f=0,g=0;g!==d;++f){let h=c[f]*b;for(let i=0;i!==b;++i)e[g++]=a[h+i]}return e}function m9(a,b,c,d){let e=1,f=a[0];for(;void 0!==f&& void 0===f[d];)f=a[e++];if(void 0===f)return;let g=f[d];if(void 0!==g)if(Array.isArray(g))do void 0!==(g=f[d])&&(b.push(f.time),c.push.apply(c,g)),f=a[e++];while(void 0!==f);else if(void 0!==g.toArray)do void 0!==(g=f[d])&&(b.push(f.time),g.toArray(c,c.length)),f=a[e++];while(void 0!==f);else do void 0!==(g=f[d])&&(b.push(f.time),c.push(g)),f=a[e++];while(void 0!==f)}var n9=class{constructor(o9,p9,q9,r9){this.parameterPositions=o9,this._cachedIndex=0,this.resultBuffer=void 0!==r9?r9:new p9.constructor(q9),this.sampleValues=p9,this.valueSize=q9,this.settings=null,this.DefaultSettings_={}}evaluate(s9){let t9=this.parameterPositions,u9=this._cachedIndex,v9=t9[u9],w9=t9[u9-1];e:{t:{let x9;r:{i:if(!(s9<v9)){for(let y9=u9+2;;){if(void 0===v9){if(s9<w9)break i;return u9=t9.length,this._cachedIndex=u9,this.copySampleValue_(u9-1)}if(u9===y9)break;if(w9=v9,s9<(v9=t9[++u9]))break t}x9=t9.length;break r}if(!(s9>=w9)){let z9=t9[1];s9<z9&&(u9=2,w9=z9);for(let A9=u9-2;;){if(void 0===w9)return this._cachedIndex=0,this.copySampleValue_(0);if(u9===A9)break;if(v9=w9,s9>=(w9=t9[--u9-1]))break t}x9=u9,u9=0;break r}break e}for(;u9<x9;){let B9=u9+x9>>>1;s9<t9[B9]?x9=B9:u9=B9+1}if(v9=t9[u9],w9=t9[u9-1],void 0===w9)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===v9)return u9=t9.length,this._cachedIndex=u9,this.copySampleValue_(u9-1)}this._cachedIndex=u9,this.intervalChanged_(u9,w9,v9)}return this.interpolate_(u9,w9,s9,v9)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(C9){let D9=this.resultBuffer,E9=this.sampleValues,F9=this.valueSize,G9=C9*F9;for(let H9=0;H9!==F9;++H9)D9[H9]=E9[G9+H9];return D9}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},I9=class extends n9{constructor(J9,K9,L9,M9){super(J9,K9,L9,M9),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Na,endingEnd:Na}}intervalChanged_(N9,O9,P9){let Q9=this.parameterPositions,R9=N9-2,S9=N9+1,T9=Q9[R9],U9=Q9[S9];if(void 0===T9)switch(this.getSettings_().endingStart){case Oa:R9=N9,T9=2*O9-P9;break;case Pa:R9=Q9.length-2,T9=O9+Q9[R9]-Q9[R9+1];break;default:R9=N9,T9=P9}if(void 0===U9)switch(this.getSettings_().endingEnd){case Oa:S9=N9,U9=2*P9-O9;break;case Pa:S9=1,U9=P9+Q9[1]-Q9[0];break;default:S9=N9-1,U9=O9}let V9=(P9-O9)*.5,W9=this.valueSize;this._weightPrev=V9/(O9-T9),this._weightNext=V9/(U9-P9),this._offsetPrev=R9*W9,this._offsetNext=S9*W9}interpolate_(X9,Y9,Z9,$9){let _9=this.resultBuffer,aaa=this.sampleValues,baa=this.valueSize,caa=X9*baa,daa=caa-baa,eaa=this._offsetPrev,faa=this._offsetNext,gaa=this._weightPrev,haa=this._weightNext,iaa=(Z9-Y9)/($9-Y9),jaa=iaa*iaa,kaa=jaa*iaa,laa=-gaa*kaa+2*gaa*jaa-gaa*iaa,maa=(1+gaa)*kaa+(-1.5-2*gaa)*jaa+(-0.5+gaa)*iaa+1,naa=(-1-haa)*kaa+(1.5+haa)*jaa+.5*iaa,oaa=haa*kaa-haa*jaa;for(let paa=0;paa!==baa;++paa)_9[paa]=laa*aaa[eaa+paa]+maa*aaa[daa+paa]+naa*aaa[caa+paa]+oaa*aaa[faa+paa];return _9}},qaa=class extends n9{constructor(raa,saa,taa,uaa){super(raa,saa,taa,uaa)}interpolate_(vaa,waa,xaa,yaa){let zaa=this.resultBuffer,Aaa=this.sampleValues,Baa=this.valueSize,Caa=vaa*Baa,Daa=Caa-Baa,Eaa=(xaa-waa)/(yaa-waa),Faa=1-Eaa;for(let Gaa=0;Gaa!==Baa;++Gaa)zaa[Gaa]=Aaa[Daa+Gaa]*Faa+Aaa[Caa+Gaa]*Eaa;return zaa}},Haa=class extends n9{constructor(Iaa,Jaa,Kaa,Laa){super(Iaa,Jaa,Kaa,Laa)}interpolate_(Maa){return this.copySampleValue_(Maa-1)}},Naa=class{constructor(Oaa,Paa,Qaa,Raa){if(void 0===Oaa)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===Paa||0===Paa.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+Oaa);this.name=Oaa,this.times=i9(Paa,this.TimeBufferType),this.values=i9(Qaa,this.ValueBufferType),this.setInterpolation(Raa||this.DefaultInterpolation)}static toJSON(Saa){let Taa=Saa.constructor,Uaa;if(Taa.toJSON!==this.toJSON)Uaa=Taa.toJSON(Saa);else{Uaa={name:Saa.name,times:i9(Saa.times,Array),values:i9(Saa.values,Array)};let Vaa=Saa.getInterpolation();Vaa!==Saa.DefaultInterpolation&&(Uaa.interpolation=Vaa)}return Uaa.type=Saa.ValueTypeName,Uaa}InterpolantFactoryMethodDiscrete(Waa){return new Haa(this.times,this.values,this.getValueSize(),Waa)}InterpolantFactoryMethodLinear(Xaa){return new qaa(this.times,this.values,this.getValueSize(),Xaa)}InterpolantFactoryMethodSmooth(Yaa){return new I9(this.times,this.values,this.getValueSize(),Yaa)}setInterpolation(Zaa){let $aa;switch(Zaa){case Ka:$aa=this.InterpolantFactoryMethodDiscrete;break;case La:$aa=this.InterpolantFactoryMethodLinear;break;case Ma:$aa=this.InterpolantFactoryMethodSmooth;break}if(void 0===$aa){let _aa="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(Zaa!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(_aa);return console.warn("THREE.KeyframeTrack:",_aa),this}return this.createInterpolant=$aa,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ka;case this.InterpolantFactoryMethodLinear:return La;case this.InterpolantFactoryMethodSmooth:return Ma}}getValueSize(){return this.values.length/this.times.length}shift(aba){if(0!==aba){let bba=this.times;for(let cba=0,dba=bba.length;cba!==dba;++cba)bba[cba]+=aba}return this}scale(eba){if(1!==eba){let fba=this.times;for(let gba=0,hba=fba.length;gba!==hba;++gba)fba[gba]*=eba}return this}trim(iba,jba){let kba=this.times,lba=kba.length,mba=0,nba=lba-1;for(;mba!==lba&&kba[mba]<iba;)++mba;for(;-1!==nba&&kba[nba]>jba;)--nba;if(++nba,0!==mba||nba!==lba){mba>=nba&&(mba=(nba=Math.max(nba,1))-1);let oba=this.getValueSize();this.times=h9(kba,mba,nba),this.values=h9(this.values,mba*oba,nba*oba)}return this}validate(){let pba=!0,qba=this.getValueSize();qba-Math.floor(qba)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),pba=!1);let rba=this.times,sba=this.values,tba=rba.length;0===tba&&(console.error("THREE.KeyframeTrack: Track is empty.",this),pba=!1);let uba=null;for(let vba=0;vba!==tba;vba++){let wba=rba[vba];if("number"==typeof wba&&isNaN(wba)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,vba,wba),pba=!1;break}if(null!==uba&&uba>wba){console.error("THREE.KeyframeTrack: Out of order keys.",this,vba,wba,uba),pba=!1;break}uba=wba}if(void 0!==sba&&j9(sba))for(let xba=0,yba=sba.length;xba!==yba;++xba){let zba=sba[xba];if(isNaN(zba)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,xba,zba),pba=!1;break}}return pba}optimize(){let Aba=h9(this.times),Bba=h9(this.values),Cba=this.getValueSize(),Dba=this.getInterpolation()===Ma,Eba=Aba.length-1,Fba=1;for(let Gba=1;Gba<Eba;++Gba){let Hba=!1,Iba=Aba[Gba];if(Iba!==Aba[Gba+1]&&(1!==Gba||Iba!==Aba[0]))if(Dba)Hba=!0;else{let Jba=Gba*Cba,Kba=Jba-Cba,Lba=Jba+Cba;for(let Mba=0;Mba!==Cba;++Mba){let Nba=Bba[Jba+Mba];if(Nba!==Bba[Kba+Mba]||Nba!==Bba[Lba+Mba]){Hba=!0;break}}}if(Hba){if(Gba!==Fba){Aba[Fba]=Aba[Gba];let Oba=Gba*Cba,Pba=Fba*Cba;for(let Qba=0;Qba!==Cba;++Qba)Bba[Pba+Qba]=Bba[Oba+Qba]}++Fba}}if(Eba>0){Aba[Fba]=Aba[Eba];for(let Rba=Eba*Cba,Sba=Fba*Cba,Tba=0;Tba!==Cba;++Tba)Bba[Sba+Tba]=Bba[Rba+Tba];++Fba}return Fba!==Aba.length?(this.times=h9(Aba,0,Fba),this.values=h9(Bba,0,Fba*Cba)):(this.times=Aba,this.values=Bba),this}clone(){let Uba=h9(this.times,0),Vba=h9(this.values,0),Wba=this.constructor,Xba=new Wba(this.name,Uba,Vba);return Xba.createInterpolant=this.createInterpolant,Xba}};Naa.prototype.TimeBufferType=Float32Array,Naa.prototype.ValueBufferType=Float32Array,Naa.prototype.DefaultInterpolation=La;var Yba=class extends Naa{};Yba.prototype.ValueTypeName="bool",Yba.prototype.ValueBufferType=Array,Yba.prototype.DefaultInterpolation=Ka,Yba.prototype.InterpolantFactoryMethodLinear=void 0,Yba.prototype.InterpolantFactoryMethodSmooth=void 0;var Zba=class extends Naa{};Zba.prototype.ValueTypeName="color";var $ba=class extends Naa{};$ba.prototype.ValueTypeName="number";var _ba=class extends n9{constructor(aca,bca,cca,dca){super(aca,bca,cca,dca)}interpolate_(eca,fca,gca,hca){let ica=this.resultBuffer,jca=this.sampleValues,kca=this.valueSize,lca=(gca-fca)/(hca-fca),mca=eca*kca;for(let nca=mca+kca;mca!==nca;mca+=4)Fj.slerpFlat(ica,0,jca,mca-kca,jca,mca,lca);return ica}},oca=class extends Naa{InterpolantFactoryMethodLinear(pca){return new _ba(this.times,this.values,this.getValueSize(),pca)}};oca.prototype.ValueTypeName="quaternion",oca.prototype.DefaultInterpolation=La,oca.prototype.InterpolantFactoryMethodSmooth=void 0;var qca=class extends Naa{};qca.prototype.ValueTypeName="string",qca.prototype.ValueBufferType=Array,qca.prototype.DefaultInterpolation=Ka,qca.prototype.InterpolantFactoryMethodLinear=void 0,qca.prototype.InterpolantFactoryMethodSmooth=void 0;var rca=class extends Naa{};rca.prototype.ValueTypeName="vector";var sca=class{constructor(tca,uca=-1,vca,wca=Qa){this.name=tca,this.tracks=vca,this.duration=uca,this.blendMode=wca,this.uuid=ub(),this.duration<0&&this.resetDuration()}static parse(xca){let yca=[],zca=xca.tracks,Aca=1/(xca.fps||1);for(let Bca=0,Cca=zca.length;Bca!==Cca;++Bca)yca.push(Pda(zca[Bca]).scale(Aca));let Dca=new this(xca.name,xca.duration,yca,xca.blendMode);return Dca.uuid=xca.uuid,Dca}static toJSON(Eca){let Fca=[],Gca=Eca.tracks,Hca={name:Eca.name,duration:Eca.duration,tracks:Fca,uuid:Eca.uuid,blendMode:Eca.blendMode};for(let Ica=0,Jca=Gca.length;Ica!==Jca;++Ica)Fca.push(Naa.toJSON(Gca[Ica]));return Hca}static CreateFromMorphTargetSequence(Kca,Lca,Mca,Nca){let Oca=Lca.length,Pca=[];for(let Qca=0;Qca<Oca;Qca++){let Rca=[],Sca=[];Rca.push((Qca+Oca-1)%Oca,Qca,(Qca+1)%Oca),Sca.push(0,1,0);let Tca=k9(Rca);Rca=l9(Rca,1,Tca),Sca=l9(Sca,1,Tca),Nca||0!==Rca[0]||(Rca.push(Oca),Sca.push(Sca[0])),Pca.push(new $ba(".morphTargetInfluences["+Lca[Qca].name+"]",Rca,Sca).scale(1/Mca))}return new this(Kca,-1,Pca)}static findByName(Uca,Vca){let Wca=Uca;if(!Array.isArray(Uca)){let Xca=Uca;Wca=Xca.geometry&&Xca.geometry.animations||Xca.animations}for(let Yca=0;Yca<Wca.length;Yca++)if(Wca[Yca].name===Vca)return Wca[Yca];return null}static CreateClipsFromMorphTargetSequences(Zca,$ca,_ca){let ada={},bda=/^([\w-]*?)([\d]+)$/;for(let cda=0,dda=Zca.length;cda<dda;cda++){let eda=Zca[cda],fda=eda.name.match(bda);if(fda&&fda.length>1){let gda=fda[1],hda=ada[gda];hda||(ada[gda]=hda=[]),hda.push(eda)}}let ida=[];for(let jda in ada)ida.push(this.CreateFromMorphTargetSequence(jda,ada[jda],$ca,_ca));return ida}static parseAnimation(kda,lda){if(!kda)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let mda=function(a,b,c,d,e){if(0!==c.length){let f=[],g=[];m9(c,f,g,d),0!==f.length&&e.push(new a(b,f,g))}},nda=[],oda=kda.name||"default",pda=kda.fps||30,qda=kda.blendMode,rda=kda.length|| -1,sda=kda.hierarchy||[];for(let tda=0;tda<sda.length;tda++){let uda=sda[tda].keys;if(!(!uda||0===uda.length))if(uda[0].morphTargets){let vda={},wda;for(wda=0;wda<uda.length;wda++)if(uda[wda].morphTargets)for(let xda=0;xda<uda[wda].morphTargets.length;xda++)vda[uda[wda].morphTargets[xda]]=-1;for(let yda in vda){let zda=[],Ada=[];for(let Bda=0;Bda!==uda[wda].morphTargets.length;++Bda){let Cda=uda[wda];zda.push(Cda.time),Ada.push(Cda.morphTarget===yda?1:0)}nda.push(new $ba(".morphTargetInfluence["+yda+"]",zda,Ada))}rda=vda.length*pda}else{let Dda=".bones["+lda[tda].name+"]";mda(rca,Dda+".position",uda,"pos",nda),mda(oca,Dda+".quaternion",uda,"rot",nda),mda(rca,Dda+".scale",uda,"scl",nda)}}return 0===nda.length?null:new this(oda,rda,nda,qda)}resetDuration(){let Eda=this.tracks,Fda=0;for(let Gda=0,Hda=Eda.length;Gda!==Hda;++Gda){let Ida=this.tracks[Gda];Fda=Math.max(Fda,Ida.times[Ida.times.length-1])}return this.duration=Fda,this}trim(){for(let Jda=0;Jda<this.tracks.length;Jda++)this.tracks[Jda].trim(0,this.duration);return this}validate(){let Kda=!0;for(let Lda=0;Lda<this.tracks.length;Lda++)Kda=Kda&&this.tracks[Lda].validate();return Kda}optimize(){for(let Mda=0;Mda<this.tracks.length;Mda++)this.tracks[Mda].optimize();return this}clone(){let Nda=[];for(let Oda=0;Oda<this.tracks.length;Oda++)Nda.push(this.tracks[Oda].clone());return new this.constructor(this.name,this.duration,Nda,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function Pda(a){if(void 0===a.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let b=function(a){switch(a.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return $ba;case"vector":case"vector2":case"vector3":case"vector4":return rca;case"color":return Zba;case"quaternion":return oca;case"bool":case"boolean":return Yba;case"string":return qca}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+a)}(a.type);if(void 0===a.times){let c=[],d=[];m9(a.keys,c,d,"value"),a.times=c,a.values=d}return void 0!==b.parse?b.parse(a):new b(a.name,a.times,a.values,a.interpolation)}var Qda={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}},Rda=class{constructor(Sda,Tda,Uda){let Vda=this,Wda=!1,Xda=0,Yda=0,Zda,$da=[];this.onStart=void 0,this.onLoad=Sda,this.onProgress=Tda,this.onError=Uda,this.itemStart=function(a){Yda++,!1===Wda&& void 0!==Vda.onStart&&Vda.onStart(a,Xda,Yda),Wda=!0},this.itemEnd=function(a){Xda++,void 0!==Vda.onProgress&&Vda.onProgress(a,Xda,Yda),Xda===Yda&&(Wda=!1,void 0!==Vda.onLoad&&Vda.onLoad())},this.itemError=function(a){void 0!==Vda.onError&&Vda.onError(a)},this.resolveURL=function(a){return Zda?Zda(a):a},this.setURLModifier=function(a){return Zda=a,this},this.addHandler=function(a,b){return $da.push(a,b),this},this.removeHandler=function(a){let b=$da.indexOf(a);return -1!==b&&$da.splice(b,2),this},this.getHandler=function(a){for(let b=0,c=$da.length;b<c;b+=2){let d=$da[b],e=$da[b+1];if(d.global&&(d.lastIndex=0),d.test(a))return e}return null}}},_da=class{constructor(aea){this.manager=void 0!==aea?aea:new Rda,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(bea,cea){let dea=this;return new Promise(function(a,b){dea.load(bea,a,cea,b)})}parse(){}setCrossOrigin(eea){return this.crossOrigin=eea,this}setWithCredentials(fea){return this.withCredentials=fea,this}setPath(gea){return this.path=gea,this}setResourcePath(hea){return this.resourcePath=hea,this}setRequestHeader(iea){return this.requestHeader=iea,this}},jea={},kea=class extends Error{constructor(lea,mea){super(lea),this.response=mea}},nea=class extends _da{constructor(oea){super(oea)}load(pea,qea,rea,sea){void 0===pea&&(pea=""),void 0!==this.path&&(pea=this.path+pea),pea=this.manager.resolveURL(pea);let tea=Qda.get(pea);if(void 0!==tea)return this.manager.itemStart(pea),setTimeout(()=>{qea&&qea(tea),this.manager.itemEnd(pea)},0),tea;if(void 0!==jea[pea]){jea[pea].push({onLoad:qea,onProgress:rea,onError:sea});return}jea[pea]=[],jea[pea].push({onLoad:qea,onProgress:rea,onError:sea});let uea=new Request(pea,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),vea=this.mimeType,wea=this.responseType;fetch(uea).then(a=>{if(200===a.status||0===a.status){if(0===a.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"|| void 0===a.body|| void 0===a.body.getReader)return a;let b=jea[pea],c=a.body.getReader(),d=a.headers.get("Content-Length")||a.headers.get("X-File-Size"),e=d?parseInt(d):0,f=0!==e,g=0,h=new ReadableStream({start(a){d();function d(){c.read().then(({done:c,value:h})=>{if(c)a.close();else{g+=h.byteLength;let i=new ProgressEvent("progress",{lengthComputable:f,loaded:g,total:e});for(let j=0,k=b.length;j<k;j++){let l=b[j];l.onProgress&&l.onProgress(i)}a.enqueue(h),d()}})}}});return new Response(h)}throw new kea(`fetch for "${a.url}" responded with ${a.status}: ${a.statusText}`,a)}).then(a=>{switch(wea){case"arraybuffer":return a.arrayBuffer();case"blob":return a.blob();case"document":return a.text().then(a=>new DOMParser().parseFromString(a,vea));case"json":return a.json();default:if(void 0===vea)return a.text();{let b=/charset="?([^;"\s]*)"?/i.exec(vea),c=b&&b[1]?b[1].toLowerCase():void 0,d=new TextDecoder(c);return a.arrayBuffer().then(a=>d.decode(a))}}}).then(a=>{Qda.add(pea,a);let b=jea[pea];delete jea[pea];for(let c=0,d=b.length;c<d;c++){let e=b[c];e.onLoad&&e.onLoad(a)}}).catch(a=>{let b=jea[pea];if(void 0===b)throw this.manager.itemError(pea),a;delete jea[pea];for(let c=0,d=b.length;c<d;c++){let e=b[c];e.onError&&e.onError(a)}this.manager.itemError(pea)}).finally(()=>{this.manager.itemEnd(pea)}),this.manager.itemStart(pea)}setResponseType(xea){return this.responseType=xea,this}setMimeType(yea){return this.mimeType=yea,this}},zea=class extends _da{constructor(Aea){super(Aea)}load(Bea,Cea,Dea,Eea){void 0!==this.path&&(Bea=this.path+Bea),Bea=this.manager.resolveURL(Bea);let Fea=this,Gea=Qda.get(Bea);if(void 0!==Gea)return Fea.manager.itemStart(Bea),setTimeout(function(){Cea&&Cea(Gea),Fea.manager.itemEnd(Bea)},0),Gea;let Hea=Ue("img");function Iea(){Kea(),Qda.add(Bea,this),Cea&&Cea(this),Fea.manager.itemEnd(Bea)}function Jea(a){Kea(),Eea&&Eea(a),Fea.manager.itemError(Bea),Fea.manager.itemEnd(Bea)}function Kea(){Hea.removeEventListener("load",Iea,!1),Hea.removeEventListener("error",Jea,!1)}return Hea.addEventListener("load",Iea,!1),Hea.addEventListener("error",Jea,!1),"data:"!==Bea.slice(0,5)&& void 0!==this.crossOrigin&&(Hea.crossOrigin=this.crossOrigin),Fea.manager.itemStart(Bea),Hea.src=Bea,Hea}},Lea=class extends _da{constructor(Mea){super(Mea)}load(Nea,Oea,Pea,Qea){let Rea=new ah,Sea=new zea(this.manager);return Sea.setCrossOrigin(this.crossOrigin),Sea.setPath(this.path),Sea.load(Nea,function(a){Rea.image=a,Rea.needsUpdate=!0,void 0!==Oea&&Oea(Rea)},Pea,Qea),Rea}},Tea=class extends Iy{constructor(Uea,Vea=1){super(),this.isLight=!0,this.type="Light",this.color=new df(Uea),this.intensity=Vea}dispose(){}copy(Wea,Xea){return super.copy(Wea,Xea),this.color.copy(Wea.color),this.intensity=Wea.intensity,this}toJSON(Yea){let Zea=super.toJSON(Yea);return Zea.object.color=this.color.getHex(),Zea.object.intensity=this.intensity,void 0!==this.groundColor&&(Zea.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(Zea.object.distance=this.distance),void 0!==this.angle&&(Zea.object.angle=this.angle),void 0!==this.decay&&(Zea.object.decay=this.decay),void 0!==this.penumbra&&(Zea.object.penumbra=this.penumbra),void 0!==this.shadow&&(Zea.object.shadow=this.shadow.toJSON()),Zea}},$ea=class extends Tea{constructor(_ea,afa,bfa){super(_ea,bfa),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Iy.DEFAULT_UP),this.updateMatrix(),this.groundColor=new df(afa)}copy(cfa,dfa){return super.copy(cfa,dfa),this.groundColor.copy(cfa.groundColor),this}},efa=new rs,ffa=new fm,gfa=new fm,hfa=class{constructor(ifa){this.camera=ifa,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Eb(512,512),this.map=null,this.mapPass=null,this.matrix=new rs,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new YL,this._frameExtents=new Eb(1,1),this._viewportCount=1,this._viewports=[new sh(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(jfa){let kfa=this.camera,lfa=this.matrix;ffa.setFromMatrixPosition(jfa.matrixWorld),kfa.position.copy(ffa),gfa.setFromMatrixPosition(jfa.target.matrixWorld),kfa.lookAt(gfa),kfa.updateMatrixWorld(),efa.multiplyMatrices(kfa.projectionMatrix,kfa.matrixWorldInverse),this._frustum.setFromProjectionMatrix(efa),lfa.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),lfa.multiply(efa)}getViewport(mfa){return this._viewports[mfa]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(nfa){return this.camera=nfa.camera.clone(),this.bias=nfa.bias,this.radius=nfa.radius,this.mapSize.copy(nfa.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let ofa={};return 0!==this.bias&&(ofa.bias=this.bias),0!==this.normalBias&&(ofa.normalBias=this.normalBias),1!==this.radius&&(ofa.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(ofa.mapSize=this.mapSize.toArray()),ofa.camera=this.camera.toJSON(!1).object,delete ofa.camera.matrix,ofa}},pfa=class extends Tea{constructor(qfa,rfa,sfa=0,tfa=Math.PI/3,ufa=0,vfa=2){super(qfa,rfa),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Iy.DEFAULT_UP),this.updateMatrix(),this.target=new Iy,this.distance=sfa,this.angle=tfa,this.penumbra=ufa,this.decay=vfa,this.map=null,this.shadow=new class extends hfa{constructor(){super(new GJ(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(wfa){let xfa=this.camera,yfa=2*tb*wfa.angle*this.focus,zfa=this.mapSize.width/this.mapSize.height,Afa=wfa.distance||xfa.far;(yfa!==xfa.fov||zfa!==xfa.aspect||Afa!==xfa.far)&&(xfa.fov=yfa,xfa.aspect=zfa,xfa.far=Afa,xfa.updateProjectionMatrix()),super.updateMatrices(wfa)}copy(Bfa){return super.copy(Bfa),this.focus=Bfa.focus,this}}}get power(){return this.intensity*Math.PI}set power(Cfa){this.intensity=Cfa/Math.PI}dispose(){this.shadow.dispose()}copy(Dfa,Efa){return super.copy(Dfa,Efa),this.distance=Dfa.distance,this.angle=Dfa.angle,this.penumbra=Dfa.penumbra,this.decay=Dfa.decay,this.target=Dfa.target.clone(),this.shadow=Dfa.shadow.clone(),this}},Ffa=new rs,Gfa=new fm,Hfa=new fm,Ifa=class extends Tea{constructor(Jfa,Kfa,Lfa=0,Mfa=2){super(Jfa,Kfa),this.isPointLight=!0,this.type="PointLight",this.distance=Lfa,this.decay=Mfa,this.shadow=new class extends hfa{constructor(){super(new GJ(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Eb(4,2),this._viewportCount=6,this._viewports=[new sh(2,1,1,1),new sh(0,1,1,1),new sh(3,1,1,1),new sh(1,1,1,1),new sh(3,0,1,1),new sh(1,0,1,1)],this._cubeDirections=[new fm(1,0,0),new fm(-1,0,0),new fm(0,0,1),new fm(0,0,-1),new fm(0,1,0),new fm(0,-1,0)],this._cubeUps=[new fm(0,1,0),new fm(0,1,0),new fm(0,1,0),new fm(0,1,0),new fm(0,0,1),new fm(0,0,-1)]}updateMatrices(Nfa,Ofa=0){let Pfa=this.camera,Qfa=this.matrix,Rfa=Nfa.distance||Pfa.far;Rfa!==Pfa.far&&(Pfa.far=Rfa,Pfa.updateProjectionMatrix()),Gfa.setFromMatrixPosition(Nfa.matrixWorld),Pfa.position.copy(Gfa),Hfa.copy(Pfa.position),Hfa.add(this._cubeDirections[Ofa]),Pfa.up.copy(this._cubeUps[Ofa]),Pfa.lookAt(Hfa),Pfa.updateMatrixWorld(),Qfa.makeTranslation(-Gfa.x,-Gfa.y,-Gfa.z),Ffa.multiplyMatrices(Pfa.projectionMatrix,Pfa.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ffa)}}}get power(){return 4*this.intensity*Math.PI}set power(Sfa){this.intensity=Sfa/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(Tfa,Ufa){return super.copy(Tfa,Ufa),this.distance=Tfa.distance,this.decay=Tfa.decay,this.shadow=Tfa.shadow.clone(),this}},Vfa=class extends Tea{constructor(Wfa,Xfa){super(Wfa,Xfa),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Iy.DEFAULT_UP),this.updateMatrix(),this.target=new Iy,this.shadow=new class extends hfa{constructor(){super(new wO(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}}dispose(){this.shadow.dispose()}copy(Yfa){return super.copy(Yfa),this.target=Yfa.target.clone(),this.shadow=Yfa.shadow.clone(),this}},Zfa=class extends nE{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy($fa){return super.copy($fa),this.instanceCount=$fa.instanceCount,this}toJSON(){let _fa=super.toJSON();return _fa.instanceCount=this.instanceCount,_fa.isInstancedBufferGeometry=!0,_fa}},aga=class extends _da{constructor(bga){super(bga)}load(cga,dga,ega,fga){let gga=this,hga=new nea(gga.manager);hga.setPath(gga.path),hga.setRequestHeader(gga.requestHeader),hga.setWithCredentials(gga.withCredentials),hga.load(cga,function(a){try{dga(gga.parse(JSON.parse(a)))}catch(b){fga?fga(b):console.error(b),gga.manager.itemError(cga)}},ega,fga)}parse(iga){let jga={},kga={};function lga(a,b){if(void 0!==jga[b])return jga[b];let c=a.interleavedBuffers[b],d=mga(a,c.buffer),e=Te(c.type,d),f=new FV(e,c.stride);return f.uuid=c.uuid,jga[b]=f,f}function mga(a,b){if(void 0!==kga[b])return kga[b];let c=a.arrayBuffers[b],d=new Uint32Array(c).buffer;return kga[b]=d,d}let nga=iga.isInstancedBufferGeometry?new Zfa:new nE,oga=iga.data.index;if(void 0!==oga){let pga=Te(oga.type,oga.array);nga.setIndex(new RC(pga,1))}let qga=iga.data.attributes;for(let rga in qga){let sga=qga[rga],tga;if(sga.isInterleavedBufferAttribute){let uga=lga(iga.data,sga.data);tga=new YV(uga,sga.itemSize,sga.offset,sga.normalized)}else{let vga=Te(sga.type,sga.array),wga=sga.isInstancedBufferAttribute?aY:RC;tga=new wga(vga,sga.itemSize,sga.normalized)}void 0!==sga.name&&(tga.name=sga.name),void 0!==sga.usage&&tga.setUsage(sga.usage),void 0!==sga.updateRange&&(tga.updateRange.offset=sga.updateRange.offset,tga.updateRange.count=sga.updateRange.count),nga.setAttribute(rga,tga)}let xga=iga.data.morphAttributes;if(xga)for(let yga in xga){let zga=xga[yga],Aga=[];for(let Bga=0,Cga=zga.length;Bga<Cga;Bga++){let Dga=zga[Bga],Ega;if(Dga.isInterleavedBufferAttribute){let Fga=lga(iga.data,Dga.data);Ega=new YV(Fga,Dga.itemSize,Dga.offset,Dga.normalized)}else{let Gga=Te(Dga.type,Dga.array);Ega=new RC(Gga,Dga.itemSize,Dga.normalized)}void 0!==Dga.name&&(Ega.name=Dga.name),Aga.push(Ega)}nga.morphAttributes[yga]=Aga}iga.data.morphTargetsRelative&&(nga.morphTargetsRelative=!0);let Hga=iga.data.groups||iga.data.drawcalls||iga.data.offsets;if(void 0!==Hga)for(let Iga=0,Jga=Hga.length;Iga!==Jga;++Iga){let Kga=Hga[Iga];nga.addGroup(Kga.start,Kga.count,Kga.materialIndex)}let Lga=iga.data.boundingSphere;if(void 0!==Lga){let Mga=new fm;void 0!==Lga.center&&Mga.fromArray(Lga.center),nga.boundingSphere=new pq(Mga,Lga.radius)}return iga.name&&(nga.name=iga.name),iga.userData&&(nga.userData=iga.userData),nga}},Nga=class{constructor(Oga=!0){this.autoStart=Oga,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Rga(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let Pga=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let Qga=Rga();Pga=(Qga-this.oldTime)/1e3,this.oldTime=Qga,this.elapsedTime+=Pga}return Pga}};function Rga(){return(typeof performance>"u"?Date:performance).now()}var Sga=class{constructor(Tga,Uga,Vga){this.binding=Tga,this.valueSize=Vga;let Wga,Xga,Yga;switch(Uga){case"quaternion":Wga=this._slerp,Xga=this._slerpAdditive,Yga=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*Vga),this._workIndex=5;break;case"string":case"bool":Wga=this._select,Xga=this._select,Yga=this._setAdditiveIdentityOther,this.buffer=new Array(5*Vga);break;default:Wga=this._lerp,Xga=this._lerpAdditive,Yga=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*Vga)}this._mixBufferRegion=Wga,this._mixBufferRegionAdditive=Xga,this._setIdentity=Yga,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(Zga,$ga){let _ga=this.buffer,aha=this.valueSize,bha=Zga*aha+aha,cha=this.cumulativeWeight;if(0===cha){for(let dha=0;dha!==aha;++dha)_ga[bha+dha]=_ga[dha];cha=$ga}else{cha+=$ga;let eha=$ga/cha;this._mixBufferRegion(_ga,bha,0,eha,aha)}this.cumulativeWeight=cha}accumulateAdditive(fha){let gha=this.buffer,hha=this.valueSize,iha=hha*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(gha,iha,0,fha,hha),this.cumulativeWeightAdditive+=fha}apply(jha){let kha=this.valueSize,lha=this.buffer,mha=jha*kha+kha,nha=this.cumulativeWeight,oha=this.cumulativeWeightAdditive,pha=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,nha<1){let qha=kha*this._origIndex;this._mixBufferRegion(lha,mha,qha,1-nha,kha)}oha>0&&this._mixBufferRegionAdditive(lha,mha,this._addIndex*kha,1,kha);for(let rha=kha,sha=kha+kha;rha!==sha;++rha)if(lha[rha]!==lha[rha+kha]){pha.setValue(lha,mha);break}}saveOriginalState(){let tha=this.binding,uha=this.buffer,vha=this.valueSize,wha=vha*this._origIndex;tha.getValue(uha,wha);for(let xha=vha,yha=wha;xha!==yha;++xha)uha[xha]=uha[wha+xha%vha];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let zha=3*this.valueSize;this.binding.setValue(this.buffer,zha)}_setAdditiveIdentityNumeric(){let Aha=this._addIndex*this.valueSize,Bha=Aha+this.valueSize;for(let Cha=Aha;Cha<Bha;Cha++)this.buffer[Cha]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let Dha=this._origIndex*this.valueSize,Eha=this._addIndex*this.valueSize;for(let Fha=0;Fha<this.valueSize;Fha++)this.buffer[Eha+Fha]=this.buffer[Dha+Fha]}_select(Gha,Hha,Iha,Jha,Kha){if(Jha>=.5)for(let Lha=0;Lha!==Kha;++Lha)Gha[Hha+Lha]=Gha[Iha+Lha]}_slerp(Mha,Nha,Oha,Pha){Fj.slerpFlat(Mha,Nha,Mha,Nha,Mha,Oha,Pha)}_slerpAdditive(Qha,Rha,Sha,Tha,Uha){let Vha=this._workIndex*Uha;Fj.multiplyQuaternionsFlat(Qha,Vha,Qha,Rha,Qha,Sha),Fj.slerpFlat(Qha,Rha,Qha,Rha,Qha,Vha,Tha)}_lerp(Wha,Xha,Yha,Zha,$ha){let _ha=1-Zha;for(let aia=0;aia!==$ha;++aia){let bia=Xha+aia;Wha[bia]=Wha[bia]*_ha+Wha[Yha+aia]*Zha}}_lerpAdditive(cia,dia,eia,fia,gia){for(let hia=0;hia!==gia;++hia){let iia=dia+hia;cia[iia]=cia[iia]+cia[eia+hia]*fia}}},jia="\\[\\]\\.:\\/",kia=new RegExp("["+jia+"]","g"),lia="[^"+jia+"]",mia="[^"+jia.replace("\\.","")+"]",nia=/((?:WC+[\/:])*)/.source.replace("WC",lia),oia=/(WCOD+)?/.source.replace("WCOD",mia),pia=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",lia),qia=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",lia),ria=new RegExp("^"+nia+oia+pia+qia+"$"),sia=["material","materials","bones","map"],tia=class{constructor(uia,via,wia){let xia=wia||Nia.parseTrackName(via);this._targetGroup=uia,this._bindings=uia.subscribe_(via,xia)}getValue(yia,zia){this.bind();let Aia=this._targetGroup.nCachedObjects_,Bia=this._bindings[Aia];void 0!==Bia&&Bia.getValue(yia,zia)}setValue(Cia,Dia){let Eia=this._bindings;for(let Fia=this._targetGroup.nCachedObjects_,Gia=Eia.length;Fia!==Gia;++Fia)Eia[Fia].setValue(Cia,Dia)}bind(){let Hia=this._bindings;for(let Iia=this._targetGroup.nCachedObjects_,Jia=Hia.length;Iia!==Jia;++Iia)Hia[Iia].bind()}unbind(){let Kia=this._bindings;for(let Lia=this._targetGroup.nCachedObjects_,Mia=Kia.length;Lia!==Mia;++Lia)Kia[Lia].unbind()}},Nia=class{constructor(Oia,Pia,Qia){this.path=Pia,this.parsedPath=Qia||Nia.parseTrackName(Pia),this.node=Nia.findNode(Oia,this.parsedPath.nodeName)||Oia,this.rootNode=Oia,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(Ria,Sia,Tia){return Ria&&Ria.isAnimationObjectGroup?new Nia.Composite(Ria,Sia,Tia):new Nia(Ria,Sia,Tia)}static sanitizeNodeName(Uia){return Uia.replace(/\s/g,"_").replace(kia,"")}static parseTrackName(Via){let Wia=ria.exec(Via);if(null===Wia)throw new Error("PropertyBinding: Cannot parse trackName: "+Via);let Xia={nodeName:Wia[2],objectName:Wia[3],objectIndex:Wia[4],propertyName:Wia[5],propertyIndex:Wia[6]},Yia=Xia.nodeName&&Xia.nodeName.lastIndexOf(".");if(void 0!==Yia&& -1!==Yia){let Zia=Xia.nodeName.substring(Yia+1);-1!==sia.indexOf(Zia)&&(Xia.nodeName=Xia.nodeName.substring(0,Yia),Xia.objectName=Zia)}if(null===Xia.propertyName||0===Xia.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+Via);return Xia}static findNode($ia,_ia){if(void 0===_ia||""===_ia||"."===_ia|| -1===_ia||_ia===$ia.name||_ia===$ia.uuid)return $ia;if($ia.skeleton){let aja=$ia.skeleton.getBoneByName(_ia);if(void 0!==aja)return aja}if($ia.children){let bja=function(a){for(let b=0;b<a.length;b++){let c=a[b];if(c.name===_ia||c.uuid===_ia)return c;let d=bja(c.children);if(d)return d}return null},cja=bja($ia.children);if(cja)return cja}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(dja,eja){dja[eja]=this.targetObject[this.propertyName]}_getValue_array(fja,gja){let hja=this.resolvedProperty;for(let ija=0,jja=hja.length;ija!==jja;++ija)fja[gja++]=hja[ija]}_getValue_arrayElement(kja,lja){kja[lja]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(mja,nja){this.resolvedProperty.toArray(mja,nja)}_setValue_direct(oja,pja){this.targetObject[this.propertyName]=oja[pja]}_setValue_direct_setNeedsUpdate(qja,rja){this.targetObject[this.propertyName]=qja[rja],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(sja,tja){this.targetObject[this.propertyName]=sja[tja],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(uja,vja){let wja=this.resolvedProperty;for(let xja=0,yja=wja.length;xja!==yja;++xja)wja[xja]=uja[vja++]}_setValue_array_setNeedsUpdate(zja,Aja){let Bja=this.resolvedProperty;for(let Cja=0,Dja=Bja.length;Cja!==Dja;++Cja)Bja[Cja]=zja[Aja++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(Eja,Fja){let Gja=this.resolvedProperty;for(let Hja=0,Ija=Gja.length;Hja!==Ija;++Hja)Gja[Hja]=Eja[Fja++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(Jja,Kja){this.resolvedProperty[this.propertyIndex]=Jja[Kja]}_setValue_arrayElement_setNeedsUpdate(Lja,Mja){this.resolvedProperty[this.propertyIndex]=Lja[Mja],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(Nja,Oja){this.resolvedProperty[this.propertyIndex]=Nja[Oja],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(Pja,Qja){this.resolvedProperty.fromArray(Pja,Qja)}_setValue_fromArray_setNeedsUpdate(Rja,Sja){this.resolvedProperty.fromArray(Rja,Sja),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(Tja,Uja){this.resolvedProperty.fromArray(Tja,Uja),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(Vja,Wja){this.bind(),this.getValue(Vja,Wja)}_setValue_unbound(Xja,Yja){this.bind(),this.setValue(Xja,Yja)}bind(){let Zja=this.node,$ja=this.parsedPath,_ja=$ja.objectName,aka=$ja.propertyName,bka=$ja.propertyIndex;if(Zja||(Zja=Nia.findNode(this.rootNode,$ja.nodeName)||this.rootNode,this.node=Zja),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!Zja){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(_ja){let cka=$ja.objectIndex;switch(_ja){case"materials":if(!Zja.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!Zja.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}Zja=Zja.material.materials;break;case"bones":if(!Zja.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}Zja=Zja.skeleton.bones;for(let dka=0;dka<Zja.length;dka++)if(Zja[dka].name===cka){cka=dka;break}break;case"map":if("map"in Zja){Zja=Zja.map;break}if(!Zja.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!Zja.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}Zja=Zja.material.map;break;default:if(void 0===Zja[_ja]){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}Zja=Zja[_ja]}if(void 0!==cka){if(void 0===Zja[cka]){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,Zja);return}Zja=Zja[cka]}}let eka=Zja[aka];if(void 0===eka){let fka=$ja.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+fka+"."+aka+" but it wasn't found.",Zja);return}let gka=this.Versioning.None;this.targetObject=Zja,void 0!==Zja.needsUpdate?gka=this.Versioning.NeedsUpdate:void 0!==Zja.matrixWorldNeedsUpdate&&(gka=this.Versioning.MatrixWorldNeedsUpdate);let hka=this.BindingType.Direct;if(void 0!==bka){if("morphTargetInfluences"===aka){if(!Zja.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!Zja.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}void 0!==Zja.morphTargetDictionary[bka]&&(bka=Zja.morphTargetDictionary[bka])}hka=this.BindingType.ArrayElement,this.resolvedProperty=eka,this.propertyIndex=bka}else void 0!==eka.fromArray&& void 0!==eka.toArray?(hka=this.BindingType.HasFromToArray,this.resolvedProperty=eka):Array.isArray(eka)?(hka=this.BindingType.EntireArray,this.resolvedProperty=eka):this.propertyName=aka;this.getValue=this.GetterByBindingType[hka],this.setValue=this.SetterByBindingTypeAndVersioning[hka][gka]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};Nia.Composite=tia,Nia.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Nia.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Nia.prototype.GetterByBindingType=[Nia.prototype._getValue_direct,Nia.prototype._getValue_array,Nia.prototype._getValue_arrayElement,Nia.prototype._getValue_toArray],Nia.prototype.SetterByBindingTypeAndVersioning=[[Nia.prototype._setValue_direct,Nia.prototype._setValue_direct_setNeedsUpdate,Nia.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Nia.prototype._setValue_array,Nia.prototype._setValue_array_setNeedsUpdate,Nia.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Nia.prototype._setValue_arrayElement,Nia.prototype._setValue_arrayElement_setNeedsUpdate,Nia.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Nia.prototype._setValue_fromArray,Nia.prototype._setValue_fromArray_setNeedsUpdate,Nia.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var ika=class{constructor(jka,kka,lka=null,mka=kka.blendMode){this._mixer=jka,this._clip=kka,this._localRoot=lka,this.blendMode=mka;let nka=kka.tracks,oka=nka.length,pka=new Array(oka),qka={endingStart:Na,endingEnd:Na};for(let rka=0;rka!==oka;++rka){let ska=nka[rka].createInterpolant(null);pka[rka]=ska,ska.settings=qka}this._interpolantSettings=qka,this._interpolants=pka,this._propertyBindings=new Array(oka),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ia,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(tka){return this._startTime=tka,this}setLoop(uka,vka){return this.loop=uka,this.repetitions=vka,this}setEffectiveWeight(wka){return this.weight=wka,this._effectiveWeight=this.enabled?wka:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(xka){return this._scheduleFading(xka,0,1)}fadeOut(yka){return this._scheduleFading(yka,1,0)}crossFadeFrom(zka,Aka,Bka){if(zka.fadeOut(Aka),this.fadeIn(Aka),Bka){let Cka=this._clip.duration,Dka=zka._clip.duration,Eka=Dka/Cka,Fka=Cka/Dka;zka.warp(1,Eka,Aka),this.warp(Fka,1,Aka)}return this}crossFadeTo(Gka,Hka,Ika){return Gka.crossFadeFrom(this,Hka,Ika)}stopFading(){let Jka=this._weightInterpolant;return null!==Jka&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(Jka)),this}setEffectiveTimeScale(Kka){return this.timeScale=Kka,this._effectiveTimeScale=this.paused?0:Kka,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(Lka){return this.timeScale=this._clip.duration/Lka,this.stopWarping()}syncWith(Mka){return this.time=Mka.time,this.timeScale=Mka.timeScale,this.stopWarping()}halt(Nka){return this.warp(this._effectiveTimeScale,0,Nka)}warp(Oka,Pka,Qka){let Rka=this._mixer,Ska=Rka.time,Tka=this.timeScale,Uka=this._timeScaleInterpolant;null===Uka&&(Uka=Rka._lendControlInterpolant(),this._timeScaleInterpolant=Uka);let Vka=Uka.parameterPositions,Wka=Uka.sampleValues;return Vka[0]=Ska,Vka[1]=Ska+Qka,Wka[0]=Oka/Tka,Wka[1]=Pka/Tka,this}stopWarping(){let Xka=this._timeScaleInterpolant;return null!==Xka&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(Xka)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(Yka,Zka,$ka,_ka){if(!this.enabled){this._updateWeight(Yka);return}let ala=this._startTime;if(null!==ala){let bla=(Yka-ala)*$ka;bla<0||0===$ka?Zka=0:(this._startTime=null,Zka=$ka*bla)}Zka*=this._updateTimeScale(Yka);let cla=this._updateTime(Zka),dla=this._updateWeight(Yka);if(dla>0){let ela=this._interpolants,fla=this._propertyBindings;switch(this.blendMode){case Ra:for(let gla=0,hla=ela.length;gla!==hla;++gla)ela[gla].evaluate(cla),fla[gla].accumulateAdditive(dla);break;case Qa:default:for(let ila=0,jla=ela.length;ila!==jla;++ila)ela[ila].evaluate(cla),fla[ila].accumulate(_ka,dla)}}}_updateWeight(kla){let lla=0;if(this.enabled){lla=this.weight;let mla=this._weightInterpolant;if(null!==mla){let nla=mla.evaluate(kla)[0];lla*=nla,kla>mla.parameterPositions[1]&&(this.stopFading(),0===nla&&(this.enabled=!1))}}return this._effectiveWeight=lla,lla}_updateTimeScale(ola){let pla=0;if(!this.paused){pla=this.timeScale;let qla=this._timeScaleInterpolant;null!==qla&&(pla*=qla.evaluate(ola)[0],ola>qla.parameterPositions[1]&&(this.stopWarping(),0===pla?this.paused=!0:this.timeScale=pla))}return this._effectiveTimeScale=pla,pla}_updateTime(rla){let sla=this._clip.duration,tla=this.loop,ula=this.time+rla,vla=this._loopCount,wla=tla===Ja;if(0===rla)return -1===vla?ula:wla&&(1&vla)==1?sla-ula:ula;if(tla===Ha){-1===vla&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(ula>=sla)ula=sla;else if(ula<0)ula=0;else{this.time=ula;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=ula,this._mixer.dispatchEvent({type:"finished",action:this,direction:rla<0?-1:1})}}else{if(-1===vla&&(rla>=0?(vla=0,this._setEndings(!0,0===this.repetitions,wla)):this._setEndings(0===this.repetitions,!0,wla)),ula>=sla||ula<0){let xla=Math.floor(ula/sla);ula-=sla*xla,vla+=Math.abs(xla);let yla=this.repetitions-vla;if(yla<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,ula=rla>0?sla:0,this.time=ula,this._mixer.dispatchEvent({type:"finished",action:this,direction:rla>0?1:-1});else{if(1===yla){let zla=rla<0;this._setEndings(zla,!zla,wla)}else this._setEndings(!1,!1,wla);this._loopCount=vla,this.time=ula,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:xla})}}else this.time=ula;if(wla&&(1&vla)==1)return sla-ula}return ula}_setEndings(Ala,Bla,Cla){let Dla=this._interpolantSettings;Cla?(Dla.endingStart=Oa,Dla.endingEnd=Oa):(Ala?Dla.endingStart=this.zeroSlopeAtStart?Oa:Na:Dla.endingStart=Pa,Bla?Dla.endingEnd=this.zeroSlopeAtEnd?Oa:Na:Dla.endingEnd=Pa)}_scheduleFading(Ela,Fla,Gla){let Hla=this._mixer,Ila=Hla.time,Jla=this._weightInterpolant;null===Jla&&(Jla=Hla._lendControlInterpolant(),this._weightInterpolant=Jla);let Kla=Jla.parameterPositions,Lla=Jla.sampleValues;return Kla[0]=Ila,Lla[0]=Fla,Kla[1]=Ila+Ela,Lla[1]=Gla,this}},Mla=new Float32Array(1),Nla=class extends ab{constructor(Ola){super(),this._root=Ola,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(Pla,Qla){let Rla=Pla._localRoot||this._root,Sla=Pla._clip.tracks,Tla=Sla.length,Ula=Pla._propertyBindings,Vla=Pla._interpolants,Wla=Rla.uuid,Xla=this._bindingsByRootAndName,Yla=Xla[Wla];void 0===Yla&&(Yla={},Xla[Wla]=Yla);for(let Zla=0;Zla!==Tla;++Zla){let $la=Sla[Zla],_la=$la.name,ama=Yla[_la];if(void 0!==ama)++ama.referenceCount,Ula[Zla]=ama;else{if(void 0!==(ama=Ula[Zla])){null===ama._cacheIndex&&(++ama.referenceCount,this._addInactiveBinding(ama,Wla,_la));continue}let bma=Qla&&Qla._propertyBindings[Zla].binding.parsedPath;ama=new Sga(Nia.create(Rla,_la,bma),$la.ValueTypeName,$la.getValueSize()),++ama.referenceCount,this._addInactiveBinding(ama,Wla,_la),Ula[Zla]=ama}Vla[Zla].resultBuffer=ama.buffer}}_activateAction(cma){if(!this._isActiveAction(cma)){if(null===cma._cacheIndex){let dma=(cma._localRoot||this._root).uuid,ema=cma._clip.uuid,fma=this._actionsByClip[ema];this._bindAction(cma,fma&&fma.knownActions[0]),this._addInactiveAction(cma,ema,dma)}let gma=cma._propertyBindings;for(let hma=0,ima=gma.length;hma!==ima;++hma){let jma=gma[hma];0==jma.useCount++&&(this._lendBinding(jma),jma.saveOriginalState())}this._lendAction(cma)}}_deactivateAction(kma){if(this._isActiveAction(kma)){let lma=kma._propertyBindings;for(let mma=0,nma=lma.length;mma!==nma;++mma){let oma=lma[mma];0== --oma.useCount&&(oma.restoreOriginalState(),this._takeBackBinding(oma))}this._takeBackAction(kma)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let pma=this;this.stats={actions:{get total(){return pma._actions.length},get inUse(){return pma._nActiveActions}},bindings:{get total(){return pma._bindings.length},get inUse(){return pma._nActiveBindings}},controlInterpolants:{get total(){return pma._controlInterpolants.length},get inUse(){return pma._nActiveControlInterpolants}}}}_isActiveAction(qma){let rma=qma._cacheIndex;return null!==rma&&rma<this._nActiveActions}_addInactiveAction(sma,tma,uma){let vma=this._actions,wma=this._actionsByClip,xma=wma[tma];if(void 0===xma)xma={knownActions:[sma],actionByRoot:{}},sma._byClipCacheIndex=0,wma[tma]=xma;else{let yma=xma.knownActions;sma._byClipCacheIndex=yma.length,yma.push(sma)}sma._cacheIndex=vma.length,vma.push(sma),xma.actionByRoot[uma]=sma}_removeInactiveAction(zma){let Ama=this._actions,Bma=Ama[Ama.length-1],Cma=zma._cacheIndex;Bma._cacheIndex=Cma,Ama[Cma]=Bma,Ama.pop(),zma._cacheIndex=null;let Dma=zma._clip.uuid,Ema=this._actionsByClip,Fma=Ema[Dma],Gma=Fma.knownActions,Hma=Gma[Gma.length-1],Ima=zma._byClipCacheIndex;Hma._byClipCacheIndex=Ima,Gma[Ima]=Hma,Gma.pop(),zma._byClipCacheIndex=null,delete Fma.actionByRoot[(zma._localRoot||this._root).uuid],0===Gma.length&&delete Ema[Dma],this._removeInactiveBindingsForAction(zma)}_removeInactiveBindingsForAction(Jma){let Kma=Jma._propertyBindings;for(let Lma=0,Mma=Kma.length;Lma!==Mma;++Lma){let Nma=Kma[Lma];0== --Nma.referenceCount&&this._removeInactiveBinding(Nma)}}_lendAction(Oma){let Pma=this._actions,Qma=Oma._cacheIndex,Rma=this._nActiveActions++,Sma=Pma[Rma];Oma._cacheIndex=Rma,Pma[Rma]=Oma,Sma._cacheIndex=Qma,Pma[Qma]=Sma}_takeBackAction(Tma){let Uma=this._actions,Vma=Tma._cacheIndex,Wma=--this._nActiveActions,Xma=Uma[Wma];Tma._cacheIndex=Wma,Uma[Wma]=Tma,Xma._cacheIndex=Vma,Uma[Vma]=Xma}_addInactiveBinding(Yma,Zma,$ma){let _ma=this._bindingsByRootAndName,ana=this._bindings,bna=_ma[Zma];void 0===bna&&(bna={},_ma[Zma]=bna),bna[$ma]=Yma,Yma._cacheIndex=ana.length,ana.push(Yma)}_removeInactiveBinding(cna){let dna=this._bindings,ena=cna.binding,fna=ena.rootNode.uuid,gna=ena.path,hna=this._bindingsByRootAndName,ina=hna[fna],jna=dna[dna.length-1],kna=cna._cacheIndex;jna._cacheIndex=kna,dna[kna]=jna,dna.pop(),delete ina[gna],0===Object.keys(ina).length&&delete hna[fna]}_lendBinding(lna){let mna=this._bindings,nna=lna._cacheIndex,ona=this._nActiveBindings++,pna=mna[ona];lna._cacheIndex=ona,mna[ona]=lna,pna._cacheIndex=nna,mna[nna]=pna}_takeBackBinding(qna){let rna=this._bindings,sna=qna._cacheIndex,tna=--this._nActiveBindings,una=rna[tna];qna._cacheIndex=tna,rna[tna]=qna,una._cacheIndex=sna,rna[sna]=una}_lendControlInterpolant(){let vna=this._controlInterpolants,wna=this._nActiveControlInterpolants++,xna=vna[wna];return void 0===xna&&((xna=new qaa(new Float32Array(2),new Float32Array(2),1,Mla)).__cacheIndex=wna,vna[wna]=xna),xna}_takeBackControlInterpolant(yna){let zna=this._controlInterpolants,Ana=yna.__cacheIndex,Bna=--this._nActiveControlInterpolants,Cna=zna[Bna];yna.__cacheIndex=Bna,zna[Bna]=yna,Cna.__cacheIndex=Ana,zna[Ana]=Cna}clipAction(Dna,Ena,Fna){let Gna=Ena||this._root,Hna=Gna.uuid,Ina="string"==typeof Dna?sca.findByName(Gna,Dna):Dna,Jna=null!==Ina?Ina.uuid:Dna,Kna=this._actionsByClip[Jna],Lna=null;if(void 0===Fna&&(Fna=null!==Ina?Ina.blendMode:Qa),void 0!==Kna){let Mna=Kna.actionByRoot[Hna];if(void 0!==Mna&&Mna.blendMode===Fna)return Mna;Lna=Kna.knownActions[0],null===Ina&&(Ina=Lna._clip)}if(null===Ina)return null;let Nna=new ika(this,Ina,Ena,Fna);return this._bindAction(Nna,Lna),this._addInactiveAction(Nna,Jna,Hna),Nna}existingAction(Ona,Pna){let Qna=Pna||this._root,Rna=Qna.uuid,Sna="string"==typeof Ona?sca.findByName(Qna,Ona):Ona,Tna=Sna?Sna.uuid:Ona,Una=this._actionsByClip[Tna];return void 0!==Una&&Una.actionByRoot[Rna]||null}stopAllAction(){let Vna=this._actions,Wna=this._nActiveActions;for(let Xna=Wna-1;Xna>=0;--Xna)Vna[Xna].stop();return this}update(Yna){Yna*=this.timeScale;let Zna=this._actions,$na=this._nActiveActions,_na=this.time+=Yna,aoa=Math.sign(Yna),boa=this._accuIndex^=1;for(let coa=0;coa!==$na;++coa)Zna[coa]._update(_na,Yna,aoa,boa);let doa=this._bindings,eoa=this._nActiveBindings;for(let foa=0;foa!==eoa;++foa)doa[foa].apply(boa);return this}setTime(goa){this.time=0;for(let hoa=0;hoa<this._actions.length;hoa++)this._actions[hoa].time=0;return this.update(goa)}getRoot(){return this._root}uncacheClip(ioa){let joa=this._actions,koa=ioa.uuid,loa=this._actionsByClip,moa=loa[koa];if(void 0!==moa){let noa=moa.knownActions;for(let ooa=0,poa=noa.length;ooa!==poa;++ooa){let qoa=noa[ooa];this._deactivateAction(qoa);let roa=qoa._cacheIndex,soa=joa[joa.length-1];qoa._cacheIndex=null,qoa._byClipCacheIndex=null,soa._cacheIndex=roa,joa[roa]=soa,joa.pop(),this._removeInactiveBindingsForAction(qoa)}delete loa[koa]}}uncacheRoot(toa){let uoa=toa.uuid,voa=this._actionsByClip;for(let woa in voa){let xoa=voa[woa].actionByRoot[uoa];void 0!==xoa&&(this._deactivateAction(xoa),this._removeInactiveAction(xoa))}let yoa=this._bindingsByRootAndName[uoa];if(void 0!==yoa)for(let zoa in yoa){let Aoa=yoa[zoa];Aoa.restoreOriginalState(),this._removeInactiveBinding(Aoa)}}uncacheAction(Boa,Coa){let Doa=this.existingAction(Boa,Coa);null!==Doa&&(this._deactivateAction(Doa),this._removeInactiveAction(Doa))}},Eoa=class{constructor(Foa){this.value=Foa}clone(){return new Eoa(void 0===this.value.clone?this.value:this.value.clone())}},Goa=class{constructor(Hoa,Ioa,Joa=0,Koa=1/0){this.ray=new $q(Hoa,Ioa),this.near=Joa,this.far=Koa,this.camera=null,this.layers=new oy,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(Loa,Moa){this.ray.set(Loa,Moa)}setFromCamera(Noa,Ooa){Ooa.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(Ooa.matrixWorld),this.ray.direction.set(Noa.x,Noa.y,.5).unproject(Ooa).sub(this.ray.origin).normalize(),this.camera=Ooa):Ooa.isOrthographicCamera?(this.ray.origin.set(Noa.x,Noa.y,(Ooa.near+Ooa.far)/(Ooa.near-Ooa.far)).unproject(Ooa),this.ray.direction.set(0,0,-1).transformDirection(Ooa.matrixWorld),this.camera=Ooa):console.error("THREE.Raycaster: Unsupported camera type: "+Ooa.type)}intersectObject(Poa,Qoa=!0,Roa=[]){return Yoa(Poa,this,Roa,Qoa),Roa.sort(Xoa),Roa}intersectObjects(Soa,Toa=!0,Uoa=[]){for(let Voa=0,Woa=Soa.length;Voa<Woa;Voa++)Yoa(Soa[Voa],this,Uoa,Toa);return Uoa.sort(Xoa),Uoa}};function Xoa(a,b){return a.distance-b.distance}function Yoa(a,b,c,d){if(a.layers.test(b.layers)&&a.raycast(b,c),!0===d){let e=a.children;for(let f=0,g=e.length;f<g;f++)Yoa(e[f],b,c,!0)}}var Zoa=class{constructor($oa=1,_oa=0,apa=0){return this.radius=$oa,this.phi=_oa,this.theta=apa,this}set(bpa,cpa,dpa){return this.radius=bpa,this.phi=cpa,this.theta=dpa,this}copy(epa){return this.radius=epa.radius,this.phi=epa.phi,this.theta=epa.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(fpa){return this.setFromCartesianCoords(fpa.x,fpa.y,fpa.z)}setFromCartesianCoords(gpa,hpa,ipa){return this.radius=Math.sqrt(gpa*gpa+hpa*hpa+ipa*ipa),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(gpa,ipa),this.phi=Math.acos(vb(hpa/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},jpa=new Eb,kpa=class{constructor(lpa=new Eb(1/0,1/0),mpa=new Eb(-1/0,-1/0)){this.isBox2=!0,this.min=lpa,this.max=mpa}set(npa,opa){return this.min.copy(npa),this.max.copy(opa),this}setFromPoints(ppa){this.makeEmpty();for(let qpa=0,rpa=ppa.length;qpa<rpa;qpa++)this.expandByPoint(ppa[qpa]);return this}setFromCenterAndSize(spa,tpa){let upa=jpa.copy(tpa).multiplyScalar(.5);return this.min.copy(spa).sub(upa),this.max.copy(spa).add(upa),this}clone(){return new this.constructor().copy(this)}copy(vpa){return this.min.copy(vpa.min),this.max.copy(vpa.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(wpa){return this.isEmpty()?wpa.set(0,0):wpa.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(xpa){return this.isEmpty()?xpa.set(0,0):xpa.subVectors(this.max,this.min)}expandByPoint(ypa){return this.min.min(ypa),this.max.max(ypa),this}expandByVector(zpa){return this.min.sub(zpa),this.max.add(zpa),this}expandByScalar(Apa){return this.min.addScalar(-Apa),this.max.addScalar(Apa),this}containsPoint(Bpa){return!(Bpa.x<this.min.x||Bpa.x>this.max.x||Bpa.y<this.min.y||Bpa.y>this.max.y)}containsBox(Cpa){return this.min.x<=Cpa.min.x&&Cpa.max.x<=this.max.x&&this.min.y<=Cpa.min.y&&Cpa.max.y<=this.max.y}getParameter(Dpa,Epa){return Epa.set((Dpa.x-this.min.x)/(this.max.x-this.min.x),(Dpa.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(Fpa){return!(Fpa.max.x<this.min.x||Fpa.min.x>this.max.x||Fpa.max.y<this.min.y||Fpa.min.y>this.max.y)}clampPoint(Gpa,Hpa){return Hpa.copy(Gpa).clamp(this.min,this.max)}distanceToPoint(Ipa){return jpa.copy(Ipa).clamp(this.min,this.max).sub(Ipa).length()}intersect(Jpa){return this.min.max(Jpa.min),this.max.min(Jpa.max),this}union(Kpa){return this.min.min(Kpa.min),this.max.max(Kpa.max),this}translate(Lpa){return this.min.add(Lpa),this.max.add(Lpa),this}equals(Mpa){return Mpa.min.equals(this.min)&&Mpa.max.equals(this.max)}},Npa=new fm,Opa=new fm,Ppa=class{constructor(Qpa=new fm,Rpa=new fm){this.start=Qpa,this.end=Rpa}set(Spa,Tpa){return this.start.copy(Spa),this.end.copy(Tpa),this}copy(Upa){return this.start.copy(Upa.start),this.end.copy(Upa.end),this}getCenter(Vpa){return Vpa.addVectors(this.start,this.end).multiplyScalar(.5)}delta(Wpa){return Wpa.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(Xpa,Ypa){return this.delta(Ypa).multiplyScalar(Xpa).add(this.start)}closestPointToPointParameter(Zpa,$pa){Npa.subVectors(Zpa,this.start),Opa.subVectors(this.end,this.start);let _pa=Opa.dot(Opa),aqa=Opa.dot(Npa)/_pa;return $pa&&(aqa=vb(aqa,0,1)),aqa}closestPointToPoint(bqa,cqa,dqa){let eqa=this.closestPointToPointParameter(bqa,cqa);return this.delta(dqa).multiplyScalar(eqa).add(this.start)}applyMatrix4(fqa){return this.start.applyMatrix4(fqa),this.end.applyMatrix4(fqa),this}equals(gqa){return gqa.start.equals(this.start)&&gqa.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},hqa=new fm,iqa=class extends Iy{constructor(jqa,kqa){super(),this.light=jqa,this.matrix=jqa.matrixWorld,this.matrixAutoUpdate=!1,this.color=kqa,this.type="SpotLightHelper";let lqa=new nE,mqa=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let nqa=0,oqa=1,pqa=32;nqa<pqa;nqa++,oqa++){let qqa=nqa/pqa*Math.PI*2,rqa=oqa/pqa*Math.PI*2;mqa.push(Math.cos(qqa),Math.sin(qqa),1,Math.cos(rqa),Math.sin(rqa),1)}lqa.setAttribute("position",new cE(mqa,3));let sqa=new JY({fog:!1,toneMapped:!1});this.cone=new IZ(lqa,sqa),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let tqa=this.light.distance?this.light.distance:1e3,uqa=tqa*Math.tan(this.light.angle);this.cone.scale.set(uqa,uqa,tqa),hqa.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(hqa),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},vqa=class extends GH{constructor(wqa,xqa,yqa){super(new D7(xqa,4,2),new MC({wireframe:!0,fog:!1,toneMapped:!1})),this.light=wqa,this.color=yqa,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},zqa=new fm,Aqa=new fm,Bqa=new fm,Cqa=class extends Iy{constructor(Dqa,Eqa,Fqa){super(),this.light=Dqa,this.matrix=Dqa.matrixWorld,this.matrixAutoUpdate=!1,this.color=Fqa,this.type="DirectionalLightHelper",void 0===Eqa&&(Eqa=1);let Gqa=new nE;Gqa.setAttribute("position",new cE([-Eqa,Eqa,0,Eqa,Eqa,0,Eqa,-Eqa,0,-Eqa,-Eqa,0,-Eqa,Eqa,0],3));let Hqa=new JY({fog:!1,toneMapped:!1});this.lightPlane=new RY(Gqa,Hqa),this.add(this.lightPlane),(Gqa=new nE).setAttribute("position",new cE([0,0,0,0,0,1],3)),this.targetLine=new RY(Gqa,Hqa),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),zqa.setFromMatrixPosition(this.light.matrixWorld),Aqa.setFromMatrixPosition(this.light.target.matrixWorld),Bqa.subVectors(Aqa,zqa),this.lightPlane.lookAt(Aqa),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Aqa),this.targetLine.scale.z=Bqa.length()}},Iqa=new fm,Jqa=new yJ,Kqa=class extends IZ{constructor(Lqa){let Mqa=new nE,Nqa=new JY({color:16777215,vertexColors:!0,toneMapped:!1}),Oqa=[],Pqa=[],Qqa={};function Rqa(a,b){Sqa(a),Sqa(b)}function Sqa(a){Oqa.push(0,0,0),Pqa.push(0,0,0),void 0===Qqa[a]&&(Qqa[a]=[]),Qqa[a].push(Oqa.length/3-1)}Rqa("n1","n2"),Rqa("n2","n4"),Rqa("n4","n3"),Rqa("n3","n1"),Rqa("f1","f2"),Rqa("f2","f4"),Rqa("f4","f3"),Rqa("f3","f1"),Rqa("n1","f1"),Rqa("n2","f2"),Rqa("n3","f3"),Rqa("n4","f4"),Rqa("p","n1"),Rqa("p","n2"),Rqa("p","n3"),Rqa("p","n4"),Rqa("u1","u2"),Rqa("u2","u3"),Rqa("u3","u1"),Rqa("c","t"),Rqa("p","c"),Rqa("cn1","cn2"),Rqa("cn3","cn4"),Rqa("cf1","cf2"),Rqa("cf3","cf4"),Mqa.setAttribute("position",new cE(Oqa,3)),Mqa.setAttribute("color",new cE(Pqa,3)),super(Mqa,Nqa),this.type="CameraHelper",this.camera=Lqa,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=Lqa.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=Qqa,this.update();let Tqa=new df(16755200),Uqa=new df(16711680),Vqa=new df(43775),Wqa=new df(16777215),Xqa=new df(3355443);this.setColors(Tqa,Uqa,Vqa,Wqa,Xqa)}setColors(Yqa,Zqa,$qa,_qa,ara){let bra=this.geometry.getAttribute("color");bra.setXYZ(0,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(1,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(2,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(3,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(4,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(5,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(6,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(7,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(8,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(9,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(10,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(11,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(12,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(13,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(14,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(15,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(16,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(17,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(18,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(19,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(20,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(21,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(22,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(23,Yqa.r,Yqa.g,Yqa.b),bra.setXYZ(24,Zqa.r,Zqa.g,Zqa.b),bra.setXYZ(25,Zqa.r,Zqa.g,Zqa.b),bra.setXYZ(26,Zqa.r,Zqa.g,Zqa.b),bra.setXYZ(27,Zqa.r,Zqa.g,Zqa.b),bra.setXYZ(28,Zqa.r,Zqa.g,Zqa.b),bra.setXYZ(29,Zqa.r,Zqa.g,Zqa.b),bra.setXYZ(30,Zqa.r,Zqa.g,Zqa.b),bra.setXYZ(31,Zqa.r,Zqa.g,Zqa.b),bra.setXYZ(32,$qa.r,$qa.g,$qa.b),bra.setXYZ(33,$qa.r,$qa.g,$qa.b),bra.setXYZ(34,$qa.r,$qa.g,$qa.b),bra.setXYZ(35,$qa.r,$qa.g,$qa.b),bra.setXYZ(36,$qa.r,$qa.g,$qa.b),bra.setXYZ(37,$qa.r,$qa.g,$qa.b),bra.setXYZ(38,_qa.r,_qa.g,_qa.b),bra.setXYZ(39,_qa.r,_qa.g,_qa.b),bra.setXYZ(40,ara.r,ara.g,ara.b),bra.setXYZ(41,ara.r,ara.g,ara.b),bra.setXYZ(42,ara.r,ara.g,ara.b),bra.setXYZ(43,ara.r,ara.g,ara.b),bra.setXYZ(44,ara.r,ara.g,ara.b),bra.setXYZ(45,ara.r,ara.g,ara.b),bra.setXYZ(46,ara.r,ara.g,ara.b),bra.setXYZ(47,ara.r,ara.g,ara.b),bra.setXYZ(48,ara.r,ara.g,ara.b),bra.setXYZ(49,ara.r,ara.g,ara.b),bra.needsUpdate=!0}update(){let cra=this.geometry,dra=this.pointMap,era=1,fra=1;Jqa.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),gra("c",dra,cra,Jqa,0,0,-1),gra("t",dra,cra,Jqa,0,0,1),gra("n1",dra,cra,Jqa,-era,-fra,-1),gra("n2",dra,cra,Jqa,era,-fra,-1),gra("n3",dra,cra,Jqa,-era,fra,-1),gra("n4",dra,cra,Jqa,era,fra,-1),gra("f1",dra,cra,Jqa,-era,-fra,1),gra("f2",dra,cra,Jqa,era,-fra,1),gra("f3",dra,cra,Jqa,-era,fra,1),gra("f4",dra,cra,Jqa,era,fra,1),gra("u1",dra,cra,Jqa,.7*era,1.1*fra,-1),gra("u2",dra,cra,Jqa,-(.7*era),1.1*fra,-1),gra("u3",dra,cra,Jqa,0,2*fra,-1),gra("cf1",dra,cra,Jqa,-era,0,1),gra("cf2",dra,cra,Jqa,era,0,1),gra("cf3",dra,cra,Jqa,0,-fra,1),gra("cf4",dra,cra,Jqa,0,fra,1),gra("cn1",dra,cra,Jqa,-era,0,-1),gra("cn2",dra,cra,Jqa,era,0,-1),gra("cn3",dra,cra,Jqa,0,-fra,-1),gra("cn4",dra,cra,Jqa,0,fra,-1),cra.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function gra(a,b,c,d,e,f,g){Iqa.set(e,f,g).unproject(d);let h=b[a];if(void 0!==h){let i=c.getAttribute("position");for(let j=0,k=h.length;j<k;j++)i.setXYZ(h[j],Iqa.x,Iqa.y,Iqa.z)}}var hra=class extends IZ{constructor(ira,jra=16776960){let kra=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),lra=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],mra=new nE;mra.setIndex(new RC(kra,1)),mra.setAttribute("position",new cE(lra,3)),super(mra,new JY({color:jra,toneMapped:!1})),this.box=ira,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(nra){let ora=this.box;ora.isEmpty()||(ora.getCenter(this.position),ora.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(nra))}dispose(){this.geometry.dispose(),this.material.dispose()}},pra=class extends IZ{constructor(qra=1){let rra=[0,0,0,qra,0,0,0,0,0,0,qra,0,0,0,0,0,0,qra],sra=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],tra=new nE;tra.setAttribute("position",new cE(rra,3)),tra.setAttribute("color",new cE(sra,3)),super(tra,new JY({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(ura,vra,wra){let xra=new df,yra=this.geometry.attributes.color.array;return xra.set(ura),xra.toArray(yra,0),xra.toArray(yra,3),xra.set(vra),xra.toArray(yra,6),xra.toArray(yra,9),xra.set(wra),xra.toArray(yra,12),xra.toArray(yra,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},zra=function(){let a=new ArrayBuffer(4),b=new Float32Array(a),c=new Uint32Array(a),d=new Uint32Array(512),e=new Uint32Array(512);for(let f=0;f<256;++f){let g=f-127;g< -27?(d[f]=0,d[256|f]=32768,e[f]=24,e[256|f]=24):g< -14?(d[f]=1024>> -g-14,d[256|f]=1024>> -g-14|32768,e[f]=-g-1,e[256|f]=-g-1):g<=15?(d[f]=g+15<<10,d[256|f]=g+15<<10|32768,e[f]=13,e[256|f]=13):g<128?(d[f]=31744,d[256|f]=64512,e[f]=24,e[256|f]=24):(d[f]=31744,d[256|f]=64512,e[f]=13,e[256|f]=13)}let h=new Uint32Array(2048),i=new Uint32Array(64),j=new Uint32Array(64);for(let k=1;k<1024;++k){let l=k<<13,m=0;for(;(8388608&l)==0;)l<<=1,m-=8388608;l&=-8388609,m+=947912704,h[k]=l|m}for(let n=1024;n<2048;++n)h[n]=939524096+(n-1024<<13);for(let o=1;o<31;++o)i[o]=o<<23;i[31]=1199570944,i[32]=2147483648;for(let p=33;p<63;++p)i[p]=2147483648+(p-32<<23);i[63]=3347054592;for(let q=1;q<64;++q)32!==q&&(j[q]=1024);return{floatView:b,uint32View:c,baseTable:d,shiftTable:e,mantissaTable:h,exponentTable:i,offsetTable:j}}(),Ara=Object.freeze({__proto__:null,fromHalfFloat:function(a){let b=a>>10;return zra.uint32View[0]=zra.mantissaTable[zra.offsetTable[b]+(1023&a)]+zra.exponentTable[b],zra.floatView[0]},toHalfFloat:function(a){Math.abs(a)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),a=vb(a,-65504,65504),zra.floatView[0]=a;let b=zra.uint32View[0],c=b>>23&511;return zra.baseTable[c]+((8388607&b)>>zra.shiftTable[c])}});"u">typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:L}})),"u">typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=L);var Bra=".",Cra=Symbol("target"),Dra=Symbol("unsubscribe");function Era(a){return a instanceof Date||a instanceof Set||a instanceof Map||a instanceof WeakSet||a instanceof WeakMap||ArrayBuffer.isView(a)}var Fra=Array.isArray;function Gra(a){return"symbol"==typeof a}var Hra={after:(a,b)=>Fra(a)?a.slice(b.length):""===b?a:a.slice(b.length+1),concat:(a,b)=>Fra(a)?(a=[...a],b&&a.push(b),a):b&& void 0!==b.toString?(""!==a&&(a+=Bra),Gra(b)?a+b.toString():a+b):a,initial:a=>{if(Fra(a))return a.slice(0,-1);if(""===a)return a;let b=a.lastIndexOf(Bra);return -1===b?"":a.slice(0,b)},last:a=>{if(Fra(a))return a[a.length-1]||"";if(""===a)return a;let b=a.lastIndexOf(Bra);return -1===b?a:a.slice(b+1)},walk:(a,b)=>{if(Fra(a))for(let c of a)b(c);else if(""!==a){let d=0,e=a.indexOf(Bra);if(-1===e)b(a);else for(;d<a.length;)-1===e&&(e=a.length),b(a.slice(d,e)),d=e+1,e=a.indexOf(Bra,d)}},get(a,b){return this.walk(b,b=>{a&&(a=a[b])}),a}};function Ira(a,b,c){return a.isUnsubscribed||b.ignoreSymbols&&Gra(c)||b.ignoreUnderscores&&"_"===c.charAt(0)||"ignoreKeys"in b&&b.ignoreKeys.includes(c)}var Jra=class{constructor(Kra){this._equals=Kra,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return void 0===this._descriptorCache&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(Lra){let Mra=this._getDescriptorCache(),Nra=Mra.get(Lra);return void 0===Nra&&(Nra={},Mra.set(Lra,Nra)),Nra}_getOwnPropertyDescriptor(Ora,Pra){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(Ora,Pra);let Qra=this._getProperties(Ora),Rra=Qra[Pra];return void 0===Rra&&(Rra=Reflect.getOwnPropertyDescriptor(Ora,Pra),Qra[Pra]=Rra),Rra}getProxy(Sra,Tra,Ura,Vra){if(this.isUnsubscribed)return Sra;let Wra=Sra[Vra],Xra=Wra||Sra;this._pathCache.set(Xra,Tra);let Yra=this._proxyCache.get(Xra);return void 0===Yra&&(Yra=void 0===Wra?new Proxy(Sra,Ura):Sra,this._proxyCache.set(Xra,Yra)),Yra}getPath(Zra){return this.isUnsubscribed?void 0:this._pathCache.get(Zra)}isDetached($ra,_ra){return!Object.is($ra,Hra.get(_ra,this.getPath($ra)))}defineProperty(asa,bsa,csa){return!!Reflect.defineProperty(asa,bsa,csa)&&(this.isUnsubscribed||(this._getProperties(asa)[bsa]=csa),!0)}setProperty(dsa,esa,fsa,gsa,hsa){if(!this._equals(hsa,fsa)||!(esa in dsa)){let isa=this._getOwnPropertyDescriptor(dsa,esa);return void 0!==isa&&"set"in isa?Reflect.set(dsa,esa,fsa,gsa):Reflect.set(dsa,esa,fsa)}return!0}deleteProperty(jsa,ksa,lsa){if(Reflect.deleteProperty(jsa,ksa)){if(!this.isUnsubscribed){let msa=this._getDescriptorCache().get(jsa);msa&&(delete msa[ksa],this._pathCache.delete(lsa))}return!0}return!1}isSameDescriptor(nsa,osa,psa){let qsa=this._getOwnPropertyDescriptor(osa,psa);return void 0!==nsa&& void 0!==qsa&&Object.is(nsa.value,qsa.value)&&(nsa.writable||!1)===(qsa.writable||!1)&&(nsa.enumerable||!1)===(qsa.enumerable||!1)&&(nsa.configurable||!1)===(qsa.configurable||!1)&&nsa.get===qsa.get&&nsa.set===qsa.set}isGetInvariant(rsa,ssa){let tsa=this._getOwnPropertyDescriptor(rsa,ssa);return void 0!==tsa&& !0!==tsa.configurable&& !0!==tsa.writable}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function usa(a){return"[object Object]"===toString.call(a)}function vsa(){return!0}function wsa(a,b){return a.length!==b.length||a.some((a,c)=>b[c]!==a)}var xsa=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),ysa=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),zsa={push:vsa,pop:vsa,shift:vsa,unshift:vsa,copyWithin:wsa,reverse:wsa,sort:wsa,splice:wsa,flat:wsa,fill:wsa},Asa=new Set([...xsa,...ysa,...Object.keys(zsa)]);function Bsa(a,b){if(a.size!==b.size)return!0;for(let c of a)if(!b.has(c))return!0;return!1}var Csa=["keys","values","entries"],Dsa=new Set(["has","toString"]),Esa={add:Bsa,clear:Bsa,delete:Bsa,forEach:Bsa},Fsa=new Set([...Dsa,...Object.keys(Esa),...Csa]);function Gsa(a,b){if(a.size!==b.size)return!0;let c;for(let[d,e]of a)if((c=b.get(d))!==e|| void 0===c&&!b.has(d))return!0;return!1}var Hsa=new Set([...Dsa,"get"]),Isa={set:Gsa,clear:Gsa,delete:Gsa,forEach:Gsa},Jsa=new Set([...Hsa,...Object.keys(Isa),...Csa]),Ksa=class{constructor(Lsa,Msa,Nsa,Osa){this._path=Msa,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=Osa,this._changes=Osa?[]:null,this.clone=void 0===Msa?Lsa:this._shallowClone(Lsa)}static isHandledMethod(Psa){return xsa.has(Psa)}_shallowClone(Qsa){let Rsa=Qsa;if(usa(Qsa))Rsa={...Qsa};else if(Fra(Qsa))Rsa=[...Qsa];else if(Qsa instanceof Date)Rsa=new Date(Qsa);else if(Qsa instanceof Set)Rsa=new Set([...Qsa].map(a=>this._shallowClone(a)));else if(Qsa instanceof Map)for(let[Ssa,Tsa]of(Rsa=new Map,Qsa.entries()))Rsa.set(Ssa,this._shallowClone(Tsa));return this._clonedCache.add(Rsa),Rsa}preferredThisArg(Usa,Vsa,Wsa,Xsa){return Usa?(Fra(Xsa)?this._onIsChanged=zsa[Vsa]:Xsa instanceof Set?this._onIsChanged=Esa[Vsa]:Xsa instanceof Map&&(this._onIsChanged=Isa[Vsa]),Xsa):Wsa}update(Ysa,Zsa,$sa){let _sa=Hra.after(Ysa,this._path);if("length"!==Zsa){let ata=this.clone;Hra.walk(_sa,a=>{ata&&ata[a]&&(this._clonedCache.has(ata[a])||(ata[a]=this._shallowClone(ata[a])),ata=ata[a])}),this._hasOnValidate&&this._changes.push({path:_sa,property:Zsa,previous:$sa}),ata&&ata[Zsa]&&(ata[Zsa]=$sa)}this._isChanged=!0}undo(bta){let cta;for(let dta=this._changes.length-1;-1!==dta;dta--)cta=this._changes[dta],Hra.get(bta,cta.path)[cta.property]=cta.previous}isChanged(eta){return void 0===this._onIsChanged?this._isChanged:this._onIsChanged(this.clone,eta)}},fta=class extends Ksa{static isHandledMethod(gta){return Asa.has(gta)}},hta=class extends Ksa{undo(ita){ita.setTime(this.clone.getTime())}isChanged(jta,kta){return!kta(this.clone.valueOf(),jta.valueOf())}},lta=class extends Ksa{static isHandledMethod(mta){return Fsa.has(mta)}undo(nta){for(let ota of this.clone)nta.add(ota);for(let pta of nta)this.clone.has(pta)||nta.delete(pta)}},qta=class extends Ksa{static isHandledMethod(rta){return Jsa.has(rta)}undo(sta){for(let[tta,uta]of this.clone.entries())sta.set(tta,uta);for(let vta of sta.keys())this.clone.has(vta)||sta.delete(vta)}},wta=class extends Ksa{constructor(xta,yta,zta,Ata){super(void 0,yta,zta,Ata),this._arg1=zta[0],this._weakValue=xta.has(this._arg1)}isChanged(Bta){return this._weakValue!==Bta.has(this._arg1)}undo(Cta){this._weakValue&&!Cta.has(this._arg1)?Cta.add(this._arg1):Cta.delete(this._arg1)}},Dta=class extends Ksa{constructor(Eta,Fta,Gta,Hta){super(void 0,Fta,Gta,Hta),this._weakKey=Gta[0],this._weakHas=Eta.has(this._weakKey),this._weakValue=Eta.get(this._weakKey)}isChanged(Ita){return this._weakValue!==Ita.get(this._weakKey)}undo(Jta){let Kta=Jta.has(this._weakKey);this._weakHas&&!Kta?Jta.set(this._weakKey,this._weakValue):!this._weakHas&&Kta?Jta.delete(this._weakKey):this._weakValue!==Jta.get(this._weakKey)&&Jta.set(this._weakKey,this._weakValue)}},Lta=class{constructor(Mta){this._stack=[],this._hasOnValidate=Mta}static isHandledType(Nta){return usa(Nta)||Fra(Nta)||Era(Nta)}static isHandledMethod(Ota,Pta){return usa(Ota)?Ksa.isHandledMethod(Pta):Fra(Ota)?fta.isHandledMethod(Pta):Ota instanceof Set?lta.isHandledMethod(Pta):Ota instanceof Map?qta.isHandledMethod(Pta):Era(Ota)}get isCloning(){return this._stack.length>0}start(Qta,Rta,Sta){let Tta=Ksa;Fra(Qta)?Tta=fta:Qta instanceof Date?Tta=hta:Qta instanceof Set?Tta=lta:Qta instanceof Map?Tta=qta:Qta instanceof WeakSet?Tta=wta:Qta instanceof WeakMap&&(Tta=Dta),this._stack.push(new Tta(Qta,Rta,Sta,this._hasOnValidate))}update(Uta,Vta,Wta){this._stack[this._stack.length-1].update(Uta,Vta,Wta)}preferredThisArg(Xta,Yta,Zta){let{name:$ta}=Xta,_ta=Lta.isHandledMethod(Zta,$ta);return this._stack[this._stack.length-1].preferredThisArg(_ta,$ta,Yta,Zta)}isChanged(aua,bua,cua){return this._stack[this._stack.length-1].isChanged(aua,bua,cua)}undo(dua){void 0!==this._previousClone&&this._previousClone.undo(dua)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},eua={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},fua=(a,b,c={})=>{c={...eua,...c};let d=Symbol("ProxyTarget"),{equals:e,isShallow:f,ignoreDetached:g,details:h}=c,i=new Jra(e),j="function"==typeof c.onValidate,k=new Lta(j),l=(a,b,d,e,f)=>!j||k.isCloning|| !0===c.onValidate(Hra.concat(i.getPath(a),b),d,e,f),m=(b,d,e,f)=>{Ira(i,c,d)||g&&i.isDetached(b,a)||n(i.getPath(b),d,e,f)},n=(a,c,d,e,f)=>{k.isCloning?k.update(a,c,e):b(Hra.concat(a,c),d,e,f)},o=a=>a&&(a[d]||a),p=(b,e,h,j)=>{var k;return("object"==typeof(k=b)?null===k:"function"!=typeof k)||k instanceof RegExp||"constructor"===h||f&&!Lta.isHandledMethod(e,h)||Ira(i,c,h)||i.isGetInvariant(e,h)||g&&i.isDetached(e,a)?b:(void 0===j&&(j=i.getPath(e)),i.getProxy(b,Hra.concat(j,h),q,d))},q={get(a,b,c){if(Gra(b)){if(b===d||b===Cra)return a;if(b===Dra&&!i.isUnsubscribed&&0===i.getPath(a).length)return i.unsubscribe(),a}return p(Era(a)?Reflect.get(a,b):Reflect.get(a,b,c),a,b)},set(a,b,c,f){c=o(c);let g=a[d]||a,h=g[b];if(e(h,c)&&b in a)return!0;let j=l(a,b,c,h);return j&&i.setProperty(g,b,c,f,h)?(m(a,b,a[b],h),!0):!j},defineProperty(a,b,c){if(!i.isSameDescriptor(c,a,b)){let d=a[b];l(a,b,c.value,d)&&i.defineProperty(a,b,c,d)&&m(a,b,c.value,d)}return!0},deleteProperty(a,b){if(!Reflect.has(a,b))return!0;let c=Reflect.get(a,b),d=l(a,b,void 0,c);return d&&i.deleteProperty(a,b,c)?(m(a,b,void 0,c),!0):!d},apply(b,c,f){let g=c[d]||c;if(i.isUnsubscribed)return Reflect.apply(b,g,f);if((!1===h|| !0!==h&&!h.includes(b.name))&&Lta.isHandledType(g)){var j;let m=Hra.initial(i.getPath(b)),r=Lta.isHandledMethod(g,b.name);k.start(g,m,f);let s=Reflect.apply(b,k.preferredThisArg(b,c,g),r?f.map(a=>o(a)):f),t=k.isChanged(g,e),u=k.stop();if(Lta.isHandledType(s)&&r&&(c instanceof Map&&"get"===b.name&&(m=Hra.concat(m,f[0])),s=i.getProxy(s,m,q)),t){let v={name:b.name,args:f,result:s},w=k.isCloning?Hra.initial(m):m,x=k.isCloning?Hra.last(m):"";l(Hra.get(a,w),x,g,u,v)?n(w,x,g,u,v):k.undo(g)}return(c instanceof Map||c instanceof Set)&&"object"==typeof(j=s)&&"function"==typeof j.next?(function(a,b,c,d,e){let f=a.next;if("entries"===b.name)a.next=function(){let a=f.call(this);return!1===a.done&&(a.value[0]=e(a.value[0],b,a.value[0],d),a.value[1]=e(a.value[1],b,a.value[0],d)),a};else if("values"===b.name){let g=c[Cra].keys();a.next=function(){let a=f.call(this);return!1===a.done&&(a.value=e(a.value,b,g.next().value,d)),a}}else a.next=function(){let a=f.call(this);return!1===a.done&&(a.value=e(a.value,b,a.value,d)),a};return a})(s,b,c,m,p):s}return Reflect.apply(b,c,f)}},r=i.getProxy(a,c.pathAsArray?[]:"",q);return b=b.bind(r),j&&(c.onValidate=c.onValidate.bind(r)),r};fua.target=a=>a&&a[Cra]||a,fua.unsubscribe=a=>a[Dra]||a;var gua=fua,hua="object"==typeof global&&global&&global.Object===Object&&global,iua="object"==typeof self&&self&&self.Object===Object&&self,jua=hua||iua||Function("return this")(),kua=jua.Symbol,lua=Object.prototype,mua=lua.hasOwnProperty,nua=lua.toString,oua=kua?kua.toStringTag:void 0,pua=function(a){var b=mua.call(a,oua),c=a[oua];try{a[oua]=void 0;var d=!0}catch{}var e=nua.call(a);return d&&(b?a[oua]=c:delete a[oua]),e},qua=Object.prototype.toString,rua=kua?kua.toStringTag:void 0,sua=function(a){var b;return null==a?void 0===a?"[object Undefined]":"[object Null]":rua&&rua in Object(a)?pua(a):(b=a,qua.call(b))},tua=function(a){return null!=a&&"object"==typeof a},uua=function(a){return"symbol"==typeof a||tua(a)&&"[object Symbol]"==sua(a)},vua=function(a,b){for(var c=-1,d=null==a?0:a.length,e=Array(d);++c<d;)e[c]=b(a[c],c,a);return e},wua=Array.isArray,xua=1/0,yua=kua?kua.prototype:void 0,zua=yua?yua.toString:void 0;function Aua(a){if("string"==typeof a)return a;if(wua(a))return vua(a,Aua)+"";if(uua(a))return zua?zua.call(a):"";var b=a+"";return"0"==b&&1/a== -xua?"-0":b}var Bua,Cua=Aua,Dua=/\s/,Eua=function(a){for(var b=a.length;b-- &&Dua.test(a.charAt(b)););return b},Fua=/^\s+/,Gua=function(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)},Hua=0/0,Iua=/^[-+]0x[0-9a-f]+$/i,Jua=/^0b[01]+$/i,Kua=/^0o[0-7]+$/i,Lua=parseInt,Mua=function(a){if("number"==typeof a)return a;if(uua(a))return Hua;if(Gua(a)){var b,c="function"==typeof a.valueOf?a.valueOf():a;a=Gua(c)?c+"":c}if("string"!=typeof a)return 0===a?a:+a;a=(b=a)&&b.slice(0,Eua(b)+1).replace(Fua,"");var d=Jua.test(a);return d||Kua.test(a)?Lua(a.slice(2),d?2:8):Iua.test(a)?Hua:+a},Nua=function(a){return a},Oua=function(a){if(!Gua(a))return!1;var b=sua(a);return"[object Function]"==b||"[object GeneratorFunction]"==b||"[object AsyncFunction]"==b||"[object Proxy]"==b},Pua=jua["__core-js_shared__"],Qua=(Bua=/[^.]+$/.exec(Pua&&Pua.keys&&Pua.keys.IE_PROTO||""))?"Symbol(src)_1."+Bua:"",Rua=Function.prototype.toString,Sua=function(a){if(null!=a){try{return Rua.call(a)}catch{}try{return a+""}catch{}}return""},Tua=/[\\^$.*+?()[\]{}|]/g,Uua=/^\[object .+?Constructor\]$/,Vua=Function.prototype,Wua=Object.prototype,Xua=Vua.toString,Yua=Wua.hasOwnProperty,Zua=RegExp("^"+Xua.call(Yua).replace(Tua,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),$ua=function(a){var b;return!!Gua(a)&&(b=a,!Qua||!(Qua in b))&&(Oua(a)?Zua:Uua).test(Sua(a))},_ua=function(a,b){var c=a?.[b];return $ua(c)?c:void 0},ava=_ua(jua,"WeakMap"),bva=Object.create,cva=function(){function a(){}return function(b){if(!Gua(b))return{};if(bva)return bva(b);a.prototype=b;var c=new a;return a.prototype=void 0,c}}(),dva=function(a,b,c){switch(c.length){case 0:return a.call(b);case 1:return a.call(b,c[0]);case 2:return a.call(b,c[0],c[1]);case 3:return a.call(b,c[0],c[1],c[2])}return a.apply(b,c)},eva=function(a,b){var c=-1,d=a.length;for(b||(b=Array(d));++c<d;)b[c]=a[c];return b},fva=16,gva=Date.now,hva=function(a){var b=0,c=0;return function(){var d=gva(),e=fva-(d-c);if(c=d,e>0){if(++b>=800)return arguments[0]}else b=0;return a.apply(void 0,arguments)}},iva=function(a){return function(){return a}},jva=function(){try{var a=_ua(Object,"defineProperty");return a({},"",{}),a}catch{}}(),kva=hva(jva?function(a,b){return jva(a,"toString",{configurable:!0,enumerable:!1,value:iva(b),writable:!0})}:Nua),lva=function(a,b){for(var c=-1,d=null==a?0:a.length;++c<d&& !1!==b(a[c],c,a););return a},mva=/^(?:0|[1-9]\d*)$/,nva=function(a,b){var c=typeof a;return!!(b=b??9007199254740991)&&("number"==c||"symbol"!=c&&mva.test(a))&&a> -1&&a%1==0&&a<b},ova=function(a,b,c){"__proto__"==b&&jva?jva(a,b,{configurable:!0,enumerable:!0,value:c,writable:!0}):a[b]=c},pva=function(a,b){return a===b||a!=a&&b!=b},qva=Object.prototype.hasOwnProperty,rva=function(a,b,c){var d=a[b];qva.call(a,b)&&pva(d,c)&&(void 0!==c||b in a)||ova(a,b,c)},sva=function(a,b,c,d){var e=!c;c||(c={});for(var f=-1,g=b.length;++f<g;){var h=b[f],i=d?d(c[h],a[h],h,c,a):void 0;void 0===i&&(i=a[h]),e?ova(c,h,i):rva(c,h,i)}return c},tva=Math.max,uva=function(a){return"number"==typeof a&&a> -1&&a%1==0&&a<=9007199254740991},vva=function(a){return null!=a&&uva(a.length)&&!Oua(a)},wva=Object.prototype,xva=function(a){var b=a&&a.constructor;return a===("function"==typeof b&&b.prototype||wva)},yva=function(a,b){for(var c=-1,d=Array(a);++c<a;)d[c]=b(c);return d},zva=function(a){return tua(a)&&"[object Arguments]"==sua(a)},Ava=Object.prototype,Bva=Ava.hasOwnProperty,Cva=Ava.propertyIsEnumerable,Dva=zva(function(){return arguments}())?zva:function(a){return tua(a)&&Bva.call(a,"callee")&&!Cva.call(a,"callee")},Eva=function(){return!1},Fva="object"==typeof exports&&exports&&!exports.nodeType&&exports,Gva=Fva&&"object"==typeof module&&module&&!module.nodeType&&module,Hva=Gva&&Gva.exports===Fva?jua.Buffer:void 0,Iva=(Hva?Hva.isBuffer:void 0)||Eva,Jva={};Jva["[object Float32Array]"]=Jva["[object Float64Array]"]=Jva["[object Int8Array]"]=Jva["[object Int16Array]"]=Jva["[object Int32Array]"]=Jva["[object Uint8Array]"]=Jva["[object Uint8ClampedArray]"]=Jva["[object Uint16Array]"]=Jva["[object Uint32Array]"]=!0,Jva["[object Arguments]"]=Jva["[object Array]"]=Jva["[object ArrayBuffer]"]=Jva["[object Boolean]"]=Jva["[object DataView]"]=Jva["[object Date]"]=Jva["[object Error]"]=Jva["[object Function]"]=Jva["[object Map]"]=Jva["[object Number]"]=Jva["[object Object]"]=Jva["[object RegExp]"]=Jva["[object Set]"]=Jva["[object String]"]=Jva["[object WeakMap]"]=!1;var Kva=function(a){return tua(a)&&uva(a.length)&&!!Jva[sua(a)]},Lva=function(a){return function(b){return a(b)}},Mva="object"==typeof exports&&exports&&!exports.nodeType&&exports,Nva=Mva&&"object"==typeof module&&module&&!module.nodeType&&module,Ova=Nva&&Nva.exports===Mva&&hua.process,Pva=function(){try{return Nva&&Nva.require&&Nva.require("util").types||Ova&&Ova.binding&&Ova.binding("util")}catch{}}(),Qva=Pva&&Pva.isTypedArray,Rva=Qva?Lva(Qva):Kva,Sva=Object.prototype.hasOwnProperty,Tva=function(a,b){var c=wua(a),d=!c&&Dva(a),e=!c&&!d&&Iva(a),f=!c&&!d&&!e&&Rva(a),g=c||d||e||f,h=g?yva(a.length,String):[],i=h.length;for(var j in a)(b||Sva.call(a,j))&&!(g&&("length"==j||e&&("offset"==j||"parent"==j)||f&&("buffer"==j||"byteLength"==j||"byteOffset"==j)||nva(j,i)))&&h.push(j);return h},Uva=function(a,b){return function(c){return a(b(c))}},Vva=Uva(Object.keys,Object),Wva=Object.prototype.hasOwnProperty,Xva=function(a){if(!xva(a))return Vva(a);var b=[];for(var c in Object(a))Wva.call(a,c)&&"constructor"!=c&&b.push(c);return b},Yva=function(a){return vva(a)?Tva(a):Xva(a)},Zva=function(a){var b=[];if(null!=a)for(var c in Object(a))b.push(c);return b},$va=Object.prototype.hasOwnProperty,_va=function(a){if(!Gua(a))return Zva(a);var b=xva(a),c=[];for(var d in a)"constructor"==d&&(b||!$va.call(a,d))||c.push(d);return c},awa=function(a){return vva(a)?Tva(a,!0):_va(a)},bwa=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,cwa=/^\w*$/,dwa=function(a,b){if(wua(a))return!1;var c=typeof a;return!!("number"==c||"symbol"==c||"boolean"==c||null==a||uua(a))||cwa.test(a)||!bwa.test(a)||null!=b&&a in Object(b)},ewa=_ua(Object,"create"),fwa=Object.prototype.hasOwnProperty,gwa=Object.prototype.hasOwnProperty;function hwa(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}hwa.prototype.clear=function(){this.__data__=ewa?ewa(null):{},this.size=0},hwa.prototype.delete=function(a){var b=this.has(a)&&delete this.__data__[a];return this.size-=b?1:0,b},hwa.prototype.get=function(a){var b=this.__data__;if(ewa){var c=b[a];return"__lodash_hash_undefined__"===c?void 0:c}return fwa.call(b,a)?b[a]:void 0},hwa.prototype.has=function(a){var b=this.__data__;return ewa?void 0!==b[a]:gwa.call(b,a)},hwa.prototype.set=function(a,b){var c=this.__data__;return this.size+=this.has(a)?0:1,c[a]=ewa&& void 0===b?"__lodash_hash_undefined__":b,this};var iwa=hwa,jwa=function(a,b){for(var c=a.length;c--;)if(pva(a[c][0],b))return c;return -1},kwa=Array.prototype.splice;function lwa(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}lwa.prototype.clear=function(){this.__data__=[],this.size=0},lwa.prototype.delete=function(a){var b=this.__data__,c=jwa(b,a);return!(c<0)&&(c==b.length-1?b.pop():kwa.call(b,c,1),--this.size,!0)},lwa.prototype.get=function(a){var b=this.__data__,c=jwa(b,a);return c<0?void 0:b[c][1]},lwa.prototype.has=function(a){return jwa(this.__data__,a)> -1},lwa.prototype.set=function(a,b){var c=this.__data__,d=jwa(c,a);return d<0?(++this.size,c.push([a,b])):c[d][1]=b,this};var mwa=lwa,nwa=_ua(jua,"Map"),owa=function(a){var b=typeof a;return"string"==b||"number"==b||"symbol"==b||"boolean"==b?"__proto__"!==a:null===a},pwa=function(a,b){var c=a.__data__;return owa(b)?c["string"==typeof b?"string":"hash"]:c.map};function qwa(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}qwa.prototype.clear=function(){this.size=0,this.__data__={hash:new iwa,map:new(nwa||mwa),string:new iwa}},qwa.prototype.delete=function(a){var b=pwa(this,a).delete(a);return this.size-=b?1:0,b},qwa.prototype.get=function(a){return pwa(this,a).get(a)},qwa.prototype.has=function(a){return pwa(this,a).has(a)},qwa.prototype.set=function(a,b){var c=pwa(this,a),d=c.size;return c.set(a,b),this.size+=c.size==d?0:1,this};var rwa=qwa;function swa(a,b){if("function"!=typeof a||null!=b&&"function"!=typeof b)throw new TypeError("Expected a function");var c=function(){var d=arguments,e=b?b.apply(this,d):d[0],f=c.cache;if(f.has(e))return f.get(e);var g=a.apply(this,d);return c.cache=f.set(e,g)||f,g};return c.cache=new(swa.Cache||rwa),c}swa.Cache=rwa;var twa=swa,uwa=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,vwa=/\\(\\)?/g,wwa=function(a){var b=twa(a,function(a){return 500===c.size&&c.clear(),a}),c=b.cache;return b}(function(a){var b=[];return 46===a.charCodeAt(0)&&b.push(""),a.replace(uwa,function(a,c,d,e){b.push(d?e.replace(vwa,"$1"):c||a)}),b}),xwa=function(a,b){var c;return wua(a)?a:dwa(a,b)?[a]:wwa(null==(c=a)?"":Cua(c))},ywa=1/0,zwa=function(a){if("string"==typeof a||uua(a))return a;var b=a+"";return"0"==b&&1/a== -ywa?"-0":b},Awa=function(a,b){b=xwa(b,a);for(var c=0,d=b.length;null!=a&&c<d;)a=a[zwa(b[c++])];return c&&c==d?a:void 0},Bwa=function(a,b){for(var c=-1,d=b.length,e=a.length;++c<d;)a[e+c]=b[c];return a},Cwa=kua?kua.isConcatSpreadable:void 0;function Dwa(a,b,c,d,e){var f=-1,g=a.length;for(c||(c=function(a){return wua(a)||Dva(a)||!!(Cwa&&a&&a[Cwa])}),e||(e=[]);++f<g;){var h=a[f];b>0&&c(h)?b>1?Dwa(h,b-1,c,d,e):Bwa(e,h):d||(e[e.length]=h)}return e}var Ewa=Dwa,Fwa=function(a){return(null==a?0:a.length)?Ewa(a,1):[]},Gwa=function(a){var b,c,d;return kva((b=a,c=void 0,d=Fwa,c=tva(void 0===c?b.length-1:c,0),function(){for(var a=arguments,e=-1,f=tva(a.length-c,0),g=Array(f);++e<f;)g[e]=a[c+e];e=-1;for(var h=Array(c+1);++e<c;)h[e]=a[e];return h[c]=d(g),dva(b,this,h)}),a+"")},Hwa=Uva(Object.getPrototypeOf,Object),Iwa=Function.prototype,Jwa=Object.prototype,Kwa=Iwa.toString,Lwa=Jwa.hasOwnProperty,Mwa=Kwa.call(Object),Nwa=function(a){if(!tua(a)||"[object Object]"!=sua(a))return!1;var b=Hwa(a);if(null===b)return!0;var c=Lwa.call(b,"constructor")&&b.constructor;return"function"==typeof c&&c instanceof c&&Kwa.call(c)==Mwa},Owa=function(a,b,c){var d=-1,e=a.length;b<0&&(b=-b>e?0:e+b),(c=c>e?e:c)<0&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Array(e);++d<e;)f[d]=a[d+b];return f};function Pwa(a){var b=this.__data__=new mwa(a);this.size=b.size}Pwa.prototype.clear=function(){this.__data__=new mwa,this.size=0},Pwa.prototype.delete=function(a){var b=this.__data__,c=b.delete(a);return this.size=b.size,c},Pwa.prototype.get=function(a){return this.__data__.get(a)},Pwa.prototype.has=function(a){return this.__data__.has(a)},Pwa.prototype.set=function(a,b){var c=this.__data__;if(c instanceof mwa){var d=c.__data__;if(!nwa||d.length<199)return d.push([a,b]),this.size=++c.size,this;c=this.__data__=new rwa(d)}return c.set(a,b),this.size=c.size,this};var Qwa=Pwa,Rwa="object"==typeof exports&&exports&&!exports.nodeType&&exports,Swa=Rwa&&"object"==typeof module&&module&&!module.nodeType&&module,Twa=Swa&&Swa.exports===Rwa?jua.Buffer:void 0,Uwa=Twa?Twa.allocUnsafe:void 0,Vwa=function(a,b){if(b)return a.slice();var c=a.length,d=Uwa?Uwa(c):new a.constructor(c);return a.copy(d),d},Wwa=function(a,b){for(var c=-1,d=null==a?0:a.length,e=0,f=[];++c<d;){var g=a[c];b(g,c,a)&&(f[e++]=g)}return f},Xwa=function(){return[]},Ywa=Object.prototype.propertyIsEnumerable,Zwa=Object.getOwnPropertySymbols,$wa=Zwa?function(a){return null==a?[]:Wwa(Zwa(a=Object(a)),function(b){return Ywa.call(a,b)})}:Xwa,_wa=Object.getOwnPropertySymbols?function(a){for(var b=[];a;)Bwa(b,$wa(a)),a=Hwa(a);return b}:Xwa,axa=function(a,b,c){var d=b(a);return wua(a)?d:Bwa(d,c(a))},bxa=function(a){return axa(a,Yva,$wa)},cxa=function(a){return axa(a,awa,_wa)},dxa=_ua(jua,"DataView"),exa=_ua(jua,"Promise"),fxa=_ua(jua,"Set"),gxa="[object Map]",hxa="[object Object]",ixa="[object Promise]",jxa="[object Set]",kxa="[object WeakMap]",lxa="[object DataView]",mxa=Sua(dxa),nxa=Sua(nwa),oxa=Sua(exa),pxa=Sua(fxa),qxa=Sua(ava),rxa=sua;(dxa&&rxa(new dxa(new ArrayBuffer(1)))!=lxa||nwa&&rxa(new nwa)!=gxa||exa&&rxa(exa.resolve())!=ixa||fxa&&rxa(new fxa)!=jxa||ava&&rxa(new ava)!=kxa)&&(rxa=function(a){var b=sua(a),c=b==hxa?a.constructor:void 0,d=c?Sua(c):"";if(d)switch(d){case mxa:return lxa;case nxa:return gxa;case oxa:return ixa;case pxa:return jxa;case qxa:return kxa}return b});var sxa=rxa,txa=Object.prototype.hasOwnProperty,uxa=function(a){var b=a.length,c=new a.constructor(b);return b&&"string"==typeof a[0]&&txa.call(a,"index")&&(c.index=a.index,c.input=a.input),c},vxa=jua.Uint8Array,wxa=function(a){var b=new a.constructor(a.byteLength);return new vxa(b).set(new vxa(a)),b},xxa=function(a,b){var c=b?wxa(a.buffer):a.buffer;return new a.constructor(c,a.byteOffset,a.byteLength)},yxa=/\w*$/,zxa=function(a){var b=new a.constructor(a.source,yxa.exec(a));return b.lastIndex=a.lastIndex,b},Axa=kua?kua.prototype:void 0,Bxa=Axa?Axa.valueOf:void 0,Cxa=function(a,b){var c=b?wxa(a.buffer):a.buffer;return new a.constructor(c,a.byteOffset,a.length)},Dxa=function(a,b,c){var d,e=a.constructor;switch(b){case"[object ArrayBuffer]":return wxa(a);case"[object Boolean]":case"[object Date]":return new e(+a);case"[object DataView]":return xxa(a,c);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Cxa(a,c);case"[object Map]":return new e;case"[object Number]":case"[object String]":return new e(a);case"[object RegExp]":return zxa(a);case"[object Set]":return new e;case"[object Symbol]":return d=a,Bxa?Object(Bxa.call(d)):{}}},Exa=function(a){return tua(a)&&"[object Map]"==sxa(a)},Fxa=Pva&&Pva.isMap,Gxa=Fxa?Lva(Fxa):Exa,Hxa=function(a){return tua(a)&&"[object Set]"==sxa(a)},Ixa=Pva&&Pva.isSet,Jxa=Ixa?Lva(Ixa):Hxa,Kxa=1,Lxa=2,Mxa=4,Nxa="[object Arguments]",Oxa="[object Function]",Pxa="[object GeneratorFunction]",Qxa="[object Object]",Rxa={};function Sxa(a,b,c,d,e,f){var g,h=b&Kxa,i=b&Lxa,j=b&Mxa;if(c&&(g=e?c(a,d,e,f):c(a)),void 0!==g)return g;if(!Gua(a))return a;var k=wua(a);if(k){if(g=uxa(a),!h)return eva(a,g)}else{var l,m,n,o,p,q,r,s,t,u=sxa(a),v=u==Oxa||u==Pxa;if(Iva(a))return Vwa(a,h);if(u==Qxa||u==Nxa||v&&!e){if(g=i||v?{}:"function"!=typeof(l=a).constructor||xva(l)?{}:cva(Hwa(l)),!h)return i?(o=a,m=g,n=a,p=m&&sva(n,awa(n),m),sva(o,_wa(o),p)):(s=a,q=g,r=a,t=q&&sva(r,Yva(r),q),sva(s,$wa(s),t))}else{if(!Rxa[u])return e?a:{};g=Dxa(a,u,h)}}f||(f=new Qwa);var w=f.get(a);if(w)return w;f.set(a,g),Jxa(a)?a.forEach(function(d){g.add(Sxa(d,b,c,d,a,f))}):Gxa(a)&&a.forEach(function(d,e){g.set(e,Sxa(d,b,c,e,a,f))});var x=j?i?cxa:bxa:i?awa:Yva,y=k?void 0:x(a);return lva(y||a,function(d,e){y&&(d=a[e=d]),rva(g,e,Sxa(d,b,c,e,a,f))}),g}Rxa[Nxa]=Rxa["[object Array]"]=Rxa["[object ArrayBuffer]"]=Rxa["[object DataView]"]=Rxa["[object Boolean]"]=Rxa["[object Date]"]=Rxa["[object Float32Array]"]=Rxa["[object Float64Array]"]=Rxa["[object Int8Array]"]=Rxa["[object Int16Array]"]=Rxa["[object Int32Array]"]=Rxa["[object Map]"]=Rxa["[object Number]"]=Rxa[Qxa]=Rxa["[object RegExp]"]=Rxa["[object Set]"]=Rxa["[object String]"]=Rxa["[object Symbol]"]=Rxa["[object Uint8Array]"]=Rxa["[object Uint8ClampedArray]"]=Rxa["[object Uint16Array]"]=Rxa["[object Uint32Array]"]=!0,Rxa["[object Error]"]=Rxa[Oxa]=Rxa["[object WeakMap]"]=!1;var Txa=Sxa,Uxa=function(a){return Txa(a,5)};function Vxa(a){var b=-1,c=null==a?0:a.length;for(this.__data__=new rwa;++b<c;)this.add(a[b])}Vxa.prototype.add=Vxa.prototype.push=function(a){return this.__data__.set(a,"__lodash_hash_undefined__"),this},Vxa.prototype.has=function(a){return this.__data__.has(a)};var Wxa=Vxa,Xxa=function(a,b){for(var c=-1,d=null==a?0:a.length;++c<d;)if(b(a[c],c,a))return!0;return!1},Yxa=function(a,b,c,d,e,f){var g=1&c,h=a.length,i=b.length;if(h!=i&&!(g&&i>h))return!1;var j=f.get(a),k=f.get(b);if(j&&k)return j==b&&k==a;var l=-1,m=!0,n=2&c?new Wxa:void 0;for(f.set(a,b),f.set(b,a);++l<h;){var o=a[l],p=b[l];if(d)var q=g?d(p,o,l,b,a,f):d(o,p,l,a,b,f);if(void 0!==q){if(q)continue;m=!1;break}if(n){if(!Xxa(b,function(a,b){var g,h;if(g=n,h=b,!g.has(h)&&(o===a||e(o,a,c,d,f)))return n.push(b)})){m=!1;break}}else if(!(o===p||e(o,p,c,d,f))){m=!1;break}}return f.delete(a),f.delete(b),m},Zxa=function(a){var b=-1,c=Array(a.size);return a.forEach(function(a,d){c[++b]=[d,a]}),c},$xa=function(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=a}),c},_xa=1,aya=kua?kua.prototype:void 0,bya=aya?aya.valueOf:void 0,cya=function(a,b,c,d,e,f,g){switch(c){case"[object DataView]":if(a.byteLength!=b.byteLength||a.byteOffset!=b.byteOffset)return!1;a=a.buffer,b=b.buffer;case"[object ArrayBuffer]":return!(a.byteLength!=b.byteLength||!f(new vxa(a),new vxa(b)));case"[object Boolean]":case"[object Date]":case"[object Number]":return pva(+a,+b);case"[object Error]":return a.name==b.name&&a.message==b.message;case"[object RegExp]":case"[object String]":return a==b+"";case"[object Map]":var h=Zxa;case"[object Set]":var i=d&_xa;if(h||(h=$xa),a.size!=b.size&&!i)return!1;var j=g.get(a);if(j)return j==b;d|=2,g.set(a,b);var k=Yxa(h(a),h(b),d,e,f,g);return g.delete(a),k;case"[object Symbol]":if(bya)return bya.call(a)==bya.call(b)}return!1},dya=1,eya=Object.prototype.hasOwnProperty,fya=function(a,b,c,d,e,f){var g=c&dya,h=bxa(a),i=h.length;if(i!=bxa(b).length&&!g)return!1;for(var j=i;j--;){var k=h[j];if(!(g?k in b:eya.call(b,k)))return!1}var l=f.get(a),m=f.get(b);if(l&&m)return l==b&&m==a;var n=!0;f.set(a,b),f.set(b,a);for(var o=g;++j<i;){var p=a[k=h[j]],q=b[k];if(d)var r=g?d(q,p,k,b,a,f):d(p,q,k,a,b,f);if(!(void 0===r?p===q||e(p,q,c,d,f):r)){n=!1;break}o||(o="constructor"==k)}if(n&&!o){var s=a.constructor,t=b.constructor;s!=t&&"constructor"in a&&"constructor"in b&&!("function"==typeof s&&s instanceof s&&"function"==typeof t&&t instanceof t)&&(n=!1)}return f.delete(a),f.delete(b),n},gya="[object Arguments]",hya="[object Array]",iya="[object Object]",jya=Object.prototype.hasOwnProperty,kya=function(a,b,c,d,e,f){var g=wua(a),h=wua(b),i=g?hya:sxa(a),j=h?hya:sxa(b);i=i==gya?iya:i,j=j==gya?iya:j;var k=i==iya,l=j==iya,m=i==j;if(m&&Iva(a)){if(!Iva(b))return!1;g=!0,k=!1}if(m&&!k)return f||(f=new Qwa),g||Rva(a)?Yxa(a,b,c,d,e,f):cya(a,b,i,c,d,e,f);if(!(1&c)){var n=k&&jya.call(a,"__wrapped__"),o=l&&jya.call(b,"__wrapped__");if(n||o){var p=n?a.value():a,q=o?b.value():b;return f||(f=new Qwa),e(p,q,c,d,f)}}return!!m&&(f||(f=new Qwa),fya(a,b,c,d,e,f))};function lya(a,b,c,d,e){return a===b||(null!=a&&null!=b&&(tua(a)||tua(b))?kya(a,b,c,d,lya,e):a!=a&&b!=b)}var mya=lya,nya=function(a,b){return null!=a&&b in Object(a)},oya=function(a,b,c){b=xwa(b,a);for(var d=-1,e=b.length,f=!1;++d<e;){var g=zwa(b[d]);if(!(f=null!=a&&c(a,g)))break;a=a[g]}return f|| ++d!=e?f:!!(e=null==a?0:a.length)&&uva(e)&&nva(g,e)&&(wua(a)||Dva(a))},pya=function(){return jua.Date.now()},qya=Math.max,rya=Math.min,sya=function(a,b,c){var d,e,f,g,h,i,j=0,k=!1,l=!1,m=!0;if("function"!=typeof a)throw new TypeError("Expected a function");function n(b){var c=d,f=e;return d=e=void 0,j=b,g=a.apply(f,c)}function o(a){var c=a-i;return void 0===i||c>=b||c<0||l&&a-j>=f}function p(){var a,c,d=pya();if(o(d))return q(d);h=setTimeout(p,(c=b-((a=d)-i),l?rya(c,f-(a-j)):c))}function q(a){return h=void 0,m&&d?n(a):(d=e=void 0,g)}function r(){var a,c=pya(),f=o(c);if(d=arguments,e=this,i=c,f){if(void 0===h)return j=a=i,h=setTimeout(p,b),k?n(a):g;if(l)return clearTimeout(h),h=setTimeout(p,b),n(i)}return void 0===h&&(h=setTimeout(p,b)),g}return b=Mua(b)||0,Gua(c)&&(k=!!c.leading,l="maxWait"in c,f=l?qya(Mua(c.maxWait)||0,b):f,m="trailing"in c?!!c.trailing:m),r.cancel=function(){void 0!==h&&clearTimeout(h),j=0,d=i=e=h=void 0},r.flush=function(){return void 0===h?g:q(pya())},r},tya=function(a){var b=null==a?0:a.length;return b?a[b-1]:void 0},uya=function(a,b){return mya(a,b)},vya=function(a,b){var c,d;return b=xwa(b,a),c=a,d=b,a=d.length<2?c:Awa(c,Owa(d,0,-1)),null==a||delete a[zwa(tya(b))]},wya=function(a){return Nwa(a)?void 0:a},xya=1,yya=2,zya=4,Aya=Gwa(function(a,b){var c={};if(null==a)return c;var d=!1;b=vua(b,function(b){return b=xwa(b,a),d||(d=b.length>1),b}),sva(a,cxa(a),c),d&&(c=Txa(c,xya|yya|zya,wya));for(var e=b.length;e--;)vya(c,b[e]);return c}),Bya=function(a,b,c,d){if(!Gua(a))return a;b=xwa(b,a);for(var e=-1,f=b.length,g=f-1,h=a;null!=h&& ++e<f;){var i=zwa(b[e]),j=c;if("__proto__"===i||"constructor"===i||"prototype"===i)return a;if(e!=g){var k=h[i];void 0===(j=d?d(k,i,h):void 0)&&(j=Gua(k)?k:nva(b[e+1])?[]:{})}rva(h,i,j),h=h[i]}return a},Cya=function(a,b,c){for(var d=-1,e=b.length,f={};++d<e;){var g=b[d],h=Awa(a,g);c(h,g)&&Bya(f,xwa(g,a),h)}return f},Dya=function(a,b){return Cya(a,b,function(b,c){var d,e;return d=a,e=c,null!=d&&oya(d,e,nya)})},Eya=Gwa(function(a,b){return null==a?{}:Dya(a,b)});function Fya(a){for(let b of Object.keys(a))void 0===a[b]&&delete a[b];return a}function Gya(a,b){return Object.setPrototypeOf(a,b),a}var Hya=()=>!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().includes(" electron/"),Iya=()=>!(typeof window>"u")&&window.navigator.platform.toUpperCase().includes("MAC"),Jya=()=>!(typeof window>"u")&&(/iPad|iPhone|iPod/.test(window.navigator.userAgent)||Qya&&"ontouchend"in document),Kya=()=>!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().indexOf("firefox")> -1,Lya=()=>!(typeof window>"u")&&("ontouchstart"in window||navigator.maxTouchPoints>0),Mya=()=>{if(typeof window>"u")return!1;let a=navigator.userAgent,b=navigator.vendor;return/Safari/i.test(a)&&/Apple Computer/.test(b)},Nya=()=>{if(typeof window>"u")return null;let a=navigator.userAgent.match(/Version\/(\d+\.\d)/);return a&&a[1]},Oya=()=>{if(typeof window>"u")return;let a=new URLSearchParams(window.location.search).get("desktop-app-version");return a?(window.localStorage.setItem("desktop-app-version",a),a):window.localStorage.getItem("desktop-app-version")??"0.0.6"},Pya=Hya()?Oya():void 0,Qya=Iya(),Rya=Jya(),Sya=Kya(),Tya=Lya(),Uya=Mya(),Vya=Number(Nya());function Wya(a){return Array.isArray(a)?a:[a]}function Xya(a,b){let c=0;for(;c<a.length&&c<b.length;){if(a[c]<b[c])return -1;if(a[c]>b[c])return 1;c+=1}return c!==b.length?-1:c!==a.length?1:0}function Yya(a){return Qya?a.metaKey:a.ctrlKey}var Zya=[],$ya={},_ya={},aza={};function bza(a){Zya.includes(a)||Zya.push(a)}function cza(a){delete $ya[a.pointerId];for(let b=0;b<Zya.length;b++)if(Zya[b].pointerId===a.pointerId){Zya.splice(b,1);break}}function dza(a){if("touch"!==a.pointerType)return;let b=$ya[a.pointerId];void 0===b&&(b={x:0,y:0},$ya[a.pointerId]=b),b.x=a.pageX,b.y=a.pageY}function eza(a){return $ya[(a.pointerId===Zya[0].pointerId?Zya[1]:Zya[0]).pointerId]}function fza(a){_ya[a.key]=!0,aza[a.key]=void 0===aza[a.key]?1:aza[a.key]+1}function gza(a){if(Qya&&_ya.Meta)for(let b in _ya)_ya[b]=!1;else _ya[a.key]=!1;aza={}}var hza,iza,jza,kza=new Promise(a=>{hza=a}),lza=new Promise(a=>{jza=a}),mza=class{modifyById(nza,oza){let pza=this;if(void 0===pza[nza])throw new Error("not expected");{let qza={...pza,[nza]:oza};return Object.setPrototypeOf(qza,mza.prototype),qza}}add(rza,sza){return this.runOp({type:1,id:rza,data:sza})?.data??this}runOp(tza){let uza=this;if(1===tza.type){let vza=uza[tza.id],wza;wza=void 0===vza?{type:2,id:tza.id}:{type:1,id:tza.id,data:vza};let{id:xza,data:yza}=tza,zza={...uza,[xza]:yza};return Object.setPrototypeOf(zza,mza.prototype),{data:zza,actual:tza,reverse:wza}}if(2===tza.type){let{id:Aza}=tza,Bza=uza[Aza];if(void 0===Bza)return null;{let Cza={...uza};return Object.setPrototypeOf(Cza,mza.prototype),delete Cza[Aza],{data:Cza,actual:tza,reverse:{type:1,id:Aza,data:Bza}}}}return null}};function Dza(a){if(void 0!==a.deepFreeze){a.deepFreeze(a);return}let b=Object.getOwnPropertyNames(a);for(let c of b){let d=a[c];d&&"object"==typeof d&&Dza(d)}return Object.freeze(a)}var Eza=class extends Error{};function Fza(a){let b={...a};return Object.setPrototypeOf(b,Object.getPrototypeOf(a)),b}function Gza(a,b,c){if(void 0===a?void 0===b?(a=0,b=10):a=b-10:void 0===b&&(b=a+10),a>b){let d=a;a=b,b=d}let e=[],f=1/(c+1);for(let g=0;g<c;g++){let h=a+(b-a)*(g+.75+.5*Math.random())*f;e.push(h)}return e}function Hza(a){return a instanceof Uint8Array||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Float32Array||a instanceof Float64Array}function Iza(a,b){for(let c of a)!0!==b(c.id,c.data)&&Iza(c.children,b)}function Jza(a,b){if(!0!==b(a.id,a.data))for(let c of a.children)Jza(c,b)}var Kza=class extends Array{constructor(...Lza){super(...Lza),Object.setPrototypeOf(this,Kza.prototype)}deepFreeze(){let Mza=0;for(;Mza<this.length;)Dza(this[Mza]),Mza++}fillCaches0(Nza,Oza){for(let Pza of(this.objCaches.set(Nza.id,Nza),this.parentCaches.set(Nza.id,Oza),Nza.children))this.fillCaches0(Pza,Nza.id)}fillCaches(){if(void 0===this.objCaches)for(let Qza of(this.objCaches=new Map,this.parentCaches=new Map,this))this.fillCaches0(Qza,null)}randomId(){this.fillCaches();let Rza=Array.from(this.objCaches.keys());if(0!==Rza.length)return Rza[Math.max(0,Math.floor(Math.random()*Rza.length)-1)]}nonExistOrDescendantOf(Sza,Tza){if(!this.has(Sza))return!0;for(;Sza;){let Uza=this.parent(Sza);if(Uza===Tza)return!0;Sza=Uza}return!1}rootAcestor(Vza){for(;Vza;){let Wza=this.parent(Vza);if(!Wza)return Vza;Vza=Wza}return Vza}isDescendantOf(Xza,Yza){for(;Xza;){let Zza=this.parent(Xza);if(Zza===Yza)return!0;Xza=Zza}return!1}data($za){return this.get($za)?.data}has(_za){return void 0!==this.childrenOf(_za)}get(aAa){return this.fillCaches(),this.objCaches.get(aAa)}childrenOf(bAa){return null===bAa?this:this.get(bAa)?.children}traverseFrom(cAa,dAa){if(null===cAa)this.traverse(dAa);else{let eAa=this.get(cAa);eAa&&Jza(eAa,dAa)}}traverse(fAa){Iza(this,fAa)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(gAa){return this.fillCaches(),this.parentCaches.get(gAa)}childrenArray(hAa){return null===hAa?this:this.get(hAa).children}modifyById(iAa,jAa){if(void 0===this.get(iAa))throw new Error("not expected");{let kAa=this.parent(iAa),lAa=this.childrenArray(kAa),mAa=lAa.findIndex(a=>a.id===iAa);if(mAa<0)throw new Error("not expected");let nAa=lAa[mAa];return(lAa=[...lAa])[mAa]={...nAa,data:jAa},this.modifyArrayBy(kAa,lAa)}}modifyArrayBy(oAa,pAa){let qAa=oAa,rAa=pAa;for(;null!==qAa;){let sAa=rAa,tAa=qAa;if(void 0===(qAa=this.parent(qAa)))throw new Error;let uAa=(rAa=this.childrenArray(qAa)).findIndex(a=>a.id===tAa);if(uAa<0)throw new Error;(rAa=[...rAa])[uAa]={...rAa[uAa],children:sAa}}Object.setPrototypeOf(rAa,Kza.prototype);let vAa=rAa;return vAa.fillCaches(),vAa}runOp(wAa){switch(wAa.type){case 7:return this.addOp(wAa);case 8:return this.deleteOp(wAa);case 9:return this.moveOp(wAa)}return null}checkDuplicatedIdRec({id:xAa,children:yAa}){if(void 0!==this.get(xAa))return!0;for(let zAa of yAa)if(this.checkDuplicatedIdRec(zAa))return!0;return!1}addOp(AAa){let{parent:BAa,fi:CAa,id:DAa,data:EAa,children:FAa}=AAa;if(null!==BAa&& void 0===this.get(BAa))return null;if(this.checkDuplicatedIdRec(AAa))return null;{let GAa=BAa,HAa=this.childrenArray(GAa),IAa={fi:CAa,id:DAa,data:EAa,children:FAa};return(HAa=[...HAa,IAa]).sort((a,b)=>a.fi-b.fi),AAa.localIndex=HAa.indexOf(IAa),{data:this.modifyArrayBy(GAa,HAa),actual:AAa,reverse:{type:8,id:DAa}}}}deleteOp(JAa){let{id:KAa}=JAa;if(null===this.get(KAa))return null;{let LAa=this.parent(KAa);if(void 0===LAa)return null;let MAa=this.childrenArray(LAa),NAa=MAa.findIndex(a=>a.id===KAa);JAa.localIndex=NAa;let OAa=(MAa=[...MAa]).splice(NAa,1)[0];return{data:this.modifyArrayBy(LAa,MAa),actual:JAa,reverse:{type:7,...OAa,parent:LAa}}}}moveOp(PAa){let{parent:QAa,fi:RAa,id:SAa}=PAa;if(null!==QAa&& void 0===this.get(QAa))return this.deleteOp({type:8,id:SAa});if(null!==QAa){let TAa=QAa;for(;null!==TAa;){if(void 0===TAa)throw new Error;if(TAa===SAa)throw new Eza("cyclic tree");TAa=this.parent(TAa)}}let UAa=this.parent(SAa);if(void 0===UAa)return null;let VAa=UAa,WAa=this.childrenArray(UAa),XAa=WAa.findIndex(a=>a.id===SAa);WAa=[...WAa];let YAa=WAa.splice(XAa,1)[0],ZAa=this.modifyArrayBy(UAa,WAa);UAa=QAa,WAa=ZAa.childrenArray(UAa);let $Aa=YAa.fi;return(WAa=[...WAa,YAa={...YAa,fi:RAa}]).sort((a,b)=>a.fi-b.fi),PAa.localIndex=WAa.indexOf(YAa),{data:ZAa=ZAa.modifyArrayBy(UAa,WAa),actual:PAa,reverse:{type:9,parent:VAa,fi:$Aa,id:SAa}}}previous(_Aa,aBa){if(null===aBa){let bBa=this.childrenArray(_Aa);return 0===bBa.length?null:bBa[bBa.length-1].id}let cBa=null;for(let dBa of this.childrenArray(_Aa)){if(dBa.id===aBa)return cBa;cBa=dBa.id}return null}traverseSortNext(eBa){let fBa=this.parent(eBa);if(void 0!==fBa){let gBa=this.childrenArray(fBa),hBa=gBa.findIndex(a=>a.id===eBa)+1;if(hBa<gBa.length)return gBa[hBa].id;if(fBa)return this.traverseSortNext(fBa)}}sortNext(iBa){let jBa=this.childrenArray(iBa);return jBa.length>0?jBa[0].id:this.traverseSortNext(iBa)}traverseSortPrevious(kBa){let lBa=this.childrenArray(kBa);return lBa.length>0?this.traverseSortPrevious(lBa[lBa.length-1].id):kBa}sortPrevious(mBa){let nBa=this.parent(mBa);if(void 0!==nBa){let oBa=this.childrenArray(nBa),pBa=oBa.findIndex(a=>a.id===mBa)-1;return pBa>=0?this.traverseSortPrevious(oBa[pBa].id):nBa}}getAllSorted(qBa){let rBa=[];for(let sBa of qBa){let tBa=this.getWithSortKey(sBa.id);void 0!==tBa&&rBa.push({...sBa,...tBa})}for(let uBa of(rBa.sort((a,b)=>(function(a,b){let c=0;for(;c<a.length&&c<b.length;){if(a[c]<b[c])return -1;if(a[c]>b[c])return 1;c+=1}return c!==b.length?-1:c!==a.length?1:0})(a.sortKey,b.sortKey)),rBa))delete uBa.sortKey;return rBa}getWithSortKey(vBa){var wBa=vBa;let xBa=[],yBa=this.get(wBa),zBa=yBa;if(void 0!==yBa){for(;wBa;)xBa.splice(0,0,yBa.fi),null!==(wBa=this.parent(wBa))&&(yBa=this.get(wBa));return{...zBa,sortKey:xBa}}}insertBeforeHelper(ABa,BBa,CBa){return this.insertAfterHelper(ABa,this.previous(ABa,BBa),CBa)}insertAfterHelper(DBa,EBa,FBa){let GBa=this.childrenArray(DBa);if(null===EBa){if(0===GBa.length)return Gza(0,FBa,FBa);{let HBa=GBa[0].fi;return Gza(HBa-FBa,HBa,FBa)}}{let IBa=this.get(EBa);if(void 0===IBa||this.parent(EBa)!==DBa)throw new Error("illegal args");let JBa=GBa.find(a=>a.fi>IBa.fi);if(void 0!==JBa)return Gza(IBa.fi,JBa.fi,FBa);{let KBa=GBa[GBa.length-1].fi;return Gza(KBa,KBa+FBa,FBa)}}}};(FCa||(FCa={})).runOp=function(a,b){if(0!==b.type)return null;if(Array.isArray(a)){let c=b.props,d={},e=[...a],f=!1;if(c)for(let g of Object.keys(c)){let h=parseInt(g);if(isNaN(h))throw new Error("wrong index");d[g]=e[h],e[h]=c[g],f=!0}return f?{data:e,actual:b,reverse:{type:0,props:d}}:null}{let i=b.props,j={},k={...a},l=!1;if(i)for(let m of Object.keys(i)){j[m]=k[m];let n=i[m];void 0===n?delete k[m]:k[m]=n,l=!0}return l?{data:k,actual:b,reverse:{type:0,props:j}}:null}};var LBa=class extends Array{constructor(...MBa){super(...MBa),Object.setPrototypeOf(this,LBa.prototype)}deepFreeze(){let NBa=0;for(;NBa<this.length;)Dza(this[NBa]),NBa++}fillCaches0(OBa){this.objCaches.set(OBa.id,OBa)}fillCaches(){if(void 0===this.objCaches)for(let PBa of(this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1,this))this.fillCaches0(PBa)}randomId(){this.fillCaches();let QBa=Array.from(this.objCaches.keys());if(0!==QBa.length)return QBa[Math.max(0,Math.floor(Math.random()*QBa.length)-1)]}data(RBa){return this.get(RBa)?.data}get(SBa){return this.fillCaches(),this.objCaches.get(SBa)}modifyById(TBa,UBa){if(void 0===this.get(TBa))throw new Error("not expected");{let VBa=this,WBa=VBa.findIndex(a=>a.id===TBa);if(WBa<0)throw new Error("not expected");let XBa=VBa[WBa];return(VBa=[...VBa])[WBa]={...XBa,data:UBa},this.modifyArrayBy(VBa)}}modifyArrayBy(YBa){Object.setPrototypeOf(YBa,LBa.prototype);let ZBa=YBa;return"u">typeof f||ZBa.fillCaches(),ZBa}runOp($Ba){switch($Ba.type){case 4:return this.addOp($Ba);case 5:return this.deleteOp($Ba);case 6:return this.moveOp($Ba)}return null}addOp(_Ba){let{fi:aCa,id:bCa,data:cCa}=_Ba,dCa=this,eCa={fi:aCa,id:bCa,data:cCa};return(dCa=[...dCa,eCa]).sort((a,b)=>a.fi-b.fi),_Ba.localIndex=dCa.indexOf(eCa),{data:this.modifyArrayBy(dCa),actual:_Ba,reverse:{type:5,id:bCa}}}deleteOp(fCa){let{id:gCa}=fCa,hCa=this,iCa=hCa.findIndex(a=>a.id===gCa);if(-1===iCa)return null;fCa.localIndex=iCa;let jCa=(hCa=[...hCa]).splice(iCa,1)[0];return{data:this.modifyArrayBy(hCa),actual:fCa,reverse:{type:4,...jCa}}}moveOp(kCa){let{fi:lCa,id:mCa}=kCa,nCa=this,oCa=(nCa=[...nCa]).findIndex(a=>a.id===mCa);if(-1===oCa)return null;let pCa=nCa[oCa].fi,qCa={...nCa[oCa],fi:lCa};return nCa[oCa]=qCa,nCa.sort((a,b)=>a.fi-b.fi),kCa.localIndex=nCa.indexOf(qCa),{data:this.modifyArrayBy(nCa),actual:kCa,reverse:{type:6,fi:pCa,id:mCa}}}previous(rCa){if(null===rCa)return 0===this.length?null:this[this.length-1].id;let sCa=null;for(let tCa of this){if(tCa.id===rCa)return sCa;sCa=tCa.id}return null}insertBeforeHelper(uCa,vCa){return this.insertAfterHelper(this.previous(uCa),vCa)}insertAfterHelper(wCa,xCa){let yCa=this;if(null===wCa){if(0===yCa.length)return Gza(0,xCa,xCa);{let zCa=yCa[0].fi;return Gza(zCa-xCa,zCa,xCa)}}{let ACa=this.get(wCa);if(void 0===ACa)throw new Error("illegal args");let BCa=yCa.find(a=>a.fi>ACa.fi);if(void 0!==BCa)return Gza(ACa.fi,BCa.fi,xCa);{let CCa=yCa[yCa.length-1].fi;return Gza(CCa,CCa+xCa,xCa)}}}};function DCa(a){return a&&"object"==typeof a&&a instanceof ICa}var ECa,FCa,GCa,HCa,ICa=class{unusedFunOverridesTable(JCa){}runOp(KCa){let LCa=[],MCa=this,NCa=0,OCa={};for(;NCa<KCa.path.length;){if(LCa.push(MCa),void 0!==(MCa=void 0===MCa?void 0:MCa[KCa.path[NCa]])&&!DCa(MCa))return null;NCa+=1}for(let[PCa,QCa]of(MCa=MCa?Fza(MCa):new ICa,Object.entries(KCa.props))){let RCa=MCa[PCa];OCa[PCa]=RCa,void 0===QCa?delete MCa[PCa]:MCa[PCa]=QCa}for(;NCa>0;){if(0===Object.keys(MCa).length){let SCa=LCa[NCa-1];SCa&&delete(MCa=Fza(SCa))[KCa.path[NCa-1]]}else{let TCa=LCa[NCa-1];if(TCa){let UCa=Fza(TCa);UCa[KCa.path[NCa-1]]=MCa,MCa=UCa}else{let VCa=new ICa;VCa[KCa.path[NCa-1]]=MCa,MCa=VCa}}NCa-=1}let WCa=Object.setPrototypeOf(MCa,ICa.prototype),XCa={...KCa,props:OCa};return{data:WCa,actual:KCa,reverse:XCa}}};function YCa(a,b){if(void 0===b)return;let c=!1,d=a.map(a=>{let d=a.id,e=ZCa(a.data,b[d]);if(c=c|| void 0!==e,void 0===e&&(e=a.data),!a.children)return{...a,id:d,data:e};{let f=YCa(a.children,b);return void 0!==f?c=!0:f=a.children,{...a,id:d,data:e,children:f}}});if(c)return d}function ZCa(a,b){if(!DCa(b))return b;if(a instanceof Kza){let c=YCa(a,b);return void 0!==c&&Object.setPrototypeOf(c,Object.getPrototypeOf(a)),c}if(a instanceof LBa)return(function(a,b){if(void 0===b)return;let c=!1,d=a.map(a=>{let d=a.id,e=ZCa(a.data,b[d]);return c=c|| void 0!==e,void 0===e&&(e=a.data),{...a,id:d,data:e}});if(c)return Object.setPrototypeOf(d,Object.getPrototypeOf(a)),d})(a,b);if(Array.isArray(a)){let d=!1,e=a.map((a,c)=>{let e=ZCa(a,b[c]);return d=d|| void 0!==e,void 0===e&&(e=a),e});return d?(Object.setPrototypeOf(e,Object.getPrototypeOf(a)),e):void 0}if(a instanceof ICa)return $Ca(a,b);if(a&&"object"==typeof a){let f={},g=!1;for(let[h,i]of Object.entries(a)){let j=ZCa(i,b[h]);g=g|| void 0!==j,void 0===j&&(j=i),f[h]=j}return g?(Object.setPrototypeOf(f,Object.getPrototypeOf(a)),f):void 0}}function $Ca(a,b){if(void 0===a)return b;if(void 0===b)return a;if(!DCa(b))return b;if(!DCa(a))return GCa.apply(a,b);let c=new Set;for(let d of Object.keys(a))c.add(d);for(let e of Object.keys(b))c.add(e);let f=new ICa;for(let g of c){let h=$Ca(void 0===a?void 0:a[g],void 0===b?void 0:b[g]);f[g]=h}return f}function _Ca(a,b){let c={cur:[],result:[],len:0};return[a=dDa(a,b,c)??a,c.result]}function aDa(a,b){return null===a?null:(a.cur[a.len]=b,a.len+=1,a)}function bDa(a){a&&(a.len-=1)}function cDa(a,b,c){let d=!1,e=a.map(a=>{let e=a.id,f=b[e];if(void 0!==f&&"string"==typeof f&&(d=!0,e=f,null!==c))throw new Error("not supported");let g=dDa(a.data,b,aDa(c,e));bDa(c),d=d|| void 0!==g,void 0===g&&(g=a.data);let h=cDa(a.children,b,c);return void 0!==h?d=!0:h=a.children,{...a,id:e,data:g,children:h}});if(d)return e}function dDa(a,b,c){if(a instanceof Kza){let d=cDa(a,b,c);return void 0!==d&&Object.setPrototypeOf(d,Object.getPrototypeOf(a)),d}if(a instanceof LBa)return(function(a,b,c){let d=!1,e=a.map(a=>{let e=a.id,f=b[e];if(void 0!==f&&"string"==typeof f&&(d=!0,e=f,null!==c))throw new Error("not supported");let g=dDa(a.data,b,aDa(c,e));return bDa(c),d=d|| void 0!==g,void 0===g&&(g=a.data),{...a,id:e,data:g}});if(d)return Object.setPrototypeOf(e,Object.getPrototypeOf(a)),e})(a,b,c);if(Array.isArray(a)){let e=!1,f=a.map((a,d)=>{let f=dDa(a,b,aDa(c,d));return bDa(c),e=e|| void 0!==f,void 0===f&&(f=a),f});return e?(Object.setPrototypeOf(f,Object.getPrototypeOf(a)),f):void 0}if(a&&"object"==typeof a&&!Hza(a)){let g={},h=!1;for(let[i,j]of Object.entries(a))if("name"!==i){let k=b[i];if("string"==typeof k){if(null!==c)throw new Error("not supported");h=!0,i=k}let l=dDa(j,b,aDa(c,i));bDa(c),h=h|| void 0!==l,void 0===l&&(l=j),g[i]=l}else g[i]=j;return h?(Object.setPrototypeOf(g,Object.getPrototypeOf(a)),g):void 0}{if("string"!=typeof a)return;let m=b[a];return void 0!==m&&(function(a){if(null===a)return null;a.result.push(a.cur.slice(0,a.len))})(c),m}}(HCa=GCa||(GCa={})).apply=function(a,b){return ZCa(a,b)??a},HCa.merge=function(a,b){return $Ca(a,b)},HCa.filterOp=function(a,b){let c=0,d=b.path,e=a;for(;c<d.length&& void 0!==e;){if(void 0===(e=aGa.zoomOnce(e,d[c])))return b;if(!DCa(e))return;c+=1}if(void 0===e)return b;if(DCa(e))if(0===b.type){let f={...b.props};for(let g of Object.keys(e))delete f[g];return{...b,props:f}}else{if(1!==b.type&&4!==b.type&&7!==b.type)return b;let h=YCa([b],e);return h?(console.log(h),h):b}},(ZFa||(ZFa={})).replaceProps=function(a,b){let c=aGa.zoom(b,a.path);if("object"!=typeof c)return{...a,props:{}};{let d={};for(let e of Object.keys(a.props))d[e]=c[e];return{...a,props:d}}},(a=>{function b(a,b){let c=b.path;for(var d=[];;){let e;if(a instanceof ICa&&0===b.type&&null===(e=a.runOp({...b,path:c.slice(d.length)}))&&(e=void 0),void 0===e&&d.length===c.length&&(e=a instanceof Kza||a instanceof LBa||a instanceof mza?a.runOp(b):FCa.runOp(a,b)),void 0!==e)if(null===e)return null;else{let f=e.data;for(let g=d.length-1;g>=0;g--){let h=c[g],i=d[g];if(i instanceof Kza){if("number"==typeof h)throw new Error("illegal arg");f=i.modifyById(h,f)}else if(i instanceof LBa){if("number"==typeof h)throw new Error("illegal arg");f=i.modifyById(h,f)}else if(i instanceof mza){if("number"==typeof h)throw new Error("illegal arg");f=i.modifyById(h,f)}else if(i instanceof ICa){let j={...i,[h]:f};f=Object.setPrototypeOf(j,ICa.prototype)}else if("object"!=typeof i)return null;else if(Array.isArray(i)){if("string"==typeof h&&isNaN(h=parseInt(h)))throw new Error("Invalid path");let k=f;(f=[...i])[h]=k}else f={...i,[h]:f}}return{data:f,actual:{...e.actual,path:c},reverse:{...e.reverse,path:c}}}let l=c[d.length],m;if(a instanceof Kza){if("number"==typeof l)throw new Error("");m=a.get(l)?.data}else if(a instanceof LBa){if("number"==typeof l)throw new Error("");m=a.get(l)?.data}else null!==a&&(m=a[l]);if(void 0===m)return null;d.push(a),a=m}}function c(a,b){for(let c=0;c<a.length&&c<b.length;c++)if(a[c]!==b[c])return!0;return!1}function d(a,b){if(a.length!==b.length)return!1;for(let c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}a.drop=function(a,b){return{...a,path:a.path.slice(b)}},a.applySimple=function(a,c){return b(a,c)?.data??a},a.apply=b,a.pathDisjoint=c,a.pathEq=d,a.commutative=function(a,b){return c(a.path,b.path)},a.subsumed=function(a,b){return!!(0===a.type&&0===b.type&&d(a.path,b.path))&&Object.keys(a.props).every(a=>void 0!==b.props[a])}})($Fa||($Fa={})),(a=>{function b(a,b){var c=a;let d=[],e=[];for(let f of b)try{if(3===f.type||5===f.type&&"variables"===f.path[f.path.length-1]){let g,h,i;if(3===f.type?(g=aGa.zoom(c,[...f.path,f.id]),i=$Fa.apply(c,{...f,type:2})):(g=aGa.zoom(c,[...f.path,f.id,"value"]),i=$Fa.apply(c,f)),null!==i){c=i.data;let[j,k]=_Ca(c,{[f.id]:g});c=j;for(let l=0;l<k.length;l++){let m=k[l],n=m.pop();if("number"==typeof n){let o=[n];for(let p=l+1;p<k.length;p++){let q=k[p],r=q[q.length-1];if("number"==typeof r&&aGa.equal(m,q.slice(0,q.length-1)))o.push(r),k.splice(p,1);else break}let s=aGa.zoom(c,m);h=s.map((a,b)=>o.includes(b)?f.id:a),g=s,n=m.pop()}else{if("alphaOverride"===n||"alpha"===n){let t=g/=100,u=aGa.zoom(c,m.slice(0,m.length-2)),v=u.layers.map(a=>a.id===m[m.length-1]?{...a,data:{...a.data,[n]:t}}:a);Object.setPrototypeOf(v,Object.getPrototypeOf(u.layers)),u.layers=v}h=f.id}d.push({type:0,path:m,props:{[n]:g}}),e.push({type:0,path:m,props:{[n]:h}})}e.push(i.reverse),d.push(i.actual)}}else{let w=$Fa.apply(c,f);null!==w&&(d.push(w.actual),c=w.data,e.push(w.reverse))}}catch(x){if(x instanceof Eza)return null;throw x}return{data:c,actual:d,reverse:e.reverse()}}a.empty=function(){return[]},a.removePrefix=function(a,b){let c=[];for(let d of a){let[e,...f]=d.path;e===b&&c.push({...d,path:f})}return c},a.addPrefix=function(a,b){return a.map(a=>({...a,path:[b,...a.path]}))},a.concat=function(a,b){return[...a,...b]},a.compress=function(a,b){return[...a.filter(a=>!b.some(b=>$Fa.subsumed(a,b))),...b]},a.commutative=function(a,b){return a.every(a=>b.every(b=>$Fa.commutative(a,b)))},a.applyAll=function(a,c){for(let d of c){let e=b(a,d);null!==e&&(a=e.data)}return a},a.apply=b})(_Fa||(_Fa={}));var eDa=Symbol(),fDa=Symbol(),gDa=Symbol(),hDa=class{reportOp(iDa,jDa,kDa=[]){let lDa=this;if(null===jDa)return;lDa._current=jDa.data;let mDa=kDa;for(;!(lDa instanceof HFa);){let nDa=lDa._path,oDa=lDa._current;if(""!==nDa&&mDa.splice(0,0,nDa),null===(lDa=lDa._parent))return;lDa.update(nDa,oDa)}lDa.push(mDa,iDa,jDa.actual,jDa.reverse)}deleteChildren(pDa){if(this._children){let qDa=this._children[pDa];if(qDa){let rDa=qDa[gDa];rDa&&rDa(),delete this._children[pDa]}}}},sDa=class extends hDa{constructor(tDa,uDa,vDa){super(),this._parent=tDa,this._path=uDa,this._current=vDa}update(wDa,xDa){if(Array.isArray(this._current)){if("string"==typeof wDa&&isNaN(wDa=parseInt(wDa)))throw new Error("Invalid path");this._current=[...this._current],this._current[wDa]=xDa}else this._current={...this._current,[wDa]:xDa}}runOp(yDa){this.reportOp(yDa,FCa.runOp(this._current,yDa),yDa.path)}},zDa=class extends hDa{constructor(ADa,BDa,CDa){super(),this._parent=ADa,this._path=BDa,this._current=CDa}update(DDa,EDa){this._current={...this._current,[DDa]:EDa},Object.setPrototypeOf(this._current,mza.prototype)}runOp(FDa){this.reportOp(FDa,this._current.runOp(FDa))}},GDa={get(a,b){if(b===gDa)return()=>{a._parent=null};if(b===eDa)return a._current;if(b===fDa)return a;let{_current:c,_children:d}=a;if("push"===b&&Array.isArray(c))throw new Error("not supported to expand array");let e=void 0===d?void 0:d[b];if(void 0!==e)return e;let f=c[b],g=PFa(a,b,f);return g!==f?(void 0===d&&(d={},a._children=d),d[b]=g,g):f},has(a,b){return b in a._current},ownKeys(a){return Reflect.ownKeys(a._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(a){return Object.getPrototypeOf(a._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(a,b){let c=a._current,d=Reflect.getOwnPropertyDescriptor(c,b);return d&&{writable:!0,configurable:!0,enumerable:d.enumerable,value:c[b]}}},HDa={...GDa,set(a,b,c){let d={type:0,props:{[b]:SFa(c)??c}};return a.deleteChildren(b),a.runOp(d),!0},deleteProperty(a,b){let c={type:0,props:{[b]:void 0}};return a.deleteChildren(b),a.runOp(c),!0}},IDa={...GDa,set(a,b,c){return void 0===c?this.deleteProperty(a,b):(a.deleteChildren(b),a.runOp({type:1,id:b,data:c})),!0},deleteProperty(a,b){return a.runOp({type:2,id:b}),!0}},JDa=class extends hDa{constructor(KDa,LDa,MDa){super(),this._children={},this._parent=KDa,this._path=LDa,this._current=MDa,this[gDa]=()=>{this._parent=null}}unproxy(){return this._current}update(NDa,ODa){this._current=this._current.modifyById(NDa,ODa)}runOp(PDa){this.reportOp(PDa,this._current.runOp(PDa))}randomId(){return this._current.randomId()}isDescendantOf(QDa,RDa){return this._current.isDescendantOf(QDa,RDa)}childrenOf(SDa){return this._current.childrenOf(SDa)}traverse(TDa){return this._current.traverse(TDa)}get(UDa){return this._current.get(UDa)}parent(VDa){return this._current.parent(VDa)}traverse(WDa){this._current.traverse((a,b)=>{WDa(a,this.data(a))})}data(XDa){let{_current:YDa,_children:ZDa}=this,$Da=void 0===ZDa?void 0:ZDa[XDa];if(void 0!==$Da)return $Da;let _Da=YDa.get(XDa)?.data,aEa=PFa(this,XDa,_Da);return aEa!==_Da?(void 0===ZDa&&(ZDa={},this._children=ZDa),ZDa[XDa]=aEa,aEa):_Da}add(bEa,cEa,dEa,eEa,fEa){this.runOp({type:7,parent:bEa,fi:cEa,id:dEa,data:eEa,children:fEa})}move(gEa,hEa,iEa){this.runOp({type:9,parent:gEa,fi:hEa,id:iEa})}insertAfter(jEa,kEa,lEa){let mEa=this._current.insertAfterHelper(jEa,kEa,lEa.length);for(let nEa=0;nEa<lEa.length;nEa++){let oEa=lEa[nEa];this.add(jEa,mEa[nEa],oEa.id,oEa.data,oEa.children)}}insertBefore(pEa,qEa,rEa){let sEa=this._current.insertBeforeHelper(pEa,qEa,rEa.length);for(let tEa=0;tEa<rEa.length;tEa++){let uEa=rEa[tEa];this.add(pEa,sEa[tEa],uEa.id,uEa.data,uEa.children)}}moveAfter(vEa,wEa,xEa){let yEa=this._current.insertAfterHelper(vEa,wEa,xEa.length);for(let zEa=0;zEa<xEa.length;zEa++){let AEa=xEa[zEa];this.move(vEa,yEa[zEa],AEa)}}moveBefore(BEa,CEa,DEa){let EEa=this._current.insertBeforeHelper(BEa,CEa,DEa.length);for(let FEa=0;FEa<DEa.length;FEa++){let GEa=DEa[FEa];this.move(BEa,EEa[FEa],GEa)}}delete(HEa){this.deleteChildren(HEa),this.runOp({type:8,id:HEa})}sortNext(IEa){return this._current.sortNext(IEa)}sortPrevious(JEa){return this._current.sortPrevious(JEa)}getAllSorted(KEa){return this._current.getAllSorted(KEa)}},LEa=class extends hDa{constructor(MEa,NEa,OEa){super(),this._children={},this._parent=MEa,this._path=NEa,this._current=OEa,this[gDa]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(PEa){let QEa=this.length;for(let REa=0;REa<QEa;REa++){let SEa=this._current[REa].id,TEa=this._current[REa].fi;PEa(this.data(this._current[REa].id),SEa,TEa)}}find(UEa){let VEa=this.length;for(let WEa=0;WEa<VEa;WEa++){let XEa=this._current[WEa].id;if(UEa(this.data(XEa),XEa))return this.get(XEa)}}update(YEa,ZEa){this._current=this._current.modifyById(YEa,ZEa)}randomId(){return this._current.randomId()}get($Ea){return{...this._current.get($Ea),data:this.data($Ea)}}data(_Ea){let{_current:aFa,_children:bFa}=this,cFa=void 0===bFa?void 0:bFa[_Ea];if(void 0!==cFa)return cFa;let dFa=aFa.get(_Ea)?.data,eFa=PFa(this,_Ea,dFa);return eFa!==dFa?(void 0===bFa&&(bFa={},this._children=bFa),bFa[_Ea]=eFa,eFa):dFa}runOp(fFa){this.reportOp(fFa,this._current.runOp(fFa))}add(gFa,hFa,iFa){this.runOp({type:4,fi:gFa,id:hFa,data:iFa})}move(jFa,kFa){this.runOp({type:6,fi:jFa,id:kFa})}insertAfter(lFa,mFa){let nFa=this._current.insertAfterHelper(lFa,mFa.length);for(let oFa=0;oFa<mFa.length;oFa++){let pFa=mFa[oFa];this.add(nFa[oFa],pFa.id,pFa.data)}}insertBefore(qFa,rFa){let sFa=this._current.insertBeforeHelper(qFa,rFa.length);for(let tFa=0;tFa<rFa.length;tFa++){let uFa=rFa[tFa];this.add(sFa[tFa],uFa.id,uFa.data)}}moveAfter(vFa,wFa){let xFa=this._current.insertAfterHelper(vFa,wFa.length);for(let yFa=0;yFa<wFa.length;yFa++){let zFa=wFa[yFa];this.move(xFa[yFa],zFa)}}moveBefore(AFa,BFa){let CFa=this._current.insertBeforeHelper(AFa,BFa.length);for(let DFa=0;DFa<BFa.length;DFa++){let EFa=BFa[DFa];this.move(CFa[DFa],EFa)}}delete(FFa){this.deleteChildren(FFa),this.runOp({type:5,id:FFa})}};function GFa(a,b,c){if(a.length>0){let d=a[a.length-1];if(0===d.type&&0===b.type&&aGa.equal(d.path,c)){Object.assign(d.props,b.props);return}}a.push({...b,path:c})}var HFa=class extends hDa{constructor(IFa){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=IFa}update(JFa,KFa){if(""!==JFa)throw new Error("");this._current=KFa}push(LFa,MFa,NFa,OFa){GFa(this.ts,MFa,LFa),GFa(this.actual,NFa,LFa),GFa(this.reverse,OFa,LFa)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function PFa(a,b,c){return c instanceof Kza?new JDa(a,b,c):c instanceof LBa?new LEa(a,b,c):c instanceof mza?new Proxy(new zDa(a,b,c),IDa):null!==c&&"object"==typeof c?Hza(c)?c:new Proxy(new sDa(a,b,c),HDa):c}function QFa(a){let b=new HFa(a);return[PFa(b,"",a),b]}function RFa(a,b){let[c,d]=QFa(a);return b(c),d.result()}function SFa(a){return a instanceof JDa||a instanceof LEa?a._current:null!==a&&"object"==typeof a?a[eDa]:a}function TFa(a,b){let c=[];if(!(b.length<=a.length))return null;for(var d=0;d<b.length;){if("*"===b[d])c.push(a[d]);else if(a[d]!==b[d])return null;d+=1}return c}(a=>{function b(a,b){return(a instanceof Kza||a instanceof JDa)&&"string"==typeof b?a.data(b):(a instanceof LBa||a instanceof LEa)&&"string"==typeof b?a.data(b):"number"==typeof b&&Array.isArray(a)?a[b]:"string"==typeof b&&"object"==typeof a&&null!==a?a[b]:void 0}function c(a,c,d=0){for(;d<c.length&& void 0!==a;)a=b(a,c[d]),d+=1;return a}a.equal=function(a,b){if(b.length!==a.length)return!1;for(var c=0;c<a.length;){if(a[c]!==b[c])return!1;c+=1}return!0},a.removeOverridden=function(a,b,d){let e=c(d,a);if(void 0===e||"object"!=typeof e||null===e)return b;{let f={...b};return Object.keys(e).forEach(a=>{delete f[a]}),f}},a.zoomOnce=b,a.zoom=c})(aGa||(aGa={}));var UFa=class{},VFa=class extends UFa{constructor(WFa){super(),this.id=WFa}},XFa=class extends UFa{constructor(YFa){super(),this.data=YFa}};try{bGa=new TextDecoder}catch{}var ZFa,$Fa,_Fa,aGa,bGa,cGa,dGa,eGa,fGa,gGa,hGa,iGa,jGa=0,kGa=[],lGa=kGa,mGa=0,nGa={},oGa=0,pGa=0,qGa=[],rGa={useRecords:!1,mapsAsObjects:!0},sGa=class{},tGa=new sGa;tGa.name="MessagePack 0xC1";var uGa=!1,vGa=class{constructor(wGa){wGa&&(!1===wGa.useRecords&& void 0===wGa.mapsAsObjects&&(wGa.mapsAsObjects=!0),wGa.structures?wGa.structures.sharedLength=wGa.structures.length:wGa.getStructures&&((wGa.structures=[]).uninitialized=!0,wGa.structures.sharedLength=0)),Object.assign(this,wGa)}unpack(xGa,yGa){if(cGa)return nHa(()=>(oHa(),this?this.unpack(xGa,yGa):vGa.prototype.unpack.call(rGa,xGa,yGa)));dGa=yGa> -1?yGa:xGa.length,jGa=0,mGa=0,pGa=0,fGa=null,lGa=kGa,gGa=null,cGa=xGa;try{iGa=xGa.dataView||(xGa.dataView=new DataView(xGa.buffer,xGa.byteOffset,xGa.byteLength))}catch(zGa){throw cGa=null,xGa instanceof Uint8Array?zGa:new Error("Source must be a Uint8Array or Buffer but was a "+(xGa&&"object"==typeof xGa?xGa.constructor.name:typeof xGa))}if(this instanceof vGa){if(nGa=this,this.structures)return eGa=this.structures,RGa();(!eGa||eGa.length>0)&&(eGa=[])}else nGa=rGa,(!eGa||eGa.length>0)&&(eGa=[]);return RGa()}unpackMultiple(AGa,BGa){let CGa,DGa=0;try{uGa=!0;let EGa=AGa.length,FGa=this?this.unpack(AGa,EGa):rHa.unpack(AGa,EGa);if(BGa){for(BGa(FGa);jGa<EGa;)if(DGa=jGa,!1===BGa(RGa()))return}else{for(CGa=[FGa];jGa<EGa;)DGa=jGa,CGa.push(RGa());return CGa}}catch(GGa){throw GGa.lastPosition=DGa,GGa.values=CGa,GGa}finally{uGa=!1,oHa()}}_mergeStructures(HGa,IGa){HGa=HGa||[];for(let JGa=0,KGa=HGa.length;JGa<KGa;JGa++){let LGa=HGa[JGa];LGa&&(LGa.isShared=!0,JGa>=32&&(LGa.highByte=JGa-32>>5))}for(let MGa in HGa.sharedLength=HGa.length,IGa||[])if(MGa>=0){let NGa=HGa[MGa],OGa=IGa[MGa];OGa&&(NGa&&((HGa.restoreStructures||(HGa.restoreStructures=[]))[MGa]=NGa),HGa[MGa]=OGa)}return this.structures=HGa}decode(PGa,QGa){return this.unpack(PGa,QGa)}};function RGa(){try{if(!nGa.trusted&&!uGa){let a=eGa.sharedLength||0;a<eGa.length&&(eGa.length=a)}let b=TGa();if(jGa==dGa)eGa.restoreStructures&&SGa(),eGa=null,cGa=null,hGa&&(hGa=null);else if(jGa>dGa){let c=new Error("Unexpected end of MessagePack data");throw c.incomplete=!0,c}else if(!uGa)throw new Error("Data read, but end of buffer not reached");return b}catch(d){throw eGa.restoreStructures&&SGa(),oHa(),(d instanceof RangeError||d.message.startsWith("Unexpected end of buffer"))&&(d.incomplete=!0),d}}function SGa(){for(let a in eGa.restoreStructures)eGa[a]=eGa.restoreStructures[a];eGa.restoreStructures=null}function TGa(){let a=cGa[jGa++];if(a<160)if(a<128){if(a<64)return a;{let b=eGa[63&a]||nGa.getStructures&&XGa()[63&a];return b?(b.read||(b.read=VGa(b,63&a)),b.read()):a}}else if(a<144)if(a-=128,nGa.mapsAsObjects){let c={};for(let d=0;d<a;d++)c[jHa()]=TGa();return c}else{let e=new Map;for(let f=0;f<a;f++)e.set(TGa(),TGa());return e}else{a-=144;let g=new Array(a);for(let h=0;h<a;h++)g[h]=TGa();return g}if(a<192){let i=a-160;if(pGa>=jGa)return fGa.slice(jGa-oGa,(jGa+=i)-oGa);if(0==pGa&&dGa<140){let j=i<16?fHa(i):eHa(i);if(null!=j)return j}return YGa(i)}{let k;switch(a){case 192:return null;case 193:return gGa?(k=TGa())>0?gGa[1].slice(gGa.position1,gGa.position1+=k):gGa[0].slice(gGa.position0,gGa.position0-=k):tGa;case 194:return!1;case 195:return!0;case 196:return gHa(cGa[jGa++]);case 197:return k=iGa.getUint16(jGa),jGa+=2,gHa(k);case 198:return k=iGa.getUint32(jGa),jGa+=4,gHa(k);case 199:return hHa(cGa[jGa++]);case 200:return k=iGa.getUint16(jGa),jGa+=2,hHa(k);case 201:return k=iGa.getUint32(jGa),jGa+=4,hHa(k);case 202:if(k=iGa.getFloat32(jGa),nGa.useFloat32>2){let l=pHa[(127&cGa[jGa])<<1|cGa[jGa+1]>>7];return jGa+=4,(l*k+(k>0?.5:-0.5)>>0)/l}return jGa+=4,k;case 203:return k=iGa.getFloat64(jGa),jGa+=8,k;case 204:return cGa[jGa++];case 205:return k=iGa.getUint16(jGa),jGa+=2,k;case 206:return k=iGa.getUint32(jGa),jGa+=4,k;case 207:return nGa.int64AsNumber?(k=4294967296*iGa.getUint32(jGa),k+=iGa.getUint32(jGa+4)):k=iGa.getBigUint64(jGa),jGa+=8,k;case 208:return iGa.getInt8(jGa++);case 209:return k=iGa.getInt16(jGa),jGa+=2,k;case 210:return k=iGa.getInt32(jGa),jGa+=4,k;case 211:return nGa.int64AsNumber?(k=4294967296*iGa.getInt32(jGa),k+=iGa.getUint32(jGa+4)):k=iGa.getBigInt64(jGa),jGa+=8,k;case 212:if(114==(k=cGa[jGa++]))return kHa(63&cGa[jGa++]);{let m=qGa[k];if(m)return m.read?(jGa++,m.read(TGa())):m.noBuffer?(jGa++,m()):m(cGa.subarray(jGa,++jGa));throw new Error("Unknown extension "+k)}case 213:return 114==(k=cGa[jGa])?(jGa++,kHa(63&cGa[jGa++],cGa[jGa++])):hHa(2);case 214:return hHa(4);case 215:return hHa(8);case 216:return hHa(16);case 217:return k=cGa[jGa++],pGa>=jGa?fGa.slice(jGa-oGa,(jGa+=k)-oGa):ZGa(k);case 218:return k=iGa.getUint16(jGa),pGa>=(jGa+=2)?fGa.slice(jGa-oGa,(jGa+=k)-oGa):$Ga(k);case 219:return k=iGa.getUint32(jGa),pGa>=(jGa+=4)?fGa.slice(jGa-oGa,(jGa+=k)-oGa):_Ga(k);case 220:return k=iGa.getUint16(jGa),jGa+=2,bHa(k);case 221:return k=iGa.getUint32(jGa),jGa+=4,bHa(k);case 222:return k=iGa.getUint16(jGa),jGa+=2,cHa(k);case 223:return k=iGa.getUint32(jGa),jGa+=4,cHa(k);default:if(a>=224)return a-256;if(void 0===a){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+a)}}}var UGa=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function VGa(a,b){function c(){if(c.count++ >2){let d=a.read=new Function("r","return function(){return {"+a.map(a=>UGa.test(a)?a+":r()":"["+JSON.stringify(a)+"]:r()").join(",")+"}}")(TGa);return 0===a.highByte&&(a.read=WGa(b,a.read)),d()}let e={};for(let f=0,g=a.length;f<g;f++)e[a[f]]=TGa();return e}return c.count=0,0===a.highByte?WGa(b,c):c}var WGa=(a,b)=>function(){let c=cGa[jGa++];if(0===c)return b();let d=a<32?-(a+(c<<5)):a+(c<<5),e=eGa[d]||XGa()[d];if(!e)throw new Error("Record id is not defined for "+d);return e.read||(e.read=VGa(e,a)),e.read()};function XGa(){let a=nHa(()=>(cGa=null,nGa.getStructures()));return eGa=nGa._mergeStructures(a,eGa)}var YGa=aHa,ZGa=aHa,$Ga=aHa,_Ga=aHa;function aHa(a){let b;if(a<16&&(b=fHa(a)))return b;if(a>64&&bGa)return bGa.decode(cGa.subarray(jGa,jGa+=a));let c=jGa+a,d=[];for(b="";jGa<c;){let e=cGa[jGa++];if((128&e)==0)d.push(e);else if((224&e)==192){let f=63&cGa[jGa++];d.push((31&e)<<6|f)}else if((240&e)==224){let g=63&cGa[jGa++],h=63&cGa[jGa++];d.push((31&e)<<12|g<<6|h)}else if((248&e)==240){let i=63&cGa[jGa++],j=63&cGa[jGa++],k=63&cGa[jGa++],l=(7&e)<<18|i<<12|j<<6|k;l>65535&&(l-=65536,d.push(l>>>10&1023|55296),l=56320|1023&l),d.push(l)}else d.push(e);d.length>=4096&&(b+=dHa.apply(String,d),d.length=0)}return d.length>0&&(b+=dHa.apply(String,d)),b}function bHa(a){let b=new Array(a);for(let c=0;c<a;c++)b[c]=TGa();return b}function cHa(a){if(nGa.mapsAsObjects){let b={};for(let c=0;c<a;c++)b[jHa()]=TGa();return b}{let d=new Map;for(let e=0;e<a;e++)d.set(TGa(),TGa());return d}}var dHa=String.fromCharCode;function eHa(a){let b=jGa,c=new Array(a);for(let d=0;d<a;d++){let e=cGa[jGa++];if((128&e)>0){jGa=b;return}c[d]=e}return dHa.apply(String,c)}function fHa(a){if(a<4)if(a<2){if(0===a)return"";{let b=cGa[jGa++];if((128&b)>1){jGa-=1;return}return dHa(b)}}else{let c=cGa[jGa++],d=cGa[jGa++];if((128&c)>0||(128&d)>0){jGa-=2;return}if(a<3)return dHa(c,d);let e=cGa[jGa++];if((128&e)>0){jGa-=3;return}return dHa(c,d,e)}{let f=cGa[jGa++],g=cGa[jGa++],h=cGa[jGa++],i=cGa[jGa++];if((128&f)>0||(128&g)>0||(128&h)>0||(128&i)>0){jGa-=4;return}if(a<6){if(4===a)return dHa(f,g,h,i);{let j=cGa[jGa++];if((128&j)>0){jGa-=5;return}return dHa(f,g,h,i,j)}}if(a<8){let k=cGa[jGa++],l=cGa[jGa++];if((128&k)>0||(128&l)>0){jGa-=6;return}if(a<7)return dHa(f,g,h,i,k,l);let m=cGa[jGa++];if((128&m)>0){jGa-=7;return}return dHa(f,g,h,i,k,l,m)}{let n=cGa[jGa++],o=cGa[jGa++],p=cGa[jGa++],q=cGa[jGa++];if((128&n)>0||(128&o)>0||(128&p)>0||(128&q)>0){jGa-=8;return}if(a<10){if(8===a)return dHa(f,g,h,i,n,o,p,q);{let r=cGa[jGa++];if((128&r)>0){jGa-=9;return}return dHa(f,g,h,i,n,o,p,q,r)}}if(a<12){let s=cGa[jGa++],t=cGa[jGa++];if((128&s)>0||(128&t)>0){jGa-=10;return}if(a<11)return dHa(f,g,h,i,n,o,p,q,s,t);let u=cGa[jGa++];if((128&u)>0){jGa-=11;return}return dHa(f,g,h,i,n,o,p,q,s,t,u)}{let v=cGa[jGa++],w=cGa[jGa++],x=cGa[jGa++],y=cGa[jGa++];if((128&v)>0||(128&w)>0||(128&x)>0||(128&y)>0){jGa-=12;return}if(a<14){if(12===a)return dHa(f,g,h,i,n,o,p,q,v,w,x,y);{let z=cGa[jGa++];if((128&z)>0){jGa-=13;return}return dHa(f,g,h,i,n,o,p,q,v,w,x,y,z)}}{let A=cGa[jGa++],B=cGa[jGa++];if((128&A)>0||(128&B)>0){jGa-=14;return}if(a<15)return dHa(f,g,h,i,n,o,p,q,v,w,x,y,A,B);let C=cGa[jGa++];if((128&C)>0){jGa-=15;return}return dHa(f,g,h,i,n,o,p,q,v,w,x,y,A,B,C)}}}}}function gHa(a){return nGa.copyBuffers?Uint8Array.prototype.slice.call(cGa,jGa,jGa+=a):cGa.subarray(jGa,jGa+=a)}function hHa(a){let b=cGa[jGa++];if(qGa[b])return qGa[b](cGa.subarray(jGa,jGa+=a));throw new Error("Unknown extension type "+b)}var iHa=new Array(4096);function jHa(){let a=cGa[jGa++];if(!(a>=160)||!(a<192))return jGa--,TGa();if(a-=160,pGa>=jGa)return fGa.slice(jGa-oGa,(jGa+=a)-oGa);if(!(0==pGa&&dGa<180))return YGa(a);let b=(a<<5^(a>1?iGa.getUint16(jGa):a>0?cGa[jGa]:0))&4095,c=iHa[b],d=jGa,e=jGa+a-3,f,g=0;if(c&&c.bytes==a){for(;d<e;){if((f=iGa.getUint32(d))!=c[g++]){d=1879048192;break}d+=4}for(e+=3;d<e;)if((f=cGa[d++])!=c[g++]){d=1879048192;break}if(d===e)return jGa=d,c.string;e-=3,d=jGa}for(c=[],iHa[b]=c,c.bytes=a;d<e;)f=iGa.getUint32(d),c.push(f),d+=4;for(e+=3;d<e;)f=cGa[d++],c.push(f);let h=a<16?fHa(a):eHa(a);return null!=h?c.string=h:c.string=YGa(a)}var kHa=(a,b)=>{var c=TGa();let d=a;void 0!==b&&(a=a<32?-((b<<5)+a):(b<<5)+a,c.highByte=b);let e=eGa[a];return e&&e.isShared&&((eGa.restoreStructures||(eGa.restoreStructures=[]))[a]=e),eGa[a]=c,c.read=VGa(c,d),c.read()},lHa="object"==typeof self?self:global;qGa[0]=()=>{},qGa[0].noBuffer=!0,qGa[101]=()=>{let a=TGa();return(lHa[a[0]]||Error)(a[1])},qGa[105]=a=>{let b=iGa.getUint32(jGa-4);hGa||(hGa=new Map);let c=cGa[jGa],d,e={target:d=c>=144&&c<160||220==c||221==c?[]:{}};hGa.set(b,e);let f=TGa();return e.used?Object.assign(d,f):(e.target=f,f)},qGa[112]=a=>{let b=iGa.getUint32(jGa-4),c=hGa.get(b);return c.used=!0,c.target},qGa[115]=()=>new Set(TGa());var mHa=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(a=>a+"Array");function nHa(a){let b=dGa,c=jGa,d=mGa,e=oGa,f=pGa,g=fGa,h=lGa,i=hGa,j=gGa,k=new Uint8Array(cGa.slice(0,dGa)),l=eGa,m=eGa.slice(0,eGa.length),n=nGa,o=uGa,p=a();return dGa=b,jGa=c,mGa=d,oGa=e,pGa=f,fGa=g,lGa=h,hGa=i,gGa=j,cGa=k,uGa=o,(eGa=l).splice(0,eGa.length,...m),nGa=n,iGa=new DataView(cGa.buffer,cGa.byteOffset,cGa.byteLength),p}function oHa(){cGa=null,hGa=null,eGa=null}qGa[116]=a=>{let b=a[0],c=mHa[b];if(!c)throw new Error("Could not find typed array for code "+b);return new lHa[c](Uint8Array.prototype.slice.call(a,1).buffer)},qGa[120]=()=>{let a=TGa();return new RegExp(a[0],a[1])},qGa[98]=a=>{let b=(a[0]<<24)+(a[1]<<16)+(a[2]<<8)+a[3],c=jGa;jGa+=b-4,(gGa=[TGa(),TGa()]).position0=0,gGa.position1=0;let d=jGa;jGa=c;try{return TGa()}finally{jGa=d}},qGa[255]=a=>new Date(4==a.length?(16777216*a[0]+(a[1]<<16)+(a[2]<<8)+a[3])*1e3:8==a.length?((a[0]<<22)+(a[1]<<14)+(a[2]<<6)+(a[3]>>2))/1e6+((3&a[3])*4294967296+16777216*a[4]+(a[5]<<16)+(a[6]<<8)+a[7])*1e3:12==a.length?((a[0]<<24)+(a[1]<<16)+(a[2]<<8)+a[3])/1e6+((128&a[4]?-281474976710656:0)+1099511627776*a[6]+4294967296*a[7]+16777216*a[8]+(a[9]<<16)+(a[10]<<8)+a[11])*1e3:"invalid");var pHa=new Array(147);for(let qHa=0;qHa<256;qHa++)pHa[qHa]=+("1e"+Math.floor(45.15-.30103*qHa));var rHa=new vGa({useRecords:!1}),sHa=rHa.unpack,tHa=rHa.unpackMultiple,uHa=rHa.unpack,vHa=new Float32Array(1);new Uint8Array(vHa.buffer,0,4);try{wHa=new TextEncoder}catch{}var wHa,xHa,yHa,zHa,AHa,BHa,CHa="u">typeof g,DHa=CHa?g.allocUnsafeSlow:Uint8Array,EHa=CHa?g:Uint8Array,FHa=CHa?4294967296:2144337920,GHa=0,HHa=null,IHa=/[\u0080-\uFFFF]/,JHa=Symbol("record-id"),KHa=class extends vGa{constructor(LHa){super(LHa),this.offset=0;let MHa,NHa,OHa,PHa,QHa,RHa=0,SHa=EHa.prototype.utf8Write?function(a,b,c){return zHa.utf8Write(a,b,c)}:!!wHa&&!!wHa.encodeInto&&function(a,b){return wHa.encodeInto(a,zHa.subarray(b)).written},THa=this;LHa||(LHa={});let UHa=LHa&&LHa.sequential,VHa=LHa.structures||LHa.saveStructures,WHa=LHa.maxSharedStructures;if(null==WHa&&(WHa=VHa?32:0),WHa>8160)throw new Error("Maximum maxSharedStructure is 8160");let XHa=LHa.maxOwnStructures;null==XHa&&(XHa=VHa?32:64),UHa&&!LHa.saveStructures&&(this.structures=[]);let YHa=WHa>32||XHa+WHa>64,ZHa=WHa+64,$Ha=WHa+XHa+64;if($Ha>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let _Ha=[],aIa=0,bIa=0;this.pack=this.encode=function(a,b){if(zHa||(zHa=new DHa(8192),AHa=new DataView(zHa.buffer,0,8192),GHa=0),(BHa=zHa.length-10)-GHa<2048?(zHa=new DHa(zHa.length),AHa=new DataView(zHa.buffer,0,zHa.length),BHa=zHa.length-10,GHa=0):GHa=GHa+7&2147483640,MHa=GHa,QHa=THa.structuredClone?new Map:null,THa.bundleStrings?(HHa=["",""],zHa[GHa++]=214,zHa[GHa++]=98,HHa.position=GHa-MHa,GHa+=4):HHa=null,NHa=THa.structures){NHa.uninitialized&&(NHa=THa._mergeStructures(THa.getStructures()));let c=NHa.sharedLength||0;if(c>WHa)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+NHa.sharedLength);if(!NHa.transitions){NHa.transitions=Object.create(null);for(let d=0;d<c;d++){let e=NHa[d];if(!e)continue;let f,g=NHa.transitions;for(let h=0,i=e.length;h<i;h++){let j=e[h];(f=g[j])||(f=g[j]=Object.create(null)),g=f}g[JHa]=d+64}RHa=c}UHa||(NHa.nextId=c+64)}OHa&&(OHa=!1),PHa=NHa||[];try{if(cIa(a),HHa){AHa.setUint32(HHa.position+MHa,GHa-HHa.position-MHa);let k=HHa;HHa=null,cIa(k[0]),cIa(k[1])}if(THa.offset=GHa,QHa&&QHa.idsToInsert){(GHa+=6*QHa.idsToInsert.length)>BHa&&eIa(GHa),THa.offset=GHa;let l=jIa(zHa.subarray(MHa,GHa),QHa.idsToInsert);return QHa=null,l}return b&qIa?(zHa.start=MHa,zHa.end=GHa,zHa):zHa.subarray(MHa,GHa)}finally{if(NHa){if(bIa<10&&bIa++,aIa>1e4)NHa.transitions=null,bIa=0,aIa=0,_Ha.length>0&&(_Ha=[]);else if(_Ha.length>0&&!UHa){for(let m=0,n=_Ha.length;m<n;m++)_Ha[m][JHa]=0;_Ha=[]}if(OHa&&THa.saveStructures){let o=NHa.sharedLength||WHa;NHa.length>o&&(NHa=NHa.slice(0,o));let p=zHa.subarray(MHa,GHa);return!1===THa.saveStructures(NHa,RHa)?(THa._mergeStructures(THa.getStructures()),THa.pack(a)):(RHa=o,p)}}b&rIa&&(GHa=MHa)}};let cIa=a=>{GHa>BHa&&(zHa=eIa(GHa));var b,c=typeof a;if("string"===c){let d=a.length;if(HHa&&d>=8&&d<4096){let e=IHa.test(a);HHa[e?0:1]+=a,zHa[GHa++]=193,cIa(e?-d:d);return}let f;f=d<32?1:d<256?2:d<65536?3:5;let g=3*d;if(GHa+g>BHa&&(zHa=eIa(GHa+g)),d<64||!SHa){let h,i,j,k=GHa+f;for(h=0;h<d;h++)(i=a.charCodeAt(h))<128?zHa[k++]=i:i<2048?(zHa[k++]=i>>6|192,zHa[k++]=63&i|128):(64512&i)==55296&&(64512&(j=a.charCodeAt(h+1)))==56320?(i=65536+((1023&i)<<10)+(1023&j),h++,zHa[k++]=i>>18|240,zHa[k++]=i>>12&63|128,zHa[k++]=i>>6&63|128,zHa[k++]=63&i|128):(zHa[k++]=i>>12|224,zHa[k++]=i>>6&63|128,zHa[k++]=63&i|128);b=k-GHa-f}else b=SHa(a,GHa+f,g);b<32?zHa[GHa++]=160|b:b<256?(f<2&&zHa.copyWithin(GHa+2,GHa+1,GHa+1+b),zHa[GHa++]=217,zHa[GHa++]=b):b<65536?(f<3&&zHa.copyWithin(GHa+3,GHa+2,GHa+2+b),zHa[GHa++]=218,zHa[GHa++]=b>>8,zHa[GHa++]=255&b):(f<5&&zHa.copyWithin(GHa+5,GHa+3,GHa+3+b),zHa[GHa++]=219,AHa.setUint32(GHa,b),GHa+=4),GHa+=b}else if("number"===c)if(a>>>0===a)a<64?zHa[GHa++]=a:a<256?(zHa[GHa++]=204,zHa[GHa++]=a):a<65536?(zHa[GHa++]=205,zHa[GHa++]=a>>8,zHa[GHa++]=255&a):(zHa[GHa++]=206,AHa.setUint32(GHa,a),GHa+=4);else if(a>>0===a)a>= -32?zHa[GHa++]=256+a:a>= -128?(zHa[GHa++]=208,zHa[GHa++]=a+256):a>= -32768?(zHa[GHa++]=209,AHa.setInt16(GHa,a),GHa+=2):(zHa[GHa++]=210,AHa.setInt32(GHa,a),GHa+=4);else{let l;if((l=this.useFloat32)>0&&a<4294967296&&a>= -2147483648){zHa[GHa++]=202,AHa.setFloat32(GHa,a);let m;if(l<4||(m=a*pHa[(127&zHa[GHa])<<1|zHa[GHa+1]>>7])>>0===m){GHa+=4;return}GHa--}zHa[GHa++]=203,AHa.setFloat64(GHa,a),GHa+=8}else if("object"===c)if(a){if(QHa){let n=QHa.get(a);if(n){if(!n.id){let o=QHa.idsToInsert||(QHa.idsToInsert=[]);n.id=o.push(n)}zHa[GHa++]=214,zHa[GHa++]=112,AHa.setUint32(GHa,n.id),GHa+=4;return}QHa.set(a,{offset:GHa-MHa})}let p=a.constructor;if(p===Object)dIa(a,!0);else if(p===Array){(b=a.length)<16?zHa[GHa++]=144|b:b<65536?(zHa[GHa++]=220,zHa[GHa++]=b>>8,zHa[GHa++]=255&b):(zHa[GHa++]=221,AHa.setUint32(GHa,b),GHa+=4);for(let q=0;q<b;q++)cIa(a[q])}else if(p===Map)for(let[r,s]of((b=a.size)<16?zHa[GHa++]=128|b:b<65536?(zHa[GHa++]=222,zHa[GHa++]=b>>8,zHa[GHa++]=255&b):(zHa[GHa++]=223,AHa.setUint32(GHa,b),GHa+=4),a))cIa(r),cIa(s);else{for(let t=0,u=xHa.length;t<u;t++)if(a instanceof yHa[t]){let v=xHa[t];if(v.write){v.type&&(zHa[GHa++]=212,zHa[GHa++]=v.type,zHa[GHa++]=0),cIa(v.write.call(this,a));return}let w=zHa,x=AHa,y=GHa;zHa=null;let z;try{z=v.pack.call(this,a,a=>(zHa=w,w=null,(GHa+=a)>BHa&&eIa(GHa),{target:zHa,targetView:AHa,position:GHa-a}),cIa)}finally{w&&(zHa=w,AHa=x,GHa=y,BHa=zHa.length-10)}z&&(z.length+GHa>BHa&&eIa(z.length+GHa),GHa=iIa(z,zHa,GHa,v.type));return}dIa(a,!a.hasOwnProperty)}}else zHa[GHa++]=192;else if("boolean"===c)zHa[GHa++]=a?195:194;else if("bigint"===c){if(a<BigInt(1)<<BigInt(63)&&a>= -(BigInt(1)<<BigInt(63)))zHa[GHa++]=211,AHa.setBigInt64(GHa,a);else if(a<BigInt(1)<<BigInt(64)&&a>0)zHa[GHa++]=207,AHa.setBigUint64(GHa,a);else if(this.largeBigIntToFloat)zHa[GHa++]=203,AHa.setFloat64(GHa,Number(a));else throw new RangeError(a+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");GHa+=8}else if("undefined"===c)this.encodeUndefinedAsNil?zHa[GHa++]=192:(zHa[GHa++]=212,zHa[GHa++]=0,zHa[GHa++]=0);else if("function"===c)cIa(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+c)},dIa=!1===this.useRecords?this.variableMapSize?a=>{let b=Object.keys(a),c=b.length;c<16?zHa[GHa++]=128|c:c<65536?(zHa[GHa++]=222,zHa[GHa++]=c>>8,zHa[GHa++]=255&c):(zHa[GHa++]=223,AHa.setUint32(GHa,c),GHa+=4);let d;for(let e=0;e<c;e++)cIa(d=b[e]),cIa(a[d])}:(a,b)=>{zHa[GHa++]=222;let c=GHa-MHa;GHa+=2;let d=0;for(let e in a)(b||a.hasOwnProperty(e))&&(cIa(e),cIa(a[e]),d++);zHa[(c++)+MHa]=d>>8,zHa[c+MHa]=255&d}:a=>{let b=Object.keys(a),c,d=PHa.transitions||(PHa.transitions=Object.create(null)),e=0;for(let f=0,g=b.length;f<g;f++){let h=b[f];(c=d[h])||(c=d[h]=Object.create(null),e++),d=c}let i=d[JHa];if(i)i>=96&&YHa?(zHa[GHa++]=(31&(i-=96))+96,zHa[GHa++]=i>>5):zHa[GHa++]=i;else{(i=PHa.nextId)||(i=64),i<ZHa&&this.shouldShareStructure&&!this.shouldShareStructure(b)?((i=PHa.nextOwnId)<$Ha||(i=ZHa),PHa.nextOwnId=i+1):(i>=$Ha&&(i=ZHa),PHa.nextId=i+1);let j=b.highByte=i>=96&&YHa?i-96>>5:-1;d[JHa]=i,PHa[i-64]=b,i<ZHa?(b.isShared=!0,PHa.sharedLength=i-63,OHa=!0,j>=0?(zHa[GHa++]=(31&i)+96,zHa[GHa++]=j):zHa[GHa++]=i):(j>=0?(zHa[GHa++]=213,zHa[GHa++]=114,zHa[GHa++]=(31&i)+96,zHa[GHa++]=j):(zHa[GHa++]=212,zHa[GHa++]=114,zHa[GHa++]=i),e&&(aIa+=bIa*e),_Ha.length>=XHa&&(_Ha.shift()[JHa]=0),_Ha.push(d),cIa(b))}for(let k=0,l=b.length;k<l;k++)cIa(a[b[k]])},eIa=a=>{let b;if(a>16777216){if(a-MHa>FHa)throw new Error("Packed buffer would be larger than maximum buffer size");b=Math.min(FHa,4096*Math.round(Math.max((a-MHa)*(a>67108864?1.25:2),4194304)/4096))}else b=(Math.max(a-MHa<<2,zHa.length-1)>>12)+1<<12;let c=new DHa(b);return AHa=new DataView(c.buffer,0,b),zHa.copy?zHa.copy(c,0,MHa,a):c.set(zHa.slice(MHa,a)),GHa-=MHa,MHa=0,BHa=c.length-10,zHa=c}}useBuffer(fIa){zHa=fIa,AHa=new DataView(zHa.buffer,zHa.byteOffset,zHa.byteLength),GHa=0}};function gIa(a,b,c,d){let e=a.byteLength;if(e+1<256){var{target:f,position:g}=c(4+e);f[g++]=199,f[g++]=e+1}else if(e+1<65536){var{target:f,position:g}=c(5+e);f[g++]=200,f[g++]=e+1>>8,f[g++]=e+1&255}else{var{target:f,position:g,targetView:h}=c(7+e);f[g++]=201,h.setUint32(g,e+1),g+=4}f[g++]=116,f[g++]=b,f.set(new Uint8Array(a.buffer,a.byteOffset,a.byteLength),g)}function hIa(a,b){let c=a.byteLength;if(c<256){var d,e,{target:d,position:e}=b(c+2);d[e++]=196,d[e++]=c}else if(c<65536){var{target:d,position:e}=b(c+3);d[e++]=197,d[e++]=c>>8,d[e++]=255&c}else{var{target:d,position:e,targetView:f}=b(c+5);d[e++]=198,f.setUint32(e,c),e+=4}d.set(a,e)}function iIa(a,b,c,d){let e=a.length;switch(e){case 1:b[c++]=212;break;case 2:b[c++]=213;break;case 4:b[c++]=214;break;case 8:b[c++]=215;break;case 16:b[c++]=216;break;default:e<256?(b[c++]=199,b[c++]=e):e<65536?(b[c++]=200,b[c++]=e>>8,b[c++]=255&e):(b[c++]=201,b[c++]=e>>24,b[c++]=e>>16&255,b[c++]=e>>8&255,b[c++]=255&e)}return b[c++]=d,b.set(a,c),c+=e}function jIa(a,b){let c,d=6*b.length,e=a.length-d;for(b.sort((a,b)=>a.offset>b.offset?1:-1);c=b.pop();){let f=c.offset,g=c.id;a.copyWithin(f+d,f,e);let h=f+(d-=6);a[h++]=214,a[h++]=105,a[h++]=g>>24,a[h++]=g>>16&255,a[h++]=g>>8&255,a[h++]=255&g,e=f}return a}function kIa(a){var b;if(a.Class){if(!a.pack&&!a.write)throw new Error("Extension has no pack or write function");if(a.pack&&!a.type)throw new Error("Extension has no type (numeric code to identify the extension)");yHa.unshift(a.Class),xHa.unshift(a)}(b=a).unpack?qGa[b.type]=b.unpack:qGa[b.type]=b}yHa=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,sGa],xHa=[{pack(a,b,c){let d=a.getTime()/1e3;if((this.useTimestamp32||0===a.getMilliseconds())&&d>=0&&d<4294967296){let{target:e,targetView:f,position:g}=b(6);e[g++]=214,e[g++]=255,f.setUint32(g,d)}else if(d>0&&d<17179869184){let{target:h,targetView:i,position:j}=b(10);h[j++]=215,h[j++]=255,i.setUint32(j,4e6*a.getMilliseconds()+(d/1e3/4294967296>>0)),i.setUint32(j+4,d)}else if(isNaN(d)){if(this.onInvalidDate)return b(0),c(this.onInvalidDate());let{target:k,targetView:l,position:m}=b(3);k[m++]=212,k[m++]=255,k[m++]=255}else{let{target:n,targetView:o,position:p}=b(15);n[p++]=199,n[p++]=12,n[p++]=255,o.setUint32(p,1e6*a.getMilliseconds()),o.setBigInt64(p+4,BigInt(Math.floor(d)))}}},{pack(a,b,c){let d=Array.from(a),{target:e,position:f}=b(this.structuredClone?3:0);this.structuredClone&&(e[f++]=212,e[f++]=115,e[f++]=0),c(d)}},{pack(a,b,c){let{target:d,position:e}=b(this.structuredClone?3:0);this.structuredClone&&(d[e++]=212,d[e++]=101,d[e++]=0),c([a.name,a.message])}},{pack(a,b,c){let{target:d,position:e}=b(this.structuredClone?3:0);this.structuredClone&&(d[e++]=212,d[e++]=120,d[e++]=0),c([a.source,a.flags])}},{pack(a,b){this.structuredClone?gIa(a,16,b):hIa(CHa?g.from(a):new Uint8Array(a),b)}},{pack(a,b){let c=a.constructor;c!==EHa&&this.structuredClone?gIa(a,mHa.indexOf(c.name),b):hIa(a,b)}},{pack(a,b){let{target:c,position:d}=b(1);c[d]=193}}];var lIa=new KHa({useRecords:!1});lIa.pack,lIa.pack;var{NEVER:mIa,ALWAYS:nIa,DECIMAL_ROUND:oIa,DECIMAL_FIT:pIa}={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4},qIa=512,rIa=1024,sIa=new KHa({structuredClone:!0});function tIa(a){if(Hza(a))return a;if(Array.isArray(a))return a.map(tIa);if("object"!=typeof a||null===a)return a;{let b={};for(let c of Object.keys(a).sort())b[c]=tIa(a[c]);return Object.setPrototypeOf(b,Object.getPrototypeOf(a)),b}}kIa({Class:mza.prototype.constructor,type:1,write(a){return{...a}},read(a){return Object.setPrototypeOf(a,mza.prototype),a}}),kIa({Class:LBa.prototype.constructor,type:2,write(a){return[...a]},read(a){return Object.setPrototypeOf(a,LBa.prototype),a}}),kIa({Class:Kza.prototype.constructor,type:3,write(a){return[...a]},read(a){return Object.setPrototypeOf(a,Kza.prototype),a}}),kIa({Class:VFa.prototype.constructor,type:4,write(a){return a.id},read(a){return new VFa(a)}}),kIa({Class:XFa.prototype.constructor,type:5,write(a){return a.data},read(a){return new XFa(a)}}),kIa({Class:ICa.prototype.constructor,type:6,write(a){return{...a}},read(a){return Object.setPrototypeOf(a,ICa.prototype),a}}),(a=>{function b(a){return sIa.pack(a)}a.serialize=b,a.deserialize=function(a){return sIa.unpack(a)},a.checksum=function(a){return(function(a){var b=0;if(0===a.length)return b;for(let c=0;c<a.length;c++)b=(b<<5)-b+a[c],b&=b;return b})(b(tIa(a))).toString()}})(vIa||(vIa={})),(uIa=wIa||(wIa={})).toEventUIType=function(a){return"Conditional"===a.type?"Distance"===a.condition.type?"Distance":"StateChange":a.type},uIa.fromEventUIType=function(a){return"Distance"===a||"StateChange"===a?"Conditional":a};var uIa,vIa,wIa,xIa,yIa,zIa,AIa,BIa,CIa,DIa,EIa,FIa,GIa,HIa,IIa,JIa={["LookAt"]:[],["Follow"]:["Create"],["DragDrop"]:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional"],["MouseHover"]:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional"],["Scroll"]:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional"],["Start"]:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],["Conditional"]:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],["MouseDown"]:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],["MouseUp"]:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],["MousePress"]:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],["KeyDown"]:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],["KeyUp"]:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],["KeyPress"]:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional"],["GameControl"]:["Transition","Animation","Audio","Particles","Create","Conditional"],["Collision"]:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional"],["Trigger"]:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],["Resize"]:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],["VariableChange"]:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"]};(yIa=xIa||(xIa={})).is=function(a){return"MouseDown"===a.type||"MouseUp"===a.type||"MousePress"===a.type||"KeyDown"===a.type||"KeyUp"===a.type||"KeyPress"===a.type},yIa.defaultData=function(a){return"MouseDown"===a||"MouseUp"===a||"MousePress"===a?{type:a,mode:"Object",disabled:!1,runMode:"Once",actions:new LBa}:{type:a,disabled:!1,key:void 0,runMode:"Once",actions:new LBa}},(zIa=iJa||(iJa={})).propertyDefaultData=function(a){return{type:"Property",value:[a??null,"position","x"]}},zIa.valueDefaultData={type:"Literal",value:0},(AIa=jJa||(jJa={})).comparisonDefaultData=function(a){return{type:"Comparison",operator:"==",lOperand:iJa.propertyDefaultData(a),rOperand:{...iJa.valueDefaultData}}},AIa.distanceDefaultData=function(a){return{type:"Distance",toObject:a??null,fromObject:a??null,distance:200}},AIa.stateDefaultData=function(a,b){return{type:"State",object:a??null,state:b??null}},(BIa=kJa||(kJa={})).is=function(a){return"Conditional"===a.type},BIa.defaultData=function(a){return{type:"Conditional",disabled:!1,inActions:new LBa,outActions:new LBa,condition:jJa.distanceDefaultData(a)}},(lJa||(lJa={})).defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new LBa,drop:new LBa}},(mJa||(mJa={})).defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new LBa},(nJa||(nJa={})).defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5},(CIa=oJa||(oJa={})).is=function(a){return"MouseHover"===a.type},CIa.defaultData=function(){return{type:"MouseHover",disabled:!1,actions:new LBa}},(DIa=pJa||(pJa={})).is=function(a){return"Scroll"===a.type},DIa.defaultData=function(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new LBa}},(EIa=qJa||(qJa={})).is=function(a){return"Start"===a.type},EIa.defaultData=function(){return{type:"Start",disabled:!1,actions:new LBa}},(FIa=rJa||(rJa={})).is=function(a){return"Collision"===a.type},FIa.defaultData=function(){return{type:"Collision",disabled:!1,runMode:"Once",target:"character",actions:new LBa}},(GIa=sJa||(sJa={})).is=function(a){return"Trigger"===a.type},GIa.defaultData=function(a,b){return{type:"Trigger",disabled:!1,runMode:"Once",target:"all",triggeringObjects:[],actions:new LBa,triggerZone:"box",position:b.toArray(),rotation:[0,0,0],size:a.toArray(),radius:a.length()/2,helperVisible:!0}},(HIa=tJa||(tJa={})).defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]},HIa.is=function(a){return"Resize"===a.type},HIa.sizeToDevice=function(a){return"string"==typeof a?a:"custom"},HIa.deviceToSize=function(a){return"string"==typeof a?[...HIa.defaultSizes[a]]:[...a]},HIa.defaultData=function(){let a={size:"mobile",operator:"<",actions:new LBa},b={size:"tablet",operator:"<",actions:new LBa},c={size:[...HIa.defaultSizes.custom],operator:"<>",actions:new LBa},d=new LBa;return d.push({id:Db.generateUUID(),fi:0,data:a},{id:Db.generateUUID(),fi:1,data:b},{id:Db.generateUUID(),fi:2,data:c}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:d}},HIa.defaultBreakpointData=function(){return{size:[...HIa.defaultSizes.custom],operator:"<>",actions:new LBa}},(IIa=uJa||(uJa={})).propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]},IIa.is=function(a){return"VariableChange"===a.type},IIa.defaultData=function(){return{disabled:!1,type:"VariableChange",actions:new LBa,variableId:"",objectId:null,property:"Position X"}};var KIa,LIa,MIa,NIa,OIa,PIa,QIa="personal camera",RIa="a218fcc3-276b-49b9-b485-49037fd14f5f",SIa=5526619;function TIa(a){return"string"==typeof a&&36===a.length&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(a)}(a=>{function b(a,b){return Math.pow(b[0]-a[0],2)+Math.pow(b[1]-a[1],2)}function c(a,c){return Math.sqrt(b(a,c))}function d(b,c,d){let e=a.sub(c,b),f=a.sub(d,b),g=a.dot(e,f)/a.dot(e,e),h=a.scalarMultiply(e,g);return a.add(b,h)}a.isEqual=function(a,b){return a[0]===b[0]&&a[1]===b[1]},a.lerp=function(a,b,c){return[a[0]+(b[0]-a[0])*c,a[1]+(b[1]-a[1])*c]},a.add=function(a,b){return[a[0]+b[0],a[1]+b[1]]},a.sub=function(a,b){return[a[0]-b[0],a[1]-b[1]]},a.multiply=function(a,b){return[a[0]*b[0],a[1]*b[1]]},a.divide=function(a,b){return[a[0]/b[0],a[1]/b[1]]},a.distanceSquared=b,a.distance=c,a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},a.scalarMultiply=function(a,b){return[a[0]*b,a[1]*b]},a.projectionOnto=d,a.projectionOntoDistance=function(a,b,e){return c(a,d(a,b,e))},a.center=function(a,b){return[(a[0]+b[0])*.5,(a[1]+b[1])*.5]}})(vJa||(vJa={})),(KIa=wJa||(wJa={})).isEqual=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]},KIa.add=function(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]},KIa.sub=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]},KIa.div=function(a,b){return[a[0]/b[0],a[1]/b[1],a[2]/b[2]]},KIa.mul=function(a,b){return[a[0]*b[0],a[1]*b[1],a[2]*b[2]]},KIa.dist=function(a,b){return Math.hypot(a[0]-b[0],a[1]-b[1],a[2]-b[2])},KIa.lerp=function(a,b,c){return[a[0]+(b[0]-a[0])*c,a[1]+(b[1]-a[1])*c,a[2]+(b[2]-a[2])*c]},(LIa=xJa||(xJa={})).isEqual=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]},LIa.lerp=function(a,b,c){return[a[0]+(b[0]-a[0])*c,a[1]+(b[1]-a[1])*c,a[2]+(b[2]-a[2])*c,a[3]+(b[3]-a[3])*c]},(MIa=yJa||(yJa={})).identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],MIa.isEqual=function(a,b){for(let c=0;c<16;c++)if(a[c]!==b[c])return!1;return!0},MIa.simplify=function(a){return a??MIa.identity},MIa.applyMatrix4=function(a,b){let c=b.slice(0);for(var d=0,e=b.length;d<e;d+=3){let f=a[3]*b[d]+a[7]*b[d+1]+a[11]*b[d+2]+a[15];c[d]=(a[0]*b[d]+a[4]*b[d+1]+a[8]*b[d+2]+a[12])/f,c[d+1]=(a[1]*b[d]+a[5]*b[d+1]+a[9]*b[d+2]+a[13])/f,c[d+2]=(a[2]*b[d]+a[6]*b[d+1]+a[10]*b[d+2]+a[14])/f}return c},(NIa=zJa||(zJa={})).isRGB=function(a){return"object"==typeof a&&"number"==typeof a.r&&"number"==typeof a.g&&"number"==typeof a.b},NIa.white={r:1,g:1,b:1},NIa.red={r:1,g:0,b:0},NIa.black={r:0,g:0,b:0},NIa.toRgb255a1=function(a){return{r:Math.round(255*a.r),g:Math.round(255*a.g),b:Math.round(255*a.b),a:1}},NIa.clone=function(a){return{r:a.r,g:a.g,b:a.b}},NIa.fromHex=function(a){return{r:((a=Math.floor(a))>>16&255)/255,g:(a>>8&255)/255,b:(255&a)/255}},NIa.toHex=function(a){return 65536*Math.round(255*a.r)+256*Math.round(255*a.g)+Math.round(255*a.b)},NIa.equals=function(a,b){return a.r===b.r&&a.g===b.g&&a.b===b.b},NIa.equalsFixed=function(a,b){return a.r.toFixed(2)===b.r.toFixed(2)&&a.g.toFixed(2)===b.g.toFixed(2)&&a.b.toFixed(2)===b.b.toFixed(2)},NIa.lerp=function(a,b,c){return{r:a.r+(b.r-a.r)*c,g:a.g+(b.g-a.g)*c,b:a.b+(b.b-a.b)*c}},(OIa=AJa||(AJa={})).white={...zJa.white,a:1},OIa.transparent={...zJa.white,a:0},OIa.from0to1=function(a){return{r:a[0],g:a[1],b:a[2],a:a[3]}},OIa.fromHexAndA=function(a,b){return{...zJa.fromHex(a),a:b}},OIa.toRgb255a1=function(a){return{r:Math.round(255*a.r),g:Math.round(255*a.g),b:Math.round(255*a.b),a:a.a}},OIa.equals=function(a,b){return zJa.equals(a,b)&&a.a===b.a},OIa.equalsFixed=function(a,b){return zJa.equalsFixed(a,b)&&a.a.toFixed(2)===b.a.toFixed(2)},OIa.lerp=function(a,b,c){return{r:a.r+(b.r-a.r)*c,g:a.g+(b.g-a.g)*c,b:a.b+(b.b-a.b)*c,a:a.a+(b.a-a.a)*c}},OIa.toStyle=function({r:a,g:b,b:c,a:d}=OIa.white){return`rgba(${255*a}, ${255*b}, ${255*c}, ${d})`},(BJa||(BJa={})).identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]},(CJa||(CJa={})).defaultData={mass:1,stiffness:80,damping:10,velocity:0},(DJa||(DJa={})).defaultData={control1:[.5,0],control2:[.5,1]},(PIa=EJa||(EJa={})).linear=[0,0,1,1],PIa.ease=[.25,.1,.25,1],PIa.easeIn=[.42,0,1,1],PIa.easeOut=[0,0,.58,1],PIa.easeInOut=[.42,0,.58,1],(VIa=FJa||(FJa={})).all=["PerspectiveCamera","OrthographicCamera"],VIa.is=function(a){return VIa.all.includes(a)},(WIa=GJa||(GJa={})).DefaultUp=[0,1,0],WIa.DefaultTargetOffset=1e3,WIa.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:WIa.DefaultUp,isUpVectorFlipped:!1,targetOffset:WIa.DefaultTargetOffset},WIa.getZoom=function(a){return"PerspectiveCamera"===a.type?a.perspective.zoom:a.orthographic.zoom},(XIa=HJa||(HJa={})).defaultData=function(a,b=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:2*Math.max(a[0],a[1]),start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[a[0]+a[0]*b,0,0]},grid:{count:[2,2,2],size:a.map(a=>a*(1+b)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}},XIa.merge=function(a,b){let c={...a};if(cJa.forEach(d=>{Object.assign(c,{[d]:b[d]??a[d]})}),c.radial={...a.radial},b.radial){let d=a.radial,e=b.radial;dJa.forEach(a=>{Object.assign(c.radial,{[a]:e[a]??d[a]})})}if(c.linear={...a.linear},b.linear){let f=a.linear,g=b.linear;eJa.forEach(a=>{Object.assign(c.linear,{[a]:g[a]??f[a]})})}if(c.grid={...a.grid},b.grid){let h=a.grid,i=b.grid;fJa.forEach(a=>{Object.assign(c.grid,{[a]:i[a]??h[a]})})}if(c.toObject={...a.toObject},b.toObject){let j=a.toObject,k=b.toObject;gJa.forEach(a=>{Object.assign(c.toObject,{[a]:k[a]??j[a]})})}if(c.randomnessObject={...a.randomnessObject},b.randomnessObject){let l=a.randomnessObject,m=b.randomnessObject;hJa.forEach(a=>{Object.assign(c.randomnessObject,{[a]:m[a]??l[a]})})}return c};let UIa;(YIa=IJa||(IJa={})).defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}},UIa=["radial","linear","grid","toObject","randomnessObject"],YIa.toOps=function(a,b){let c=[];for(let d of(void 0!==a.count&&c.push({type:0,path:b,props:{count:a.count}}),UIa)){let e=a[d];e&&Object.keys(e).length>0&&c.push({type:0,path:[...b,d],props:e})}return c};var VIa,WIa,XIa,YIa,ZIa,$Ia,_Ia,aJa,bJa,cJa=["count"],dJa=["radius","start","end","position","scale","rotation"],eJa=["position","scale","rotation"],fJa=["count","size"],gJa=["count","position","scale","rotation"],hJa=["strength","scale","rotation","position","movement","seed","freqScale"];(ZIa=JJa||(JJa={})).all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"],ZIa.is=function(a){return ZIa.all.includes(a)},(KJa||(KJa={})).defaultData=function(a){return(function(a){if("PointLight"===a)return{type:a,color:AJa.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if("SpotLight"===a)return{type:a,color:AJa.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if("DirectionalLight"===a)return{type:a,color:AJa.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")})(a)},($Ia=LJa||(LJa={})).defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},$Ia.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},$Ia.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:$Ia.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeLoopDelayStart:"end",emitTimeDuration:1,...$Ia.defaultCollisionData},(MJa||(MJa={})).defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]},(_Ia=NJa||(NJa={})).defaultData={castShadow:!0,receiveShadow:!0},_Ia.equals=function(a,b){return a.castShadow===b.castShadow&&a.receiveShadow===b.receiveShadow},(aJa=OJa||(OJa={})).defaultData={flatShading:!1,wireframe:!1,side:0},aJa.equals=function(a,b){return a.flatShading===b.flatShading&&a.side===b.side&&a.wireframe===b.wireframe},(PJa||(PJa={})).defaultData={...OJa.defaultData,...NJa.defaultData},(QJa||(QJa={})).getMaterialData=function(a,b){let c=[];if("material"in a){let d="string"==typeof a.material?b.materials[a.material]??b.lib.materials[a.material]?.asset:a.material;d&&c.push(d)}else if("materials"in a)for(let e of a.materials){let f="string"==typeof e?b.materials[e]??b.lib.materials[e]?.asset:e;f&&c.push(f)}return c},(bJa=RJa||(RJa={})).defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},bJa.maxSize=3e7,(SJa||(SJa={})).is=function(a){return"texture"===a||"video"===a||"color"===a||"depth"===a||"normal"===a||"gradient"===a||"noise"===a||"fresnel"===a||"rainbow"===a||"toon"===a||"outline"===a||"particle"===a||"transmission"===a||"matcap"===a||"displace"===a||"pattern"===a||"light"===a},(TJa||(TJa={})).is=function(a){return"phong"===a||"toon"===a||"lambert"===a||"physical"===a};var iJa,jJa,kJa,lJa,mJa,nJa,oJa,pJa,qJa,rJa,sJa,tJa,uJa,vJa,wJa,xJa,yJa,zJa,AJa,BJa,CJa,DJa,EJa,FJa,GJa,HJa,IJa,JJa,KJa,LJa,MJa,NJa,OJa,PJa,QJa,RJa,SJa,TJa,UJa,VJa,WJa=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],XJa=["wrapping","image","video","name","minFilter"];(VJa=UJa||(UJa={})).patch=function(a,b){let{texture:c,...d}=b;if(Object.assign(a,d),c){let e=a.texture;e&&Object.assign(e,c)}},VJa.defaultData=function(a,b){return"light"===a&&b?(function(a){let b={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(a){case"phong":return{...b,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...b,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...b,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...b,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}})(b):(function(a){let b={alpha:1,mode:0,isMask:!1,visible:!0};switch(a){case"texture":return{...b,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],minFilter:1008},crop:!1};case"video":return{...b,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:RJa.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],minFilter:1008},crop:!1};case"color":return{...b,type:"color",color:zJa.fromHex(SIa)};case"depth":return{...b,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...b,type:"normal",cnormal:[1,1,1]};case"gradient":return{...b,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...b,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...zJa.fromHex(6710886),a:1},colorB:{...zJa.fromHex(6710886),a:1},colorC:{...zJa.fromHex(16777215),a:1},colorD:{...zJa.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...b,type:"fresnel",color:AJa.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...b,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...b,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:AJa.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...b,type:"outline",outlineColor:AJa.fromHexAndA(0,1),contourColor:AJa.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...b,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],minFilter:1008}};case"transmission":return{...b,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...b,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...zJa.fromHex(0),a:1},colorB:{...zJa.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}})(a)},(a=>{function b(a,b="layer1",c="layer2"){let d=new LBa;return d.push({fi:0,data:UJa.defaultData("light",a),id:b}),d.push({fi:1,data:UJa.defaultData("color"),id:c}),{layers:d}}a.isMergable=function(a){return!a.layers.some(a=>"texture"===a.data.type&&0!==a.data.projection||"depth"===a.data.type&&!a.data.isWorldSpace||"noise"===a.data.type||"displace"===a.data.type)},a.getHash=function(a){let b="";return a.layers.forEach(a=>{Object.entries(a.data).forEach(([a,c])=>{b+=`${a}${c}`,Array.isArray(c)?c.forEach(a=>b+=`${a}`):"object"==typeof c?Object.values(c).forEach(a=>{"number"==typeof a?b+=`${a.toFixed(4)}`:b+=`${a}`}):b+=`${c}`})}),b},a.defaultEmptyData=function(){return{layers:new LBa}},a.defaultData=function(a="layer1",c="layer2"){return b("phong",a,c)},a.withName=function(a,b){return{...a,name:b}},a.defaultTwoLayerData=b,a.defaultUIObjectMaterial=function(a){let b=UJa.defaultData("texture");a&&Object.assign(b.texture,{image:a});let c=new LBa;return c.push({fi:0,data:b,id:"layer1"}),c.push({fi:1,data:{...UJa.defaultData("transmission"),alpha:1},id:"layer2"}),c.push({fi:2,data:{...UJa.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:c}},a.defaultTwoLayerTextureData=function(a,b="phong",c="layer1",d="layer2"){let e=UJa.defaultData("texture");Object.assign(e.texture,{image:a});let f=new LBa;return f.push({fi:0,data:e,id:c}),f.push({fi:1,data:UJa.defaultData("light",b),id:d}),{layers:f}},a.defaultTwoLayerVideoTextureData=function(a,b="phong",c="layer1",d="layer2"){let e=UJa.defaultData("video");Object.assign(e.texture,{video:a});let f=new LBa;return f.push({fi:0,data:e,id:c}),f.push({fi:1,data:UJa.defaultData("light",b),id:d}),{layers:f}}})(oNa||(oNa={})),(pNa||(pNa={})).defaultData=function(){return{points:new LBa,roundness:0,shapeHoles:[],isClosed:!1}},(qNa||(qNa={})).defaultData=function(){return{points:new LBa,lastInsertionPlane:null,subdivisions:12,isClosed:!1}};var YJa={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0};(rNa||(rNa={})).merge=function(a,b){let c={...a};return _Ja.forEach(d=>{Object.assign(c,{[d]:b[d]??a[d]})}),c};var ZJa,$Ja={shape:YJa,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},_Ja=["depth","offset","angle","twist","startScale","endScale"];(ZJa=sNa||(sNa={})).is2DParametricMesh=function(a){return"PolygonGeometry"===a||"RectangleGeometry"===a||"StarGeometry"===a||"TriangleGeometry"===a||"EllipseGeometry"===a||"UIGeometry"===a},ZJa.isParametricMesh=function(a){return"PolygonGeometry"===a||"PolygonGeometry"===a||"RectangleGeometry"===a||"StarGeometry"===a||"TriangleGeometry"===a||"EllipseGeometry"===a||"PathGeometry"===a||"VectorGeometry"===a||"ConeGeometry"===a||"CubeGeometry"===a||"CylinderGeometry"===a||"DodecahedronGeometry"===a||"HelixGeometry"===a||"IcosahedronGeometry"===a||"LatheGeometry"===a||"PyramidGeometry"===a||"SphereGeometry"===a||"PlaneGeometry"===a||"BackdropGeometry"===a||"TorusGeometry"===a||"TorusKnotGeometry"===a||"BooleanGeometry"===a||"TextGeometry"===a},(tNa||(tNa={})).merge=function(a,b){let c={...a};return Object.assign(c,b),"PathGeometry"===c.type&&"extrusion"in b&&b.extrusion&&(c.extrusion={...a.extrusion},Object.assign(c.extrusion,rNa.merge(c.extrusion,b.extrusion))),c},(uNa||(uNa={})).defaultData=function(a){if("RectangleGeometry"===a)return{width:320,height:320,type:a,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("UIGeometry"===a)return{type:a,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if("PathGeometry"===a)return{type:a,width:1,height:1,depth:1,path:qNa.defaultData(),extrusion:$Ja};if("VectorGeometry"===a)return{width:1,height:1,type:a,subdivisions:12,shape:pNa.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("BooleanGeometry"===a)return{type:a,operation:2,width:0,height:0,depth:0,phongAngle:35};if("TextGeometry"===a)return{type:a,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",extrudeBevelSize:0,extrudeBevelSegments:1};if("SphereGeometry"===a)return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")};var aKa=["width","height","depth"];(vNa||(vNa={})).defaultData={enabled:!1,useBackgroundColor:!1,color:zJa.white,near:.1,far:2e3};let bKa;function cKa(a){a.layers.forEach(a=>{if("depth"===a.type&& void 0!==a.colorA){let b=a.colorA,c=a.colorB,d=[[b.r,b.g,b.b,b.a],[c.r,c.g,c.b,c.a]],e=[0,1];for(let f=2;f<10;f++)d.push(d[1]),e.push(1);let g={...Eya(SFa(a),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,a.near),far:Math.max(0,a.far),colors:d,steps:e,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(a,g)}else if("depth"===a.type&&1===a.gradientType&&(a.near<0||a.far<0)){let h={...SFa(a),near:Math.max(a.near,0),far:Math.max(a.far,0)};Object.assign(a,h)}})}function dKa(a,b){Object.values(a.shared.materials).forEach(a=>b(a))}function eKa(a,b){a.scene.objects.traverse((a,c)=>{"materials"in c?c.materials.forEach((a,d)=>{void 0===a&&(c.materials[d]=oNa.defaultData(),a=c.materials[d]),"string"!=typeof a&&b(a)}):"material"in c?"string"!=typeof c.material&&(void 0===c.material&&(c.material=oNa.defaultData()),b(c.material)):"Mesh"===c.type&&(void 0===c.material&&(c.material=oNa.defaultData()),b(c.material)),"overrides"in c&&Object.values(c.overrides).forEach(a=>{a.material&&"string"!=typeof a.material&&Object.getPrototypeOf(a.material)!==ICa.prototype&&b(a.material)})})}function fKa(a){void 0===a.layers&&Object.assign(a,oNa.defaultTwoLayerData("lambert"))}function gKa(a){a.layers&&a.layers.forEach(a=>{if("depth"===a.type&&10===a.colors.length){let b=[...a.colors];b.push(a.colors[9]);let c=[...a.steps];c.push(a.steps[9]);let d={...SFa(a),colors:b,steps:c};Object.assign(a,d)}})}function hKa(a){a.scene.objects.traverse((a,b)=>{"materials"in b?b.materials.forEach(a=>{"string"!=typeof a&&gKa(a)}):"material"in b&&"string"!=typeof b.material&&gKa(b.material)}),Object.values(a.shared.materials).forEach(a=>gKa(a))}function iKa(a){a.layers&&a.layers.forEach(a=>{"depth"===a.type&& void 0!==a.num&&(a.colors=a.colors.slice(0,a.num),a.steps=a.steps.slice(0,a.num),delete a.num)})}function jKa(a){a.layers&&a.layers.forEach(a=>{"displace"!==a.type&& void 0===a.isMask&&(a.isMask=!1),("texture"===a.type||"video"===a.type)&& void 0===a.blending&&(a.blending=0),("noise"===a.type||"displace"===a.type&&"noise"===a.displacementType)&&(void 0===a.voronoiStyle&&(a.voronoiStyle=0),void 0===a.highCut&&(a.highCut=1),void 0===a.lowCut&&(a.lowCut=0),void 0===a.smoothness&&(a.smoothness=.3),void 0===a.seed&&(a.seed=0),void 0===a.quality&&(a.quality=1))})}function kKa(a){let b=a.layers.find(a=>"light"===a.type)?.data;if(b?.category==="basic"){let c=UJa.defaultData("light","phong"),d=b;Object.assign(d,c),d.visible=!1}}function lKa(a){dKa(a,kKa),eKa(a,kKa)}function mKa(a){a.layers.forEach(a=>{"light"===a.type&&"toon"!==a.category&& void 0===a.occlusion&&(a.occlusion=!0)})}function nKa(a){a.layers&&a.layers.forEach(a=>{"light"===a.type&& void 0===a.bumpMapIntensity&&(a.bumpMapIntensity=5)})}function oKa(a){a.layers&&a.layers.forEach(a=>{"light"===a.type&& void 0===a.alphaOverride&&(a.alphaOverride=1)})}bKa={opacity:1,blendFunction:13,enabled:!1},(wNa||(wNa={})).defaultData={enabled:!1,pixelation:{...bKa,blendFunction:16,granularity:15},bloom:{...bKa,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...bKa,offset:[2,2]},vignette:{...bKa,darkness:1,offset:0},hueSaturation:{...bKa,hue:3,saturation:0},brightnessContrast:{...bKa,brightness:.25,contrast:0},depthOfField:{...bKa,focalLength:2,focusDistance:2,bokehScale:2},noise:{...bKa,blendFunction:16}},(xNa||(xNa={})).defaultData={softShadowQuality:"low"},(yNa||(yNa={})).defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75},(zNa||(zNa={})).defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}},(ANa||(ANa={})).defaultData={usePhysics:!1,gravity:-10},(BNa||(BNa={})).defaultData={playCamera:QIa,gameControlObject:null},(CNa||(CNa={})).defaultData={backgroundColor:AJa.fromHexAndA(2960946,1),postprocessing:wNa.defaultData,fog:vNa.defaultData,globalPhysics:ANa.defaultData,ambient:yNa.defaultData,ao:zNa.defaultData,shadow:xNa.defaultData,publish:BNa.defaultData},(DNa||(DNa={})).defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95},(_Ma=ENa||(ENa={})).isComponentRelated=function(a){return"Component"===a||"Instance"===a},_Ma.isEmptyOrComponent=function(a){return"Empty"===a||"Instance"===a},(aNa=FNa||(FNa={})).identity={...BJa.identity,hiddenMatrix:yJa.identity},aNa.fromObject=function(a){return{position:a.position,rotation:a.rotation,scale:a.scale,hiddenMatrix:a.hiddenMatrix}},aNa.merge=function(a,b){return{position:b?.position||a.position,rotation:b?.rotation||a.rotation,scale:b?.scale||a.scale,hiddenMatrix:b?.hiddenMatrix||a.hiddenMatrix}},aNa.diff=function(a,b){return Fya({position:wJa.isEqual(a.position,b.position)?void 0:b.position,rotation:wJa.isEqual(a.rotation,b.rotation)?void 0:b.rotation,scale:wJa.isEqual(a.scale,b.scale)?null:b.scale,hiddenMatrix:yJa.isEqual(a.hiddenMatrix,b.hiddenMatrix)?void 0:b.hiddenMatrix})},(GNa||(GNa={})).defaultData={states:new LBa,events:new LBa,visible:!0,raycastLock:!1,physics:MJa.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...FNa.identity,cloner:null},(HNa||(HNa={})).defaultData={type:"Empty",...GNa.defaultData},(INa||(INa={})).defaultData={type:"ParticleCollider",...DNa.defaultData,...GNa.defaultData},(JNa||(JNa={})).defaultData={type:"Component",...GNa.defaultData},(KNa||(KNa={})).defaultData={type:"Particle",...GNa.defaultData,...LJa.defaultData},(LNa||(LNa={})).defaultData={type:"Mesh",...GNa.defaultData,...PJa.defaultData},(MNa||(MNa={})).defaultData={...GNa.defaultData,...FNa.identity,position:[0,0,GJa.DefaultTargetOffset],...GJa.defaultData},(bNa=NNa||(NNa={})).defaultData=function(a){return{...GNa.defaultData,...KJa.defaultData(a)}},bNa.defaultDirectionalLightData={...bNa.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7},(a=>{function b(a,b,c=0){for(;c<b.length;){let d=a?a[b[c]]:void 0;if(b.length===c+1)return d;if(!d)return;a=d.descendants,c+=1}}a.resolveWithDes=b,a.resolve=function(a,c,d=0){let e=b(a,c,d);if(e){let f=Object.keys(e);if(1===f.length&&"descendants"===f[0])return}return e}})(ONa||(ONa={})),(a=>{function b(a,b){return{...GNa.defaultData,...b,component:a,overrides:new ICa,physics:void 0,events:void 0,type:"Instance"}}a.rootOverrideProps=["physics","events"],a.compositeNonOptionalOverrideProps=["geometry"],a.compositeEntireOverrideOverrideProps=["material"],a.ofComponent=b,a.fromComponentData=function(a){let c=FNa.fromObject(a.data);return b(a.id,c)}})(PNa||(PNa={})),(cNa=QNa||(QNa={})).defaultData={type:"Page",...GNa.defaultData,physics:{...MJa.defaultData,fusedBody:!1},...CNa.defaultData,camera:MNa.defaultData},cNa.isUIPage=function(a){return void 0!==a.uiScene},(dNa=RNa||(RNa={})).defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:yJa.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:MJa.defaultData,states:new LBa,events:new LBa,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...GJa.defaultData},dNa.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},dNa.defaultMeshObject={name:"Rectangle",...GNa.defaultData,...LNa.defaultData,geometry:uNa.defaultData("RectangleGeometry"),material:oNa.defaultTwoLayerData("phong","layer1","layer2")},dNa.defaultBooleanObject={name:"Boolean",...GNa.defaultData,...LNa.defaultData,geometry:uNa.defaultData("BooleanGeometry"),material:oNa.defaultTwoLayerData("phong","layer1","layer2")},dNa.defaultTextObject={name:"Text",...GNa.defaultData,...LNa.defaultData,geometry:uNa.defaultData("TextGeometry"),material:oNa.defaultTwoLayerData("phong","layer1","layer2")},(eNa=SNa||(SNa={})).newEmpty=function(a,b){let c={name:b};return"Mesh"===a.type?(c.geometry={},"material"in a&&(c.material={layers:new ICa}),"materials"in a&&(c.materials=a.materials.map(a=>({layers:new ICa})))):FJa.is(a.type)&&(c.perspective={},c.orthographic={}),c},eNa.toOps=function(a,b){let c,d=[],e={orthographic:0,perspective:0,geometry:0};function f(a,b){for(let[c,e]of Object.entries(b.layers)){let{texture:f,...g}=e;if(void 0!==f&&Object.keys(f).length>0){let h={path:[...a,"layers",c,"texture"],props:f,type:0};d.push(h)}if(Object.keys(g).length>0){let i={path:[...a,"layers",c],props:g,type:0};d.push(i)}}}for(let[g,h]of Object.entries(b))if("name"!==g)if("cloner"===g)d.push(...IJa.toOps(h,["cloner"]));else if("pathSnapping"===g)d.push({path:[g],props:{slide:h.slide,offset:h.offset},type:0});else if("material"===g)f(["material"],h);else if("materials"===g)for(let[i,j]of Object.entries(h))f(["materials",i],j);else if(0===e[g]){if("geometry"===g&& void 0!==h.extrusion){let k={path:[g,"extrusion"],props:h.extrusion,type:0};d.push(k),delete(h={...h}).extrusion}if(Object.keys(h).length>0){let l={path:[g],props:h,type:0};d.push(l)}}else void 0===c&&(c={path:[],props:{},type:0},d.push(c)),c.props[g]=h;return d},eNa.patch=function(a,b){if(void 0===b)return a;let c={...a};if(Object.assign(c,FNa.merge(c,b)),Object.assign(c,{pathSnapping:Object.assign({},c.pathSnapping,{slide:(b.pathSnapping?.slide??c.pathSnapping?.slide)??0,offset:(b.pathSnapping?.offset??c.pathSnapping?.offset)??0})}),FJa.is(a.type)){c.orthographic={...c.orthographic},c.perspective={...c.perspective};let d=b;d.orthographic?.zoom!==void 0&&(c.orthographic.zoom=d.orthographic.zoom),d.perspective?.zoom!==void 0&&(c.perspective.zoom=d.perspective.zoom),void 0!==d.isUpVectorFlipped&&(c.isUpVectorFlipped=d.isUpVectorFlipped),void 0!==d.targetOffset&&(c.targetOffset=d.targetOffset)}else if("Mesh"===a.type)"geometry"in b&&Object.assign(c,{geometry:tNa.merge(c.geometry,b.geometry)}),(b.material||b.materials)&&(c=(function(a,b){if(void 0===b)return a;let c={...a};return"material"in c&&"material"in b&&b.material&&(c.material=RFa(c.material,a=>{if("string"!=typeof a)for(let[c,d]of Object.entries(b.material.layers)){let e=a.layers.data(c);e&&UJa.patch(e,d)}}).data),c.materials&&b.materials&&(c.materials=RFa(c.materials,a=>{for(let d=0;d<c.materials.length;d++){let e=b.materials[d];if("string"!=typeof e)for(let[f,g]of Object.entries(e.layers)){let h=a[d]?.layers?.data(f);h&&UJa.patch(h,g)}}}).data),c})(c,b)),c.cloner&&"cloner"in b&&Object.assign(c,{cloner:HJa.merge(c.cloner,b.cloner)});else if("Empty"===a.type)c.cloner&&"cloner"in b&&Object.assign(c,{cloner:HJa.merge(c.cloner,b.cloner)});else if(JJa.is(a.type)){let e=b;void 0!==e.intensity&&(c.intensity=e.intensity),void 0!==e.color&&("string"==typeof e.color?c.color=e.color:c.color=zJa.clone(e.color))}return c},(TNa||(TNa={})).defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0},(UNa||(UNa={})).defaultData={orbitControls:TNa.defaultData,playPage:RIa,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((a,b)=>{let c=0,d=0;return b<5?d=-30:b<10&&(d=30),0===b||10===b||5===b?c=30:(4===b||11===b||9===b)&&(c=-30),[120,[c,d],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,"u">typeof window?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1}},stopRaycast:!0,hdTransmission:!1},(VNa||(VNa={})).defaultData={id:"basic",label:"Basic",style:"None",prompt:""},(WNa||(WNa={})).defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0},(fNa=XNa||(XNa={})).defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...VNa.defaultData},isRandomSeed:!0,seed:fNa.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:WNa.defaultData}),fNa.generateSeed=()=>Math.round(1e5*Math.random()),(gNa=YNa||(YNa={})).physicsEnabled=function(a){return void 0!==a.find(a=>"Page"===a.data.type&&a.data.globalPhysics.usePhysics)},gNa.traverseModuleInstances=function(a,b,c){a.scene.objects.traverseFrom(b,(b,d)=>{if("Instance"===d.type){let e=iOa.getComponentData(a,d.component)?.data;e&&c(b,d,e.events)}else c(b,d,d.events)})},(a=>{function b(a={withLight:!0,withSquare:!0}){let b=[],c=RNa.defaultMeshObject;!0===a.withLight&&b.push({fi:-1,data:NNa.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]}),!0===a.withSquare&&b.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:c,children:[]});let d=new Kza;return d.push({fi:1,id:RIa,data:{...QNa.defaultData,name:"Scene 1"},children:b}),d}function c(b){return{...a.defaultData,objects:Gya(b,Kza.prototype)}}a.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",a.defaultData={objects:b(),publish:UNa.defaultData,styles:XNa.defaultData()},a.emptyDataWithoutPage=function(){return{objects:new Kza,publish:UNa.defaultData,styles:XNa.defaultData()}},a.emptyDataWithPage=function(a){return{objects:b(a),publish:UNa.defaultData,styles:XNa.defaultData()}},a.emptyData=function(){return{objects:new Kza,publish:{...UNa.defaultData},styles:XNa.defaultData()}},a.withObjs=c,a.withObj=function(a,b){return c([{id:a,data:b,children:[],fi:0}])}})(ZNa||(ZNa={})),($Na||($Na={})).defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}},(_Na||(_Na={})).emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"},(a=>{function b(a){return void 0!==a.textValue}function c(a){return"boolean"==typeof a}a.isTextValue=b,a.isNumber=function(a){return"number"==typeof a},a.isBoolean=c,a.typeOfVariable=function(a){return b(a)?"string":c(a)?"boolean":"number"},a.getDisplayedValue=function(b){return a.isTextValue(b)?Array.isArray(b.textValue)?b.textValue.map(a=>a.toString().padStart(b.padding??2,"0")).join(b.deliminator??":")+(void 0!==b.suffix?" "+b.suffix:""):b.textValue.toString():a.isBoolean(b)?b?"True":"False":a.isNumber(b)?parseFloat(b.toFixed(3)).toString():b.toString()}})(aOa||(aOa={})),(bOa||(bOa={})).all=["images","videos","colors","audios","particles","fonts","materials","variables"],(cOa||(cOa={})).all=[...bOa.all,"components"],(dOa||(dOa={})).defaultData=function(){return{images:new mza,videos:new mza,colors:new mza,audios:new mza,particles:new mza,fonts:new mza,materials:new mza,components:new mza,variables:new mza}},(eOa||(eOa={})).defaultData=function(){return{images:new mza,videos:new mza,colors:new mza,audios:new mza,particles:new mza,fonts:new mza,materials:new mza,components:new mza,variables:new mza}},(hNa=fOa||(fOa={})).defaultColors=function(){let a={};return a["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},Gya(a,mza.prototype)},hNa.defaultImages=function(a){let b={};return a?.withAITexture&&(b["a1b10010-844c-a8a3-11ec-0242ac2011ec"]={..._Na.emptyImage,name:"AI generated image"}),Gya(b,mza.prototype)},hNa.emptyData=function(){return{catelogs:new mza,materials:new mza,images:new mza,videos:new mza,colors:new mza,audios:new mza,particles:new mza,fonts:new mza,variables:new LBa,lib:eOa.defaultData()}},hNa.defaultVariables=function(a){switch(a){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let b=[0,0,0];return{name:"Time",value:{textValue:b,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:b,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",a)}},hNa.getFormattedTimerTime=function(a,b){if("HH:mm:ss"===b.format){let c=Math.floor(a/3600),d=Math.floor((a-3600*c)/60),e=Math.round(a-3600*c-60*d);return{textValue:[c,d,e]}}{if("mm:ss"!==b.format)return a="number"===b.format?Math.round(a):Math.round(1e3*a)/1e3;let f=Math.floor(a/60),g=Math.round(a-60*f);return{textValue:[f,g]}}},(gOa||(gOa={})).list=["idle","move","jump","run"],(iNa=hOa||(hOa={})).defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},iNa.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX",""],["rotPosY",""],["rotNegX",""],["rotNegY",""],["jump","Space"],["run",""],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:iNa.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new LBa,move:new LBa,jump:new LBa,run:new LBa},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:AJa.fromHexAndA(3728051,1)}};var pKa=180/Math.PI;function qKa(a){a.rotation=a.rotation.slice(0,3).map(a=>a*pKa)}function rKa(a){qKa(a),"Page"===a.type&&qKa(a.camera),a.states?.forEach(a=>{void 0===a.rotation||null===a.rotation||(a.rotation=a.rotation.slice(0,3).map(a=>a*pKa))});let b=a.geometry;b&&"SphereGeometry"===b.type&&(b.thetaLength=(b.thetaLength??180)*pKa),b&&"TorusGeometry"===b.type&&(b.arc=b.arc*pKa),b&&"PathGeometry"===b.type&&(b.extrusion.angle*=pKa,b.extrusion.twist*=pKa),"Mesh"===a.type&&"TextGeometry"===a.geometry.type&&(a.geometry.text={textValue:a.geometry.text}),Array.isArray(SFa(a.events))&&a.events?.forEach(a=>{("MouseDown"===a.type||"MouseUp"===a.type||"MousePress"===a.type||"KeyDown"===a.type||"KeyUp"===a.type||"KeyPress"===a.type||"Collision"===a.type||"Trigger"===a.type)&&(a.runMode=a.toggle?"Toggle":"Repeat")})}function sKa(a,b){for(let c of(b(a.data),a.children))sKa(c,b)}function tKa(a){let b=a.schema??104;111!==b&&b<105&&(sKa(a.asset,rKa),a.schema=105)}function uKa(a){let b=a.schema??0;if(111!==b){var c,d;for(let e of(console.warn("updating from ",b,"to ",111),(function(a,b){var c,d,e,f,g,h,i,j,k;let l,m;if(b<1&&(eKa(a,cKa),dKa(a,cKa),a.schema=1),b<2&&(c=a,Object.assign(c.scene.publish,{orbitControls:{...TNa.defaultData,...SFa(c.scene.publish.orbitControls)}}),a.schema=2),b<3&&((function(a){function b(a){if(a.layers){for(let b of Object.values(a.layers))if(b){for(let[c,d]of Object.entries(b))if((WJa.includes(c)||"boolean"==typeof d)&&delete b[c],"texture"===c)for(let[e,f]of Object.entries(d))(XJa.includes(e)||"boolean"==typeof f)&&delete d[e]}}}a.scene.objects.traverse((a,c)=>{c.states.forEach(a=>{let c=a;c.material?b(c.material):c.materials&&c.materials.forEach(a=>{b(a)})})})})(a),a.schema=3),b<4&&(a.scene.publish.withBackground=!0,a.schema=4),b<5&&(a.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1},a.schema=5),b<6&&((function(a){a.scene.objects.traverse((a,b)=>{let c=b.cloner;c&&(c.radial.scale=c.radial.scale.map(a=>a+1),c.linear.scale=c.linear.scale.map(a=>a+1))})})(a),a.schema=6),b<7&&((function(a){a.scene.objects.traverse((a,b)=>{let c=b.geometry;c&&("DodecahedronGeometry"===c.type||"IcosahedronGeometry"===c.type)&&(c.detail=Math.round(c.detail))})})(a),a.schema=7),b<8&&(a.schema=8),b<9&&(hKa(a),a.schema=9),b<10&&((function(a){a.scene.objects.traverse((a,b)=>{"Mesh"===b.type&&("BooleanGeometry"===b.geometry.type||"SubdivGeometry"===b.geometry.type)&&(b.geometry.phongAngle=35)})})(a),a.schema=10),b<11&&((d=a).scene.environment.ambientLight.softShadows=!1,d.scene.environment.ambientLight.softShadowQuality="low",d.scene.objects.traverse((a,b)=>{("DirectionalLight"===b.type||"SpotLight"===b.type)&&(b.shadowResolution=1024,b.shadowRadius=1,b.depth=1e5)}),d.shared.penumbraSize=new Array(5).fill(.5),a.schema=11),b<12&&(hKa(a),a.schema=12),b<13&&(a.shared.audios=Gya({},mza.prototype),a.schema=13),b<14&&(l=a.shared.materials,Object.entries(l).forEach(([a,b])=>{if(!b.layers){let c={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(l,{[a]:c})}}),a.schema=14),b<15&&(e=a,Object.entries(SFa(e.shared.images)).filter(a=>!1===a[1].asset).map(a=>a[0]).forEach(a=>{delete e.shared.images[a]}),Object.entries(SFa(e.shared.audios)).filter(a=>!1===a[1].asset).map(a=>a[0]).forEach(a=>{delete e.shared.audios[a]}),a.schema=15),b<16&&(a.scene.publish.settings.web.preload=!1,a.schema=16),b<17&&(eKa(a,iKa),dKa(a,iKa),a.schema=17),b<18&&(eKa(a,fKa),dKa(a,fKa),a.schema=18),b<19&&(f=a,Object.assign(f.scene.publish.settings,{video:{...UNa.defaultData.settings.video,...SFa(f.scene.publish.settings.video)}}),a.schema=19),b<20&&(a.shared.fonts=Gya({},mza.prototype),m=[],(g=a).scene.objects.traverse((a,b)=>{let c=b;if("TextFrame"===c.type){let d=oNa.defaultTwoLayerData("phong"),e="string"==typeof c.color?g.shared.colors[c.color]:c.color;d.layers[1].data.color={r:e.r,g:e.g,b:e.b},d.layers[1].data.alpha=c.alpha;let f=c.font.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ");void 0===g.shared.fonts[f]&&(g.shared.fonts[f]={name:f});let h={name:c.name,...GNa.defaultData,...LNa.defaultData,flatShading:!1,wireframe:!1,geometry:{...uNa.defaultData("TextGeometry"),width:c.width,height:c.height,font:f,depth:0,horizontalAlign:c.horizontalAlign,verticalAlign:c.verticalAlign,fontSize:1.40625*c.fontSize,lineHeight:c.lineHeight/1.40625,letterSpacing:c.letterSpacing-1,text:c.text,textTransform:c.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:d,states:SFa(c.states),events:SFa(c.events),visible:c.visible,raycastLock:c.raycastLock,position:c.position,rotation:c.rotation,scale:c.scale,hiddenMatrix:c.hiddenMatrix},i=SFa(g.scene.objects).parent(a);g.scene.objects.insertAfter(i??null,a,[{id:a+"new",data:h,children:[]}]),m.push(a)}}),m.forEach(a=>{g.scene.objects.delete(a)}),a.schema=20),b<21&&((function(a){let b={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};a.scene.objects.traverse((a,c)=>{c.events.forEach(a=>{if(b[Number(a.type)])if(Object.assign(a,{type:b[Number(a.type)]}),"Audio"===a.type&&"audioEvent"in a&&(Object.assign(a,{playAudio:a.audioEvent}),delete a.audioEvent),"GameControl"===a.type)Object.assign(a,{gameActions:{idle:new LBa,move:new LBa,jump:new LBa}});else{let c=new LBa;Object.assign(a,{actions:c}),("MouseDown"===a.type||"MouseUp"===a.type||"KeyDown"===a.type||"KeyUp"===a.type)&&"url"in a&&c.push({fi:0,id:Db.generateUUID(),data:{type:"Link",url:a.url,delay:0}}),"targets"in a&&(a.targets.forEach((a,b,d)=>{let e={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},f={easing:a.easing,duration:a.duration};6===a.easing?Object.assign(f,Eya(a,"mass","stiffness","damping","velocity")):5===a.easing&&Object.assign(f,{control1:{...a.control1},control2:{...a.control2}});let g={repeat:a.repeat?-1:0,delay:a.delay,delayDirection:a.delayDirection,direction:a.cycle&&a.rewind?"pingpong-rewind":a.cycle?"pingpong":"normal"},h={state:a.state,...g,...f},i={allowSlerp:!0,type:"Transition",object:a.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new LBa({fi:0,id:Db.generateUUID(),data:e},{fi:1,id:Db.generateUUID(),data:h})};c.push({fi:d,id:b,data:i})}),delete a.targets)}})})})(a),(function(a){a.scene.objects.traverse((a,b)=>{function c(a,c){let d=new LBa,e=[];if(b.events.forEach((a,b,f)=>{if("Audio"===a.type&&a.trigger===c){let g;e.push(b),"play"===a.interaction?g={...Eya(a,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in a?a.after:void 0,toggle:"after"in a?a.toggle:void 0,type:"Audio"}:("pause"===a.interaction||"stop"===a.interaction)&&(g={...Eya(a,"interaction","delay","object","playAudio"),type:"Audio"}),g&&d.push({fi:f,id:b,data:g})}}),e.forEach(a=>b.events.delete(a)),d.length){let f=b.events.find(b=>b.type===a)?.data;f?"actions"in f&&f.actions.insertBefore(null,d):b.events.insertBefore(null,[{id:Db.generateUUID(),data:{type:a,actions:d}}])}}c("Start","start"),c("MouseDown","mouseDown"),c("MouseUp","mouseUp"),c("KeyDown","keyDown"),c("KeyUp","keyUp")})})(a),a.schema=21),b<22&&(lKa(a),a.schema=22),b<23&&((function(a){a.scene.objects.traverse((a,b)=>{"Mesh"===b.type&&"SubdivGeometry"===b.geometry.type&&(b.geometry.scaleBaked||(b.geometry.scaleBaked=[1,1,1]))})})(a),a.schema=23),b<24&&((function(a){a.scene.objects.traverse((a,b)=>{"Empty"!==b.type&&"Mesh"!==b.type||!b.cloner||b.cloner.randomnessObject||b.cloner.toObject||b.cloner.randomness||(b.cloner={...b.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})})(a),a.schema=24),(b<25|| void 0===a.shared.videos)&&(a.shared.videos=Gya({},mza.prototype),b<25&&(a.schema=25)),b<26&&((function(a){a.scene.objects.traverse((b,c)=>{let d=a.scene.objects.unproxy().parent(b);if(d){let e=SFa(a.scene.objects.data(d));e&&"Mesh"===e.type&&"BooleanGeometry"===e.geometry.type&&"Mesh"===c.type&&(c.visible=!0!==SFa(c).booleanExclude)}})})(a),a.schema=26),b<27&&((function(a){a.scene.objects.traverse((a,b)=>{if("Mesh"===b.type){let c=b;"NonParametricGeometry"===b.geometry.type?void 0!==c.material&&delete c.material:void 0!==c.materials&&delete c.materials}})})(a),a.schema=27),b<28&&(lKa(a),a.schema=28),b<29&&((function(a){function b(a){Object.setPrototypeOf(a,ICa.prototype),a.texture&&Object.setPrototypeOf(a.texture,ICa.prototype)}function c(a){for(let c in Object.setPrototypeOf(a,ICa.prototype),a)b(a[c])}a.scene.objects.traverse((a,b)=>{b.states.forEach(a=>{let b=a;if(b.material){let d=SFa(b.material).layers;c(d),b.material.layers=d}if(b.materials)for(let e=0;e<b.materials.length;e++){let f=b.materials[e],g=SFa(f).layers;c(g),f.layers=g}})})})(a),a.schema=29),b<30&&((function(a){a.scene.objects.traverse((a,b)=>{"Mesh"!==b.type||"NonParametricGeometry"!==b.geometry.type||"material"in b||"materials"in b||(b.material=oNa.defaultTwoLayerData("phong"))})})(a),a.schema=30),b<31&&(void 0===(h=a).scene.publish.orbitControls.autoZoom&&(h.scene.publish.orbitControls.autoZoom=!1),h.scene.objects.traverse((a,b)=>{("OrthographicCamera"===b.type||"PerspectiveCamera"===b.type)&&(void 0===b.orthographic.autoZoom&&(b.orthographic.autoZoom=!1),void 0===b.orthographic.autoZoomFrustumSize&&(b.orthographic.autoZoomFrustumSize=790))}),a.schema=31),b<33&&((function(a){a.scene.objects.traverse((a,b)=>{void 0===b.pathSnapping&&(b.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),void 0===b.pathSnapping.offset&&(b.pathSnapping.offset=0)})})(a),a.schema=33),b<34&&(void 0===(i=a).scene.publish.mouseEventTarget&&(i.scene.publish.mouseEventTarget="canvas"),void 0===i.scene.publish.settings.web.hint&&(i.scene.publish.settings.web.hint=!1),a.schema=34),b<35&&((function(a){let{video:b}=a.scene.publish.settings;"gif"===b.format&&b.fps>48&&(b.fps=15)})(a),a.schema=35),b<36&&((function(a){a.scene.objects.traverse((a,b)=>{b.events.forEach(a=>{"GameControl"===a.type&&(a.resetYPosition=Math.abs(a.resetYPosition-b.position[1]))})})})(a),a.schema=36),b<37&&((function(a){let b=a.scene.environment.usePhysics;a.scene.objects.traverse((a,c)=>{b&&null===c.physics?c.collision=!1:c.collision="visibility"})})(a),a.schema=37),b<38&&(eKa(a,jKa),dKa(a,jKa),a.schema=38),b<39&&((function(a){a.scene.objects.traverse((a,b)=>{b.events.forEach(a=>{"GameControl"===a.type&&(a.navmesh=hOa.defaultDataThirdPerson.navmesh)})})})(a),a.schema=39),b<40&&((j=a).scene.styles||(j.scene.styles=XNa.defaultData()),a.schema=40),b<41&&(void 0===(k=a).scene.environment.ambientLight.occlusion&&(k.scene.environment.ambientLight.occlusion=!1),void 0===k.scene.environment.ambientLight.aoFullRes&&(k.scene.environment.ambientLight.aoFullRes=!1),void 0===k.scene.environment.ambientLight.radius&&(k.scene.environment.ambientLight.radius=256),void 0===k.scene.environment.ambientLight.bias&&(k.scene.environment.ambientLight.bias=.5),void 0===k.scene.environment.ambientLight.aoColor&&(k.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),eKa(k,mKa),dKa(k,mKa),a.schema=41),b<42&&((function(a){a.scene.objects.traverse((a,b)=>{b.events.forEach(a=>{"GameControl"===a.type&&Object.assign(a.gameActions,{run:new LBa})})})})(a),a.schema=42),b<43&&((function(a){a.scene.objects.traverse((a,b)=>{b.events.forEach(a=>{"GameControl"===a.type&&(a.keyAssignments=[...a.keyAssignments,["run",""],["none","Ctrl"]])})})})(a),a.schema=43),b<99){eKa(a,nKa),dKa(a,nKa),null===a.scene.publish.playCamera&&(a.scene.publish.playCamera=QIa);let n=SFa(a.scene.objects),o=a.scene.objects;for(let p of(a.scene.publish.playPage=RIa,o.insertBefore(null,null,[{id:RIa,data:{...QNa.defaultData,backgroundColor:a.scene.backgroundColor,fog:a.scene.fog,postprocessing:a.scene.postprocessing,ao:Eya(a.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:a.scene.publish.playCamera,gameControlObject:a.scene.publish.gameControlObject},shadow:Eya(a.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...ANa.defaultData,...Eya(a.scene.environment,"usePhysics","gravity")},camera:SFa(a.scene.ownerCamera)??QNa.defaultData.camera,name:"Scene"},children:[]}]),n))p.id!==ZNa.TRASH_CAN_ID&&o.move(RIa,p.fi,p.id);let q=0,r=0;a.shared.penumbraSize&&a.scene.objects.traverse((b,c)=>{"DirectionalLight"===c.type?(c.penumbraSize=a.shared.penumbraSize[Math.min(q,2)],q+=1):"SpotLight"===c.type&&(c.penumbraSize=a.shared.penumbraSize[3+Math.min(r,1)],r+=1),(void 0===c.physics||null===c.physics)&&"Instance"!==c.type&&(c.physics={},Object.assign(c.physics,MJa.defaultData)),void 0!==c.physics&&null!==c.physics&&(c.physics.enabled=c.collision??"visibility",delete c.collision)}),a.schema=99}})(a,b),b<100&&(void 0===a.scene.publish.joystickSizeAndXYOffset&&(a.scene.publish.joystickSizeAndXYOffset=UNa.defaultData.joystickSizeAndXYOffset),a.schema=100),b<101&&(eKa(a,oKa),dKa(a,oKa),a.schema=101),b<102&&((function(a){a.scene.objects.traverse((a,b)=>{let c=b.geometry;c&&"PathGeometry"===c.type&&(c.extrusion.capType="flat",c.extrusion.bevel=50,c.extrusion.bevelSides=6,"Custom"===c.extrusion.shape.type&&(c.extrusion.shape.shapeQuality="low"))})})(a),a.schema=102),b<104&&(a.shared.catelogs=new mza,a.shared.lib=eOa.defaultData(),a.schema=104),b<105&&(a.shared.variables=Gya({},mza.prototype),a.scene.objects.traverse((a,b)=>{rKa(b)}),a.schema=105),Object.values(a.shared.lib.components)))tKa(e);let f;b<106&&(f=SFa((c=a).shared.variables),c.shared.variables=Gya(Object.entries(f??{}).map(([a,b],c)=>({fi:c,id:a,data:b})),LBa.prototype),a.schema=106),b<107&&(a.shared.lib.variables=eOa.defaultData().variables,a.schema=107),b<109&&((d=a).shared.particles=Gya({},mza.prototype),d.shared.lib&&(d.shared.lib.particles=eOa.defaultData().particles),a.schema=109),b<110&&((function(a){a.scene.objects.traverse((a,b)=>{"Particle"===b.type&&"number"==typeof b.renderMaterial.size&&Object.assign(b.renderMaterial,{size:[b.renderMaterial.size,b.renderMaterial.size]})})})(a),a.schema=110),b<111&&(a.scene.objects.traverse((a,b)=>{var c;c=b,Array.isArray(SFa(c.events))&&c.events?.forEach(a=>{"disabled"in a||(a.disabled=!1),("MouseDown"===a.type||"MouseUp"===a.type||"MousePress"===a.type)&&(a.mode=a.mode||"Object")})}),a.schema=111)}}function vKa(a,b=!1){let c=null!==a[0].index,d=new Set(Object.keys(a[0].attributes)),e=new Set(Object.keys(a[0].morphAttributes)),f={},g={},h=a[0].morphTargetsRelative,i=new nE,j=0;for(let k=0;k<a.length;++k){let l=a[k],m=0;if(c!==(null!==l.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+k+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let n in l.attributes){if(!d.has(n))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+k+". All geometries must have compatible attributes; make sure \""+n+"\" attribute exists among all geometries, or in none of them."),null;void 0===f[n]&&(f[n]=[]),f[n].push(l.attributes[n]),m++}if(m!==d.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+k+". Make sure all geometries have the same number of attributes."),null;if(h!==l.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+k+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let o in l.morphAttributes){if(!e.has(o))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+k+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===g[o]&&(g[o]=[]),g[o].push(l.morphAttributes[o])}if(b){let p;if(c)p=l.index.count;else{if(void 0===l.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+k+". The geometry must have either an index or a position attribute"),null;p=l.attributes.position.count}i.addGroup(j,p,k),j+=p}}if(c){let q=0,r=[];for(let s=0;s<a.length;++s){let t=a[s].index;for(let u=0;u<t.count;++u)r.push(t.getX(u)+q);q+=a[s].attributes.position.count}i.setIndex(r)}for(let v in f){let w=wKa(f[v]);if(!w)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+v+" attribute."),null;i.setAttribute(v,w)}for(let x in g){let y=g[x][0].length;if(0===y)break;i.morphAttributes=i.morphAttributes||{},i.morphAttributes[x]=[];for(let z=0;z<y;++z){let A=[];for(let B=0;B<g[x].length;++B)A.push(g[x][B][z]);let C=wKa(A);if(!C)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+x+" morphAttribute."),null;i.morphAttributes[x].push(C)}}return i}function wKa(a){let b,c,d,e=0;for(let f=0;f<a.length;++f){let g=a[f];if(g.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===b&&(b=g.array.constructor),b!==g.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===c&&(c=g.itemSize),c!==g.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===d&&(d=g.normalized),d!==g.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;e+=g.array.length}let h=new b(e),i=0;for(let j=0;j<a.length;++j)h.set(a[j].array,i),i+=a[j].array.length;return new RC(h,c,d)}(jNa=iOa||(iOa={})).defaultData={schema:111,scene:ZNa.defaultData,frames:new mza().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",$Na.defaultData),shared:{...fOa.emptyData(),colors:fOa.defaultColors()}},jNa.emptyDataForImports=function(a){return{schema:111,scene:ZNa.emptyDataWithPage(a),frames:new mza().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",$Na.defaultData),shared:{...fOa.emptyData(),colors:fOa.defaultColors(),images:fOa.defaultImages(a)}}},jNa.emptyData=function(){return{schema:111,scene:ZNa.emptyDataWithPage(),frames:new mza().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",$Na.defaultData),shared:fOa.emptyData()}},jNa.clipboard2dData=function(){return{schema:111,scene:ZNa.emptyData(),frames:new mza,shared:fOa.emptyData()}},jNa.collabHelper={..._Fa,updateSchema(a){return(a.schema??0)<111?RFa(a,uKa):(a.schema??0)-111}},jNa.updateSchemaDirectly=function(a){let b=jNa.collabHelper.updateSchema(a);return"number"==typeof b?0===b?a:null:b.data},jNa.withoutLib=function(a){return{...a,shared:{...a.shared,lib:eOa.defaultData()}}},jNa.getComponentData=function(a,b){let c=a.scene.objects.get(b);if(c&&"Component"===c.data.type)return c;{let d=a.shared.lib.components[b];if(d)return d.asset}},(jOa||(jOa={})).is=function(a){return!0},(kNa=kOa||(kOa={})).defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]},kNa.merge=function(a,b){return{position:b?.position??a.position,rotation:b?.rotation??a.rotation,scale:b?.scale??a.scale,shear:b?.shear??a.shear}},kNa.diff=function(a,b){return Fya({position:vJa.isEqual(a.position,b.position)?void 0:b.position,rotation:a.rotation===b.rotation?void 0:b.rotation,scale:vJa.isEqual(a.scale,b.scale)?void 0:b.scale,shear:a.shear&&b.shear&&vJa.isEqual(a.shear,b.shear)?void 0:b.shear})},(lOa||(lOa={})).defaultData={horizontalConstraint:0,verticalConstraint:0},(mOa||(mOa={})).defaultData={opacity:1,fill:{color:AJa.fromHexAndA(SIa,1),enabled:!0},stroke:{color:AJa.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:AJa.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:AJa.from0to1([0,0,0,1]),enabled:!1,spread:0}},(lNa=nOa||(nOa={})).newEmpty=function(a,b){return{name:b}},lNa.patch=function(a,b){if(void 0===b)return a;let c={...a};return Object.assign(c,kOa.merge(c,b)),c=(function(a,b){if(void 0===b)return a;let c={...a};return"fill"in c&&"fill"in b&& void 0!==b.fill&&Object.assign(c,{fill:{...c.fill,...b.fill}}),"stroke"in c&&"stroke"in b&& void 0!==b.stroke&&Object.assign(c,{stroke:{...c.stroke,...b.stroke}}),"layerBlur"in c&&"layerBlur"in b&& void 0!==b.layerBlur&&Object.assign(c,{layerBlur:{...c.layerBlur,...b.layerBlur}}),"backgroundBlur"in c&&"backgroundBlur"in b&& void 0!==b.backgroundBlur&&Object.assign(c,{backgroundBlur:{...c.backgroundBlur,...b.backgroundBlur}}),"dropShadow"in c&&"dropShadow"in b&& void 0!==b.dropShadow&&Object.assign(c,{dropShadow:{...c.dropShadow,...b.dropShadow}}),"innerShadow"in c&&"innerShadow"in b&& void 0!==b.innerShadow&&Object.assign(c,{innerShadow:{...c.innerShadow,...b.innerShadow}}),c})(c=function(a,b){if(void 0===b)return a;let c={...a},d=["width","height","cornerRadius"];for(let e of d)e in c&&e in b&& void 0!==b[e]&&Object.assign(c,{[e]:b[e]});return c}(c,b),b)},lNa.toOps=function(a,b){let c,d=[];for(let[e,f]of Object.entries(b))"name"!==e&&(void 0===c&&(c={path:[],props:{},type:0},d.push(c)),c.props[e]=f);return d},(oOa||(oOa={})).defaultData={...kOa.defaultData,...lOa.defaultData,states:new LBa,events:new LBa,visible:!0,raycastLock:!1},(pOa||(pOa={})).defaultData={...oOa.defaultData,...mOa.defaultData},(qOa||(qOa={})).defaultData={cornerRadius:[0,0,0,0]},(rOa||(rOa={})).defaultData={...pOa.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"},(sOa||(sOa={})).defaultData={...pOa.defaultData,...qOa.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"},(tOa||(tOa={})).defaultData={...pOa.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"},(uOa||(uOa={})).defaultData={...pOa.defaultData,type:"path2d",path:"",name:"Path"},(vOa||(vOa={})).is=function(a){return"ellipse2d"===a.type||"rectangle2d"===a.type||"text2d"===a.type||"vector2d"===a.type||"path2d"===a.type},(wOa||(wOa={})).defaultData={...oOa.defaultData,name:"Group",type:"group2d"},(xOa||(xOa={})).defaultData={...oOa.defaultData,...qOa.defaultData,...mOa.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:AJa.fromHexAndA(4737101,1),enabled:!0},stroke:{color:AJa.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}},(mNa=yOa||(yOa={})).defaultData=function(a){switch(a){case"rectangle2d":return{...sOa.defaultData};case"ellipse2d":return{...rOa.defaultData};case"text2d":return{...tOa.defaultData};case"vector2d":return{...sOa.defaultData};case"path2d":return{...uOa.defaultData};case"frame2d":return{...xOa.defaultData};case"group2d":return{...wOa.defaultData}}},mNa.getPivot=function(a){return"width"in a&&"height"in a?["number"==typeof a.width?.5*a.width:0,"number"==typeof a.height?.5*a.height:0]:[0,0]},mNa.isResizeable=function(a){return"rectangle2d"===a.type||"ellipse2d"===a.type||"text2d"===a.type||"frame2d"===a.type},mNa.hasCorners=function(a){return"rectangle2d"===a.type||"frame2d"===a.type},(nNa=zOa||(zOa={})).defaultData={name:"UI",type:"scene2d",objects:new Kza},nNa.emptyData=function(){return{type:"scene2d",objects:new Kza}};var xKa=5960464477539063e-23,yKa=class{constructor(){}};function zKa(a,b,c){return c.min.x=b[a],c.min.y=b[a+1],c.min.z=b[a+2],c.max.x=b[a+3],c.max.y=b[a+4],c.max.z=b[a+5],c}function AKa(a){let b=-1,c=-1/0;for(let d=0;d<3;d++){let e=a[d+3]-a[d];e>c&&(c=e,b=d)}return b}function BKa(a,b){b.set(a)}function CKa(a,b,c){let d,e;for(let f=0;f<3;f++){let g=f+3;d=a[f],e=b[f],c[f]=d<e?d:e,d=a[g],e=b[g],c[g]=d>e?d:e}}function DKa(a,b,c){for(let d=0;d<3;d++){let e=b[a+2*d],f=b[a+2*d+1],g=e-f,h=e+f;g<c[d]&&(c[d]=g),h>c[d+3]&&(c[d+3]=h)}}function EKa(a){let b=a[3]-a[0],c=a[4]-a[1],d=a[5]-a[2];return 2*(b*c+c*d+d*b)}function FKa(a,b,c,d,e=null){let f=1/0,g=1/0,h=1/0,i=-1/0,j=-1/0,k=-1/0,l=1/0,m=1/0,n=1/0,o=-1/0,p=-1/0,q=-1/0,r=null!==e;for(let s=6*b,t=(b+c)*6;s<t;s+=6){let u=a[s+0],v=a[s+1],w=u-v,x=u+v;w<f&&(f=w),x>i&&(i=x),r&&u<l&&(l=u),r&&u>o&&(o=u);let y=a[s+2],z=a[s+3],A=y-z,B=y+z;A<g&&(g=A),B>j&&(j=B),r&&y<m&&(m=y),r&&y>p&&(p=y);let C=a[s+4],D=a[s+5],E=C-D,F=C+D;E<h&&(h=E),F>k&&(k=F),r&&C<n&&(n=C),r&&C>q&&(q=C)}d[0]=f,d[1]=g,d[2]=h,d[3]=i,d[4]=j,d[5]=k,r&&(e[0]=l,e[1]=m,e[2]=n,e[3]=o,e[4]=p,e[5]=q)}var GKa=32,HKa=(a,b)=>a.candidate-b.candidate,IKa=new Array(GKa).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),JKa=new Float32Array(6),KKa=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(LKa,MKa){let NKa=1/0,OKa=-1/0;for(let PKa=0,QKa=LKa.length;PKa<QKa;PKa++){let RKa=LKa[PKa][MKa];NKa=RKa<NKa?RKa:NKa,OKa=RKa>OKa?RKa:OKa}this.min=NKa,this.max=OKa}setFromPoints(SKa,TKa){let UKa=1/0,VKa=-1/0;for(let WKa=0,XKa=TKa.length;WKa<XKa;WKa++){let YKa=TKa[WKa],ZKa=SKa.dot(YKa);UKa=ZKa<UKa?ZKa:UKa,VKa=ZKa>VKa?ZKa:VKa}this.min=UKa,this.max=VKa}isSeparated($Ka){return this.min>$Ka.max||$Ka.min>this.max}};let _Ka;_Ka=new fm,KKa.prototype.setFromBox=function(a,b){let c=b.min,d=b.max,e=1/0,f=-1/0;for(let g=0;g<=1;g++)for(let h=0;h<=1;h++)for(let i=0;i<=1;i++){_Ka.x=c.x*g+d.x*(1-g),_Ka.y=c.y*h+d.y*(1-h),_Ka.z=c.z*i+d.z*(1-i);let j=a.dot(_Ka);e=Math.min(j,e),f=Math.max(j,f)}this.min=e,this.max=f},new KKa;let aLa,bLa,cLa,dLa,eLa,fLa,gLa,hLa,iLa,jLa;var kLa=(aLa=new fm,bLa=new fm,cLa=new fm,function(a,b,c){let d=a.start,e=aLa,f=b.start,g=bLa;cLa.subVectors(d,f),aLa.subVectors(a.end,a.start),bLa.subVectors(b.end,b.start);let h=cLa.dot(g),i=g.dot(e),j=g.dot(g),k=cLa.dot(e),l=e.dot(e)*j-i*i,m,n;m=0!==l?(h*i-k*j)/l:0,n=(h+m*i)/j,c.x=m,c.y=n}),lLa=(dLa=new Eb,eLa=new fm,fLa=new fm,function(a,b,c,d){kLa(a,b,dLa);let e=dLa.x,f=dLa.y;if(e>=0&&e<=1&&f>=0&&f<=1){a.at(e,c),b.at(f,d);return}if(e>=0&&e<=1){f<0?b.at(0,d):b.at(1,d),a.closestPointToPoint(d,!0,c);return}if(f>=0&&f<=1){e<0?a.at(0,c):a.at(1,c),b.closestPointToPoint(c,!0,d);return}{let g;g=e<0?a.start:a.end;let h;h=f<0?b.start:b.end;let i=eLa,j=fLa;if(a.closestPointToPoint(h,!0,eLa),b.closestPointToPoint(g,!0,fLa),i.distanceToSquared(h)<=j.distanceToSquared(g)){c.copy(i),d.copy(h);return}c.copy(g),d.copy(j);return}}),mLa=(gLa=new fm,hLa=new fm,iLa=new jL,jLa=new Ppa,function(a,b){let{radius:c,center:d}=a,{a:e,b:f,c:g}=b;if(jLa.start=e,jLa.end=f,jLa.closestPointToPoint(d,!0,gLa).distanceTo(d)<=c||(jLa.start=e,jLa.end=g,jLa.closestPointToPoint(d,!0,gLa).distanceTo(d)<=c)||(jLa.start=f,jLa.end=g,jLa.closestPointToPoint(d,!0,gLa).distanceTo(d)<=c))return!0;let h=b.getPlane(iLa);if(Math.abs(h.distanceToPoint(d))<=c){let i=h.projectPoint(d,hLa);if(b.containsPoint(i))return!0}return!1});function nLa(a){return 1e-15>Math.abs(a)}var oLa=class extends TA{constructor(...pLa){super(...pLa),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new fm),this.satBounds=new Array(4).fill().map(()=>new KKa),this.points=[this.a,this.b,this.c],this.sphere=new pq,this.plane=new jL,this.needsUpdate=!0}intersectsSphere(qLa){return mLa(qLa,this)}update(){let rLa=this.a,sLa=this.b,tLa=this.c,uLa=this.points,vLa=this.satAxes,wLa=this.satBounds,xLa=vLa[0],yLa=wLa[0];this.getNormal(xLa),yLa.setFromPoints(xLa,uLa);let zLa=vLa[1],ALa=wLa[1];zLa.subVectors(rLa,sLa),ALa.setFromPoints(zLa,uLa);let BLa=vLa[2],CLa=wLa[2];BLa.subVectors(sLa,tLa),CLa.setFromPoints(BLa,uLa);let DLa=vLa[3],ELa=wLa[3];DLa.subVectors(tLa,rLa),ELa.setFromPoints(DLa,uLa),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(xLa,rLa),this.needsUpdate=!1}};let FLa,GLa,HLa;oLa.prototype.closestPointToSegment=(FLa=new fm,GLa=new fm,HLa=new Ppa,function(a,b=null,c=null){let{start:d,end:e}=a,f=this.points,g,h=1/0;for(let i=0;i<3;i++){let j=(i+1)%3;HLa.start.copy(f[i]),HLa.end.copy(f[j]),lLa(HLa,a,FLa,GLa),(g=FLa.distanceToSquared(GLa))<h&&(h=g,b&&b.copy(FLa),c&&c.copy(GLa))}return this.closestPointToPoint(d,FLa),(g=d.distanceToSquared(FLa))<h&&(h=g,b&&b.copy(FLa),c&&c.copy(d)),this.closestPointToPoint(e,FLa),(g=e.distanceToSquared(FLa))<h&&(h=g,b&&b.copy(FLa),c&&c.copy(e)),Math.sqrt(h)});let ILa,JLa,KLa,LLa,MLa,NLa,OLa,PLa,QLa,RLa,SLa,TLa;oLa.prototype.intersectsTriangle=(ILa=new oLa,JLa=new Array(3),KLa=new Array(3),LLa=new KKa,MLa=new KKa,NLa=new fm,OLa=new fm,PLa=new fm,QLa=new fm,RLa=new Ppa,SLa=new Ppa,TLa=new Ppa,function(a,b=null,c=!1){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(ILa.copy(a),ILa.update(),a=ILa);let d=this.plane,e=a.plane;if(Math.abs(d.normal.dot(e.normal))>1-1e-10){let f=this.satBounds,g=this.satAxes;KLa[0]=a.a,KLa[1]=a.b,KLa[2]=a.c;for(let h=0;h<4;h++){let i=f[h],j=g[h];if(LLa.setFromPoints(j,KLa),i.isSeparated(LLa))return!1}let k=a.satBounds,l=a.satAxes;JLa[0]=this.a,JLa[1]=this.b,JLa[2]=this.c;for(let m=0;m<4;m++){let n=k[m],o=l[m];if(LLa.setFromPoints(o,JLa),n.isSeparated(LLa))return!1}for(let p=0;p<4;p++){let q=g[p];for(let r=0;r<4;r++){let s=l[r];if(NLa.crossVectors(q,s),LLa.setFromPoints(NLa,JLa),MLa.setFromPoints(NLa,KLa),LLa.isSeparated(MLa))return!1}}return b&&(c||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),b.start.set(0,0,0),b.end.set(0,0,0)),!0}{let t=this.points,u=!1,v=0;for(let w=0;w<3;w++){let x=t[w],y=t[(w+1)%3];RLa.start.copy(x),RLa.end.copy(y),RLa.delta(OLa);let z=u?SLa.start:SLa.end,A=nLa(e.distanceToPoint(x));if(nLa(e.normal.dot(OLa))&&A){SLa.copy(RLa),v=2;break}if((e.intersectLine(RLa,z)||A)&&!nLa(z.distanceTo(y))){if(v++,u)break;u=!0}}if(1===v&&a.containsPoint(SLa.end))return b&&(b.start.copy(SLa.end),b.end.copy(SLa.end)),!0;if(2!==v)return!1;let B=a.points,C=!1,D=0;for(let E=0;E<3;E++){let F=B[E],G=B[(E+1)%3];RLa.start.copy(F),RLa.end.copy(G),RLa.delta(PLa);let H=C?TLa.start:TLa.end,I=nLa(d.distanceToPoint(F));if(nLa(d.normal.dot(PLa))&&I){TLa.copy(RLa),D=2;break}if((d.intersectLine(RLa,H)||I)&&!nLa(H.distanceTo(G))){if(D++,C)break;C=!0}}if(1===D&&this.containsPoint(TLa.end))return b&&(b.start.copy(TLa.end),b.end.copy(TLa.end)),!0;if(2!==D)return!1;if(SLa.delta(OLa),TLa.delta(PLa),0>OLa.dot(PLa)){let J=TLa.start;TLa.start=TLa.end,TLa.end=J}let K=SLa.start.dot(OLa),L=SLa.end.dot(OLa),M=TLa.start.dot(OLa),N=TLa.end.dot(OLa),O=L<M,P=K<N;return(K===N||M===L||O!==P)&&(b&&(QLa.subVectors(SLa.start,TLa.start),QLa.dot(OLa)>0?b.start.copy(SLa.start):b.start.copy(TLa.start),QLa.subVectors(SLa.end,TLa.end),0>QLa.dot(OLa)?b.end.copy(SLa.end):b.end.copy(TLa.end)),!0)}});let ULa;oLa.prototype.distanceToPoint=(ULa=new fm,function(a){return this.closestPointToPoint(a,ULa),a.distanceTo(ULa)});let VLa,WLa,XLa,YLa,ZLa;oLa.prototype.distanceToTriangle=(VLa=new fm,WLa=new fm,XLa=["a","b","c"],YLa=new Ppa,ZLa=new Ppa,function(a,b=null,c=null){let d=b||c?YLa:null;if(this.intersectsTriangle(a,d))return(b||c)&&(b&&d.getCenter(b),c&&d.getCenter(c)),0;let e=1/0;for(let f=0;f<3;f++){let g,h=XLa[f],i=a[h];this.closestPointToPoint(i,VLa),(g=i.distanceToSquared(VLa))<e&&(e=g,b&&b.copy(VLa),c&&c.copy(i));let j=this[h];a.closestPointToPoint(j,VLa),(g=j.distanceToSquared(VLa))<e&&(e=g,b&&b.copy(j),c&&c.copy(VLa))}for(let k=0;k<3;k++){let l=XLa[k],m=XLa[(k+1)%3];YLa.set(this[l],this[m]);for(let n=0;n<3;n++){let o=XLa[n],p=XLa[(n+1)%3];ZLa.set(a[o],a[p]),lLa(YLa,ZLa,VLa,WLa);let q=VLa.distanceToSquared(WLa);q<e&&(e=q,b&&b.copy(VLa),c&&c.copy(WLa))}}return Math.sqrt(e)});var $La=class{constructor(_La,aMa,bMa){this.isOrientedBox=!0,this.min=new fm,this.max=new fm,this.matrix=new rs,this.invMatrix=new rs,this.points=new Array(8).fill().map(()=>new fm),this.satAxes=new Array(3).fill().map(()=>new fm),this.satBounds=new Array(3).fill().map(()=>new KKa),this.alignedSatBounds=new Array(3).fill().map(()=>new KKa),this.needsUpdate=!1,_La&&this.min.copy(_La),aMa&&this.max.copy(aMa),bMa&&this.matrix.copy(bMa)}set(cMa,dMa,eMa){this.min.copy(cMa),this.max.copy(dMa),this.matrix.copy(eMa),this.needsUpdate=!0}copy(fMa){this.min.copy(fMa.min),this.max.copy(fMa.max),this.matrix.copy(fMa.matrix),this.needsUpdate=!0}};$La.prototype.update=function(){let a=this.matrix,b=this.min,c=this.max,d=this.points;for(let e=0;e<=1;e++)for(let f=0;f<=1;f++)for(let g=0;g<=1;g++){let h=d[1*e|2*f|4*g];h.x=e?c.x:b.x,h.y=f?c.y:b.y,h.z=g?c.z:b.z,h.applyMatrix4(a)}let i=this.satBounds,j=this.satAxes,k=d[0];for(let l=0;l<3;l++){let m=j[l],n=i[l],o=1<<l,p=d[o];m.subVectors(k,p),n.setFromPoints(m,d)}let q=this.alignedSatBounds;q[0].setFromPointsField(d,"x"),q[1].setFromPointsField(d,"y"),q[2].setFromPointsField(d,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1};let gMa;$La.prototype.intersectsBox=(gMa=new KKa,function(a){this.needsUpdate&&this.update();let b=a.min,c=a.max,d=this.satBounds,e=this.satAxes,f=this.alignedSatBounds;if(gMa.min=b.x,gMa.max=c.x,f[0].isSeparated(gMa)||(gMa.min=b.y,gMa.max=c.y,f[1].isSeparated(gMa))||(gMa.min=b.z,gMa.max=c.z,f[2].isSeparated(gMa)))return!1;for(let g=0;g<3;g++){let h=e[g],i=d[g];if(gMa.setFromBox(h,a),i.isSeparated(gMa))return!1}return!0});let hMa,iMa,jMa,kMa,lMa;hMa=new oLa,iMa=new Array(3),jMa=new KKa,kMa=new KKa,lMa=new fm,$La.prototype.intersectsTriangle=function(a){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(hMa.copy(a),hMa.update(),a=hMa);let b=this.satBounds,c=this.satAxes;iMa[0]=a.a,iMa[1]=a.b,iMa[2]=a.c;for(let d=0;d<3;d++){let e=b[d],f=c[d];if(jMa.setFromPoints(f,iMa),e.isSeparated(jMa))return!1}let g=a.satBounds,h=a.satAxes,i=this.points;for(let j=0;j<3;j++){let k=g[j],l=h[j];if(jMa.setFromPoints(l,i),k.isSeparated(jMa))return!1}for(let m=0;m<3;m++){let n=c[m];for(let o=0;o<4;o++){let p=h[o];if(lMa.crossVectors(n,p),jMa.setFromPoints(lMa,iMa),kMa.setFromPoints(lMa,i),jMa.isSeparated(kMa))return!1}}return!0},$La.prototype.closestPointToPoint=function(a,b){return this.needsUpdate&&this.update(),b.copy(a).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),b};let mMa;$La.prototype.distanceToPoint=(mMa=new fm,function(a){return this.closestPointToPoint(a,mMa),a.distanceTo(mMa)});let nMa,oMa,pMa,qMa,rMa;$La.prototype.distanceToBox=(nMa=["x","y","z"],oMa=new Array(12).fill().map(()=>new Ppa),pMa=new Array(12).fill().map(()=>new Ppa),qMa=new fm,rMa=new fm,function(a,b=0,c=null,d=null){if(this.needsUpdate&&this.update(),this.intersectsBox(a))return(c||d)&&(a.getCenter(rMa),this.closestPointToPoint(rMa,qMa),a.closestPointToPoint(qMa,rMa),c&&c.copy(qMa),d&&d.copy(rMa)),0;let e=b*b,f=a.min,g=a.max,h=this.points,i=1/0;for(let j=0;j<8;j++){let k=h[j];rMa.copy(k).clamp(f,g);let l=k.distanceToSquared(rMa);if(l<i&&(i=l,c&&c.copy(k),d&&d.copy(rMa),l<e))return Math.sqrt(l)}let m=0;for(let n=0;n<3;n++)for(let o=0;o<=1;o++)for(let p=0;p<=1;p++){let q=(n+1)%3,r=(n+2)%3,s=o<<q|p<<r,t=1<<n|o<<q|p<<r,u=h[s],v=h[t];oMa[m].set(u,v);let w=nMa[n],x=nMa[q],y=nMa[r],z=pMa[m],A=z.start,B=z.end;A[w]=f[w],A[x]=o?f[x]:g[x],A[y]=p?f[y]:g[x],B[w]=g[w],B[x]=o?f[x]:g[x],B[y]=p?f[y]:g[x],m++}for(let C=0;C<=1;C++)for(let D=0;D<=1;D++)for(let E=0;E<=1;E++){rMa.x=C?g.x:f.x,rMa.y=D?g.y:f.y,rMa.z=E?g.z:f.z,this.closestPointToPoint(rMa,qMa);let F=rMa.distanceToSquared(qMa);if(F<i&&(i=F,c&&c.copy(qMa),d&&d.copy(rMa),F<e))return Math.sqrt(F)}for(let G=0;G<12;G++){let H=oMa[G];for(let I=0;I<12;I++){lLa(H,pMa[I],qMa,rMa);let J=qMa.distanceToSquared(rMa);if(J<i&&(i=J,c&&c.copy(qMa),d&&d.copy(rMa),J<e))return Math.sqrt(J)}}return Math.sqrt(i)});var sMa=new fm,tMa=new fm,uMa=new fm,vMa=new Eb,wMa=new Eb,xMa=new Eb,yMa=new fm,zMa=new fm,AMa=new fm,BMa=new fm;function CMa(a,b,c,d,e){let f=3*d,g=a.index.getX(f),h=a.index.getX(f+1),i=a.index.getX(f+2),{position:j,normal:k,uv:l,uv1:m}=a.attributes,n=function(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o;sMa.fromBufferAttribute(b,f),tMa.fromBufferAttribute(b,g),uMa.fromBufferAttribute(b,h);let p=(j=a,k=sMa,l=tMa,m=uMa,n=BMa,null===((o=i)===Q?j.intersectTriangle(m,l,k,!0,n):j.intersectTriangle(k,l,m,o!==R,n))?null:{distance:j.origin.distanceTo(n),point:n.clone()});if(p){d&&(vMa.fromBufferAttribute(d,f),wMa.fromBufferAttribute(d,g),xMa.fromBufferAttribute(d,h),p.uv=TA.getInterpolation(BMa,sMa,tMa,uMa,vMa,wMa,xMa,new Eb)),e&&(vMa.fromBufferAttribute(e,f),wMa.fromBufferAttribute(e,g),xMa.fromBufferAttribute(e,h),p.uv1=TA.getInterpolation(BMa,sMa,tMa,uMa,vMa,wMa,xMa,new Eb)),c&&(yMa.fromBufferAttribute(c,f),zMa.fromBufferAttribute(c,g),AMa.fromBufferAttribute(c,h),p.normal=TA.getInterpolation(BMa,sMa,tMa,uMa,yMa,zMa,AMa,new fm),p.normal.dot(a.direction)>0&&p.normal.multiplyScalar(-1));let q={a:f,b:g,c:h,normal:new fm,materialIndex:0};TA.getNormal(sMa,tMa,uMa,q.normal),p.face=q,p.faceIndex=f}return p}(c,j,k,l,m,g,h,i,b);return n?(n.faceIndex=d,e&&e.push(n),n):null}function DMa(a,b,c,d){let e=a.a,f=a.b,g=a.c,h=b,i=b+1,j=b+2;c&&(h=c.getX(b),i=c.getX(b+1),j=c.getX(b+2)),e.x=d.getX(h),e.y=d.getY(h),e.z=d.getZ(h),f.x=d.getX(i),f.y=d.getY(i),f.z=d.getZ(i),g.x=d.getX(j),g.y=d.getY(j),g.z=d.getZ(j)}function EMa(a,b,c,d,e,f,g){let h=c.index,i=c.attributes.position;for(let j=a,k=b+a;j<k;j++)if(DMa(g,3*j,h,i),g.needsUpdate=!0,d(g,j,e,f))return!0;return!1}var FMa=class{constructor(GMa){this._getNewPrimitive=GMa,this._primitives=[]}getPrimitive(){let HMa=this._primitives;return 0===HMa.length?this._getNewPrimitive():HMa.pop()}releasePrimitive(IMa){this._primitives.push(IMa)}};function JMa(a,b){return 65535===b[a+15]}function KMa(a,b){return b[a+6]}function LMa(a,b){return b[a+14]}function MMa(a){return a+8}function NMa(a,b){return b[a+6]}var OMa=new Io,PMa=new fm,QMa=["x","y","z"];function RMa(a,b,c,d,e){let f=2*a,g=BOa,h=COa,i=DOa;if(JMa(f,h))!function(a,b,c,d,e,f){for(let g=d,h=d+e;g<h;g++)CMa(a,b,c,g,f)}(b,c,d,KMa(a,i),LMa(f,h),e);else{let j=MMa(a);$Ma(j,g,d,PMa)&&RMa(j,b,c,d,e);let k=NMa(a,i);$Ma(k,g,d,PMa)&&RMa(k,b,c,d,e)}}function SMa(a,b,c,d){let e=2*a,f=BOa,g=COa,h=DOa;if(JMa(e,g))return(function(a,b,c,d,e){let f=1/0,g=null;for(let h=d,i=d+e;h<i;h++){let j=CMa(a,b,c,h);j&&j.distance<f&&(g=j,f=j.distance)}return g})(b,c,d,KMa(a,h),LMa(e,g));{let i=h[a+7],j=QMa[i],k=d.direction[j]>=0,l,m;k?(l=MMa(a),m=NMa(a,h)):(l=NMa(a,h),m=MMa(a));let n=$Ma(l,f,d,PMa)?SMa(l,b,c,d):null;if(n){let o=n.point[j];if(k?o<=f[m+i]:o>=f[m+i+3])return n}let p=$Ma(m,f,d,PMa)?SMa(m,b,c,d):null;return n&&p?n.distance<=p.distance?n:p:n||p||null}}let TMa,UMa,VMa,WMa,XMa;var YMa=function(){let a,b,c=[],d=new FMa(()=>new Io);return function(...f){a=d.getPrimitive(),b=d.getPrimitive(),c.push(a,b);let g=e(...f);d.releasePrimitive(a),d.releasePrimitive(b),c.pop(),c.pop();let h=c.length;return h>0&&(b=c[h-1],a=c[h-2]),g};function e(c,d,f,g,h=null,i=0,j=0){function k(a){let b=2*a,c=COa,d=DOa;for(;!JMa(b,c);)b=2*(a=MMa(a));return KMa(a,d)}function l(a){let b=2*a,c=COa,d=DOa;for(;!JMa(b,c);)b=2*(a=NMa(a,d));return KMa(a,d)+LMa(b,c)}let m=2*c,n=BOa,o=COa,p=DOa;if(JMa(m,o)){let q=KMa(c,p),r=LMa(m,o);return zKa(c,n,a),g(q,r,!1,j,i+c,a)}{let s=MMa(c),t=NMa(c,p),u=s,v=t,w,x,y,z;if(h&&(y=a,z=b,zKa(u,n,y),zKa(v,n,z),w=h(y),x=h(z),x<w)){u=t,v=s;let A=w;w=x,x=A,y=z}y||zKa(u,n,y=a);let B=f(y,JMa(2*u,o),w,j+1,i+u),C;if(2===B){let D=k(u),E=l(u)-D;C=g(D,E,!0,j+1,i+u,y)}else C=B&&e(u,d,f,g,h,i,j+1);if(C)return!0;zKa(v,n,z=b);let F=f(z,JMa(2*v,o),x,j+1,i+v),G;if(2===F){let H=k(v),I=l(v)-H;G=g(H,I,!0,j+1,i+v,z)}else G=F&&e(v,d,f,g,h,i,j+1);return!!G}}}(),ZMa=(TMa=new oLa,UMa=new oLa,VMa=new rs,WMa=new $La,XMa=new $La,function a(b,c,d,e,f=null){let g=2*b,h=BOa,i=COa,j=DOa;if(null===f&&(d.boundingBox||d.computeBoundingBox(),WMa.set(d.boundingBox.min,d.boundingBox.max,e),f=WMa),JMa(g,i)){let k=c,l=k.index,m=k.attributes.position,n=d.index,o=d.attributes.position,p=KMa(b,j),q=LMa(g,i);if(VMa.copy(e).invert(),d.boundsTree)return zKa(b,h,XMa),XMa.matrix.copy(VMa),XMa.needsUpdate=!0,d.boundsTree.shapecast({intersectsBounds:a=>XMa.intersectsBox(a),intersectsTriangle:a=>{a.a.applyMatrix4(e),a.b.applyMatrix4(e),a.c.applyMatrix4(e),a.needsUpdate=!0;for(let b=3*p,c=(q+p)*3;b<c;b+=3)if(DMa(UMa,b,l,m),UMa.needsUpdate=!0,a.intersectsTriangle(UMa))return!0;return!1}});for(let r=3*p,s=q+3*p;r<s;r+=3){DMa(TMa,r,l,m),TMa.a.applyMatrix4(VMa),TMa.b.applyMatrix4(VMa),TMa.c.applyMatrix4(VMa),TMa.needsUpdate=!0;for(let t=0,u=n.count;t<u;t+=3)if(DMa(UMa,t,n,o),UMa.needsUpdate=!0,TMa.intersectsTriangle(UMa))return!0}}else{let v=b+8,w=j[b+6];return zKa(v,h,OMa),!!(f.intersectsBox(OMa)&&a(v,c,d,e,f)||(zKa(w,h,OMa),f.intersectsBox(OMa)&&a(w,c,d,e,f)))}});function $Ma(a,b,c,d){return zKa(a,b,OMa),c.intersectBox(OMa,d)}var _Ma,aNa,bNa,cNa,dNa,eNa,fNa,gNa,hNa,iNa,jNa,kNa,lNa,mNa,nNa,oNa,pNa,qNa,rNa,sNa,tNa,uNa,vNa,wNa,xNa,yNa,zNa,ANa,BNa,CNa,DNa,ENa,FNa,GNa,HNa,INa,JNa,KNa,LNa,MNa,NNa,ONa,PNa,QNa,RNa,SNa,TNa,UNa,VNa,WNa,XNa,YNa,ZNa,$Na,_Na,aOa,bOa,cOa,dOa,eOa,fOa,gOa,hOa,iOa,jOa,kOa,lOa,mOa,nOa,oOa,pOa,qOa,rOa,sOa,tOa,uOa,vOa,wOa,xOa,yOa,zOa,AOa,BOa,COa,DOa,EOa=[];function FOa(a){AOa&&EOa.push(AOa),AOa=a,BOa=new Float32Array(a),COa=new Uint16Array(a),DOa=new Uint32Array(a)}function GOa(){AOa=null,BOa=null,COa=null,DOa=null,EOa.length&&FOa(EOa.pop())}var HOa=Symbol("skip tree generation"),IOa=new Io,JOa=new Io,KOa=new rs,LOa=new $La,MOa=new $La,NOa=new fm,OOa=new fm,POa=new fm,QOa=new fm,ROa=new fm,SOa=new Io,TOa=new FMa(()=>new oLa),UOa=class{static serialize(VOa,WOa={}){if(WOa.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),UOa.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});WOa={cloneBuffers:!0,...WOa};let XOa=VOa.geometry,YOa=VOa._roots,ZOa=XOa.getIndex();return WOa.cloneBuffers?{roots:YOa.map(a=>a.slice()),index:ZOa.array.slice()}:{roots:YOa,index:ZOa.array}}static deserialize($Oa,_Oa,aPa={}){if("boolean"==typeof aPa)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),UOa.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});aPa={setIndex:!0,...aPa};let{index:bPa,roots:cPa}=$Oa,dPa=new UOa(_Oa,{...aPa,[HOa]:!0});if(dPa._roots=cPa,aPa.setIndex){let ePa=_Oa.getIndex();if(null===ePa){let fPa=new RC($Oa.index,1,!1);_Oa.setIndex(fPa)}else ePa.array!==bPa&&(ePa.array.set(bPa),ePa.needsUpdate=!0)}return dPa}constructor(gPa,hPa={}){if(gPa.isBufferGeometry){if(gPa.index&&gPa.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if((hPa=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[HOa]:!1},hPa)).useSharedArrayBuffer&& typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,hPa[HOa]||(this._roots=(function(a,b){let c=function(a,b){function c(a){m&&m(a/n)}function d(b,e,m,n=null,p=0){if(!o&&p>=i&&(o=!0,j&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(a))),m<=k||p>=i)return c(e+m),b.offset=e,b.count=m,b;let q=function(a,b,c,d,e,f){let g=-1,h=0;if(0===f)-1!==(g=AKa(b))&&(h=(b[g]+b[g+3])/2);else if(1===f)-1!==(g=AKa(a))&&(h=(function(a,b,c,d){let e=0;for(let f=b,g=b+c;f<g;f++)e+=a[6*f+2*d];return e/c})(c,d,e,g));else if(2===f){let i=EKa(a),j=1.25*e,k=6*d,l=(d+e)*6;for(let m=0;m<3;m++){let n=b[m],o=(b[m+3]-n)/GKa;if(e<GKa/4){let p=[...IKa];p.length=e;let q=0;for(let r=k;r<l;r+=6,q++){let s=p[q];s.candidate=c[r+2*m],s.count=0;let{bounds:t,leftCacheBounds:u,rightCacheBounds:v}=s;for(let w=0;w<3;w++)v[w]=1/0,v[w+3]=-1/0,u[w]=1/0,u[w+3]=-1/0,t[w]=1/0,t[w+3]=-1/0;DKa(r,c,t)}p.sort(HKa);let x=e;for(let y=0;y<x;y++){let z=p[y];for(;y+1<x&&p[y+1].candidate===z.candidate;)p.splice(y+1,1),x--}for(let A=k;A<l;A+=6){let B=c[A+2*m];for(let C=0;C<x;C++){let D=p[C];B>=D.candidate?DKa(A,c,D.rightCacheBounds):(DKa(A,c,D.leftCacheBounds),D.count++)}}for(let E=0;E<x;E++){let F=p[E],G=F.count,H=e-F.count,I=F.leftCacheBounds,J=F.rightCacheBounds,K=0;0!==G&&(K=EKa(I)/i);let L=0;0!==H&&(L=EKa(J)/i);let M=1+1.25*(K*G+L*H);M<j&&(g=m,j=M,h=F.candidate)}}else{for(let N=0;N<GKa;N++){let O=IKa[N];O.count=0,O.candidate=n+o+N*o;let P=O.bounds;for(let Q=0;Q<3;Q++)P[Q]=1/0,P[Q+3]=-1/0}for(let R=k;R<l;R+=6){let S=~~((c[R+2*m]-n)/o);S>=GKa&&(S=GKa-1);let T=IKa[S];T.count++,DKa(R,c,T.bounds)}let U=IKa[GKa-1];BKa(U.bounds,U.rightCacheBounds);for(let V=GKa-2;V>=0;V--){let W=IKa[V],X=IKa[V+1];CKa(W.bounds,X.rightCacheBounds,W.rightCacheBounds)}let Y=0;for(let Z=0;Z<GKa-1;Z++){let $=IKa[Z],_=$.count,aa=$.bounds,ba=IKa[Z+1].rightCacheBounds;0!==_&&(0===Y?BKa(aa,JKa):CKa(aa,JKa,JKa)),Y+=_;let ca=0,da=0;0!==Y&&(ca=EKa(JKa)/i);let ea=e-Y;0!==ea&&(da=EKa(ba)/i);let fa=1+1.25*(ca*Y+da*ea);fa<j&&(g=m,j=fa,h=$.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${f} used.`);return{axis:g,pos:h}}(b.boundingData,n,g,e,m,l);if(-1===q.axis)return c(e+m),b.offset=e,b.count=m,b;let r=function(a,b,c,d,e){let f=c,g=c+d-1,h=e.pos,i=2*e.axis;for(;;){for(;f<=g&&b[6*f+i]<h;)f++;for(;f<=g&&b[6*g+i]>=h;)g--;if(!(f<g))return f;for(let j=0;j<3;j++){let k=a[3*f+j];a[3*f+j]=a[3*g+j],a[3*g+j]=k;let l=b[6*f+2*j+0];b[6*f+2*j+0]=b[6*g+2*j+0],b[6*g+2*j+0]=l;let m=b[6*f+2*j+1];b[6*f+2*j+1]=b[6*g+2*j+1],b[6*g+2*j+1]=m}f++,g--}}(h,g,e,m,q);if(r===e||r===e+m)c(e+m),b.offset=e,b.count=m;else{b.splitAxis=q.axis;let s=new yKa,t=e,u=r-e;b.left=s,s.boundingData=new Float32Array(6),FKa(g,t,u,s.boundingData,f),d(s,t,u,f,p+1);let v=new yKa,w=r,x=m-u;b.right=v,v.boundingData=new Float32Array(6),FKa(g,w,x,v.boundingData,f),d(v,w,x,f,p+1)}return b}!function(a,b){if(!a.index){let c=a.attributes.position.count,d=b.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,e;e=c>65535?new Uint32Array(new d(4*c)):new Uint16Array(new d(2*c)),a.setIndex(new RC(e,1));for(let f=0;f<c;f++)e[f]=f}}(a,b);let e=new Float32Array(6),f=new Float32Array(6),g=function(a,b){let c=a.attributes.position,d=a.index.array,e=d.length/3,f=new Float32Array(6*e),g=c.normalized,h=c.array,i=c.offset||0,j=3;c.isInterleavedBufferAttribute&&(j=c.data.stride);let k=["getX","getY","getZ"];for(let l=0;l<e;l++){let m=3*l,n=6*l,o,p,q;g?(o=d[m+0],p=d[m+1],q=d[m+2]):(o=d[m+0]*j+i,p=d[m+1]*j+i,q=d[m+2]*j+i);for(let r=0;r<3;r++){let s,t,u;g?(s=c[k[r]](o),t=c[k[r]](p),u=c[k[r]](q)):(s=h[o+r],t=h[p+r],u=h[q+r]);let v=s;t<v&&(v=t),u<v&&(v=u);let w=s;t>w&&(w=t),u>w&&(w=u);let x=(w-v)/2,y=2*r;f[n+y+0]=v+x,f[n+y+1]=x+(Math.abs(v)+x)*xKa,v<b[r]&&(b[r]=v),w>b[r+3]&&(b[r+3]=w)}}return f}(a,e),h=a.index.array,i=b.maxDepth,j=b.verbose,k=b.maxLeafTris,l=b.strategy,m=b.onProgress,n=a.index.count/3,o=!1,p=[],q=function(a){if(!a.groups||!a.groups.length)return[{offset:0,count:a.index.count/3}];let b=[],c=new Set;for(let d of a.groups)c.add(d.start),c.add(d.start+d.count);let e=Array.from(c.values()).sort((a,b)=>a-b);for(let f=0;f<e.length-1;f++){let g=e[f],h=e[f+1];b.push({offset:g/3,count:(h-g)/3})}return b}(a);if(1===q.length){let r=q[0],s=new yKa;s.boundingData=e,(function(a,b,c,d){let e=1/0,f=1/0,g=1/0,h=-1/0,i=-1/0,j=-1/0;for(let k=6*b,l=(b+c)*6;k<l;k+=6){let m=a[k+0];m<e&&(e=m),m>h&&(h=m);let n=a[k+2];n<f&&(f=n),n>i&&(i=n);let o=a[k+4];o<g&&(g=o),o>j&&(j=o)}d[0]=e,d[1]=f,d[2]=g,d[3]=h,d[4]=i,d[5]=j})(g,r.offset,r.count,f),d(s,r.offset,r.count,f),p.push(s)}else for(let t of q){let u=new yKa;u.boundingData=new Float32Array(6),FKa(g,t.offset,t.count,u.boundingData,f),d(u,t.offset,t.count,f),p.push(u)}return p}(a,b),d,e,f,g=[],h=b.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let i=0;i<c.length;i++){let j=c[i],k=m(j),l=new h(32*k);d=new Float32Array(l),e=new Uint32Array(l),f=new Uint16Array(l),n(0,j),g.push(l)}return g;function m(a){return a.count?1:1+m(a.left)+m(a.right)}function n(a,b){let c=a/4,g=a/2,h=!!b.count,i=b.boundingData;for(let j=0;j<6;j++)d[c+j]=i[j];if(h){let k=b.offset,l=b.count;return e[c+6]=k,f[g+14]=l,f[g+15]=65535,a+32}{let m=b.left,o=b.right,p=b.splitAxis,q;if((q=n(a+32,m))/4>4294967296)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return e[c+6]=q/4,q=n(q,o),e[c+7]=p,q}}})(gPa,hPa),!gPa.boundingBox&&hPa.setBoundingBox&&(gPa.boundingBox=this.getBoundingBox(new Io))),this.geometry=gPa}refit(iPa=null){iPa&&Array.isArray(iPa)&&(iPa=new Set(iPa));let jPa=this.geometry,kPa=jPa.index.array,lPa=jPa.attributes.position,mPa,nPa,oPa,pPa,qPa=0,rPa=this._roots;for(let sPa=0,tPa=rPa.length;sPa<tPa;sPa++)mPa=rPa[sPa],nPa=new Uint32Array(mPa),oPa=new Uint16Array(mPa),pPa=new Float32Array(mPa),uPa(0,qPa),qPa+=mPa.byteLength;function uPa(a,b,c=!1){let d=2*a;if(65535===oPa[d+15]){let e=nPa[a+6],f=oPa[d+14],g=1/0,h=1/0,i=1/0,j=-1/0,k=-1/0,l=-1/0;for(let m=3*e,n=3*(e+f);m<n;m++){let o=kPa[m],p=lPa.getX(o),q=lPa.getY(o),r=lPa.getZ(o);p<g&&(g=p),p>j&&(j=p),q<h&&(h=q),q>k&&(k=q),r<i&&(i=r),r>l&&(l=r)}return(pPa[a+0]!==g||pPa[a+1]!==h||pPa[a+2]!==i||pPa[a+3]!==j||pPa[a+4]!==k||pPa[a+5]!==l)&&(pPa[a+0]=g,pPa[a+1]=h,pPa[a+2]=i,pPa[a+3]=j,pPa[a+4]=k,pPa[a+5]=l,!0)}{let s=a+8,t=nPa[a+6],u=s+b,v=t+b,w=c,x=!1,y=!1;iPa?w||(x=iPa.has(u),y=iPa.has(v),w=!x&&!y):(x=!0,y=!0);let z=w||x,A=w||y,B=!1;z&&(B=uPa(s,b,w));let C=!1;A&&(C=uPa(t,b,w));let D=B||C;if(D)for(let E=0;E<3;E++){let F=s+E,G=t+E,H=pPa[F],I=pPa[F+3],J=pPa[G],K=pPa[G+3];pPa[a+E]=H<J?H:J,pPa[a+E+3]=I>K?I:K}return D}}}traverse(vPa,wPa=0){let xPa=this._roots[wPa],yPa=new Uint32Array(xPa),zPa=new Uint16Array(xPa);function APa(a,b=0){let c=2*a,d=65535===zPa[c+15];if(d){let e=yPa[a+6],f=zPa[c+14];vPa(b,d,new Float32Array(xPa,4*a,6),e,f)}else{let g=a+8,h=yPa[a+6],i=yPa[a+7];vPa(b,d,new Float32Array(xPa,4*a,6),i)||(APa(g,b+1),APa(h,b+1))}}APa(0)}raycast(BPa,CPa=P){let DPa=this._roots,EPa=this.geometry,FPa=[],GPa=CPa.isMaterial,HPa=Array.isArray(CPa),IPa=EPa.groups,JPa=GPa?CPa.side:CPa;for(let KPa=0,LPa=DPa.length;KPa<LPa;KPa++){let MPa=HPa?CPa[IPa[KPa].materialIndex].side:JPa,NPa=FPa.length;if(FOa(DPa[KPa]),RMa(0,EPa,MPa,BPa,FPa),GOa(),HPa){let OPa=IPa[KPa].materialIndex;for(let PPa=NPa,QPa=FPa.length;PPa<QPa;PPa++)FPa[PPa].face.materialIndex=OPa}}return FPa}raycastFirst(RPa,SPa=P){let TPa=this._roots,UPa=this.geometry,VPa=SPa.isMaterial,WPa=Array.isArray(SPa),XPa=null,YPa=UPa.groups,ZPa=VPa?SPa.side:SPa;for(let $Pa=0,_Pa=TPa.length;$Pa<_Pa;$Pa++){let aQa=WPa?SPa[YPa[$Pa].materialIndex].side:ZPa;FOa(TPa[$Pa]);let bQa=SMa(0,UPa,aQa,RPa);GOa(),null!=bQa&&(null==XPa||bQa.distance<XPa.distance)&&(XPa=bQa,WPa&&(bQa.face.materialIndex=YPa[$Pa].materialIndex))}return XPa}intersectsGeometry(cQa,dQa){let eQa=this.geometry,fQa=!1;for(let gQa of this._roots)if(FOa(gQa),fQa=ZMa(0,eQa,cQa,dQa),GOa(),fQa)break;return fQa}shapecast(hQa,iQa,jQa){let kQa=this.geometry;if(hQa instanceof Function){if(iQa){let lQa=iQa;iQa=(a,b,c,d)=>{let e=3*b;return lQa(a,e,e+1,e+2,c,d)}}hQa={boundsTraverseOrder:jQa,intersectsBounds:hQa,intersectsTriangle:iQa,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let mQa=TOa.getPrimitive(),{boundsTraverseOrder:nQa,intersectsBounds:oQa,intersectsRange:pQa,intersectsTriangle:qQa}=hQa;if(pQa&&qQa){let rQa=pQa;pQa=(a,b,c,d,e)=>!!rQa(a,b,c,d,e)||EMa(a,b,kQa,qQa,c,d,mQa)}else pQa||(pQa=qQa?(a,b,c,d)=>EMa(a,b,kQa,qQa,c,d,mQa):(a,b,c)=>c);let sQa=!1,tQa=0;for(let uQa of this._roots){if(FOa(uQa),sQa=YMa(0,kQa,oQa,pQa,nQa,tQa),GOa(),sQa)break;tQa+=uQa.byteLength}return TOa.releasePrimitive(mQa),sQa}bvhcast(vQa,wQa,xQa){let{intersectsRanges:yQa,intersectsTriangles:zQa}=xQa,AQa=this.geometry.index,BQa=this.geometry.attributes.position,CQa=vQa.geometry.index,DQa=vQa.geometry.attributes.position;KOa.copy(wQa).invert();let EQa=TOa.getPrimitive(),FQa=TOa.getPrimitive();if(zQa){let GQa=function(a,b,c,d,e,f,g,h){for(let i=c,j=c+d;i<j;i++){DMa(FQa,3*i,CQa,DQa),FQa.a.applyMatrix4(wQa),FQa.b.applyMatrix4(wQa),FQa.c.applyMatrix4(wQa),FQa.needsUpdate=!0;for(let k=a,l=a+b;k<l;k++)if(DMa(EQa,3*k,AQa,BQa),EQa.needsUpdate=!0,zQa(EQa,FQa,k,i,e,f,g,h))return!0}return!1};if(yQa){let HQa=yQa;yQa=function(a,b,c,d,e,f,g,h){return!!HQa(a,b,c,d,e,f,g,h)||GQa(a,b,c,d,e,f,g,h)}}else yQa=GQa}vQa.getBoundingBox(JOa),JOa.applyMatrix4(wQa);let IQa=this.shapecast({intersectsBounds:a=>JOa.intersectsBox(a),intersectsRange:(a,b,c,d,e,f)=>(IOa.copy(f),IOa.applyMatrix4(KOa),vQa.shapecast({intersectsBounds:a=>IOa.intersectsBox(a),intersectsRange:(c,f,g,h,i)=>yQa(a,b,c,f,d,e,h,i)}))});return TOa.releasePrimitive(EQa),TOa.releasePrimitive(FQa),IQa}intersectsBox(JQa,KQa){return LOa.set(JQa.min,JQa.max,KQa),LOa.needsUpdate=!0,this.shapecast({intersectsBounds:a=>LOa.intersectsBox(a),intersectsTriangle:a=>LOa.intersectsTriangle(a)})}intersectsSphere(LQa){return this.shapecast({intersectsBounds:a=>LQa.intersectsBox(a),intersectsTriangle:a=>a.intersectsSphere(LQa)})}closestPointToGeometry(MQa,NQa,OQa={},PQa={},QQa=0,RQa=1/0){MQa.boundingBox||MQa.computeBoundingBox(),LOa.set(MQa.boundingBox.min,MQa.boundingBox.max,NQa),LOa.needsUpdate=!0;let SQa=this.geometry,TQa=SQa.attributes.position,UQa=SQa.index,VQa=MQa.attributes.position,WQa=MQa.index,XQa=TOa.getPrimitive(),YQa=TOa.getPrimitive(),ZQa=OOa,$Qa=POa,_Qa=null,aRa=null;PQa&&(_Qa=QOa,aRa=ROa);let bRa=1/0,cRa=null,dRa=null;return KOa.copy(NQa).invert(),MOa.matrix.copy(KOa),this.shapecast({boundsTraverseOrder:a=>LOa.distanceToBox(a),intersectsBounds:(a,b,c)=>c<bRa&&c<RQa&&(b&&(MOa.min.copy(a.min),MOa.max.copy(a.max),MOa.needsUpdate=!0),!0),intersectsRange:(a,b)=>{if(MQa.boundsTree)return MQa.boundsTree.shapecast({boundsTraverseOrder:a=>MOa.distanceToBox(a),intersectsBounds:(a,b,c)=>c<bRa&&c<RQa,intersectsRange:(c,d)=>{for(let e=3*c,f=(c+d)*3;e<f;e+=3){DMa(YQa,e,WQa,VQa),YQa.a.applyMatrix4(NQa),YQa.b.applyMatrix4(NQa),YQa.c.applyMatrix4(NQa),YQa.needsUpdate=!0;for(let g=3*a,h=(a+b)*3;g<h;g+=3){DMa(XQa,g,UQa,TQa),XQa.needsUpdate=!0;let i=XQa.distanceToTriangle(YQa,ZQa,_Qa);if(i<bRa&&($Qa.copy(ZQa),aRa&&aRa.copy(_Qa),bRa=i,cRa=g/3,dRa=e/3),i<QQa)return!0}}}});{let c=WQa?WQa.count:VQa.count;for(let d=0,e=c;d<e;d+=3){DMa(YQa,d,WQa,VQa),YQa.a.applyMatrix4(NQa),YQa.b.applyMatrix4(NQa),YQa.c.applyMatrix4(NQa),YQa.needsUpdate=!0;for(let f=3*a,g=(a+b)*3;f<g;f+=3){DMa(XQa,f,UQa,TQa),XQa.needsUpdate=!0;let h=XQa.distanceToTriangle(YQa,ZQa,_Qa);if(h<bRa&&($Qa.copy(ZQa),aRa&&aRa.copy(_Qa),bRa=h,cRa=f/3,dRa=d/3),h<QQa)return!0}}}}}),TOa.releasePrimitive(XQa),TOa.releasePrimitive(YQa),bRa===1/0?null:(OQa.point?OQa.point.copy($Qa):OQa.point=$Qa.clone(),OQa.distance=bRa,OQa.faceIndex=cRa,PQa&&(PQa.point?PQa.point.copy(aRa):PQa.point=aRa.clone(),PQa.point.applyMatrix4(KOa),$Qa.applyMatrix4(KOa),PQa.distance=$Qa.sub(PQa.point).length(),PQa.faceIndex=dRa),OQa)}closestPointToPoint(eRa,fRa={},gRa=0,hRa=1/0){let iRa=gRa*gRa,jRa=hRa*hRa,kRa=1/0,lRa=null;if(this.shapecast({boundsTraverseOrder:a=>(NOa.copy(eRa).clamp(a.min,a.max),NOa.distanceToSquared(eRa)),intersectsBounds:(a,b,c)=>c<kRa&&c<jRa,intersectsTriangle:(a,b)=>{a.closestPointToPoint(eRa,NOa);let c=eRa.distanceToSquared(NOa);return c<kRa&&(OOa.copy(NOa),kRa=c,lRa=b),c<iRa}}),kRa===1/0)return null;let mRa=Math.sqrt(kRa);return fRa.point?fRa.point.copy(OOa):fRa.point=OOa.clone(),fRa.distance=mRa,fRa.faceIndex=lRa,fRa}getBoundingBox(nRa){return nRa.makeEmpty(),this._roots.forEach(a=>{zKa(0,new Float32Array(a),SOa),nRa.union(SOa)}),nRa}},oRa=r(t()),pRa=.5*(Math.sqrt(3)-1),qRa=(3-Math.sqrt(3))/6,rRa=1/3,sRa=1/6,tRa=a=>0|Math.floor(a),uRa=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),vRa=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function wRa(a=Math.random){let b=xRa(a),c=new Float64Array(b).map(a=>uRa[a%12*2]),d=new Float64Array(b).map(a=>uRa[a%12*2+1]);return function(a,e){let f=0,g=0,h=0,i=(a+e)*pRa,j=tRa(a+i),k=tRa(e+i),l=(j+k)*qRa,m=j-l,n=k-l,o=a-m,p=e-n,q,r;o>p?(q=1,r=0):(q=0,r=1);let s=o-q+qRa,t=p-r+qRa,u=o-1+2*qRa,v=p-1+2*qRa,w=255&j,x=255&k,y=.5-o*o-p*p;if(y>=0){let z=w+b[x],A=c[z],B=d[z];f=(y*=y)*y*(A*o+B*p)}let C=.5-s*s-t*t;if(C>=0){let D=w+q+b[x+r],E=c[D],F=d[D];g=(C*=C)*C*(E*s+F*t)}let G=.5-u*u-v*v;if(G>=0){let H=w+1+b[x+1],I=c[H],J=d[H];h=(G*=G)*G*(I*u+J*v)}return 70*(f+g+h)}}function xRa(a){let b=new Uint8Array(512);for(let c=0;c<256;c++)b[c]=c;for(let d=0;d<255;d++){let e=d+ ~~(a()*(256-d)),f=b[d];b[d]=b[e],b[e]=f}for(let g=256;g<512;g++)b[g]=b[g-256];return b}var yRa,zRa=new TA,ARa=class{constructor(BRa){this.weightAttribute=null;let CRa=BRa.geometry;if(!CRa.isBufferGeometry||3!==CRa.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");CRa.index&&(CRa=CRa.toNonIndexed()),this.geometry=CRa,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let DRa=this.positionAttribute,ERa=new Float32Array(DRa.count/3);for(let FRa=0;FRa<DRa.count;FRa+=3){let GRa=1;zRa.a.fromBufferAttribute(DRa,FRa),zRa.b.fromBufferAttribute(DRa,FRa+1),zRa.c.fromBufferAttribute(DRa,FRa+2),GRa*=zRa.getArea(),ERa[FRa/3]=GRa}this.distribution=new Float32Array(DRa.count/3);let HRa=0;for(let IRa=0;IRa<ERa.length;IRa++)HRa+=ERa[IRa],this.distribution[IRa]=HRa;return this}setRandomGenerator(JRa){return this.randomFunction=JRa,this}sample(KRa,LRa){if(this.distribution){let MRa=this.distribution[this.distribution.length-1],NRa=this.binarySearch(this.randomFunction()*MRa);return this.sampleFace(NRa,KRa,LRa)}}binarySearch(ORa){if(!this.distribution)return 0;let PRa=this.distribution,QRa=0,RRa=PRa.length-1,SRa=-1;for(;QRa<=RRa;){let TRa=Math.ceil((QRa+RRa)/2);if(0===TRa||PRa[TRa-1]<=ORa&&PRa[TRa]>ORa){SRa=TRa;break}ORa<PRa[TRa]?RRa=TRa-1:QRa=TRa+1}return SRa}sampleFace(URa,VRa,WRa){let XRa=this.randomFunction(),YRa=this.randomFunction();return XRa+YRa>1&&(XRa=1-XRa,YRa=1-YRa),zRa.a.fromBufferAttribute(this.positionAttribute,3*URa),zRa.b.fromBufferAttribute(this.positionAttribute,3*URa+1),zRa.c.fromBufferAttribute(this.positionAttribute,3*URa+2),VRa.set(0,0,0).addScaledVector(zRa.a,XRa).addScaledVector(zRa.b,YRa).addScaledVector(zRa.c,1-(XRa+YRa)),zRa.getNormal(WRa),this}},ZRa=r(u()),$Ra=new rs,_Ra=new rs,aSa=new rs;(yRa||(yRa={})).is=function(a){return a&&a.__isSPEObject};var bSa=a=>class extends a{constructor(){super(...arguments),this.previousModelViewMatrix=new rs,this.copyPreviousMatrix=!0,this.hiddenMatrix=new rs,this.matrixWorldRigid=new rs,this.shearScale=new rs,this.shearScaleInv=new rs}get __isSPEObject(){return!0}isDescendantOf(b){b instanceof Iy&&(b=b.uuid);let c=this;for(;c.parent;){if(c.parent.uuid===b)return!0;c=c.parent}return!1}updateMatrixWorld(d){for(let e of(this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||d)&&(null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,d=!0),this.children))e.updateMatrixWorld(d)}updateWorldMatrix(f,g){let h=this.parent;if(f&&null!==h&&h.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),g)for(let i of this.children)i.updateWorldMatrix(!1,!0)}traverseChildren(j,k=0){for(let l of this.children)yRa.is(l)&&l.traverseObject(j,k+1)}traverseObject(m,n=0){if(!0!==m(this,n))for(let o of this.children)yRa.is(o)&&o.traverseObject(m,n+1)}updateMatrixWorldSVD(){let p=this.matrixWorld.elements,q=[[p[0],p[4],p[8]],[p[1],p[5],p[9]],[p[2],p[6],p[10]]],{u:r,v:s,q:t}=(0,ZRa.SVD)(q),u=$Ra.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),v=_Ra.set(s[0][0],s[0][1],s[0][2],0,s[1][0],s[1][1],s[1][2],0,s[2][0],s[2][1],s[2][2],0,0,0,0,1),w=aSa.copy(v).transpose();this.shearScale.makeScale(t[0],t[1],t[2]).multiply(w).premultiply(v),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(u,w).copyPosition(this.matrixWorld),t.every(a=>.01>Math.abs(t[0]-a))?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(x,y){this.updateWorldMatrix(!0,!1);let z=new rs().copy(this.matrixWorld).invert();return null!==x.parent&&(x.parent.updateWorldMatrix(!0,!1),z.multiply(x.parent.matrixWorld)),"hiddenMatrix"in x&&x.hiddenMatrix instanceof rs?x.hiddenMatrix.premultiply(z):x.applyMatrix4(z),x.updateWorldMatrix(!1,!1),this.add(x),void 0!==y&&(this.children.pop(),this.children.splice(y,0,x)),this}copy(A,B=!1){return super.copy(A,B),this.hasNonUniformScale=A.hasNonUniformScale,this}onAfterRender(C,D,E,F,G,H){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},cSa=class extends bSa(Iy){},dSa=a=>"Mesh"===a.type,eSa=class extends cSa{constructor(fSa){super(),this.object=fSa,this.matrixAutoUpdate=!1,this.hasNonUniformScale=fSa.hasNonUniformScale}raycast(gSa,hSa){}expand(){let iSa=0,jSa=this.object.entityChildren(iSa);for(;jSa;){let kSa=this.children[iSa];kSa?.object!==jSa&&(kSa&&this.remove(kSa),kSa=new eSa(jSa),this.add(kSa),this.children.splice(iSa,0,this.children.pop()),kSa.matrixWorldNeedsUpdate=!0,kSa.matrixAutoUpdate=!1,kSa.matrix=jSa.matrix,kSa.hiddenMatrix=jSa.hiddenMatrix),kSa.expand(),iSa+=1,jSa=this.object.entityChildren(iSa)}for(;this.children.length>iSa;)this.remove(this.children[iSa])}get visible(){return void 0!==this.playModeVisible?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&this.object.dataPatched.cloner?.hideBase=== !0}set visible(lSa){}get castShadow(){return this.object.castShadow}set castShadow(mSa){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(nSa){}get isMesh(){return dSa(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(oSa){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},pSa=new fm,qSa=new fm,rSa=new rs,sSa=[new fm(-1,1,1),new fm(-1,-1,1),new fm(1,-1,1),new fm(1,1,1),new fm(-1,1,-1),new fm(-1,-1,-1),new fm(1,-1,-1),new fm(1,1,-1)],tSa=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],uSa=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],vSa=(a,b,c)=>{a.updateEntityBoxSize(pSa,qSa),rSa.copy(b).multiply(a.matrixWorld),0===qSa.x&&0===qSa.y&&0===qSa.z?c.push(new fm(pSa.x,pSa.y,pSa.z).applyMatrix4(rSa)):sSa.forEach(a=>{c.push(a.clone().multiply(qSa).add(pSa).applyMatrix4(rSa))})},wSa=class extends Io{constructor(){super(...arguments),this.matrix=new rs,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(xSa){return super.copy(xSa),this.matrix.copy(xSa.matrix),this.vertices=xSa.vertices.map(a=>a.clone()),this.faces=xSa.faces.map(a=>a.clone()),this.edges=xSa.edges.map(a=>a.clone()),this.centerEdges=xSa.centerEdges.map(a=>a.clone()),this}setFromObjectSize(ySa,zSa=!1){ySa.updateWorldMatrix(!1,zSa),this.makeEmpty(),this.matrix.copy(ySa.matrixWorld);let ASa=new rs().copy(ySa.matrixWorld).invert();return this.expandByObjectSize(ySa,ASa,zSa)}expandByObjectSize(BSa,CSa,DSa=!1){let ESa=[];return!0===DSa?BSa.traverseEntity(a=>{if(a.visible||a.cloner&&a.data.visible){if(!("geometry"in a)){ESa.push(new fm);return}vSa(a,CSa,ESa)}}):vSa(BSa,CSa,ESa),this.setFromPoints(ESa)}getCenter(FSa){return(FSa=super.getCenter(FSa)).applyMatrix4(this.matrix),FSa}getPositionToCenter(GSa){return(GSa=super.getCenter(GSa)).applyMatrix4(rSa.copy(this.matrix).setPosition(0,0,0)),GSa}computeVertices(){this.getSize(qSa).multiplyScalar(.5),this.getCenter(pSa),rSa.copy(this.matrix).setPosition(pSa),this.vertices=sSa.map(a=>a.clone().multiply(qSa).applyMatrix4(rSa))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=tSa.map(([a,b])=>new Ppa(this.vertices[a],this.vertices[b])),this.centerEdges=this.edges.map(a=>a.getCenter(new fm))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=uSa.map(([a,b])=>this.vertices[a].clone().add(this.vertices[b]).multiplyScalar(.5))}},HSa={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},ISa=class extends J2{constructor(){super()}getPoints(JSa=12){let KSa=[],LSa,MSa=this.getCurveLengths(),NSa=MSa[MSa.length-1]/MSa.length;for(let OSa=0,PSa=this.curves;OSa<PSa.length;OSa++){let QSa=PSa[OSa],RSa=0===OSa?MSa[OSa]:MSa[OSa]-MSa[OSa-1],SSa=Math.ceil(JSa*RSa/NSa),TSa=QSa.getPoints(SSa);for(let USa=0;USa<TSa.length;USa++){let VSa=TSa[USa];LSa&&LSa.equals(VSa)||(KSa.push(VSa),LSa=VSa)}}return this.autoClose&&KSa.length>1&&!KSa[KSa.length-1].equals(KSa[0])&&KSa.push(KSa[0]),KSa}};function WSa(a,b,c){return .001>=b.clone().sub(a).cross(b.clone().sub(c)).length()}function XSa(a,b){let c=new fm(...a.position),d=new fm(...a.controlNext.position),e=new fm(...b.controlPrevious.position),f=new fm(...b.position);return WSa(c,d,f)&&WSa(c,e,f)}function YSa(a){let b=a.points.map(a=>new fm(...a.data.position)),c=[a.points[0]],d=new fm(...c[0].data.position);for(let e=0;e<a.points.length-1;e++)WSa(d,b[e],b[e+1])||(c.push(a.points[e]),d=b[e]);c.push(a.points[a.points.length-1]);let f=a.isClosed,g=c.length-(f?0:1),h=c.length,i=[];for(let j=0;j<h;j++){let k=c[j].data,l=new fm(...k.position),m=new fm(...k.controlPrevious.position),n=new fm(...k.controlNext.position),o={position:l,baseRoundness:k.roundness,controlPrevious:m,controlNext:n};if(0===k.roundness|| !a.isClosed&&(0===j||j===h-1)){i[j]={...o,removedLength:0};continue}let p=f&&0==j?h-1:j-1,q=f&&j==h-1?0:j+1,r=c[p].data,s=c[q].data,t=new fm(...r.position),u=new fm(...s.position),v=t.clone().sub(l).normalize(),w=u.clone().sub(l).normalize();Object.assign(o,{prevDir:v,nextDir:w});let x=XSa(r,k),y=XSa(k,s);if(x&&y){let z=v.clone().add(w).normalize(),A=z.clone().cross(v).length()/v.dot(z);i[j]={...o,tan:A,removedLength:k.roundness/A}}else i[j]={...o,removedLength:0}}for(let B=0;B<g;B++){let C=B,D=f&&B===h-1?0:B+1,E=i[C],F=i[D];if(0!==E.removedLength||0!==F.removedLength){let G=E.position.distanceTo(F.position);E.removedLength=Math.min(E.removedLength,G/2),F.removedLength=Math.min(F.removedLength,G/2)}}let H=[];for(let I=0;I<g;I++){let J=I,K=f&&I===h-1?0:I+1,L=i[J],M=i[K],N=null;if(XSa(c[J].data,c[K].data)){let O=L.position.clone(),P=M.position.clone();(0!==L.removedLength||0!==M.removedLength)&&(L.nextDir&&O.add(L.nextDir.clone().setLength(L.removedLength)),M.prevDir&&P.add(M.prevDir.clone().setLength(M.removedLength))),O.distanceTo(P)>.001&&(N=new Z0(O,O.clone().lerp(P,.3),P.clone().lerp(O,.3),P))}else L.position.distanceTo(M.position)>.001&&(N=new Z0(L.position,L.controlNext,M.controlPrevious,M.position));H[2*I+1]=N}for(let Q=0;Q<h;Q++){let R=i[Q];if(0===R.removedLength){H[2*Q]=null;continue}let S=R.position,T=R.prevDir.clone().multiplyScalar(R.removedLength).add(S),U=R.nextDir.clone().multiplyScalar(R.removedLength).add(S),V=R.tan*R.removedLength,W=R.prevDir.clone().add(R.nextDir).normalize(),X=T.clone().lerp(U,.5),Y=T.distanceTo(U)/2,Z=W.clone().multiplyScalar(Math.sqrt(Math.pow(V,2)-Math.pow(Y,2))).add(X),$=W.clone().multiplyScalar(-V).add(Z),_=S.distanceTo($)/S.distanceTo(X),aa=R.prevDir.clone().multiplyScalar(_*S.distanceTo(T)).add(S),ba=aa.clone().lerp($,2),ca=T.clone().lerp(aa,4/3),da=U.clone().lerp(ba,4/3);H[2*Q]=new Z0(T,ca,da,U)}let ea=new ISa;return H.forEach(a=>{a&&ea.add(a)}),ea}(Fsb||(Fsb={})).is=function(a){return a&&a.__isEntity};var ZSa=a=>Fsb.is(a),$Sa={type:"completeState",isfromEntity:!0},_Sa=["x","y","z"],aTa=new fm,bTa=new fm().set(0,1,0),cTa=a=>class extends bSa(a){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new wSa,this._recursiveBBox=new wSa,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(b){let c=this.children[b];if(Fsb.is(c))return c}entityChildrenCount(){let d=this.children.length;for(;d--;)if(Fsb.is(this.children[d]))return d+1;return 0}get isConcreteEntity(){return"string"==typeof this.identity}get isVirtualEntity(){return"string"!=typeof this.identity}get isInstanceRoot(){return this.isConcreteEntity&&"Instance"===this.data.type}nearestInstanceSelfOrParent(){let e=this;for(;"Instance"!==e.data.type;){let f=e.parent;if(!Fsb.is(f))return;e=f}return e}forInstancesRec(g){this.instances.forEach(a=>{a.disposed||g(a),a.forInstancesRec(g)})}super_Entity(h,i){"string"==typeof h&&(this.uuid=h),this.identity=h,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(j,k,l=!1){if(!(0===this.data.states.length&&!l)){for(let m of this.data.states)SNa.toOps(this.data,m.data).forEach(a=>{let b=ZFa.replaceProps(a,this.data);this.dataPatched=this.data,this.updateByPatchedOp(b,this.data,k)});if(null!==j){let n=this.data.states.data(j);n&&(this.dataPatched=SNa.patch(this.data,n),SNa.toOps(this.data,n).forEach(a=>{this.updateByPatchedOp(a,this.dataPatched,k)}))}l&&this.updateTransformState(this.dataPatched,k),this.stateSelection=j,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(o,p){o.setScalar(0),p.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(a=>{ZSa(a)&&a.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(a=>{a.resetBBoxNeedsUpdateSelf()})}find(q){let r;return this.traverseEntity(a=>{a.uuid===q&&(r=a)}),r}traverseSortNextHelper(){let s=this.parent;if(s){let t=s.children,u=t.indexOf(this)+1;if(Fsb.is(t[u]))return t[u];if(Fsb.is(s))return s.traverseSortNextHelper()}}sortNext(){let v=this.children;return this.children.length>0&&Fsb.is(this.children[0])?v[0]:this.traverseSortNextHelper()}goUp(w){let x=this;for(;w>0&&null!==x;)x=x.parent,w-=1;return x}hasAnccestorOrSelf(y){return this===y||this.hasAnccestor(y)}hasAnccestor(z){let A=this.parent;for(;A;){if(z===A)return!0;A=A.parent}return!1}countToAccestor(B){let C=0,D=this;for(;D!==B;){if(null===D)return -1;D=D.parent,C+=1}return C}forEachEntity(E){for(let F of this.children)ZSa(F)&&E(F)}traverseEntityAncestors(G){this.traverseAncestors(a=>{Fsb.is(a)&&G(a)})}traverseConcreteEntity(H,I=0){if(!0!==H(this,I))for(let J of this.children)ZSa(J)&&J.isConcreteEntity&&J.traverseEntity(H,I+1)}traverseEntity(K,L=0){if(!0!==K(this,L))for(let M of this.children)ZSa(M)&&M.traverseEntity(K,L+1)}traverseVisibleEntity(N){for(let O of(N(this),this.children))ZSa(O)&&O.visible&&O.traverseVisibleEntity(N)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(P){super.updateMatrixWorld(P),this.dispatchEvent({type:"updateMatrixWorld"})}copy(Q,R=!1){return super.copy(Q,R),this.dataPatched=Q.dataPatched,this.raycastLock=Q.raycastLock,this.scaleLock=Q.scaleLock,this.hiddenMatrix.copy(Q.hiddenMatrix),this}hasEntityChild(){return this.children.some(a=>ZSa(a))}isAncestorOf(S){if(this.uuid===S)return!1;let T=!1;return this.traverseEntity(a=>{a.uuid===S&&(T=!0)}),T}toObjectTransformState(U=[]){return this.updateWorldMatrix(!0,!1),Aya({position:this.position.toArray(),rotation:[this.rotation.x*Db.RAD2DEG,this.rotation.y*Db.RAD2DEG,this.rotation.z*Db.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()},U)}getTransformValues(V,W,X){return W[V].map((a,b)=>X?.shared.getVariable(a,[this.uuid,V,_Sa[b]])??a)}updateTransformState(Y,Z){let $=!1;return Y.position&&(this.position.fromArray(this.getTransformValues("position",Y,Z)),$=!0),Y.rotation&&(aTa.fromArray(this.getTransformValues("rotation",Y,Z)).multiplyScalar(Db.DEG2RAD),this.rotation.setFromVector3(aTa),$=!0),Y.scale&&(this.scale.fromArray(this.getTransformValues("scale",Y,Z)),$=!0),void 0!==Y.hiddenMatrix&&($=!0,this.hiddenMatrix.fromArray(Y.hiddenMatrix??yJa.identity)),$&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(a=>{a.invalidateClonerTransform(this)})),Y.position&&Y.rotation&&Y.scale&& void 0!==Y.hiddenMatrix&&this.updateWorldMatrix(!1,!0),$}onVariableUpdate(_=!1){if(_){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(a=>{a.invalidateClonerTransform(this)})}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let aa of this.children)Fsb.is(aa)&&aa.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(a=>{Fsb.is(a)&&a.disposeRecursively()})}toState(ba=[]){return Aya({name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(ba)},ba)}updateByObjUpdateOp(ca,da){void 0!==ca&&this.updateByOp({type:0,props:ca,path:[]},{...this.data,...ca},da,!1)}updateByOp(ea,fa,ga,ha){let ia=this.data;this.data=fa;let ja=ea,ka=TFa(ea.path,["states","*"]);if(null!==ka){if(0===ea.type){let[la]=ka;if(this?.stateSelection===la){let ma={...ea.props};if(delete ma.name,Object.values(ea.props).some(a=>void 0===a)){let na=this.data;if(void 0!==na){let oa=aGa.zoom(na,ea.path.slice(2));if(oa)for(let pa in ea.props)void 0===ea.props[pa]&&pa in oa&&(ma[pa]=oa[pa])}}ja={...ea,props:ma,path:ea.path.slice(2)}}}}else if(0===ea.type){let qa=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==qa){if(void 0!==ea.props.name&&qa.name){let{name:ra,...sa}=qa;qa=sa}if(void 0!==ea.props.material&&"material"in qa){let{material:ta,...ua}=qa;qa=ua}let va=aGa.removeOverridden(ea.path,ea.props,qa);ja={...ea,props:va}}}if(this.updateByPatchedOpBase(ja,SNa.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),ga),TFa(ea.path,["overrides"])){let wa=[],xa=[...ea.path];for(wa.push(xa[1]),xa.splice(0,2);xa.length>0&&"descendants"===xa[0];)wa.push(xa[1]),xa.splice(0,2);if(void 0===wa[wa.length-1]){if(0===ea.type)for(let ya of Object.keys(ea.props)){wa[wa.length-1]=ya;let za=ga.scene.findInstance([this.uuid,...wa]);za&&(za.overrideData=ea.props[ya],za.updateState(GCa.apply(za.component.data,za.overrideData),ga))}}else{let Aa=ga.scene.findInstance([this.uuid,...wa]);if(Aa){let Ba=aGa.zoom(Aa.component.data,xa);if(0===(ea={...ea,path:xa}).type){let Ca=ea.props;if(Ba)for(let[Da,Ea]of Object.entries(ea.props))void 0===Ea&&(Ca===ea.props&&(Ca={...ea.props}),Ca[Da]=Ba[Da]);ea={...ea,props:Ca}}Aa.overrideData=ONa.resolve(fa.overrides,wa),Aa.updateByOp(ea,$Fa.applySimple(Aa.data,ea),ga,!1)}}}else if(this.instances.length>0){let Fa;if(0===ea.path.length&&0===ea.type){let Ga;for(let Ha of PNa.rootOverrideProps)Ha in ea.props&&(void 0===Ga&&(Ga={}),Ga[Ha]=ea.props[Ha]);Ga&&(Fa={...ea,props:Ga})}else for(let Ia of PNa.rootOverrideProps)if(TFa(ea.path,[Ia])){Fa=ea;break}void 0!==Fa&&this.instances.forEach(a=>{if(a.isInstanceRoot){let b=GCa.filterOp(a.overrideData,Fa);b&&a.updateByOp(b,$Fa.applySimple(a.data,b),ga,!0)}}),this.instances.forEach(a=>{if(!a.isInstanceRoot){let b=GCa.filterOp(a.overrideData,ea);if(b){let c;c=ia===a.data&&ea===b?fa:$Fa.applySimple(a.data,b),a.updateByOp(b,c,ga,!0)}}})}}updateByPatchedOpBase(Ja,Ka,La){if(this.dataPatched=Ka,0===Ja.path.length&&0===Ja.type)void 0===Ja.props.type||FJa.is(Ja.props.type)||HSa.changeEntityProptotype(this,Ka,La);else if(1===Ja.path.length&&"geometry"===Ja.path[0]&&0===Ja.type&&"type"in Ja.props)for(let Ma of(HSa.changeEntityProptotype(this,Ka,La),this.children))Fsb.is(Ma)&&Ma.updateVisible(La.scene);this.updateByPatchedOp(Ja,Ka,La)}updateByPatchedOp(Na,Oa,Pa){if(0===Na.path.length&&0===Na.type&&this.updateState(Na.props,Pa),null!==TFa(Na.path,["pathSnapping"])&&this.updatePathSnapping(Oa.pathSnapping),null!==TFa(Na.path,["cloner"])){let Qa=$Fa.drop(Na,1);0===Qa.path.length&&0===Qa.type&& !0===Qa.props.disabled?this.setFromClonerState(null,Pa):this.cloner?this.cloner.updateState(Oa.cloner,Pa.scene):(this.setFromClonerState(Oa.cloner,Pa),this.expandCloner(Pa.scene)),this.updateVisible(Pa.scene)}}updatePathSnapping(Ra=this.dataPatched.pathSnapping){this._updatedPathSnapping=Ra,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(Sa){let Ta=this._updatedPathSnapping?.pathId??this.dataPatched.pathSnapping.pathId,Ua=(this._updatedPathSnapping?.slide??this.dataPatched.pathSnapping.slide)??0,Va=(this._updatedPathSnapping?.offset??this.dataPatched.pathSnapping.offset)??0,Wa=this._updatedPathSnapping?.orientation??this.dataPatched.pathSnapping.orientation;if(null===Ta)return;let Xa=Sa.find(Ta);if(!Xa|| !1===this._needApplyPathSnapping)return;this._needApplyPathSnapping=!1;let Ya=Xa.data;if(Ya.geometry.path.points.length<=1)return;let Za=YSa(Ya.geometry.path),$a=(Ua+Va)%1;Ua+Va===1&&0===$a&&($a=1);let _a=Za.getPointAt($a);if(null===_a)return;let ab=this.parent?this.parent?.matrixWorld:new rs;Xa.updateMatrixWorld();let bb=new rs().multiplyMatrices(ab.clone().invert(),Xa.matrixWorld);_a.applyMatrix4(bb);let cb={position:_a.toArray(),rotation:Ya.rotation};if("tangential"===Wa){let db=new rs().extractRotation(Xa.matrixWorld),eb=Za.getTangentAt($a).applyMatrix4(db).add(_a),fb=new rs().lookAt(_a,eb,bTa),gb=aTa.setFromEuler(new Ex().setFromRotationMatrix(fb)).multiplyScalar(Db.RAD2DEG);cb={...cb,rotation:gb.toArray()}}this.updateTransformState(cb),this.traverseEntity(a=>{a._cameraType&&a.dispatchEvent($Sa)})}updateVisible(hb){if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled?? !1)||this.dataPatched.cloner?.hideBase!== !0),!hb)return;let ib=!1;this.traverseEntity(a=>{if("Splat"===a.data.type)return ib=!0,!0}),ib&&hb.reloadSplats()}updateState_Entity(jb,kb){void 0!==jb.name&&(this.name=jb.name),void 0!==jb.raycastLock&&(this.raycastLock=jb.raycastLock),void 0!==jb.visible&&(this.updateVisible(kb?.scene),this.resetBBoxNeedsUpdate()),kb&&"cloner"in jb&& void 0!==jb.cloner&&(this.setFromClonerState(jb.cloner,kb),this.updateVisible(kb.scene)),this.updateTransformState(jb,kb)}get attachedSurfaceCloners(){return this.children.filter(a=>a instanceof HSa.Cloner&&"toObject"===a.parameters.type)}setFromClonerState(lb,mb){this.disposed||(null===lb||lb.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):void 0===this.cloner?(this.cloner=new HSa.Cloner(this,lb),mb.scene.addPendingExpandCloner(this)):this.cloner.updateState(lb,mb.scene))}expandCloner(nb){!this.disposed&&this.cloner&&this.cloner.expandClones(nb)}invalidateClonerTransform(ob){this.cloner&&this.cloner.invalidateTransform(ob)}requestRender(){this.dispatchEvent({type:"requestRender"})}},dTa=class{static create(eTa){return this.build(this.normalizeInputs(eTa))}static normalizeInputs(fTa,gTa){let hTa=Object.assign({},gTa?.parameters??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},fTa.parameters);hTa.thetaLength=Db.clamp(hTa.thetaLength,0,360);let iTa=hTa.width/2,jTa=hTa.radiusTop??iTa,kTa=hTa.radiusBottom??iTa;return jTa===kTa?(jTa=iTa,kTa=iTa):jTa>kTa?(jTa=iTa,kTa=kTa*iTa/jTa):(jTa=jTa*iTa/kTa,kTa=iTa),{parameters:Object.assign(hTa,{width:Math.abs(hTa.width),height:Math.abs(hTa.height??hTa.width),depth:Math.abs(hTa.depth??hTa.width),radiusTop:jTa,radiusBottom:kTa})}}static build(lTa){let{width:mTa,depth:nTa,height:oTa,radialSegments:pTa,heightSegments:qTa,openEnded:rTa,thetaStart:sTa,thetaLength:tTa,radiusTop:uTa,radiusBottom:vTa,cornerRadius:wTa,cornerSegments:xTa,hollow:yTa}=lTa.parameters,zTa;return 0===tTa?(zTa=new nE).setAttribute("position",new cE([],3)):zTa=wTa||yTa?new CTa(uTa,vTa,oTa,pTa,qTa,rTa,sTa,tTa*Math.PI/180,wTa,wTa,xTa,yTa):new o5(uTa,vTa,oTa,pTa,qTa,rTa,sTa,tTa*Math.PI/180),zTa.scale(1,1,nTa/mTa),Object.assign(zTa,{userData:{...lTa,type:"CylinderGeometry"}})}};function ATa(a,b,c){c.x=a.x*b.x,c.y=a.y,c.z=a.x*b.y}function BTa(a){return new Eb(a.y,-a.x)}var CTa=class extends nE{constructor(DTa,ETa,FTa,GTa,HTa,ITa,JTa,KTa,LTa,MTa,NTa,OTa,PTa=!1){super(),this.type="RoundedCylinderBufferGeometry",DTa=void 0!==DTa?DTa:1,ETa=void 0!==ETa?ETa:1,FTa=FTa||1,GTa=Math.floor(GTa)||8,HTa=Math.floor(HTa)||1,ITa=void 0!==ITa&&ITa,JTa=void 0!==JTa?JTa:0,KTa=void 0!==KTa?KTa:2*Math.PI,ITa&&(LTa=0,MTa=0);let QTa=[],RTa=[],STa=[],TTa=[],UTa=0,VTa=FTa/2,WTa=new fm,XTa=new fm;PTa&&0==DTa&&(DTa=LTa),PTa&&0==ETa&&(ETa=MTa);let YTa=new Eb(DTa,VTa),ZTa=new Eb(ETa,-VTa),$Ta=null,_Ta=null,aUa=null,bUa=null,cUa=YTa.clone().sub(ZTa),dUa=0,eUa=0,fUa=0;OTa>0&&(dUa=Math.min(DTa,ETa)*(1-OTa),eUa=DTa-dUa,fUa=ETa-dUa);let gUa=YTa.clone();gUa.x-=dUa;let hUa=Math.PI-cUa.angle(),iUa=cUa.angle(),jUa=Math.tan(iUa/2),kUa=Math.tan(hUa/2),lUa=jUa+kUa,mUa=OTa?lUa:kUa,nUa=OTa?lUa:jUa;if(LTa=Math.min(LTa,(DTa-eUa)/mUa,cUa.length()/lUa),MTa=Math.min(MTa,(ETa-fUa)/nUa,cUa.length()/lUa),LTa>0){let oUa=LTa/jUa;$Ta=YTa.clone().sub(new Eb(oUa,LTa)),OTa&&(aUa=$Ta.clone(),aUa.x-=dUa-lUa*LTa),YTa.sub(cUa.clone().setLength(oUa))}if(MTa>0){let pUa=MTa/kUa;_Ta=ZTa.clone().sub(new Eb(pUa,-MTa)),ZTa.add(cUa.clone().setLength(pUa)),OTa&&(bUa=_Ta.clone(),bUa.x-=dUa-lUa*MTa,gUa.sub(cUa.clone().setLength(pUa)))}let qUa=.5>(cUa=YTa.clone().sub(ZTa)).length(),rUa=[];for(let sUa=0;sUa<=GTa;sUa++){let tUa=[],uUa=sUa/GTa,vUa=uUa*KTa+JTa,wUa=new Eb(Math.sin(vUa),Math.cos(vUa));if(bUa&&_Ta?(JUa(tUa,uUa,wUa,hUa,MTa,bUa,-1,!0),JUa(tUa,uUa,wUa,iUa,MTa,_Ta,-1,!1)):_Ta?(KUa(tUa,wUa,_Ta.x,0,-1),JUa(tUa,uUa,wUa,iUa,MTa,_Ta,-1,!1)):ITa||KUa(tUa,wUa,ETa,fUa,-1),ATa(BTa(cUa).normalize(),wUa,WTa),!qUa)for(let xUa=0;xUa<=HTa;xUa++){let yUa=xUa/HTa;ATa(cUa.clone().multiplyScalar(yUa).add(ZTa),wUa,XTa),RTa.push(XTa.x,XTa.y,XTa.z),STa.push(WTa.x,WTa.y,WTa.z),TTa.push(uUa,.5+XTa.y/FTa),tUa.push(UTa++)}if(aUa&&$Ta?(JUa(tUa,uUa,wUa,hUa,LTa,$Ta,1,!1),JUa(tUa,uUa,wUa,iUa,LTa,aUa,1,!0)):$Ta?(JUa(tUa,uUa,wUa,hUa,LTa,$Ta,1,!1),KUa(tUa,wUa,$Ta.x,0,1)):ITa||KUa(tUa,wUa,DTa,eUa,1),OTa&&!qUa){ATa(BTa(cUa).multiplyScalar(-1).normalize(),wUa,WTa);for(let zUa=0;zUa<=HTa;zUa++){let AUa=zUa/HTa;ATa(cUa.clone().multiplyScalar(-AUa).add(gUa),wUa,XTa),RTa.push(XTa.x,XTa.y,XTa.z),STa.push(WTa.x,WTa.y,WTa.z),TTa.push(uUa,.5+XTa.y/FTa),tUa.push(UTa++)}}OTa&&!ITa&&tUa.push(tUa[0]),rUa.push(tUa)}for(let BUa=0;BUa<rUa.length-1;BUa++)for(let CUa=0;CUa<rUa[0].length-1;CUa++){if(ITa&&OTa&&CUa==HTa)continue;let DUa=rUa[BUa][CUa],EUa=rUa[BUa+1][CUa],FUa=rUa[BUa+1][CUa+1],GUa=rUa[BUa][CUa+1],HUa=RTa[3*FUa+0],IUa=RTa[3*FUa+2];QTa.push(DUa,EUa,GUa),(0!=HUa||0!=IUa)&&QTa.push(EUa,FUa,GUa)}function JUa(a,b,c,d,e,f,g,h){for(let i=0;i<NTa+1;i++){let j=i/NTa,k=g<0?j:1-j;h&&(k-=1),k*=d;let l=new Eb(Math.sin(k),Math.cos(k)*g);ATa(l.clone().multiplyScalar(e).add(f),c,XTa),RTa.push(XTa.x,XTa.y,XTa.z),ATa(l,c,WTa),STa.push(WTa.x,WTa.y,WTa.z),TTa.push(b,.5+XTa.y/FTa),a.push(UTa++)}}function KUa(a,b,c,d,e){let f=new fm,g=new Eb,h=[c,d];for(let i of(e<0&&h.reverse(),h))g.set(i,VTa*e),ATa(g,b,f),RTa.push(f.x,f.y,f.z),STa.push(0,e,0),TTa.push(.5,.5),a.push(UTa++)}function LUa(a,b,c){let d=new Eb(Math.sin(c),Math.cos(c)),e=new Eb(-Math.cos(c),Math.sin(c)),f=new fm,g=a<0?(a,b,c)=>QTa.push(a,b,c):(a,b,c)=>QTa.push(a,c,b),h=new Eb((DTa+ETa+eUa+fUa)/4,0);ATa(h,d,f),RTa.push(f.x,f.y,f.z),STa.push(e.x,0,e.y),TTa.push(.5,.5);let i=UTa++;for(let j of b){let k=RTa.slice(3*j,3*j+3);RTa.push(...k),STa.push(e.x,0,e.y);let l=TTa.slice(2*j,2*j+2);TTa.push(...l),UTa++}for(let m=i+1;m<UTa-1;m++)g(i,m,m+1);g(i,UTa-1,i+1)}KTa<2*Math.PI&&(LUa(-1,rUa[0],JTa),LUa(1,rUa[rUa.length-1],JTa+KTa)),this.setIndex(QTa),this.setAttribute("position",new cE(RTa,3)),this.setAttribute("normal",new cE(STa,3)),this.setAttribute("uv",new cE(TTa,2))}},MUa=class{static create(NUa){return this.build(this.normalizeInputs(NUa))}static normalizeInputs(OUa,PUa){let QUa=Object.assign({},PUa?.parameters??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},OUa.parameters);return QUa.thetaLength=Db.clamp(QUa.thetaLength,0,360),{parameters:Object.assign(QUa,{width:Math.abs(QUa.width),height:Math.abs(QUa.height??QUa.width),depth:Math.abs(QUa.depth??QUa.width)})}}static build(RUa){let{width:SUa,depth:TUa,height:UUa,radialSegments:VUa,heightSegments:WUa,openEnded:XUa,thetaStart:YUa,thetaLength:ZUa,cornerRadiusTop:$Ua,cornerRadiusBottom:_Ua,cornerSegments:aVa}=RUa.parameters,bVa;return 0===ZUa?(bVa=new nE).setAttribute("position",new cE([],3)):bVa=$Ua>0||_Ua>0||ZUa<360?new CTa(0,SUa/2,UUa,VUa,WUa,XUa,YUa,ZUa*Math.PI/180,$Ua,_Ua,aVa,0,!0):new I5(SUa/2,UUa,VUa,WUa,XUa),bVa.scale(1,1,TUa/SUa),Object.assign(bVa,{userData:{...RUa,type:"ConeGeometry"}})}},cVa=class{static create(dVa){return this.build(this.normalizeInputs(dVa))}static normalizeInputs(eVa,fVa){let gVa=Object.assign({},fVa?.parameters??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},eVa.parameters);return{parameters:Object.assign(gVa,{width:Math.abs(gVa.width),height:Math.abs(gVa.height??gVa.width),depth:Math.abs(gVa.depth??gVa.width)})}}static build(hVa){let{width:iVa,height:jVa,depth:kVa,widthSegments:lVa,heightSegments:mVa,depthSegments:nVa,cornerRadius:oVa,cornerSegments:pVa}=hVa.parameters,qVa;return qVa=0==oVa?new XI(iVa,jVa,kVa,lVa,mVa,nVa):new sVa(iVa,jVa,kVa,lVa,mVa,nVa,oVa,pVa),Object.assign(qVa,{userData:{...hVa,type:"CubeGeometry"}})}},rVa=Math.PI/2,sVa=class extends nE{constructor(tVa=1,uVa=1,vVa=1,wVa=1,xVa=1,yVa=1,zVa=0,AVa=4){super(),this.type="BoxGeometry";let BVa=this;wVa=Math.floor(wVa),xVa=Math.floor(xVa),yVa=Math.floor(yVa),AVa=Math.floor(AVa),zVa=Math.min(zVa,tVa/2,uVa/2,vVa/2);let CVa=[],DVa=[],EVa=[],FVa=[],GVa=0,HVa=0;function IVa(a,b,c,d,e,f,g,h,i,j,k){let l=(f-2*zVa)/i,m=(g-2*zVa)/j,n=f/2-zVa,o=g/2-zVa,p=h/2,q=i+1,r=j+1,s=0,t=0,u=new fm;for(let v=0;v<r;v++){let w=v*m-o;for(let x=0;x<q;x++){let y=x*l-n;u[a]=y*d,u[b]=w*e,u[c]=p,DVa.push(u.x,u.y,u.z),u[a]=0,u[b]=0,u[c]=h>0?1:-1,EVa.push(u.x,u.y,u.z),FVa.push(x/i),FVa.push(1-v/j),s+=1}}for(let z=0;z<j;z++)for(let A=0;A<i;A++){let B=GVa+A+q*z,C=GVa+A+q*(z+1),D=GVa+(A+1)+q*(z+1),E=GVa+(A+1)+q*z;CVa.push(B,C,E),CVa.push(C,D,E),t+=6}BVa.addGroup(HVa,t,k),HVa+=t,GVa+=s}function JVa(a,b,c,d,e,f,g,h,i,j,k){let l=(g-2*zVa)/j,m=g/2-zVa,n=h/2-zVa,o=i/2,p=j+1,q=0,r=0,s=new fm,t=new fm;for(let u=0;u<AVa+1;u++){let v=u/AVa*rVa,w=Math.sin(v)*zVa,x=(1-Math.cos(v))*zVa,y=Math.sin(v),z=Math.cos(v);s[b]=(n+w)*e,s[c]=(o-x)*f,t[a]=0,t[b]=y*Math.sign(s[b]),t[c]=z*Math.sign(s[c]);for(let A=0;A<p;A++){let B=A*l-m;s[a]=B*d,DVa.push(s.x,s.y,s.z),EVa.push(t.x,t.y,t.z),FVa.push(A/j),FVa.push(0),q+=1}}for(let C=0;C<AVa;C++)for(let D=0;D<j;D++){let E=GVa+D+p*C,F=GVa+D+p*(C+1),G=GVa+(D+1)+p*(C+1),H=GVa+(D+1)+p*C;CVa.push(E,F,H),CVa.push(F,G,H),r+=6}BVa.addGroup(HVa,r,k),HVa+=r,GVa+=q}function KVa(a,b,c){let d=new fm,e=new fm(tVa/2,uVa/2,vVa/2);e.subScalar(zVa);let f=[],g=a*b*c>0?(a,b,c)=>CVa.push(a,b,c):(a,b,c)=>CVa.push(a,c,b);for(let h=0;h<=AVa;h++){let i=[],j=rVa*(1-h/AVa),k=Math.cos(j),l=Math.sin(j),m=0;for(let n=0;n<=h;n++){let o=Math.cos(m),p=Math.sin(m);d.x=k*o,d.y=l,d.z=k*p;let q=e.clone().addScaledVector(d,zVa);DVa.push(a*q.x,b*q.y,c*q.z),EVa.push(a*d.x,b*d.y,c*d.z),FVa.push(0,0),i.push(GVa++),m+=rVa/h}f.push(i)}let r=f.length-1;for(let s=0;s<r;s++){let t=f[s],u=f[s+1],v=t.length-1;g(t[0],u[1],u[0]);for(let w=1;w<=v;w++)g(t[w-1],t[w],u[w]),g(t[w],u[w+1],u[w])}}IVa("z","y","x",-1,-1,vVa,uVa,tVa,yVa,xVa,0),IVa("z","y","x",1,-1,vVa,uVa,-tVa,yVa,xVa,1),IVa("x","z","y",1,1,tVa,vVa,uVa,wVa,yVa,2),IVa("x","z","y",1,-1,tVa,vVa,-uVa,wVa,yVa,3),IVa("x","y","z",1,-1,tVa,uVa,vVa,wVa,xVa,4),IVa("x","y","z",-1,-1,tVa,uVa,-vVa,wVa,xVa,5),zVa>0&&(JVa("z","y","x",-1,-1,1,vVa,uVa,tVa,yVa,0),JVa("z","y","x",1,-1,-1,vVa,uVa,tVa,yVa,1),JVa("z","y","x",-1,1,-1,vVa,uVa,tVa,yVa,1),JVa("z","y","x",1,1,1,vVa,uVa,tVa,yVa,0),JVa("x","y","z",-1,-1,-1,tVa,uVa,vVa,wVa,0),JVa("x","y","z",1,-1,1,tVa,uVa,vVa,wVa,1),JVa("x","y","z",-1,1,1,tVa,uVa,vVa,wVa,0),JVa("x","y","z",1,1,-1,tVa,uVa,vVa,wVa,1),JVa("y","x","z",-1,-1,1,uVa,tVa,vVa,xVa,0),JVa("y","x","z",1,-1,-1,uVa,tVa,vVa,xVa,1),JVa("y","x","z",1,1,1,uVa,tVa,vVa,xVa,1),JVa("y","x","z",-1,1,-1,uVa,tVa,vVa,xVa,0),KVa(1,1,1),KVa(-1,1,1),KVa(1,-1,1),KVa(-1,-1,1),KVa(1,1,-1),KVa(-1,1,-1),KVa(1,-1,-1),KVa(-1,-1,-1)),this.setIndex(CVa),this.setAttribute("position",new cE(DVa,3)),this.setAttribute("normal",new cE(EVa,3)),this.setAttribute("uv",new cE(FVa,2))}},LVa=class extends nE{constructor(MVa=[],NVa=[],OVa="",PVa=1,QVa=.2,RVa=4){super(),this.type="PolyhedronGeometryRound";let SVa=[],TVa=[],UVa=[];(function(){0==(QVa=Math.min(1-1e-5,QVa))&&(RVa=0);let a={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[OVa],b=new fm,c=b.clone(),d=new TA,e=QVa*PVa,f=PVa-e,g=RVa+1,h=new fm,i=(a,b)=>h.subVectors(a,b).normalize(),j=(a,b)=>Array(a).fill(void 0).map(b),k=j(MVa.length/3,(a,b)=>new fm().fromArray(MVa,3*b).setLength(PVa)),l=[],m=1e6;for(let n=0;n<k.length;n++){let o=k[n],p=[],q,r,s,t=1e10,u=-1;for(;-1!=(u=NVa.indexOf(n,u+1));){let v=u-u%3;q=NVa[v+(u+1)%3],r=NVa[v+(u+2)%3],s=o.distanceToSquared(k[q]),t=Math.min(t,s),p.push([q,r,s])}t+=1e-6;let w=[],x=0,y=p.length;for(let z=0;z<y;z++){[q,r,s]=p[x];let A=!0==l[q]?.includes(n);s<=t&&w.push(q+ +A*m),x=p.findIndex(a=>a[0]==r)}l.push(w)}let B=[];{let C=0,D=0,E,F,G=3==a;for(let H=0;H<=RVa;H++){E=H*(H+1)/2,F=(H+1)*(H+2)/2;for(let I=0;I<RVa-H;I++)[C,D]=[E+I+H+2,F+I+H+3],B.push(E,F,...G?[D,E]:[C,F],D,C),[E,F]=[C,D];B.push(E,F,E+RVa+2)}}let J=b.clone(),K=b.clone(),L=b.clone(),M=b.clone(),N=b.clone(),O=[],P=j(k.length,()=>j(a,()=>b.clone()));for(let Q=0;Q<k.length;Q++){b.copy(k[Q]).normalize(),J.copy(b).multiplyScalar(f);let R=l[Q];for(let S=0;S<R.length;S++){let T=R[S],U=R[(S+1)%a];d.setFromPointsAndIndices(k,Q,T%m,U%m),d.b.sub(d.a).setLength(1e10).add(d.a),d.c.sub(d.a).setLength(1e10).add(d.a),d.closestPointToPoint(J,P[Q][S])}let V=[],W=[],X=[],Y=new fm;0==RVa&&[...P[Q]].reduce((a,b)=>a.add(b),Y).multiplyScalar(1/a);for(let Z=0;Z<a;Z++){let $=[],_=(Z-1+a)%a,aa=P[Q][_],ba=P[Q][Z];b.copy(aa).sub(J),c.copy(ba).sub(J);let ca=J.angleTo(b),da=b.angleTo(c),ea=Math.cos(ca)*e;0==RVa?K.copy(Y):K.copy(J).setLength(f+ea),W.push(ea);let fa=[K,aa,ba];for(let ga=0;ga<2;ga++){let ha=fa[ga],ia=fa[ga+1];M.subVectors(ha,J),N.subVectors(ia,J),L.crossVectors(M,N).normalize();for(let ja=0;ja<g;ja++){let ka=[ca,da][ga]*ja/g;b.copy(M).applyAxisAngle(L,ka).add(J),V.push(b.clone()),ga&&(i(b,J),$.push([0==ja?ha:b.clone(),h.clone()]))}ga&&(i(ia,J),$.push([ia,h.clone()]))}X.push($)}O.push(X);let la=2*g,ma=2;for(let na=0;na<a;na++){let oa=la*na,pa=la*((na+1)%a),qa=[V[oa]];for(let ra=1;ra<g;ra++){M=V[oa+ra],N=V[pa+ra],qa.push(M);for(let sa=1,ta=ra-ma+1;sa<=ta;sa++)b.lerpVectors(M,N,sa/(ta+1)),b.sub(J).setLength(W[na]).add(J),qa.push(b.clone());qa.push(N)}for(let ua=0;ua<g;ua++)qa.push(V[ua+g+oa]);qa.push(V[pa+g]);let va=B.map(a=>qa[a]);SVa.push(...va.map(a=>[a.x,a.y,a.z]).flat()),UVa.push(...va.map(a=>(i(a,J),[h.x,h.y,h.z])).flat())}}let wa=[];for(let xa=0;xa<l.length;xa++)for(let ya=0;ya<a;ya++){let za=l[xa][ya];if(za<m){let Aa=l[za].findIndex(a=>a%m==xa),Ba=O[xa][ya],Ca=O[za][Aa];for(let Da=0;Da<g;Da++){let Ea=Ba[Da],Fa=Ca[g-Da],Ga=Ba[Da+1],Ha=Ca[g-(Da+1)];[Ea,Fa,Ga,Ga,Fa,Ha].forEach(a=>{SVa.push(a[0].x,a[0].y,a[0].z),UVa.push(a[1].x,a[1].y,a[1].z)})}wa.push(Ba[0][0],Ca[g][0],Ba[g][0],Ca[0][0])}}for(;wa.length;){let Ia,Ja,Ka,La;[Ia,Ja]=wa.splice(0,2);let Ma=[Ia];for(;Ia!=Ja;)Ma.push(Ja),La=(Ka=wa.indexOf(Ja))%2,Ja=wa.splice(Ka-La,2)[1-La];h.subVectors(Ma[0],Ma[1]).cross(b.subVectors(Ma[0],Ma[2])).normalize();let Na=0>h.dot(Ma[0]);Na&&h.negate();for(let Oa=1;Oa<=Ma.length-2;Oa++)[Ma[Oa+ +Na],Ma[Oa+1- +Na],Ma[0]].forEach(a=>{SVa.push(a.x,a.y,a.z),UVa.push(h.x,h.y,h.z)})}})(),(function(){let a=new fm;for(let b=0;b<SVa.length;b+=3){a.x=SVa[b+0],a.y=SVa[b+1],a.z=SVa[b+2];let c=v(a)/2/Math.PI+.5,d=w(a)/Math.PI+.5;TVa.push(c,1-d)}let e=new fm,f=new fm,g=new fm,h=new fm,i=new Eb,j=new Eb,k=new Eb,l=(a,b,c,d)=>{d<0&&1===a.x&&(TVa[b]=a.x-1),0===c.x&&0===c.z&&(TVa[b]=d/2/Math.PI+.5)};for(let m=0,n=0;m<SVa.length;m+=9,n+=6){e.set(SVa[m+0],SVa[m+1],SVa[m+2]),f.set(SVa[m+3],SVa[m+4],SVa[m+5]),g.set(SVa[m+6],SVa[m+7],SVa[m+8]),i.set(TVa[n+0],TVa[n+1]),j.set(TVa[n+2],TVa[n+3]),k.set(TVa[n+4],TVa[n+5]),h.copy(e).add(f).add(g).divideScalar(3);let o=v(h);l(i,n+0,e,o),l(j,n+2,f,o),l(k,n+4,g,o)}for(let p=0;p<TVa.length;p+=6){let q=TVa[p+0],r=TVa[p+2],s=TVa[p+4],t=Math.max(q,r,s),u=Math.min(q,r,s);t>.9&&u<.1&&(q<.2&&(TVa[p+0]+=1),r<.2&&(TVa[p+2]+=1),s<.2&&(TVa[p+4]+=1))}function v(a){return Math.atan2(a.z,-a.x)}function w(a){return Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))}})(),this.setAttribute("position",new cE(SVa,3)),this.setAttribute("normal",new cE(UVa,3)),this.setAttribute("uv",new cE(TVa,2));return}static fromJSON(VVa){return new LVa(VVa.vertices,VVa.indices,VVa.radius,VVa.corner,VVa.cornerSides)}},WVa=class{static create(XVa){return this.build(this.normalizeInputs(XVa))}static normalizeInputs(YVa,ZVa){let $Va=Object.assign({},ZVa?.parameters??{width:100,detail:0,corner:0,cornerSides:4},YVa.parameters);return{parameters:Object.assign($Va,{width:Math.abs($Va.width),height:Math.abs($Va.height??$Va.width),depth:Math.abs($Va.depth??$Va.width)})}}static build(_Va){let{width:aWa,height:bWa,depth:cWa,detail:dWa,corner:eWa,cornerSides:fWa}=_Va.parameters,gWa=0===dWa&&0!==eWa?new hWa(.5*aWa,eWa,fWa):new d6(.5*aWa,dWa);return gWa.scale(1,bWa/aWa,cWa/aWa),Object.assign(gWa,{userData:{..._Va,type:"DodecahedronGeometry"}})}},hWa=class extends LVa{constructor(iWa=1,jWa=.2,kWa=4){let lWa=(1+Math.sqrt(5))/2,mWa=1/lWa,nWa=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-mWa,-lWa,0,-mWa,lWa,0,mWa,-lWa,0,mWa,lWa,-mWa,-lWa,0,-mWa,lWa,0,mWa,-lWa,0,mWa,lWa,0,-lWa,0,-mWa,lWa,0,-mWa,-lWa,0,mWa,lWa,0,mWa],oWa=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],pWa="DodecahedronGeometry";super(nWa,oWa,pWa,iWa,jWa,kWa),this.type=pWa}static fromJSON(qWa){return new hWa(qWa.radius,qWa.corner,qWa.cornerSides)}},rWa=class{constructor(sWa){this.position=new Eb,this.startPosition=new Eb,this.uuid=Db.generateUUID(),this.position=sWa.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(tWa){this.position.copy(this.startPosition).add(tWa)}copy(uWa){return this.position.copy(uWa.position),this.startPosition.copy(uWa.startPosition),this}clone(){return new rWa(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},vWa=class extends rWa{constructor(wWa){super(wWa.position),this.parent=wWa}copy(xWa){return super.copy(xWa),this}clone(){return new vWa(this.parent).copy(this)}},yWa=class extends rWa{constructor(zWa,AWa){super(AWa),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=zWa,this.controls.push(new vWa(this),new vWa(this))}static create(BWa,CWa){let DWa=new yWa(BWa,new Eb(...CWa.position));return DWa.controls[0].position.set(...CWa.controlPrevious.position),DWa.controls[1].position.set(...CWa.controlNext.position),DWa.roundness=CWa.roundness,DWa.areControlsDirectionsMirrored=CWa.areControlsDirectionsMirrored,DWa}getOppositeControl(EWa){let FWa=this.controls.indexOf(EWa);return 0===FWa?this.controls[1]:1===FWa?this.controls[0]:null}applyOffsetToControls(GWa,HWa=1){for(let IWa=0,JWa=this.controls.length;IWa<JWa;IWa++){let KWa=this.controls[IWa];this.position.distanceTo(KWa.position)<=HWa?KWa.position.copy(this.position):KWa.applyOffset(GWa)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(LWa){return super.copy(LWa),this.controls[0].copy(LWa.controls[0]),this.controls[1].copy(LWa.controls[1]),this.roundness=LWa.roundness,this.uuid=LWa.uuid,this}clone(){return new yWa(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){return[this.curveBefore?.getTangentAt(1),this.curveAfter?.getTangentAt(0)]}computeNormals(MWa=new Eb,NWa=new Eb){let[OWa,PWa]=this.computeTangents();return OWa&&PWa&&(WWa(OWa,MWa),WWa(PWa,NWa)),[MWa,NWa]}computeTangent(QWa=new Eb){let[RWa,SWa]=this.computeTangents();return RWa&&SWa&&QWa.copy(RWa).add(SWa).normalize(),QWa}computeNormal(TWa=new Eb){let[UWa,VWa]=this.computeNormals();return TWa.copy(UWa).add(VWa).normalize(),TWa}};function WWa(a,b=new Eb){let c=a.length();return b.set(-a.y/c,a.x/c)}var XWa=a=>a,YWa=new Eb,ZWa=new Eb,$Wa=new Eb,_Wa=new Eb,aXa=new Eb,bXa=new Eb,cXa=new fm,dXa=new fm;function eXa(a){let b=new Eb;b.addVectors(a.v0,YWa.subVectors(a.v1,a.v0).multiplyScalar(2/3));let c=new Eb;return c.addVectors(a.v2,ZWa.subVectors(a.v1,a.v2).multiplyScalar(2/3)),new K0(a.v0,b,c,a.v2)}function fXa(a,b,c=Number.EPSILON){return Math.abs(a-b)<c}function gXa(a,b,c=Number.EPSILON){return a.distanceTo(b)<c}function hXa(a,b,c=Number.EPSILON){return a.distanceTo(b)<c}function iXa(a,b,c){let d=Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)),e=Math.sqrt(Math.pow(b.x-c.x,2)+Math.pow(b.y-c.y,2)),f=Math.sqrt(Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2));return Math.acos((e*e+d*d-f*f)/(2*e*d))}function jXa(a,b,c){return pXa(a,b)&&pXa(b,c)&&kXa(a.position,b.position,c.position)}function kXa(a,b,c){return 0===YWa.copy(b).sub(a).cross(ZWa.copy(c).sub(a))}function lXa(a,b,c,d,e){let f=Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)),g=(a.y+b.y)/2,h=(a.x+b.x)/2,i=Math.sqrt(Math.pow(c,2)-Math.pow(f/2,2))*(a.y-b.y)/f,j=Math.sqrt(Math.pow(c,2)-Math.pow(f/2,2))*(b.x-a.x)/f;return d.set(h+i,g+j),e.set(h-i,g-j),[d,e]}function mXa(a,b,c){return a.distanceTo(c)<b.distanceTo(c)?b:a}function nXa(a,b,c,d,e,f){let g=b.x-a.x,h=b.y-a.y,i=c.x-a.x,j=c.y-a.y,k=Math.sqrt((g+i)*(g+i)+(h+j)*(h+j)),l;return iXa(b,a,c)>Math.PI&&(k*=-1),l=fXa(j,h)?(h+j)*(d/k-.5)*8/3/(g-i):(g+i)*(d/k-.5)*8/3/(j-h),e.set(b.x-l*h,b.y+l*g),f.set(c.x+l*j,c.y-l*i),[e,f]}function oXa(a,b){return a.position.equals(a.controls[1].position)&&b.position.equals(b.controls[0].position)}function pXa(a,b){return kXa(a.position,a.controls[1].position,b.position)&&kXa(a.position,b.controls[0].position,b.position)}function qXa(a,b=12,c=!1){let d=[];for(let e=0,f=a.length;e<f;e++){let g=a[e],h=0;if(c&& void 0!==g.roundedCurveCorner){let i=.5*rXa(g.roundedCurveCorner,b);e>0&&(d[e-1]+=i),h+=i}void 0!==g.curveAfter&&(h+=rXa(g.curveAfter,b)),d.push(h)}return a.length>0&&c&& void 0!==a[0].roundedCurveCorner&&(d[a.length-1]+=.5*rXa(a[0].roundedCurveCorner,b)),d}function rXa(a,b=12){return a&&a instanceof r_?2*b:a&&(a instanceof m1||a instanceof A1)?1:a&&a instanceof j2?b*a.points.length:b}var sXa=new Eb,tXa=new Eb,uXa=new Eb,vXa=new Eb,wXa=new Eb,xXa=new Eb,yXa=class extends j6{constructor(zXa=100,AXa=100){super(),this.points=[],this.shapeHoles=[],this.plane=new jL(new fm(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=Db.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=zXa,this._height=AXa}static createFromState(BXa,CXa,DXa){let EXa=new yXa;return EXa.isClosed=BXa.isClosed,EXa.points=BXa.points.map(a=>yWa.create(a.id,a.data)),"number"==typeof BXa.roundness&&(EXa.roundness=BXa.roundness),EXa.shapeHoles=BXa.shapeHoles.map(a=>yXa.createFromState(a)),void 0!==CXa&& void 0!==DXa&&EXa.applySize(CXa,DXa),EXa.update(),EXa}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(FXa){if(this._roundness!==FXa){this._roundness=FXa;for(let GXa=0,HXa=this.points.length;GXa<HXa;GXa++)this.points[GXa].roundness=FXa;this.needsUpdate=!0}}getPointsIndexesByIds(IXa){return IXa.map(a=>this.getPointIndexById(a)).filter(a=>a>=0)}getPointIndexById(JXa){let KXa=this.points.length,LXa=this.points.findIndex(a=>a.uuid===JXa);if(LXa<0){let MXa=KXa;for(let NXa=0,OXa=this.shapeHoles.length;NXa<OXa;NXa++){let PXa=this.shapeHoles[NXa],QXa=PXa.points.length,RXa=PXa.getPointIndexById(JXa);if(!(RXa<0))return RXa+MXa;MXa+=QXa}}return LXa}getLineIndexById(SXa){return this.getPointIndexById(SXa)}getBezierPoint(TXa){if(TXa<=this.points.length-1)return this.points[TXa];if(this.shapeHoles.length>0){let UXa=this.points.length;for(let VXa=0,WXa=this.shapeHoles.length;VXa<WXa;VXa++){let XXa=this.shapeHoles[VXa],YXa=TXa-UXa;if(YXa<=XXa.points.length-1)return XXa.points[YXa];UXa+=XXa.points.length}}throw new Error("This shape does not have a point for this index: "+TXa)}getBezierPointIndex(ZXa){let $Xa=this.points.indexOf(ZXa);if($Xa>=0)return $Xa;if($Xa=this.points.length,this.shapeHoles.length>0)for(let _Xa=0,aYa=this.shapeHoles.length;_Xa<aYa;_Xa++){let bYa=this.shapeHoles[_Xa],cYa=bYa.points.indexOf(ZXa);if(cYa>=0)return $Xa+cYa;$Xa+=bYa.points.length}return -1}getAllPoints(){let dYa=[].concat(...this.shapeHoles.map(a=>a.points));return[...this.points,...dYa]}applySize(eYa,fYa){0===eYa&&(eYa=.001),0===fYa&&(fYa=.001),this._width=eYa,this._height=fYa}applyScale(gYa,hYa){let iYa=sXa.set(gYa,hYa);for(let jYa=0,kYa=this.points.length;jYa<kYa;jYa++){let lYa=this.points[jYa];lYa.position.multiply(iYa),lYa.controls[0].position.multiply(iYa),lYa.controls[1].position.multiply(iYa)}for(let mYa=0,nYa=this.shapeHoles.length;mYa<nYa;mYa++)this.shapeHoles[mYa].applyScale(gYa,hYa);this._update()}createPoint(oYa,pYa=0,qYa=Db.generateUUID()){let rYa;rYa=oYa instanceof Eb?oYa:new Eb(oYa,pYa);let sYa=new yWa(qYa,rYa);return sYa.roundness=this.roundness,sYa}addPoint(tYa){this.points.push(tYa),this.needsUpdate=!0}addPointAt(uYa,vYa){this.points.splice(vYa,0,uYa),this.needsUpdate=!0}getPointByUuid(wYa){for(let xYa=0,yYa=this.points.length;xYa<yYa;xYa++){let zYa=this.points[xYa];if(zYa.uuid===wYa)return zYa}for(let AYa=0,BYa=this.shapeHoles.length;AYa<BYa;AYa++){let CYa=this.shapeHoles[AYa].getPointByUuid(wYa);if(CYa)return CYa}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(DYa){let EYa=this.points.indexOf(DYa);EYa>=0&&this.points.splice(EYa,1),this.needsUpdate=!0}removePointById(FYa){let GYa=this.points.find(a=>a.uuid===FYa);GYa&&this.removePoint(GYa)}update(){for(let HYa=0,IYa=this.shapeHoles.length;HYa<IYa;HYa++)this.shapeHoles[HYa].update();this._update()}extractShapePointsToBuffer(JYa,KYa=12,LYa=!1){this.subdivision=KYa,void 0===this.curveDivisions&&this.computeCurveDivisions(KYa);let MYa=LYa?this.roundedCurveDivisions:this.curveDivisions;return(function(a,b,c=12,d=!0){let e=dXa.set(0,0,0),f,g=0,h=[];for(let i=0;i<b.length;i++){let j=XWa(b[i]),k=YWa,l=rXa(j,c);h.push(l);for(let m=0;m<=l;m++)if(j instanceof K0||j instanceof L1||j instanceof m1){if(j.getPoint(m/l,k),e.set(k.x,k.y,0),void 0!==f&&hXa(f,e))continue;void 0===f&&(f=cXa),f.copy(e),a.setXYZ(g,e.x,e.y,e.z),g++}}d&&g>1&&!(a.getX(g-1)===a.getX(0)&&a.getY(g-1)===a.getY(0)&&a.getZ(g-1)===a.getZ(0))&&(a.setXYZ(g,a.getX(0),a.getY(0),a.getZ(0)),g++)})(JYa,LYa?this.roundedCurves:this.curves,KYa,this.autoClose),MYa.reduce((a,b)=>a+b,0)+1}computeCurveDivisions(NYa=12){return this.curveDivisions=qXa(this.points,NYa,!1),this.roundedCurveDivisions=qXa(this.points,NYa,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(OYa,PYa,QYa=12){return 2*(function(a,b,c,d=12,e=!0){let f=dXa.set(0,0,0),g=0,h=[];for(let i=0;i<b.length;i++){if(!1===c[i])continue;let j,k=XWa(b[i]),l=YWa,m=rXa(k,d);h.push(m);for(let n=0;n<=m;n++)if(k instanceof K0||k instanceof L1||k instanceof m1){if(k.getPoint(n/m,l),f.set(l.x,l.y,0),j?.equals(f))continue;void 0===j?j=cXa:(a.setXYZ(g,j.x,j.y,j.z),g++,a.setXYZ(g,f.x,f.y,f.z),g++),j.copy(f)}}return e&&g>1&&!(a.getX(g-1)===a.getX(0)&&a.getY(g-1)===a.getY(0)&&a.getZ(g-1)===a.getZ(0))&&(a.setXYZ(g,a.getX(0),a.getY(0),a.getZ(0)),g++),h})(OYa,this.curves,PYa,QYa,this.autoClose).reduce((a,b)=>a+b,0)}extractShapePointsToFlatArray(RYa,SYa=12){return this.subdivision=SYa,void 0===this.curveDivisions&&this.computeCurveDivisions(SYa),(function(a,b,c=12,d=!0){let e,f=0;for(let g=0;g<b.length;g++){let h=XWa(b[g]),i=rXa(h,c),j=YWa;for(let k=0;k<=i;k++)if(h instanceof K0||h instanceof L1||h instanceof m1){if(h.getPoint(k/i,j),void 0!==e&&gXa(e,j,1e-12))continue;void 0===e&&(e=ZWa),e.copy(j),a.push(j.x,j.y),f++}}return fXa(a[0],a[a.length-2],1e-12)&&fXa(a[1],a[a.length-1],1e-12)&&(a.pop(),a.pop()),d&&f>1&&!(fXa(a[f-1],a[1],1e-12)&&fXa(a[f-2],a[0],1e-12))&&(a.push(a[0],a[1]),f++),a})(RYa,this.roundedCurves,SYa,this.autoClose)}getCurveIndexFromVertexId(TYa,UYa=!1){let VYa=0;void 0===this.curveDivisions&&this.computeCurveDivisions(this.subdivision);let WYa=UYa?this.roundedCurveDivisions:this.curveDivisions,XYa=0;UYa&& void 0!==this.points[0].roundedCurveCorner&&(XYa=.5*rXa(this.points[0].roundedCurveCorner,this.subdivision));let YYa=TYa-XYa;YYa<0&&(YYa+=WYa.reduce((a,b)=>a+b,0));for(let ZYa=0,$Ya=WYa.length;ZYa<$Ya;ZYa++){let _Ya=WYa[ZYa];if(YYa<VYa+_Ya)return[ZYa,(YYa-VYa+1)/_Ya];VYa+=_Ya}return[0,1]}getCurveT(aZa,bZa,cZa){let dZa=this.points[aZa],eZa=this.points[aZa>=this.points.length-1?0:aZa+1],fZa=this.curveDivisions,gZa=fZa[aZa];if(oXa(dZa,eZa)){let hZa=dZa.position.distanceTo(eZa.position);return dZa.position.distanceTo(sXa.set(cZa.x,cZa.y))/hZa}let iZa=0;for(let jZa=0;jZa<aZa;jZa++)iZa+=fZa[jZa];return(bZa-iZa)/gZa}dispose(){}_applyCurveForPoint(kZa,lZa){oXa(lZa,kZa)?this.lineTo(kZa.position.x,kZa.position.y):this.bezierCurveTo(lZa.controls[1].position.x,lZa.controls[1].position.y,kZa.controls[0].position.x,kZa.controls[0].position.y,kZa.position.x,kZa.position.y);let mZa=this.curves[this.curves.length-1];kZa.curveBefore=mZa,lZa.curveAfter=mZa;let nZa=mZa.clone();kZa.roundedCurveBefore=nZa,lZa.roundedCurveAfter=nZa,kZa.roundedCurveCorner=void 0,this.roundedCurves.push(nZa)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let oZa=0,pZa=this.points.length;oZa<pZa;oZa++){let qZa=this.points[oZa];if(0===oZa)this.moveTo(qZa.position.x,qZa.position.y);else{let rZa=this.points[oZa-1];this._applyCurveForPoint(qZa,rZa)}}let sZa=this.getLastPoint();if(sZa?.curveAfter&&(sZa.curveAfter=void 0),this.isClosed){let tZa=this.points[0],uZa=this.points[this.points.length-1];this._applyCurveForPoint(tZa,uZa)}if(this.points.length>2){let vZa=0;for(let wZa=0,xZa=this.points.length;wZa<xZa;wZa++){let yZa=this.points[wZa],zZa=this.points[wZa-1]??this.points[this.points.length-1],AZa=this.points[wZa+1]??this.points[0],BZa=yZa.roundness,CZa=zZa&&AZa&&jXa(zZa,yZa,AZa);if(!yZa.controlsMoved()&&BZa>0&&!CZa){let DZa=yZa.curveBefore,EZa=yZa.curveAfter;if(void 0===DZa|| void 0===EZa)continue;let FZa=yZa.roundedCurveBefore,GZa=yZa.roundedCurveAfter,HZa=DZa.getLength(),IZa=EZa.getLength(),JZa=Math.min(BZa,.499*HZa),KZa=Math.min(BZa,.499*IZa),LZa=Math.min(JZa,KZa),MZa=1-LZa/HZa,NZa=LZa/IZa,OZa=DZa.getPointAt(MZa,sXa),PZa=EZa.getPointAt(NZa,tXa);this._subSplitCurve(DZa,FZa,MZa,OZa,void 0),this._subSplitCurve(EZa,GZa,NZa,void 0,PZa);let QZa;if(this.useCubicForRoundedCorners){let RZa=Math.tan(iXa(OZa,yZa.position,PZa)/2)*OZa.distanceTo(yZa.position),[SZa,TZa]=lXa(OZa,PZa,RZa,uXa,vXa),[UZa,VZa]=nXa(mXa(SZa,TZa,yZa.position),OZa,PZa,RZa,wXa,xXa);QZa=new K0(OZa.clone(),UZa.clone(),VZa.clone(),PZa.clone())}else QZa=new L1(OZa.clone(),yZa.position.clone(),PZa.clone());yZa.roundedCurveCorner=QZa,this.roundedCurves.splice(wZa+vZa,0,QZa),vZa++}}}}_subSplitCurve(WZa,XZa,YZa,ZZa,$Za){if(WZa instanceof m1)void 0!==ZZa&&XZa.v2.copy(ZZa),void 0!==$Za&&XZa.v1.copy($Za);else{let _Za=WZa,a$a=XZa,b$a=_Za.getUtoTmapping(YZa,0),c$a=function(a,b,c,d,e=.5){let f=YWa.subVectors(b,a).multiplyScalar(e).add(a),g=ZWa.subVectors(c,b).multiplyScalar(e).add(b),h=$Wa.subVectors(d,c).multiplyScalar(e).add(c),i=f,j=_Wa.subVectors(g,f).multiplyScalar(e).add(f),k=aXa.subVectors(h,g).multiplyScalar(e).add(g),l=h,m=bXa.subVectors(k,j).multiplyScalar(e).add(j);return[a.x,a.y,i.x,i.y,j.x,j.y,m.x,m.y,k.x,k.y,l.x,l.y,d.x,d.y]}(_Za.v0,_Za.v1,_Za.v2,_Za.v3,b$a);return void 0!==ZZa&&(a$a.v0.set(c$a[0],c$a[1]),a$a.v1.set(c$a[2],c$a[3]),a$a.v2.set(c$a[4],c$a[5]),a$a.v3.set(c$a[6],c$a[7])),void 0!==$Za&&(a$a.v0.set(c$a[6],c$a[7]),a$a.v1.set(c$a[8],c$a[9]),a$a.v2.set(c$a[10],c$a[11]),a$a.v3.set(c$a[12],c$a[13])),a$a}return XZa}clone(){let d$a=new yXa(this._width,this._height);return d$a.points=this.points.map(a=>a.clone()),d$a.isClosed=this.isClosed,d$a.roundness=this.roundness,d$a.isMesh2D=this.isMesh2D,d$a.shapeHoles=this.shapeHoles.map(a=>a.clone()),d$a}toJSON(){return{points:this.points.reduce((a,b)=>a.concat(b.toJSON()),[]),shapeHoles:this.shapeHoles.map(a=>a.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e$a){this.points=[],this.pointIDs=0;let f$a=e$a.points.length/7;for(let g$a=0;g$a<f$a;g$a++){let h$a=7*g$a,i$a=e$a.points[h$a+0],j$a=e$a.points[h$a+1],k$a=e$a.points[h$a+2],l$a=e$a.points[h$a+3],m$a=e$a.points[h$a+4],n$a=e$a.points[h$a+5],o$a=e$a.points[h$a+6],p$a=new yWa(Db.generateUUID(),new Eb(i$a,j$a));p$a.controls[0].position.set(k$a,l$a),p$a.controls[1].position.set(m$a,n$a),p$a.roundness=o$a,this.points.push(p$a)}return this.shapeHoles=e$a.shapeHoles?.length?e$a.shapeHoles.map(a=>{let b=new yXa;return b.fromJSON(a),b}):[],this.isClosed=e$a.isClosed,this._roundness=e$a.roundness,this._update(),this}fromShape(q$a,r$a=!1){this.isText=r$a;let s$a=(a,b)=>{b instanceof K0&&b.v3.equals(a.position)&&a.controls[0].position.copy(b.v2)},t$a=a=>{let b=[],c,d;for(c=0,d=a.length;c<d;c++)a[c]instanceof L1&&(a[c]=eXa(a[c]));for(c=0,d=a.length;c<d;c++){let e=a[c],f=c>0?a[c-1]:null,g;e instanceof K0?(g=this.createPoint(e.v0)).controls[1].position.copy(e.v1):e instanceof m1&&(g=this.createPoint(e.v1)),void 0!==g&&(null!==f&&s$a(g,f),b.push(g))}let h=a[a.length-1],i=!1;return h instanceof K0?h.v3.equals(b[0].position)&&(b[0].controls[0].position.copy(h.v2),i=!0):h instanceof m1&&h.v2.equals(b[0].position)&&(i=!0),this.isClosed=i,b};return this.points=t$a(q$a.curves),q$a instanceof j6&&(this.shapeHoles=q$a.holes.map(a=>{let b=new yXa;return b.fromShape(a),b})),this.update(),this}updatePoint(u$a,v$a){let w$a=this.getPointByUuid(u$a);w$a&&(void 0!==v$a.position&&w$a.position.fromArray(v$a.position),void 0!==v$a.roundness&&(w$a.roundness=v$a.roundness),void 0!==v$a.areControlsDirectionsMirrored&&(w$a.areControlsDirectionsMirrored=v$a.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(x$a,y$a){let z$a=this.getPointByUuid(x$a)?.controls[0];z$a&&(y$a.position&&z$a.position.fromArray(y$a.position),this.needsUpdate=!0)}updateNextControl(A$a,B$a){let C$a=this.getPointByUuid(A$a)?.controls[1];C$a&&(B$a.position&&C$a.position.fromArray(B$a.position),this.needsUpdate=!0)}},D$a=2*Math.PI;function E$a({x:a,y:b},c,d,e,f){return{x:a*c+e,y:b*d+f}}function F$a(a,b){let c=1.5707963267948966===b?.551915024494:-1.5707963267948966===b?-0.551915024494:1.3333333333333333*Math.tan(b/4),d=Math.cos(a),e=Math.sin(a),f=Math.cos(a+b),g=Math.sin(a+b);return[{x:d-e*c,y:e+d*c},{x:f+g*c,y:g-f*c},{x:f,y:g}]}function G$a(a,b,c,d){let e=a*d-b*c<0?-1:1,f=Math.min(1,Math.max(-1,a*c+b*d));return e*Math.acos(f)}function H$a(a,b){if(!a)throw b||"Assertion Failed!"}(Inb=Gsb||(Gsb={}))[Inb.ODD=0]="ODD",Inb[Inb.NONZERO=1]="NONZERO",Inb[Inb.POSITIVE=2]="POSITIVE",Inb[Inb.NEGATIVE=3]="NEGATIVE",Inb[Inb.ABS_GEQ_TWO=4]="ABS_GEQ_TWO",(Jnb=Hsb||(Hsb={}))[Jnb.POLYGONS=0]="POLYGONS",Jnb[Jnb.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",Jnb[Jnb.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS";var I$a=function(){function a(){}return a.vertEq=function(a,b){return a.s===b.s&&a.t===b.t},a.vertLeq=function(a,b){return a.s<b.s||a.s===b.s&&a.t<=b.t},a.transLeq=function(a,b){return a.t<b.t||a.t===b.t&&a.s<=b.s},a.edgeGoesLeft=function(b){return a.vertLeq(b.Dst,b.Org)},a.edgeGoesRight=function(b){return a.vertLeq(b.Org,b.Dst)},a.vertL1dist=function(a,b){return Math.abs(a.s-b.s)+Math.abs(a.t-b.t)},a.edgeEval=function(b,c,d){H$a(a.vertLeq(b,c)&&a.vertLeq(c,d));var e=c.s-b.s,f=d.s-c.s;return e+f>0?e<f?c.t-b.t+(b.t-d.t)*(e/(e+f)):c.t-d.t+(d.t-b.t)*(f/(e+f)):0},a.edgeSign=function(b,c,d){H$a(a.vertLeq(b,c)&&a.vertLeq(c,d));var e=c.s-b.s,f=d.s-c.s;return e+f>0?(c.t-d.t)*e+(c.t-b.t)*f:0},a.transEval=function(b,c,d){H$a(a.transLeq(b,c)&&a.transLeq(c,d));var e=c.t-b.t,f=d.t-c.t;return e+f>0?e<f?c.s-b.s+(b.s-d.s)*(e/(e+f)):c.s-d.s+(d.s-b.s)*(f/(e+f)):0},a.transSign=function(b,c,d){H$a(a.transLeq(b,c)&&a.transLeq(c,d));var e=c.t-b.t,f=d.t-c.t;return e+f>0?(c.s-d.s)*e+(c.s-b.s)*f:0},a.vertCCW=function(a,b,c){return a.s*(b.t-c.t)+b.s*(c.t-a.t)+c.s*(a.t-b.t)>=0},a.interpolate=function(a,b,c,d){return(a=a<0?0:a)<=(c=c<0?0:c)?0===c?(b+d)/2:b+(d-b)*(a/(a+c)):d+(b-d)*(c/(a+c))},a.intersect=function(b,c,d,e,f){var g,h,i;a.vertLeq(b,c)||(i=b,b=c,c=i),a.vertLeq(d,e)||(i=d,d=e,e=i),a.vertLeq(b,d)||(i=b,b=d,d=i,i=c,c=e,e=i),a.vertLeq(d,c)?a.vertLeq(c,e)?(g=a.edgeEval(b,d,c),h=a.edgeEval(d,c,e),g+h<0&&(g=-g,h=-h),f.s=a.interpolate(g,d.s,h,c.s)):(g=a.edgeSign(b,d,c),h=-a.edgeSign(b,e,c),g+h<0&&(g=-g,h=-h),f.s=a.interpolate(g,d.s,h,e.s)):f.s=(d.s+c.s)/2,a.transLeq(b,c)||(i=b,b=c,c=i),a.transLeq(d,e)||(i=d,d=e,e=i),a.transLeq(b,d)||(i=b,b=d,d=i,i=c,c=e,e=i),a.transLeq(d,c)?a.transLeq(c,e)?(g=a.transEval(b,d,c),h=a.transEval(d,c,e),g+h<0&&(g=-g,h=-h),f.t=a.interpolate(g,d.t,h,c.t)):(g=a.transSign(b,d,c),h=-a.transSign(b,e,c),g+h<0&&(g=-g,h=-h),f.t=a.interpolate(g,d.t,h,e.t)):f.t=(d.t+c.t)/2},a}(),J$a=function(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1},K$a=function(){function a(a){this.side=a,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(a.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(a){this.Sym.Lface=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(a){this.Sym.Org=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(a){this.Sym.Lnext=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(a){this.Onext.Sym=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(a){this.Lnext.Sym=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(a){this.Sym.Onext=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(a){this.Sym.Onext.Sym=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(a){this.Sym.Lnext.Sym=a},enumerable:!0,configurable:!0}),a}(),L$a=function(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0},M$a=function(){function a(){var a=new L$a,b=new J$a,c=new K$a(0),d=new K$a(1);a.next=a.prev=a,a.anEdge=null,b.next=b.prev=b,c.next=c,c.Sym=d,d.next=d,d.Sym=c,this.vHead=a,this.fHead=b,this.eHead=c,this.eHeadSym=d}return a.prototype.makeEdge_=function(a){var b=new K$a(0),c=new K$a(1);a.Sym.side<a.side&&(a=a.Sym);var d=a.Sym.next;return c.next=d,d.Sym.next=b,b.next=a,a.Sym.next=c,b.Sym=c,b.Onext=b,b.Lnext=c,b.Org=null,b.Lface=null,b.winding=0,b.activeRegion=null,c.Sym=b,c.Onext=c,c.Lnext=b,c.Org=null,c.Lface=null,c.winding=0,c.activeRegion=null,b},a.prototype.splice_=function(a,b){var c=a.Onext,d=b.Onext;c.Sym.Lnext=b,d.Sym.Lnext=a,a.Onext=d,b.Onext=c},a.prototype.makeVertex_=function(a,b,c){var d=a;H$a(d,"Vertex can't be null!");var e=c.prev;d.prev=e,e.next=d,d.next=c,c.prev=d,d.anEdge=b;var f=b;do f.Org=d,f=f.Onext;while(f!==b)},a.prototype.makeFace_=function(a,b,c){var d=a;H$a(d,"Face can't be null");var e=c.prev;d.prev=e,e.next=d,d.next=c,c.prev=d,d.anEdge=b,d.trail=null,d.marked=!1,d.inside=c.inside;var f=b;do f.Lface=d,f=f.Lnext;while(f!==b)},a.prototype.killEdge_=function(a){a.Sym.side<a.side&&(a=a.Sym);var b=a.next,c=a.Sym.next;b.Sym.next=c,c.Sym.next=b},a.prototype.killVertex_=function(a,b){var c=a.anEdge,d=c;do d.Org=b,d=d.Onext;while(d!==c);var e=a.prev,f=a.next;f.prev=e,e.next=f},a.prototype.killFace_=function(a,b){var c=a.anEdge,d=c;do d.Lface=b,d=d.Lnext;while(d!==c);var e=a.prev,f=a.next;f.prev=e,e.next=f},a.prototype.makeEdge=function(){var a=new L$a,b=new L$a,c=new J$a,d=this.makeEdge_(this.eHead);return this.makeVertex_(a,d,this.vHead),this.makeVertex_(b,d.Sym,this.vHead),this.makeFace_(c,d,this.fHead),d},a.prototype.splice=function(a,b){var c=!1,d=!1;if(a!==b){if(b.Org!==a.Org&&(d=!0,this.killVertex_(b.Org,a.Org)),b.Lface!==a.Lface&&(c=!0,this.killFace_(b.Lface,a.Lface)),this.splice_(b,a),!d){var e=new L$a;this.makeVertex_(e,b,a.Org),a.Org.anEdge=a}if(!c){var f=new J$a;this.makeFace_(f,b,a.Lface),a.Lface.anEdge=a}}},a.prototype.delete=function(a){var b=a.Sym,c=!1;if(a.Lface!==a.Rface&&(c=!0,this.killFace_(a.Lface,a.Rface)),a.Onext===a)this.killVertex_(a.Org,null);else if(a.Rface.anEdge=a.Oprev,a.Org.anEdge=a.Onext,this.splice_(a,a.Oprev),!c){var d=new J$a;this.makeFace_(d,a,a.Lface)}b.Onext===b?(this.killVertex_(b.Org,null),this.killFace_(b.Lface,null)):(a.Lface.anEdge=b.Oprev,b.Org.anEdge=b.Onext,this.splice_(b,b.Oprev)),this.killEdge_(a)},a.prototype.addEdgeVertex=function(a){var b=this.makeEdge_(a),c=b.Sym;this.splice_(b,a.Lnext),b.Org=a.Dst;var d=new L$a;return this.makeVertex_(d,c,b.Org),b.Lface=c.Lface=a.Lface,b},a.prototype.splitEdge=function(a){var b=this.addEdgeVertex(a).Sym;return this.splice_(a.Sym,a.Sym.Oprev),this.splice_(a.Sym,b),a.Dst=b.Org,b.Dst.anEdge=b.Sym,b.Rface=a.Rface,b.winding=a.winding,b.Sym.winding=a.Sym.winding,b.idx=a.idx,b.Sym.idx=a.Sym.idx,b},a.prototype.connect=function(a,b){var c=!1,d=this.makeEdge_(a),e=d.Sym;if(b.Lface!==a.Lface&&(c=!0,this.killFace_(b.Lface,a.Lface)),this.splice_(d,a.Lnext),this.splice_(e,b),d.Org=a.Dst,e.Org=b.Org,d.Lface=e.Lface=a.Lface,a.Lface.anEdge=e,!c){var f=new J$a;this.makeFace_(f,d,a.Lface)}return d},a.prototype.zapFace=function(a){var b,c,d,e,f,g=a.anEdge;c=g.Lnext;do c=(b=c).Lnext,b.Lface=null,null===b.Rface&&(b.Onext===b?this.killVertex_(b.Org,null):(b.Org.anEdge=b.Onext,this.splice_(b,b.Oprev)),(d=b.Sym).Onext===d?this.killVertex_(d.Org,null):(d.Org.anEdge=d.Onext,this.splice_(d,d.Oprev)),this.killEdge_(b));while(b!=g);e=a.prev,f=a.next,f.prev=e,e.next=f},a.prototype.countFaceVerts_=function(a){var b=a.anEdge,c=0;do c++,b=b.Lnext;while(b!==a.anEdge);return c},a.prototype.mergeConvexFaces=function(a){var b,c,d,e,f;for(b=this.fHead.next;b!==this.fHead;b=b.next)if(b.inside)for(f=(c=b.anEdge).Org;d=c.Lnext,e=c.Sym,e&&e.Lface&&e.Lface.inside&&this.countFaceVerts_(b)+this.countFaceVerts_(e.Lface)-2<=a&&I$a.vertCCW(c.Lprev.Org,c.Org,e.Lnext.Lnext.Org)&&I$a.vertCCW(e.Lprev.Org,e.Org,c.Lnext.Lnext.Org)&&(d=e.Lnext,this.delete(e),c=null,e=null),!(c&&c.Lnext.Org===f);)c=d;return!0},a.prototype.check=function(){var a,b,c,d,e,f,g=this.fHead,h=this.vHead,i=this.eHead;for(b=g,b=g;(a=b.next)!==g;b=a){H$a(a.prev===b),e=a.anEdge;do H$a(e.Sym!==e),H$a(e.Sym.Sym===e),H$a(e.Lnext.Onext.Sym===e),H$a(e.Onext.Sym.Lnext===e),H$a(e.Lface===a),e=e.Lnext;while(e!==a.anEdge)}for(H$a(a.prev===b&&null===a.anEdge),d=h,d=h;(c=d.next)!==h;d=c){H$a(c.prev===d),e=c.anEdge;do H$a(e.Sym!==e),H$a(e.Sym.Sym===e),H$a(e.Lnext.Onext.Sym===e),H$a(e.Onext.Sym.Lnext===e),H$a(e.Org===c),e=e.Onext;while(e!==c.anEdge)}for(H$a(c.prev===d&&null===c.anEdge),f=i,f=i;(e=f.next)!==i;f=e)H$a(e.Sym.next===f.Sym),H$a(e.Sym!==e),H$a(e.Sym.Sym===e),H$a(null!==e.Org),H$a(null!==e.Dst),H$a(e.Lnext.Onext.Sym===e),H$a(e.Onext.Sym.Lnext===e);H$a(e.Sym.next===f.Sym&&e.Sym===this.eHeadSym&&e.Sym.Sym===e&&null===e.Org&&null===e.Dst&&null===e.Lface&&null===e.Rface)},a}(),N$a=function(){this.handle=null},O$a=function(){this.key=null,this.node=0},P$a=function(){function a(a,b){this.leq=b,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=a,this.nodes=[],this.handles=[];for(var c=0;c<a+1;c++)this.nodes[c]=new N$a,this.handles[c]=new O$a;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return a.prototype.floatDown_=function(a){var b,c,d,e=this.nodes,f=this.handles;for(b=e[a].handle;;){if((d=a<<1)<this.size&&this.leq(f[e[d+1].handle].key,f[e[d].handle].key)&& ++d,H$a(d<=this.max),c=e[d].handle,d>this.size||this.leq(f[b].key,f[c].key)){e[a].handle=b,f[b].node=a;break}e[a].handle=c,f[c].node=a,a=d}},a.prototype.floatUp_=function(a){var b,c,d,e=this.nodes,f=this.handles;for(b=e[a].handle;;){if(c=e[d=a>>1].handle,0===d||this.leq(f[c].key,f[b].key)){e[a].handle=b,f[b].node=a;break}e[a].handle=c,f[c].node=a,a=d}},a.prototype.init=function(){for(var a=this.size;a>=1;--a)this.floatDown_(a);this.initialized=!0},a.prototype.min=function(){return this.handles[this.nodes[1].handle].key},a.prototype.insert=function(a){var b,c,d,e;if(2*(b=++this.size)>this.max){for(this.max*=2,e=this.nodes.length,this.nodes.length=this.max+1,d=e;d<this.nodes.length;d++)this.nodes[d]=new N$a;for(e=this.handles.length,this.handles.length=this.max+1,d=e;d<this.handles.length;d++)this.handles[d]=new O$a}return 0===this.freeList?c=b:(c=this.freeList,this.freeList=this.handles[c].node),this.nodes[b].handle=c,this.handles[c].node=b,this.handles[c].key=a,this.initialized&&this.floatUp_(b),c},a.prototype.extractMin=function(){var a=this.nodes,b=this.handles,c=a[1].handle,d=b[c].key;return this.size>0&&(a[1].handle=a[this.size].handle,b[a[1].handle].node=1,b[c].key=null,b[c].node=this.freeList,this.freeList=c,--this.size,this.size>0&&this.floatDown_(1)),d},a.prototype.delete=function(a){var b,c=this.nodes,d=this.handles;H$a(a>=1&&a<=this.max&&null!==d[a].key),c[b=d[a].node].handle=c[this.size].handle,d[c[b].handle].node=b,--this.size,b<=this.size&&(b<=1||this.leq(d[c[b>>1].handle].key,d[c[b].handle].key)?this.floatDown_(b):this.floatUp_(b)),d[a].key=null,d[a].node=this.freeList,this.freeList=a},a}(),Q$a=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},R$a=function(){this.key=null,this.next=null,this.prev=null},S$a=function(){function a(a,b){this.frame=a,this.leq=b,this.head=new R$a,this.head.next=this.head,this.head.prev=this.head}return a.prototype.min=function(){return this.head.next},a.prototype.max=function(){return this.head.prev},a.prototype.insert=function(a){return this.insertBefore(this.head,a)},a.prototype.search=function(a){var b=this.head;do b=b.next;while(null!==b.key&&!this.leq(this.frame,a,b.key));return b},a.prototype.insertBefore=function(a,b){do a=a.prev;while(null!==a.key&&!this.leq(this.frame,a.key,b));var c=new R$a;return c.key=b,c.next=a.next,a.next.prev=c,c.prev=a,a.next=c,c},a.prototype.delete=function(a){a.next.prev=a.prev,a.prev.next=a.next},a}(),T$a=function(){function a(){}return a.regionBelow=function(a){return a.nodeUp.prev.key},a.regionAbove=function(a){return a.nodeUp.next.key},a.debugEvent=function(a){},a.addWinding=function(a,b){a.winding+=b.winding,a.Sym.winding+=b.Sym.winding},a.edgeLeq=function(a,b,c){var d=a.event,e=b.eUp,f=c.eUp;if(e.Dst===d)return f.Dst===d?I$a.vertLeq(e.Org,f.Org)?0>=I$a.edgeSign(f.Dst,e.Org,f.Org):I$a.edgeSign(e.Dst,f.Org,e.Org)>=0:0>=I$a.edgeSign(f.Dst,d,f.Org);if(f.Dst===d)return I$a.edgeSign(e.Dst,d,e.Org)>=0;var g=I$a.edgeEval(e.Dst,d,e.Org),h=I$a.edgeEval(f.Dst,d,f.Org);return g>=h},a.deleteRegion=function(a,b){b.fixUpperEdge&&H$a(0===b.eUp.winding),b.eUp.activeRegion=null,a.dict.delete(b.nodeUp)},a.fixUpperEdge=function(a,b,c){H$a(b.fixUpperEdge),a.mesh.delete(b.eUp),b.fixUpperEdge=!1,b.eUp=c,c.activeRegion=b},a.topLeftRegion=function(b,c){var d,e=c.eUp.Org;do c=a.regionAbove(c);while(c.eUp.Org===e);if(c.fixUpperEdge){if(null===(d=b.mesh.connect(a.regionBelow(c).eUp.Sym,c.eUp.Lnext)))return null;a.fixUpperEdge(b,c,d),c=a.regionAbove(c)}return c},a.topRightRegion=function(b){var c=b.eUp.Dst;do b=a.regionAbove(b);while(b.eUp.Dst===c);return b},a.addRegionBelow=function(a,b,c){var d=new Q$a;return d.eUp=c,d.nodeUp=a.dict.insertBefore(b.nodeUp,d),d.fixUpperEdge=!1,d.sentinel=!1,d.dirty=!1,c.activeRegion=d,d},a.isWindingInside=function(a,b){switch(a.windingRule){case Gsb.ODD:return(1&b)!=0;case Gsb.NONZERO:return 0!==b;case Gsb.POSITIVE:return b>0;case Gsb.NEGATIVE:return b<0;case Gsb.ABS_GEQ_TWO:return b>=2||b<= -2}throw new Error("Invalid winding rulle")},a.computeWinding=function(b,c){c.windingNumber=a.regionAbove(c).windingNumber+c.eUp.winding,c.inside=a.isWindingInside(b,c.windingNumber)},a.finishRegion=function(b,c){var d=c.eUp,e=d.Lface;e.inside=c.inside,e.anEdge=d,a.deleteRegion(b,c)},a.finishLeftRegions=function(b,c,d){for(var e,f=null,g=c,h=c.eUp;g!==d;){if(g.fixUpperEdge=!1,(e=(f=a.regionBelow(g)).eUp).Org!=h.Org){if(!f.fixUpperEdge){a.finishRegion(b,g);break}e=b.mesh.connect(h.Lprev,e.Sym),a.fixUpperEdge(b,f,e)}h.Onext!==e&&(b.mesh.splice(e.Oprev,e),b.mesh.splice(h,e)),a.finishRegion(b,g),h=f.eUp,g=f}return h},a.addRightEdges=function(b,c,d,e,f,g){var h,i,j,k,l=!0;j=d;do H$a(I$a.vertLeq(j.Org,j.Dst)),a.addRegionBelow(b,c,j.Sym),j=j.Onext;while(j!==e);for(null===f&&(f=a.regionBelow(c).eUp.Rprev),i=c,k=f;(j=(h=a.regionBelow(i)).eUp.Sym).Org===k.Org;)j.Onext!==k&&(b.mesh.splice(j.Oprev,j),b.mesh.splice(k.Oprev,j)),h.windingNumber=i.windingNumber-j.winding,h.inside=a.isWindingInside(b,h.windingNumber),i.dirty=!0,!l&&a.checkForRightSplice(b,i)&&(a.addWinding(j,k),a.deleteRegion(b,i),b.mesh.delete(k)),l=!1,i=h,k=j;i.dirty=!0,H$a(i.windingNumber-j.winding===h.windingNumber),g&&a.walkDirtyRegions(b,i)},a.spliceMergeVertices=function(a,b,c){a.mesh.splice(b,c)},a.vertexWeights=function(a,b,c){var d=I$a.vertL1dist(b,a),e=I$a.vertL1dist(c,a),f=.5*e/(d+e),g=.5*d/(d+e);a.coords[0]+=f*b.coords[0]+g*c.coords[0],a.coords[1]+=f*b.coords[1]+g*c.coords[1],a.coords[2]+=f*b.coords[2]+g*c.coords[2]},a.getIntersectData=function(b,c,d,e,f,g){c.coords[0]=c.coords[1]=c.coords[2]=0,c.idx=-1,a.vertexWeights(c,d,e),a.vertexWeights(c,f,g)},a.checkForRightSplice=function(b,c){var d=a.regionBelow(c),e=c.eUp,f=d.eUp;if(I$a.vertLeq(e.Org,f.Org)){if(I$a.edgeSign(f.Dst,e.Org,f.Org)>0)return!1;I$a.vertEq(e.Org,f.Org)?e.Org!==f.Org&&(b.pq.delete(e.Org.pqHandle),a.spliceMergeVertices(b,f.Oprev,e)):(b.mesh.splitEdge(f.Sym),b.mesh.splice(e,f.Oprev),c.dirty=d.dirty=!0)}else{if(0>I$a.edgeSign(e.Dst,f.Org,e.Org))return!1;a.regionAbove(c).dirty=c.dirty=!0,b.mesh.splitEdge(e.Sym),b.mesh.splice(f.Oprev,e)}return!0},a.checkForLeftSplice=function(b,c){var d,e=a.regionBelow(c),f=c.eUp,g=e.eUp;if(H$a(!I$a.vertEq(f.Dst,g.Dst)),I$a.vertLeq(f.Dst,g.Dst)){if(0>I$a.edgeSign(f.Dst,g.Dst,f.Org))return!1;a.regionAbove(c).dirty=c.dirty=!0,d=b.mesh.splitEdge(f),b.mesh.splice(g.Sym,d),d.Lface.inside=c.inside}else{if(I$a.edgeSign(g.Dst,f.Dst,g.Org)>0)return!1;c.dirty=e.dirty=!0,d=b.mesh.splitEdge(g),b.mesh.splice(f.Lnext,g.Sym),d.Rface.inside=c.inside}return!0},a.checkForIntersect=function(b,c){var d,e,f,g,h=a.regionBelow(c),i=c.eUp,j=h.eUp,k=i.Org,l=j.Org,m=i.Dst,n=j.Dst,o=new L$a;if(H$a(!I$a.vertEq(n,m)),H$a(0>=I$a.edgeSign(m,b.event,k)),H$a(I$a.edgeSign(n,b.event,l)>=0),H$a(k!==b.event&&l!==b.event),H$a(!c.fixUpperEdge&&!h.fixUpperEdge),k===l||(d=Math.min(k.t,m.t),e=Math.max(l.t,n.t),d>e))return!1;if(I$a.vertLeq(k,l)){if(I$a.edgeSign(n,k,l)>0)return!1}else if(0>I$a.edgeSign(m,l,k))return!1;return a.debugEvent(b),I$a.intersect(m,k,n,l,o),H$a(Math.min(k.t,m.t)<=o.t),H$a(o.t<=Math.max(l.t,n.t)),H$a(Math.min(n.s,m.s)<=o.s),H$a(o.s<=Math.max(l.s,k.s)),I$a.vertLeq(o,b.event)&&(o.s=b.event.s,o.t=b.event.t),f=I$a.vertLeq(k,l)?k:l,I$a.vertLeq(f,o)&&(o.s=f.s,o.t=f.t),I$a.vertEq(o,k)||I$a.vertEq(o,l)?(a.checkForRightSplice(b,c),!1):!I$a.vertEq(m,b.event)&&I$a.edgeSign(m,b.event,o)>=0|| !I$a.vertEq(n,b.event)&&0>=I$a.edgeSign(n,b.event,o)?n===b.event?(b.mesh.splitEdge(i.Sym),b.mesh.splice(j.Sym,i),c=a.topLeftRegion(b,c),i=a.regionBelow(c).eUp,a.finishLeftRegions(b,a.regionBelow(c),h),a.addRightEdges(b,c,i.Oprev,i,i,!0),!0):m===b.event?(b.mesh.splitEdge(j.Sym),b.mesh.splice(i.Lnext,j.Oprev),h=c,c=a.topRightRegion(c),g=a.regionBelow(c).eUp.Rprev,h.eUp=j.Oprev,j=a.finishLeftRegions(b,h,null),a.addRightEdges(b,c,j.Onext,i.Rprev,g,!0),!0):(I$a.edgeSign(m,b.event,o)>=0&&(a.regionAbove(c).dirty=c.dirty=!0,b.mesh.splitEdge(i.Sym),i.Org.s=b.event.s,i.Org.t=b.event.t),0>=I$a.edgeSign(n,b.event,o)&&(c.dirty=h.dirty=!0,b.mesh.splitEdge(j.Sym),j.Org.s=b.event.s,j.Org.t=b.event.t),!1):(b.mesh.splitEdge(i.Sym),b.mesh.splitEdge(j.Sym),b.mesh.splice(j.Oprev,i),i.Org.s=o.s,i.Org.t=o.t,i.Org.pqHandle=b.pq.insert(i.Org),a.getIntersectData(b,i.Org,k,m,l,n),a.regionAbove(c).dirty=c.dirty=h.dirty=!0,!1)},a.walkDirtyRegions=function(b,c){for(var d,e,f=a.regionBelow(c);;){for(;f.dirty;)c=f,f=a.regionBelow(f);if(!c.dirty&&(f=c,null===(c=a.regionAbove(c))||!c.dirty))return;if(c.dirty=!1,d=c.eUp,e=f.eUp,d.Dst!==e.Dst&&a.checkForLeftSplice(b,c)&&(f.fixUpperEdge?(a.deleteRegion(b,f),b.mesh.delete(e),e=(f=a.regionBelow(c)).eUp):c.fixUpperEdge&&(a.deleteRegion(b,c),b.mesh.delete(d),d=(c=a.regionAbove(f)).eUp)),d.Org!==e.Org){if(d.Dst===e.Dst||c.fixUpperEdge||f.fixUpperEdge||d.Dst!==b.event&&e.Dst!==b.event)a.checkForRightSplice(b,c);else if(a.checkForIntersect(b,c))return}d.Org===e.Org&&d.Dst===e.Dst&&(a.addWinding(e,d),a.deleteRegion(b,c),b.mesh.delete(d),c=a.regionAbove(f))}},a.connectRightVertex=function(b,c,d){var e,f=d.Onext,g=a.regionBelow(c),h=c.eUp,i=g.eUp,j=!1;if(h.Dst!==i.Dst&&a.checkForIntersect(b,c),I$a.vertEq(h.Org,b.event)&&(b.mesh.splice(f.Oprev,h),c=a.topLeftRegion(b,c),f=a.regionBelow(c).eUp,a.finishLeftRegions(b,a.regionBelow(c),g),j=!0),I$a.vertEq(i.Org,b.event)&&(b.mesh.splice(d,i.Oprev),d=a.finishLeftRegions(b,g,null),j=!0),j){a.addRightEdges(b,c,d.Onext,f,f,!0);return}e=I$a.vertLeq(i.Org,h.Org)?i.Oprev:h,e=b.mesh.connect(d.Lprev,e),a.addRightEdges(b,c,e,e.Onext,e.Onext,!1),e.Sym.activeRegion.fixUpperEdge=!0,a.walkDirtyRegions(b,c)},a.connectLeftDegenerate=function(b,c,d){var e,f,g,h,i;if(e=c.eUp,I$a.vertEq(e.Org,d)){H$a(!1),a.spliceMergeVertices(b,e,d.anEdge);return}if(!I$a.vertEq(e.Dst,d)){b.mesh.splitEdge(e.Sym),c.fixUpperEdge&&(b.mesh.delete(e.Onext),c.fixUpperEdge=!1),b.mesh.splice(d.anEdge,e),a.sweepEvent(b,d);return}H$a(!1),c=a.topRightRegion(c),i=a.regionBelow(c),g=i.eUp.Sym,f=h=g.Onext,i.fixUpperEdge&&(H$a(f!==g),a.deleteRegion(b,i),b.mesh.delete(g),g=f.Oprev),b.mesh.splice(d.anEdge,g),I$a.edgeGoesLeft(f)||(f=null),a.addRightEdges(b,c,g.Onext,h,f,!0)},a.connectLeftVertex=function(b,c){var d,e,f,g,h,i,j=new Q$a;if(j.eUp=c.anEdge.Sym,d=b.dict.search(j).key,e=a.regionBelow(d)){if(g=d.eUp,h=e.eUp,0===I$a.edgeSign(g.Dst,c,g.Org)){a.connectLeftDegenerate(b,d,c);return}(f=I$a.vertLeq(h.Dst,g.Dst)?d:e,d.inside||f.fixUpperEdge)?(i=f===d?b.mesh.connect(c.anEdge.Sym,g.Lnext):b.mesh.connect(h.Dnext,c.anEdge).Sym,f.fixUpperEdge?a.fixUpperEdge(b,f,i):a.computeWinding(b,a.addRegionBelow(b,d,i)),a.sweepEvent(b,c)):a.addRightEdges(b,d,c.anEdge,c.anEdge,null,!0)}},a.sweepEvent=function(b,c){b.event=c,a.debugEvent(b);for(var d=c.anEdge;null===d.activeRegion;)if((d=d.Onext)===c.anEdge){a.connectLeftVertex(b,c);return}var e=a.topLeftRegion(b,d.activeRegion);H$a(null!==e);var f=a.regionBelow(e),g=f.eUp,h=a.finishLeftRegions(b,f,null);h.Onext===g?a.connectRightVertex(b,e,h):a.addRightEdges(b,e,h.Onext,g,g,!0)},a.addSentinel=function(a,b,c,d){var e=new Q$a,f=a.mesh.makeEdge();f.Org.s=c,f.Org.t=d,f.Dst.s=b,f.Dst.t=d,a.event=f.Dst,e.eUp=f,e.windingNumber=0,e.inside=!1,e.fixUpperEdge=!1,e.sentinel=!0,e.dirty=!1,e.nodeUp=a.dict.insert(e)},a.initEdgeDict=function(b){b.dict=new S$a(b,a.edgeLeq);var c=b.bmax[0]-b.bmin[0],d=b.bmax[1]-b.bmin[1],e=b.bmin[0]-c,f=b.bmax[0]+c,g=b.bmin[1]-d,h=b.bmax[1]+d;a.addSentinel(b,e,f,g),a.addSentinel(b,e,f,h)},a.doneEdgeDict=function(b){for(var c,d=0;null!==(c=b.dict.min().key);)c.sentinel||(H$a(c.fixUpperEdge),H$a(1== ++d)),H$a(0===c.windingNumber),a.deleteRegion(b,c)},a.removeDegenerateEdges=function(b){var c,d,e,f=b.mesh.eHead;for(c=f.next;c!==f;c=d)d=c.next,e=c.Lnext,I$a.vertEq(c.Org,c.Dst)&&c.Lnext.Lnext!==c&&(a.spliceMergeVertices(b,e,c),b.mesh.delete(c),e=(c=e).Lnext),e.Lnext===c&&(e!==c&&((e===d||e===d.Sym)&&(d=d.next),b.mesh.delete(e)),(c===d||c===d.Sym)&&(d=d.next),b.mesh.delete(c))},a.initPriorityQ=function(a){var b,c,d,e=0;for(c=(d=a.mesh.vHead).next;c!==d;c=c.next)e++;for(e+=8,b=a.pq=new P$a(e,I$a.vertLeq),d=a.mesh.vHead,c=d.next;c!==d;c=c.next)c.pqHandle=b.insert(c);return c===d&&(b.init(),!0)},a.donePriorityQ=function(a){a.pq=null},a.removeDegenerateFaces=function(b,c){var d,e,f;for(d=c.fHead.next;d!==c.fHead;d=e)e=d.next,f=d.anEdge,H$a(f.Lnext!==f),f.Lnext.Lnext===f&&(a.addWinding(f.Onext,f),b.mesh.delete(f));return!0},a.computeInterior=function(b,c){var d,e;if(void 0===c&&(c=!0),a.removeDegenerateEdges(b),!a.initPriorityQ(b))return!1;for(a.initEdgeDict(b);null!==(d=b.pq.extractMin());){for(;!(null===(e=b.pq.min())||!I$a.vertEq(e,d));)e=b.pq.extractMin(),a.spliceMergeVertices(b,d.anEdge,e.anEdge);a.sweepEvent(b,d)}return b.event=b.dict.min().key.eUp.Org,a.debugEvent(b),a.doneEdgeDict(b),a.donePriorityQ(b),!!a.removeDegenerateFaces(b,b.mesh)&&(c&&b.mesh.check(),!0)},a}(),U$a=function(){function a(){this.mesh=new M$a,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=Gsb.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return a.prototype.dot_=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},a.prototype.normalize_=function(a){var b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];if(!b)throw"Zero-size vector!";b=Math.sqrt(b),a[0]/=b,a[1]/=b,a[2]/=b},a.prototype.longAxis_=function(a){var b=0;return Math.abs(a[1])>Math.abs(a[0])&&(b=1),Math.abs(a[2])>Math.abs(a[b])&&(b=2),b},a.prototype.computeNormal_=function(a){var b,c,d,e,f,g,h=[0,0,0],i=[0,0,0],j=[0,0,0],k=[0,0,0],l=[0,0,0],m=[null,null,null],n=[null,null,null],o=this.mesh.vHead;b=o.next;for(var p=0;p<3;++p)e=b.coords[p],i[p]=e,n[p]=b,h[p]=e,m[p]=b;for(b=o.next;b!==o;b=b.next)for(var q=0;q<3;++q)(e=b.coords[q])<i[q]&&(i[q]=e,n[q]=b),e>h[q]&&(h[q]=e,m[q]=b);var r=0;if(h[1]-i[1]>h[0]-i[0]&&(r=1),h[2]-i[2]>h[r]-i[r]&&(r=2),i[r]>=h[r]){a[0]=0,a[1]=0,a[2]=1;return}for(g=0,c=n[r],d=m[r],j[0]=c.coords[0]-d.coords[0],j[1]=c.coords[1]-d.coords[1],j[2]=c.coords[2]-d.coords[2],b=o.next;b!==o;b=b.next)k[0]=b.coords[0]-d.coords[0],k[1]=b.coords[1]-d.coords[1],k[2]=b.coords[2]-d.coords[2],l[0]=j[1]*k[2]-j[2]*k[1],l[1]=j[2]*k[0]-j[0]*k[2],l[2]=j[0]*k[1]-j[1]*k[0],(f=l[0]*l[0]+l[1]*l[1]+l[2]*l[2])>g&&(g=f,a[0]=l[0],a[1]=l[1],a[2]=l[2]);g<=0&&(a[0]=a[1]=a[2]=0,a[this.longAxis_(j)]=1)},a.prototype.checkOrientation_=function(){for(var a,b,c=this.mesh.fHead,d=this.mesh.vHead,e=0,f=c.next;f!==c;f=f.next)if(!((b=f.anEdge).winding<=0))do e+=(b.Org.s-b.Dst.s)*(b.Org.t+b.Dst.t),b=b.Lnext;while(b!==f.anEdge);if(e<0){for(a=d.next;a!==d;a=a.next)a.t=-a.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},a.prototype.projectPolygon_=function(){var a,b,c=this.mesh.vHead,d=[0,0,0],e=!1;d[0]=this.normal[0],d[1]=this.normal[1],d[2]=this.normal[2],d[0]||d[1]||d[2]||(this.computeNormal_(d),e=!0),a=this.sUnit,b=this.tUnit;var f=this.longAxis_(d);a[f]=0,a[(f+1)%3]=1,a[(f+2)%3]=0,b[f]=0,b[(f+1)%3]=0,b[(f+2)%3]=d[f]>0?1:-1;for(var g=c.next;g!==c;g=g.next)g.s=this.dot_(g.coords,a),g.t=this.dot_(g.coords,b);e&&this.checkOrientation_();for(var h=!0,i=c.next;i!==c;i=i.next)h?(this.bmin[0]=this.bmax[0]=i.s,this.bmin[1]=this.bmax[1]=i.t,h=!1):(i.s<this.bmin[0]&&(this.bmin[0]=i.s),i.s>this.bmax[0]&&(this.bmax[0]=i.s),i.t<this.bmin[1]&&(this.bmin[1]=i.t),i.t>this.bmax[1]&&(this.bmax[1]=i.t))},a.prototype.addWinding_=function(a,b){a.winding+=b.winding,a.Sym.winding+=b.Sym.winding},a.prototype.tessellateMonoRegion_=function(a,b){var c,d;if(!((c=b.anEdge).Lnext!==c&&c.Lnext.Lnext!==c))throw"Mono region invalid";for(;I$a.vertLeq(c.Dst,c.Org);c=c.Lprev);for(;I$a.vertLeq(c.Org,c.Dst);c=c.Lnext);for(d=c.Lprev;c.Lnext!==d;)if(I$a.vertLeq(c.Dst,d.Org)){for(;d.Lnext!==c&&(I$a.edgeGoesLeft(d.Lnext)||0>=I$a.edgeSign(d.Org,d.Dst,d.Lnext.Dst));)d=a.connect(d.Lnext,d).Sym;d=d.Lprev}else{for(;d.Lnext!==c&&(I$a.edgeGoesRight(c.Lprev)||I$a.edgeSign(c.Dst,c.Org,c.Lprev.Org)>=0);)c=a.connect(c,c.Lprev).Sym;c=c.Lnext}if(d.Lnext===c)throw"Mono region invalid";for(;d.Lnext.Lnext!==c;)d=a.connect(d.Lnext,d).Sym;return!0},a.prototype.tessellateInterior_=function(a){for(var b,c=a.fHead.next;c!==a.fHead;c=b)if(b=c.next,c.inside&&!this.tessellateMonoRegion_(a,c))return!1;return!0},a.prototype.discardExterior_=function(a){for(var b,c=a.fHead.next;c!==a.fHead;c=b)b=c.next,c.inside||a.zapFace(c)},a.prototype.setWindingNumber_=function(a,b,c){for(var d,e=a.eHead.next;e!==a.eHead;e=d)d=e.next,e.Rface.inside!==e.Lface.inside?e.winding=e.Lface.inside?b:-b:c?a.delete(e):e.winding=0},a.prototype.getNeighbourFace_=function(a){return a.Rface&&a.Rface.inside?a.Rface.n:-1},a.prototype.outputPolymesh_=function(a,b,c,d){var e,f,g=0,h=0;c>3&&a.mergeConvexFaces(c);for(var i=a.vHead.next;i!==a.vHead;i=i.next)i.n=-1;for(var j=a.fHead.next;j!==a.fHead;j=j.next)if(j.n=-1,j.inside){e=j.anEdge,f=0;do{var i=e.Org;-1===i.n&&(i.n=h,h++),f++,e=e.Lnext}while(e!==j.anEdge);if(f>c)throw"Face vertex greater that support polygon";j.n=g,++g}this.elementCount=g,b===Hsb.CONNECTED_POLYGONS&&(g*=2),this.elements=[],this.elements.length=g*c,this.vertexCount=h,this.vertices=[],this.vertices.length=h*d,this.vertexIndices=[],this.vertexIndices.length=h;for(var i=a.vHead.next;i!==a.vHead;i=i.next)if(-1!==i.n){var k=i.n*d;this.vertices[k+0]=i.coords[0],this.vertices[k+1]=i.coords[1],d>2&&(this.vertices[k+2]=i.coords[2]),this.vertexIndices[i.n]=i.idx}for(var l=0,j=a.fHead.next;j!==a.fHead;j=j.next)if(j.inside){e=j.anEdge,f=0;do{var i=e.Org;this.elements[l++]=i.n,f++,e=e.Lnext}while(e!==j.anEdge);for(var m=f;m<c;++m)this.elements[l++]=-1;if(b===Hsb.CONNECTED_POLYGONS){e=j.anEdge;do this.elements[l++]=this.getNeighbourFace_(e),e=e.Lnext;while(e!==j.anEdge);for(var n=f;n<c;++n)this.elements[l++]=-1}}},a.prototype.outputContours_=function(a,b){var c,d,e=0,f=0;this.vertexCount=0,this.elementCount=0;for(var g=a.fHead.next;g!==a.fHead;g=g.next)if(g.inside){d=c=g.anEdge;do this.vertexCount++,c=c.Lnext;while(c!==d);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*b,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var h=0,i=0,j=0;e=0;for(var g=a.fHead.next;g!==a.fHead;g=g.next)if(g.inside){f=0,d=c=g.anEdge;do this.vertices[h++]=c.Org.coords[0],this.vertices[h++]=c.Org.coords[1],b>2&&(this.vertices[h++]=c.Org.coords[2]),this.vertexIndices[i++]=this.vertexIdCallback?this.vertexIdCallback(c):c.Org.idx,f++,c=c.Lnext;while(c!==d);this.elements[j++]=e,this.elements[j++]=f,e+=f}},a.prototype.addContour=function(a,b){null===this.mesh&&(this.mesh=new M$a),a<2&&(a=2),a>3&&(a=3);for(var c=null,d=0;d<b.length;d+=a)null===c?(c=this.mesh.makeEdge(),this.mesh.splice(c,c.Sym)):(this.mesh.splitEdge(c),c=c.Lnext),c.Org.coords[0]=b[d+0],c.Org.coords[1]=b[d+1],a>2?c.Org.coords[2]=b[d+2]:c.Org.coords[2]=0,c.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(c),c.winding=1,c.Sym.winding=-1},a.prototype.tesselate=function(a,b,c,d,e,f){if(void 0===a&&(a=Gsb.ODD),void 0===b&&(b=Hsb.POLYGONS),void 0===f&&(f=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,e&&(this.normal[0]=e[0],this.normal[1]=e[1],this.normal[2]=e[2]),this.windingRule=a,d<2&&(d=2),d>3&&(d=3),!this.mesh)return!1;this.projectPolygon_(),T$a.computeInterior(this,f);var g=this.mesh;return b===Hsb.BOUNDARY_CONTOURS?this.setWindingNumber_(g,1,!0):this.tessellateInterior_(g),f&&g.check(),b===Hsb.BOUNDARY_CONTOURS?this.outputContours_(g,d):this.outputPolymesh_(g,b,c,d),!0},a}();function V$a(a){var b=a.windingRule,c=void 0===b?Gsb.ODD:b,d=a.elementType,e=void 0===d?Hsb.POLYGONS:d,f=a.polySize,g=void 0===f?3:f,h=a.vertexSize,i=void 0===h?2:h,j=a.normal,k=void 0===j?[0,0,1]:j,l=a.contours,m=void 0===l?[]:l,n=a.strict,o=void 0===n||n,p=a.debug,q=void 0!==p&&p;if(!m&&o)throw new Error("Contours can't be empty");if(m){var r=new U$a;a.edgeCreateCallback&&(r.edgeCreateCallback=a.edgeCreateCallback),a.vertexIdCallback&&(r.vertexIdCallback=a.vertexIdCallback);for(var s=0;s<m.length;s++)r.addContour(i||2,m[s]);return r.tesselate(c,e,g,i,k,o),{vertices:r.vertices,vertexIndices:r.vertexIndices,vertexCount:r.vertexCount,elements:r.elements,elementCount:r.elementCount,mesh:q?r.mesh:void 0}}}Gsb.ODD,Gsb.NONZERO,Gsb.POSITIVE,Gsb.NEGATIVE,Gsb.ABS_GEQ_TWO,Hsb.POLYGONS,Hsb.CONNECTED_POLYGONS,Hsb.BOUNDARY_CONTOURS;var W$a=class{constructor(X$a=256,Y$a=!1){this.capacity=X$a,this.size=0,this.debug=Y$a,this.debug&&console.log(`allocating with cap ${X$a}`);let Z$a=X$a*W$a.eSize;this.buffer=new ArrayBuffer(Z$a);let $$a=Float32Array.BYTES_PER_ELEMENT,_$a=0;this.positions=new Float32Array(this.buffer,_$a*$$a,3*X$a),_$a+=3*X$a,this.normals=new Float32Array(this.buffer,_$a*$$a,3*X$a),_$a+=3*X$a,this.uvs=new Float32Array(this.buffer,_$a*$$a,2*X$a)}realloc(a_a,b_a=!1){if(a_a<this.size)throw Error("cannot shrink buffer");if(a_a<=this.capacity&&!b_a)return;this.debug&&console.log(`resizing from ${this.capacity} \u2192 ${a_a}`);let c_a=a_a*W$a.eSize,d_a=new ArrayBuffer(c_a),e_a=Float32Array.BYTES_PER_ELEMENT,f_a=0,g_a=new Float32Array(d_a,f_a*e_a,3*a_a);f_a+=3*a_a;let h_a=new Float32Array(d_a,f_a*e_a,3*a_a);f_a+=3*a_a;let i_a=new Float32Array(d_a,f_a*e_a,2*a_a);b_a?(g_a.set(this.positions.subarray(0,3*this.size)),h_a.set(this.normals.subarray(0,3*this.size)),i_a.set(this.uvs.subarray(0,2*this.size))):(g_a.set(this.positions),h_a.set(this.normals),i_a.set(this.uvs)),this.buffer=d_a,this.positions=g_a,this.normals=h_a,this.uvs=i_a,this.capacity=a_a}get(j_a=1){let k_a=this.size+j_a;if(k_a>this.capacity){let l_a=this.capacity;for(;k_a>l_a;)l_a*=2;this.realloc(l_a)}let m_a=this.size;return this.size=k_a,m_a}reserve(n_a){let o_a=this.size+n_a;o_a>this.capacity&&this.realloc(o_a)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} \u2192 ${this.size}`),this.realloc(this.size,!0)}},p_a=W$a;p_a.eSize=8*Float32Array.BYTES_PER_ELEMENT;var q_a=r(w()),r_a={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},s_a={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},t_a={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},u_a=(a,b)=>([c,d])=>(d<c&&(d+=b),(a>=c?a:a+b)<=d),v_a=class extends nE{constructor(w_a,x_a,y_a=0,z_a=12,A_a=3,B_a=Gsb.ODD,C_a=!1){super(),this.forPathBevel=C_a,this.type="ShapeGeometry",this.vertexCache={},this._shape=w_a,this._depth=x_a,this._curveSegments=z_a,this._bevelSegmentsInput=A_a;let D_a=this._shape.extractShapePointsToFlatArray([],z_a),E_a=this._shape.shapeHoles.map(a=>{let b=a.extractShapePointsToFlatArray([],z_a),c=[];for(let d=b.length-1;d>=1;d-=2){let e=b[d-1],f=b[d-0];c.push(e,f)}return c}),F_a=[],G_a=[];for(let H_a=0;H_a<D_a.length;H_a+=2)G_a.push([D_a[H_a],D_a[H_a+1]]);F_a.push(G_a);for(let I_a=0;I_a<E_a.length;I_a++){let J_a=E_a[I_a],K_a=[];for(let L_a=0;L_a<J_a.length;L_a+=2)K_a.push([J_a[L_a],J_a[L_a+1]]);F_a.push(K_a)}let M_a;M_a=w_a.isText?.1*new kpa().setFromPoints(w_a.points.map(a=>a.position)).getSize(new Eb).length():0===F_a[0].length?y_a:(0,q_a.default)(F_a).distance,y_a<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(y_a,M_a,x_a/2),this._bevelSegments=Math.floor(A_a));let N_a;try{N_a=V$a({windingRule:B_a,elementType:Hsb.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[D_a]})}catch{N_a=r_a}let O_a;try{O_a=V$a({windingRule:Gsb.ODD,elementType:Hsb.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...E_a]})}catch{O_a=s_a}if(!N_a)throw new Error("error generating geometry");let P_a=N_a.elementCount;if(O_a){N_a.elementCount+=O_a.elementCount;for(let Q_a=0;Q_a<O_a.elements.length;Q_a++){let R_a=O_a.elements[Q_a],S_a=Q_a%2==0?N_a.vertexCount:0;N_a.elements.push(R_a+S_a)}for(let T_a=0;T_a<O_a.vertexIndices.length;T_a++){let U_a=O_a.vertexIndices[T_a],V_a=N_a.vertexCount;N_a.vertexIndices.push(U_a+V_a)}for(let W_a=0;W_a<O_a.vertices.length;W_a++){let X_a=O_a.vertices[W_a];N_a.vertices.push(X_a)}}let Y_a=1/0,Z_a=-1/0,$_a=1/0,__a=-1/0;for(let a0a=0,b0a=N_a.vertexCount;a0a<b0a;a0a++){let c0a=2*a0a,d0a=N_a.vertices[c0a+0],e0a=N_a.vertices[c0a+1];d0a<Y_a&&(Y_a=d0a),d0a>Z_a&&(Z_a=d0a),e0a<$_a&&($_a=e0a),e0a>__a&&(__a=e0a)}this._minX=Y_a,this._minY=$_a,this._width=Z_a-Y_a,this._height=__a-$_a,this._buffer=new p_a(this._computeBufferEstimatedSize(N_a));let f0a=[],g0a=[];for(let h0a=N_a.elementCount-1;h0a>=0;h0a--){let i0a=h0a>=P_a,j0a=2*h0a,k0a=N_a.elements[j0a+0],l0a=N_a.elements[j0a+1],m0a=k0a+l0a,n0a={start:k0a,count:l0a,normals:[],continuous:[],concave:[]},o0a=k0a,p0a=m0a-1,q0a=k0a+1,r0a=this._shape.roundedCurves.length;do{let s0a=o0a-k0a,t0a=N_a.vertices[2*p0a+0],u0a=N_a.vertices[2*p0a+1],v0a=N_a.vertices[2*o0a+0],w0a=N_a.vertices[2*o0a+1],x0a=N_a.vertices[2*q0a+0],y0a=N_a.vertices[2*q0a+1],z0a=v0a-t0a,A0a=w0a-u0a,B0a=Math.sqrt(z0a*z0a+A0a*A0a);z0a/=B0a,A0a/=B0a;let C0a=v0a-x0a,D0a=w0a-y0a,E0a=Math.sqrt(C0a*C0a+D0a*D0a);C0a/=E0a,D0a/=E0a,n0a.normals[2*s0a+0]=-D0a,n0a.normals[2*s0a+1]=C0a,n0a.concave[s0a]=z0a*D0a-A0a*C0a>0;let F0a=N_a.vertexIndices[o0a];if(Array.isArray(F0a))n0a.continuous[s0a]=!1;else{let[G0a,H0a]=this._shape.getCurveIndexFromVertexId(F0a-1,!0);if(H0a>0&&H0a<1)n0a.continuous[s0a]=!0;else{let I0a=1===H0a?G0a+1:G0a-1;I0a=(I0a+r0a)%r0a;let J0a=1===H0a?0:1,K0a=this._shape.roundedCurves[G0a].getTangent(H0a),L0a=this._shape.roundedCurves[I0a].getTangent(J0a);n0a.continuous[s0a]=K0a.dot(L0a)>.95}}i0a&&(n0a.normals[2*s0a+0]*=-1,n0a.normals[2*s0a+1]*=-1),[p0a,o0a,q0a]=[o0a,q0a,q0a+1],q0a>=m0a&&(q0a-=l0a)}while(q0a!==k0a+1);let M0a=[];M0a.push({bevelI:0,angle:0,size:0,boundary:{vertices:N_a.vertices.slice(2*k0a,2*m0a),vertexCount:l0a,vertexIndices:new Array(l0a).fill(!0).map((a,b)=>[b,b]),elements:[0,l0a],elementCount:1,mesh:null},reverseMap:[],insetPoints:N_a.vertices.slice(2*k0a,2*m0a)});let N0a=0;for(let O0a=1;O0a<=this._bevelSegments;O0a++){let P0a=O0a/this._bevelSegments*Math.PI/2,Q0a=(1-Math.cos(P0a))*this._bevel,R0a=[],S0a=[],T0a=[],U0a=[],V0a=0;for(let W0a=0;W0a<l0a;W0a++){let X0a=2*W0a,Y0a=(W0a-1+l0a)%l0a*2,Z0a=N_a.vertices[2*n0a.start+X0a+0],$0a=N_a.vertices[2*n0a.start+X0a+1],_0a=-n0a.normals[Y0a+0]*Q0a,a1a=-n0a.normals[Y0a+1]*Q0a,b1a=-n0a.normals[X0a+0]*Q0a,c1a=-n0a.normals[X0a+1]*Q0a;if(n0a.concave[W0a]|| !n0a.concave[W0a]&&i0a){let d1a=Math.atan2(a1a,_0a),e1a=Math.atan2(c1a,b1a);e1a>d1a&&(e1a-=2*Math.PI);let f1a=e1a-d1a;if(n0a.continuous[W0a]||i0a){let g1a=d1a+f1a/2,h1a=Math.cos(g1a)*Q0a,i1a=Math.sin(g1a)*Q0a;R0a[2*V0a+0]=Z0a+h1a*(i0a?-1:1),R0a[2*V0a+1]=$0a+i1a*(i0a?-1:1),U0a[V0a]=W0a,V0a++}else{let j1a=Math.max(1,Math.floor(z_a/4*Math.abs(f1a)/Math.PI));for(let k1a=0;k1a<=j1a;k1a++){let l1a=d1a+f1a*(k1a/j1a),m1a=Math.cos(l1a)*Q0a,n1a=Math.sin(l1a)*Q0a;R0a[2*V0a+0]=Z0a+m1a,R0a[2*V0a+1]=$0a+n1a,U0a[V0a]=W0a,V0a++}}}else R0a[2*V0a+0]=Z0a+_0a,R0a[2*V0a+1]=$0a+a1a,U0a[V0a]=W0a,S0a[W0a]=V0a,V0a++,R0a[2*V0a+0]=Z0a,R0a[2*V0a+1]=$0a,U0a[V0a]=W0a,V0a++,R0a[2*V0a+0]=Z0a+b1a,R0a[2*V0a+1]=$0a+c1a,U0a[V0a]=W0a,T0a[W0a]=V0a,V0a++}let o1a=V$a({windingRule:Gsb.POSITIVE,elementType:Hsb.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[R0a],edgeCreateCallback:a=>{let b=a.Org.idx,c=U0a[b],d=U0a[(b+1)%U0a.length];a.idx=[c,d],a.Sym.idx=[d,c]},vertexIdCallback:a=>{let b=a.Lprev.idx;return[b?b[1]:0,a.idx?a.idx[0]:0]}});if(!o1a)throw console.log("Error"),new Error(`error generating bevel geometry for ${O0a}'th loop`);if(!o1a.vertexCount){let p1a=(O0a-1)/this._bevelSegments*Math.PI/2;N0a=(1-Math.sin(p1a))*this._bevel;break}for(let q1a=0;q1a<o1a.vertexIndices.length;q1a++){let[r1a,s1a]=o1a.vertexIndices[q1a];if(r1a===s1a)continue;let t1a=s1a;s1a<r1a&&(t1a+=l0a);for(let u1a=r1a;u1a<t1a;u1a++){let v1a=u1a%l0a,w1a=(u1a+1)%l0a;if(!n0a.continuous[v1a]||!n0a.continuous[w1a]){o1a.vertexIndices[q1a]=[r1a,v1a],o1a.vertexIndices.splice(q1a+1,0,[w1a,s1a]),o1a.vertices.splice((q1a+1)*2,0,o1a.vertices[2*q1a],o1a.vertices[2*q1a+1]);break}}}M0a.push({bevelI:O0a,angle:P0a,size:Q0a,boundary:o1a,reverseMap:U0a,insetPoints:R0a})}let x1a=(a,b,c)=>{let d=0,e=a.boundary.vertexIndices.length;for(;d<e&&c(a.boundary.vertexIndices[b]);)b=(b+1)%e,d++;return d},y1a=f0a.length;for(let z1a=1;z1a<M0a.length;z1a++){let A1a=M0a[z1a-1],B1a=M0a[z1a],C1a=A1a.boundary.vertexIndices.length,D1a=B1a.boundary.vertexIndices.length;if(!C1a||!D1a)break;let E1a=n0a.concave.length,F1a=0,G1a=u_a(F1a,l0a);for(;!A1a.boundary.vertexIndices.filter(G1a).length||!B1a.boundary.vertexIndices.filter(G1a).length;)F1a++,G1a=u_a(F1a,l0a);let H1a=A1a.boundary.vertexIndices.findIndex(G1a),I1a=B1a.boundary.vertexIndices.findIndex(G1a);do H1a=(H1a+1)%C1a;while(G1a(A1a.boundary.vertexIndices[H1a]));do I1a=(I1a+1)%D1a;while(G1a(B1a.boundary.vertexIndices[I1a]));let J1a=F1a=(F1a+1)%l0a,K1a=0,L1a=this._buildBevelVert(n0a,A1a,(H1a-1+C1a)%C1a,void 0,K1a),M1a=this._buildBevelVert(n0a,B1a,(I1a-1+D1a)%D1a,void 0,K1a),N1a=L1a,O1a=M1a,P1a,Q1a,R1a=!1;do{K1a=(F1a||E1a)/E1a;let S1a=x1a(A1a,H1a,G1a=u_a(F1a,l0a)),T1a=x1a(B1a,I1a,G1a),U1a=R1a;if(R1a=!1,S1a&&!T1a){for(let V1a=0;V1a<S1a;V1a++)P1a=this._buildBevelVert(n0a,A1a,(H1a+V1a)%C1a,V1a/(S1a-1),K1a),f0a.push(N1a.topN,P1a.topP,O1a.topN),!1===C_a&&f0a.push(P1a.bottomP,N1a.bottomN,O1a.bottomN),N1a=P1a;R1a=!0}else if(!S1a&&T1a)for(let W1a=0;W1a<T1a;W1a++)Q1a=this._buildBevelVert(n0a,B1a,(I1a+W1a)%D1a,W1a/(T1a-1),K1a),f0a.push(O1a.topN,N1a.topP,Q1a.topP),!1===C_a&&f0a.push(N1a.bottomP,O1a.bottomN,Q1a.bottomP),O1a=Q1a;else if(S1a&&T1a)if(P1a=this._buildBevelVert(n0a,A1a,H1a,0,K1a),Q1a=this._buildBevelVert(n0a,B1a,I1a,0,K1a),U1a?(f0a.push(N1a.topN,Q1a.topP,O1a.topN),f0a.push(N1a.topN,P1a.topP,Q1a.topP),!1===C_a&&(f0a.push(Q1a.bottomP,N1a.bottomN,O1a.bottomN),f0a.push(Q1a.bottomP,P1a.bottomP,N1a.bottomN))):(f0a.push(O1a.topN,N1a.topN,P1a.topP),f0a.push(O1a.topN,P1a.topP,Q1a.topP),!1===C_a&&(f0a.push(P1a.bottomP,N1a.bottomN,O1a.bottomN),f0a.push(P1a.bottomP,O1a.bottomN,Q1a.bottomP))),N1a=P1a,O1a=Q1a,S1a===T1a)for(let X1a=1;X1a<S1a;X1a++)P1a=this._buildBevelVert(n0a,A1a,(H1a+X1a)%C1a,X1a/(S1a-1),K1a),Q1a=this._buildBevelVert(n0a,B1a,(I1a+X1a)%D1a,X1a/(T1a-1),K1a),f0a.push(N1a.topN,P1a.topP,O1a.topN),f0a.push(O1a.topN,P1a.topP,Q1a.topP),!1===C_a&&(f0a.push(P1a.bottomP,N1a.bottomN,O1a.bottomN),f0a.push(P1a.bottomP,O1a.bottomN,Q1a.bottomP)),N1a=P1a,O1a=Q1a;else if(S1a>T1a){let Y1a=S1a/T1a,Z1a=0;for(let $1a=1;$1a<S1a;$1a++)P1a=this._buildBevelVert(n0a,A1a,(H1a+$1a)%C1a,$1a/(S1a-1),K1a),f0a.push(N1a.topN,P1a.topP,O1a.topN),!1===C_a&&f0a.push(P1a.bottomP,N1a.bottomN,O1a.bottomN),N1a=P1a,$1a>(Z1a+1)*Y1a&&(Z1a++,Q1a=this._buildBevelVert(n0a,B1a,(I1a+Z1a)%D1a,Z1a/(T1a-1),K1a),f0a.push(O1a.topN,P1a.topP,Q1a.topP),!1===C_a&&f0a.push(P1a.bottomP,O1a.bottomN,Q1a.bottomP),O1a=Q1a)}else{let _1a=T1a/S1a,a2a=0;for(let b2a=1;b2a<T1a;b2a++)Q1a=this._buildBevelVert(n0a,B1a,(I1a+b2a)%D1a,b2a/(T1a-1),K1a),f0a.push(O1a.topN,P1a.topP,Q1a.topP),!1===C_a&&f0a.push(P1a.bottomP,O1a.bottomN,Q1a.bottomP),O1a=Q1a,b2a>(a2a+1)*_1a&&(a2a++,P1a=this._buildBevelVert(n0a,A1a,(H1a+a2a)%C1a,a2a/(S1a-1),K1a),f0a.push(N1a.topN,P1a.topP,O1a.topN),!1===C_a&&f0a.push(P1a.bottomP,N1a.bottomN,O1a.bottomN),N1a=P1a)}H1a=(H1a+S1a)%C1a,I1a=(I1a+T1a)%D1a,F1a=(F1a+1)%E1a}while(F1a!==J1a)}if(!1===C_a&&this._depth>2*this._bevel&&this._buildWall(M0a,n0a,f0a),i0a){let c2a=[];for(let d2a=f0a.length-1;d2a>=y1a+2;d2a-=3){let e2a=f0a[d2a-2],f2a=f0a[d2a-1],g2a=f0a[d2a-0];c2a.push(g2a,f2a,e2a)}f0a.splice(y1a,f0a.length-y1a,...c2a)}if(i0a){let h2a=[];for(let i2a=M0a[M0a.length-1].boundary.vertices.length-1;i2a>=1;i2a-=2){let j2a=M0a[M0a.length-1].boundary.vertices[i2a-1],k2a=M0a[M0a.length-1].boundary.vertices[i2a-0];h2a.push(j2a,k2a)}g0a.push(h2a)}if(!i0a){let l2a=M0a[M0a.length-1],m2a;try{m2a=V$a({windingRule:M0a.length>1?Gsb.POSITIVE:Gsb.ODD,elementType:Hsb.POLYGONS,vertexSize:2,strict:!0,contours:[l2a.insetPoints,...g0a]})}catch{m2a=t_a}if(!m2a)throw new Error("Error generating geometry for surface");0===E_a.length&&this._bevel<M_a&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let n2a=0;n2a<3*m2a.elementCount;n2a+=3){let o2a=this._buildSurfaceVert(m2a,m2a.elements[n2a+0],N0a),p2a=this._buildSurfaceVert(m2a,m2a.elements[n2a+1],N0a),q2a=this._buildSurfaceVert(m2a,m2a.elements[n2a+2],N0a);f0a.push(o2a.top,p2a.top,q2a.top),!1===C_a&&f0a.push(q2a.bottom,p2a.bottom,o2a.bottom)}}this.vertexCache={}}this._buffer.shrink();let r2a=new RC(Uint32Array.from(f0a),1),s2a=new RC(this._buffer.positions,3),t2a=new RC(this._buffer.normals,3),u2a=new RC(this._buffer.uvs,2);s2a.needsUpdate=!0,t2a.needsUpdate=!0,u2a.needsUpdate=!0,r2a.needsUpdate=!0,this.setAttribute("position",s2a),this.setAttribute("normal",t2a),this.setAttribute("uv",u2a),this.setIndex(r2a)}_computeBufferEstimatedSize(v2a){return 2*v2a.vertexCount*(2+this._bevelSegments)}_buildWall(w2a,x2a,y2a){let z2a=w2a[0];for(let A2a=0,B2a=z2a.boundary.vertexCount;A2a<B2a;A2a++){let C2a=this._buildBevelVert(x2a,z2a,A2a),D2a=this._buildBevelVert(x2a,z2a,(A2a+1)%B2a);y2a.push(D2a.topP,C2a.topN,C2a.bottomN),y2a.push(D2a.topP,C2a.bottomN,D2a.bottomP)}}_buildSurfaceVert(E2a,F2a,G2a){let H2a=F2a.toString();if(H2a in this.vertexCache)return this.vertexCache[H2a];let I2a=E2a.vertices[2*F2a+0],J2a=E2a.vertices[2*F2a+1],K2a=(I2a-this._minX)/this._width,L2a=(J2a-this._minY)/this._height;this.forPathBevel&&(L2a=1);let M2a=this._buffer.get(this.forPathBevel?1:2),N2a=3*M2a,O2a=2*M2a,P2a={top:M2a+0,bottom:M2a+1};return this._buffer.positions[N2a+0]=I2a,this._buffer.positions[N2a+1]=J2a,this._buffer.positions[N2a+2]=this.forPathBevel?this._bevel:this._depth-G2a,this._buffer.normals[N2a+0]=0,this._buffer.normals[N2a+1]=0,this._buffer.normals[N2a+2]=1,this._buffer.uvs[O2a+0]=K2a,this._buffer.uvs[O2a+1]=L2a,!1===this.forPathBevel&&(this._buffer.positions[N2a+3]=I2a,this._buffer.positions[N2a+4]=J2a,this._buffer.positions[N2a+5]=G2a,this._buffer.normals[N2a+3]=0,this._buffer.normals[N2a+4]=0,this._buffer.normals[N2a+5]=-1,this._buffer.uvs[O2a+2]=K2a,this._buffer.uvs[O2a+3]=L2a),this.vertexCache[H2a]=P2a,P2a}_buildBevelVert(Q2a,R2a,S2a,T2a=1,U2a){let V2a=`${R2a.bevelI}:${S2a}`;if(V2a in this.vertexCache&&0!==U2a&&1!==U2a&&(!U2a||U2a===this.vertexCache[V2a].pathBevelUCoord))return this.vertexCache[V2a];let[W2a,X2a]=R2a.boundary.vertexIndices[S2a],Y2a,Z2a,$2a,_2a;W2a!==X2a?(Z2a=W2a,Y2a=X2a,_2a=!1,$2a=Q2a.continuous[Z2a]&&Q2a.continuous[Y2a]):(Z2a=((Y2a=W2a)-1+Q2a.count)%Q2a.count,_2a=Q2a.concave[Y2a]&&R2a.bevelI>0,$2a=Q2a.continuous[Y2a]||_2a);let a3a=Math.cos(R2a.angle),b3a=Math.sin(R2a.angle),c3a=2*S2a,d3a=2*Y2a,e3a=2*Z2a,f3a=R2a.boundary.vertices[c3a+0],g3a=R2a.boundary.vertices[c3a+1],h3a=(1-b3a)*this._bevel,i3a=(f3a-this._minX)/this._width,j3a=(g3a-this._minY)/this._height;this.forPathBevel&&(void 0!==U2a&&(i3a=U2a),j3a=1);let k3a=Q2a.normals[d3a+0],l3a=Q2a.normals[d3a+1],m3a=Q2a.normals[e3a+0],n3a=Q2a.normals[e3a+1];if(_2a){let o3a=m3a-k3a,p3a=n3a-l3a,q3a=Math.sqrt((k3a+=o3a*(1-T2a))*k3a+(l3a+=p3a*(1-T2a))*l3a);k3a/=q3a,l3a/=q3a}let r3a=this.forPathBevel?this._buffer.get($2a?1:2):this._buffer.get($2a?2:4),s3a=3*r3a,t3a=2*r3a,u3a={i:S2a,fi:Y2a,topP:r3a+0,topN:r3a+0,bottomP:r3a+1,bottomN:r3a+1,pathBevelUCoord:U2a};return this._buffer.positions[s3a+0]=f3a,this._buffer.positions[s3a+1]=g3a,this._buffer.positions[s3a+2]=(this.forPathBevel?this._bevel:this._depth)-h3a,this._buffer.normals[s3a+0]=k3a*a3a,this._buffer.normals[s3a+1]=l3a*a3a,this._buffer.normals[s3a+2]=b3a,this._buffer.uvs[t3a+0]=i3a,this._buffer.uvs[t3a+1]=j3a,!1===this.forPathBevel&&(this._buffer.positions[s3a+3]=f3a,this._buffer.positions[s3a+4]=g3a,this._buffer.positions[s3a+5]=h3a,this._buffer.normals[s3a+3]=k3a*a3a,this._buffer.normals[s3a+4]=l3a*a3a,this._buffer.normals[s3a+5]=-b3a,this._buffer.uvs[t3a+2]=j3a,this._buffer.uvs[t3a+3]=i3a),$2a||(this.forPathBevel?(r3a+=1,s3a+=3,t3a+=2):(r3a+=2,s3a+=6,t3a+=4),u3a.topP=r3a+0,u3a.bottomP=r3a+1,this._buffer.positions[s3a+0]=f3a,this._buffer.positions[s3a+1]=g3a,this._buffer.positions[s3a+2]=(this.forPathBevel?this._bevel:this._depth)-h3a,this._buffer.normals[s3a+0]=m3a*a3a,this._buffer.normals[s3a+1]=n3a*a3a,this._buffer.normals[s3a+2]=b3a,this._buffer.uvs[t3a+0]=i3a,this._buffer.uvs[t3a+1]=j3a,!1===this.forPathBevel&&(this._buffer.positions[s3a+3]=f3a,this._buffer.positions[s3a+4]=g3a,this._buffer.positions[s3a+5]=h3a,this._buffer.normals[s3a+3]=m3a*a3a,this._buffer.normals[s3a+4]=n3a*a3a,this._buffer.normals[s3a+5]=-b3a,this._buffer.uvs[t3a+2]=j3a,this._buffer.uvs[t3a+3]=i3a)),this.vertexCache[V2a]=u3a,u3a}clone(){let v3a=new v_a(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return v3a.userData=Uxa(this.userData),v3a}},w3a=class extends nE{constructor(x3a,y3a=12,z3a={}){super(),this.type="ShapeGeometry",this.windingRule=Gsb.ODD,this.elementType=Hsb.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=x3a,this._curveSegments=y3a,this._triangulationOptions=Object.assign({windingRule:Gsb.ODD,elementType:Hsb.POLYGONS,polySize:3,vertexSize:2,strict:!0},z3a);let A3a=this._shape.extractShapePointsToFlatArray([],this._curveSegments),B3a=this._shape.shapeHoles.map(a=>a.extractShapePointsToFlatArray([],this._curveSegments)),C3a,D3a=!0,E3a=!0,F3a,G3a;for(let H3a=0,I3a=A3a.length/2;H3a<I3a;H3a++){let J3a=2*H3a,K3a=A3a[J3a+0],L3a=A3a[J3a+1];if(void 0!==F3a&&K3a!==F3a&&(D3a=!1),void 0!==G3a&&L3a!==G3a&&(E3a=!1),F3a=K3a,G3a=L3a,!D3a&&!E3a)break}if(!D3a&&!E3a)try{C3a=V$a({contours:[A3a,...B3a],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{C3a=r_a}let M3a=C3a?.vertexCount??1,N3a=C3a?.elementCount??1;if(this._positionAttribute=new RC(new Float32Array(3*M3a),3),this._normalAttribute=new RC(new Float32Array(3*M3a),3),this._uvAttribute=new RC(new Float32Array(2*M3a),2),this._indexAttribute=new RC(new Uint32Array(3*N3a),1),C3a){let O3a=1/0,P3a=-1/0,Q3a=1/0,R3a=-1/0;for(let S3a=0,T3a=M3a;S3a<T3a;S3a++){let U3a=2*S3a,V3a=C3a.vertices[U3a+0],W3a=C3a.vertices[U3a+1];V3a<O3a&&(O3a=V3a),V3a>P3a&&(P3a=V3a),W3a<Q3a&&(Q3a=W3a),W3a>R3a&&(R3a=W3a)}let X3a=P3a-O3a,Y3a=R3a-Q3a;for(let Z3a=0,$3a=M3a;Z3a<$3a;Z3a++){let _3a=2*Z3a,a4a=C3a.vertices[_3a+0],b4a=C3a.vertices[_3a+1],c4a=(a4a-O3a)/X3a,d4a=(b4a-Q3a)/Y3a;this._positionAttribute.setXYZ(Z3a,a4a,b4a,0),this._normalAttribute.setXYZ(Z3a,0,0,1),this._uvAttribute.setXY(Z3a,c4a,d4a)}for(let e4a=0,f4a=N3a;e4a<f4a;e4a++){let g4a=3*e4a,h4a=C3a.elements[g4a+0],i4a=C3a.elements[g4a+1],j4a=C3a.elements[g4a+2];this._indexAttribute.setX(g4a+0,h4a),this._indexAttribute.setX(g4a+1,i4a),this._indexAttribute.setX(g4a+2,j4a)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,(C3a?.elementCount??1)*3)}clone(){let k4a=new w3a(this._shape,this._curveSegments);return k4a.userData=Uxa(this.userData),k4a}},l4a=class extends v_a{constructor(m4a,n4a,o4a=0,p4a=12,q4a=3,r4a=Gsb.ODD){super(m4a,n4a,o4a,p4a,q4a,r4a),this.type="ShapeGeometry"}_computeBufferEstimatedSize(s4a){return 2*s4a.vertexCount*(2+this._bevelSegments)}_buildWall(t4a,u4a,v4a){let w4a=t4a[0];for(let x4a=0,y4a=w4a.boundary.vertexCount;x4a<y4a;x4a++){let z4a=this._buildBevelVert(u4a,w4a,x4a),A4a=this._buildBevelVert(u4a,w4a,(x4a+1)%y4a);v4a.push(A4a.topP,z4a.topN,z4a.bottomN),v4a.push(A4a.topP,z4a.bottomN,A4a.bottomP)}}clone(){let B4a=new l4a(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return B4a.userData=Uxa(this.userData),B4a}},C4a=class{static create(D4a){return this.build(this.normalizeInputs(D4a))}static normalizeInputs(E4a,F4a){let G4a=Object.assign({},F4a?.parameters??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:Gsb.ODD},E4a.parameters),H4a=Math.abs(G4a.width),I4a=Math.abs(G4a.height??G4a.width),J4a=Math.abs(G4a.depth??0),K4a=E4a.shape??F4a?.shape,L4a=K4a?.roundness??G4a.roundness;void 0!==K4a&&(K4a instanceof yXa?(K4a.width!==H4a||K4a.height!==I4a)&&K4a.applySize(H4a,I4a):K4a=new yXa(H4a,I4a).fromJSON(K4a),E4a.parameters?.roundness!==void 0&&E4a.parameters?.roundness>0&&K4a.update());let M4a=K4a??new yXa(H4a,I4a);return{parameters:Object.assign(G4a,{width:H4a,height:I4a,depth:J4a,roundness:L4a}),shape:M4a}}static build(N4a){let{depth:O4a,extrudeBevelSize:P4a,extrudeBevelSegments:Q4a,subdivisions:R4a,roundness:S4a,windingRule:T4a}=N4a.parameters;N4a.shape.roundness=S4a;let U4a;return U4a=O4a<=0?new w3a(N4a.shape,R4a,{windingRule:T4a}):new l4a(N4a.shape,O4a,P4a,R4a,Q4a,T4a),Object.assign(U4a,{userData:{...N4a,type:"VectorGeometry"}})}},V4a=2*Math.PI,W4a=class{static create(X4a){return this.build(this.normalizeInputs(X4a))}static normalizeInputs(Y4a,Z4a){let $4a=Object.assign({},Z4a?.parameters??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},Y4a.parameters);return $4a.angle=Db.clamp($4a.angle,0,360),{shape:Y4a.shape&&Y4a.shape instanceof yXa?Y4a.shape:new yXa,parameters:Object.assign($4a,{width:Math.abs($4a.width),height:Math.abs($4a.height??$4a.width),depth:Math.abs($4a.depth??0)})}}static build(_4a){let{width:a5a,height:b5a,spikes:c5a,angle:d5a,innerRadius:e5a,depth:f5a,extrudeBevelSize:g5a,extrudeBevelSegments:h5a}=_4a.parameters,i5a=_4a.shape,j5a=l5a(i5a,.5*a5a,.5*b5a,d5a*Math.PI/180,c5a,e5a);i5a.isClosed=!0,i5a.update();let k5a;return 0===d5a?(k5a=new nE).setAttribute("position",new cE([],3)):k5a=C4a.create({shape:i5a,parameters:{subdivisions:j5a,depth:f5a,extrudeBevelSize:g5a,extrudeBevelSegments:h5a}}),Object.assign(k5a,{userData:{..._4a,type:"EllipseGeometry"}})}};function l5a(a,b,c,d,e,f){if(d>=V4a)return e>30||e%4==0?(o5a(a,b,c,f),Math.round(e/4)):n5a(a,d,e,b,c,f);d=Math.max(d,.001);let g={x:0,y:c},h=d+.5*Math.PI,i={x:Math.cos(h)*b,y:Math.sin(h)*c},j=function({px:a,py:b,cx:c,cy:d,rx:e,ry:f,largeArcFlag:g,sweepFlag:h}){var i,j,k,l,m,n,o,p,q,r;let s=[];if(0===e||0===f)return[];let t=(a-c)/2,u=(b-d)/2;if(0===t&&0===u)return[];e=Math.abs(e),f=Math.abs(f);let v=Math.pow(t,2)/Math.pow(e,2)+Math.pow(u,2)/Math.pow(f,2);v>1&&(e*=Math.sqrt(v),f*=Math.sqrt(v));let w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L=(i=a,j=b,k=c,l=d,m=e,n=f,o=t,p=u,q=g,r=h,w=Math.pow(m,2),x=Math.pow(n,2),y=Math.pow(o,2),z=Math.pow(p,2),A=w*x-w*z-x*y,A<0&&(A=0),B=(A=Math.sqrt(A/=w*z+x*y)*(q===r?-1:1))*m/n*p,C=-(A*n)/m*o,D=B+(i+k)/2,E=C+(j+l)/2,F=(o-B)/m,G=(p-C)/n,H=(-o-B)/m,I=(-p-C)/n,J=G$a(1,0,F,G),K=G$a(F,G,H,I),!r&&K>0&&(K-=D$a),r&&K<0&&(K+=D$a),{centerx:D,centery:E,ang1:J,ang2:K}),{ang1:M,ang2:N}=L,{centerx:O,centery:P}=L,Q=Math.abs(N)/(D$a/4);1e-7>Math.abs(1-Q)&&(Q=1);let R=Math.max(Math.ceil(Q),1);N/=R;for(let S=0;S<R;S++)s.push(F$a(M,N)),M+=N;return s.map(a=>{let{x:b,y:c}=E$a(a[0],e,f,O,P),{x:d,y:g}=E$a(a[1],e,f,O,P),{x:h,y:i}=E$a(a[2],e,f,O,P);return{x1:b,y1:c,x2:d,y2:g,x:h,y:i}})}({px:g.x,py:g.y,cx:i.x,cy:i.y,rx:b,ry:c,largeArcFlag:d>Math.PI,sweepFlag:!0});return e>30||e%j.length==0?m5a(a,g.x,g.y,j,e,b,c,f):n5a(a,d,e,b,c,f)}function m5a(a,b,c,d,e,f,g,h){let i=Math.round(e/d.length);a.addPoint(p5a(b,c));for(let j=0,k=d.length;j<k;j++){let l=d[j],m=a.points[j],n=p5a(l.x,l.y);m.controls[1].position.set(l.x1,l.y1),n.controls[0].position.set(l.x2,l.y2),a.addPoint(n)}return h>0?r5a(a,f,g,h):a.addPoint(p5a(0,0)),i}function n5a(a,b,c,d,e,f){let g=-b/c;for(let h=0;h<=c;h++){let i=g*h,j=Math.sin(i)*d,k=Math.cos(i)*e;a.addPoint(p5a(j,k))}return b<V4a?f>0?r5a(a,d,e,f):a.addPoint(p5a(0,0)):(a.removePoint(a.points[a.points.length-1]),f>0&&s5a(a,d,e,f)),1}function o5a(a,b,c,d=0,e=0,f=0){let g=.5522847498*b,h=.5522847498*c;a.addPoint(q5a(e-b,f,e-b,f-h,e-b,f+h)),a.addPoint(q5a(e,f+c,e-g,f+c,e+g,f+c)),a.addPoint(q5a(e+b,f,e+b,f+h,e+b,f-h)),a.addPoint(q5a(e,f-c,e+g,f-c,e-g,f-c)),d>0&&s5a(a,b,c,d)}function p5a(a,b){return new yWa(Db.generateUUID(),new Eb(a,b))}function q5a(a,b,c,d,e,f){let g=p5a(a,b);return g.controls[0].position.set(c,d),g.controls[1].position.set(e,f),g}function r5a(a,b,c,d){t5a(a,b,c,d).forEach(b=>a.addPoint(b))}function s5a(a,b,c,d){let e=t5a(a,b,c,d),f=new yXa;e.forEach(a=>f.addPoint(a)),f.isClosed=!0,a.shapeHoles.push(f)}function t5a(a,b,c,d){let e=d*b/100,f=e*(Math.abs(c)/Math.abs(b)),g=new Eb(e/b,f/c),h=a.points.map(a=>{let b=a.clone();return b.uuid=Db.generateUUID(),b}).reverse();return h.forEach(a=>{a.position.multiply(g);let b=a.controls[0].position.clone().multiply(g),c=a.controls[1].position.clone().multiply(g);a.controls[0].position.copy(c),a.controls[1].position.copy(b)}),h}var u5a=class{static create(v5a){return this.build(this.normalizeInputs(v5a))}static normalizeInputs(w5a,x5a){let y5a=Object.assign({},x5a?.parameters??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},w5a.parameters),z5a=Math.abs(y5a.width),A5a=Math.abs(y5a.height??z5a),B5a=Math.abs(y5a.depth??z5a),C5a=Math.abs(Math.min(z5a,B5a))/2;return{parameters:Object.assign(y5a,{width:z5a,height:A5a,depth:B5a,radius:C5a,segments:Math.round(y5a.segments),pathSegments:Math.round(y5a.pathSegments),cornerSegments:Math.round(y5a.cornerSegments)})}}static build(D5a){let{width:E5a,height:F5a,depth:G5a,radius:H5a,revolutions:I5a,segments:J5a,pathRadius:K5a,pathType:L5a,pathSegments:M5a,cornerRadius:N5a,cornerSegments:O5a}=D5a.parameters,P5a=new R5a(!1,E5a,F5a,G5a,H5a,I5a,J5a,K5a,L5a,M5a,N5a,O5a);return Object.assign(P5a,{userData:{...D5a,type:"HelixGeometry"}})}},Q5a=new $D([0,0,0],1),R5a=class extends nE{constructor(S5a=!0,T5a=1,U5a=1,V5a=1,W5a=1,X5a=1,Y5a=1,Z5a=1,$5a=1,_5a=1,a6a=1,b6a=1){if(super(),0===X5a)return;let c6a=S5a&&1===X5a;c6a&&(b6a=0),a6a>100&&(a6a=100),0===a6a&&(b6a=0);let d6a=()=>new fm,e6a=new fm,f6a=d6a(),g6a=d6a(),h6a=d6a(),i6a,j6a,k6a,l6a,m6a,n6a,o6a,p6a,q6a=d6a(),r6a=d6a(),s6a=d6a(),t6a=d6a(),u6a=d6a(),v6a=d6a(),w6a=d6a(),x6a=d6a(),y6a=U5a-2*Z5a+.001,z6a=y6a/X5a,A6a=Math.ceil(Y5a*X5a),B6a=A6a+1,C6a=y6a/A6a,D6a=-y6a/2,E6a=_5a+1,F6a=2*Math.PI/_5a,G6a=Math.PI/2/b6a,H6a=.01,I6a=Math.min((1-a6a/100)*Z5a,Z5a-H6a),J6a=Z5a-I6a,K6a=0,L6a=2,M6a=b6a*L6a+L6a,N6a=E6a*M6a/L6a,O6a=N6a+E6a*B6a,P6a=Math.max(0,E6a*(B6a+M6a)),[Q6a,R6a,S6a]=[3,3,2].map(a=>Array(P6a*a).fill(0)),T6a=[],U6a=W5a-Z5a;function V6a(a,b){let c=Math.PI/2;p6a=2*Math.PI*((n6a=b*C6a)%z6a)/z6a+c,n6a+=D6a,o6a=Math.sin(p6a)*U6a,m6a=Math.cos(p6a)*U6a,S5a?a.set(m6a,o6a,n6a):a.set(m6a,n6a,o6a)}V6a(e6a,-0.0000000001),V6a(f6a,0),q6a.copy(e6a),V6a(e6a,1);let W6a=e6a.distanceTo(f6a),X6a=c6a?0:J6a+I6a,Y6a=W6a*A6a+2*X6a,Z6a=I6a,$6a=Y6a-X6a;for(let _6a=0;_6a<=A6a;_6a++){V6a(g6a,_6a),x6a.subVectors(g6a,q6a).normalize(),q6a.copy(g6a),v6a.copy(g6a).setComponent(+S5a+1,0).normalize(),w6a.crossVectors(x6a,v6a).normalize();let a7a=0===_6a,b7a=_6a===A6a,c7a=a7a?3*Math.PI/2:G6a,d7a=a7a?Z6a:$6a,e7a=a7a?E6a:O6a,f7a=a7a?0:P6a-E6a,g7a=x6a.clone().multiplyScalar(a7a?-J6a:J6a).add(g6a),h7a=x6a.clone().multiplyScalar(a7a?-1:1).normalize();for(let i7a=0;i7a<E6a;i7a++){let j7a=i7a*F6a;if(r6a.addVectors(e6a.copy(v6a).multiplyScalar(Z5a*Math.cos(j7a)),f6a.copy(w6a).multiplyScalar(Z5a*Math.sin(j7a))),s6a.copy(r6a).normalize(),a7a||b7a){c6a||(K6a=f7a+i7a,[0,1,2].forEach(a=>{Q6a[3*K6a+a]=g7a.getComponent(a),R6a[3*K6a+a]=h7a.getComponent(a)}),S6a[2*K6a]=+b7a,S6a[2*K6a+1]=i7a/_5a),f6a.copy(s6a).multiplyScalar(I6a),h6a.addVectors(g6a,f6a);for(let k7a=0;k7a<b6a;k7a++){let l7a=k7a*G6a+c7a;t6a.addVectors(e6a.copy(x6a).multiplyScalar(J6a*Math.sin(l7a)),f6a.copy(s6a).multiplyScalar(J6a*Math.cos(l7a))),u6a.copy(t6a).normalize(),f6a.addVectors(h6a,t6a),t6a.normalize(),K6a=e7a+k7a*E6a+i7a,[0,1,2].forEach(a=>{Q6a[3*K6a+a]=f6a.getComponent(a),R6a[3*K6a+a]=u6a.getComponent(a)});let m7a=+a7a+Math.sin(l7a);S6a[2*K6a]=(d7a+J6a*m7a)/Y6a,S6a[2*K6a+1]=i7a/_5a}}f6a.addVectors(g6a,r6a),K6a=N6a+_6a*E6a+i7a,[0,1,2].forEach(a=>{Q6a[3*K6a+a]=f6a.getComponent(a),R6a[3*K6a+a]=s6a.getComponent(a)}),S6a[2*K6a]=(X6a+_6a*W6a)/Y6a,S6a[2*K6a+1]=i7a/_5a}}let n7a=B6a+2*b6a+L6a,[o7a,p7a]=[+c6a,n7a-1];for(let q7a=o7a;q7a<=p7a-1;q7a++){let r7a=c6a&&q7a===p7a-1;for(let s7a=0;s7a<E6a-1;s7a++)j6a=(i6a=q7a*E6a+s7a)+1,k6a=(r7a?s7a:i6a)+E6a,l6a=(r7a?s7a+1:j6a)+E6a,0===q7a?T6a.push(j6a,l6a,k6a):q7a===n7a-2?T6a.push(i6a,j6a,k6a):T6a.push(i6a,j6a,k6a,j6a,l6a,k6a)}this.setIndex(T6a),this.setAttribute("position",new cE(Q6a,3)),this.setAttribute("normal",new cE(R6a,3)),this.setAttribute("uv",new cE(S6a,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let t7a=this.userData.parameters,u7a=Math.ceil(t7a.tubularSegments),v7a=t7a.radialSegments+1,w7a=Array.from(this.getIndex().array),x7a,y7a,z7a,A7a,B7a=6*(u7a-1)*t7a.radialSegments,C7a=u7a,D7a=C7a===u7a;for(let E7a=0;E7a<t7a.radialSegments;E7a++)y7a=(x7a=C7a*v7a+E7a)+1,z7a=(D7a?E7a:x7a)+v7a,A7a=(D7a?E7a+1:y7a)+v7a,w7a[B7a++]=x7a,w7a[B7a++]=y7a,w7a[B7a++]=z7a,w7a[B7a++]=y7a,w7a[B7a++]=A7a,w7a[B7a++]=z7a;return w7a.length=B7a,Q5a.array=w7a,Q5a.count=w7a.length,Q5a}},F7a=class{static create(G7a){return this.build(this.normalizeInputs(G7a))}static normalizeInputs(H7a,I7a){let J7a=Object.assign({},I7a?.parameters??{width:100,detail:0,corner:0,cornerSides:4},H7a.parameters);return{parameters:Object.assign(J7a,{width:Math.abs(J7a.width),height:Math.abs(J7a.height??J7a.width),depth:Math.abs(J7a.depth??J7a.width)})}}static build(K7a){let{width:L7a,height:M7a,depth:N7a,detail:O7a,corner:P7a,cornerSides:Q7a}=K7a.parameters,R7a=0===O7a&&0!==P7a?new S7a(.5*L7a,P7a,Q7a):new y7(.5*L7a,O7a);return R7a.scale(1,M7a/L7a,N7a/L7a),Object.assign(R7a,{userData:{...K7a,type:"IcosahedronGeometry"}})}},S7a=class extends LVa{constructor(T7a=1,U7a=.2,V7a=4){let W7a=(1+Math.sqrt(5))/2,X7a=[-1,W7a,0,1,W7a,0,-1,-W7a,0,1,-W7a,0,0,-1,W7a,0,1,W7a,0,-1,-W7a,0,1,-W7a,W7a,0,-1,W7a,0,1,-W7a,0,-1,-W7a,0,1],Y7a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],Z7a="IcosahedronGeometry";super(X7a,Y7a,Z7a,T7a,U7a,V7a),this.type=Z7a}static fromJSON($7a){return new S7a($7a.radius,$7a.corner,$7a.cornerSides)}},_7a=class{static create(a8a){return this.build(this.normalizeInputs(a8a))}static normalizeInputs(b8a,c8a){(b8a.parameters?.points??[]).forEach(a=>{Array.isArray(a)&&(a.x=a[0],a.y=a[1])});let d8a=Object.assign({},c8a?.parameters??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},b8a.parameters);return{parameters:Object.assign(d8a,{width:Math.abs(d8a.width),height:Math.abs(d8a.height??d8a.width),depth:Math.abs(d8a.depth??d8a.width)})}}static build(e8a){let{points:f8a,segments:g8a,verticalSegments:h8a}=e8a.parameters,i8a=new j6;i8a.moveTo(f8a[0].x,f8a[0].y),i8a.bezierCurveTo(f8a[1].x,f8a[1].y,f8a[2].x,f8a[2].y,f8a[3].x,f8a[3].y);let j8a=new H4(i8a.extractPoints(h8a).shape,g8a);return j8a.rotateZ(Math.PI),Object.assign(j8a,{userData:{...e8a,type:"LatheGeometry"}})}},k8a=new rs,l8a=new Iy,m8a=new fm,n8a=class extends ab{constructor(){super(),this.uuid=Db.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(o8a){let p8a=new Rc().getNormalMatrix(o8a);for(let q8a=0,r8a=this.vertices.length;q8a<r8a;q8a++)this.vertices[q8a].applyMatrix4(o8a);for(let s8a=0,t8a=this.faces.length;s8a<t8a;s8a++){let u8a=this.faces[s8a];u8a.normal.applyMatrix3(p8a).normalize();for(let v8a=0,w8a=u8a.vertexNormals.length;v8a<w8a;v8a++)u8a.vertexNormals[v8a].applyMatrix3(p8a).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(x8a){return k8a.makeRotationX(x8a),this.applyMatrix4(k8a),this}rotateY(y8a){return k8a.makeRotationY(y8a),this.applyMatrix4(k8a),this}rotateZ(z8a){return k8a.makeRotationZ(z8a),this.applyMatrix4(k8a),this}translate(A8a,B8a,C8a){return k8a.makeTranslation(A8a,B8a,C8a),this.applyMatrix4(k8a),this}scale(D8a,E8a,F8a){return k8a.makeScale(D8a,E8a,F8a),this.applyMatrix4(k8a),this}lookAt(G8a){return l8a.lookAt(G8a),l8a.updateMatrix(),this.applyMatrix4(l8a.matrix),this}fromBufferGeometry(H8a){let I8a=this,J8a=null!==H8a.index?H8a.index:void 0,K8a=H8a.attributes;if(void 0===K8a.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let L8a=K8a.position,M8a=K8a.normal,N8a=K8a.color,O8a=K8a.uv,P8a=K8a.uv2;void 0!==P8a&&(this.faceVertexUvs[1]=[]);for(let Q8a=0;Q8a<L8a.count;Q8a++)I8a.vertices.push(new fm().fromBufferAttribute(L8a,Q8a)),void 0!==N8a&&I8a.colors.push(new df().fromBufferAttribute(N8a,Q8a));function R8a(a,b,c,d){let e=void 0===N8a?[]:[I8a.colors[a].clone(),I8a.colors[b].clone(),I8a.colors[c].clone()],f=void 0===M8a?[]:[new fm().fromBufferAttribute(M8a,a),new fm().fromBufferAttribute(M8a,b),new fm().fromBufferAttribute(M8a,c)],g=new aeb(a,b,c,f,e,d);I8a.faces.push(g),void 0!==O8a&&I8a.faceVertexUvs[0].push([new Eb().fromBufferAttribute(O8a,a),new Eb().fromBufferAttribute(O8a,b),new Eb().fromBufferAttribute(O8a,c)]),void 0!==P8a&&I8a.faceVertexUvs[1].push([new Eb().fromBufferAttribute(P8a,a),new Eb().fromBufferAttribute(P8a,b),new Eb().fromBufferAttribute(P8a,c)])}let S8a=H8a.groups;if(S8a.length>0)for(let T8a=0;T8a<S8a.length;T8a++){let U8a=S8a[T8a],V8a=U8a.start,W8a=U8a.count;for(let X8a=V8a,Y8a=V8a+W8a;X8a<Y8a;X8a+=3)void 0!==J8a?R8a(J8a.getX(X8a),J8a.getX(X8a+1),J8a.getX(X8a+2),U8a.materialIndex):R8a(X8a,X8a+1,X8a+2,U8a.materialIndex)}else if(void 0!==J8a)for(let Z8a=0;Z8a<J8a.count;Z8a+=3)R8a(J8a.getX(Z8a),J8a.getX(Z8a+1),J8a.getX(Z8a+2));else for(let $8a=0;$8a<L8a.count;$8a+=3)R8a($8a,$8a+1,$8a+2);return this.computeFaceNormals(),null!==H8a.boundingBox&&(this.boundingBox=H8a.boundingBox.clone()),null!==H8a.boundingSphere&&(this.boundingSphere=H8a.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(m8a).negate(),this.translate(m8a.x,m8a.y,m8a.z),this}normalize(){this.computeBoundingSphere();let _8a=this.boundingSphere.center,a9a=this.boundingSphere.radius,b9a=0===a9a?1:1/a9a,c9a=new rs;return c9a.set(b9a,0,0,-b9a*_8a.x,0,b9a,0,-b9a*_8a.y,0,0,b9a,-b9a*_8a.z,0,0,0,1),this.applyMatrix4(c9a),this}computeFaceNormals(){let d9a=new fm,e9a=new fm;for(let f9a=0,g9a=this.faces.length;f9a<g9a;f9a++){let h9a=this.faces[f9a],i9a=this.vertices[h9a.a],j9a=this.vertices[h9a.b],k9a=this.vertices[h9a.c];d9a.subVectors(k9a,j9a),e9a.subVectors(i9a,j9a),d9a.cross(e9a),d9a.normalize(),h9a.normal.copy(d9a)}}computeVertexNormals(l9a=!0){let m9a=new Array(this.vertices.length);for(let n9a=0,o9a=this.vertices.length;n9a<o9a;n9a++)m9a[n9a]=new fm;if(l9a){let p9a=new fm,q9a=new fm;for(let r9a=0,s9a=this.faces.length;r9a<s9a;r9a++){let t9a=this.faces[r9a],u9a=this.vertices[t9a.a],v9a=this.vertices[t9a.b],w9a=this.vertices[t9a.c];p9a.subVectors(w9a,v9a),q9a.subVectors(u9a,v9a),p9a.cross(q9a),m9a[t9a.a].add(p9a),m9a[t9a.b].add(p9a),m9a[t9a.c].add(p9a)}}else{this.computeFaceNormals();for(let x9a=0,y9a=this.faces.length;x9a<y9a;x9a++){let z9a=this.faces[x9a];m9a[z9a.a].add(z9a.normal),m9a[z9a.b].add(z9a.normal),m9a[z9a.c].add(z9a.normal)}}for(let A9a=0,B9a=this.vertices.length;A9a<B9a;A9a++)m9a[A9a].normalize();for(let C9a=0,D9a=this.faces.length;C9a<D9a;C9a++){let E9a=this.faces[C9a],F9a=E9a.vertexNormals;3===F9a.length?(F9a[0].copy(m9a[E9a.a]),F9a[1].copy(m9a[E9a.b]),F9a[2].copy(m9a[E9a.c])):(F9a[0]=m9a[E9a.a].clone(),F9a[1]=m9a[E9a.b].clone(),F9a[2]=m9a[E9a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let G9a=0,H9a=this.faces.length;G9a<H9a;G9a++){let I9a=this.faces[G9a],J9a=I9a.vertexNormals;3===J9a.length?(J9a[0].copy(I9a.normal),J9a[1].copy(I9a.normal),J9a[2].copy(I9a.normal)):(J9a[0]=I9a.normal.clone(),J9a[1]=I9a.normal.clone(),J9a[2]=I9a.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let K9a=0,L9a=this.faces.length;K9a<L9a;K9a++){let M9a=this.faces[K9a];M9a.__originalFaceNormal?M9a.__originalFaceNormal.copy(M9a.normal):M9a.__originalFaceNormal=M9a.normal.clone(),M9a.__originalVertexNormals||(M9a.__originalVertexNormals=[]);for(let N9a=0,O9a=M9a.vertexNormals.length;N9a<O9a;N9a++)M9a.__originalVertexNormals[N9a]?M9a.__originalVertexNormals[N9a].copy(M9a.vertexNormals[N9a]):M9a.__originalVertexNormals[N9a]=M9a.vertexNormals[N9a].clone()}let P9a=new n8a;P9a.faces=this.faces;for(let Q9a=0,R9a=this.morphTargets.length;Q9a<R9a;Q9a++){if(!this.morphNormals[Q9a]){this.morphNormals[Q9a]={},this.morphNormals[Q9a].faceNormals=[],this.morphNormals[Q9a].vertexNormals=[];let S9a=this.morphNormals[Q9a].faceNormals,T9a=this.morphNormals[Q9a].vertexNormals;for(let U9a=0,V9a=this.faces.length;U9a<V9a;U9a++){let W9a=new fm,X9a={a:new fm,b:new fm,c:new fm};S9a.push(W9a),T9a.push(X9a)}}let Y9a=this.morphNormals[Q9a];P9a.vertices=this.morphTargets[Q9a].vertices,P9a.computeFaceNormals(),P9a.computeVertexNormals();for(let Z9a=0,$9a=this.faces.length;Z9a<$9a;Z9a++){let _9a=this.faces[Z9a],aab=Y9a.faceNormals[Z9a],bab=Y9a.vertexNormals[Z9a];aab.copy(_9a.normal),bab.a.copy(_9a.vertexNormals[0]),bab.b.copy(_9a.vertexNormals[1]),bab.c.copy(_9a.vertexNormals[2])}}for(let cab=0,dab=this.faces.length;cab<dab;cab++){let eab=this.faces[cab];eab.normal=eab.__originalFaceNormal,eab.vertexNormals=eab.__originalVertexNormals}}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Io),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new pq),this.boundingSphere.setFromPoints(this.vertices)}merge(fab,gab,hab=0){if(!(fab&&fab.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",fab);return}let iab,jab=this.vertices.length,kab=this.vertices,lab=fab.vertices,mab=this.faces,nab=fab.faces,oab=this.colors,pab=fab.colors;void 0!==gab&&(iab=new Rc().getNormalMatrix(gab));for(let qab=0,rab=lab.length;qab<rab;qab++){let sab=lab[qab].clone();void 0!==gab&&sab.applyMatrix4(gab),kab.push(sab)}for(let tab=0,uab=pab.length;tab<uab;tab++)oab.push(pab[tab].clone());for(let vab=0,wab=nab.length;vab<wab;vab++){let xab=nab[vab],yab,zab,Aab=xab.vertexNormals,Bab=xab.vertexColors,Cab=new aeb(xab.a+jab,xab.b+jab,xab.c+jab);Cab.normal.copy(xab.normal),void 0!==iab&&Cab.normal.applyMatrix3(iab).normalize();for(let Dab=0,Eab=Aab.length;Dab<Eab;Dab++)yab=Aab[Dab].clone(),void 0!==iab&&yab.applyMatrix3(iab).normalize(),Cab.vertexNormals.push(yab);Cab.color.copy(xab.color);for(let Fab=0,Gab=Bab.length;Fab<Gab;Fab++)zab=Bab[Fab],Cab.vertexColors.push(zab.clone());Cab.materialIndex=xab.materialIndex+hab,mab.push(Cab)}for(let Hab=0,Iab=fab.faceVertexUvs.length;Hab<Iab;Hab++){let Jab=fab.faceVertexUvs[Hab];void 0===this.faceVertexUvs[Hab]&&(this.faceVertexUvs[Hab]=[]);for(let Kab=0,Lab=Jab.length;Kab<Lab;Kab++){let Mab=Jab[Kab],Nab=[];for(let Oab=0,Pab=Mab.length;Oab<Pab;Oab++)Nab.push(Mab[Oab].clone());this.faceVertexUvs[Hab].push(Nab)}}}mergeMesh(Qab){if(!(Qab&&Qab.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",Qab);return}Qab.matrixAutoUpdate&&Qab.updateMatrix(),this.merge(Qab.geometry,Qab.matrix)}mergeVertices(Rab=4){let Sab={},Tab=[],Uab=[],Vab=Math.pow(10,Rab);for(let Wab=0,Xab=this.vertices.length;Wab<Xab;Wab++){let Yab=this.vertices[Wab],Zab=Math.round(Yab.x*Vab)+"_"+Math.round(Yab.y*Vab)+"_"+Math.round(Yab.z*Vab);void 0===Sab[Zab]?(Sab[Zab]=Wab,Tab.push(this.vertices[Wab]),Uab[Wab]=Tab.length-1):Uab[Wab]=Uab[Sab[Zab]]}let $ab=[];for(let _ab=0,abb=this.faces.length;_ab<abb;_ab++){let bbb=this.faces[_ab];bbb.a=Uab[bbb.a],bbb.b=Uab[bbb.b],bbb.c=Uab[bbb.c];let cbb=[bbb.a,bbb.b,bbb.c];for(let dbb=0;dbb<3;dbb++)if(cbb[dbb]===cbb[(dbb+1)%3]){$ab.push(_ab);break}}for(let ebb=$ab.length-1;ebb>=0;ebb--){let fbb=$ab[ebb];this.faces.splice(fbb,1);for(let gbb=0,hbb=this.faceVertexUvs.length;gbb<hbb;gbb++)this.faceVertexUvs[gbb].splice(fbb,1)}let ibb=this.vertices.length-Tab.length;return this.vertices=Tab,ibb}setFromPoints(jbb){this.vertices=[];for(let kbb=0,lbb=jbb.length;kbb<lbb;kbb++){let mbb=jbb[kbb];this.vertices.push(new fm(mbb.x,mbb.y,mbb.z||0))}return this}sortFacesByMaterialIndex(){let nbb=this.faces,obb=nbb.length;for(let pbb=0;pbb<obb;pbb++)nbb[pbb]._id=pbb;nbb.sort(function(a,b){return a.materialIndex-b.materialIndex});let qbb=this.faceVertexUvs[0],rbb=this.faceVertexUvs[1],sbb,tbb;qbb&&qbb.length===obb&&(sbb=[]),rbb&&rbb.length===obb&&(tbb=[]);for(let ubb=0;ubb<obb;ubb++){let vbb=nbb[ubb]._id;sbb&&sbb.push(qbb[vbb]),tbb&&tbb.push(rbb[vbb])}sbb&&(this.faceVertexUvs[0]=sbb),tbb&&(this.faceVertexUvs[1]=tbb)}toJSON(){let wbb={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(wbb.uuid=this.uuid,wbb.type=this.type,""!==this.name&&(wbb.name=this.name),void 0!==this.parameters){let xbb=this.parameters;for(let ybb in xbb)void 0!==xbb[ybb]&&(wbb[ybb]=xbb[ybb]);return wbb}let zbb=[];for(let Abb=0;Abb<this.vertices.length;Abb++){let Bbb=this.vertices[Abb];zbb.push(Bbb.x,Bbb.y,Bbb.z)}let Cbb=[],Dbb=[],Ebb={},Fbb=[],Gbb={},Hbb=[],Ibb={};for(let Jbb=0;Jbb<this.faces.length;Jbb++){let Kbb=this.faces[Jbb],Lbb=!0,Mbb=!1,Nbb=void 0!==this.faceVertexUvs[0][Jbb],Obb=Kbb.normal.length()>0,Pbb=Kbb.vertexNormals.length>0,Qbb=1!==Kbb.color.r||1!==Kbb.color.g||1!==Kbb.color.b,Rbb=Kbb.vertexColors.length>0,Sbb=0;if(Sbb=Wbb(Sbb,0,0),Sbb=Wbb(Sbb,1,Lbb),Sbb=Wbb(Sbb,2,Mbb),Sbb=Wbb(Sbb,3,Nbb),Sbb=Wbb(Sbb,4,Obb),Sbb=Wbb(Sbb,5,Pbb),Sbb=Wbb(Sbb,6,Qbb),Sbb=Wbb(Sbb,7,Rbb),Cbb.push(Sbb),Cbb.push(Kbb.a,Kbb.b,Kbb.c),Cbb.push(Kbb.materialIndex),Nbb){let Tbb=this.faceVertexUvs[0][Jbb];Cbb.push(Zbb(Tbb[0]),Zbb(Tbb[1]),Zbb(Tbb[2]))}if(Obb&&Cbb.push(Xbb(Kbb.normal)),Pbb){let Ubb=Kbb.vertexNormals;Cbb.push(Xbb(Ubb[0]),Xbb(Ubb[1]),Xbb(Ubb[2]))}if(Qbb&&Cbb.push(Ybb(Kbb.color)),Rbb){let Vbb=Kbb.vertexColors;Cbb.push(Ybb(Vbb[0]),Ybb(Vbb[1]),Ybb(Vbb[2]))}}function Wbb(a,b,c){return c?a|1<<b:a& ~(1<<b)}function Xbb(a){let b=a.x.toString()+a.y.toString()+a.z.toString();return void 0!==Ebb[b]||(Ebb[b]=Dbb.length/3,Dbb.push(a.x,a.y,a.z)),Ebb[b]}function Ybb(a){let b=a.r.toString()+a.g.toString()+a.b.toString();return void 0!==Gbb[b]||(Gbb[b]=Fbb.length,Fbb.push(a.getHex())),Gbb[b]}function Zbb(a){let b=a.x.toString()+a.y.toString();return void 0!==Ibb[b]||(Ibb[b]=Hbb.length/2,Hbb.push(a.x,a.y)),Ibb[b]}return wbb.data={},wbb.data.vertices=zbb,wbb.data.normals=Dbb,Fbb.length>0&&(wbb.data.colors=Fbb),Hbb.length>0&&(wbb.data.uvs=[Hbb]),wbb.data.faces=Cbb,wbb}clone(){return new n8a().copy(this)}copy($bb){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=$bb.name;let _bb=$bb.vertices;for(let acb=0,bcb=_bb.length;acb<bcb;acb++)this.vertices.push(_bb[acb].clone());let ccb=$bb.colors;for(let dcb=0,ecb=ccb.length;dcb<ecb;dcb++)this.colors.push(ccb[dcb].clone());let fcb=$bb.faces;for(let gcb=0,hcb=fcb.length;gcb<hcb;gcb++)this.faces.push(fcb[gcb].clone());for(let icb=0,jcb=$bb.faceVertexUvs.length;icb<jcb;icb++){let kcb=$bb.faceVertexUvs[icb];void 0===this.faceVertexUvs[icb]&&(this.faceVertexUvs[icb]=[]);for(let lcb=0,mcb=kcb.length;lcb<mcb;lcb++){let ncb=kcb[lcb],ocb=[];for(let pcb=0,qcb=ncb.length;pcb<qcb;pcb++){let rcb=ncb[pcb];ocb.push(rcb.clone())}this.faceVertexUvs[icb].push(ocb)}}let scb=$bb.morphTargets;for(let tcb=0,ucb=scb.length;tcb<ucb;tcb++){let vcb={};if(vcb.name=scb[tcb].name,void 0!==scb[tcb].vertices){vcb.vertices=[];for(let wcb=0,xcb=scb[tcb].vertices.length;wcb<xcb;wcb++)vcb.vertices.push(scb[tcb].vertices[wcb].clone())}if(void 0!==scb[tcb].normals){vcb.normals=[];for(let ycb=0,zcb=scb[tcb].normals.length;ycb<zcb;ycb++)vcb.normals.push(scb[tcb].normals[ycb].clone())}this.morphTargets.push(vcb)}let Acb=$bb.morphNormals;for(let Bcb=0,Ccb=Acb.length;Bcb<Ccb;Bcb++){let Dcb={};if(void 0!==Acb[Bcb].vertexNormals){Dcb.vertexNormals=[];for(let Ecb=0,Fcb=Acb[Bcb].vertexNormals.length;Ecb<Fcb;Ecb++){let Gcb=Acb[Bcb].vertexNormals[Ecb],Hcb={};Hcb.a=Gcb.a.clone(),Hcb.b=Gcb.b.clone(),Hcb.c=Gcb.c.clone(),Dcb.vertexNormals.push(Hcb)}}if(void 0!==Acb[Bcb].faceNormals){Dcb.faceNormals=[];for(let Icb=0,Jcb=Acb[Bcb].faceNormals.length;Icb<Jcb;Icb++)Dcb.faceNormals.push(Acb[Bcb].faceNormals[Icb].clone())}this.morphNormals.push(Dcb)}let Kcb=$bb.skinWeights;for(let Lcb=0,Mcb=Kcb.length;Lcb<Mcb;Lcb++)this.skinWeights.push(Kcb[Lcb].clone());let Ncb=$bb.skinIndices;for(let Ocb=0,Pcb=Ncb.length;Ocb<Pcb;Ocb++)this.skinIndices.push(Ncb[Ocb].clone());let Qcb=$bb.lineDistances;for(let Rcb=0,Scb=Qcb.length;Rcb<Scb;Rcb++)this.lineDistances.push(Qcb[Rcb]);let Tcb=$bb.boundingBox;null!==Tcb&&(this.boundingBox=Tcb.clone());let Ucb=$bb.boundingSphere;return null!==Ucb&&(this.boundingSphere=Ucb.clone()),this.elementsNeedUpdate=$bb.elementsNeedUpdate,this.verticesNeedUpdate=$bb.verticesNeedUpdate,this.uvsNeedUpdate=$bb.uvsNeedUpdate,this.normalsNeedUpdate=$bb.normalsNeedUpdate,this.colorsNeedUpdate=$bb.colorsNeedUpdate,this.lineDistancesNeedUpdate=$bb.lineDistancesNeedUpdate,this.groupsNeedUpdate=$bb.groupsNeedUpdate,this}toBufferGeometry(){let Vcb=new qdb().fromGeometry(this),Wcb=new nE,Xcb=new Float32Array(3*Vcb.vertices.length);if(Wcb.setAttribute("position",peb.call(new RC(Xcb,3),Vcb.vertices)),Vcb.normals.length>0){let Ycb=new Float32Array(3*Vcb.normals.length);Wcb.setAttribute("normal",peb.call(new RC(Ycb,3),Vcb.normals))}if(Vcb.colors.length>0){let Zcb=new Float32Array(3*Vcb.colors.length);Wcb.setAttribute("color",neb.call(new RC(Zcb,3),Vcb.colors))}if(Vcb.uvs.length>0){let $cb=new Float32Array(2*Vcb.uvs.length);Wcb.setAttribute("uv",oeb.call(new RC($cb,2),Vcb.uvs))}if(Vcb.uvs2.length>0){let _cb=new Float32Array(2*Vcb.uvs2.length);Wcb.setAttribute("uv2",oeb.call(new RC(_cb,2),Vcb.uvs2))}for(let adb in Wcb.groups=Vcb.groups,Vcb.morphTargets){let bdb=[],cdb=Vcb.morphTargets[adb];for(let ddb=0,edb=cdb.length;ddb<edb;ddb++){let fdb=cdb[ddb],gdb=new cE(3*fdb.data.length,3);gdb.name=fdb.name,bdb.push(peb.call(gdb,fdb.data))}Wcb.morphAttributes[adb]=bdb}if(Vcb.skinIndices.length>0){let hdb=new cE(4*Vcb.skinIndices.length,4);Wcb.setAttribute("skinIndex",qeb.call(hdb,Vcb.skinIndices))}if(Vcb.skinWeights.length>0){let idb=new cE(4*Vcb.skinWeights.length,4);Wcb.setAttribute("skinWeight",qeb.call(idb,Vcb.skinWeights))}return null!==Vcb.boundingSphere&&(Wcb.boundingSphere=Vcb.boundingSphere.clone()),null!==Vcb.boundingBox&&(Wcb.boundingBox=Vcb.boundingBox.clone()),Wcb}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(jdb){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(jdb)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(kdb){let ldb=new nE,mdb=kdb.geometry;if(kdb.isPoints||kdb.isLine){let ndb=new cE(3*mdb.vertices.length,3),odb=new cE(3*mdb.colors.length,3);if(ldb.setAttribute("position",peb.call(ndb,mdb.vertices)),ldb.setAttribute("color",neb.call(odb,mdb.colors)),mdb.lineDistances&&mdb.lineDistances.length===mdb.vertices.length){let pdb=new cE(mdb.lineDistances.length,1);ldb.setAttribute("lineDistance",meb.call(pdb,mdb.lineDistances))}null!==mdb.boundingSphere&&(ldb.boundingSphere=mdb.boundingSphere.clone()),null!==mdb.boundingBox&&(ldb.boundingBox=mdb.boundingBox.clone())}else kdb.isMesh&&(ldb=mdb.toBufferGeometry());return ldb}};n8a.prototype.isGeometry=!0;var qdb=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(rdb){let sdb=[],tdb,udb,vdb,wdb=rdb.faces;for(udb=0;udb<wdb.length;udb++){let xdb=wdb[udb];xdb.materialIndex!==vdb&&(vdb=xdb.materialIndex,void 0!==tdb&&(tdb.count=3*udb-tdb.start,sdb.push(tdb)),tdb={start:3*udb,materialIndex:vdb})}void 0!==tdb&&(tdb.count=3*udb-tdb.start,sdb.push(tdb)),this.groups=sdb}fromGeometry(ydb){let zdb=ydb.faces,Adb=ydb.vertices,Bdb=ydb.faceVertexUvs,Cdb=Bdb[0]&&Bdb[0].length>0,Ddb=Bdb[1]&&Bdb[1].length>0,Edb=ydb.morphTargets,Fdb=Edb.length,Gdb;if(Fdb>0){Gdb=[];for(let Hdb=0;Hdb<Fdb;Hdb++)Gdb[Hdb]={name:Edb[Hdb].name,data:[]};this.morphTargets.position=Gdb}let Idb=ydb.morphNormals,Jdb=Idb.length,Kdb;if(Jdb>0){Kdb=[];for(let Ldb=0;Ldb<Jdb;Ldb++)Kdb[Ldb]={name:Idb[Ldb].name,data:[]};this.morphTargets.normal=Kdb}let Mdb=ydb.skinIndices,Ndb=ydb.skinWeights,Odb=Mdb.length===Adb.length,Pdb=Ndb.length===Adb.length;Adb.length>0&&0===zdb.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let Qdb=0;Qdb<zdb.length;Qdb++){let Rdb=zdb[Qdb];this.vertices.push(Adb[Rdb.a],Adb[Rdb.b],Adb[Rdb.c]);let Sdb=Rdb.vertexNormals;if(3===Sdb.length)this.normals.push(Sdb[0],Sdb[1],Sdb[2]);else{let Tdb=Rdb.normal;this.normals.push(Tdb,Tdb,Tdb)}let Udb=Rdb.vertexColors;if(3===Udb.length)this.colors.push(Udb[0],Udb[1],Udb[2]);else{let Vdb=Rdb.color;this.colors.push(Vdb,Vdb,Vdb)}if(!0===Cdb){let Wdb=Bdb[0][Qdb];void 0!==Wdb?this.uvs.push(Wdb[0],Wdb[1],Wdb[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",Qdb),this.uvs.push(new Eb,new Eb,new Eb))}if(!0===Ddb){let Xdb=Bdb[1][Qdb];void 0!==Xdb?this.uvs2.push(Xdb[0],Xdb[1],Xdb[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",Qdb),this.uvs2.push(new Eb,new Eb,new Eb))}for(let Ydb=0;Ydb<Fdb;Ydb++){let Zdb=Edb[Ydb].vertices;Gdb[Ydb].data.push(Zdb[Rdb.a],Zdb[Rdb.b],Zdb[Rdb.c])}for(let $db=0;$db<Jdb;$db++){let _db=Idb[$db].vertexNormals[Qdb];Kdb[$db].data.push(_db.a,_db.b,_db.c)}Odb&&this.skinIndices.push(Mdb[Rdb.a],Mdb[Rdb.b],Mdb[Rdb.c]),Pdb&&this.skinWeights.push(Ndb[Rdb.a],Ndb[Rdb.b],Ndb[Rdb.c])}return this.computeGroups(ydb),this.verticesNeedUpdate=ydb.verticesNeedUpdate,this.normalsNeedUpdate=ydb.normalsNeedUpdate,this.colorsNeedUpdate=ydb.colorsNeedUpdate,this.uvsNeedUpdate=ydb.uvsNeedUpdate,this.groupsNeedUpdate=ydb.groupsNeedUpdate,null!==ydb.boundingSphere&&(this.boundingSphere=ydb.boundingSphere.clone()),null!==ydb.boundingBox&&(this.boundingBox=ydb.boundingBox.clone()),this}},aeb=class{constructor(beb,ceb,deb,eeb,feb,geb=0){this.a=beb,this.b=ceb,this.c=deb,this.normal=eeb&&eeb.isVector3?eeb:new fm,this.vertexNormals=Array.isArray(eeb)?eeb:[],this.color=feb&&feb.isColor?feb:new df,this.vertexColors=Array.isArray(feb)?feb:[],this.materialIndex=geb}clone(){return new this.constructor().copy(this)}copy(heb){this.a=heb.a,this.b=heb.b,this.c=heb.c,this.normal.copy(heb.normal),this.color.copy(heb.color),this.materialIndex=heb.materialIndex;for(let ieb=0,jeb=heb.vertexNormals.length;ieb<jeb;ieb++)this.vertexNormals[ieb]=heb.vertexNormals[ieb].clone();for(let keb=0,leb=heb.vertexColors.length;keb<leb;keb++)this.vertexColors[keb]=heb.vertexColors[keb].clone();return this}};function meb(a){return this.array.set(a),this}function neb(a){let b=this.array,c=0;for(let d=0,e=a.length;d<e;d++){let f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",d),f=new df),b[c++]=f.r,b[c++]=f.g,b[c++]=f.b}return this}function oeb(a){let b=this.array,c=0;for(let d=0,e=a.length;d<e;d++){let f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",d),f=new Eb),b[c++]=f.x,b[c++]=f.y}return this}function peb(a){let b=this.array,c=0;for(let d=0,e=a.length;d<e;d++){let f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",d),f=new fm),b[c++]=f.x,b[c++]=f.y,b[c++]=f.z}return this}function qeb(a){let b=this.array,c=0;for(let d=0,e=a.length;d<e;d++){let f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",d),f=new sh),b[c++]=f.x,b[c++]=f.y,b[c++]=f.z,b[c++]=f.w}return this}var reb=["a","b","c"];function seb(a,b){switch(b){case"c":return a.c;case"b":return a.b;case"a":default:return a.a}}function teb(a,b,c){let d=Math.min(a,b),e=Math.max(a,b),f=d+"_"+e;return c.get(f)}function ueb(a,b,c,d,e,f){let g=Math.min(a,b),h=Math.max(a,b),i=g+"_"+h,j;if(d.has(i))j=d.get(i);else{let k=c[g],l=c[h];j={a:k,b:l,newEdge:null,faces:[]},d.set(i,j)}j.faces.push(e),f[a].edges.push(j),f[b].edges.push(j)}function veb(a,b,c,d,e){a.push(new aeb(b,c,d,void 0,void 0,e))}function web(a,b){return Math.abs(b-a)/2+Math.min(a,b)}function xeb(a,b,c,d){a.push([b.clone(),c.clone(),d.clone()])}var yeb=class{constructor(zeb=1){this.subdivisions=zeb}modify(Aeb){(Aeb=Aeb instanceof nE?new n8a().fromBufferGeometry(Aeb):Aeb.clone()).mergeVertices();let Beb=this.subdivisions;for(;Beb-- >0;)this._smooth(Aeb);return Aeb.computeFaceNormals(),Aeb.computeVertexNormals(),Aeb}_smooth(Ceb){let Deb=new fm,Eeb,Feb,Geb,Heb,Ieb,Jeb=Ceb.vertices,Keb=Ceb.faces,Leb=Ceb.faceVertexUvs[0],Meb=void 0!==Leb&&Leb.length>0,Neb=[],Oeb=new Map;!function(a,b,c,d){let e,f,g;for(e=0,f=a.length;e<f;e++)c[e]={edges:[]};for(e=0,f=b.length;e<f;e++)ueb((g=b[e]).a,g.b,a,d,g,c),ueb(g.b,g.c,a,d,g,c),ueb(g.c,g.a,a,d,g,c)}(Jeb,Keb,Neb,Oeb);let Peb=[],Qeb,Reb,Seb,Teb,Ueb,Veb,Web;for(let Xeb of Array.from(Oeb.keys())){for(Reb=Oeb.get(Xeb),Seb=new fm,Ueb=3/8,Veb=1/8,2!=(Web=Reb.faces.length)&&(Ueb=.5,Veb=0,1!=Web),Seb.addVectors(Reb.a,Reb.b).multiplyScalar(Ueb),Deb.set(0,0,0),Heb=0;Heb<Web;Heb++){for(Teb=Reb.faces[Heb],Ieb=0;Ieb<3&&!((Qeb=Jeb[seb(Teb,reb[Ieb])])!==Reb.a&&Qeb!==Reb.b);Ieb++);Qeb&&Deb.add(Qeb)}Deb.multiplyScalar(Veb),Seb.add(Deb),Reb.newEdge=Peb.length,Peb.push(Seb)}let Yeb,Zeb,$eb,_eb,afb,bfb,cfb,dfb=[];for(Feb=0,Geb=Jeb.length;Feb<Geb;Feb++){for(bfb=Jeb[Feb],afb=Neb[Feb].edges,Eeb=afb.length,3==Eeb?Yeb=3/16:Eeb>3&&(Yeb=3/(8*Eeb)),Zeb=1-Eeb*Number(Yeb),$eb=Yeb,Eeb<=2&&2==Eeb&&(Zeb=3/4,$eb=1/8),cfb=bfb.clone().multiplyScalar(Zeb),Deb.set(0,0,0),Heb=0;Heb<Eeb;Heb++)Qeb=(_eb=afb[Heb]).a!==bfb?_eb.a:_eb.b,Deb.add(Qeb);Deb.multiplyScalar(Number($eb)),cfb.add(Deb),dfb.push(cfb)}let efb=dfb.concat(Peb),ffb=dfb.length,gfb,hfb,ifb,jfb=[],kfb=[],lfb,mfb,nfb,ofb,pfb=new Eb,qfb=new Eb,rfb=new Eb;for(Feb=0,Geb=Keb.length;Feb<Geb;Feb++)gfb=Number(teb((Teb=Keb[Feb]).a,Teb.b,Oeb).newEdge)+ffb,hfb=Number(teb(Teb.b,Teb.c,Oeb).newEdge)+ffb,ifb=Number(teb(Teb.c,Teb.a,Oeb).newEdge)+ffb,veb(jfb,gfb,hfb,ifb,Teb.materialIndex),veb(jfb,Teb.a,gfb,ifb,Teb.materialIndex),veb(jfb,Teb.b,hfb,gfb,Teb.materialIndex),veb(jfb,Teb.c,ifb,hfb,Teb.materialIndex),Meb&&(mfb=(lfb=Leb[Feb])[0],nfb=lfb[1],ofb=lfb[2],pfb.set(web(mfb.x,nfb.x),web(mfb.y,nfb.y)),qfb.set(web(nfb.x,ofb.x),web(nfb.y,ofb.y)),rfb.set(web(mfb.x,ofb.x),web(mfb.y,ofb.y)),xeb(kfb,pfb,qfb,rfb),xeb(kfb,mfb,pfb,rfb),xeb(kfb,nfb,qfb,pfb),xeb(kfb,ofb,rfb,qfb));Ceb.vertices=efb,Ceb.faces=jfb,Meb&&(Ceb.faceVertexUvs[0]=kfb)}},sfb=new fm,tfb=class{static create(ufb){return this.build(this.normalizeInputs(ufb))}static normalizeInputs(vfb,wfb){let xfb=(vfb.geometry??wfb?.geometry)??new nE().copy(new XI(100,100,100)),yfb;void 0===wfb?(xfb.computeBoundingBox(),xfb.boundingBox.getSize(sfb),yfb={width:sfb.x,height:sfb.y,depth:sfb.z,subdivisions:0}):yfb=wfb.parameters;let zfb={...yfb,...vfb.parameters};return{parameters:{width:Math.abs(zfb.width),height:Math.abs(zfb.height),depth:Math.abs(zfb.depth),subdivisions:Math.abs(zfb.subdivisions)},geometry:xfb}}static build(Afb){let{width:Bfb,height:Cfb,depth:Dfb,subdivisions:Efb}=Afb.parameters,Ffb=Afb.geometry??new nE().copy(new XI(100,100,100)),Gfb=Ffb.userData.parameters;void 0===Gfb?(Ffb.computeBoundingBox(),Ffb.boundingBox.getSize(sfb)):sfb.set(Gfb.width,Gfb.height,Gfb.depth),(Bfb!==sfb.x||Cfb!==sfb.y||Dfb!==sfb.z)&&Ffb.scale(0===sfb.x?1:Bfb/sfb.x,0===sfb.y?1:Cfb/sfb.y,0===sfb.z?1:Dfb/sfb.z);let Hfb=Ffb.originalGeometry;try{Efb>0?(void 0===Hfb||Gfb?.subdivisions!==Efb)&&(void 0===Hfb&&(Hfb=Ffb),Ffb=new yeb(Efb).modify(Hfb).toBufferGeometry()):(void 0!==Hfb&&(Ffb=Hfb),Hfb=void 0,void 0===Ffb.getAttribute("normal")&&Ffb.computeVertexNormals())}catch{void 0!==Hfb&&(Ffb=Hfb),Hfb=void 0,void 0===Ffb.getAttribute("normal")&&Ffb.computeVertexNormals()}return void 0!==Hfb&&Object.assign(Ffb,{originalGeometry:Hfb}),delete Afb.geometry,Object.assign(Ffb,{userData:{...Afb,type:"NonParametricGeometry"}})}static loadFromUrl(Ifb,Jfb,Kfb){new aga(Kfb).load(Ifb,a=>{let b=this.normalizeInputs({geometry:a});a.boundingBox.getSize(sfb);let c=100/sfb.x;Object.assign(b.parameters,{width:100,height:sfb.y*c,depth:sfb.z*c}),Jfb(this.build(b))})}},Lfb=class{static create(Mfb){return this.build(this.normalizeInputs(Mfb))}static normalizeInputs(Nfb,Ofb){let Pfb=Object.assign({},Ofb?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},Nfb.parameters);return{shape:Nfb.shape&&Nfb.shape instanceof yXa?Nfb.shape:new yXa,parameters:Object.assign(Pfb,{width:Math.abs(Pfb.width),height:Math.abs(Pfb.height??Pfb.width),depth:Math.abs(Pfb.depth??0)})}}static build(Qfb){let{width:Rfb,height:Sfb,spikes:Tfb,cornerRadius:Ufb,depth:Vfb,extrudeBevelSize:Wfb,extrudeBevelSegments:Xfb}=Qfb.parameters,Yfb=Qfb.shape,Zfb=.5*Rfb,$fb=.5*Sfb,_fb=0,agb=0,bgb=2*Math.PI/Tfb;for(let cgb=0;cgb<Tfb;cgb++){let dgb=bgb*cgb,egb=_fb+Math.sin(dgb)*Zfb,fgb=agb+Math.cos(dgb)*$fb;Yfb.addPoint(Yfb.createPoint(egb,fgb))}Yfb.isClosed=!0;for(let ggb=0,hgb=Yfb.points.length;ggb<hgb;ggb++)Yfb.points[ggb].roundness=Ufb;Yfb.roundness=Ufb,Yfb.update();let igb=C4a.create({shape:Yfb,parameters:{roundness:Ufb,depth:Vfb,extrudeBevelSize:Wfb,extrudeBevelSegments:Xfb}});return Object.assign(igb,{userData:{...Qfb,type:"PolygonGeometry"}})}},jgb=class{static create(kgb){return this.build(this.normalizeInputs(kgb))}static normalizeInputs(lgb,mgb){let ngb=Object.assign({},mgb?.parameters??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},lgb.parameters);return{parameters:Object.assign(ngb,{width:Math.abs(ngb.width),height:Math.abs(ngb.height??ngb.width),depth:Math.abs(ngb.depth??ngb.width)})}}static build(ogb){let{width:pgb,height:qgb,depth:rgb,radialSegments:sgb,heightSegments:tgb,openEnded:ugb,cornerRadius:vgb,cornerSegments:wgb}=ogb.parameters,xgb=new Bgb(.5*pgb,qgb,sgb,tgb,ugb,vgb,wgb);return xgb.scale(1,1,rgb/pgb),Object.assign(xgb,{userData:{...ogb,type:"PyramidGeometry"}})}};function ygb(a,b,c){c.x=a.x*b.x,c.y=a.y,c.z=a.x*b.y}function zgb(a,b,c,d,e,f){let g=b.clone().sub(a),h=c.clone().sub(a),i=g.angleTo(h);if(g.normalize(),h.normalize(),d===e){let j=g.add(h).normalize();f.copy(a).addScaledVector(j,d/Math.sin(i/2))}else{let k=g.angleTo(h);f.copy(a),f.addScaledVector(g,e/Math.sin(k)),f.addScaledVector(h,d/Math.sin(k))}}function Agb(a,b,c){let d=a.clone().sub(b),e=c.clone().sub(b);return d.projectOnVector(e),d.add(b)}var Bgb=class extends nE{constructor(Cgb=.5,Dgb=1,Egb=4,Fgb=1,Ggb=!1,Hgb=0,Igb=4){super(),Egb=Math.floor(Math.max(3,Egb)),Fgb=Math.floor(Fgb),Igb=Math.floor(Igb);let Jgb=[],Kgb=[],Lgb=[],Mgb=[],Ngb=0,Ogb=Dgb/2,Pgb=Math.PI/Egb,Qgb=Cgb*Math.cos(Math.PI/Egb),Rgb=2*Math.PI/Egb,Sgb=(Egb-2)*Math.PI/Egb,Tgb=Math.PI-Sgb,Ugb=new fm(0,-Ogb,0),Vgb=new fm(0,Ogb,0),Wgb=new Eb(Cgb,-Ogb),Xgb=new Eb(Qgb,-Ogb),Ygb=new Eb(0,Vgb.y).sub(Xgb),Zgb=new Eb(0,Vgb.y).sub(Wgb),$gb=new Eb(Ygb.y,-Ygb.x).normalize(),_gb=new Eb(Zgb.y,-Zgb.x).normalize(),ahb=Cgb*Math.cos(Math.PI/Egb)*Math.tan((Math.PI-Ygb.angle())/2)-1e-8;Hgb=Math.min(Hgb,ahb);let bhb;{let chb=new fm($gb.x,$gb.y,0),dhb=new fm(Math.cos(Rgb)*chb.x,chb.y,Math.sin(Rgb)*chb.x);bhb=chb.angleTo(dhb)}let ehb=Hgb/Math.tan((Math.PI-Ygb.angle())/2),fhb=Hgb/Math.tan((Math.PI-bhb)/2),ghb=new fm;if(!Ggb){Kgb.push(Ugb.x,Ugb.y,Ugb.z),Lgb.push(0,-1,0),Mgb.push(0,0);let hhb=Ngb++,ihb=[],jhb=Wgb.clone(),khb=ehb/Math.cos(Math.PI/Egb);jhb.x-=khb;for(let lhb=0;lhb<Egb;lhb++){let mhb=lhb/Egb*Math.PI*2+Pgb;ygb(jhb,new Eb(Math.sin(mhb),Math.cos(mhb)),ghb),Kgb.push(ghb.x,ghb.y,ghb.z),Lgb.push(0,-1,0),Mgb.push(0,0),ihb.push(Ngb++)}for(let nhb=0;nhb<ihb.length;nhb++)Jgb.push(ihb[nhb],hhb,ihb[(nhb+1)%ihb.length])}let ohb=[];{let phb=new fm,qhb=new fm,rhb=new fm,shb=new fm,thb=new fm,uhb=new fm;for(let vhb=0;vhb<Egb;vhb++){let whb=vhb/Egb*Math.PI*2+Pgb,xhb=(vhb+.5)/Egb*Math.PI*2+Pgb,yhb=(vhb+1)/Egb*Math.PI*2+Pgb,zhb=new Eb(Math.sin(whb),Math.cos(whb)),Ahb=new Eb(Math.sin(xhb),Math.cos(xhb)),Bhb=new Eb(Math.sin(yhb),Math.cos(yhb));ygb(Wgb,zhb,qhb),ygb(Wgb,Bhb,rhb),ygb($gb,Ahb,phb),zgb(Vgb,qhb,rhb,fhb,fhb,shb),Kgb.push(shb.x,shb.y,shb.z),zgb(qhb,Vgb,rhb,fhb,ehb,thb),Kgb.push(thb.x,thb.y,thb.z),zgb(rhb,qhb,Vgb,ehb,fhb,uhb),Kgb.push(uhb.x,uhb.y,uhb.z),Lgb.push(phb.x,phb.y,phb.z),Lgb.push(phb.x,phb.y,phb.z),Lgb.push(phb.x,phb.y,phb.z),Mgb.push(0,0),Mgb.push(0,0),Mgb.push(0,0);let Chb=Ngb++,Dhb=Ngb++,Ehb=Ngb++;if(Jgb.push(Chb,Dhb,Ehb),Hgb>0){{let Fhb=qhb.clone().add(rhb).multiplyScalar(.5),Ghb=Vgb.clone().sub(Fhb).normalize(),Hhb=Ugb.clone().sub(Fhb).normalize().add(Ghb).normalize().multiplyScalar(-1);jib(Fhb,uhb.clone().sub(thb),Hhb,Ygb.angle())}let Ihb,Jhb;{let Khb=new fm;ygb(_gb,Bhb,Khb);let Lhb=uhb.clone().add(shb).multiplyScalar(.5);Lhb=Agb(Lhb,rhb,Vgb);let Mhb=uhb.clone().sub(shb);[Ihb,Jhb]=jib(Lhb,Mhb,Khb,bhb,shb.y)}{let Nhb=Ihb,Ohb=Nhb.clone().setY(0).normalize(),Phb=new fm(0,-1,0),Qhb=Ohb.clone().cross(Phb);kib(Nhb,Ohb,Phb,Qhb)}ohb.concat(Jhb);{let Rhb=Ygb.angle(),Shb=Math.PI-Rhb,Thb=Vgb.clone();Thb.y-=Hgb/Math.sin(Rhb-Math.PI/2);let Uhb=new fm,Vhb=[];for(let Whb=0;Whb<Igb;Whb++){let Xhb=[],Yhb=Math.PI/2-Shb*Whb/Igb,Zhb=Math.cos(Yhb),$hb=Math.sin(Yhb),_hb=xhb;for(let aib=0;aib<=Whb;aib++){let bib=Math.cos(_hb),cib=Math.sin(_hb);phb.x=Zhb*cib,phb.y=$hb,phb.z=Zhb*bib,Uhb.copy(Thb).addScaledVector(phb,Hgb),Kgb.push(Uhb.x,Uhb.y,Uhb.z),Lgb.push(phb.x,phb.y,phb.z),Mgb.push(0,0),Xhb.push(Ngb++),_hb+=2*Math.PI/Whb/Egb}Vhb.push(Xhb)}Jhb.reverse(),Vhb.push(Jhb);let dib=Vhb.length-1;for(let eib=0;eib<dib;eib++){let fib=Vhb[eib],gib=Vhb[eib+1],hib=fib.length-1;Jgb.push(gib[1],fib[0],gib[0]);for(let iib=1;iib<=hib;iib++)Jgb.push(fib[iib],fib[iib-1],gib[iib]),Jgb.push(gib[iib+1],fib[iib],gib[iib])}}}}}function jib(a,b,c,d,e){let f=-d/2,g=(Math.PI-d)/2,h=b.clone().normalize().cross(c);a.addScaledVector(c,-Hgb/Math.sin(g));let i=new fm,j=new fm,k=1,l=Ngb,m=[];for(let n=0;n<=Igb;n++){let o=f+n/Igb*d;j.set(0,0,0),j.addScaledVector(h,Math.sin(o)),j.addScaledVector(c,Math.cos(o));for(let p=0;p<=k;p++){let q=p/k-.5;if(i.copy(a),i.addScaledVector(b,q),i.addScaledVector(j,Hgb),null!=e){let r=Math.max(0,i.y-e);i.addScaledVector(b,-r/b.y)}Kgb.push(i.x,i.y,i.z),Lgb.push(j.x,j.y,j.z),Mgb.push(0,0),0===p&&m.push(Ngb),Ngb++}}for(let s=0;s<Igb;s++)for(let t=0;t<k;t++){let u=l+t+(k+1)*s,v=u+(k+1),w=v+1,x=u+1;Jgb.push(u,v,x),Jgb.push(v,w,x)}return[a.clone().addScaledVector(b,.5),m]}function kib(a,b,c,d){let e=Math.PI/2,f=Zgb.angle()-e,g=[],h=new fm,i=new fm;for(let j=0;j<=Igb;j++){let k=[],l=j/Igb;for(let m=0;m<=j;m++){let n=((j?m/j:0)-.5)*Tgb,o=Math.cos(n),p=Math.sin(n),q=Math.atan(Math.tan(f)*o),r=(e+q)*l,s=Math.cos(r),t=Math.sin(r);h.set(0,0,0),h.addScaledVector(b,t*o),h.addScaledVector(c,s),h.addScaledVector(d,t*p),i.copy(a).addScaledVector(h,Hgb),Kgb.push(i.x,i.y,i.z),Lgb.push(h.x,h.y,h.z),Mgb.push(0,0),k.push(Ngb++)}g.push(k)}let u=g.length-1;for(let v=0;v<u;v++){let w=g[v],x=g[v+1],y=w.length-1;Jgb.push(w[0],x[1],x[0]);for(let z=1;z<=y;z++)Jgb.push(w[z-1],w[z],x[z]),Jgb.push(w[z],x[z+1],x[z])}}this.setIndex(Jgb),this.setAttribute("position",new cE(Kgb,3)),this.setAttribute("normal",new cE(Lgb,3)),this.setAttribute("uv",new cE(Mgb,2))}},lib=class{static create(mib){return this.build(this.normalizeInputs(mib))}static normalizeInputs(nib,oib){let pib=Object.assign({},oib?.parameters??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},nib.parameters),qib=Object.assign(oib?.ui??{enabledIndieCorners:!1},nib.ui);return{shape:nib.shape&&nib.shape instanceof yXa?nib.shape:new yXa,parameters:Object.assign(pib,{width:Math.abs(pib.width),height:Math.abs(pib.height??pib.width),depth:Math.abs(pib.depth??0)}),ui:qib}}static build(rib){let sib=rib.shape,{width:tib,height:uib,cornerRadius:vib,cornerType:wib,depth:xib,extrudeBevelSize:yib,extrudeBevelSegments:zib}=rib.parameters,Aib={x:.5*tib,y:.5*uib},Bib={x:-Aib.x,y:-Aib.y},Cib={x:Aib.x,y:Aib.y};function Dib(a,b,c){return b>tib&&c>uib?Math.min(a*tib/b,a*uib/c):b>tib?a*tib/b:c>uib?a*uib/c:a}let Eib=[];Eib[0]=0===vib[0]?0:Dib(vib[0],vib[0]+vib[3],vib[0]+vib[1]),Eib[1]=0===vib[1]?0:Dib(vib[1],vib[1]+vib[2],vib[1]+vib[0]),Eib[2]=0===vib[2]?0:Dib(vib[2],vib[2]+vib[1],vib[2]+vib[3]),Eib[3]=0===vib[3]?0:Dib(vib[3],vib[3]+vib[0],vib[3]+vib[2]);let Fib=Bib.x,Gib=Cib.x,Hib=Cib.y,Iib=Bib.y;sib.addPoint(sib.createPoint(Fib,Hib)),sib.addPoint(sib.createPoint(Gib,Hib)),sib.addPoint(sib.createPoint(Gib,Iib)),sib.addPoint(sib.createPoint(Fib,Iib)),sib.isClosed=!0;let Jib=!0;for(let Kib=0,Lib=sib.points.length;Kib<Lib;Kib++)sib.points[Kib].roundness=Eib[Kib],Kib>0&&Eib[Kib]!==Eib[Kib-1]&&(Jib=!1);Jib&&(sib.roundness=Eib[0]),sib.useCubicForRoundedCorners=1!==wib,sib.update();let Mib=C4a.create({shape:sib,parameters:{depth:xib,extrudeBevelSize:yib,extrudeBevelSegments:zib}});return Object.assign(Mib,{userData:{...rib,type:"RectangleGeometry"}})}},Nib=class{static create(Oib){return this.build(this.normalizeInputs(Oib))}static normalizeInputs(Pib,Qib){let Rib=Object.assign({},Qib?.parameters??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},Pib.parameters);return Rib.thetaLength=Db.clamp(Rib.thetaLength,0,180),{parameters:Object.assign(Rib,{width:Math.abs(Rib.width),height:Math.abs(Rib.height??Rib.width),depth:Math.abs(Rib.depth??Rib.width)})}}static build(Sib){let{width:Tib=100,height:Uib=Tib,depth:Vib=Tib,widthSegments:Wib=64,heightSegments:Xib=64,phiStart:Yib,phiLength:Zib,thetaStart:$ib,thetaLength:_ib}=Sib.parameters,ajb;return 0===_ib?(ajb=new nE).setAttribute("position",new cE([],3)):ajb=new D7(.5*Tib,Wib,Xib,Yib,Zib,$ib,_ib*Db.DEG2RAD),ajb.scale(1,Uib/Tib,Vib/Tib),Object.assign(ajb,{userData:{...Sib,type:"SphereGeometry"}})}},bjb=class{static create(cjb){return this.build(this.normalizeInputs(cjb))}static normalizeInputs(djb,ejb){let fjb=Object.assign({},ejb?.parameters??{width:100,depth:0,widthSegments:8,heightSegments:8},djb.parameters);return{parameters:Object.assign(fjb,{width:Math.abs(fjb.width),height:Math.abs(fjb.height??fjb.width),depth:0})}}static build(gjb){let{width:hjb=100,height:ijb=hjb,widthSegments:jjb=8,heightSegments:kjb=8}=gjb.parameters,ljb=new XM(hjb,ijb,jjb,kjb);return ljb.scale(1,1,1),Object.assign(ljb,{userData:{...gjb,type:"PlaneGeometry"}})}},mjb=class{static create(njb){return this.build(this.normalizeInputs(njb))}static normalizeInputs(ojb,pjb){let qjb=Object.assign({},pjb?.parameters??{width:100,angle:90,cornerRadius:24,cornerSegments:8},ojb.parameters);return{parameters:Object.assign(qjb,{width:Math.abs(qjb.width),height:Math.abs(qjb.height??qjb.width),depth:Math.abs(qjb.depth??qjb.width)})}}static build(rjb){let{width:sjb,height:tjb,depth:ujb,angle:vjb,cornerRadius:wjb,cornerSegments:xjb}=rjb.parameters,yjb=new zjb(sjb,tjb,ujb,vjb,wjb,xjb);return Object.assign(yjb,{userData:{...rjb,type:"BackdropGeometry"}})}},zjb=class extends nE{constructor(Ajb=1,Bjb=1,Cjb=1,Djb=90,Ejb=10,Fjb=24){super(),this.type="BackdropGeometry";let Gjb=[],Hjb=[],Ijb=[],Jjb=.001;0==Ejb&&(Fjb=1),Fjb=Math.max(1,Math.floor(Fjb)),Ejb=Math.min(Ejb,100),Djb=Math.min(180-Jjb,Djb),Djb*=Math.PI/180;let Kjb=[],Ljb=Math.PI/2,Mjb=(a=0,b=0,c=0)=>new fm(a,b,c),Njb=Mjb(),Ojb=Mjb(),[Pjb,Qjb,Rjb]=[Bjb/2,Ajb/2,Cjb/2],Sjb=-Qjb,Tjb=+Qjb,[Ujb,Vjb,Wjb]=[Mjb(Sjb,-Pjb,+Rjb),Mjb(Sjb,-Pjb,-Rjb),Mjb(Sjb,+Pjb,-Rjb)],Xjb=(a,b=!1)=>Math.sin(a-Math.PI/(1+ +b)),Yjb=(a,b=!1)=>Math.cos(a-Math.PI/(1+ +b));Wjb.y=Math.sin(Djb)*Bjb-Pjb;let Zjb=Math.cos(Djb)*Bjb-Rjb,$jb=Ujb.z-Jjb;Djb<=Ljb?(Wjb.z=Math.min(Zjb,$jb),Wjb.z==$jb&&(Wjb.y-=(Zjb-$jb)/Math.tan(Ljb-Djb))):Vjb.z=Math.min(Vjb.z-Zjb-Rjb,Ujb.z-Jjb),Njb.subVectors(Ujb,Vjb),Ojb.subVectors(Wjb,Vjb);let _jb=Math.min(Njb.length(),Ojb.length())*Ejb/100,akb=_jb*Math.tan(Djb/2),bkb=_jb/Math.cos(Djb/2),ckb=Njb.clone().normalize().add(Ojb.normalize()).setLength(bkb).add(Vjb);Njb.set(0,Xjb(Djb,!0),Yjb(Djb,!0)),Kjb.push([Wjb,Njb.clone()]);let dkb=(Math.PI-Djb)/Fjb;for(let ekb=0;ekb<=Fjb;ekb++){let fkb=Ljb+Djb+ekb*dkb;Njb.set(0,Math.sin(fkb)*akb,Math.cos(fkb)*akb),Njb.add(ckb),Ojb.set(0,Xjb(fkb),Yjb(fkb)),Kjb.push([Njb.clone(),Ojb.clone()])}Kjb.push([Ujb,Mjb(0,1,0)]);let gkb=Math.sin(dkb/2)*akb*2,hkb=Kjb.length-1,ikb=Kjb[0][0].distanceTo(Kjb[1][0]),jkb=ikb+gkb*Fjb+Kjb[hkb-1][0].distanceTo(Kjb[hkb][0]);Kjb[0].push(1);for(let kkb=0;kkb<=Fjb;kkb++)Kjb[kkb+1].push(1-(ikb+kkb*gkb)/jkb);Kjb[hkb].push(0);let[lkb,mkb,nkb]=Kjb[0],okb,pkb,qkb;for(let rkb=1;rkb<Kjb.length;rkb++)[okb,pkb,qkb]=Kjb[rkb],Gjb.push(Sjb,lkb.y,lkb.z,Sjb,okb.y,okb.z,Tjb,lkb.y,lkb.z,Tjb,lkb.y,lkb.z,Sjb,okb.y,okb.z,Tjb,okb.y,okb.z),Hjb.push(0,mkb.y,mkb.z,0,pkb.y,pkb.z,0,mkb.y,mkb.z,0,mkb.y,mkb.z,0,pkb.y,pkb.z,0,pkb.y,pkb.z),Ijb.push(0,nkb,0,qkb,1,nkb,1,nkb,0,qkb,1,qkb),[lkb,mkb,nkb]=[okb,pkb,qkb];this.setAttribute("position",new cE(Gjb,3)),this.setAttribute("normal",new cE(Hjb,3)),this.setAttribute("uv",new cE(Ijb,2))}},skb=class{static create(tkb){return this.build(this.normalizeInputs(tkb))}static normalizeInputs(ukb,vkb){let wkb=Object.assign({},vkb?.parameters??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},ukb.parameters);return{shape:ukb.shape&&ukb.shape instanceof yXa?ukb.shape:new yXa,parameters:Object.assign(wkb,{width:Math.abs(wkb.width),height:Math.abs(wkb.height??wkb.width),depth:Math.abs(wkb.depth??0)})}}static build(xkb){let{width:ykb,height:zkb,innerRadiusPercent:Akb,spikes:Bkb,cornerRadius:Ckb,angle:Dkb,depth:Ekb,extrudeBevelSize:Fkb,extrudeBevelSegments:Gkb}=xkb.parameters,Hkb=xkb.shape,Ikb=.5*ykb,Jkb=.5*zkb,Kkb=0,Lkb=0,Mkb=Dkb*Math.PI/360/Bkb,Nkb=-(Math.PI/2*3),Okb=Ikb*Akb/100,Pkb=Jkb*Akb/100;if(3===Bkb&&50===Akb){Mkb=2*Math.PI/Bkb;for(let Qkb=0;Qkb<Bkb;Qkb++){let Rkb=Mkb*Qkb,Skb=Kkb+Math.sin(Rkb)*Ikb,Tkb=Lkb+Math.cos(Rkb)*Jkb;Hkb.addPoint(Hkb.createPoint(Skb,Tkb))}}else for(let Ukb=0;Ukb<Bkb;Ukb++){let Vkb=Kkb+Math.cos(Nkb)*Ikb,Wkb=Lkb+Math.sin(Nkb)*Jkb;Hkb.addPoint(Hkb.createPoint(Vkb,Wkb)),Vkb=Kkb+Math.cos(Nkb+=Mkb)*Okb,Wkb=Lkb+Math.sin(Nkb)*Pkb,Hkb.addPoint(Hkb.createPoint(Vkb,Wkb)),Nkb+=Mkb}Hkb.isClosed=!0;for(let Xkb=0,Ykb=Hkb.points.length;Xkb<Ykb;Xkb++)Hkb.points[Xkb].roundness=Ckb;Hkb.roundness=Ckb,Hkb.update();let Zkb=C4a.create({shape:Hkb,parameters:{roundness:Ckb,depth:Ekb,extrudeBevelSize:Fkb,extrudeBevelSegments:Gkb}});return Object.assign(Zkb,{userData:{...xkb,type:"StarGeometry"}})}},$kb=class{static create(_kb){return this.build(this.normalizeInputs(_kb))}static normalizeInputs(alb,blb){let clb=Object.assign({},blb?.parameters??{width:100,depth:0},alb.parameters);return{parameters:Object.assign(clb,{width:Math.abs(clb.width),height:Math.abs(clb.height??clb.width),depth:Math.abs(clb.depth??0)})}}static build(dlb){let{width:elb,height:flb}=dlb.parameters,glb=new XM(elb,flb);return Object.assign(glb,{userData:{...dlb,type:"TextFrameGeometry"}})}},hlb=class{static create(ilb){return this.build(this.normalizeInputs(ilb))}static normalizeInputs(jlb,klb){let llb=Object.assign({},klb?.parameters??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},jlb.parameters),mlb=Math.abs(llb.width),nlb=Math.abs(llb.height??llb.width),olb=Math.round(Math.abs(llb.depth??.25*llb.width));return{parameters:Object.assign(llb,{width:mlb,height:nlb,depth:olb})}}static build(plb){let{width:qlb,height:rlb,depth:slb,radialSegments:tlb,tubularSegments:ulb,arc:vlb,cornerRadius:wlb,cornerSegments:xlb}=plb.parameters,ylb=zlb(qlb,rlb,slb,.5*qlb,vlb,ulb,0,0,tlb,wlb,xlb);return ylb.scale(1,rlb/qlb,1),Object.assign(ylb,{userData:{...plb,type:"TorusGeometry"}})}};function zlb(a,b,c,d,e,f,g,h,i,j,k){[b,c]=[c,b],g=b/2;let l=Db.clamp(e/360,0,1);if(0===l){let m=new nE;return m.setAttribute("position",new cE([],3)),m}return 1===l&&(j=0),new R5a(!0,a,b,c,d,l,f,g,h,i,j,k)}var Alb=class{static create(Blb){return this.build(this.normalizeInputs(Blb))}static normalizeInputs(Clb,Dlb){let Elb=Object.assign({},Dlb?.parameters??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},Clb.parameters);return{parameters:Object.assign(Elb,{width:Math.abs(Elb.width),height:Math.abs(Elb.height??Elb.width),depth:Math.abs(Elb.depth??Elb.width),tube:Elb.tube??.125*Elb.width})}}static build(Flb){let{width:Glb,tube:Hlb,tubularSegments:Ilb,radialSegments:Jlb,p:Klb,q:Llb}=Flb.parameters,Mlb=.5*Glb;Mlb!==Hlb&&(Mlb-=Hlb);let Nlb=new D8(Mlb,Hlb,Ilb,Jlb,Klb,Llb);return Object.assign(Nlb,{userData:{...Flb,type:"TorusKnotGeometry"}})}},Olb=class{static create(Plb){return this.build(this.normalizeInputs(Plb))}static normalizeInputs(Qlb,Rlb){let Slb=Object.assign({},Rlb?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},Qlb.parameters);return{shape:Qlb.shape&&Qlb.shape instanceof yXa?Qlb.shape:new yXa,parameters:Object.assign(Slb,{width:Math.abs(Slb.width),height:Math.abs(Slb.height??Slb.width*(Slb.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(Slb.depth??0)})}}static build(Tlb){let{width:Ulb=100,height:Vlb,cornerRadius:Wlb,depth:Xlb,extrudeBevelSize:Ylb,extrudeBevelSegments:Zlb,isRect:$lb}=Tlb.parameters,_lb=Tlb.shape,amb=.5*Ulb,bmb=.5*Vlb;$lb?(_lb.addPoint(_lb.createPoint(-amb,bmb)),_lb.addPoint(_lb.createPoint(amb,-bmb)),_lb.addPoint(_lb.createPoint(-amb,-bmb))):(_lb.addPoint(_lb.createPoint(0,bmb)),_lb.addPoint(_lb.createPoint(amb,-bmb)),_lb.addPoint(_lb.createPoint(-amb,-bmb))),_lb.isClosed=!0;for(let cmb=0,dmb=_lb.points.length;cmb<dmb;cmb++)_lb.points[cmb].roundness=Wlb;_lb.roundness=Wlb,_lb.update();let emb=C4a.create({shape:_lb,parameters:{roundness:Wlb,depth:Xlb,extrudeBevelSize:Ylb,extrudeBevelSegments:Zlb}});return Object.assign(emb,{userData:{...Tlb,type:"TriangleGeometry"}})}},fmb=class{add(gmb,hmb,imb){if("string"!=typeof arguments[0])for(let jmb in arguments[0])this.add(jmb,arguments[0][jmb],arguments[1]);else(Array.isArray(gmb)?gmb:[gmb]).forEach(function(a){this[a]=this[a]||[],hmb&&this[a][imb?"unshift":"push"](hmb)},this)}run(kmb,lmb){this[kmb]=this[kmb]||[],this[kmb].forEach(function(a){a.call(lmb&&lmb.context?lmb.context:lmb,lmb)})}},mmb=class{constructor(nmb){this.jsep=nmb,this.registered={}}register(...omb){omb.forEach(a=>{if("object"!=typeof a||!a.name||!a.init)throw new Error("Invalid JSEP plugin format");this.registered[a.name]||(a.init(this.jsep),this.registered[a.name]=a)})}},pmb=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+pmb.version}static addUnaryOp(qmb){return pmb.max_unop_len=Math.max(qmb.length,pmb.max_unop_len),pmb.unary_ops[qmb]=1,pmb}static addBinaryOp(rmb,smb,tmb){return pmb.max_binop_len=Math.max(rmb.length,pmb.max_binop_len),pmb.binary_ops[rmb]=smb,tmb?pmb.right_associative.add(rmb):pmb.right_associative.delete(rmb),pmb}static addIdentifierChar(umb){return pmb.additional_identifier_chars.add(umb),pmb}static addLiteral(vmb,wmb){return pmb.literals[vmb]=wmb,pmb}static removeUnaryOp(xmb){return delete pmb.unary_ops[xmb],xmb.length===pmb.max_unop_len&&(pmb.max_unop_len=pmb.getMaxKeyLen(pmb.unary_ops)),pmb}static removeAllUnaryOps(){return pmb.unary_ops={},pmb.max_unop_len=0,pmb}static removeIdentifierChar(ymb){return pmb.additional_identifier_chars.delete(ymb),pmb}static removeBinaryOp(zmb){return delete pmb.binary_ops[zmb],zmb.length===pmb.max_binop_len&&(pmb.max_binop_len=pmb.getMaxKeyLen(pmb.binary_ops)),pmb.right_associative.delete(zmb),pmb}static removeAllBinaryOps(){return pmb.binary_ops={},pmb.max_binop_len=0,pmb}static removeLiteral(Amb){return delete pmb.literals[Amb],pmb}static removeAllLiterals(){return pmb.literals={},pmb}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(Bmb){this.expr=Bmb,this.index=0}static parse(Cmb){return new pmb(Cmb).parse()}static getMaxKeyLen(Dmb){return Math.max(0,...Object.keys(Dmb).map(a=>a.length))}static isDecimalDigit(Emb){return Emb>=48&&Emb<=57}static binaryPrecedence(Fmb){return pmb.binary_ops[Fmb]||0}static isIdentifierStart(Gmb){return Gmb>=65&&Gmb<=90||Gmb>=97&&Gmb<=122||Gmb>=128&&!pmb.binary_ops[String.fromCharCode(Gmb)]||pmb.additional_identifier_chars.has(String.fromCharCode(Gmb))}static isIdentifierPart(Hmb){return pmb.isIdentifierStart(Hmb)||pmb.isDecimalDigit(Hmb)}throwError(Imb){let Jmb=new Error(Imb+" at character "+this.index);throw Jmb.index=this.index,Jmb.description=Imb,Jmb}runHook(Kmb,Lmb){if(pmb.hooks[Kmb]){let Mmb={context:this,node:Lmb};return pmb.hooks.run(Kmb,Mmb),Mmb.node}return Lmb}searchHook(Nmb){if(pmb.hooks[Nmb]){let Omb={context:this};return pmb.hooks[Nmb].find(function(a){return a.call(Omb.context,Omb),Omb.node}),Omb.node}}gobbleSpaces(){let Pmb=this.code;for(;Pmb===pmb.SPACE_CODE||Pmb===pmb.TAB_CODE||Pmb===pmb.LF_CODE||Pmb===pmb.CR_CODE;)Pmb=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let Qmb=this.gobbleExpressions(),Rmb=1===Qmb.length?Qmb[0]:{type:pmb.COMPOUND,body:Qmb};return this.runHook("after-all",Rmb)}gobbleExpressions(Smb){let Tmb=[],Umb,Vmb;for(;this.index<this.expr.length;)if((Umb=this.code)===pmb.SEMCOL_CODE||Umb===pmb.COMMA_CODE)this.index++;else if(Vmb=this.gobbleExpression())Tmb.push(Vmb);else if(this.index<this.expr.length){if(Umb===Smb)break;this.throwError("Unexpected \""+this.char+"\"")}return Tmb}gobbleExpression(){let Wmb=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",Wmb)}gobbleBinaryOp(){this.gobbleSpaces();let Xmb=this.expr.substr(this.index,pmb.max_binop_len),Ymb=Xmb.length;for(;Ymb>0;){if(pmb.binary_ops.hasOwnProperty(Xmb)&&(!pmb.isIdentifierStart(this.code)||this.index+Xmb.length<this.expr.length&&!pmb.isIdentifierPart(this.expr.charCodeAt(this.index+Xmb.length))))return this.index+=Ymb,Xmb;Xmb=Xmb.substr(0,--Ymb)}return!1}gobbleBinaryExpression(){let Zmb,$mb,_mb,anb,bnb,cnb,dnb,enb,fnb;if(!(cnb=this.gobbleToken())||!($mb=this.gobbleBinaryOp()))return cnb;for(bnb={value:$mb,prec:pmb.binaryPrecedence($mb),right_a:pmb.right_associative.has($mb)},(dnb=this.gobbleToken())||this.throwError("Expected expression after "+$mb),anb=[cnb,bnb,dnb];$mb=this.gobbleBinaryOp();){if(0===(_mb=pmb.binaryPrecedence($mb))){this.index-=$mb.length;break}bnb={value:$mb,prec:_mb,right_a:pmb.right_associative.has($mb)},fnb=$mb;let gnb=a=>bnb.right_a&&a.right_a?_mb>a.prec:_mb<=a.prec;for(;anb.length>2&&gnb(anb[anb.length-2]);)dnb=anb.pop(),$mb=anb.pop().value,cnb=anb.pop(),Zmb={type:pmb.BINARY_EXP,operator:$mb,left:cnb,right:dnb},anb.push(Zmb);(Zmb=this.gobbleToken())||this.throwError("Expected expression after "+fnb),anb.push(bnb,Zmb)}for(enb=anb.length-1,Zmb=anb[enb];enb>1;)Zmb={type:pmb.BINARY_EXP,operator:anb[enb-1].value,left:anb[enb-2],right:Zmb},enb-=2;return Zmb}gobbleToken(){let hnb,inb,jnb,knb;if(this.gobbleSpaces(),knb=this.searchHook("gobble-token"))return this.runHook("after-token",knb);if(hnb=this.code,pmb.isDecimalDigit(hnb)||hnb===pmb.PERIOD_CODE)return this.gobbleNumericLiteral();if(hnb===pmb.SQUOTE_CODE||hnb===pmb.DQUOTE_CODE)knb=this.gobbleStringLiteral();else if(hnb===pmb.OBRACK_CODE)knb=this.gobbleArray();else{for(jnb=(inb=this.expr.substr(this.index,pmb.max_unop_len)).length;jnb>0;){if(pmb.unary_ops.hasOwnProperty(inb)&&(!pmb.isIdentifierStart(this.code)||this.index+inb.length<this.expr.length&&!pmb.isIdentifierPart(this.expr.charCodeAt(this.index+inb.length)))){this.index+=jnb;let lnb=this.gobbleToken();return lnb||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:pmb.UNARY_EXP,operator:inb,argument:lnb,prefix:!0})}inb=inb.substr(0,--jnb)}pmb.isIdentifierStart(hnb)?(knb=this.gobbleIdentifier(),pmb.literals.hasOwnProperty(knb.name)?knb={type:pmb.LITERAL,value:pmb.literals[knb.name],raw:knb.name}:knb.name===pmb.this_str&&(knb={type:pmb.THIS_EXP})):hnb===pmb.OPAREN_CODE&&(knb=this.gobbleGroup())}return knb?(knb=this.gobbleTokenProperty(knb),this.runHook("after-token",knb)):this.runHook("after-token",!1)}gobbleTokenProperty(mnb){this.gobbleSpaces();let nnb=this.code;for(;nnb===pmb.PERIOD_CODE||nnb===pmb.OBRACK_CODE||nnb===pmb.OPAREN_CODE||nnb===pmb.QUMARK_CODE;){let onb;if(nnb===pmb.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==pmb.PERIOD_CODE)break;onb=!0,this.index+=2,this.gobbleSpaces(),nnb=this.code}this.index++,nnb===pmb.OBRACK_CODE?(mnb={type:pmb.MEMBER_EXP,computed:!0,object:mnb,property:this.gobbleExpression()},this.gobbleSpaces(),(nnb=this.code)!==pmb.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):nnb===pmb.OPAREN_CODE?mnb={type:pmb.CALL_EXP,arguments:this.gobbleArguments(pmb.CPAREN_CODE),callee:mnb}:(nnb===pmb.PERIOD_CODE||onb)&&(onb&&this.index--,this.gobbleSpaces(),mnb={type:pmb.MEMBER_EXP,computed:!1,object:mnb,property:this.gobbleIdentifier()}),onb&&(mnb.optional=!0),this.gobbleSpaces(),nnb=this.code}return mnb}gobbleNumericLiteral(){let pnb="",qnb,rnb;for(;pmb.isDecimalDigit(this.code);)pnb+=this.expr.charAt(this.index++);if(this.code===pmb.PERIOD_CODE)for(pnb+=this.expr.charAt(this.index++);pmb.isDecimalDigit(this.code);)pnb+=this.expr.charAt(this.index++);if("e"===(qnb=this.char)||"E"===qnb){for(pnb+=this.expr.charAt(this.index++),("+"===(qnb=this.char)||"-"===qnb)&&(pnb+=this.expr.charAt(this.index++));pmb.isDecimalDigit(this.code);)pnb+=this.expr.charAt(this.index++);pmb.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+pnb+this.char+")")}return rnb=this.code,pmb.isIdentifierStart(rnb)?this.throwError("Variable names cannot start with a number ("+pnb+this.char+")"):(rnb===pmb.PERIOD_CODE||1===pnb.length&&pnb.charCodeAt(0)===pmb.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:pmb.LITERAL,value:parseFloat(pnb),raw:pnb}}gobbleStringLiteral(){let snb="",tnb=this.index,unb=this.expr.charAt(this.index++),vnb=!1;for(;this.index<this.expr.length;){let wnb=this.expr.charAt(this.index++);if(wnb===unb){vnb=!0;break}if("\\"===wnb)switch(wnb=this.expr.charAt(this.index++)){case"n":snb+=`
`;break;case"r":snb+="\r";break;case"t":snb+="\t";break;case"b":snb+="\b";break;case"f":snb+="\f";break;case"v":snb+="\v";break;default:snb+=wnb}else snb+=wnb}return vnb||this.throwError("Unclosed quote after \""+snb+"\""),{type:pmb.LITERAL,value:snb,raw:this.expr.substring(tnb,this.index)}}gobbleIdentifier(){let xnb=this.code,ynb=this.index;for(pmb.isIdentifierStart(xnb)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(xnb=this.code,pmb.isIdentifierPart(xnb));)this.index++;return{type:pmb.IDENTIFIER,name:this.expr.slice(ynb,this.index)}}gobbleArguments(znb){let Anb=[],Bnb=!1,Cnb=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let Dnb=this.code;if(Dnb===znb){Bnb=!0,this.index++,znb===pmb.CPAREN_CODE&&Cnb&&Cnb>=Anb.length&&this.throwError("Unexpected token "+String.fromCharCode(znb));break}if(Dnb===pmb.COMMA_CODE){if(this.index++,Cnb++,Cnb!==Anb.length){if(znb===pmb.CPAREN_CODE)this.throwError("Unexpected token ,");else if(znb===pmb.CBRACK_CODE)for(let Enb=Anb.length;Enb<Cnb;Enb++)Anb.push(null)}}else if(Anb.length!==Cnb&&0!==Cnb)this.throwError("Expected comma");else{let Fnb=this.gobbleExpression();Fnb&&Fnb.type!==pmb.COMPOUND||this.throwError("Expected comma"),Anb.push(Fnb)}}return Bnb||this.throwError("Expected "+String.fromCharCode(znb)),Anb}gobbleGroup(){this.index++;let Gnb=this.gobbleExpressions(pmb.CPAREN_CODE);if(this.code===pmb.CPAREN_CODE)return this.index++,1===Gnb.length?Gnb[0]:!!Gnb.length&&{type:pmb.SEQUENCE_EXP,expressions:Gnb};this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:pmb.ARRAY_EXP,elements:this.gobbleArguments(pmb.CBRACK_CODE)}}},Hnb=new fmb;Object.assign(pmb,{hooks:Hnb,plugins:new mmb(pmb),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"}),pmb.max_unop_len=pmb.getMaxKeyLen(pmb.unary_ops),pmb.max_binop_len=pmb.getMaxKeyLen(pmb.binary_ops);var Inb,Jnb,Knb=a=>new pmb(a).parse();Object.getOwnPropertyNames(pmb).forEach(a=>{void 0===Knb[a]&&"prototype"!==a&&(Knb[a]=pmb[a])}),Knb.Jsep=pmb;var Lnb={name:"ternary",init(a){a.hooks.add("after-expression",function(b){if(b.node&&this.code===a.QUMARK_CODE){this.index++;let c=b.node,d=this.gobbleExpression();if(d||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===a.COLON_CODE){this.index++;let e=this.gobbleExpression();if(e||this.throwError("Expected expression"),b.node={type:"ConditionalExpression",test:c,consequent:d,alternate:e},c.operator&&a.binary_ops[c.operator]<=.9){let f=c;for(;f.right.operator&&a.binary_ops[f.right.operator]<=.9;)f=f.right;b.node.test=f.right,f.right=b.node,b.node=c}}else this.throwError("Expected :")}})}};Knb.plugins.register(Lnb);var Mnb=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],Nnb=["0","1","2","3","4","5","6","7","8","9","."],Onb=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function Pnb(a){return"string"==typeof a&& !isNaN(a)&&!isNaN(parseFloat(a))}function Qnb(a,b,c="number"){let d="";for(let e=0;e<a.length;e++){let f=a[e];if("id"in f){let g=a[e-1];if(e>0&&"id"in g){console.error("Two variables in a row",a);return}let h=b.getVariable(f.id),i=aOa.getDisplayedValue(h);"number"===c&&aOa.isTextValue(h)&&Array.isArray(h.textValue)&&1===h.textValue.length?i=parseFloat(i).toString():"boolean"===c&&aOa.isBoolean(h)?i=h?"true":"false":"boolean"===c&&aOa.isTextValue(h)&&!Array.isArray(h.textValue)&&(i="\""+i+"\""),d+=i;continue}if("string"===c){"\""!==f.name&&"+"!==f.name&&(d+=f.name),"+"===f.name&&"\\"===d[d.length-1]&&(d=d.slice(0,-1)+f.name);continue}if("and"===f.name){d+="&&";continue}if("or"===f.name){d+="||";continue}if("True"===f.name){d+="true";continue}if("False"===f.name){d+="false";continue}if("boolean"===c&&!Pnb(f.name)&&!Nnb.includes(f.name)&&!Mnb.includes(f.name)&&!Onb.includes(f.name.replace(/\($/g,""))){d+="\""+f.name+"\"";continue}d+=f.name}if("string"===c)return d;if(0===a.length){if("number"===c)return 0;if("boolean"===c)return!1}let j;try{j=Knb(d)}catch(k){console.error(d,k);return}let l;try{l=Rnb(j)}catch(m){console.error(d,j,m)}return l}function Rnb(a){switch(a.type){case"BinaryExpression":switch(a.operator){case"==":return Number(Rnb(a.left)===Rnb(a.right));case"!=":return Number(Rnb(a.left)!==Rnb(a.right));case">":return Number(Rnb(a.left)>Rnb(a.right));case">=":return Number(Rnb(a.left)>=Rnb(a.right));case"<":return Number(Rnb(a.left)<Rnb(a.right));case"<=":return Number(Rnb(a.left)<=Rnb(a.right));case"+":return Rnb(a.left)+Rnb(a.right);case"-":return Rnb(a.left)-Rnb(a.right);case"*":return Rnb(a.left)*Rnb(a.right);case"/":return Rnb(a.left)/Rnb(a.right);case"%":return Rnb(a.left)%Rnb(a.right);case"&&":return Rnb(a.left)&&Rnb(a.right);case"||":return Rnb(a.left)||Rnb(a.right);case"^":return Math.pow(Rnb(a.left),Rnb(a.right));default:throw new Error("Unknown operator: "+a.operator)}case"UnaryExpression":switch(a.operator){case"-":return-Rnb(a.argument);case"!":return Number(!Rnb(a.argument));default:throw new Error("Unknown operator: "+a.operator)}case"Identifier":throw new Error("Unknown identifier: "+a.name);case"Literal":return a.value;case"CallExpression":if("Identifier"===a.callee.type){if("random"===a.callee.name){let b=0,c=1;if(a.arguments.length>=1)try{b=Rnb(a.arguments[0])}catch(d){console.warn(d)}if(a.arguments.length>=2)try{c=Rnb(a.arguments[1])}catch(e){console.warn(e)}return b=Math.min(c,b),c=Math.max(c,b),b+Math.random()*(c-b)}return Math[a.callee.name].apply(null,a.arguments.map(Rnb))}throw new Error("Unknown node");default:throw new Error("Unknown node type: "+a.type)}}Knb.addBinaryOp("^",11,!0);var Snb=new rs,Tnb=new rs,Unb=class{static create(Vnb){return this.build(this.normalizeInputs(Vnb))}static normalizeInputs(Wnb,Xnb){let Ynb=Object.assign({},Xnb?.parameters??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},Wnb.parameters),Znb=Math.abs(Ynb.width),$nb=Math.abs(Ynb.height??Ynb.width),_nb=Math.abs(Ynb.depth??0),aob=Xnb?.shapeData??W4a.create({parameters:YJa}).userData.shape;return{path:Wnb.path??qNa.defaultData(),parameters:Object.assign(Ynb,{width:Znb,height:$nb,depth:_nb,extrusion:{...$Ja,...Ynb.extrusion}}),shapeData:aob}}static build(bob){if(!(bob.path.points.length>=2))return Object.assign(new nE,{userData:{...bob,type:"PathGeometry"}});{let cob=new dob(bob);return Object.assign(cob,{userData:{...bob,type:"PathGeometry"}})}}},dob=class extends nE{constructor(eob){super(),this.type="PathExtrusionGeometry",this.inputs=eob,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&1===this.inputs.parameters.extrusion.depth}_isOpenEnded(){let fob=this.inputs.parameters.extrusion,gob;return!(this.inputs.path.isClosed&&1===fob.depth)||(fob.twist%(gob=2*Math.PI)+gob)%gob!=(0%gob+gob)%gob||fob.startScale!==fob.endScale}build(){let hob=this._extractPathPoints();if(hob.length<2)return;let iob=this._computeBasisMatrices(hob),{depth:job,offset:kob}=this.inputs.parameters.extrusion;job=Math.max(0,Math.min(job,1)),kob=Math.max(0,Math.min(kob,1));let lob=this.inputs.path.isClosed?hob.length:hob.length-1,mob=Math.floor(kob*lob),nob=this.inputs.path.isClosed?Math.ceil((job+kob)*lob):Math.ceil(Math.min(1,job+kob)*lob),oob=Math.min(Math.max(2,nob-mob+1),lob+2),pob=[],qob=[];for(let rob=0;rob<oob;rob++){let sob=this.inputs.path.isClosed?(rob+mob)%hob.length:Math.min(rob+mob,hob.length-1);pob.push(hob[sob].clone()),qob.push(iob[sob].clone())}let tob=(a,b,c)=>{var d,e,f;let g,h;pob[a]=pob[a].clone().lerp(pob[b],c),d=qob[a],e=qob[b],f=c,g=[new fm,new fm,new fm],h=[new fm,new fm,new fm],d.extractBasis(g[0],g[1],g[2]),e.extractBasis(h[0],h[1],h[2]),g.forEach((a,b)=>{let c=h[b],d=Db.lerp(a.length(),c.length(),f);a.lerp(c,f).setLength(d)}),qob[a]=new rs().makeBasis(g[0],g[1],g[2])},uob=0,vob=kob*lob%1;(!this.inputs.path.isClosed||job<=1)&&(vob||0===kob)&&tob(0,1,uob=vob);let wob=0,xob=(kob+job)*lob%1;if((this.inputs.path.isClosed&&job<=1|| !this.inputs.path.isClosed&&kob+job<1)&&xob&&(wob=xob,tob(pob.length-1,pob.length-2,1-wob)),0===job){let yob=pob.length-1;pob[yob].copy(pob[0]),qob[yob].copy(qob[0])}this._applyPathModifiers(qob,uob,wob);let{bevel:zob,bevelSides:Aob}=this.inputs.parameters.extrusion,Bob=zob>0?this.inputs.parameters.extrusion.capType:"flat",Cob=5;"Custom"===this.inputs.parameters.extrusion.shape.type&&(Cob="low"===this.inputs.parameters.extrusion.shape.shapeQuality?5:12);let{regions:Dob,infos:Eob,vertices:Fob}=this._computeShapePoints(Cob),Gob=0,Hob;"round"===Bob&&(Gob=(Hob=new v_a(this.inputs.shapeData,2*zob,zob,Cob,Aob,void 0,!0)).getAttribute("position").count);let Iob=0,Job=0;Eob.sort((a,b)=>a.start-b.start),Eob.forEach(a=>{a.verticesStart=Iob,a.verticesCount=a.continuous.reduce((a,b,c)=>a+(0!==c&&b?1:2),0),Iob=Job+=a.verticesCount});let Kob=Job*oob,Lob,Mob=0;if(this._isOpenEnded()&&"flat"===Bob){try{Lob=V$a({windingRule:Gsb.ODD,elementType:Hsb.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:Dob})}catch{Lob=t_a}Mob=Lob.vertexCount}let Nob=Kob+2*Mob+2*Gob,Oob=Kob+2*Mob,Pob={positions:new Float32Array(3*Nob),normals:new Float32Array(3*Nob),uvs:new Float32Array(2*Nob)},Qob=[];if(Eob.forEach(a=>{this._extrudeRegion(a,Fob,qob,pob,Pob,Qob,this._isGeometryClosed()&&!this._isOpenEnded())}),Lob&&(this._closeEnd(Lob,Kob,Qob,Pob,qob[0],pob[0],!1),this._closeEnd(Lob,Kob+Mob,Qob,Pob,qob[qob.length-1],pob[pob.length-1],!0)),Hob){Pob.positions.set(Hob.getAttribute("position").array,3*Oob),Pob.normals.set(Hob.getAttribute("normal").array,3*Oob),Pob.uvs.set(Hob.getAttribute("uv").array,2*Oob);let Rob=Qob.length;Qob.push(...Hob.getIndex().array.map(a=>a+Oob)),Oob+=Gob,Pob.positions.set(Hob.getAttribute("position").array,3*Oob),Pob.normals.set(Hob.getAttribute("normal").array,3*Oob),Pob.uvs.set(Hob.getAttribute("uv").array,2*Oob);let Sob=Qob.length;Qob.push(...Hob.getIndex().array.map(a=>a+Oob)),this.setAttribute("position",new RC(Pob.positions,3)),this.setAttribute("normal",new RC(Pob.normals,3)),this.setAttribute("uv",new RC(Pob.uvs,2)),this.setIndex(Qob);let Tob=Snb;Tob.copy(qob[qob.length-1]).setPosition(pob[pob.length-1]),this.applyMatrix4OnRange(Tob,Oob,Nob),Tob.copy(qob[0]).setPosition(pob[0]).multiply(Tnb.makeScale(1,1,-1)),this.applyMatrix4OnRange(Tob,Oob-Gob,Oob),this.reverseIndicesOnRange(Rob,Sob)}else this.setAttribute("position",new RC(Pob.positions,3)),this.setAttribute("normal",new RC(Pob.normals,3)),this.setAttribute("uv",new RC(Pob.uvs,2)),this.setIndex(Qob)}_extractPathPoints(){let Uob=YSa(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(Uob.length<2)return[];let Vob=[Uob[0]];return Uob.forEach(a=>{Vob[Vob.length-1].distanceToSquared(a)>.001&&Vob.push(a)}),this.inputs.path.isClosed&&.001>Vob[Vob.length-1].distanceTo(Vob[0])&&Vob.pop(),Vob}_computeBasisMatrices(Wob){let Xob=[],Yob=Wob.length,Zob=this.inputs.path.isClosed,$ob=new fm,_ob=new fm,apb=new fm,bpb=new fm,cpb=new fm(0,1,0);for(let dpb=0;dpb<Yob;dpb++){let epb=Wob[dpb],fpb;fpb=0===dpb?Zob?Wob[Wob.length-2]:epb.clone().multiplyScalar(2).sub(Wob[1]):Wob[dpb-1];let gpb;gpb=dpb===Yob-1?Zob?Wob[1]:epb.clone().multiplyScalar(2).sub(Wob[dpb-1]):Wob[dpb+1];let hpb=epb.clone().sub(fpb).normalize(),ipb=gpb.clone().sub(epb).normalize(),jpb=hpb.clone().add(ipb).normalize();apb.copy(jpb),0===dpb&&(jpb.equals(cpb)||jpb.clone().negate().equals(cpb))&&cpb.set(0,0,1);let kpb=cpb.clone().cross(jpb).normalize(),lpb=jpb.clone().cross(kpb).normalize();cpb.copy(lpb),bpb.copy(kpb),0===dpb&&($ob.copy(lpb),_ob.copy(jpb));let mpb=new rs().makeBasis(kpb,lpb,jpb);Xob.push(mpb)}let npb=Zob?_ob:apb,opb=Zob?$ob:new fm(0,1,0),ppb=npb.clone().cross(bpb).normalize(),qpb=Math.acos(opb.dot(ppb));if(isNaN(qpb))return Xob;let rpb=opb.clone().cross(ppb);npb.dot(rpb)>0&&(qpb*=-1);for(let spb=1;spb<Xob.length;spb++){let tpb=new rs().makeRotationZ(qpb*spb/Xob.length);Xob[spb].multiply(tpb)}return Xob}_applyPathModifiers(upb,vpb,wpb){let xpb=upb.length,{angle:ypb,twist:zpb,startScale:Apb,endScale:Bpb}=this.inputs.parameters.extrusion,Cpb=new rs,Dpb=new rs;return upb.forEach((a,b)=>{let c=0===b?0:b===xpb-1?1:(b-vpb)/(xpb-(0===wpb?0:1)-(vpb+(1-wpb)));Cpb.makeRotationZ(Db.lerp(ypb,ypb+zpb,c)*Db.DEG2RAD);let d=Db.lerp(Apb,Bpb,c);Dpb.makeScale(d,d,d),a.multiply(Cpb).multiply(Dpb)}),upb}_computeShapePoints(Epb=12,Fpb=Gsb.ODD){let Gpb=this.inputs.shapeData,Hpb=Gpb.extractShapePointsToFlatArray([],Epb),Ipb=Gpb.shapeHoles.map(a=>{let b=a.extractShapePointsToFlatArray([],Epb),c=[];for(let d=b.length-1;d>=1;d-=2){let e=b[d-1],f=b[d-0];c.push(e,f)}return c}),Jpb;try{Jpb=V$a({windingRule:Fpb,elementType:Hsb.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[Hpb]})}catch{Jpb=r_a}let Kpb;try{Kpb=V$a({windingRule:Gsb.ODD,elementType:Hsb.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...Ipb]})}catch{Kpb=s_a}if(!Jpb)throw new Error("error generating geometry");let Lpb=Jpb.elementCount;if(Kpb){Jpb.elementCount+=Kpb.elementCount;for(let Mpb=0;Mpb<Kpb.elements.length;Mpb++){let Npb=Kpb.elements[Mpb],Opb=Mpb%2==0?Jpb.vertexCount:0;Jpb.elements.push(Npb+Opb)}for(let Ppb=0;Ppb<Kpb.vertexIndices.length;Ppb++){let Qpb=Kpb.vertexIndices[Ppb],Rpb=Jpb.vertexCount;Jpb.vertexIndices.push(Qpb+Rpb)}for(let Spb=0;Spb<Kpb.vertices.length;Spb++){let Tpb=Kpb.vertices[Spb];Jpb.vertices.push(Tpb)}}let Upb=1/0,Vpb=-1/0,Wpb=1/0,Xpb=-1/0;for(let Ypb=0,Zpb=Jpb.vertexCount;Ypb<Zpb;Ypb++){let $pb=2*Ypb,_pb=Jpb.vertices[$pb+0],aqb=Jpb.vertices[$pb+1];_pb<Upb&&(Upb=_pb),_pb>Vpb&&(Vpb=_pb),aqb<Wpb&&(Wpb=aqb),aqb>Xpb&&(Xpb=aqb)}let bqb=[];for(let cqb=Jpb.elementCount-1;cqb>=0;cqb--){let dqb=cqb>=Lpb,eqb=2*cqb,fqb=Jpb.elements[eqb+0],gqb=Jpb.elements[eqb+1],hqb=fqb+gqb,iqb={start:fqb,count:gqb,normals:[],isHole:dqb,continuous:[],verticesStart:0,verticesCount:0};bqb.push(iqb);let jqb=fqb,kqb=hqb-1,lqb=fqb+1,mqb=Gpb.roundedCurves.length;do{let nqb=jqb-fqb,oqb=Jpb.vertices[2*kqb+0],pqb=Jpb.vertices[2*kqb+1],qqb=Jpb.vertices[2*jqb+0],rqb=Jpb.vertices[2*jqb+1],sqb=Jpb.vertices[2*lqb+0],tqb=Jpb.vertices[2*lqb+1],uqb=qqb-oqb,vqb=rqb-pqb,wqb=Math.sqrt(uqb*uqb+vqb*vqb);uqb/=wqb,vqb/=wqb;let xqb=qqb-sqb,yqb=rqb-tqb,zqb=Math.sqrt(xqb*xqb+yqb*yqb);xqb/=zqb,yqb/=zqb,iqb.normals[2*nqb+0]=-yqb,iqb.normals[2*nqb+1]=xqb;let Aqb=Jpb.vertexIndices[jqb];if(Array.isArray(Aqb))iqb.continuous[nqb]=!1;else{let[Bqb,Cqb]=Gpb.getCurveIndexFromVertexId(Aqb-1,!0);if(Cqb>0&&Cqb<1)iqb.continuous[nqb]=!0;else{let Dqb=1===Cqb?Bqb+1:Bqb-1;Dqb=(Dqb+mqb)%mqb;let Eqb=1===Cqb?0:1,Fqb=Gpb.roundedCurves[Bqb].getTangent(Cqb),Gqb=Gpb.roundedCurves[Dqb].getTangent(Eqb);iqb.continuous[nqb]=Fqb.dot(Gqb)>.95}}dqb&&(iqb.normals[2*nqb+0]*=-1,iqb.normals[2*nqb+1]*=-1),[kqb,jqb,lqb]=[jqb,lqb,lqb+1],lqb>=hqb&&(lqb-=gqb)}while(lqb!==fqb+1)}return{regions:[Hpb,...Ipb],infos:bqb,vertices:Jpb.vertices}}_insertVertex(Hqb,Iqb,Jqb,Kqb,Lqb){let Mqb=2*Iqb,Nqb=3*Iqb;Hqb.positions[Nqb+0]=Jqb.x,Hqb.positions[Nqb+1]=Jqb.y,Hqb.positions[Nqb+2]=Jqb.z,Hqb.normals[Nqb+0]=Kqb.x,Hqb.normals[Nqb+1]=Kqb.y,Hqb.normals[Nqb+2]=Kqb.z,Hqb.uvs[Mqb+0]=Lqb.x,Hqb.uvs[Mqb+1]=Lqb.y}_extrudeRegion(Oqb,Pqb,Qqb,Rqb,Sqb,Tqb,Uqb){let Vqb=new fm,Wqb=new fm,Xqb=new fm,Yqb=new fm,Zqb=new Eb;Qqb.forEach((a,b)=>{let c=Rqb[b],d=Oqb.verticesStart*Qqb.length+Oqb.verticesCount*b;for(let e=0;e<Oqb.count;e++){let f=(Oqb.start+e)*2;if(Vqb.set(Pqb[f+0],Pqb[f+1],0),Xqb.copy(Vqb).applyMatrix4(a).add(c),Oqb.continuous[e])Yqb.set(Oqb.normals[2*e+0],Oqb.normals[2*e+1],0);else{let g=0===e?(Oqb.start+Oqb.count-1)*2:f-2;Wqb.set(Pqb[g+0],Pqb[g+1],0),Yqb.copy(Vqb).sub(Wqb),Yqb.set(-Yqb.y,Yqb.x,0),Oqb.isHole||Yqb.negate()}if(Yqb.applyMatrix4(a).normalize(),Zqb.set(0===e?1:e/Oqb.count,b/(Qqb.length-1)),this._insertVertex(Sqb,d,Xqb,Yqb,Zqb),d++,!Oqb.continuous[e]||0===e){if(0===e)Yqb.set(Oqb.normals[2*e+0],Oqb.normals[2*e+1],0),Zqb.set(0,b/(Qqb.length-1));else{let h=e===Oqb.count-1?2*Oqb.start:f+2;Wqb.set(Pqb[h+0],Pqb[h+1],0),Yqb.copy(Wqb).sub(Vqb),Yqb.set(-Yqb.y,Yqb.x,0),Oqb.isHole||Yqb.negate()}Yqb.applyMatrix4(a).normalize(),this._insertVertex(Sqb,d,Xqb,Yqb,Zqb),d++}}});let $qb=Qqb.length-1;for(let _qb=0;_qb<$qb;_qb++){let arb=Oqb.verticesStart*Qqb.length+Oqb.verticesCount*_qb,brb=Oqb.verticesStart*Qqb.length+Oqb.verticesCount*(_qb+1),crb=0;for(let drb=0;drb<Oqb.count;drb++){(!Oqb.continuous[drb]||0===drb)&&crb++;let erb=drb===Oqb.count-1?0:crb+1,frb=arb+crb,grb=arb+erb,hrb=brb+erb,irb=brb+crb;Oqb.isHole?Tqb.push(frb,hrb,grb,frb,irb,hrb):Tqb.push(frb,grb,hrb,frb,hrb,irb),crb++}}}_closeEnd(jrb,krb,lrb,mrb,nrb,orb,prb){let qrb=jrb.vertexCount,rrb=new fm(0,0,prb?-1:1).applyMatrix4(nrb),srb=new fm,trb=new Eb;for(let urb=0;urb<qrb;urb++){let vrb=2*urb;srb.set(jrb.vertices[vrb+0],jrb.vertices[vrb+1],0).applyMatrix4(nrb).add(orb),this._insertVertex(mrb,krb+urb,srb,rrb,trb)}let wrb=jrb.elements;for(let xrb=0;xrb<jrb.elementCount;xrb++){let yrb=3*xrb,zrb=wrb[yrb+0]+krb,Arb=wrb[yrb+(prb?1:2)]+krb,Brb=wrb[yrb+(prb?2:1)]+krb;lrb.push(zrb,Arb,Brb)}}applyMatrix4OnRange(Crb,Drb,Erb){let Frb=Crb.elements,Grb=new Rc().getNormalMatrix(Crb).elements,Hrb,Irb,Jrb,Krb,Lrb=this.attributes.position,Mrb=this.attributes.normal;if(!Lrb||!Mrb)return;let Nrb=Lrb.array,Orb=Mrb.array,Prb=Lrb.itemSize;for(let Qrb=Drb*Prb,Rrb=Erb*Prb;Qrb<Rrb;Qrb+=Prb)Hrb=Nrb[Qrb+0],Irb=Nrb[Qrb+1],Jrb=Nrb[Qrb+2],Krb=1/(Frb[3]*Hrb+Frb[7]*Irb+Frb[11]*Jrb+Frb[15]),Nrb[Qrb+0]=(Frb[0]*Hrb+Frb[4]*Irb+Frb[8]*Jrb+Frb[12])*Krb,Nrb[Qrb+1]=(Frb[1]*Hrb+Frb[5]*Irb+Frb[9]*Jrb+Frb[13])*Krb,Nrb[Qrb+2]=(Frb[2]*Hrb+Frb[6]*Irb+Frb[10]*Jrb+Frb[14])*Krb,Hrb=Orb[Qrb+0],Irb=Orb[Qrb+1],Jrb=Orb[Qrb+2],Orb[Qrb+0]=Grb[0]*Hrb+Grb[3]*Irb+Grb[6]*Jrb,Orb[Qrb+1]=Grb[1]*Hrb+Grb[4]*Irb+Grb[7]*Jrb,Orb[Qrb+2]=Grb[2]*Hrb+Grb[5]*Irb+Grb[8]*Jrb;Lrb.needsUpdate=!0,Mrb.needsUpdate=!0}reverseIndicesOnRange(Srb,Trb){let Urb=this.index;if(Urb){for(let Vrb=Srb;Vrb<Trb;Vrb+=3){let Wrb=Urb.getX(Vrb),Xrb=Urb.getX(Vrb+1),Yrb=Urb.getX(Vrb+2);Urb.setXYZ(Vrb,Yrb,Xrb,Wrb)}Urb.needsUpdate=!0}}};function Zrb(){let a=new nE;return a.setAttribute("position",new RC(new Float32Array([]),3)),a.setIndex(new RC(new Uint16Array([]),1)),a}var $rb=Zrb().attributes,_rb=12,asb=1,bsb=class extends nE{constructor(csb,dsb){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,$rb),this.userData={parameters:csb,type:"TextGeometry"};let esb=dsb.getFont(csb.font);esb?.isLoaded?(this.font=esb,this.update(csb)):this.updateFont(csb.font,dsb).then(()=>{this.update(csb),dsb?.requestRender()})}async updateFont(fsb,gsb){let hsb=gsb.getFont(fsb);hsb&&(this.font=hsb,await hsb.loadingPromise)}update(isb){let jsb=this.font;if(this.userData={parameters:isb,type:"TextGeometry"},!jsb?.isLoaded){console.warn("Cannot update text because its font is not loaded");return}let{width:ksb,height:lsb,depth:msb,extrudeBevelSize:nsb,extrudeBevelSegments:osb,text:psb,textTransform:qsb}=isb,rsb=aOa.getDisplayedValue(psb),ssb=Esb(isb,jsb,2===qsb?rsb.toUpperCase():3===qsb?rsb.toLowerCase():rsb),{shapes:tsb,charWidths:usb,charCoords:vsb}=jsb.generateShapes(ssb,isb),wsb=("number"==typeof ksb?ksb:1)*.5,xsb=("number"==typeof lsb?lsb:1)*.5,ysb=tsb.map(a=>new yXa().fromShape(a,!0));this.vectorShapes=ysb;let zsb=ysb.map(a=>C4a.create({shape:a,parameters:{depth:msb,extrudeBevelSegments:osb,extrudeBevelSize:nsb,windingRule:msb<=0?Gsb.NONZERO:Gsb.ODD,subdivisions:this.isLowResolution&&msb>0?asb:_rb}})),Asb=zsb.length?vKa(zsb):Zrb();Asb.translate(-wsb,xsb,0),this.dispose(),this.wrappedText=ssb,this.charCoords=vsb,this.charWidths=usb,this.deleteAttribute("extrudeNormal"),Object.entries(Asb.attributes).forEach(([a,b])=>{this.setAttribute(a,b)}),this.setIndex(Asb.index),this.computeBoundingSphere()}clone(){let Bsb=Gya(new nE,bsb.prototype);return Bsb.copy(this),console.log("CloneGeometry",this,Bsb),Bsb}copy(Csb){return Object.entries(Csb.attributes).forEach(([a,b])=>{this.setAttribute(a,b)}),this.setIndex(Csb.index),this.userData={parameters:{...Csb.userData.parameters},type:"TextGeometry"},this}async setText(Dsb){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:Dsb})}get text(){return this.userData.parameters.text??""}};function Esb(a,b,c){let d=[""],e="";for(let f of c)e+=f," "===f||f===`
`?(d[d.length-1]+=e,e="",f===`
`&&d.push("")):b.getTextWidth(d[d.length-1]+e,a)>a.width&&(d[d.length-1].length&&d.push(""),b.getTextWidth(d[d.length-1]+e,a)>a.width&&(1===e.length?(d[d.length-1]+=e,e=""):(d[d.length-1]+=e.slice(0,-1),e=e[e.length-1],d.push(""))));return d[d.length-1]+=e,d}var Fsb,Gsb,Hsb,Isb,Jsb=new Promise(a=>{Isb=a}),Ksb=!1,Lsb=["font"];function Msb(a,b,c,d){let e,f,g;for(let h of("PathGeometry"===a.type?(f=JSON.parse(JSON.stringify(a)),g=[[],["extrusion"]]):(f={...a},g=[[]]),g)){let i=f;for(let j of h)i=i[j];for(e in i){let k=i[e];TIa(k)&&!Lsb.includes(e)&&(i[e]=b.getVariable(k,[d.uuid,"geometry",...h,e]),TIa(i[e])&&(i[e]=1))}}let l={parameters:f,type:f.type};if("PathGeometry"===f.type)l.path=f.path;else if("VectorGeometry"===f.type){let m=yXa.createFromState(f.shape,f.width,f.height);l.shape=m}else if("NonParametricGeometry"===f.type)f.data.groups&&f.data.groups?.forEach(a=>a.materialIndex=Math.max(a.materialIndex??0,0)),l.geometry=new aga().parse(f);else if("SubdivGeometry"===f.type){let n=new Wsb(f,c);return n.data=a,n}else{if("TextGeometry"===f.type)return new bsb(f,b);if("UIGeometry"===f.type)return lib.create({parameters:{width:f.width,height:f.height,cornerRadius:f.cornerRadius,cornerType:f.cornerType}})}let o;try{o=pvb(l)}catch(p){console.error(p)}if(!o){let q=yXa.createFromState(pNa.defaultData(),100,100);l.shape=q,o=pvb(l)}return o}var Nsb=new rs;function Osb(a,b,c,d){let e=a.position.array,f=a.normal.array,g=Nsb.makeScale(b,c,d).invert().elements,h,i,j;for(var k=0,l=e.length;k<l;k+=3)e[k]*=b,e[k+1]*=c,e[k+2]*=d,h=f[k],i=f[k+1],j=f[k+2],f[k]=g[0]*h+g[4]*i+g[8]*j,f[k+1]=g[1]*h+g[5]*i+g[9]*j,f[k+2]=g[2]*h+g[6]*i+g[10]*j;a.position.needsUpdate=!0,a.normal.needsUpdate=!0}var Psb,Qsb,Rsb=new Io,Ssb=new fm;Jsb.then(a=>{Qsb=a});var Tsb=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),Usb=new Uint32Array([0,1,2,3]),Vsb=new Uint8Array([4]),Wsb=class extends nE{constructor(Xsb,Ysb){super(),this.data=Xsb,this.flatShading=Ysb,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(Zsb,$sb){this.freeSubdivPointer();let _sb=this.data.scaleBaked,atb=wJa.div($sb,_sb);this.subdividedGeometry&&Osb(this.subdividedGeometry.attributes,...atb),this.originalGeometry&&Osb(this.originalGeometry.attributes,...atb),this.data=Zsb;let btb=this.userData.parameters;this.userData.parameters={width:btb.width*atb[0],height:btb.height*atb[1],depth:btb.depth*atb[2]},this.originalGeometry.boundingSphere.center.multiply(Ssb.fromArray(atb));let ctb=Ssb.set(btb.width,btb.height,btb.depth).length();this.originalGeometry.boundingSphere.radius=ctb/2}ensureSubdivPointer(){return 0===this.subdivPointer&&this.rebuild(),this.subdivPointer}rebuild(){let dtb,etb,ftb;try{({originalGeometry:dtb,subdividedGeometry:etb,subdivPointer:ftb}=Wsb.build(this.data,void 0,!this.flatShading,void 0))}catch{dtb=new XI(100,100,100),ftb=0}this.subdivPointer=ftb,this.originalGeometry=dtb,this.subdividedGeometry=etb??void 0;let gtb=this.subdividedGeometry??this.originalGeometry;Object.assign(this,gtb),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(Wsb.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let htb=this.originalGeometry;null===htb.boundingSphere&&(htb.boundingSphere=new pq,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=htb.boundingSphere));let itb=htb.attributes.position,jtb=htb.boundingSphere.center;Rsb.setFromBufferAttribute(itb),Rsb.getCenter(jtb),htb.boundingSphere.radius=jtb.distanceTo(Rsb.max),isNaN(htb.boundingSphere.radius)&&console.error("THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.",this),Rsb.getSize(Ssb);let ktb={width:Ssb.x,height:Ssb.y,depth:Ssb.z};return this.userData.parameters=ktb,ktb}static build(ltb,mtb,ntb,otb){let ptb,qtb,rtb,stb=ltb?.phongAngle??35;!1===ntb&&(stb=-1),mtb&&(Qsb.free_bvh(mtb),Qsb.free_subdivision_surface(mtb));try{ptb=Wsb.allocate(ltb,otb)}catch(ttb){console.error(ttb,ltb),ptb=Wsb.allocate({positionWASM:Tsb,indexWASM:Usb,verticesPerFaceWASM:Vsb},otb)}if(Qsb.set_destination_refinement_level(ptb,0),qtb=Wsb.buildLevel(ptb,!0,stb),ltb.subdivisions>0)try{Qsb.set_destination_refinement_level(ptb,ltb.subdivisions),rtb=Wsb.buildLevel(ptb,!1,stb)}catch{try{Qsb.set_destination_refinement_level(ptb,ltb.subdivisions-1),rtb=Wsb.buildLevel(ptb,!1,stb)}catch{rtb=null}}else rtb=null;return{subdivPointer:ptb,originalGeometry:qtb,subdividedGeometry:rtb}}static primitiveToQuads(utb,vtb,wtb){utb.widthSegments>16&&(utb.widthSegments=16),utb.heightSegments>16&&(utb.heightSegments=16),utb.depthSegments>16&&(utb.depthSegments=16),utb.radialSegments>16&&(utb.radialSegments=16),"DodecahedronGeometry"===utb.type&&(utb.detail=0);let xtb=void 0!==utb.shape|| void 0!==utb.path?vtb.geometry:Msb(utb,wtb,!1),ytb;ytb="TorusGeometry"===utb.type&&utb.arc===2*Math.PI?xtb.getClosedTorusIndicesForBooleanOrSubdiv():xtb.getIndex();let ztb,Atb,Btb,Ctb;({positions:ztb,triIndices:Ctb}=Zub(xtb.getAttribute("position"),ytb));let Dtb;if("CylinderGeometry"===utb.type&&0===utb.cornerRadius&&0===utb.hollow&& !1===utb.openEnded){let Etb=utb.radialSegments*utb.heightSegments*6,Ftb=Etb+3*utb.radialSegments;Dtb=[Etb,Ftb]}return{indices:Atb,verticesPerFace:Btb}=cvb(ztb,Ctb,xtb,Dtb),{positions:ztb,indices:Atb,verticesPerFace:Btb}}static allocate(Gtb,Htb){let Itb,Jtb,Ktb,Ltb=[],Mtb=[];Gtb.positionWASM&&Gtb.positionWASM.length>0?(Itb=Gtb.positionWASM,Jtb=Gtb.indexWASM,Ktb=Gtb.verticesPerFaceWASM):(Itb=Tsb,Jtb=Usb,Ktb=Vsb);let Ntb=Itb.length,Otb=Jtb.length,Ptb=Ktb.length,Qtb=Itb.length+Ltb.length+Mtb.length,Rtb=Jtb.length+Ktb.length,Stb=Qtb*Float32Array.BYTES_PER_ELEMENT+Rtb*Uint32Array.BYTES_PER_ELEMENT,Ttb=Qtb*Float32Array.BYTES_PER_ELEMENT,Utb=Rtb*Uint32Array.BYTES_PER_ELEMENT,Vtb=Qsb._malloc(Stb),Wtb=new Float32Array(Qsb.HEAPF32.buffer,Vtb,Qtb),Xtb=new Uint32Array(Qsb.HEAPU32.buffer,Vtb+Ttb,Rtb);Wtb.set(Itb,0),Wtb.set(Ltb,Itb.length),Wtb.set(Mtb,Itb.length+Ltb.length),Xtb.set(Jtb,0),Xtb.set(Ktb,Jtb.length);let Ytb;Gtb?.scaleBaked?.some(a=>1!==a)&&(Ytb=new rs().makeScale(...Gtb.scaleBaked)),Htb&&(Ytb?Ytb.premultiply(Htb):Ytb=Htb);let Ztb=Ytb?Qsb.alloc_subdivision_surface2(Vtb,Ntb,Vtb+Ttb,Otb,Vtb+Ttb+Jtb.length*Uint32Array.BYTES_PER_ELEMENT,Ptb,Ytb.elements):Qsb.alloc_subdivision_surface(Vtb,Ntb,Vtb+Ttb,Otb,Vtb+Ttb+Jtb.length*Uint32Array.BYTES_PER_ELEMENT,Ptb);return Qsb._free(Vtb),Ztb}static buildLevel($tb,_tb,aub,bub,cub){let dub=cub?Qsb.get_mesh_data2($tb,_tb?Qsb.Level.CONTROL:Qsb.Level.REFINED,aub,cub.elements):Qsb.get_mesh_data($tb,_tb?Qsb.Level.CONTROL:Qsb.Level.REFINED,aub),eub=8,fub=Qsb.HEAPU32.subarray(dub>>2,(dub>>2)+eub),gub=fub.subarray(4,8),hub=0,iub=Qsb.HEAPU32[fub[hub]>>2],jub=Qsb.HEAPF32.subarray(iub>>2,(iub>>2)+gub[hub]);hub++;let kub=Qsb.HEAPU32[fub[hub]>>2],lub=Qsb.HEAPF32.subarray(kub>>2,(kub>>2)+gub[hub]);hub++;let mub=Qsb.HEAPU32[fub[hub]>>2],nub=Qsb.HEAPU32.subarray(mub>>2,(mub>>2)+gub[hub]);hub++;let oub=Qsb.HEAPU32[fub[hub]>>2],pub=Qsb.HEAPU32.subarray(oub>>2,(oub>>2)+gub[hub]);if(hub++,void 0===bub){let qub=new nE;if(qub.setIndex(new $D(pub,1)),qub.setAttribute("position",new cE(jub,3)),qub.setAttribute("normal",new cE(lub,3)),_tb){qub.setAttribute("faceMap",new $D(nub,1));let rub=new Float32Array(lub.length/3*4).fill(0);qub.setAttribute("color",new RC(rub,4))}return Qsb.free_mesh_data(dub),qub.userData.type="SubdivGeometry",qub}bub.getAttribute("position").copyArray(jub),bub.getAttribute("normal").copyArray(lub),bub.attributes.position.needsUpdate=!0,bub.attributes.normal.needsUpdate=!0,Qsb.free_mesh_data(dub)}static freeSubdivPointer(sub){Qsb.free_bvh(sub),Qsb.free_subdivision_surface(sub)}static buildControlCageWireframe(tub,uub,vub){let wub=Qsb.get_wireframe_data_for_base_level(tub),xub=4,yub=Qsb.HEAPU32.subarray(wub>>2,(wub>>2)+xub),zub=yub.subarray(2,4),Aub=0,Bub=Qsb.HEAPU32[yub[Aub]>>2],Cub=Qsb.HEAPF32.subarray(Bub>>2,(Bub>>2)+zub[Aub]);Aub++;let Dub=Qsb.HEAPU32[yub[Aub]>>2],Eub=Qsb.HEAPU32.subarray(Dub>>2,(Dub>>2)+zub[Aub]);if(void 0===uub){let Fub=new nE;Fub.setAttribute("position",new cE(Cub,3));let Gub=new Float32Array(Cub.length);for(let Hub=0,Iub=Cub.length;Hub<Iub;)Gub[Hub++]=vub.r,Gub[Hub++]=vub.g,Gub[Hub++]=vub.b;return Fub.setAttribute("color",new RC(Gub,3)),Fub.setIndex(new $D(Eub,1)),Qsb.free_wireframe_data_for_base_level(wub),Fub}uub.getAttribute("position").copyArray(Cub),uub.attributes.position.needsUpdate=!0,Qsb.free_wireframe_data_for_base_level(wub)}static updateCollabMesh(Jub,Kub,Lub){let Mub=0===Kub;Mub||Qsb.set_destination_refinement_level(Jub,Kub);let Nub=Lub?Qsb.get_topological_data2(Jub,Mub?Qsb.Level.CONTROL:Qsb.Level.REFINED,Lub.elements):Qsb.get_topological_data(Jub,Mub?Qsb.Level.CONTROL:Qsb.Level.REFINED),Oub=6,Pub=Qsb.HEAPU32.subarray(Nub>>2,(Nub>>2)+Oub),Qub=Pub.subarray(3,6),Rub=0,Sub=Qsb.HEAPU32[Pub[Rub]>>2],Tub=new Float32Array(Qsb.HEAPF32.subarray(Sub>>2,(Sub>>2)+Qub[Rub]));Rub++;let Uub=Qsb.HEAPU32[Pub[Rub]>>2],Vub=new Uint32Array(Qsb.HEAPU32.subarray(Uub>>2,(Uub>>2)+Qub[Rub]));Rub++;let Wub=Qsb.HEAPU32[Pub[Rub]>>2],Xub=new Uint8Array(Qsb.HEAPU32.subarray(Wub>>2,(Wub>>2)+Qub[Rub]));return Qsb.free_topological_data(Nub),{positions:Tub,indices:Vub,verticesPerFace:Xub}}},Yub=["getX","getY","getZ"];function Zub(a,b){let c={},d=b?b.count:a.count,e=0,f=[],g=[];for(let h=0;h<d;h++){let i=b?b.getX(h):h,j="";for(let k=0;k<3;k++)j+=`${~~(1e4*a[Yub[k]](i))},`;if(j in c)f.push(c[j]);else{for(let l=0;l<3;l++)g.push(a[Yub[l]](i));c[j]=e,f.push(e),e++}}let m=[];for(let n=0;n<f.length;n+=3)f[n]===f[n+1]||f[n]===f[n+2]||f[n+1]===f[n+2]||m.push(f[n],f[n+1],f[n+2]);return{positions:g,triIndices:m}}var $ub=new fm,_ub=new fm,avb=new fm,bvb=new fm;function cvb(a,b,c,d){let e=[],f=[];if(void 0!==c.userData.shape&&0===c.userData.parameters.depth&&0===c.userData.shape.shapeHoles.length){let g=c.userData.shape.extractShapePointsToFlatArray([]),h=c.userData.parameters.spikes;if("EllipseGeometry"===c.userData.type&&h<=24&&h%4==0&&c.userData.parameters.angle>=360){let i=g.length/2/h;g=g.filter((a,b)=>Math.floor(b/2)%i==0)}let j=0;for(let k=0;k<g.length;k+=2)j+=(g[k]-g[(0===k?g.length:k)-2])*(g[k+1]+g[(0===k?g.length:k)-1]);a.length=0;let l=0;if(j<0)for(let m=0;m<g.length;m+=2)a.push(g[m],g[m+1],0),e.push(l++);else for(let n=g.length-2;n>=0;n-=2)a.push(g[n],g[n+1],0),e.push(l++);return f.push(l),{indices:e,verticesPerFace:f}}let o=new Float32Array([c.userData.parameters.depth])[0],p=0;for(;p<b.length;){if(c.useNgonForTopBottomFaceDuringBake){let q=0;if((a[3*b[p]+2]===o||0===a[3*b[p]+2])&&q++,(a[3*b[p+1]+2]===o||0===a[3*b[p+1]+2])&&q++,(a[3*b[p+2]+2]===o||0===a[3*b[p+2]+2])&&q++,3===q)break}b[p+1]===b[p+3]&&b[p+2]===b[p+5]||b[p+0]===b[p+3]&&b[p+2]===b[p+4]?($ub.set(a[3*b[p]],a[3*b[p]+1],a[3*b[p]+2]),_ub.set(a[3*b[p+1]],a[3*b[p+1]+1],a[3*b[p+1]+2]),avb.set(a[3*b[p+4]],a[3*b[p+4]+1],a[3*b[p+4]+2]),bvb.set(a[3*b[p+5]],a[3*b[p+5]+1],a[3*b[p+5]+2]),_ub.sub($ub).normalize(),avb.sub($ub).normalize(),bvb.sub($ub).normalize(),Math.abs(_ub.cross(avb).dot(bvb))>.005||d&&d.some((a,b)=>b%2!=1&&p>=d[b]&&p<d[b+1])?(e.push(b[p],b[p+1],b[p+2]),f.push(3),p+=3):(e.push(b[p],b[p+1],b[p+4],b[p+5]),f.push(4),p+=6)):(e.push(b[p],b[p+1],b[p+2]),f.push(3),p+=3)}if(c.useNgonForTopBottomFaceDuringBake){let r=[],s=[],t=0;for(let u=0,v=0;u<a.length;u+=3,v++)0===a[u+2]&&(r.push(v),t++),a[u+2]===o&&s.push(v);if(0===c.userData.parameters.extrudeBevelSize){let w=s[0];s[0]=s[1],s[1]=w}r.reverse(),e.push(...r,...s),f.push(t,t)}return{indices:e,verticesPerFace:f}}var dvb={};p(dvb,{calcBoolean:()=>jvb,calcBooleanTopological:()=>ivb,freeMeshSet:()=>nvb,getMeshSet:()=>kvb,hasOpenEdges:()=>lvb,transformMeshSet:()=>mvb});var evb,fvb=new Promise(a=>{evb=a});function gvb(a){let b=a.length,c=b*Uint32Array.BYTES_PER_ELEMENT,d=b*Float32Array.BYTES_PER_ELEMENT,e=Number.isInteger(a[0])?c:d,f=BOb._malloc(e);return(Number.isInteger(a[0])?new Uint32Array(BOb.HEAPU32.buffer,f,b):new Float32Array(BOb.HEAPF32.buffer,f,b)).set(a,0),f}function hvb(a){switch(a){case 0:return BOb.OP.UNION;case 1:return BOb.OP.INTERSECTION;case 2:return BOb.OP.A_MINUS_B;case 3:return BOb.OP.B_MINUS_A;case 4:return BOb.OP.SYMMETRIC_DIFFERENCE;case 5:return BOb.OP.ALL;default:throw new Error("Unknown boolean operation "+a)}}function ivb(a,b){void 0===COb&&(COb=BOb.init_csg());let c=gvb(a),d=BOb.csg_calc_topological(COb,c,a.length,hvb(b));BOb._free(c);let e=6,f=BOb.HEAPU32.subarray(d>>2,(d>>2)+e),g=f.subarray(3,6),h=0,i=BOb.HEAPU32[f[h]>>2],j=new Float32Array(BOb.HEAPF32.subarray(i>>2,(i>>2)+g[h]));h++;let k=BOb.HEAPU32[f[h]>>2],l=new Uint32Array(BOb.HEAPU32.subarray(k>>2,(k>>2)+g[h]));h++;let m=BOb.HEAPU32[f[h]>>2],n=new Uint8Array(BOb.HEAPU32.subarray(m>>2,(m>>2)+g[h]));return BOb.free_mesh_data(d),{positions:j,indices:l,verticesPerFace:n}}function jvb(a,b,c,d){void 0===COb&&(COb=BOb.init_csg());let e=gvb(a),f=BOb.csg_calc(COb,e,a.length,d,hvb(b));BOb._free(e);let g=5,h=BOb.HEAPU32.subarray(f>>2,(f>>2)+g),i=h.subarray(2,5),j=0,k=BOb.HEAPU32[h[j]>>2],l=BOb.HEAPF32.subarray(k>>2,(k>>2)+i[j]);j++;let m=BOb.HEAPU32[h[j]>>2],n=BOb.HEAPF32.subarray(m>>2,(m>>2)+i[j]);j++;let o=i[j];c.setAttribute("position",new cE(l,3)),c.setAttribute("normal",new cE(n,3));let p=BOb.HEAPF32.subarray((f>>2)+5,(f>>2)+5+6);return null===c.boundingSphere&&(c.boundingSphere=new pq),c.boundingSphere.center.set(p[0],p[1],p[2]),c.boundingSphere.radius=(p[3]**2+p[4]**2+p[5]**2)**.5,c.userData.parameters={width:2*p[3],height:2*p[4],depth:2*p[5]},BOb.free_mesh_data(f),o}function kvb(a,b,c){if(void 0===BOb)return -1;let d,e,f;if(b&& void 0!==a.userData.positions){let g=a.userData;f=g.verticesPerFace.length,d=g.positions,e=Array(g.verticesPerFace.reduce((a,b)=>a+b,0)+f);for(let h=0,i=0,j=0;h<g.verticesPerFace.length;h++){e[j++]=g.verticesPerFace[h];for(let k=0;k<g.verticesPerFace[h];k++)e[j++]=g.indices[i++]}}else({positions:d,faceIndices:e,nFaces:f}=(function(a,b,c){let d,e;e="TorusGeometry"===a.userData.parameters.type&&a.userData.parameters.arc===2*Math.PI?a.getClosedTorusIndicesForBooleanOrSubdiv():a.getIndex();let{positions:f,triIndices:g}=Zub(a.getAttribute("position"),e),h;if(b&&c){let{indices:i,verticesPerFace:j}=cvb(f,g,a);h=j.length,d=[];for(let k=0,l=0;k<h;k++){d.push(j[k]);for(let m=0;m<j[k];m++)d.push(i[l++])}}else{let n=g.length;d=Array(n+n/3),h=0;for(let o=0,p=0;p<d.length;)d[p++]=3,h++,d[p++]=g[o++],d[p++]=g[o++],d[p++]=g[o++]}return{positions:f,faceIndices:d,nFaces:h}})(a,b,c));let l=d.length,m=e.length,n=d.length,o=e.length,p=n*Float32Array.BYTES_PER_ELEMENT+o*Uint32Array.BYTES_PER_ELEMENT,q=n*Float32Array.BYTES_PER_ELEMENT,r=o*Uint32Array.BYTES_PER_ELEMENT,s=BOb._malloc(p),t=new Float32Array(BOb.HEAPF32.buffer,s,n),u=new Uint32Array(BOb.HEAPU32.buffer,s+q,o);t.set(d,0),u.set(e,0);let v=BOb.get_csg_mesh(s,l,s+q,m,f);return BOb._free(s),v}function lvb(a){return BOb.has_open_edges(a)}function mvb(a,b){BOb.transform_csg_mesh(a,b.elements)}function nvb(a){BOb.free_csg_mesh(a)}fvb.then(a=>BOb=a);var ovb={ConeGeometry:MUa,CubeGeometry:cVa,CylinderGeometry:dTa,DodecahedronGeometry:WVa,EllipseGeometry:W4a,HelixGeometry:u5a,IcosahedronGeometry:F7a,LatheGeometry:_7a,NonParametricGeometry:tfb,PolygonGeometry:Lfb,PyramidGeometry:jgb,RectangleGeometry:lib,SphereGeometry:Nib,PlaneGeometry:bjb,BackdropGeometry:mjb,StarGeometry:skb,TextFrameGeometry:$kb,TorusGeometry:hlb,TorusKnotGeometry:Alb,TriangleGeometry:Olb,PathGeometry:Unb,VectorGeometry:C4a},pvb=a=>ovb[a.type].create(a);function qvb(a){return null!==a&&"booleanOp"in a}var rvb=class extends cTa(GH){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new rs}updateVisible(svb){super.updateVisible(svb),this.visible=!qvb(this.parent)&&this.visible,qvb(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){-1!==this.booleanMeshSetAddress&&(dvb.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(tvb=!1){return tvb?this.booleanWasTransformed=!0:this.freeBooleanPointer(),qvb(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){for(let uvb of(this.freeBooleanPointer(),this.children))uvb instanceof rvb&&(uvb.freeBooleanPointer(),qvb(uvb)&&uvb.invalidateUpstreamBooleanData())}updateTransformState(vvb,wvb){let xvb=super.updateTransformState(vvb,wvb);return xvb&&qvb(this.parent)&&this.invalidateDownstreamBooleanData(!0),xvb}onVariableUpdate(yvb=!1){super.onVariableUpdate(yvb),qvb(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},zvb=new Io;function Avb(a,b=0,c=a.count,d,e){let f=1/0,g=1/0,h=1/0,i=-1/0,j=-1/0,k=-1/0;for(let l=b;l<c;l++){let m=a.getX(l),n=a.getY(l),o=a.getZ(l);m<f&&(f=m),n<g&&(g=n),o<h&&(h=o),m>i&&(i=m),n>j&&(j=n),o>k&&(k=o)}zvb.min.set(f,g,h),zvb.max.set(i,j,k),zvb.getCenter(d),zvb.getSize(e).multiplyScalar(.5)}var Bvb=class extends rvb{constructor(Cvb,Dvb){super(new nE,new MC),this.super_Entity(Cvb,Dvb)}updateState(Evb,Fvb){this.updateState_Entity(Evb,Fvb)}updateEntityBoxSize(Gvb,Hvb){let Ivb=this.geometry.getAttribute("position");void 0!==Ivb?Avb(Ivb,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:Ivb.count,Gvb,Hvb):super.updateEntityBoxSize(Gvb,Hvb)}},Jvb=class{constructor(Kvb){Kvb=Kvb??{},this.name=Kvb.name,this.type=Kvb.type,this.node=Kvb.node,this.size=Kvb.size,this.needsUpdate=Kvb.needsUpdate}get value(){return this.node.value}set value(Lvb){this.node.value=Lvb}},Mvb=class{constructor(Nvb){this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},this.uuid=Db.generateUUID(),this.type=Nvb,this.name=""}analyze(Ovb,Pvb){Pvb=Pvb??{},Ovb.analyzing=!0,this.build(Ovb.addFlow(Pvb.slot,Pvb.cache,Pvb.context),"v4"),Ovb.clearVertexNodeCode(),Ovb.clearFragmentNodeCode(),Ovb.removeFlow(),Ovb.analyzing=!1}analyzeAndFlow(Qvb,Rvb,Svb){return Svb=Svb??{},this.analyze(Qvb,Svb),this.flow(Qvb,Rvb,Svb)}flow(Tvb,Uvb,Vvb){Vvb=Vvb??{},Tvb.addFlow(Vvb.slot,Vvb.cache,Vvb.context);let Wvb={result:this.build(Tvb,Uvb),code:Tvb.clearNodeCode(),extra:Tvb.context.extra};return Tvb.removeFlow(),Wvb}build(Xvb,Yvb,Zvb){Yvb=Yvb??this.getType(Xvb,Yvb);let $vb=Xvb.getNodeData(Zvb??this);return Xvb.analyzing&&this.appendDepsNode(Xvb,$vb,Yvb),-1===Xvb.nodes.indexOf(this)&&Xvb.nodes.push(this),void 0!==this.updateFrame&& -1===Xvb.updaters.indexOf(this)&&Xvb.updaters.push(this),this.generate(Xvb,Yvb,Zvb)}updateFrame(_vb){}generateReadonly(awb,bwb,cwb,dwb,ewb,fwb){return""}generate(gwb,hwb,iwb,jwb,kwb){return""}parse(lwb,mwb,nwb,owb){}appendDepsNode(pwb,qwb,rwb){qwb.deps=(qwb.deps||0)+1;let swb=pwb.getTypeLength(rwb);(swb>(qwb.outputMax||0)||this.getType(pwb,rwb))&&(qwb.outputMax=swb,qwb.output=rwb)}setName(twb){this.name=twb}getName(){return this.name}getType(uwb,vwb){return"sampler2D"===vwb||"samplerCube"===vwb?vwb:this.type}getHash(){let wwb="{",xwb,ywb;for(xwb in this)(ywb=this[xwb])instanceof Mvb&&(wwb+="\""+xwb+"\":"+ywb.getHash()+",");if(this.hashProperties)for(let zwb=0;zwb<this.hashProperties.length;zwb++)ywb=this[xwb=this.hashProperties[zwb]],wwb+="\""+xwb+"\":\""+String(ywb)+"\",";return wwb+="\"id\":\""+this.uuid+"\"}"}},Awb=new class{constructor(){this.nodes={},this.keywords={}}add(Bwb){this.nodes[Bwb.name]=Bwb}addKeyword(Cwb,Dwb,Ewb){Ewb=void 0===Ewb||Ewb,this.keywords[Cwb]={callback:Dwb,cache:Ewb}}remove(Fwb){delete this.nodes[Fwb.name]}removeKeyword(Gwb){delete this.keywords[Gwb]}get(Hwb){return this.nodes[Hwb]}getKeyword(Iwb,Jwb){return this.keywords[Iwb].callback(Jwb)}getKeywordData(Kwb){return this.keywords[Kwb]}contains(Lwb){return void 0!==this.nodes[Lwb]}containsKeyword(Mwb){return void 0!==this.keywords[Mwb]}},Nwb=class extends Mvb{constructor(Owb,Pwb){super(Owb),this.scope="",Pwb=Pwb??{},this.shared=void 0===Pwb.shared||Pwb.shared,this.unique=void 0!==Pwb.unique&&Pwb.unique}build(Qwb,Rwb,Swb,Twb){if(Rwb=Rwb??this.getType(Qwb),this.getShared(Qwb,Rwb)){let Uwb=this.getUnique(Qwb,Rwb);Uwb&& void 0===this.uuid&&(this.uuid=Db.generateUUID()),Swb=Qwb.getUUID(Swb??this.getUUID(),!Uwb);let Vwb=Qwb.getNodeData(Swb),Wwb=Vwb.output||this.getType(Qwb);if(Qwb.analyzing)return(Vwb.deps||0)>0||this.getLabel()?(this.appendDepsNode(Qwb,Vwb,Rwb),this.generate(Qwb,Rwb,Swb)):super.build(Qwb,Rwb,Swb);if(Uwb)return Vwb.name=Vwb.name||super.build(Qwb,Rwb,Swb),Vwb.name;if(!this.getLabel()&&(!this.getShared(Qwb,Wwb)||Qwb.context.ignoreCache||1===Vwb.deps))return super.build(Qwb,Rwb,Swb);Swb=this.getUUID(!1);let Xwb=this.getTemp(Qwb,Swb);if(Xwb)return Qwb.format(Xwb,Wwb,Rwb);{Xwb=super.generate(Qwb,Rwb,Swb,Vwb.output,Twb);let Ywb=this.generate(Qwb,Wwb,Swb);return Qwb.addNodeCode(Xwb+" = "+Ywb+";"),Qwb.format(Xwb,Wwb,Rwb)}}return super.build(Qwb,Rwb,Swb)}getShared(Zwb,$wb){return"sampler2D"!==$wb&&"samplerCube"!==$wb&&this.shared}getUnique(_wb,axb){return this.unique}setLabel(bxb){return this.label=bxb,this}getLabel(){return this.label}getUUID(cxb){let dxb=this.uuid;return"string"==typeof this.scope&&(dxb=this.scope+"-"+dxb),dxb}getTemp(exb,fxb){fxb=fxb||this.uuid;let gxb=exb.getVars()[fxb];return gxb?gxb.name:void 0}generate(hxb,ixb,jxb,kxb,lxb){return this.getShared(hxb,ixb)||console.error("TempNode is not shared"),jxb=jxb??this.uuid,hxb.getTempVar(jxb,kxb??this.getType(hxb),lxb,this.getLabel()).name}},mxb=class extends Nwb{constructor(nxb,oxb){(oxb=oxb??{}).shared=void 0!==oxb.shared&&oxb.shared,super(nxb,oxb),this.readonly=!1}setReadonly(pxb){return this.readonly=pxb,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(qxb,rxb,sxb,txb,uxb,vxb){sxb=qxb.getUUID(sxb??this.getUUID()),txb=txb??this.getType(qxb);let wxb=qxb.getNodeData(sxb);return this.getReadonly()&& void 0!==this.generateReadonly?this.generateReadonly(qxb,rxb,sxb,txb,uxb,vxb):qxb.isShader("vertex")?(wxb.vertex||(wxb.vertex=qxb.createVertexUniform(txb,this,uxb,vxb,this.getLabel())),qxb.format(wxb.vertex.name,txb,rxb)):(wxb.fragment||(wxb.fragment=qxb.createFragmentUniform(txb,this,uxb,vxb,this.getLabel())),qxb.format(wxb.fragment.name,txb,rxb))}},xxb=class extends mxb{constructor(yxb=0,zxb){super("v2"),this.nodeType="Vector2",this.value=yxb instanceof Eb?yxb:new Eb(yxb,zxb)}get x(){return this.value.x}set x(Axb){this.value.x=Axb}get y(){return this.value.y}set y(Bxb){this.value.y=Bxb}generateReadonly(Cxb,Dxb,Exb,Fxb,Gxb,Hxb){return Cxb.format("vec2("+this.value.x+", "+this.value.y+")",Fxb,Dxb)}},Ixb=class extends mxb{constructor(Jxb=0,Kxb,Lxb){super("v3"),this.nodeType="Vector3",this.value=Jxb instanceof fm?Jxb:new fm(Jxb,Kxb,Lxb)}get x(){return this.value.x}set x(Mxb){this.value.x=Mxb}get y(){return this.value.y}set y(Nxb){this.value.y=Nxb}get z(){return this.value.z}set z(Oxb){this.value.z=Oxb}generateReadonly(Pxb,Qxb,Rxb,Sxb,Txb,Uxb){return Pxb.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",Sxb,Qxb)}},Vxb=class extends df{constructor(Wxb,Xxb,Yxb,Zxb){super(Wxb,Xxb,Yxb),this.isColorA=!0,this.a=Zxb}setRGBA($xb,_xb,ayb,byb){super.setRGB($xb,_xb,ayb),this.a=byb}copy(cyb){return super.copy(cyb),this.a="a"in cyb?cyb.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(dyb){return super.equals(dyb)&&this.a===dyb.a}setStyle(eyb,fyb="srgb"){let gyb;if("transparent"===eyb)return this.setRGBA(0,0,0,0),this;if(gyb=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(eyb)){let hyb,iyb=gyb[1],jyb=gyb[2];switch(iyb){case"rgb":case"rgba":if(hyb=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(jyb))return this.a="rgba"===iyb?parseFloat(hyb[4]):1,super.setStyle(eyb,fyb);break;case"hsl":case"hsla":if(hyb=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(jyb))return this.a="hsla"===iyb?parseFloat(hyb[4]):1,super.setStyle(eyb,fyb);break}}return super.setStyle(eyb,fyb)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(kyb){this.r=kyb}set y(lyb){this.g=lyb}set z(myb){this.b=myb}set w(nyb){this.a=nyb}},oyb=class extends mxb{constructor(pyb){super("v4"),this.nodeType="Vector4",this.value=pyb instanceof Vxb?pyb:new Vxb(pyb.r,pyb.g,pyb.b,pyb.a)}generateReadonly(qyb,ryb,syb,tyb,uyb,vyb){return qyb.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",tyb,ryb)}},wyb=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,xyb=/[a-z_0-9]+/gi,yyb=class extends Nwb{constructor(zyb,Ayb,Byb,Cyb,Dyb){super(Dyb),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=void 0===Dyb,this.isInterface=!1,this.parse(zyb,Ayb,Byb,Cyb)}getShared(Eyb,Fyb){return!this.isMethod}getType(Gyb){return Gyb.getTypeByFormat(this.type)}getInputByName(Hyb){if(this.inputs){let Iyb=this.inputs.length;for(;Iyb--;)if(this.inputs[Iyb].name===Hyb)return this.inputs[Iyb]}}getIncludeByName(Jyb){if(this.includes){let Kyb=this.includes.length;for(;Kyb--;)if(this.includes[Kyb].name===Jyb)return this.includes[Kyb]}}generate(Lyb,Myb,Nyb,Oyb,Pyb){let Qyb,Ryb=0,Syb=this.src;if(this.includes)for(let Tyb=0;Tyb<this.includes.length;Tyb++)Lyb.include(this.includes[Tyb],this);for(let Uyb in this.extensions)Lyb.extensions[Uyb]=!0;let Vyb=[];for(;Qyb=xyb.exec(this.src);)Vyb.push(Qyb);for(let Wyb=0;Wyb<Vyb.length;Wyb++){let Xyb=Vyb[Wyb],Yyb=Xyb[0],Zyb=!this.isMethod||!this.getInputByName(Yyb),$yb=Yyb;if(this.keywords[Yyb]||this.useKeywords&&Zyb&&Awb.containsKeyword(Yyb)){let _yb=this.keywords[Yyb];if(!_yb){let azb=Awb.getKeywordData(Yyb);azb.cache&&(_yb=Lyb.keywords[Yyb]),_yb=_yb||Awb.getKeyword(Yyb,Lyb),azb.cache&&(Lyb.keywords[Yyb]=_yb)}$yb=_yb.build(Lyb)}Yyb!==$yb&&"."!==Syb[Xyb.index+Ryb-1]&&(Syb=Syb.substring(0,Xyb.index+Ryb)+$yb+Syb.substring(Xyb.index+Yyb.length+Ryb),Ryb+=$yb.length-Yyb.length),void 0===this.getIncludeByName($yb)&&Awb.contains($yb)&&Lyb.include(Awb.get($yb))}return"source"===Myb?Syb:this.isMethod?(this.isInterface||Lyb.include(this,void 0,Syb),this.name):Lyb.format("( "+Syb+" )",this.getType(Lyb),Myb)}parse(bzb,czb,dzb,ezb){if(this.src=bzb||"",this.includes=czb??[],this.extensions=dzb??{},this.keywords=ezb??{},this.isMethod){let fzb=wyb.exec(this.src);if(this.inputs=[],fzb&&4==fzb.length){this.type=fzb[1],this.name=fzb[2];let gzb=fzb[3].match(xyb);if(gzb){let hzb=0;for(;hzb<gzb.length;){let izb=gzb[hzb++],jzb;"in"===izb||"out"===izb||"inout"===izb?jzb=gzb[hzb++]:(jzb=izb,izb="");let kzb=gzb[hzb++];this.inputs.push({name:kzb,type:jzb,qualifier:izb})}}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}},lzb=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,mzb=class extends Nwb{constructor(nzb="",ozb){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(nzb||mzb.PI,void 0,void 0,void 0,ozb)}getType(pzb){return pzb.getTypeByFormat(this.type)}parse(qzb,rzb,szb,tzb,uzb){this.src=qzb||"";let vzb,wzb,xzb="",yzb=lzb.exec(qzb);this.useDefine=uzb??"#"===this.src.charAt(0),yzb&&yzb.length>1?(wzb=yzb[1],vzb=yzb[2],xzb=yzb[3]):(vzb=this.src,wzb="f"),this.name=vzb,this.type=wzb,this.value=xzb}build(zzb,Azb){if("source"===Azb){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return zzb.include(this),zzb.format(this.name,this.getType(zzb),Azb)}generate(Bzb,Czb,Dzb,Ezb,Fzb){return Bzb.format(this.name,this.getType(Bzb),Czb)}},Gzb=mzb;Gzb.PI="PI",Gzb.PI2="PI2",Gzb.RECIPROCAL_PI="RECIPROCAL_PI",Gzb.RECIPROCAL_PI2="RECIPROCAL_PI2",Gzb.LOG2="LOG2",Gzb.EPSILON="EPSILON";var Hzb=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),Izb=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),Jzb=class extends Nwb{constructor(Kzb=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(Kzb)}getType(Lzb){return Lzb.getTypeByFormat(this.name)}getInputByName(Mzb){let Nzb=this.inputs.length;for(;Nzb--;)if(this.inputs[Nzb].name===Mzb)return this.inputs[Nzb]}generate(Ozb,Pzb,Qzb,Rzb,Szb){return"source"===Pzb?this.src+";":Ozb.format("( "+this.src+" )",this.getType(Ozb),Pzb)}parse(Tzb=""){this.src=Tzb,this.inputs=[];let Uzb=Hzb.exec(Tzb);if(Uzb){let Vzb=Uzb[2],Wzb;for(;Wzb=Izb.exec(Vzb);)this.inputs.push({type:Wzb[1],name:Wzb[2]});this.name=Uzb[1]}else this.name="";this.type=this.name}},Xzb=class extends Nwb{constructor(Yzb){super("v2",{shared:!1}),this.nodeType="UV",this.index=Yzb??0}generate(Zzb,$zb){Zzb.requires.uv[this.index]=!0;let _zb=this.index>0?this.index+1:"",aAb=Zzb.isShader("vertex")?"uv"+_zb:"vUv"+_zb;return Zzb.format(aAb,this.getType(Zzb),$zb)}};Awb.addKeyword("uv",function(){return new Xzb}),Awb.addKeyword("uv2",function(){return new Xzb(1)});var bAb=class extends Nwb{constructor(cAb,dAb){super("v4"),this.nodeType="ColorSpace",this.input=cAb,this.method=dAb??bAb.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(eAb){switch(eAb){case Sa:return["Linear"];case Ta:return["sRGB"];default:return[]}}generate(fAb,gAb){let hAb=this.input.build(fAb,"v4"),iAb=this.getType(fAb),jAb=bAb.Nodes[this.method],kAb=fAb.include(jAb);if(kAb===bAb.LINEAR_TO_LINEAR)return fAb.format(hAb,iAb,gAb);if(jAb.inputs?.length!==2)return fAb.format(kAb+"( "+hAb+" )",iAb,gAb);{let lAb=this.factor.build(fAb,"f");return fAb.format(kAb+"( "+hAb+", "+lAb+" )",iAb,gAb)}}fromEncoding(mAb){let nAb=bAb.getEncodingComponents(mAb);this.method="LinearTo"+nAb[0],this.factor=nAb[1]}fromDecoding(oAb){let pAb=bAb.getEncodingComponents(oAb);this.method=pAb[0]+"ToLinear",this.factor=pAb[1]}},qAb=bAb;qAb.Nodes={LinearToLinear:new yyb(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join(`
`)),sRGBToLinear:new yyb(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new yyb(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},qAb.LINEAR_TO_LINEAR="LinearToLinear",qAb.SRGB_TO_LINEAR="sRGBToLinear",qAb.LINEAR_TO_SRGB="LinearTosRGB";var rAb=class extends yyb{constructor(sAb="",tAb,uAb,vAb,wAb){super(sAb,wAb,vAb,uAb,tAb),this.nodeType="Expression"}},xAb=class extends mxb{constructor(yAb=new ah,zAb,AAb,BAb){super("v4",{shared:!0}),this.nodeType="Texture",this.value=yAb,this.uv=zAb??new Xzb,this.bias=AAb,this.project=void 0!==BAb&&BAb}getTexture(CAb,DAb){return super.generate(CAb,DAb,this.value.uuid,"t")}generate(EAb,FAb){if("sampler2D"===FAb)return this.getTexture(EAb,FAb);let GAb=this.getTexture(EAb,FAb),HAb=this.uv.build(EAb,this.project?"v4":"v2"),IAb=this.bias?this.bias.build(EAb,"f"):void 0;void 0===IAb&&EAb.context.bias&&(IAb=EAb.context.bias.setTexture(this).build(EAb,"f"));let JAb,KAb;JAb=this.project?"texture2DProj":IAb?"tex2DBias":"tex2D",KAb=IAb?JAb+"( "+GAb+", "+HAb+", "+IAb+" )":JAb+"( "+GAb+", "+HAb+" )";let LAb={include:EAb.isShader("vertex"),ignoreCache:!0},MAb=this.getType(EAb);return EAb.addContext(LAb),this.colorSpace=this.colorSpace??new qAb(new rAb("",MAb)),this.colorSpace.fromDecoding(EAb.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(KAb),KAb=this.colorSpace.build(EAb,MAb),EAb.removeContext(),EAb.format(KAb,MAb,FAb)}},NAb=class extends mxb{constructor(OAb){super("f"),this.nodeType="Float",this.value=OAb??0}generateReadonly(PAb,QAb,RAb,SAb,TAb,UAb){return PAb.format(this.value+(this.value%1?"":".0"),SAb,QAb)}},VAb=class extends Nwb{constructor(WAb,XAb){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=WAb,this.inputs=XAb??[]}getFunction(){return this.value}getType(YAb){return this.value.getType(YAb)}generate(ZAb,$Ab,_Ab,aBb,bBb){aBb=this.getType(ZAb);let cBb=this.value,dBb=cBb.build(ZAb,$Ab)+"( ",eBb=[];if(cBb.inputs){for(let fBb=0;fBb<cBb.inputs.length;fBb++){let gBb=cBb.inputs[fBb],hBb=this.inputs[fBb]||this.inputs[gBb.name];eBb.push(hBb.build(ZAb,ZAb.getTypeByFormat(gBb.type)))}dBb+=eBb.join(", ")+" )"}return ZAb.format(dBb,aBb,$Ab)}},iBb=class extends Nwb{constructor(jBb,kBb,lBb=iBb.ADD){super(),this.nodeType="Operator",this.type=jBb.type,this.a=jBb,this.b=kBb,this.op=lBb}getType(mBb){let nBb=this.a.getType(mBb),oBb=this.b.getType(mBb);return mBb.isTypeMatrix(nBb)?"v4":mBb.getTypeLength(oBb)>mBb.getTypeLength(nBb)?oBb:nBb}generate(pBb,qBb){let rBb=this.getType(pBb);this.type=rBb;let sBb=this.a.build(pBb,rBb),tBb=this.b.build(pBb,rBb);return pBb.format("( "+sBb+" "+this.op+" "+tBb+" )",rBb,qBb)}},uBb=iBb;uBb.ADD="+",uBb.SUB="-",uBb.MUL="*",uBb.DIV="/";var vBb=class extends Nwb{constructor(wBb,xBb=vBb.ABS,yBb,zBb){super(),this.nodeType="Math",this.a=wBb,"string"!=typeof xBb?this.b=xBb:zBb=xBb,"string"!=typeof yBb?this.c=yBb:zBb=yBb,this.method=zBb,this.hashProperties=["method"]}getNumInputs(ABb){switch(this.method){case vBb.MIX:case vBb.CLAMP:case vBb.REFRACT:case vBb.SMOOTHSTEP:case vBb.FACEFORWARD:return 3;case vBb.MIN:case vBb.MAX:case vBb.MOD:case vBb.STEP:case vBb.REFLECT:case vBb.DISTANCE:case vBb.DOT:case vBb.CROSS:case vBb.POW:return 2;default:return 1}}getInputType(BBb){let CBb=BBb.getTypeLength(this.a.getType(BBb)),DBb=this.b?BBb.getTypeLength(this.b.getType(BBb)):0,EBb=this.c?BBb.getTypeLength(this.c.getType(BBb)):0;return CBb>DBb&&CBb>EBb?this.a.getType(BBb):DBb>EBb?this.b.getType(BBb):this.c.getType(BBb)}getType(FBb){switch(this.method){case vBb.LENGTH:case vBb.DISTANCE:case vBb.DOT:return"f";case vBb.CROSS:return"v3"}return this.getInputType(FBb)}generate(GBb,HBb){let IBb,JBb,KBb,LBb=this.a?GBb.getTypeLength(this.a.getType(GBb)):0,MBb=this.b?GBb.getTypeLength(this.b.getType(GBb)):0,NBb=this.c?GBb.getTypeLength(this.c.getType(GBb)):0,OBb=this.getInputType(GBb),PBb=this.getType(GBb);switch(this.type=PBb,this.method){case vBb.NEGATE:return GBb.format("( -"+this.a.build(GBb,OBb)+" )",OBb,HBb);case vBb.INVERT:return GBb.format("( 1.0 - "+this.a.build(GBb,OBb)+" )",OBb,HBb);case vBb.CROSS:IBb=this.a.build(GBb,"v3"),JBb=this.b.build(GBb,"v3");break;case vBb.STEP:IBb=this.a.build(GBb,1===LBb?"f":OBb),JBb=this.b.build(GBb,OBb);break;case vBb.MIN:case vBb.MAX:case vBb.MOD:IBb=this.a.build(GBb,OBb),JBb=this.b.build(GBb,1===MBb?"f":OBb);break;case vBb.REFRACT:IBb=this.a.build(GBb,OBb),JBb=this.b.build(GBb,OBb),KBb=this.c.build(GBb,"f");break;case vBb.MIX:IBb=this.a.build(GBb,OBb),JBb=this.b.build(GBb,OBb),KBb=this.c.build(GBb,1===NBb?"f":OBb);break;default:IBb=this.a.build(GBb,OBb),this.b&&(JBb=this.b.build(GBb,OBb)),this.c&&(KBb=this.c.build(GBb,OBb));break}let QBb=[];QBb.push(IBb),JBb&&QBb.push(JBb),KBb&&QBb.push(KBb);let RBb=this.getNumInputs(GBb);if(QBb.length!==RBb)throw Error(`Arguments not match used in "${this.method}". Require ${RBb}, currently ${QBb.length}.`);return GBb.format(this.method+"( "+QBb.join(", ")+" )",PBb,HBb)}},SBb=vBb;SBb.RAD="radians",SBb.DEG="degrees",SBb.EXP="exp",SBb.EXP2="exp2",SBb.LOG="log",SBb.LOG2="log2",SBb.SQRT="sqrt",SBb.INV_SQRT="inversesqrt",SBb.FLOOR="floor",SBb.CEIL="ceil",SBb.NORMALIZE="normalize",SBb.FRACT="fract",SBb.SATURATE="saturate",SBb.SIN="sin",SBb.COS="cos",SBb.TAN="tan",SBb.ASIN="asin",SBb.ACOS="acos",SBb.ARCTAN="atan",SBb.ABS="abs",SBb.SIGN="sign",SBb.LENGTH="length",SBb.NEGATE="negate",SBb.INVERT="invert",SBb.MIN="min",SBb.MAX="max",SBb.MOD="mod",SBb.STEP="step",SBb.REFLECT="reflect",SBb.DISTANCE="distance",SBb.DOT="dot",SBb.CROSS="cross",SBb.POW="pow",SBb.MIX="mix",SBb.CLAMP="clamp",SBb.REFRACT="refract",SBb.SMOOTHSTEP="smoothstep",SBb.FACEFORWARD="faceforward";var TBb=class extends Nwb{constructor(UBb,VBb,WBb){super("v4"),this.nodeType="TextureCubeUV",this.value=UBb,this.uv=VBb,this.bias=WBb}bilinearCubeUV(XBb,YBb,ZBb,$Bb){let _Bb=new VAb(TBb.Nodes.bilinearCubeUV,[YBb,ZBb,$Bb]);this.colorSpaceTL=this.colorSpaceTL??new qAb(new rAb("","v4")),this.colorSpaceTL.fromDecoding(XBb.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(_Bb.build(XBb)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new qAb(new rAb("","v4")),this.colorSpaceTR.fromDecoding(XBb.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(_Bb.build(XBb)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new qAb(new rAb("","v4")),this.colorSpaceBL.fromDecoding(XBb.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(_Bb.build(XBb)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new qAb(new rAb("","v4")),this.colorSpaceBR.fromDecoding(XBb.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(_Bb.build(XBb)+".br");let aCb={include:XBb.isShader("vertex"),ignoreCache:!0};XBb.addContext(aCb),this.colorSpaceTLExp=new rAb(this.colorSpaceTL.build(XBb,"v4"),"v4"),this.colorSpaceTRExp=new rAb(this.colorSpaceTR.build(XBb,"v4"),"v4"),this.colorSpaceBLExp=new rAb(this.colorSpaceBL.build(XBb,"v4"),"v4"),this.colorSpaceBRExp=new rAb(this.colorSpaceBR.build(XBb,"v4"),"v4"),XBb.removeContext();let bCb=new rAb("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return bCb.keywords.cubeUV_TL=this.colorSpaceTLExp,bCb.keywords.cubeUV_TR=this.colorSpaceTRExp,bCb.keywords.cubeUV_BL=this.colorSpaceBLExp,bCb.keywords.cubeUV_BR=this.colorSpaceBRExp,bCb.keywords.cubeUV=_Bb,bCb}generate(cCb,dCb){if(!cCb.isShader("fragment"))return console.warn("TextureCubeUVNode is not compatible with "+cCb.shader+" shader."),cCb.format("vec4( 0.0 )",this.getType(cCb),dCb);{let eCb=this.uv,fCb=this.bias||cCb.context.roughness,gCb=new VAb(TBb.Nodes.roughnessToMip,[fCb]),hCb=new SBb(gCb,TBb.Nodes.m0,TBb.Nodes.cubeUV_maxMipLevel,SBb.CLAMP),iCb=new SBb(hCb,SBb.FLOOR),jCb=new SBb(hCb,SBb.FRACT),kCb=this.bilinearCubeUV(cCb,this.value,eCb,iCb),lCb=this.bilinearCubeUV(cCb,this.value,eCb,new uBb(iCb,new NAb(1).setReadonly(!0),uBb.ADD)),mCb=new SBb(kCb,lCb,jCb,SBb.MIX);return cCb.format(mCb.build(cCb),"v4",dCb)}}},nCb=TBb;let oCb,pCb,qCb,rCb,sCb,tCb,uCb,vCb,wCb,xCb,yCb,zCb,ACb,BCb,CCb,DCb,ECb,FCb,GCb,HCb,ICb,JCb,KCb,LCb,MCb;nCb.Nodes=(oCb=new Jzb(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),pCb=new Gzb("float cubeUV_maxMipLevel 8.0",!0),qCb=new Gzb("float cubeUV_minMipLevel 4.0",!0),rCb=new Gzb("float cubeUV_maxTileSize 256.0",!0),sCb=new Gzb("float cubeUV_minTileSize 16.0",!0),tCb=new yyb(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`),tCb.useKeywords=!1,uCb=new yyb(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`),uCb.useKeywords=!1,vCb=new yyb(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[oCb,tCb,uCb,pCb,qCb,rCb,sCb]),vCb.useKeywords=!1,wCb=new Gzb("float r0 1.0",!0),xCb=new Gzb("float v0 0.339",!0),yCb=new Gzb("float m0 -2.0",!0),zCb=new Gzb("float r1 0.8",!0),ACb=new Gzb("float v1 0.276",!0),BCb=new Gzb("float m1 -1.0",!0),CCb=new Gzb("float r4 0.4",!0),DCb=new Gzb("float v4 0.046",!0),ECb=new Gzb("float m4 2.0",!0),FCb=new Gzb("float r5 0.305",!0),GCb=new Gzb("float v5 0.016",!0),HCb=new Gzb("float m5 3.0",!0),ICb=new Gzb("float r6 0.21",!0),JCb=new Gzb("float v6 0.0038",!0),KCb=new Gzb("float m6 4.0",!0),LCb=[wCb,xCb,yCb,zCb,ACb,BCb,CCb,DCb,ECb,FCb,GCb,HCb,ICb,JCb,KCb],MCb=new yyb(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,LCb),{bilinearCubeUV:vCb,roughnessToMip:MCb,m0:yCb,cubeUV_maxMipLevel:pCb});var NCb=class extends Nwb{constructor(OCb){super("v3"),this.nodeType="Normal",this.scope=OCb??NCb.VIEW}getShared(){return this.scope===NCb.WORLD}build(PCb,QCb,RCb,SCb){let TCb=PCb.context[this.scope+"Normal"];return TCb?TCb.build(PCb,QCb,RCb,SCb):super.build(PCb,QCb,RCb)}generate(UCb,VCb,WCb,XCb,YCb){let ZCb;switch(this.scope){case NCb.VIEW:ZCb=UCb.isShader("vertex")?"transformedNormal":"geometryNormal";break;case NCb.LOCAL:UCb.isShader("vertex")?ZCb="objectNormal":(UCb.requires.normal=!0,ZCb="vObjectNormal");break;case NCb.WORLD:UCb.isShader("vertex")?ZCb="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(UCb.requires.worldNormal=!0,ZCb="vWNormal");break}return UCb.format(ZCb,this.getType(UCb),VCb)}},$Cb=NCb;$Cb.LOCAL="local",$Cb.WORLD="world",$Cb.VIEW="view",$Cb.NORMAL="normal",Awb.addKeyword("viewNormal",function(){return new $Cb($Cb.VIEW)}),Awb.addKeyword("localNormal",function(){return new $Cb($Cb.NORMAL)}),Awb.addKeyword("worldNormal",function(){return new $Cb($Cb.WORLD)});var _Cb=class extends Nwb{constructor(aDb){super("v3"),this.nodeType="Position",this.scope=aDb??_Cb.LOCAL}getType(){switch(this.scope){case _Cb.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case _Cb.LOCAL:case _Cb.WORLD:return!1}return!0}generate(bDb,cDb,dDb,eDb,fDb){let gDb;switch(this.scope){case _Cb.LOCAL:bDb.isShader("vertex")?gDb="transformed":(bDb.requires.position=!0,gDb="vPosition");break;case _Cb.WORLD:if(bDb.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";bDb.requires.worldPosition=!0,gDb="vWPosition";break;case _Cb.VIEW:gDb=bDb.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case _Cb.PROJECTION:gDb=bDb.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return bDb.format(gDb,this.getType(),cDb)}},hDb=_Cb;hDb.LOCAL="local",hDb.WORLD="world",hDb.VIEW="view",hDb.PROJECTION="projection",Awb.addKeyword("position",function(){return new hDb}),Awb.addKeyword("worldPosition",function(){return new hDb(hDb.WORLD)}),Awb.addKeyword("viewPosition",function(){return new hDb(hDb.VIEW)});var iDb=class extends Nwb{constructor(jDb){super("v3"),this.nodeType="Reflect",this.scope=jDb??iDb.CUBE}getUnique(kDb){return!kDb.context.viewNormal}getType(){switch(this.scope){case iDb.SPHERE:return"v2"}return this.type}generate(lDb,mDb){let nDb=this.getUnique(lDb);if(!lDb.isShader("fragment"))return console.warn("ReflectNode is not compatible with "+lDb.shader+" shader."),lDb.format("vec3( 0.0 )",this.type,mDb);{let oDb;switch(this.scope){case iDb.VECTOR:{let pDb=new $Cb($Cb.VIEW),qDb=lDb.context.roughness,rDb=pDb.build(lDb,"v3"),sDb=new hDb(hDb.VIEW).build(lDb,"v3"),tDb=qDb?qDb.build(lDb,"f"):void 0,uDb=`reflect( -normalize( ${sDb} ), ${rDb} )`;tDb&&(uDb=`normalize( mix( ${uDb}, ${rDb}, ${tDb} * ${tDb} ) )`);let vDb=`inverseTransformDirection( ${uDb}, viewMatrix )`;nDb?(lDb.addNodeCode(`vec3 reflectVec = ${vDb};`),oDb="reflectVec"):oDb=vDb;break}case iDb.CUBE:{let wDb=new iDb(iDb.VECTOR).build(lDb,"v3"),xDb="vec3( -"+wDb+".x, "+wDb+".yz )";nDb?(lDb.addNodeCode(`vec3 reflectCubeVec = ${xDb};`),oDb="reflectCubeVec"):oDb=xDb;break}case iDb.SPHERE:{let yDb="normalize( ( viewMatrix * vec4( "+new iDb(iDb.VECTOR).build(lDb,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";nDb?(lDb.addNodeCode(`vec2 reflectSphereVec = ${yDb};`),oDb="reflectSphereVec"):oDb=yDb;break}}return lDb.format(oDb,this.getType(),mDb)}}},zDb=iDb;zDb.CUBE="cube",zDb.SPHERE="sphere",zDb.VECTOR="vector";var ADb=class extends Nwb{constructor(BDb=new xAb,CDb,DDb){super("v4"),this.nodeType="TextureCube",this.value=BDb,this.radianceNode=new nCb(this.value,CDb??new zDb(zDb.VECTOR),DDb),this.irradianceNode=new nCb(this.value,new $Cb($Cb.WORLD),new NAb(1).setReadonly(!0))}generate(EDb,FDb){return EDb.isShader("fragment")?(EDb.require("irradiance"),EDb.context.bias&&EDb.context.bias.setTexture(this.value),("irradiance"===EDb.slot?this.irradianceNode:this.radianceNode).build(EDb,FDb)):(console.warn("TextureCubeNode is not compatible with "+EDb.shader+" shader."),EDb.format("vec4( 0.0 )",this.getType(EDb),FDb))}},GDb=class extends mxb{constructor(HDb=new EK,IDb,JDb){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=HDb,this.uv=IDb??new zDb,this.bias=JDb}getTexture(KDb,LDb){return super.generate(KDb,LDb,this.value.uuid,"tc")}generate(MDb,NDb){if("samplerCube"===NDb)return this.getTexture(MDb,NDb);let ODb=this.getTexture(MDb,NDb),PDb=this.uv?.build(MDb,"v3"),QDb=this.bias?this.bias.build(MDb,"f"):void 0;void 0===QDb&&MDb.context.bias&&(QDb=MDb.context.bias.setTexture(this).build(MDb,"f"));let RDb;RDb=QDb?"texCubeBias( "+ODb+", "+PDb+", "+QDb+" )":"texCube( "+ODb+", "+PDb+" )";let SDb={include:MDb.isShader("vertex"),ignoreCache:!0},TDb=this.getType(MDb);return MDb.addContext(SDb),this.colorSpace=this.colorSpace??new qAb(new rAb("",TDb)),this.colorSpace.fromDecoding(MDb.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(RDb),RDb=this.colorSpace.build(MDb,TDb),MDb.removeContext(),MDb.format(RDb,TDb,NDb)}},UDb=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,VDb=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,WDb=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,XDb=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,YDb=`
layout(location = 1) out vec4 gVelocity;
`,ZDb=`
    // Discard fully transparent pixels 
    if (gl_FragColor.a <= 0.0) discard;

    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);
`,$Db=["x","y","z","w"],_Db=["float","vec2","vec3","vec4"],aEb={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},bEb={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},cEb=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=(function(){function a(a,b){return a.deps.length-b.deps.length}return function(b,c){let d=this.getIncludes(b,c);if(!d)return"";let e="";d=d.sort(a);for(let f=0;f<d.length;f++)d[f].src&&(e+=d[f].src+`
`);return e}})(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(dEb,eEb){this.addVertexParsCode(UDb),this.addFragmentParsCode(VDb),this.buildShader("vertex",dEb),this.buildShader("fragment",eEb);for(let fEb=0;fEb<this.requires.uv.length;fEb++)if(this.requires.uv[fEb]){let gEb=fEb>0?fEb+1:"";this.addVaryCode("varying vec2 vUv"+gEb+";"),fEb>0&&this.addVertexParsCode("attribute vec2 uv"+gEb+";"),this.addVertexFinalCode("vUv"+gEb+" = uv"+gEb+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(WDb),this.addFragmentFinalCode(XDb)),this}buildShader(hEb,iEb){this.resultCode[hEb]=iEb.build(this.setShader(hEb),"v4")}setMaterial(jEb,kEb){return this.defines={},this}addFlow(lEb,mEb,nEb){return this.addSlot(lEb).addCache(mEb).addContext(nEb)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(oEb){return this.cache=oEb??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(pEb){return this.context=Object.assign({},this.context,pEb),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(qEb){return this.slot=qEb||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(rEb,sEb){void 0===this.fragmentVariables[rEb]&&(this.addFragmentCode(`${sEb} ${rEb};`),this.fragmentVariables[rEb]="")}addFragmentParsVariable(tEb,uEb){void 0===this.fragmentParsVariables[tEb]&&(this.addFragmentParsCode(`${uEb} ${tEb};`),this.fragmentParsVariables[tEb]="")}addVertexParsVariable(vEb,wEb){void 0===this.vertexParsVariables[vEb]&&(this.addVertexParsCode(`${wEb} ${vEb};`),this.vertexParsVariables[vEb]="")}addVertexCode(xEb){this.addCode(xEb,"vertex")}addFragmentCode(yEb){this.addCode(yEb,"fragment")}addCode(zEb,AEb){this.code[AEb??this.shader]+=zEb+`
`}addVertexNodeCode(BEb){this.addNodeCode(BEb,"vertex")}addFragmentNodeCode(CEb){this.addNodeCode(CEb,"fragment")}addNodeCode(DEb,EEb){this.nodeCode[EEb??this.shader]+=DEb+`
`}clearNodeCode(FEb){FEb=FEb??this.shader;let GEb=this.nodeCode[FEb];return this.nodeCode[FEb]="",GEb}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(HEb){this.addFinalCode(HEb,"vertex")}addFragmentFinalCode(IEb){this.addFinalCode(IEb,"fragment")}addFinalCode(JEb,KEb){this.finalCode[KEb??this.shader]+=JEb+`
`}addVertexParsCode(LEb){this.addParsCode(LEb,"vertex")}addFragmentParsCode(MEb){this.addParsCode(MEb,"fragment")}addParsCode(NEb,OEb){this.parsCode[OEb??this.shader]+=NEb+`
`}addVaryCode(PEb){this.addVertexParsCode(PEb),this.addFragmentParsCode(PEb)}isCache(QEb){return -1!==this.caches.indexOf(QEb)}isSlot(REb){return -1!==this.slots.indexOf(REb)}define(SEb,TEb){this.defines[SEb]=void 0===TEb?1:TEb}require(UEb){this.requires[UEb]=!0}isDefined(VEb){return void 0!==this.defines[VEb]}getVar(WEb,XEb,YEb,ZEb="varying",$Eb="V",_Eb=""){let aFb=this.getVars(ZEb),bFb=aFb[WEb];if(!bFb){let cFb=aFb.length;bFb={name:YEb||"node"+$Eb+cFb+(_Eb?"_"+_Eb:""),type:XEb},aFb.push(bFb),aFb[WEb]=bFb}return bFb}getTempVar(dFb,eFb,fFb,gFb){return this.getVar(dFb,eFb,fFb,this.shader,"T",gFb)}getAttribute(hFb,iFb){if(!this.attributes[hFb]){let jFb=this.getVar(hFb,iFb);this.addVertexParsCode("attribute "+iFb+" "+hFb+";"),this.addVertexFinalCode(jFb.name+" = "+hFb+";"),this.attributes[hFb]={varying:jFb,name:hFb,type:iFb}}return this.attributes[hFb]}getCode(kFb){return[this.prefixCode,this.parsCode[kFb],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[kFb],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[kFb],"uniform"),this.getIncludesCode("consts",kFb),this.getIncludesCode("structs",kFb),this.getIncludesCode("functions",kFb),"void main() {",this.getVarListCode(this.getVars(kFb)),this.code[kFb],this.resultCode[kFb],this.finalCode[kFb],"}"].join(`
`)}getVarListCode(lFb,mFb){mFb=mFb??"";let nFb="";for(let oFb=0,pFb=lFb.length;oFb<pFb;++oFb){let qFb=lFb[oFb],rFb=qFb.type,sFb=qFb.name,tFb=qFb.size,uFb=this.getFormatByType(rFb);if(void 0===uFb)throw new Error("Node pars "+uFb+" not found.");uFb.includes("[]")?nFb+=mFb+" "+uFb.substring(0,uFb.length-2)+" "+sFb+`[${tFb}];
`:nFb+=mFb+" "+uFb+" "+sFb+`;
`}return nFb}getVars(vFb){return this.inputs.vars[vFb??this.shader]}getNodeData(wFb){let xFb=wFb instanceof Mvb?wFb.uuid:wFb;return this.nodeData[xFb]=this.nodeData[xFb]||{}}createUniform(yFb,zFb,AFb,BFb,CFb,DFb){if(zFb.includes("[]")){let EFb=this.inputs.arrayUniforms,FFb=EFb.list.length,GFb=new Jvb({type:zFb,size:AFb.size,name:BFb||"nodeUA"+FFb+(DFb?"_"+DFb:""),node:AFb,needsUpdate:CFb});return EFb.list.push(GFb),EFb[yFb].push(GFb),EFb[yFb][GFb.name]=GFb,this.uniforms[GFb.name]=GFb,GFb}{let HFb=this.inputs.uniforms,IFb=HFb.list.length,JFb=new Jvb({type:zFb,name:BFb||"nodeU"+IFb+(DFb?"_"+DFb:""),node:AFb,needsUpdate:CFb});return HFb.list.push(JFb),HFb[yFb].push(JFb),HFb[yFb][JFb.name]=JFb,this.uniforms[JFb.name]=JFb,JFb}}createVertexUniform(KFb,LFb,MFb,NFb,OFb){return this.createUniform("vertex",KFb,LFb,MFb,NFb,OFb)}createFragmentUniform(PFb,QFb,RFb,SFb,TFb){return this.createUniform("fragment",PFb,QFb,RFb,SFb,TFb)}include(UFb,VFb,WFb){let XFb;if(UFb="string"==typeof UFb?Awb.get(UFb):UFb,!1===this.context.include)return UFb.name;UFb instanceof yyb?XFb=this.includes.functions:UFb instanceof Gzb?XFb=this.includes.consts:UFb instanceof Jzb&&(XFb=this.includes.structs);let YFb=XFb[this.shader]=XFb[this.shader]||[];if(UFb){let ZFb=YFb[UFb.name];if(ZFb||(ZFb=YFb[UFb.name]={node:UFb,deps:[]},YFb.push(ZFb),ZFb.src=UFb.build(this,"source")),UFb instanceof yyb&&VFb&&YFb[VFb.name]&& -1===YFb[VFb.name].deps.indexOf(UFb)&&(YFb[VFb.name].deps.push(UFb),UFb.includes?.length)){let $Fb=0;do this.include(UFb.includes[$Fb++],VFb);while($Fb<UFb.includes.length)}return WFb&&(ZFb.src=WFb),UFb.name}throw new Error("Include not found.")}colorToVectorProperties(_Fb){return _Fb.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(aGb){return aGb.replace(/c/g,"v3")}getIncludes(bGb,cGb){return this.includes[bGb][cGb||this.shader]}getConstructorFromLength(dGb){return _Db[dGb-1]}isTypeMatrix(eGb){return/^m/.test(eGb)}getTypeLength(fGb){return"f"===fGb?1:parseInt(this.colorToVector(fGb).substr(1))}getTypeFromLength(gGb){return 1===gGb?"f":"v"+gGb}findNode(...hGb){for(let iGb=0;iGb<arguments.length;iGb++){let jGb=hGb[iGb];if(jGb?.isNode)return jGb}}resolve(...kGb){for(let lGb=0;lGb<arguments.length;lGb++){let mGb=kGb[lGb];if(void 0!==mGb){if(mGb.isNode)return mGb;if(mGb.isTexture)switch(mGb.mapping){case ka:case la:return new GDb(mGb);case oa:return new ADb(new xAb(mGb));default:return new xAb(mGb)}else{if(mGb.isVector2)return new xxb(mGb);if(mGb.isVector3)return new Ixb(mGb);if(mGb.isVector4)return new oyb(mGb)}}}}format(nGb,oGb,pGb){switch(this.colorToVector(pGb+" <- "+oGb)){case"f <- v2":return nGb+".x";case"f <- v3":return nGb+".x";case"f <- v4":return nGb+".x";case"f <- i":case"f <- b":return"float( "+nGb+" )";case"v2 <- f":return"vec2( "+nGb+" )";case"v2 <- v3":return nGb+".xy";case"v2 <- v4":return nGb+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+nGb+" ) )";case"v3 <- f":return"vec3( "+nGb+" )";case"v3 <- v2":return"vec3( "+nGb+", 0.0 )";case"v3 <- v4":return nGb+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+nGb+" ) )";case"v4 <- f":return"vec4( "+nGb+" )";case"v4 <- v2":return"vec4( "+nGb+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+nGb+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+nGb+" ) )";case"i <- f":case"i <- b":return"int( "+nGb+" )";case"i <- v2":return"int( "+nGb+".x )";case"i <- v3":return"int( "+nGb+".x )";case"i <- v4":return"int( "+nGb+".x )";case"b <- f":return"( "+nGb+" != 0.0 )";case"b <- v2":return"( "+nGb+" != vec2( 0.0 ) )";case"b <- v3":return"( "+nGb+" != vec3( 0.0 ) )";case"b <- v4":return"( "+nGb+" != vec4( 0.0 ) )";case"b <- i":return"( "+nGb+" != 0 )"}return nGb}getTypeByFormat(qGb){return aEb[qGb]||qGb}getFormatByType(rGb){return bEb[rGb]||rGb}getUUID(sGb,tGb){return(tGb=void 0===tGb||tGb)&&this.cache&&(sGb=this.cache+"-"+sGb),sGb}getElementByIndex(uGb){return $Db[uGb]}getIndexByElement(vGb){return $Db.indexOf(vGb)}isShader(wGb){return this.shader===wGb}setShader(xGb){return this.shader=xGb,this}mergeDefines(yGb){for(let zGb in yGb)this.defines[zGb]=yGb[zGb];return this.defines}mergeUniform(AGb){for(let BGb in AGb)this.uniforms[BGb]=AGb[BGb];return this.uniforms}getTextureEncodingFromMap(CGb){let DGb;return CGb?CGb.isTexture&&(DGb=CGb.encoding):DGb=Sa,DGb===Sa&&this.context.gamma&&(DGb=Ta),DGb}},EGb=class extends mxb{constructor(FGb=0,GGb,HGb,IGb){super("c"),this.nodeType="Color",this.value=FGb instanceof Vxb?FGb:new Vxb(FGb||0,GGb,HGb,IGb)}setRGBA(JGb){this.value.setRGBA(JGb.r,JGb.g,JGb.b,JGb.a)}generate(KGb,LGb,MGb,NGb,OGb,PGb){MGb=KGb.getUUID(MGb??this.getUUID()),NGb=NGb??this.getType(KGb);let QGb=KGb.getNodeData(MGb),RGb=this.getReadonly()&& void 0!==this.generateReadonly;if(this.alpha){let SGb=this.alpha.build(KGb,"f");KGb.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${SGb};`)}return RGb?this.generateReadonly(KGb,LGb,MGb,NGb,OGb,PGb):KGb.isShader("vertex")?(QGb.vertex||(QGb.vertex=KGb.createVertexUniform(NGb,this,OGb,PGb,this.getLabel())),KGb.format(QGb.vertex.name,NGb,LGb)):(QGb.fragment||(QGb.fragment=KGb.createFragmentUniform(NGb,this,OGb,PGb,this.getLabel())),KGb.format(QGb.fragment.name,NGb,LGb))}generateReadonly(TGb,UGb,VGb,WGb,XGb,YGb){return TGb.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",WGb,UGb)}},ZGb=class extends mxb{constructor($Gb){super("i"),this.nodeType="Int",this.value=Math.floor($Gb??0)}generateReadonly(_Gb,aHb,bHb,cHb,dHb,eHb){return _Gb.format(this.value.toString(),cHb,aHb)}},fHb=class extends mxb{constructor(gHb){super("b"),this.nodeType="Bool",this.value=gHb?? !1}generateReadonly(hHb,iHb,jHb,kHb){return hHb.format(this.value?"true":"false",kHb,iHb)}},lHb=class extends mxb{constructor(mHb=1,nHb){super("f[]"),this.nodeType="FloatArray",this.size=mHb,this.value=Array.isArray(nHb)?nHb:"number"==typeof nHb?new Array(mHb).fill(nHb):new Array(mHb).fill(0)}},oHb=class extends mxb{},pHb=class extends oHb{constructor(qHb){super("v3"),this.image=qHb,this._value=new fm}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},rHb=class extends oHb{constructor(sHb,tHb,uHb=1008){super("t"),this.image=sHb,this.wrap=tHb,this.minFilter=uHb}get value(){return this.image.getTexture(this.wrap,this.minFilter)}},vHb=class extends mxb{constructor(wHb){super("m3"),this.nodeType="Matrix3",this.value=wHb??new Rc}generateReadonly(xHb,yHb,zHb,AHb,BHb,CHb){return xHb.format("mat3("+this.value.elements.join(", ")+")",AHb,yHb)}get elements(){return this.value.elements}set elements(DHb){this.value.fromArray(DHb)}},EHb=class extends mxb{constructor(FHb){super("m4"),this.nodeType="Matrix4",this.value=FHb??new rs}generateReadonly(GHb,HHb,IHb,JHb,KHb,LHb){return GHb.format("mat4("+this.value.elements.join(", ")+")",JHb,HHb)}get elements(){return this.value.elements}set elements(MHb){this.value.fromArray(MHb)}};function NHb(a,b,c){a.setUvTransform(c[0],c[1],b[0],b[1],0,0,0)}var OHb=class extends vHb{constructor(PHb,QHb){super(new Rc),this.repeat=PHb,this.offset=QHb,NHb(this.value,PHb,QHb)}updateMatrix(){NHb(this.value,this.repeat,this.offset)}},RHb=class extends mxb{constructor(SHb=1,THb){super("v4[]"),this.nodeType="Vector4Array",this.size=SHb,this.value=Array.isArray(THb)?THb:THb instanceof sh?new Array(SHb).fill(THb):new Array(SHb).fill(new sh(0))}},UHb=class extends Nwb{constructor(VHb,WHb,XHb,YHb){super("v3"),this.nodeType="Blend",this.a=VHb,this.b=WHb,this.alpha=XHb,this.mode=YHb}generate(ZHb,$Hb){if(!ZHb.isShader("fragment"))return console.warn("BlendNode is not compatible with "+ZHb.shader+" shader."),ZHb.format("vec3( 0.0 )",this.getType(ZHb),$Hb);{let _Hb=[];return _Hb.push(this.a.build(ZHb,"c")),_Hb.push(this.b.build(ZHb,"c")),_Hb.push(this.alpha.build(ZHb,"f")),_Hb.push(this.mode.build(ZHb,"i")),ZHb.format("spe_blend("+_Hb.join(",")+")",this.getType(ZHb),$Hb)}}},aIb=class extends Nwb{constructor(bIb,cIb){super("v3"),this.nodeType="CustomColor",this.color=bIb,this.alpha=cIb,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(dIb,eIb){if(!dIb.isShader("fragment"))return console.warn("CustomColorNode is not compatible with "+dIb.shader+" shader."),dIb.format("vec3( 0.0 )",this.getType(dIb),eIb);{let fIb=dIb.include(aIb.Nodes.customColor);dIb.addFragmentVariable(this.calpha,"float");let gIb=[];return gIb.push(this.color.build(dIb,"v3")),gIb.push(this.mask?`luminance(${this.mask.build(dIb,"v3")})`:"1.0"),gIb.push(this.alpha.build(dIb,"f")),gIb.push(this.calpha),dIb.format(fIb+"("+gIb.join(",")+")",this.getType(dIb),eIb)}}},hIb=aIb;hIb.Nodes={customColor:new yyb(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)};var iIb=class extends Nwb{constructor(jIb,kIb){super("v3"),this.nodeType="CustomNormal",this.cnormal=jIb,this.alpha=kIb,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(lIb,mIb){if(!lIb.isShader("fragment"))return console.warn("CustomNormalNode is not compatible with "+lIb.shader+" shader."),lIb.format("vec3( 0.0 )",this.getType(lIb),mIb);{let nIb=lIb.include(iIb.Nodes.customNormal);lIb.addFragmentVariable(this.calpha,"float");let oIb=[];return oIb.push(this.cnormal.build(lIb,"v3")),oIb.push("normal"),oIb.push(this.mask?`luminance(${this.mask.flow(lIb,"v3").result})`:"1.0"),oIb.push(this.alpha.build(lIb,"f")),oIb.push(this.calpha),lIb.format(nIb+"("+oIb.join(",")+")",this.getType(lIb),mIb)}}},pIb=iIb;pIb.Nodes={customNormal:new yyb(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)};var qIb=class extends Nwb{constructor(rIb,sIb,tIb,uIb,vIb,wIb,xIb,yIb,zIb,AIb,BIb,CIb){super("v3"),this.nodeType="CustomTexture",this.texture=rIb,this.textureSize=sIb,this.crop=tIb,this.projection=uIb,this.axis=vIb,this.side=wIb,this.size=xIb,this.blending=yIb,this.mat=zIb,this.isMask=CIb,this.alpha=AIb,this.mode=BIb,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(DIb,EIb){DIb.require("position"),DIb.require("normal"),DIb.require("uv"),DIb.requires.uv=[!0],DIb.extensions.shaderTextureLOD=!0,DIb.extensions.derivatives=!0;let FIb=`g${this.uuid.toString().replace(/-/g,"")}`,GIb;switch(this.projection.value){case 3:GIb=DIb.include(qIb.Nodes.cylindrical);break;case 2:GIb=DIb.include(qIb.Nodes.spherical);break;case 1:let HIb=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],IIb=["zy","xz","xy"][this.axis.value],JIb=new yyb(`
		vec3 ${FIb}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${IIb})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${2===this.side.value?"":`lalpha *= step(0.0, ${1===this.side.value?"-1.0 * ":""}dot(vObjectNormal, ${HIb}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);GIb=DIb.include(JIb);break;case 4:GIb=DIb.include(qIb.Nodes.triplanar);break;default:GIb=DIb.include(qIb.Nodes.uv);break}DIb.addFragmentVariable(this.calpha,"float");let KIb=[];if(KIb.push("normal"),KIb.push(this.texture.generate(DIb,"t")),KIb.push(this.textureSize.build(DIb,"v2")),KIb.push(this.crop.build(DIb,"f")),KIb.push(this.mat.build(DIb,"mat3")),KIb.push(this.size.build(DIb,"v2")),KIb.push(this.blending.build(DIb,"f")),KIb.push(this.isMask.build(DIb,"b")),KIb.push(this.mask?`luminance(${this.mask.flow(DIb,"v3").result})`:"1.0"),KIb.push(this.alpha.build(DIb,"f")),KIb.push(this.mode.build(DIb,"i")),KIb.push(this.calpha),4===this.projection.value){let LIb=`${FIb}_writeUvs`,MIb=LIb+"0",NIb=LIb+"1",OIb=LIb+"2",PIb=`${FIb}_triplanarWeights`;DIb.addFragmentVariable(MIb,"vec2"),DIb.addFragmentVariable(NIb,"vec2"),DIb.addFragmentVariable(OIb,"vec2"),DIb.addFragmentVariable(PIb,"vec3"),KIb.push(MIb),KIb.push(NIb),KIb.push(OIb),KIb.push(PIb)}else{let QIb=`${FIb}_writeUvs`;DIb.addFragmentVariable(QIb,"vec2"),KIb.push(QIb)}return DIb.format(GIb+"("+KIb.join(",")+")",this.getType(DIb),EIb)}},RIb=qIb;let SIb,TIb,UIb,VIb;RIb.Nodes=(SIb=new yyb(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),TIb=new yyb(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),UIb=new yyb(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),VIb=new yyb(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`),{cylindrical:SIb,spherical:TIb,uv:UIb,triplanar:VIb});var WIb=class extends Nwb{constructor(XIb,YIb,ZIb,$Ib,_Ib,aJb,bJb,cJb,dJb,eJb,fJb,gJb){super("v3"),this.nodeType="Depth",this.gradientType=XIb,this.smooth=YIb,this.near=ZIb,this.far=$Ib,this.isVector=_Ib,this.isWorldSpace=aJb,this.origin=bJb,this.direction=cJb,this.colors=dJb,this.steps=eJb,this.isMask=gJb,this.alpha=fJb,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(hJb,iJb){let jJb=`g${this.uuid.toString().replace(/-/g,"")}`,kJb=new yyb(`vec3 ${jJb}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${jJb}_MAX_COLORS], float steps[${jJb}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${jJb}_IS_VECTOR
                   #ifdef ${jJb}_LINEAR
                       #ifdef ${jJb}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${jJb}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${jJb}_SMOOTH
				for ( int i = 1; i < ${jJb}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${jJb}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[WIb.Nodes.vectorLinearWorldSpaceDepth,WIb.Nodes.vectorLinearObjectSpaceDepth,WIb.Nodes.vectorSphericalObjectSpaceDepth,WIb.Nodes.vectorSphericalWorldSpaceDepth]);if(!hJb.isShader("fragment"))return console.warn("DepthNode is not compatible with "+hJb.shader+" shader."),hJb.format("vec3( 0.0 )",this.getType(hJb),iJb);{hJb.define(`${jJb}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&hJb.define(`${jJb}_SMOOTH`),this.isVector.value>.5&&hJb.define(`${jJb}_IS_VECTOR`),0===this.gradientType.value&&hJb.define(`${jJb}_LINEAR`),this.isWorldSpace.value>.5&&hJb.define(`${jJb}_WORLDSPACE`),hJb.require("worldPosition"),hJb.addFragmentVariable(this.calpha,"float");let lJb=hJb.include(kJb),mJb=[];return mJb.push(this.near.build(hJb,"f")),mJb.push(this.far.build(hJb,"f")),mJb.push(this.origin.build(hJb,"v3")),mJb.push(this.direction.build(hJb,"v3")),mJb.push(this.colors.build(hJb,"v4[]")),mJb.push(this.steps.build(hJb,"f[]")),mJb.push(this.isMask.build(hJb,"b")),mJb.push(this.mask?`luminance(${this.mask.flow(hJb,"v3").result})`:"1.0"),mJb.push(this.alpha.build(hJb,"f")),mJb.push(this.calpha),hJb.format(lJb+"("+mJb.join(",")+")",this.getType(hJb),iJb)}}},nJb=WIb;let oJb,pJb,qJb,rJb;nJb.Nodes=(oJb=new yyb(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),pJb=new yyb(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),qJb=new yyb(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),rJb=new yyb(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`),{vectorLinearWorldSpaceDepth:oJb,vectorLinearObjectSpaceDepth:pJb,vectorSphericalWorldSpaceDepth:qJb,vectorSphericalObjectSpaceDepth:rJb});var sJb=class extends Nwb{constructor(tJb,uJb,vJb,wJb,xJb,yJb,zJb,AJb){super("v3"),this.nodeType="Fresnel",this.color=tJb,this.bias=uJb,this.scale=vJb,this.intensity=wJb,this.factor=xJb,this.isMask=AJb,this.alpha=yJb,this.mode=zJb,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(BJb,CJb){if(BJb.require("vWorldViewDir"),BJb.require("worldNormal"),!BJb.isShader("fragment"))return console.warn("FresnelNode is not compatible with "+BJb.shader+" shader."),BJb.format("vec3( 0.0 )",this.getType(BJb),CJb);{BJb.addFragmentVariable(this.calpha,"float");let DJb=new yyb(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),EJb=BJb.include(DJb),FJb=[];return FJb.push(this.color.build(BJb,"c")),FJb.push(this.bias.build(BJb,"f")),FJb.push(this.scale.build(BJb,"f")),FJb.push(this.intensity.build(BJb,"f")),FJb.push(this.factor.build(BJb,"f")),FJb.push(this.isMask.build(BJb,"b")),FJb.push(this.mask?`luminance(${this.mask.flow(BJb,"v3").result})`:"1.0"),FJb.push(this.alpha.build(BJb,"f")),FJb.push(this.mode.build(BJb,"i")),FJb.push(this.calpha),BJb.format(EJb+"("+FJb.join(",")+")",this.getType(BJb),CJb)}}},GJb=class extends Nwb{constructor(HJb,IJb,JJb,KJb,LJb,MJb,NJb,OJb,PJb){super("v3"),this.nodeType="Gradient",this.gradientType=HJb,this.smooth=IJb,this.colors=JJb,this.steps=KJb,this.offset=LJb,this.morph=MJb,this.angle=NJb,this.isMask=PJb,this.alpha=OJb,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(QJb,RJb){if(!QJb.isShader("fragment"))return console.warn("GradientNode is not compatible with "+QJb.shader+" shader."),QJb.format("vec3( 0.0 )",this.getType(QJb),RJb);{QJb.define("GRAD_MAX",10),QJb.require("uv"),QJb.requires.uv=[!0],QJb.addFragmentVariable(this.calpha,"float");let SJb=QJb.include(GJb.Nodes.gradient),TJb=[];return TJb.push(this.gradientType.build(QJb,"i")),TJb.push(this.smooth.build(QJb,"b")),TJb.push(this.colors.build(QJb,"v4[]")),TJb.push(this.steps.build(QJb,"f[]")),TJb.push(this.offset.build(QJb,"v2")),TJb.push(this.morph.build(QJb,"v2")),TJb.push(this.angle.build(QJb,"f")),TJb.push(this.isMask.build(QJb,"b")),TJb.push(this.mask?`luminance(${this.mask.flow(QJb,"v3").result})`:"1.0"),TJb.push(this.alpha.build(QJb,"f")),TJb.push(this.calpha),QJb.format(SJb+"("+TJb.join(",")+")",this.getType(QJb),RJb)}}},UJb=GJb;UJb.Nodes={gradient:new yyb(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)};var VJb,WJb=class extends Nwb{constructor(XJb,YJb,ZJb,$Jb){super("v3"),this.nodeType="Matcap",this.texture=XJb,this.isMask=$Jb,this.alpha=YJb,this.mode=ZJb,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(_Jb,aKb){if(!_Jb.isShader("fragment"))return console.warn("MatcapNode is not compatible with "+_Jb.shader+" shader."),_Jb.format("vec3( 0.0 )",this.getType(_Jb),aKb);{_Jb.addFragmentVariable(this.calpha,"float");let bKb=_Jb.include(WJb.Nodes.matcap);_Jb.require("normal"),_Jb.requires.normal=!0;let cKb=[];return cKb.push(this.texture.generate(_Jb,"t")),cKb.push("normal"),cKb.push(this.isMask.build(_Jb,"b")),cKb.push(this.mask?`luminance(${this.mask.flow(_Jb,"v3").result})`:"1.0"),cKb.push(this.alpha.build(_Jb,"f")),cKb.push(this.mode.build(_Jb,"i")),cKb.push(this.calpha),_Jb.format(bKb+"("+cKb.join(",")+")",this.getType(_Jb),aKb)}}},dKb=WJb;dKb.Nodes={matcap:new yyb(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)};let eKb,fKb,gKb,hKb,iKb,jKb,kKb,lKb,mKb,nKb,oKb,pKb,qKb,rKb,sKb,tKb,uKb,vKb,wKb;var xKb=((VJb=xKb||{}).SIMPLEX="simplex3d",VJb.SIMPLEX_FRACTAL="simplex3dFractal",VJb.ASHIMA="simplexAshima",VJb.FBM="fbm",VJb.PERLIN="perlin",VJb.VORONOI="voronoi",VJb),yKb=(eKb=new yyb(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),fKb=new yyb(`float simplex3d(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[eKb]),fKb.keywords.F3=new Gzb("float F3 0.3333333"),fKb.keywords.G3=new Gzb("float G3 0.1666667"),gKb=new yyb(`float simplex3dFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplex3d(m * rot1)
				 + 0.2666667 * simplex3d(2.0 * m * rot2)
				 + 0.1333333 * simplex3d(4.0 * m * rot3)
				 + 0.0666667 * simplex3d(8.0 * m);
		}`,[fKb]),hKb=new yyb("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),iKb=new yyb("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),jKb=new yyb(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[hKb,iKb]),kKb=new yyb("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),lKb=new yyb("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[kKb]),mKb=new yyb(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[lKb]),nKb=new yyb(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[mKb]),nKb.keywords.NUM_OCTAVES=new Gzb("int NUM_OCTAVES 5"),oKb=new yyb("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),pKb=new yyb(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[hKb,iKb,oKb]),qKb=new yyb(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),rKb=new yyb(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),sKb=new yyb(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),tKb=new yyb(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),uKb=new yyb(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),vKb=new yyb(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),wKb=new yyb(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			float id = hashwithoutsine13(vec3(p + mb) + seed);

			// Second pass for edge distance  
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[qKb,rKb,sKb,tKb,uKb,vKb]),{simplex:fKb,simplexFractal:gKb,simplexAshima:jKb,fbm:nKb,perlin:pKb,voronoi:wKb}),zKb=class extends Nwb{constructor(AKb,BKb,CKb,DKb,EKb,FKb,GKb,HKb,IKb,JKb,KKb,LKb,MKb,NKb,OKb,PKb,QKb,RKb,SKb){super("v3"),this.nodeType="Noise",this.scale=AKb,this.size=BKb,this.move=CKb,this.fA=DKb,this.fB=EKb,this.distortion=FKb,this.colorA=GKb,this.colorB=HKb,this.colorC=IKb,this.colorD=JKb,this.noiseType=LKb,this.voronoiStyle=NKb,this.highCut=OKb,this.lowCut=PKb,this.smoothness=QKb,this.seed=RKb,this.quality=SKb,this.isMask=MKb,this.alpha=KKb,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(TKb,UKb,VKb,WKb,XKb){TKb.require("uv"),TKb.requires.uv=[!0],TKb.addFragmentVariable(this.calpha,"float");let YKb=Object.values(xKb)[this.noiseType.value],ZKb="voronoi"==YKb?`
		float v = ${YKb}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${YKb}(st),
					   ${YKb}(st + vec3(1.0)),
					   ${YKb}(st + vec3(1.0)));
		vec3 r = vec3(${YKb}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${YKb}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${YKb}(st * q));
		float f = ${YKb}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,$Kb=new yyb(`vec3 ${YKb}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${ZKb}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[yKb.simplex,yKb.simplexFractal,yKb.simplexAshima,yKb.fbm,yKb.perlin,yKb.voronoi]),_Kb=TKb.include($Kb),aLb=[];return aLb.push(this.scale.build(TKb,"f")),aLb.push(this.size.build(TKb,"v3")),aLb.push(this.move.build(TKb,"f")),aLb.push(this.fA.build(TKb,"v2")),aLb.push(this.fB.build(TKb,"v2")),aLb.push(this.distortion.build(TKb,"v2")),aLb.push(this.colorA.build(TKb,"v4")),aLb.push(this.colorB.build(TKb,"v4")),aLb.push(this.colorC.build(TKb,"v4")),aLb.push(this.colorD.build(TKb,"v4")),aLb.push(this.voronoiStyle.build(TKb,"i")),aLb.push(this.highCut.build(TKb,"f")),aLb.push(this.lowCut.build(TKb,"f")),aLb.push(this.smoothness.build(TKb,"f")),aLb.push(this.seed.build(TKb,"f")),aLb.push(this.quality.build(TKb,"i")),aLb.push(this.isMask.build(TKb,"b")),aLb.push(this.mask?`luminance(${this.mask.flow(TKb,"v3").result})`:"1.0"),aLb.push(this.alpha.build(TKb,"f")),aLb.push(this.calpha),TKb.format(_Kb+"("+aLb.join(",")+")",this.getType(TKb),UKb)}};zKb.numOctaves=5;var bLb=class extends Nwb{constructor(cLb,dLb,eLb,fLb,gLb,hLb,iLb,jLb,kLb,lLb,mLb,nLb,oLb,pLb,qLb,rLb){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=cLb,this.contourColor=dLb,this.outlineWidth=eLb,this.contourWidth=fLb,this.contourThreshold=gLb,this.outlineThreshold=hLb,this.contourFrequency=iLb,this.outlineSmoothing=jLb,this.contourDirection=kLb,this.positionalLines=lLb,this.compensation=mLb,this.resolution=nLb,this.normalMap=oLb,this.depthMap=pLb,this.pixelRatio=qLb,this.alpha=rLb,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(sLb,tLb){let uLb=`g${this.uuid.toString().replace(/-/g,"")}`;if(sLb.require("vWorldViewDir"),sLb.require("worldNormal"),sLb.extensions.derivatives=!0,this.compensation.value&&sLb.define("OUTLINE_COMPENSATION",`${uLb}_offset`),this.firstTime){let vLb=this.outlineWidth.build(sLb,"f"),wLb=this.resolution.build(sLb,"v2"),xLb=this.compensation.build(sLb,"b"),yLb=this.pixelRatio.build(sLb,"f");sLb.addVertexParsVariable("randomColor","attribute vec3"),sLb.addVertexParsVariable("extrudeNormal","attribute vec3"),sLb.addVertexParsVariable(vLb,"uniform float"),sLb.addVertexParsVariable(wLb,"uniform vec2"),sLb.addVertexParsVariable(xLb,"uniform bool"),sLb.addVertexParsVariable(yLb,"uniform float"),sLb.addVertexParsVariable("vID","flat out float"),sLb.addFragmentParsVariable("vID","flat in float"),sLb.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${uLb}_offset = vec2(0.0);
                if (${xLb}) {
                    vec4 ${uLb}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${uLb}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${uLb}_offset = normalize(${uLb}_clipNormal.xy) / ${wLb} * (${vLb} / 2.0) * ${uLb}_clipPosition.w * 2.0 * ${yLb};
                    ${uLb}_clipPosition.xy += ${uLb}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${uLb}_clipPosition;
                }
            `)}if(!sLb.isShader("fragment"))return console.warn("OutlineNode is not compatible with "+sLb.shader+" shader."),"";{sLb.require("uv"),sLb.requires.uv=[!0],sLb.addFragmentVariable(this.calpha,"float");let zLb=sLb.include(bLb.Nodes.outline),ALb=[];return ALb.push(this.outlineColor.build(sLb,"c")),ALb.push(this.contourColor.build(sLb,"c")),ALb.push(this.outlineWidth.build(sLb,"f")),ALb.push(this.contourWidth.build(sLb,"f")),ALb.push(this.contourThreshold.build(sLb,"f")),ALb.push(this.outlineThreshold.build(sLb,"f")),ALb.push(this.contourFrequency.build(sLb,"f")),ALb.push(this.outlineSmoothing.build(sLb,"f")),ALb.push(this.contourDirection.build(sLb,"v3")),ALb.push(this.positionalLines.build(sLb,"b")),ALb.push(this.resolution.build(sLb,"v2")),ALb.push(this.normalMap.getTexture(sLb,"t")),ALb.push(this.depthMap.getTexture(sLb,"t")),ALb.push(this.pixelRatio.build(sLb,"f")),ALb.push(this.compensation.build(sLb,"b")),ALb.push(this.mask?`luminance(${this.mask.flow(sLb,"v3").result})`:"1.0"),ALb.push(this.alpha.build(sLb,"f")),ALb.push(this.calpha),this.firstTime=!this.firstTime,sLb.format(zLb+"("+ALb.join(",")+")",this.getType(sLb),tLb)}}},BLb=bLb;let CLb;BLb.Nodes=(CLb=new yyb(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`),{outline:new yyb(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[CLb])});var DLb=class extends Nwb{constructor(ELb,FLb,GLb,HLb,ILb,JLb,KLb,LLb,MLb,NLb,OLb,PLb,QLb,RLb,SLb,TLb,ULb,VLb){super("v3"),this.nodeType="Pattern",this.style=ELb,this.projection=FLb,this.axis=GLb,this.blending=HLb,this.offset=ILb,this.colorA=JLb,this.colorB=KLb,this.frequency=LLb,this.size=MLb,this.variation=NLb,this.smoothness=OLb,this.zigzag=PLb,this.rotation=QLb,this.vertical=RLb,this.horizontal=SLb,this.sides=TLb,this.isMask=VLb,this.alpha=ULb,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(WLb,XLb){if(!WLb.isShader("fragment"))return console.warn("PatterNode is not compatible with "+WLb.shader+" shader."),WLb.format("vec3(0.0)",this.getType(WLb),XLb);{WLb.require("position"),WLb.require("uv"),WLb.requires.uv=[!0],WLb.require("normal"),WLb.requires.normal=!0,WLb.addFragmentVariable(this.calpha,"float");let YLb;switch(this.style.value){case 0:YLb="circle";break;case 1:YLb="ring";break;case 2:YLb="polygon";break;case 3:YLb="xcross";break;case 4:YLb="diamond";break;case 5:YLb="checkerboard";break;case 6:YLb="line";break;case 7:YLb="wave";break;default:YLb="circle";break}let ZLb=`g${this.uuid.toString().replace(/-/g,"")}`,$Lb=new yyb(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),_Lb=new yyb(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),aMb="";if(4===this.projection.value){let bMb=2===this.style.value?`${YLb}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${YLb}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,cMb=2===this.style.value?`${YLb}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${YLb}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;aMb=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${bMb};
				float d1 = ${cMb};
				float d2 = ${2===this.style.value?`${YLb}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${YLb}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let dMb=2===this.style.value?`${YLb}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${YLb}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,eMb="";0===this.axis.value?eMb=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:1===this.axis.value?eMb=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,eMb=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let fMb="";switch(this.projection.value){case 0:fMb="custom_uv = vUv.st;";break;case 1:break;case 2:fMb=`
							vec3 p = position;
							${eMb}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break;case 3:break;default:break}aMb=`
				vec2 custom_uv;
				${fMb}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${dMb};
				`}let gMb=new yyb(`vec3 ${ZLb}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${aMb}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[_Lb,$Lb,DLb.DrawFunctions.circle,DLb.DrawFunctions.ring,DLb.DrawFunctions.polygon,DLb.DrawFunctions.cross,DLb.DrawFunctions.diamond,DLb.DrawFunctions.checkerboard,DLb.DrawFunctions.line,DLb.DrawFunctions.wave]),hMb=WLb.include(gMb),iMb=[];return iMb.push("normal"),iMb.push(this.blending.build(WLb,"f")),iMb.push(this.style.build(WLb,"i")),iMb.push(this.offset.build(WLb,"v2")),iMb.push(this.colorA.build(WLb,"v4")),iMb.push(this.colorB.build(WLb,"v4")),iMb.push(this.frequency.build(WLb,"v2")),iMb.push(this.size.build(WLb,"f")),iMb.push(this.variation.build(WLb,"f")),iMb.push(this.smoothness.build(WLb,"f")),iMb.push(this.zigzag.build(WLb,"f")),iMb.push(this.rotation.build(WLb,"f")),iMb.push(this.vertical.build(WLb,"v2")),iMb.push(this.horizontal.build(WLb,"v2")),iMb.push(this.sides.build(WLb,"i")),iMb.push(this.isMask.build(WLb,"b")),iMb.push(this.mask?`luminance(${this.mask.flow(WLb,"v3").result})`:"1.0"),iMb.push(this.alpha.build(WLb,"f")),iMb.push(this.calpha),WLb.format(hMb+"("+iMb.join(",")+")",this.getType(WLb),XLb)}}},jMb=DLb;let kMb,lMb,mMb,nMb,oMb,pMb,qMb,rMb,sMb,tMb;jMb.DrawFunctions=(kMb=new yyb(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),lMb=new yyb(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[kMb]),mMb=new yyb(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[lMb]),nMb=new yyb(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[lMb]),oMb=new yyb(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[lMb]),pMb=new yyb(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[lMb]),qMb=new yyb(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[lMb]),rMb=new yyb(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),sMb=new yyb(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[lMb]),tMb=new yyb(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`),{tileAndCenter:lMb,circle:mMb,ring:nMb,polygon:oMb,cross:pMb,diamond:qMb,checkerboard:rMb,line:sMb,wave:tMb});var uMb=class extends Nwb{constructor(vMb,wMb,xMb,yMb,zMb,AMb,BMb,CMb){super("v3"),this.nodeType="Rainbow",this.filmThickness=vMb,this.movement=wMb,this.wavelengths=xMb,this.noiseStrength=yMb,this.noiseScale=zMb,this.offset=AMb,this.isMask=CMb,this.alpha=BMb,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(DMb,EMb){if(DMb.require("vWorldViewDir"),DMb.require("worldNormal"),!DMb.isShader("fragment"))return console.warn("RainbowNode is not compatible with "+DMb.shader+" shader."),DMb.format("vec3( 0.0 )",this.getType(DMb),EMb);{DMb.require("uv"),DMb.requires.uv=[!0],DMb.addFragmentVariable(this.calpha,"float");let FMb=DMb.include(uMb.Nodes.rainbow),GMb=[];return GMb.push(this.filmThickness.build(DMb,"f")),GMb.push(this.movement.build(DMb,"f")),GMb.push(this.wavelengths.build(DMb,"v3")),GMb.push(this.noiseStrength.build(DMb,"f")),GMb.push(this.noiseScale.build(DMb,"f")),GMb.push(this.offset.build(DMb,"v3")),GMb.push(this.isMask.build(DMb,"b")),GMb.push(this.mask?`luminance(${this.mask.flow(DMb,"v3").result})`:"1.0"),GMb.push(this.alpha.build(DMb,"f")),GMb.push(this.calpha),DMb.format(FMb+"("+GMb.join(",")+")",this.getType(DMb),EMb)}}},HMb=uMb;let IMb;HMb.Nodes=(IMb=new yyb(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
                 vec3 st = position / noiseScale;
				 vec3 q = vec3(simplex3d(st),
							  simplex3d(st + vec3(1.0)),
							  simplex3d(st + vec3(1.0)));

				 vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),
							  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),
							  simplex3d(st * q));

                 float noise = simplex3d(st + r);

                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);
             }`,[yKb.simplex]),{rainbow:new yyb(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
             }`,[IMb])});var JMb=class extends Nwb{constructor(KMb,LMb,MMb,NMb,OMb,PMb,QMb,RMb,SMb,TMb){super("v3"),this.nodeType="Toon",this.positioning=KMb,this.colors=LMb,this.steps=MMb,this.source=NMb,this.isWorldSpace=OMb,this.noiseStrength=PMb,this.noiseScale=QMb,this.shadowColor=RMb,this.offset=SMb,this.alpha=TMb,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(UMb,VMb){if(UMb.require("worldNormal"),UMb.require("worldPosition"),!UMb.isShader("fragment"))return console.warn("ToonNode is not compatible with "+UMb.shader+" shader."),UMb.format("vec3( 0.0 )",this.getType(UMb),VMb);{UMb.define("COLORS_MAX",10),UMb.addFragmentVariable(this.calpha,"float");let WMb=UMb.include(JMb.Nodes.toon),XMb=[];return XMb.push(this.positioning.build(UMb,"i")),XMb.push(this.colors.build(UMb,"v4[]")),XMb.push(this.steps.build(UMb,"f[]")),XMb.push(this.source.build(UMb,"v3")),XMb.push(this.isWorldSpace.build(UMb,"b")),XMb.push(this.noiseStrength.build(UMb,"f")),XMb.push(this.noiseScale.build(UMb,"f")),XMb.push(this.shadowColor.build(UMb,"v4")),XMb.push(this.offset.build(UMb,"v3")),XMb.push(this.mask?`luminance(${this.mask.flow(UMb,"v3").result})`:"1.0"),XMb.push(this.alpha.build(UMb,"f")),XMb.push(this.calpha),UMb.format(WMb+"("+XMb.join(",")+")",this.getType(UMb),VMb)}}},YMb=JMb;let ZMb,$Mb,_Mb,aNb,bNb;YMb.Nodes=(ZMb=new yyb(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),$Mb=new yyb(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),_Mb=new yyb(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[$Mb]),aNb=new yyb(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),bNb=new yyb(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[aNb]),{toon:new yyb(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplex3d(st),
					// 	simplex3d(st + vec3(111.1, 143.89, 217.19)),
					// 	simplex3d(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[yKb.simplex,ZMb,_Mb,bNb])});var cNb={textureBicubic:new yyb(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)},dNb=class extends Nwb{constructor(eNb,fNb,gNb,hNb,iNb,jNb,kNb,lNb){super("v3"),this.nodeType="Transmission",this.thickness=eNb,this.ior=fNb,this.roughness=gNb,this.transmissionSamplerSize=hNb,this.transmissionSamplerMap=iNb,this.transmissionDepthMap=jNb,this.aspectRatio=kNb,this.alpha=lNb,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(mNb,nNb){if(mNb.extensions.shaderTextureLOD=!0,mNb.extensions.derivatives=!0,!mNb.isShader("fragment"))return console.warn("TransmissionNode is not compatible with "+mNb.shader+" shader."),mNb.format("vec3( 0.0 )",this.getType(mNb),nNb);{mNb.define("NUM_SAMPLES",6),mNb.define("BLUR_SLOD",Math.pow(2,WNb.transmissionLod.value)),mNb.require("worldPosition"),mNb.requires.worldNormal=!0,mNb.requires.modelMatrix=!0,mNb.requires.projectionMatrix=!0,mNb.addFragmentVariable(this.calpha,"float");let oNb=mNb.include(dNb.Nodes.transmission),pNb=[];return pNb.push(this.thickness.build(mNb,"f")),pNb.push(this.ior.build(mNb,"f")),pNb.push(this.roughness.build(mNb,"f")),pNb.push(this.transmissionSamplerSize.build(mNb,"v2")),pNb.push(this.transmissionSamplerMap.getTexture(mNb,"t")),pNb.push(this.transmissionDepthMap.getTexture(mNb,"t")),pNb.push(this.aspectRatio.build(mNb,"v2")),pNb.push("normal"),pNb.push(this.mask?`luminance(${this.mask.flow(mNb,"v3").result})`:"1.0"),pNb.push(this.alpha.build(mNb,"f")),pNb.push(this.calpha),mNb.format(oNb+"("+pNb.join(",")+")",this.getType(mNb),nNb)}}},qNb=dNb;let rNb,sNb,tNb,uNb,vNb;qNb.Nodes=(rNb=new yyb(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),sNb=new yyb(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),tNb=new yyb(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),uNb=new yyb(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[cNb.textureBicubic,tNb,rNb]),vNb=new yyb(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[uNb,sNb]),{transmission:new yyb(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[vNb])});var wNb,xNb=((wNb=xNb||{}).NOISE="noise",wNb.MAP="map",wNb),yNb=class extends Nwb{constructor(zNb,ANb,BNb,CNb,DNb,ENb,FNb,GNb,HNb,INb,JNb){super("v3"),this.displacementTypeIndex=new ZGb(0),this.nodeType="VertexDisplacement",this.intensity=zNb,this.movementOrTexture=ANb,"map"===Object.values(xNb)[this.displacementTypeIndex.value]&&(this.mat=new vHb(this.movementOrTexture.value.matrix)),this.cropOrOffset=BNb,this.scale=INb,this.noiseFunctionIndex=JNb,this.voronoiStyle=CNb,this.smoothness=DNb,this.seed=ENb,this.highCut=FNb,this.lowCut=GNb,this.quality=HNb}generate(KNb,LNb){if(!KNb.isShader("vertex"))return console.warn("VertexDisplacementNode is not compatible with "+KNb.shader+" shader."),KNb.format("vec3( 0.0 )",this.getType(KNb),LNb);{KNb.define("USE_LAYER_DISPLACE");let MNb,NNb=[];switch(NNb.push("displaced_position"),NNb.push("displaced_normal"),Object.values(xNb)[this.displacementTypeIndex.value]){case"map":MNb=KNb.include(yNb.Nodes.map),NNb.push(this.movementOrTexture.getTexture(KNb,"t")),NNb.push("uv"),NNb.push(this.cropOrOffset.build(KNb,"f")),this.mat&&NNb.push(this.mat.build(KNb,"mat3"));break;case"noise":{let ONb=Object.values(xKb)[this.noiseFunctionIndex.value],PNb=new yyb(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),QNb="voronoi"==ONb?`
					float v = ${ONb}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${ONb}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,RNb=new yyb(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${QNb}
						}`,[yKb.simplex,yKb.simplexFractal,yKb.simplexAshima,yKb.fbm,yKb.perlin,yKb.voronoi]),SNb=new yyb(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[RNb,PNb]);MNb=KNb.include(SNb),NNb.push(this.scale.build(KNb,"f")),NNb.push(this.cropOrOffset.build(KNb,"v3")),NNb.push(this.movementOrTexture.build(KNb,"f")),NNb.push(this.voronoiStyle.build(KNb,"i")),NNb.push(this.smoothness.build(KNb,"f")),NNb.push(this.seed.build(KNb,"f")),NNb.push(this.highCut.build(KNb,"f")),NNb.push(this.lowCut.build(KNb,"f")),NNb.push(this.quality.build(KNb,"i"));break}}return NNb.push(this.intensity.build(KNb,"f")),NNb.push("displaced_normal"),KNb.format(MNb+"("+NNb.join(",")+")",this.getType(KNb),LNb)}}},TNb=yNb;let UNb,VNb;TNb.Nodes=(UNb=new yyb(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),VNb=new yyb(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`),{map:new yyb(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[UNb,VNb])});var WNb={normalRenderTarget:new xAb,normalRenderTargetDepth:new xAb,transmissionRenderTarget:new xAb,aspectRatio:new xxb,transmissionSize:new xxb(2048,2048),transmissionRenderTargetDepth:new xAb,aoRenderTarget:new xAb,aoEnabled:new fHb,pixelRatioNode:new NAb(1),resolution:new xxb,penumbraSize:new lHb(5,.5),frameIndex:new ZGb(0),transmissionLod:new ZGb(2)};for(let XNb of Object.values(WNb))XNb.isRenderGlobal=!0;var YNb={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.0.54/build/ui.wasm"},ZNb=class extends Mvb{constructor(){super("basic"),this.nodeType="Basic",this.color=new EGb(SIa),this.shadingAlpha=new NAb(1),this.shadingBlend=new ZGb(0),this.previousModelViewMatrix=new EHb,this.previouseProjectionMatrix=new EHb}get category(){return"phong"}generate($Nb){let _Nb;if($Nb.isShader("vertex")){let aOb=this.position?this.position.analyzeAndFlow($Nb,"v3",{cache:"position"}):void 0;$Nb.mergeUniform({frameIndex:WNb.frameIndex}),$Nb.mergeUniform({resolution:WNb.resolution}),$Nb.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),$Nb.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),$Nb.mergeUniform(oJ.merge([nO.fog])),$Nb.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join(`
`));let bOb=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];aOb&&bOb.push(aOb.code,aOb.result?"displaced_position = "+aOb.result+";":""),bOb.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","\tvNormal = transformedNormal;","#endif"),bOb.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),bOb.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),_Nb=bOb.join(`
`)}else{void 0===this.color&&(this.color=new EGb(SIa)),this.color.analyze($Nb,{slot:"color"}),this.alpha&&this.alpha.analyze($Nb),this.afterColor&&this.afterColor.analyze($Nb,{slot:"afterColor"});let cOb=this.color.flow($Nb,"c",{slot:"color"}),dOb=this.alpha?this.alpha.flow($Nb,"f"):void 0,eOb=this.alphaOverride?this.alphaOverride.flow($Nb,"f"):void 0,fOb=this.afterColor?this.afterColor.flow($Nb,"c",{slot:"afterColor"}):void 0;$Nb.requires.transparent=void 0!==dOb,$Nb.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let gOb=["#include <normal_fragment_begin>",cOb.code];dOb&&gOb.push(dOb.code,"#ifdef ALPHATEST"," if ( "+dOb.result+" <= ALPHATEST ) discard;","#endif"),fOb?gOb.push(fOb.code,`vec3 outgoingLight = ${cOb.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${fOb.result}, 1.0, SPE_BLENDING_NORMAL);`):gOb.push(`vec3 finalColor = ${cOb.result};`);let hOb="1.0";this.mask&&(this.mask.analyze($Nb),hOb=`luminance(${this.mask.flow($Nb,"v3").result})`),dOb?gOb.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${dOb.result} * ${hOb} );`):gOb.push("gl_FragColor = vec4("+cOb.result+", 1.0 );"),eOb&&gOb.push(`gl_FragColor.a *= ${eOb.result};`),gOb.push("#include <fog_fragment>","#include <dithering_fragment>"),_Nb=gOb.join(`
`)}return _Nb}},iOb=class extends Mvb{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new EGb(SIa),this.emissive=new EGb(0),this.emissiveIntensity=new NAb(1),this.previousModelViewMatrix=new EHb,this.previouseProjectionMatrix=new EHb,this.shadingAlpha=new NAb(1),this.shadingBlend=new ZGb(0),this.occlusion=new fHb(!0)}get category(){return"lambert"}build(jOb){let kOb;if(jOb.define("LAMBERT"),jOb.requires.lights=!0,jOb.extensions.derivatives=!0,jOb.isShader("vertex")){let lOb=this.position?this.position.analyzeAndFlow(jOb,"v3",{cache:"position"}):void 0;jOb.mergeUniform({frameIndex:WNb.frameIndex}),jOb.mergeUniform({resolution:WNb.resolution}),jOb.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),jOb.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),jOb.mergeUniform(oJ.merge([nO.fog,nO.lights])),jOb.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let mOb=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];lOb&&mOb.push(lOb.code,lOb.result?"displaced_position = "+lOb.result+";":""),mOb.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),mOb.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),mOb.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),mOb.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),kOb=mOb.join(`
`)}else{jOb.mergeUniform({penumbraSize:WNb.penumbraSize}),jOb.mergeUniform({frameIndex:WNb.frameIndex}),jOb.mergeUniform({aoMap:WNb.aoRenderTarget}),jOb.mergeUniform({aoEnabled:WNb.aoEnabled}),void 0===this.color&&(this.color=new EGb(SIa)),this.color.analyze(jOb,{slot:"color"}),this.shadingAlpha.analyze(jOb),this.shadingBlend.analyze(jOb),this.afterColor&&this.afterColor.analyze(jOb,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(jOb);let nOb=this.color.flow(jOb,"c",{slot:"color"}),oOb=this.emissive.flow(jOb,"c",{slot:"emissive"}),pOb=this.emissiveIntensity.flow(jOb,"f",{slot:"emissive"}),qOb=this.occlusion.flow(jOb,"b",{slot:"occlusion"}),rOb=this.shadingAlpha.flow(jOb,"f"),sOb=this.shadingBlend.flow(jOb,"i"),tOb=this.afterColor?this.afterColor.flow(jOb,"c",{slot:"afterColor"}):void 0,uOb=this.alpha?this.alpha.flow(jOb,"f"):void 0,vOb=this.alphaOverride?this.alphaOverride.flow(jOb,"f"):void 0;jOb.requires.transparent=void 0!==uOb,jOb.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let wOb=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];wOb.push(nOb.code,"vec3 diffuseColor = "+nOb.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),uOb&&wOb.push(uOb.code,"#ifdef ALPHATEST","if ( "+uOb.result+" <= ALPHATEST ) discard;","#endif"),wOb.push("#ifdef DOUBLE_SIDED","\treflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","\treflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","\treflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","\treflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),oOb&&wOb.push(oOb.code,"reflectedLight.directDiffuse += "+oOb.result+" * "+pOb.result+";"),wOb.push("vec3 ao = aoEnabled && "+qOb.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let xOb="1.0";this.mask&&(this.mask.analyze(jOb),xOb=`luminance(${this.mask.flow(jOb,"v3").result})`),wOb.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${rOb.result} * ${xOb} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${rOb.result} * ${xOb}, ${sOb.result} );

					outgoingLight *= ao;
				}
				`),tOb&&wOb.push(tOb.code,`outgoingLight = spe_blend(outgoingLight, ${tOb.result}, 1.0, SPE_BLENDING_NORMAL);`),uOb?wOb.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${uOb.result} );`):wOb.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),vOb&&wOb.push(`gl_FragColor.a *= ${vOb.result};`),wOb.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),kOb=wOb.join(`
`)}return kOb}};let yOb,zOb;var AOb,BOb,COb,DOb,EOb=(yOb=new yyb(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),zOb=new yyb(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`),{dHdxy:yOb,perturbNormalArb:zOb}),FOb=class extends Mvb{constructor(){super("phong"),this.nodeType="Phong",this.color=new EGb(SIa),this.specular=new EGb(1118481),this.shininess=new NAb(30),this.previousModelViewMatrix=new EHb,this.previouseProjectionMatrix=new EHb,this.shadingAlpha=new NAb(1),this.shadingBlend=new ZGb(0),this.occlusion=new fHb(!0)}get category(){return"phong"}build(GOb){let HOb;if(GOb.define("PHONG"),GOb.requires.lights=!0,GOb.extensions.derivatives=!0,GOb.isShader("vertex")){let IOb=this.position?this.position.analyzeAndFlow(GOb,"v3",{cache:"position"}):void 0;GOb.mergeUniform({frameIndex:WNb.frameIndex}),GOb.mergeUniform({resolution:WNb.resolution}),GOb.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),GOb.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),GOb.mergeUniform(oJ.merge([nO.fog,nO.lights])),GOb.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let JOb=["#include <beginnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif


				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];IOb&&JOb.push(IOb.code,IOb.result?"displaced_position = "+IOb.result+";":""),JOb.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),JOb.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),JOb.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),HOb=JOb.join(`
`)}else{GOb.mergeUniform({penumbraSize:WNb.penumbraSize}),GOb.mergeUniform({frameIndex:WNb.frameIndex}),GOb.mergeUniform({aoMap:WNb.aoRenderTarget}),GOb.mergeUniform({aoEnabled:WNb.aoEnabled}),void 0===this.color&&(this.color=new EGb(SIa)),this.color.analyze(GOb,{slot:"color"}),this.specular.analyze(GOb),this.shininess.analyze(GOb);let KOb=this.occlusion.flow(GOb,"b",{slot:"occlusion"});this.shadingAlpha.analyze(GOb),this.shadingBlend.analyze(GOb),this.afterColor&&this.afterColor.analyze(GOb,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(GOb);let LOb=this.color.flow(GOb,"c",{slot:"color"}),MOb=this.specular.flow(GOb,"c"),NOb=this.shininess.flow(GOb,"f"),OOb=this.shadingAlpha.flow(GOb,"f"),POb=this.shadingBlend.flow(GOb,"i"),QOb=this.afterColor?this.afterColor.flow(GOb,"c",{slot:"afterColor"}):void 0,ROb=this.alpha?this.alpha.flow(GOb,"f"):void 0,SOb=this.alphaOverride?this.alphaOverride.flow(GOb,"f"):void 0;GOb.requires.transparent=void 0!==ROb,GOb.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let TOb=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"\tBlinnPhongMaterial material;"];if(this.bumpMap){GOb.include(EOb.dHdxy),GOb.include(EOb.perturbNormalArb);let UOb=this.bumpMap.texture.flow(GOb,"t"),VOb=this.bumpMap.flow(GOb,"v3"),WOb=this.bumpMapIntensity?this.bumpMapIntensity.flow(GOb,"f").result:"1.0",XOb="";XOb=4===this.bumpMap.projection.value?`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${UOb.result}, uv0, ${WOb});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${UOb.result}, uv1, ${WOb});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${UOb.result}, uv2, ${WOb});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${UOb.result}, bumpMapCachedUv, ${WOb});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,TOb.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${VOb.result};
					${XOb}
					`)}TOb.push(LOb.code,"\tvec3 diffuseColor = "+LOb.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","\tvec3 totalEmissiveRadiance = emissive;",MOb.code,"\tvec3 specular = "+MOb.result+";",NOb.code,"\tfloat shininess = max( 0.0001, "+NOb.result+" );","\tfloat specularStrength = 1.0;"),ROb&&TOb.push(ROb.code,"#ifdef ALPHATEST","if ( "+ROb.result+" <= ALPHATEST ) discard;","#endif"),TOb.push("material.diffuseColor = diffuseColor;"),TOb.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),TOb.push("vec3 ao = aoEnabled && "+KOb.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let YOb="1.0";this.mask&&(this.mask.analyze(GOb),YOb=`luminance(${this.mask.flow(GOb,"v3").result})`),TOb.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${OOb.result} * ${YOb} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${OOb.result} * ${YOb}, ${POb.result} );
					
					outgoingLight *= ao;
				}
				`),QOb&&TOb.push(QOb.code,`outgoingLight = spe_blend(outgoingLight, ${QOb.result}, 1.0, SPE_BLENDING_NORMAL);`),ROb?TOb.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${ROb.result});`):TOb.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),SOb&&TOb.push(`gl_FragColor.a *= ${SOb.result};`),TOb.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),HOb=TOb.join(`
`)}return HOb}},ZOb=class extends Mvb{constructor(){super("standard"),this.nodeType="Standard",this.color=new EGb(SIa),this.roughness=new NAb(.3),this.metalness=new NAb(0),this.reflectivity=new NAb(.5),this.previousModelViewMatrix=new EHb,this.previouseProjectionMatrix=new EHb,this.shadingAlpha=new NAb(1),this.shadingBlend=new ZGb(0),this.occlusion=new fHb(!0)}get category(){return"physical"}build($Ob){let _Ob;if($Ob.define("STANDARD"),$Ob.requires.lights=!0,$Ob.extensions.derivatives=!0,$Ob.extensions.shaderTextureLOD=!0,$Ob.isShader("vertex")){let aPb=this.position?this.position.analyzeAndFlow($Ob,"v3",{cache:"position"}):void 0;$Ob.mergeUniform({frameIndex:WNb.frameIndex}),$Ob.mergeUniform({resolution:WNb.resolution}),$Ob.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),$Ob.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),$Ob.mergeUniform(oJ.merge([nO.fog,nO.lights])),nO.LTC_1&&($Ob.uniforms.ltc_1={value:void 0},$Ob.uniforms.ltc_2={value:void 0}),$Ob.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let bPb=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];aPb&&bPb.push(aPb.code,aPb.result?"displaced_position = "+aPb.result+";":""),bPb.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),bPb.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),bPb.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),_Ob=bPb.join(`
`)}else{$Ob.mergeUniform({penumbraSize:WNb.penumbraSize}),$Ob.mergeUniform({frameIndex:WNb.frameIndex}),$Ob.mergeUniform({aoMap:WNb.aoRenderTarget}),$Ob.mergeUniform({aoEnabled:WNb.aoEnabled});let cPb={gamma:!0};void 0===this.color&&(this.color=new EGb(SIa)),this.color.analyze($Ob,{slot:"color",context:cPb}),this.roughness.analyze($Ob),this.metalness.analyze($Ob);let dPb=this.occlusion.flow($Ob,"b",{slot:"occlusion"});this.shadingAlpha.analyze($Ob),this.shadingBlend.analyze($Ob),this.afterColor&&this.afterColor.analyze($Ob,{slot:"afterColor"}),this.alpha&&this.alpha.analyze($Ob),this.reflectivity&&this.reflectivity.analyze($Ob);let ePb=this.color.flow($Ob,"c",{slot:"color",context:cPb}),fPb=this.roughness.flow($Ob,"f"),gPb=this.metalness.flow($Ob,"f"),hPb=this.shadingAlpha.flow($Ob,"f"),iPb=this.shadingBlend.flow($Ob,"i"),jPb=this.afterColor?this.afterColor.flow($Ob,"c",{slot:"afterColor"}):void 0,kPb=this.alpha?this.alpha.flow($Ob,"f"):void 0,lPb=this.alphaOverride?this.alphaOverride.flow($Ob,"f"):void 0,mPb=this.reflectivity?this.reflectivity.flow($Ob,"f"):void 0;$Ob.requires.transparent=void 0!==kPb,$Ob.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let nPb=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){$Ob.include(EOb.dHdxy),$Ob.include(EOb.perturbNormalArb);let oPb=this.bumpMap.texture.flow($Ob,"t"),pPb=this.bumpMap.flow($Ob,"v3"),qPb=this.bumpMapIntensity?this.bumpMapIntensity.flow($Ob,"f").result:"1.0",rPb="";rPb=4===this.bumpMap.projection.value?`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${oPb.result}, uv0, ${qPb});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${oPb.result}, uv1, ${qPb});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${oPb.result}, uv2, ${qPb});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${oPb.result}, bumpMapCachedUv, ${qPb});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,nPb.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${pPb.result};
					${rPb}
					`)}if(nPb.push(ePb.code,"\tvec3 diffuseColor = "+ePb.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",gPb.code,"\tfloat metalnessFactor = "+gPb.result+";"),this.roughnessMap){let sPb=this.roughnessMap.texture.flow($Ob,"t"),tPb=this.roughnessMap.flow($Ob,"v3"),uPb="";uPb=4===this.roughnessMap.projection.value?`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${sPb.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${sPb.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${sPb.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${fPb.result};
					`:`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${sPb.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${fPb.result};
					`,nPb.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${tPb.result};

					const float roughnessScale = 1.0;

					${uPb}
				`)}else nPb.push(fPb.code,"\tfloat roughnessFactor = "+fPb.result+";");kPb&&nPb.push(kPb.code,"#ifdef ALPHATEST","\tif ( "+kPb.result+" <= ALPHATEST ) discard;","#endif"),nPb.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),nPb.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),mPb?nPb.push(mPb.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+mPb.result+" ) ), diffuseColor, metalnessFactor );"):nPb.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),nPb.push("#include <lights_fragment_begin>"),nPb.push("#include <lights_fragment_end>"),nPb.push("vec3 ao = aoEnabled && "+dPb.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let vPb="1.0";this.mask&&(this.mask.analyze($Ob),vPb=`luminance(${this.mask.flow($Ob,"v3").result})`),nPb.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${hPb.result} * ${vPb} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${hPb.result} * ${vPb}, ${iPb.result} );
					
					outgoingLight *= ao;
				}
				`),jPb&&nPb.push(jPb.code,`outgoingLight = spe_blend(outgoingLight, ${jPb.result}, 1.0, SPE_BLENDING_NORMAL);`),kPb?nPb.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${kPb.result} );`):nPb.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),lPb&&nPb.push(`gl_FragColor.a *= ${lPb.result};`),nPb.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),_Ob=nPb.join(`
`)}return _Ob}},wPb=class extends Mvb{constructor(){super("toon"),this.nodeType="Toon",this.color=new EGb(SIa),this.specular=new EGb(1118481),this.shininess=new NAb(30),this.previousModelViewMatrix=new EHb,this.previouseProjectionMatrix=new EHb,this.shadingAlpha=new NAb(1),this.shadingBlend=new ZGb(0)}get category(){return"toon"}build(xPb){let yPb;if(xPb.define("TOON"),xPb.requires.lights=!0,xPb.extensions.derivatives=!0,xPb.isShader("vertex")){let zPb=this.position?this.position.analyzeAndFlow(xPb,"v3",{cache:"position"}):void 0;xPb.mergeUniform({frameIndex:WNb.frameIndex}),xPb.mergeUniform({resolution:WNb.resolution}),xPb.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),xPb.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),xPb.mergeUniform(oJ.merge([nO.fog,nO.lights])),xPb.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let APb=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];zPb&&APb.push(zPb.code,zPb.result?"displaced_position = "+zPb.result+";":""),APb.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),APb.push("\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),APb.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),yPb=APb.join(`
`)}else{xPb.mergeUniform({penumbraSize:WNb.penumbraSize}),xPb.mergeUniform({frameIndex:WNb.frameIndex}),xPb.mergeUniform({aoMap:WNb.aoRenderTarget}),xPb.mergeUniform({aoEnabled:WNb.aoEnabled}),void 0===this.color&&(this.color=new EGb(SIa)),this.color.analyze(xPb,{slot:"color"}),this.specular.analyze(xPb),this.shininess.analyze(xPb),this.shadingAlpha.analyze(xPb),this.shadingBlend.analyze(xPb),this.afterColor&&this.afterColor.analyze(xPb,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(xPb);let BPb=this.color.flow(xPb,"c",{slot:"color"}),CPb=this.specular.flow(xPb,"c"),DPb=this.shininess.flow(xPb,"f"),EPb=this.shadingAlpha.flow(xPb,"f"),FPb=this.shadingBlend.flow(xPb,"i"),GPb=this.afterColor?this.afterColor.flow(xPb,"c",{slot:"afterColor"}):void 0,HPb=this.alpha?this.alpha.flow(xPb,"f"):void 0,IPb=this.alphaOverride?this.alphaOverride.flow(xPb,"f"):void 0;xPb.requires.transparent=void 0!==HPb,xPb.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let JPb=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"\tToonMaterial material;"];if(this.bumpMap){xPb.include(EOb.dHdxy),xPb.include(EOb.perturbNormalArb);let KPb=this.bumpMap.texture.flow(xPb,"t"),LPb=this.bumpMap.flow(xPb,"v3"),MPb=this.bumpMapIntensity?this.bumpMapIntensity.flow(xPb,"f").result:"1.0",NPb="";NPb=4===this.bumpMap.projection.value?`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${KPb.result}, uv0, ${MPb});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${KPb.result}, uv1, ${MPb});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${KPb.result}, uv2, ${MPb});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${KPb.result}, bumpMapCachedUv, ${MPb});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,JPb.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${LPb.result};
					${NPb}
					`)}JPb.push(BPb.code,"\tvec3 diffuseColor = "+BPb.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",CPb.code,"\tvec3 specular = "+CPb.result+";",DPb.code,"\tfloat shininess = max( 0.0001, "+DPb.result+" );","\tfloat specularStrength = 1.0;"),HPb&&JPb.push(HPb.code,"#ifdef ALPHATEST","if ( "+HPb.result+" <= ALPHATEST ) discard;","#endif"),JPb.push("material.diffuseColor = diffuseColor;"),JPb.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),JPb.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let OPb="1.0";this.mask&&(this.mask.analyze(xPb),OPb=`luminance(${this.mask.flow(xPb,"v3").result})`),JPb.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${EPb.result} * ${OPb} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${EPb.result} * ${OPb}, ${FPb.result} );
				}
				`),GPb&&JPb.push(GPb.code,`outgoingLight = spe_blend(outgoingLight, ${GPb.result}, 1.0, SPE_BLENDING_NORMAL);`),HPb?JPb.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${HPb.result} );`):JPb.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),IPb&&JPb.push(`gl_FragColor.a *= ${IPb.result};`),JPb.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),yPb=JPb.join(`
`)}return yPb}},PPb=class{constructor(QPb=1e4){this.timeout=QPb,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...RPb){}remove(SPb){let TPb=this.cache.get(SPb);TPb&&(this.dispose(SPb,TPb.data),this.cache.delete(SPb),TPb.prev.next=TPb.next,TPb.next.prev=TPb.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let a=Date.now(),b=this.head.next;for(;b.time<a-this.timeout;)this.dispose(b.src,b.data),this.cache.delete(b.src),(b=b.next).prev=this.head,this.head.next=b;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(UPb){return this.cache.get(UPb)?.data}load(VPb){let WPb=Date.now(),XPb=this.cache.get(VPb);return void 0===XPb?(XPb={data:this.create(VPb),src:VPb,time:WPb,next:null,prev:null},this.cache.set(VPb,XPb)):(XPb.time=WPb,XPb.prev.next=XPb.next,XPb.next.prev=XPb.prev),XPb.prev=this.tail.prev,XPb.next=this.tail,this.tail.prev.next=XPb,this.tail.prev=XPb,this.scheduleCleanup(),XPb.data}},YPb=class extends PPb{create(ZPb){return URL.createObjectURL(new Blob([ZPb]))}dispose($Pb,_Pb){URL.revokeObjectURL(_Pb)}},aQb=class{constructor(bQb,cQb){this.data=bQb,this.cache=cQb,this.refCount=0}deref(){this.refCount,this.refCount-=1,0===this.refCount&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},dQb=class{constructor(){this.cache=new Map}remove(eQb){!1===this.cache.delete(eQb.data)}load(fQb){let gQb=this.cache.get(fQb);return void 0===gQb&&(gQb=this.create(fQb),this.cache.set(fQb,gQb)),gQb.refCount+=1,gQb}},hQb=class extends aQb{constructor(iQb,jQb){super(iQb,jQb.imageHolderCache),this.data=iQb,this.shared=jQb,this.loaded=!1,this.isVideo=!1,this.isCanvas=!1,this._cache={[1e3]:{},[1001]:{},[1002]:{}},this.isVideo="video"===iQb.type,this.isCanvas="CANVAS"===iQb.nodeName,this.updateSrc(this.isCanvas?iQb:iQb.data)}async updateSrc(kQb){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let lQb=()=>{for(let a of(this.loaded=!0,Object.values(this._cache)))for(let b of Object.values(a))b&&(b.image=this.img,b.needsUpdate=!0);this.shared.requestRender()};if(this.isCanvas)this.img=kQb,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,"string"!=typeof kQb){var mQb,nQb=new FileReader;nQb.readAsDataURL(new Blob([kQb],{type:"video/mp4"}));let oQb;await new Promise(a=>{nQb.onloadend=b=>{oQb=b.target?.result,a(null)}}),this.img.src=oQb}else this.img.src=kQb;this.img.onloadeddata=()=>{lQb()}}else this.img=new Image,mQb=kQb,this.img.src="string"==typeof mQb?mQb:(DOb||(DOb=new YPb),DOb.load(mQb)),this.img.onload=lQb}getTexture(pQb,qQb=1008){let rQb=this._cache[pQb]?.[qQb];if(rQb)return rQb;{let sQb;return this.isCanvas&&(sQb=new b$(this.img,void 0,pQb,pQb,void 0,qQb)),sQb=this.isVideo?new QZ(this.img,void 0,pQb,pQb):new ah(this.img,void 0,pQb,pQb,void 0,qQb),this.loaded&&(sQb.needsUpdate=!0),void 0===this._cache[pQb]&&(this._cache[pQb]={}),this._cache[pQb][qQb]=sQb,sQb}}setNeedsUpdate(tQb){for(let uQb of Object.values(this._cache))for(let vQb of Object.values(uQb))vQb&&(vQb.needsUpdate=tQb)}disposeTextures(){for(let[wQb,xQb]of Object.entries(this._cache))for(let[yQb,zQb]of Object.entries(xQb))zQb?.dispose(),this._cache[wQb][yQb]=void 0}dispose(){super.dispose(),this.disposeTextures()}},AQb=class extends hQb{},BQb={year:0,month:1,day:2,hour:3,minute:4,second:5},CQb={};function DQb(a,b,c,d,e,f,g){var h=new Date(0);return h.setUTCFullYear(a,b,c),h.setUTCHours(d,e,f,g),h}function EQb(a,b,c){if(!a||(d=/^(Z)$/.exec(a)))return 0;if(d=/^([+-]\d{2})$/.exec(a))return IQb(f=parseInt(d[1],10))?-(36e5*f):NaN;if(d=/^([+-]\d{2}):?(\d{2})$/.exec(a)){f=parseInt(d[1],10);var d,e,f,g=parseInt(d[2],10);return IQb(f,g)?(e=36e5*Math.abs(f)+6e4*g,f>0?-e:e):NaN}if(KQb(a)){b=new Date(b||Date.now());var h=GQb(c?b:FQb(b),a);return-(c?h:HQb(b,h,a))}return NaN}function FQb(a){return DQb(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds())}function GQb(a,b){var c,d,e,f,g,h,i,j=(g=a,(i=function a(b){if(!CQb[b]){var c=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),d="06/25/2014, 00:00:00"===c||"06/25/2014 00:00:00"===c;CQb[b]=d?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:b,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:b,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return CQb[b]}(h=b)).formatToParts?function a(b,c){try{for(var d=b.formatToParts(c),e=[],f=0;f<d.length;f++){var g=BQb[d[f].type];g>=0&&(e[g]=parseInt(d[f].value,10))}return e}catch(h){if(h instanceof RangeError)return[NaN];throw h}}(i,g):(c=i,d=g,e=c.format(d).replace(/\u200E/g,""),[(f=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(e))[3],f[1],f[2],f[4],f[5],f[6]])),k=DQb(j[0],j[1]-1,j[2],j[3]%24,j[4],j[5],0).getTime(),l=a.getTime(),m=l%1e3;return k-(l-=m>=0?m:1e3+m)}function HQb(a,b,c){var d=a.getTime()-b,e=GQb(new Date(d),c);if(b===e)return b;d-=e-b;var f=GQb(new Date(d),c);return e===f?e:Math.max(e,f)}function IQb(a,b){return -23<=a&&a<=23&&(null==b||0<=b&&b<=59)}var JQb={};function KQb(a){if(JQb[a])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:a}),JQb[a]=!0,!0}catch{return!1}}var LQb=r(x(),1),MQb=r(y(),1),NQb=2,OQb={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/};function PQb(a,b,c){b=b||0,c=c||0;var d=new Date(0);d.setUTCFullYear(a,0,4);var e=7*b+c+1-(d.getUTCDay()||7);return d.setUTCDate(d.getUTCDate()+e),d}var QQb=[31,28,31,30,31,30,31,31,30,31,30,31],RQb=[31,29,31,30,31,30,31,31,30,31,30,31];function SQb(a){return a%400==0||a%4==0&&a%100!=0}function TQb(a,b,c){if(b<0||b>11)return!1;if(null!=c){if(c<1)return!1;var d=SQb(a);if(d&&c>RQb[b]|| !d&&c>QQb[b])return!1}return!0}function UQb(a,b,c){return!(b<0||b>52||null!=c&&(c<0||c>6))}function VQb(a,b,c){return!(null!=a&&(a<0||a>=25)||null!=b&&(b<0||b>=60)||null!=c&&(c<0||c>=60))}function WQb(a,b){return b.color(a)}function XQb(a=new Date,b){var c,d,e,f,g;let h=b.format,i=a.getSeconds(),j=a;b&&null!==b.timeZone&&(j=(c=new Date,e=EQb(b.timeZone,d=function(a,b){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(null===a)return new Date(NaN);var c=b||{},d=null==c.additionalDigits?NQb:(0,LQb.default)(c.additionalDigits);if(2!==d&&1!==d&&0!==d)throw new RangeError("additionalDigits must be 0, 1 or 2");if(a instanceof Date||"object"==typeof a&&"[object Date]"===Object.prototype.toString.call(a))return new Date(a.getTime());if("number"==typeof a||"[object Number]"===Object.prototype.toString.call(a))return new Date(a);if(!("string"==typeof a||"[object String]"===Object.prototype.toString.call(a)))return new Date(NaN);var e=function(a){var b,c={},d=OQb.dateTimePattern.exec(a);if(d?(c.date=d[1],b=d[3]):(d=OQb.datePattern.exec(a))?(c.date=d[1],b=d[2]):(c.date=null,b=a),b){var e=OQb.timeZone.exec(b);e?(c.time=b.replace(e[1],""),c.timeZone=e[1].trim()):c.time=b}return c}(a),f=function(a,b){var c,d=OQb.YYY[b],e=OQb.YYYYY[b];if(c=OQb.YYYY.exec(a)||e.exec(a)){var f=c[1];return{year:parseInt(f,10),restDateString:a.slice(f.length)}}if(c=OQb.YY.exec(a)||d.exec(a)){var g=c[1];return{year:100*parseInt(g,10),restDateString:a.slice(g.length)}}return{year:null}}(e.date,d),g=f.year,h=f.restDateString,i=function(a,b){if(null===b)return null;if(0===a.length)return(d=new Date(0)).setUTCFullYear(b),d;if(c=OQb.MM.exec(a))return d=new Date(0),TQb(b,e=parseInt(c[1],10)-1)?(d.setUTCFullYear(b,e),d):new Date(NaN);if(c=OQb.DDD.exec(a)){d=new Date(0);var c,d,e,f,g=parseInt(c[1],10);return!function(a,b){if(b<1)return!1;var c=SQb(a);return!(c&&b>366|| !c&&b>365)}(b,g)?new Date(NaN):(d.setUTCFullYear(b,0,g),d)}if(c=OQb.MMDD.exec(a)){d=new Date(0),e=parseInt(c[1],10)-1;var h=parseInt(c[2],10);return TQb(b,e,h)?(d.setUTCFullYear(b,e,h),d):new Date(NaN)}if(c=OQb.Www.exec(a))return UQb(b,f=parseInt(c[1],10)-1)?PQb(b,f):new Date(NaN);if(c=OQb.WwwD.exec(a)){f=parseInt(c[1],10)-1;var i=parseInt(c[2],10)-1;return UQb(b,f,i)?PQb(b,f,i):new Date(NaN)}return null}(h,g);if(isNaN(i))return new Date(NaN);if(!i)return new Date(NaN);var j,k=i.getTime(),l=0;if(e.time&&isNaN(l=function(a){var b,c,d;if(b=OQb.HH.exec(a))return VQb(c=parseFloat(b[1].replace(",",".")))?c%24*36e5:NaN;if(b=OQb.HHMM.exec(a))return c=parseInt(b[1],10),d=parseFloat(b[2].replace(",",".")),VQb(c,d)?c%24*36e5+6e4*d:NaN;if(b=OQb.HHMMSS.exec(a)){c=parseInt(b[1],10),d=parseInt(b[2],10);var e=parseFloat(b[3].replace(",","."));return VQb(c,d,e)?c%24*36e5+6e4*d+1e3*e:NaN}return null}(e.time)))return new Date(NaN);if(e.timeZone||c.timeZone){if(isNaN(j=EQb(e.timeZone||c.timeZone,new Date(k+l))))return new Date(NaN)}else j=(0,MQb.default)(new Date(k+l)),j=(0,MQb.default)(new Date(k+l+j));return new Date(k+l+j)}(c,void 0),!0),f=new Date(d.getTime()-e),g=new Date(0),g.setFullYear(f.getUTCFullYear(),f.getUTCMonth(),f.getUTCDate()),g.setHours(f.getUTCHours(),f.getUTCMinutes(),f.getUTCSeconds(),f.getUTCMilliseconds()),g));let k=j.getHours(),l=j.getMinutes(),m;"12ampm"===b.format12h24h&&(m=k>=12?"PM":"AM");let n=k;"24"!==b.format12h24h&&0==(n=k%12)&&(n=12);let o,p;switch(h){case"HH:mm:ss":o=[n,l,i];break;case"HH:mm":o=[n,l];break;case"HH":o=[n],m=void 0;break;case"mm":o=[l],m=void 0;break;case"ss":o=[i],m=void 0;break;case"year":p=j.getFullYear();break;case"month":p=j.getMonth()+1;break;case"dayOfYear":p=Math.floor((j.getTime()-new Date(j.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":p=j.getDate();break;case"secondOfDay":p=3600*k+60*l+i;break;default:console.error("Unknown time format",h),p=0;break}return void 0!==o?{textValue:o,suffix:m}:p}function YQb(a,b){let{alpha:c,mode:d,isMask:e}=a,f="string"==typeof c?(Number(b.getVariable(c))??100)/100:c;return{type:a.type,alpha:f,mode:d,isMask:e}}var ZQb=class extends Vxb{},$Qb={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},_Qb={depth:["colors"]};function aRb(a,b,c){if("isMask"===b)return!0;let d=$Qb[a.type],e=_Qb[a.type];if(void 0!==e){let f=a.color;if(e.includes(b)){let g=f[b]?.value?.length;if(void 0!==g&&g!==c.length)return!0}}return void 0!==d&&d.includes(b)}function bRb(a,b,c){let d=c.uniforms[`f${c.id}_texture`];if(!d)return!1;let e=!1,f=a;if("image"in f){let g=f.image,h=b.image(g),i=d;i.image instanceof AQb||i.image.deref(),i.image=h}if("video"in f){let j=f.video,k=b.video(j),l=d;l.image instanceof AQb||l.image.deref(),l.image=k}if("wrapping"in f&&(d.wrap=f.wrapping),"minFilter"in f&&(d.minFilter=f.minFilter),"repeat"in f||"offset"in f){let m="mat",n=c.uniforms[`f${c.id}_${m}`];"repeat"in f&&(n.repeat=f.repeat),"offset"in f&&(n.offset=f.offset),n.updateMatrix()}return e}var cRb=(a,b,c)=>Math.max(0,Math.min(1,Number(b.getVariable("number"==typeof a?100*a:a,c)??100)/100))??1,dRb=class{constructor(eRb,fRb,gRb,hRb,iRb){for(let jRb in this.id=eRb,this.uuid=fRb,this.data=gRb,this.uniforms={},hRb)this.uniforms[`f${this.id}_${jRb}`]=hRb[jRb];for(let kRb in gRb)jTb(kRb,this,gRb,iRb)}get type(){return this.data.type}static create(lRb,mRb,nRb,oRb){if("light"===nRb.type)return GSb.createLigherLayer(lRb,mRb,nRb,oRb);if("texture"===nRb.type||"video"===nRb.type){let pRb="texture"===nRb.type?oRb.canvas(nRb.texture.image)??oRb.image(nRb.texture.image):oRb.video(nRb.texture.video),qRb=new rHb(pRb,nRb.texture.wrapping,nRb.texture.minFilter??1008),rRb=new pHb(pRb),sRb=new OHb(nRb.texture.repeat,nRb.texture.offset),tRb=new NAb(nRb.crop?1:0),uRb=new ZGb(nRb.projection??0),vRb=new ZGb(["x","y","z"].indexOf(nRb.axis)??0),wRb=new ZGb(nRb.side??0),xRb=new xxb(nRb.size?new Eb(nRb.size[0],nRb.size[1]):new Eb(100,100)),yRb=new NAb(nRb.blending??0),zRb=new NAb(cRb(nRb.alpha,oRb)),ARb=new ZGb(nRb.mode??0),BRb=new fHb(nRb.isMask?? !1),CRb=new RIb(qRb,rRb,tRb,uRb,vRb,wRb,xRb,yRb,sRb,zRb,ARb,BRb),DRb=new rAb(CRb.calpha,"f");return new pSb(lRb,mRb,nRb,{texture:qRb,textureSize:rRb,crop:tRb,projection:uRb,axis:vRb,side:wRb,size:xRb,blending:yRb,mat:sRb,alpha:zRb,mode:ARb,isMask:BRb},CRb,ARb,DRb,BRb,oRb)}if("matcap"===nRb.type){let ERb=oRb.image(nRb.texture.image),FRb=new rHb(ERb,nRb.texture.wrapping,nRb.texture.minFilter??1008),GRb=new NAb(cRb(nRb.alpha,oRb)),HRb=new ZGb(nRb.mode??0),IRb=new fHb(nRb.isMask?? !1),JRb=new dKb(FRb,GRb,HRb,IRb),KRb=new rAb(JRb.calpha,"f");return new pSb(lRb,mRb,nRb,{texture:FRb,alpha:GRb,mode:HRb,isMask:IRb},JRb,HRb,KRb,IRb,oRb)}if("displace"!==nRb.type)return iTb(lRb,mRb,nRb,oRb);if("noise"===nRb.displacementType){let LRb=new Ixb(new fm(...nRb.offset)),MRb=new NAb(nRb.scale??10),NRb=new NAb(nRb.intensity??8),ORb=new NAb(nRb.movement??1),PRb=new ZGb(nRb.noiseType??0),QRb=new ZGb(nRb.voronoiStyle??0),RRb=new NAb(nRb.smoothness??.5),SRb=new NAb(nRb.seed??0),TRb=new NAb(nRb.highCut??1),URb=new NAb(nRb.lowCut??0),VRb=new ZGb(nRb.quality??1),WRb=new TNb(NRb,ORb,LRb,QRb,RRb,SRb,TRb,URb,VRb,MRb,PRb);return new zSb(lRb,mRb,nRb,{offset:LRb,scale:MRb,intensity:NRb,movement:ORb,noiseType:PRb,voronoiStyle:QRb,smoothness:RRb,seed:SRb,highCut:TRb,lowCut:URb,quality:VRb},WRb,oRb)}throw new Error}updateByOp(XRb,YRb,ZRb){let $Rb=XRb;if(void 0===$Rb.path[0]){if(0===$Rb.type)return"type"in $Rb.props||"category"in $Rb.props||"visible"in $Rb.props?(ZRb.scene.markNeedsUpdateRendererDirty(),!0):(function(a,b,c,d){let e=!1;for(let[f,g]of Object.entries(a)){if("bumpMap"===f||"roughnessMap"===f){e=!0;continue}if(!f|| void 0===g)continue;if(jTb(f,c,d,b)){"visible"===f&&"light"===c.type&&(e=!0);continue}c.visible=d.visible;let h=c.uniforms[`f${c.id}_${f}`];if(h&&!(h instanceof oHb))switch(e=e||aRb(c,f,g),h.constructor){case EGb:if("string"==typeof g){let i=b.getColor(g);i&&(h.value=i);break}{let j=g;h.value instanceof ZQb?h.value=new Vxb(j.r,j.g,j.b,j.a):h.setRGBA(j);break}case oyb:if("string"==typeof g){let k=b.getColor(g);k&&(h.value=k);break}{let l=g;h.value instanceof ZQb?h.value=new Vxb(l.r,l.g,l.b,l.a):h.value.setRGBA(l.r,l.g,l.b,l.a);break}case xxb:{let m=g;h.value.setX(m[0]),h.value.setY(m[1]);break}case Ixb:{let n=g;h.value.setX(n[0]),h.value.setY(n[1]),h.value.setZ(n[2]);break}case xAb:bRb(g,b,c);break;case RHb:h.value=g.map(a=>new sh(...a));break;default:h.value=g;break}}return e})($Rb.props,ZRb.shared,this,YRb)}else if("texture"===$Rb.path[0])return!("texture"in YRb)&&!("video"in YRb)||bRb($Rb.props,ZRb.shared,this);return!1}dispose(){if(gTb(this)){let _Rb=this.uniforms[`f${this.id}_texture`];if(!_Rb)return!1;let aSb=_Rb;aSb.image instanceof AQb||aSb.image.deref()}}hasValueByKey(bSb){return void 0!==this.uniforms[bSb]}hasValue(cSb){return this.hasValueByKey(`f${this.id}_${cSb}`)}setValue(dSb,eSb){let fSb=`f${this.id}_${dSb}`;this.hasValueByKey(fSb)&& void 0!==eSb&&(this.uniforms[fSb].value=eSb)}getNode(gSb){let hSb=`f${this.id}_${gSb}`;if(this.hasValueByKey(hSb))return this.uniforms[hSb]}getValue(iSb){let jSb=`f${this.id}_${iSb}`;if(this.hasValueByKey(jSb))return this.uniforms[jSb].value}getName(kSb){let lSb=/f\d+_(.*)/.exec(kSb);if(lSb&&lSb.length>1)return lSb[1];console.log(`Layer.getName: error ${kSb}`)}getNames(){let mSb=[];for(let nSb in this.uniforms){let oSb=this.getName(nSb);oSb&&mSb.push(oSb)}return mSb}},pSb=class extends dRb{constructor(qSb,rSb,sSb,tSb,uSb,vSb,wSb,xSb,ySb){super(qSb,rSb,sSb,tSb,ySb),this.params=tSb,this.color=uSb,this.mode=vSb,this.alpha=wSb,this.isMask=xSb}},zSb=class extends dRb{constructor(ASb,BSb,CSb,DSb,ESb,FSb){super(ASb,BSb,CSb,DSb,FSb),this.position=ESb}},GSb=class extends dRb{constructor(HSb,ISb,JSb,KSb,LSb,MSb){super(HSb,ISb,JSb,LSb,MSb),this.node=KSb}static createLigherLayer(NSb,OSb,PSb,QSb){let RSb,SSb=new NAb(cRb(PSb.alpha,QSb)),TSb=new ZGb(PSb.mode),USb=new NAb(PSb.bumpMapIntensity),VSb=new NAb(cRb(PSb.alphaOverride,QSb)),WSb;if(PSb.visible)if("lambert"===PSb.category){RSb=new iOb;let XSb=new EGb(QSb.color(PSb.emissive)??0),YSb=new fHb(PSb.occlusion?? !0);WSb={emissive:XSb,occlusion:YSb},RSb.emissive=XSb,RSb.occlusion=YSb}else if("toon"===PSb.category){RSb=new wPb;let ZSb=new NAb(PSb.shininess??30),$Sb=new EGb(QSb.color(PSb.specular)??1118481);WSb={shininess:ZSb,specular:$Sb},RSb.shininess=ZSb,RSb.specular=$Sb}else if("physical"===PSb.category){RSb=new ZOb;let _Sb=new NAb(PSb.roughness??.3),aTb=new NAb(PSb.metalness??0),bTb=new NAb(PSb.reflectivity??.5),cTb=new fHb(PSb.occlusion?? !0);WSb={roughness:_Sb,metalness:aTb,reflectivity:bTb,occlusion:cTb},RSb.roughness=_Sb,RSb.metalness=aTb,RSb.reflectivity=bTb,RSb.occlusion=cTb}else{RSb=new FOb;let dTb=new NAb(PSb.shininess??30),eTb=new EGb(void 0!==PSb.specular?QSb.color(PSb.specular)??1118481:1118481),fTb=new fHb(PSb.occlusion?? !0);WSb={shininess:dTb,specular:eTb,occlusion:fTb},RSb.shininess=dTb,RSb.specular=eTb,RSb.occlusion=fTb}else RSb=new ZNb,WSb={};return RSb.alpha=new NAb(1),RSb.shadingAlpha=SSb,RSb.shadingBlend=TSb,RSb.bumpMapIntensity=USb,RSb.alphaOverride=VSb,WSb.alpha=RSb.shadingAlpha,WSb.mode=RSb.shadingBlend,WSb.bumpMapIntensity=RSb.bumpMapIntensity,WSb.alphaOverride=RSb.alphaOverride,new GSb(NSb,OSb,PSb,RSb,WSb,QSb)}get category(){return this.node.category}};function gTb(a){let b=a instanceof dRb?a.type:a;return"texture"===b||"video"===b||"displace_map"===b||"matcap"===b}function hTb(a){return{alpha:new NAb(a.alpha??1),mode:new ZGb(a.mode??0),isMask:new fHb(a.isMask?? !1)}}function iTb(a,b,c,d){let e=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;switch(a.type){case"fresnel":return(function(a,b){let{bias:c,scale:d,intensity:e,factor:f,color:g}=a;return{...YQb(a,b),color:WQb(g,b),bias:c,scale:d,intensity:e,factor:f}})(a,b);case"gradient":return(function(a,b){let{gradientType:c,smooth:d,colors:e,steps:f,angle:g,offset:h,morph:i}=a;return{...YQb(a,b),gradientType:c,smooth:d,colors:e.map(a=>new sh(a[0],a[1],a[2],a[3])),num:e.length,steps:f,offset:new Eb(...h),morph:new Eb(...i),angle:g}})(a,b);case"depth":return(function(a,b){let{gradientType:c,near:d,far:e,isVector:f,isWorldSpace:g,origin:h,direction:i,colors:j,steps:k,smooth:l}=a;return{...YQb(a,b),gradientType:c,near:d,far:e,isVector:f,isWorldSpace:g,origin:new fm(...h),direction:i?new fm(...i):new fm(1,0,0),colors:j.map(a=>void 0!==a?new sh(a[0],a[1],a[2],a[3]):new sh(0,0,0,0)),steps:k.slice(0,j.length),smooth:l}})(a,b);case"normal":return(function(a,b){let{cnormal:c}=a;return{...YQb(a,b),cnormal:new fm(c[0],c[1],c[2])}})(a,b);case"noise":return{...YQb(c=a,d=b),scale:c.scale,move:c.move,fA:new Eb(...c.fA),fB:new Eb(...c.fB),size:new fm(...c.size),distortion:new Eb(...c.distortion),colorA:WQb(c.colorA,d),colorB:WQb(c.colorB,d),colorC:WQb(c.colorC,d),colorD:WQb(c.colorD,d),noiseType:c.noiseType,voronoiStyle:c.voronoiStyle,highCut:c.highCut,lowCut:c.lowCut,smoothness:c.smoothness,seed:c.seed,quality:c.quality};case"rainbow":return{...YQb(e=a,b),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new fm(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new fm(...e.offset)};case"toon":return{...YQb(f=a,g=b),positioning:f.positioning,colors:f.colors.map(a=>new sh(a[0],a[1],a[2],a[3])),num:f.colors.length,steps:f.steps,source:new fm(...f.source),isWorldSpace:f.isWorldSpace,noiseStrength:f.noiseStrength,noiseScale:f.noiseScale,shadowColor:WQb(f.shadowColor,g),offset:new fm(...f.offset)};case"outline":return{...YQb(h=a,i=b),outlineColor:WQb(h.outlineColor,i),contourColor:WQb(h.contourColor,i),outlineWidth:h.outlineWidth,contourWidth:h.contourWidth,outlineThreshold:h.outlineThreshold,contourThreshold:h.contourThreshold,outlineSmoothing:h.outlineSmoothing,contourFrequency:h.contourFrequency,contourDirection:new fm(...h.contourDirection),positionalLines:h.positionalLines,compensation:h.compensation};case"transmission":return{...YQb(j=a,b),thickness:j.thickness,ior:j.ior,roughness:j.roughness};case"color":return{...YQb(k=a,l=b),color:WQb(k.color,l)};case"pattern":return{...YQb(m=a,n=b),style:m.style,projection:m.projection,axis:m.axis,blending:m.blending,offset:new Eb(...m.offset),colorA:WQb(m.colorA,n),colorB:WQb(m.colorB,n),frequency:new Eb(...m.frequency),size:m.size,variation:m.variation,smoothness:m.smoothness,zigzag:m.zigzag,rotation:m.rotation,vertical:new Eb(...m.vertical),horizontal:new Eb(...m.horizontal),sides:m.sides}}}(c,d);return(function(a,b,c,d,e){switch(a.type){case"color":{let f=new EGb(d.color??SIa),g=hTb(d),h=new hIb(f,g.alpha),i=new rAb(h.calpha,"f");return new pSb(b,c,a,{color:f,...g},h,g.mode,i,g.isMask,e)}case"fresnel":{let j=new EGb(d.color??16777215),k=new NAb(d.bias??.1),l=new NAb(d.scale??1),m=new NAb(d.intensity??2),n=new NAb(d.factor??1),o=hTb(d),p=new sJb(j,k,l,m,n,o.alpha,o.mode,o.isMask),q=new rAb(p.calpha,"f");return new pSb(b,c,a,{color:j,bias:k,scale:l,intensity:m,factor:n,...o},p,o.mode,q,o.isMask,e)}case"rainbow":{let r=new NAb(d.filmThickness??30),s=new NAb(d.movement??0),t=new Ixb(d.wavelengths??new fm(0,0,0)),u=new NAb(d.noiseStrength??0),v=new NAb(d.noiseScale??1),w=new Ixb(d.offset??new fm(0,0,0)),x=hTb(d),y=new HMb(r,s,t,u,v,w,x.alpha,x.isMask),z=new rAb(y.calpha,"f");return new pSb(b,c,a,{filmThickness:r,movement:s,wavelengths:t,noiseStrength:u,noiseScale:v,offset:w,...x},y,x.mode,z,x.isMask,e)}case"transmission":{let A=new NAb(d.thickness??10),B=new NAb(d.ior??1.5),C=new NAb(d.roughness??.5),D=WNb.transmissionSize,E=WNb.transmissionRenderTarget,F=WNb.transmissionRenderTargetDepth,G=window.innerWidth,H=window.innerHeight,I=G>=H?new xxb(H/G,1):new xxb(1,G/H),J=hTb(d),K=new qNb(A,B,C,D,E,F,I,J.alpha),L=new rAb(K.calpha,"f");return new pSb(b,c,a,{thickness:A,ior:B,roughness:C,aspectRatio:I,...J},K,J.mode,L,J.isMask,e)}case"toon":{let M=new ZGb(d.positioning??0),N;d.colors?N=new RHb(d.colors.length,d.colors):(N=new RHb(10,new sh(0,0,0,1))).value[1]=new sh(1,1,1,1);let O;d.steps?O=new lHb(d.steps.length,d.steps):(O=new lHb(10,1)).value[0]=0;let P=new Ixb(d.source??new fm(0,0,0)),Q=new fHb(d.isWorldSpace?? !0),R=new NAb(d.noiseStrength??0),S=new NAb(d.noiseScale??1),T=new oyb(d.shadowColor),U=new Ixb(d.offset??new fm(0,0,0)),V=hTb(d),W=new YMb(M,N,O,P,Q,R,S,T,U,V.alpha),X=new rAb(W.calpha,"f");return new pSb(b,c,a,{positioning:M,colors:N,steps:O,source:P,isWorldSpace:Q,noiseStrength:R,noiseScale:S,shadowColor:T,offset:U,...V},W,V.mode,X,V.isMask,e)}case"outline":{let Y=new EGb(d.outlineColor??16777215),Z=new EGb(d.contourColor??16777215),$=new NAb(d.outlineWidth??.1),_=new NAb(d.contourWidth??.1),aa=new NAb(d.outlineThreshold??.1),ba=new NAb(d.contourThreshold??.1),ca=new NAb(d.outlineSmoothing??.1),da=new NAb(d.contourFrequency??.1),ea=new Ixb(d.contourDirection??new fm(0,1,0)),fa=new fHb(d.positionalLines?? !1),ga=new fHb(d.compensation?? !0),ha=WNb.normalRenderTarget,ia=WNb.normalRenderTargetDepth,ja=WNb.pixelRatioNode,ka=WNb.resolution,la=hTb(d),ma=new BLb(Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ka,ha,ia,ja,la.alpha),na=new rAb(ma.calpha,"f");return new pSb(b,c,a,{outlineColor:Y,contourColor:Z,outlineWidth:$,contourWidth:_,outlineThreshold:aa,contourThreshold:ba,outlineSmoothing:ca,contourFrequency:da,contourDirection:ea,positionalLines:fa,compensation:ga,...la},ma,la.mode,na,la.isMask,e)}case"depth":{let oa=new ZGb(d.gradientType??0),pa=new fHb(d.smooth?? !1),qa=new NAb(d.near??50),ra=new NAb(d.far??200),sa=new NAb(d.isVector??1),ta=new NAb(d.isWorldSpace??0),ua=new Ixb(d.origin??new fm),va=new Ixb(d.direction??new fm),wa;d.colors?wa=new RHb(d.colors.length,d.colors):(wa=new RHb(2,new sh(0,0,0,1))).value[1]=new sh(1,1,1,1);let xa;d.steps?xa=new lHb(d.steps.length,d.steps):(xa=new lHb(2,1)).value[0]=0;let ya=hTb(d),za=new nJb(oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya.alpha,ya.isMask),Aa=new rAb(za.calpha,"f");return new pSb(b,c,a,{gradientType:oa,smooth:pa,near:qa,far:ra,isVector:sa,isWorldSpace:ta,origin:ua,direction:va,colors:wa,steps:xa,...ya},za,ya.mode,Aa,ya.isMask,e)}case"noise":{let Ba=new NAb(d.scale??1),Ca=new Ixb(d.size??new fm(100,100,100)),Da=new NAb(d.move??1),Ea=new xxb(d.fA??new Eb(1.7,9.2)),Fa=new xxb(d.fB??new Eb(8.3,2.8)),Ga=new xxb(d.distortion??new Eb(1,1)),Ha=new oyb(d.colorA),Ia=new oyb(d.colorB),Ja=new oyb(d.colorC),Ka=new oyb(d.colorD),La=new ZGb(d.noiseType??0),Ma=new ZGb(d.voronoiStyle??0),Na=new NAb(d.highCut??1),Oa=new NAb(d.lowCut??0),Pa=new NAb(d.smoothness??.5),Qa=new NAb(d.seed??.5),Ra=new ZGb(d.quality??1),Sa=hTb(d),Ta=new zKb(Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,Sa.alpha,La,Sa.isMask,Ma,Na,Oa,Pa,Qa,Ra),Ua=new rAb(Ta.calpha,"f");return new pSb(b,c,a,{scale:Ba,size:Ca,move:Da,fA:Ea,fB:Fa,distortion:Ga,colorA:Ha,colorB:Ia,colorC:Ja,colorD:Ka,noiseType:La,...Sa,voronoiStyle:Ma,highCut:Na,lowCut:Oa,smoothness:Pa,seed:Qa,quality:Ra},Ta,Sa.mode,Ua,Sa.isMask,e)}case"normal":{let Va=new Ixb(d.cnormal??new fm(1,1,1)),Wa=hTb(d),Xa=new pIb(Va,Wa.alpha),Ya=new rAb(Xa.calpha,"f");return new pSb(b,c,a,{cnormal:Va,...Wa},Xa,Wa.mode,Ya,Wa.isMask,e)}case"gradient":{let Za=new ZGb(d.gradientType??0),$a=new fHb(d.smooth?? !1),_a;d.colors?_a=new RHb(d.colors.length,d.colors):(_a=new RHb(10,new sh(0,0,0,1))).value[1]=new sh(1,1,1,1);let ab;d.steps?ab=new lHb(d.steps.length,d.steps):(ab=new lHb(10,1)).value[0]=0;let bb=new xxb(d.offset??new Eb(0,0)),cb=new xxb(d.morph??new Eb(0,0)),db=new NAb(d.angle??0),eb=hTb(d),fb=new UJb(Za,$a,_a,ab,bb,cb,db,eb.alpha,eb.isMask),gb=new rAb(fb.calpha,"f");return new pSb(b,c,a,{gradientType:Za,smooth:$a,colors:_a,steps:ab,offset:bb,morph:cb,angle:db,...eb},fb,eb.mode,gb,eb.isMask,e)}case"pattern":{let hb=new ZGb(d.style??0),ib=new ZGb(d.projection??0),jb=new ZGb(["x","y","z"].indexOf(d.axis)??0),kb=new NAb(d.blending??0),lb=new xxb(d.offset??new Eb(0,0)),mb=new oyb(d.colorA),nb=new oyb(d.colorB),ob=new xxb(d.frequency??new Eb(10,10)),pb=new NAb(d.size??.5),qb=new NAb(d.variation??0),rb=new NAb(d.smoothness??.5),sb=new NAb(d.zigzag??0),tb=new NAb(d.rotation??0),ub=new xxb(d.vertical??new Eb(0,1)),vb=new xxb(d.horizontal??new Eb(0,1)),wb=new ZGb(d.sides??6),xb=hTb(d),yb=new jMb(hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb.alpha,xb.isMask),zb=new rAb(yb.calpha,"f");return new pSb(b,c,a,{style:hb,projection:ib,axis:jb,blending:kb,offset:lb,colorA:mb,colorB:nb,frequency:ob,size:pb,variation:qb,smoothness:rb,zigzag:sb,rotation:tb,vertical:ub,horizontal:vb,sides:wb,...xb},yb,xb.mode,zb,xb.isMask,e)}default:{let Ab=new EGb(1,0,0,1),Bb=hTb(d),Cb=new hIb(Ab,Bb.alpha),Db=new rAb(Cb.calpha,"f");return new pSb(b,c,a,{color:Ab,...Bb},Cb,Bb.mode,Db,Bb.isMask,e)}}})(c,a,b,e,d)}function jTb(a,b,c,d){if("displace"===c.type&&("intensity"===a||"visible"===a)){let e=b.uniforms[`f${b.id}_intensity`];return e?(e.value=c.intensity*(c.visible?1:0),e):void 0}if("displace"!==c.type&&("alpha"===a||"visible"===a)){let f=b.uniforms[`f${b.id}_alpha`];if(!f)return;if(f.value=cRb(c.alpha,d)*(c.visible?1:0),"outline"===c.type&&"visible"===a){let g=b.uniforms[`f${b.id}_compensation`];g&&(g.value=c.compensation&&c.visible)}return f}}function kTb(a,b){let c=0,d=a.layers.find(a=>"light"===a.data.type);if(d){let e=d.data,f=Number(b.getVariable(e.alphaOverride));if(("string"==typeof e.alphaOverride?f/100:e.alphaOverride)<1)return!0}for(let g of a.layers){if("displace"!==g.data.type&&g.data.isMask)return!0;if("displace"!==g.data.type&&"alpha"in g.data&&"light"!==g.data.type&&"fresnel"!==g.data.type&&"texture"!==g.data.type&&"matcap"!==g.data.type&&"rainbow"!==g.data.type&&"outline"!==g.data.type&&"pattern"!==g.data.type){let h=g.data.visible?g.data.alpha:0;if("string"==typeof h&&(h=Math.max(0,Math.min(1,Number(b.getVariable(h)??100)/100))),1===h&&"depth"===g.data.type||"gradient"===g.data.type){for(let i of g.data.colors)if(i[3]<1){h=i[3];break}}else if(1===h&&"noise"===g.data.type){let j=b.color(g.data.colorA).a,k=b.color(g.data.colorB).a,l=b.color(g.data.colorC).a,m=b.color(g.data.colorD).a,n=Math.min(j,Math.min(k,Math.min(l,m)));n<1&&(h=n)}c+=(1-c)*h}}return c<1}var lTb=class extends pJ{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.cacheKey="",this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return this.cacheKey}},mTb=class extends lTb{constructor(nTb,oTb,pTb,qTb){super(),this.flatShading=nTb,this.side=oTb,this.wireframe=pTb,this.root=qTb}updateAfterBuild(){let rTb=this.root;this.lights=rTb.lights,this.vertexShader=rTb.vertexShader,this.fragmentShader=rTb.fragmentShader,this.defines=rTb.defines,this.uniforms=rTb.uniforms,this.extensions=rTb.extensions,this.transparent=rTb.transparent,this.cacheKey=rTb.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(sTb,tTb){this.root.onBeforeCompile(sTb)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(uTb,vTb,wTb){return this.root.getFlavor(uTb,vTb,wTb)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(xTb){return this.root.getLayersOfType(xTb)}getLayerByUuid(yTb){return this.root.getLayerByUuid(yTb)}updateByOp(zTb,ATb,BTb){this.root.updateByOp(zTb,ATb,BTb)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},CTb=class extends lTb{constructor(DTb,ETb,FTb=!0){super(),this.data=DTb,this.allowVariableSaves=FTb,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.reset0(DTb,ETb)}get nodeMaterial(){return this}getFlavor(GTb,HTb,ITb){let JTb=ITb?6:(GTb?3:0)+HTb;if(0===JTb)return this;void 0===this.flavors&&(this.flavors=[]),JTb-=1;let KTb=this.flavors[JTb];return void 0===KTb&&(KTb=new mTb(GTb,HTb,ITb,this),this.flavors[JTb]=KTb,KTb.flatShading=GTb,KTb.side=HTb,KTb.updateAfterBuild()),KTb}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){return this.lightLayer.getNode("occlusion")?.value?? !1}reset(LTb,MTb,NTb=!1){(this.data!==LTb||NTb)&&this.reset0(LTb,MTb)}reset0(OTb,PTb){this.data=OTb;let QTb=OTb.layers??oNa.defaultTwoLayerData("phong").layers;try{this.layers=QTb.map(a=>dRb.create(this.layerIdGen++,a.id,a.data,PTb.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=OTb.name??"Untitled Material",this.onUpdate(PTb.shared),this.transparent=kTb(OTb,PTb.shared),this.saveVariableLocations(PTb)}onVariableUpdate(RTb,STb,TTb){if("alphaOverride"===RTb[0])this.transparent=kTb(this.data,TTb.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(STb)/100,1)));else if("layer"===RTb[0]){let UTb=RTb[1],VTb=RTb[2];if(UTb&&VTb){let WTb=this.layers.find(a=>a.uuid===UTb);WTb?.hasValue(VTb)&&("alpha"===VTb?(this.transparent=kTb(this.data,TTb.shared),WTb.setValue(VTb,Math.max(0,Math.min(Number(STb)/100,1)))):WTb.setValue(VTb,STb))}}}saveVariableLocations(XTb){if(!this.allowVariableSaves)return;let YTb=this.data.layers.find(a=>"light"===a.data.type);YTb&&XTb.shared.getVariable(YTb.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(a=>{"alpha"in a.data&&"string"==typeof a.data.alpha&&XTb.shared.getVariable(a.data.alpha,["material",this.uuid,"layer",a.id,"alpha"])})}getLayersOfType(ZTb){return this.layers.filter(a=>a.type===ZTb)}getLayerByUuid($Tb){return this.layers.find(a=>a.uuid===$Tb)}onUpdate(_Tb){for(let aUb of(this.cacheKey=this.computeCacheKey(),this.lightLayer=this.layers.find(a=>a instanceof GSb),void 0===this.lightLayer&&(this.lightLayer=new GSb(0,"",{...UJa.defaultData("light","phong"),visible:!1},new ZNb,{},_Tb)),this.dispose(),this.flavors))aUb&&aUb.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions()}applyTextureMaps(){let bUb=this.layers.find(a=>a instanceof GSb);if(!bUb)return;let cUb=bUb.data,dUb=cUb.bumpMap,eUb=cUb.roughnessMap;bUb.node.bumpMap=void 0,bUb.node.roughnessMap=void 0;for(let fUb=0;fUb<this.layers.length;++fUb){let gUb=this.layers[fUb];gUb instanceof pSb&&gUb.color instanceof RIb&&(gUb.uuid===dUb&&(bUb.node.bumpMap=gUb.color),gUb.uuid===eUb&&(bUb.node.roughnessMap=gUb.color))}}updateByOp(hUb,iUb,jUb){if(void 0!==iUb?this.data=iUb:iUb=this.data,this.transparent=kTb(iUb,jUb.shared),"layers"===hUb.path[0]){this.data=iUb;let kUb=jUb.shared,lUb=hUb.path[1];if(void 0===lUb){if(this.layers.reverse(),4===hUb.type){let mUb=dRb.create(this.layerIdGen++,hUb.id,hUb.data,jUb.shared);this.layers.splice(hUb.localIndex,0,mUb),jUb.scene.markNeedsUpdateRendererDirty()}else if(5===hUb.type)this.layers.splice(hUb.localIndex,1)[0].dispose(),jUb.scene.markNeedsUpdateRendererDirty();else if(6===hUb.type){let nUb=this.layers.findIndex(a=>a.uuid===hUb.id),oUb=this.layers[nUb];this.layers.splice(nUb,1),this.layers.splice(hUb.localIndex,0,oUb),jUb.scene.markNeedsUpdateRendererDirty()}this.layers.reverse(),this.onUpdate(jUb.shared)}else{0===hUb.type&& void 0!==hUb.props.occlusion&&jUb.scene.markNeedsUpdateRendererDirty();let pUb=this.layers.find(a=>a.uuid===lUb);if(pUb){let qUb=iUb.layers.data(lUb),rUb;if(0===hUb.type&&("alpha"in hUb.props||"alphaOverride"in hUb.props)&&(rUb="alpha"in hUb.props?{...hUb.props,alpha:cRb(hUb.props.alpha,kUb,["material",this.uuid,"layer",lUb,"alpha"])}:{...hUb.props,alphaOverride:cRb(hUb.props.alphaOverride,kUb,["material",this.uuid,"alphaOverride"])}),pUb.updateByOp({...hUb,...rUb?{props:rUb}:{},path:hUb.path.slice(2)},qUb,jUb)){let sUb=dRb.create(this.layerIdGen++,lUb,qUb,kUb);this.layers.splice(this.layers.findIndex(a=>a.uuid===lUb),1,sUb),this.onUpdate(jUb.shared)}}}}else this.reset(iUb,jUb)}applyMasks(){for(let tUb=0;tUb<this.layers.length;++tUb){let uUb=this.layers[tUb];uUb instanceof pSb?uUb.color.mask=void 0:uUb instanceof GSb&&(uUb.node.mask=void 0)}for(let vUb=0;vUb<this.layers.length;++vUb){let wUb=this.layers[vUb];if(wUb instanceof pSb&&wUb.isMask.value&&wUb.data.visible&&vUb>0){let xUb=vUb-1,yUb=this.layers[xUb];yUb instanceof GSb?yUb.node.mask=new uBb(wUb.color,wUb.alpha,uBb.MUL):yUb instanceof pSb&&(yUb.isMask.value||(yUb.color.mask=new uBb(wUb.color,wUb.alpha,uBb.MUL)))}}}blendColors(){let zUb=this.layers.findIndex(a=>a instanceof pSb),AUb=this.layers.findIndex(a=>a instanceof GSb);if(-1!==zUb&&zUb<AUb){let BUb=this.layers[zUb].color;for(let CUb=zUb+1;CUb<AUb;++CUb){let DUb=this.layers[CUb];if(DUb instanceof pSb){if(DUb.isMask.value)continue;BUb=new UHb(BUb,DUb.color,DUb.alpha,DUb.mode)}}this.fragment.color=BUb}else this.fragment.color=void 0}blendAfterColors(){let EUb=new rAb("outgoingLight","f"),FUb=this.layers.findIndex(a=>a instanceof GSb);if(this.layers.length>FUb+1){for(let GUb=FUb+1;GUb<this.layers.length;++GUb){let HUb=this.layers[GUb];if(HUb instanceof pSb){if(HUb.isMask.value)continue;EUb=new UHb(EUb,HUb.color,HUb.alpha,HUb.mode)}}this.fragment.afterColor=EUb}else this.fragment.afterColor=void 0}blendPositions(){let IUb=this.layers.filter(a=>a instanceof zSb);if(IUb.length>0){let JUb=IUb[0].position;for(let KUb=1;KUb<IUb.length;++KUb)IUb[KUb]&&(JUb=new uBb(JUb,IUb[KUb].position,uBb.ADD),JUb=new uBb(JUb,new NAb(.5).setReadonly(!0),uBb.MUL));this.fragment.position=JUb}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(LUb){this.build(),LUb.defines=this.defines,LUb.uniforms=this.uniforms,LUb.vertexShader=this.vertexShader,LUb.fragmentShader=this.fragmentShader,LUb.extensionDerivatives=!0===this.extensions.derivatives,LUb.extensionFragDepth=!0===this.extensions.fragDepth,LUb.extensionDrawBuffers=!0===this.extensions.drawBuffers,LUb.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}clampUniformsForPreview(MUb,NUb){let OUb=(a,b,c)=>Math.min(Math.max(a,b),c);for(let PUb of this.layers)if("displace"===PUb.type){let QUb=OUb(PUb.uniforms[`f${PUb.id}_intensity`].value,MUb,NUb);PUb.uniforms[`f${PUb.id}_intensity`].value=QUb}}computeCacheKey(){let RUb="[";for(let{data:SUb}of this.data.layers)if("light"===SUb.type)RUb+=`"${SUb.visible?SUb.category.toUpperCase():"Basic"}"`;else{let TUb=($Qb[SUb.type]??[]).map(a=>SUb[a]),UUb=(_Qb[SUb.type]??[]).map(a=>SUb[a]?.length??0),VUb=[...TUb,...UUb],WUb="isMask"in SUb&&SUb.isMask,XUb=`"${SUb.type}-${SUb.visible}-${WUb}"`;VUb.length?RUb+=`[${XUb}, "${VUb.join("\",\"")}"],`:RUb+=XUb}return RUb=RUb.slice(0,-1)+"]"}updateFrame(YUb){for(let ZUb=0;ZUb<this.updaters.length;++ZUb)YUb.updateNode(this.updaters[ZUb])}build(){let $Ub=new cEb;for(let _Ub of($Ub.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,$Ub.build(this.fragment,this.fragment),this.vertexShader=$Ub.getCode("vertex"),this.fragmentShader=$Ub.getCode("fragment"),this.defines=$Ub.defines,this.uniforms=$Ub.uniforms,this.extensions=$Ub.extensions,this.updaters=$Ub.updaters,this.flavors))_Ub&&_Ub.updateAfterBuild();return this}nodeMaterialDispose(){for(let aVb of(this.layers.forEach(a=>a.dispose()),super.dispose(),this.flavors))aVb&&aVb.dispose()}assetsLoaded(){for(let bVb of this.layers)if(bVb instanceof pSb){let cVb=bVb.params.texture;if(cVb instanceof rHb&&!cVb.image.loaded)return!1}return!0}getHash(){let dVb="{";return dVb+="\"fragment\":"+this.fragment.getHash(),dVb+="}"}};Object.defineProperties(lTb.prototype,{properties:{get:function(){return this.fragment.properties}}});var eVb,fVb=class extends CTb{constructor(gVb,hVb,iVb){super(gVb,hVb,!1),this.uuid=iVb,this.allowVariableSaves=!0,this.saveVariableLocations(hVb)}},jVb=r(z()),kVb=new Map,lVb=class{constructor({src:mVb,volume:nVb,delay:oVb,loop:pVb}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let qVb;qVb="string"==typeof mVb?{src:mVb}:{src:(function(a){if("string"==typeof a)return a;let b=kVb.get(a);return b||(b={url:URL.createObjectURL(new Blob([a]))},kVb.set(a,b)),b.url})(mVb),format:"wav"},this.sound=new jVb.Howl(qVb),this.sound.on("end",this.onEnd),this.src=mVb,void 0!==nVb&&(this.volume=nVb),void 0!==oVb&&(this.delay=oVb),void 0!==pVb&&(this.loop=pVb)}get status(){return this._status}get volume(){return this._volume}set volume(rVb){this._volume=rVb,this.sound.volume(rVb)}get loop(){return this._loop}set loop(sVb){this._loop=sVb,this.loopsRemaining=sVb}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(tVb,uVb=1e3){tVb?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,uVb),this.clearFade()},tVb)):this.sound.fade(this._volume,0,uVb)}on(vVb,wVb,xVb){this.sound.on(vVb,wVb,xVb)}off(yVb,zVb,AVb){this.sound.off(yVb,zVb,AVb)}play(){"playing"===this._status||this.sound.playing()||("paused"===this._status?(0===this.sound.seek()?this.replay():this.sound.play(),this._status="playing"):"stopped"===this._status&&(this.replay(),this._status="playing"))}pause(){"playing"===this._status&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(BVb=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},CVb=class{constructor(){this.type="ShapePath",this.color=new df,this.subPaths=[],this.currentPath=null}moveTo(DVb,EVb){return this.currentPath=new y3,this.subPaths.push(this.currentPath),this.currentPath.moveTo(DVb,EVb),this}lineTo(FVb,GVb){return this.currentPath?.lineTo(FVb,GVb),this}quadraticCurveTo(HVb,IVb,JVb,KVb){return this.currentPath?.quadraticCurveTo(HVb,IVb,JVb,KVb),this}bezierCurveTo(LVb,MVb,NVb,OVb,PVb,QVb){return this.currentPath?.bezierCurveTo(LVb,MVb,NVb,OVb,PVb,QVb),this}splineThru(RVb){return this.currentPath?.splineThru(RVb),this}toShapes(){let SVb={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},TVb={loc:SVb.ORIGIN,t:0};function UVb(a,b,c,d){let e=a.x,f=b.x,g=c.x,h=d.x,i=a.y,j=b.y,k=c.y,l=d.y,m=(h-g)*(i-k)-(l-k)*(e-g),n=(f-e)*(i-k)-(j-i)*(e-g),o=(l-k)*(f-e)-(h-g)*(j-i),p=m/o,q=n/o;if(0===o&&0!==m||p<=0||p>=1||q<0||q>1)return null;if(0===m&&0===o){for(let r=0;r<2;r++)if(VVb(0===r?c:d,a,b),TVb.loc===SVb.ORIGIN){let s=0===r?c:d;return{x:s.x,y:s.y,t:TVb.t}}else if(TVb.loc===SVb.BETWEEN){let t=+(e+TVb.t*(f-e)).toPrecision(10),u=+(i+TVb.t*(j-i)).toPrecision(10);return{x:t,y:u,t:TVb.t}}return null}{for(let v=0;v<2;v++)if(VVb(0===v?c:d,a,b),TVb.loc===SVb.ORIGIN){let w=0===v?c:d;return{x:w.x,y:w.y,t:TVb.t}}let x=+(e+p*(f-e)).toPrecision(10),y=+(i+p*(j-i)).toPrecision(10);return{x:x,y:y,t:p}}}function VVb(a,b,c){let d=c.x-b.x,e=c.y-b.y,f=a.x-b.x,g=a.y-b.y,h=d*g-f*e;if(a.x===b.x&&a.y===b.y){TVb.loc=SVb.ORIGIN,TVb.t=0;return}if(a.x===c.x&&a.y===c.y){TVb.loc=SVb.DESTINATION,TVb.t=1;return}if(h< -Number.EPSILON){TVb.loc=SVb.LEFT;return}if(h>Number.EPSILON){TVb.loc=SVb.RIGHT;return}if(d*f<0||e*g<0){TVb.loc=SVb.BEHIND;return}if(Math.sqrt(d*d+e*e)<Math.sqrt(f*f+g*g)){TVb.loc=SVb.BEYOND;return}let i;i=0!==d?f/d:g/e,TVb.loc=SVb.BETWEEN,TVb.t=i}let WVb=0,XVb=999999999,YVb=-999999999,ZVb=[];this.subPaths.forEach(a=>{let b=a.getPoints(),c=-999999999,d=999999999,e=-999999999,f=999999999;for(let g=0;g<b.length;g++){let h=b[g];h.y>c&&(c=h.y),h.y<d&&(d=h.y),h.x>e&&(e=h.x),h.x<f&&(f=h.x)}YVb<=e&&(YVb=e+1),XVb>=f&&(XVb=f-1),b.length&&ZVb.push({curves:a.curves,points:b,isCW:g7.isClockWise(b),identifier:WVb++,boundingBox:new kpa(new Eb(f,d),new Eb(e,c))})});let $Vb=ZVb.map(a=>(function(a,b,c,d,e){(null==e||""===e)&&(e="nonzero");let f=new Eb;a.boundingBox.getCenter(f);let g=function(a,b,c){let d=new Eb;b.getCenter(d);let e=[];return c.forEach(b=>{b.boundingBox.containsPoint(d)&&(function(a,b){let c=[],d=[];for(let e=1;e<a.length;e++){let f=a[e-1],g=a[e];for(let h=1;h<b.length;h++){let i=b[h-1],j=b[h],k=UVb(f,g,i,j);null!==k&& void 0===c.find(a=>a.t<=k.t+Number.EPSILON&&a.t>=k.t-Number.EPSILON)&&(c.push(k),d.push(new Eb(k.x,k.y)))}}return d})(a,b.points).forEach(a=>{e.push({identifier:b.identifier,isCW:b.isCW,point:a})})}),e.sort((a,b)=>a.point.x-b.point.x),e}([new Eb(c,f.y),new Eb(d,f.y)],a.boundingBox,b);g.sort((a,b)=>a.point.x-b.point.x);let h=[],i=[];g.forEach(b=>{b.identifier===a.identifier?h.push(b):i.push(b)});let j=h[0].point.x,k=[],l=0;for(;l<i.length&&i[l].point.x<j;)k.length>0&&k[k.length-1]===i[l].identifier?k.pop():k.push(i[l].identifier),l++;if(k.push(a.identifier),"evenodd"===e){let m=k.length%2==0,n=k[k.length-2];return{identifier:a.identifier,isHole:m,for:n}}if("nonzero"===e){let o=!0,p=null,q=null;for(let r=0;r<k.length;r++){let s=k[r];b[s]&&(o?(q=b[s].isCW,o=!1,p=s):q!==b[s].isCW&&(q=b[s].isCW,o=!0))}return{identifier:a.identifier,isHole:o,for:p}}console.warn("fill-rule: \""+e+"\" is currently not implemented.")})(a,ZVb,XVb,YVb,this.userData?.style.fillRule)),_Vb=[];return ZVb.forEach(a=>{let b=$Vb[a.identifier];if(b&&!b.isHole){let c=new j6;c.curves=a.curves,$Vb.filter(b=>b?.isHole&&b.for===a.identifier).forEach(a=>{if(a){let b=ZVb[a.identifier],d=new y3;d.curves=b.curves,c.holes.push(d)}}),_Vb.push(c)}}),_Vb}},aWb=!1,bWb=new Promise(a=>{eVb=a}),cWb=!1,dWb=class{async load(eWb,fWb,gWb=()=>{}){let{load:hWb}=await bWb;hWb(eWb,(a,b)=>{a||!b?gWb(a??"Something went wrong"):fWb(b)})}async parse(iWb){let{parse:jWb,Bidi:kWb}=await bWb;try{let lWb=jWb(iWb),mWb=new kWb,nWb=a=>lWb.charToGlyphIndex(a.char);return mWb.registerModifier("glyphIndex",null,nWb),mWb.applyFeatures(lWb,lWb.defaultRenderOptions.features),{font:lWb,bidi:mWb}}catch(oWb){console.error(oWb)}}};async function pWb(a){return await (await fetch(a)).arrayBuffer()}var qWb=new dWb;async function rWb(a){let b,c,d=!1;if(a.url?(b=await pWb(a.url),c=a.url,d=a.url.startsWith("/")):a.data&&(b=a.data.buffer.slice(a.data.byteOffset,a.data.byteOffset+a.data.byteLength)),b)if(!aWb)return{font:void 0,url:c,intercepted:d,arr:b,bidi:null};else{let e=await qWb.parse(b);if(e)return{font:e.font,url:c,intercepted:d,arr:b,bidi:e.bidi}}}function sWb(a,b){return b.state.glyphIndex===a||b.state.fina===a||b.state.medi===a||b.state.init===a}var tWb=class{constructor(uWb){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=uWb.isUserFont?? !1,this._loadingPromise=rWb(uWb).then(a=>{a&&(this._arrayBuffer=a.arr,this._url=a.url,this.font=a.font,this._intercepted=a.intercepted,this._isLoaded=!0,this._bidi=a.bidi)})}update(vWb){this._isLoaded=!1,this._isUserFont=vWb.isUserFont?? !1,this._loadingPromise=rWb(vWb).then(a=>{a&&(this._arrayBuffer=a.arr,this._url=a.url,this.font=a.font,this._intercepted=a.intercepted,this._isLoaded=!0,this._bidi=a.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(wWb,xWb,yWb){if(!this._bidi)return[];let zWb=this._bidi;zWb.getTextGlyphs(xWb);let AWb=zWb.tokenizer.tokens,BWb=[],CWb=0,DWb=yWb.length===AWb.length;for(let EWb=0;EWb<yWb.length;EWb++){let FWb=yWb[EWb].index,GWb=String.fromCharCode(yWb[EWb].unicode),HWb=AWb[CWb];if(sWb(FWb,HWb)||DWb)BWb.push({char:GWb,index:FWb,replacements:[HWb.state.glyphIndex],replacementChars:[HWb.char]}),CWb++;else{let IWb=HWb.char,JWb="",KWb=[HWb.state.glyphIndex],LWb=[],MWb=!1;for(;!MWb;)CWb++,IWb+=JWb=xWb.charAt(CWb),KWb.push(wWb.charToGlyphIndex(JWb)),1===(LWb=wWb.stringToGlyphs(IWb)).length&&LWb[0].index===FWb&&(MWb=!0),CWb>xWb.length&&(MWb=!0);BWb.push({char:GWb,index:FWb,replacements:KWb,replacementChars:Array.from(IWb)}),CWb++}}return BWb}generateShapes(NWb,OWb){if(!this._isLoaded)return;let PWb=this.font,QWb=OWb.fontSize/this.unitsPerEm,RWb=OWb.fontSize*OWb.lineHeight,SWb=NWb.map(a=>this.getTextWidth(a,OWb)),TWb=OWb.width,UWb=this.getCharWidth(`
`,OWb),VWb=1===OWb.horizontalAlign?UWb:0,WWb=this.computeSpaceWidthForLine(NWb,0,OWb),XWb=this.getLineInitialOffsetX(SWb[0],TWb,OWb.horizontalAlign,NWb[0],UWb),YWb=this.getLineInitialOffsetY(RWb,NWb.length,OWb.height,QWb,OWb.verticalAlign),ZWb=[],$Wb=NWb.map(a=>[]),_Wb=NWb.map(a=>[]),aXb;for(let bXb=0;bXb<NWb.length;bXb++){let cXb=NWb[bXb],dXb={features:{liga:!0}},eXb=[];try{eXb=PWb.stringToGlyphs(cXb,dXb)}catch(fXb){console.warn(fXb)}XWb=this.getLineInitialOffsetX(SWb[bXb],TWb,OWb.horizontalAlign,cXb,UWb);let gXb=[];try{gXb=this.reverseLigaturesTable(PWb,cXb,eXb)}catch(hXb){console.warn(hXb)}WWb=this.computeSpaceWidthForLine(NWb,bXb,OWb);for(let iXb=0;iXb<eXb.length;iXb++){let jXb=eXb[iXb],kXb=0===jXb.index?`
`:jXb.unicode?String.fromCharCode(jXb.unicode):void 0,lXb=gXb[iXb],mXb=0,nXb=0;0===iXb&&2===OWb.horizontalAlign&& void 0!==jXb.leftSideBearing&&(nXb=-jXb.leftSideBearing*QWb),aXb&&(mXb=PWb.getKerningValue(jXb,aXb)*QWb),XWb+=nXb+mXb;let oXb=0;if(kXb===`
`)oXb=VWb;else if(" "===kXb)oXb=WWb;else{let pXb=this.createPath(jXb,QWb,XWb,YWb,OWb);pXb&&(oXb=pXb.offsetX-(mXb+nXb),ZWb.push(pXb.path))}if(1===lXb.replacements.length)_Wb[bXb].push([XWb,YWb]),$Wb[bXb].push(oXb);else{let qXb=lXb.replacements.map(a=>(PWb.glyphs.get(a).advanceWidth??0)*QWb),rXb=qXb.reduce((a,b)=>a+=b,0),sXb=qXb.map(a=>a/rXb),tXb=XWb;for(let uXb=0;uXb<sXb.length;uXb++){let vXb=oXb*sXb[uXb];_Wb[bXb].push([tXb,YWb]),$Wb[bXb].push(vXb),tXb+=vXb}}XWb+=oXb,aXb=jXb}YWb-=RWb}let wXb=[];for(let xXb=0,yXb=ZWb.length;xXb<yXb;xXb++)wXb.push(...ZWb[xXb].toShapes());return{shapes:wXb,charWidths:$Wb,lineWidths:SWb,charCoords:_Wb}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){return this.font?.ascender??0}get descender(){return this.font?.descender??0}get familyName(){return this.font?.names.fontFamily??""}get subfamilyName(){return this.font?.names.fontSubfamily??""}get unitsPerEm(){return this.font?.unitsPerEm??1}getLineInitialOffsetX(zXb,AXb,BXb,CXb,DXb){return(3===BXb||2===BXb)&&CXb.indexOf(`
`)>=0&&(zXb-=DXb),3===BXb?.5*AXb-.5*zXb:2===BXb?AXb-zXb:0}getLineInitialOffsetY(EXb,FXb,GXb,HXb,IXb){let JXb=FXb*EXb,KXb=EXb-Math.abs(this.ascender-this.descender)*HXb,LXb=-this.ascender*HXb-KXb/2;return 3===IXb?-(GXb-JXb-LXb):2===IXb?-(.5*GXb-.5*JXb-LXb):LXb}createPath(MXb,NXb,OXb,PXb,QXb){let RXb=MXb.getPath(OXb,-PXb,QXb.fontSize,{kerning:!1,letterSpacing:QXb.letterSpacing});if(!RXb){console.error("THREE.Font: character \""+MXb+"\" does not exists in font family "+this.familyName+".");return}let SXb=new CVb,TXb=(MXb.advanceWidth??1)*NXb;if(MXb)for(let UXb of RXb.commands){let VXb=SXb.currentPath?.currentPoint;if(!(VXb&&"Z"!==UXb.type&&VXb.x===UXb.x&& -VXb.y===UXb.y))switch(UXb.type){case"M":SXb.moveTo(UXb.x,-UXb.y);break;case"L":SXb.lineTo(UXb.x,-UXb.y);break;case"Q":SXb.quadraticCurveTo(UXb.x1,-UXb.y1,UXb.x,-UXb.y);break;case"C":SXb.bezierCurveTo(UXb.x1,-UXb.y1,UXb.x2,-UXb.y2,UXb.x,-UXb.y);break}}return SXb.subPaths.forEach(a=>{let b=fYb(a.curves);void 0!==b&&a.currentPoint.distanceTo(b)>0&&a.lineTo(b.x,b.y)}),{offsetX:TXb+QXb.fontSize*QXb.letterSpacing,path:SXb}}getCharWidth(WXb,XXb){return this.font?.getAdvanceWidth(WXb,XXb.fontSize,{kerning:!0,letterSpacing:XXb.letterSpacing})??0}getTextWidth(YXb,ZXb){return this.font?.getAdvanceWidth(YXb,ZXb.fontSize,{kerning:!0,letterSpacing:ZXb.letterSpacing})??0}computeSpaceWidthForLine($Xb,_Xb,aYb){let bYb=this.getCharWidth(" ",aYb),cYb=$Xb[_Xb];if(cYb){let dYb=this.countSpaces(cYb.trimEnd());if(4===aYb.horizontalAlign&&_Xb<$Xb.length-1&&dYb)return(aYb.width-(this.getTextWidth(cYb,aYb)-dYb*bYb))/dYb}return bYb}countSpaces(eYb){return(eYb.match(/ /g)||[]).length}};function fYb(a){if(a.length){let b=a[0];if(b instanceof m1)return b.v1;if(b instanceof K0||b instanceof L1)return b.v0}}var gYb=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(hYb){return this.objects.get(hYb)}get size(){return this.objects.size}get(iYb,jYb,kYb){let lYb=this.objects.get(iYb);return void 0===lYb?(lYb=this.createObject(iYb,jYb,kYb),this.objects.set(iYb,lYb)):lYb.isShared=!0,lYb}forceDelete(mYb){let nYb=this.objects.get(mYb);nYb&&(this.disposeObject(nYb),this.objects.delete(mYb))}mutateIfUnique(oYb,pYb){let qYb=this.objects.get(oYb);if(qYb&& !0!==qYb.isShared)return this.objects.delete(oYb),this.objects.set(pYb,qYb),qYb}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(rYb,sYb){sYb===this.objects.get(rYb)&&this.unreachable.delete(rYb)}endGc(){this.unreachable.forEach(a=>{this.disposeObject(this.objects.get(a)),this.objects.delete(a)}),this.unreachable.clear()}dispose(){this.objects.forEach(a=>{this.disposeObject(a)}),this.objects.clear()}},tYb=class extends gYb{constructor(uYb){super(),this.flatShading=uYb}disposeObject(vYb){vYb.dispose()}createObject(wYb,xYb,yYb){let zYb=Msb(wYb,xYb,this.flatShading,yYb);return zYb.computeBoundingSphere(),zYb}},AYb=class{constructor(BYb,CYb={}){if(this.data=BYb,this.geometryCache=new tYb(!0),this.geometryCache2=new tYb(!1),this.imageHolderCache=new class extends dQb{constructor(DYb){super(),this.shared=DYb}create(EYb){return new hQb(EYb,this.shared)}}(this),this.thisContext={scene:{markNeedsUpdateRendererDirty:()=>{}},shared:this},this.deletedMaterial=new fVb(oNa.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new AQb(_Na.emptyImage,this),this.deletedVideo=new AQb(RJa.defaultVideo,this),this.materials={},this.images={},this.canvases={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},CYb.images)for(let[FYb,GYb]of Object.entries(CYb.images))this.addImage(FYb,GYb);if(CYb.videos)for(let[HYb,IYb]of Object.entries(CYb.videos))this.addVideo(HYb,IYb);if(CYb.audios)for(let[JYb,KYb]of Object.entries(CYb.audios))this.addAudio(JYb,KYb);if(CYb.particles)for(let[LYb,MYb]of Object.entries(CYb.particles))this.addParticle(LYb,MYb);this.reset(BYb)}setRequestRender(NYb){this._requestRender=NYb}setEntityOpContext(OYb){this.entityOpContext=OYb}reset(PYb,QYb=!1){for(let{id:RYb,data:SYb}of(this.resetLib(PYb.lib),PYb.variables))this.addVariableHolder(RYb,SYb),QYb&&this.updateVariableHolder(RYb,SYb);for(let[TYb,UYb]of Object.entries(PYb.images))this.addImage(TYb,UYb);for(let[VYb,WYb]of Object.entries(PYb.videos))this.addVideo(VYb,WYb);for(let[XYb,YYb]of Object.entries(PYb.colors))this.addColor(XYb,YYb);for(let[ZYb,$Yb]of Object.entries(PYb.materials))this.addMaterial(ZYb,$Yb);for(let[_Yb,aZb]of Object.entries(PYb.audios))this.addAudio(_Yb,aZb);for(let[bZb,cZb]of Object.entries(PYb.particles))this.addParticle(bZb,cZb);for(let[dZb,eZb]of Object.entries(PYb.fonts))this.addFont(dZb,eZb)}addMaterial(fZb,gZb){if(this.materials[fZb]){let hZb=this.materials[fZb];hZb.reset(gZb,this.thisContext),hZb.dispose()}else{let iZb=new fVb(gZb,this.thisContext,fZb);this.materials[fZb]=iZb}}deleteMaterial(jZb){this.materials[jZb]&&(this.materials[jZb].nodeMaterialDispose(),delete this.materials[jZb])}getMaterial(kZb){return this.materials[kZb]}getMaterialOrDeletedPlaceholder(lZb){return this.materials[lZb]??this.deletedMaterial}material(mZb){return"string"==typeof mZb?this.getMaterialOrDeletedPlaceholder(mZb):null==mZb?(console.error("material is undefined or null"),this.deletedMaterial):new CTb(mZb,this.thisContext)}getMaterials(){return this.materials}addImage(nZb,oZb){return this.images[nZb]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[nZb].updateSrc(oZb.data),!0):(this.images[nZb]=new AQb(oZb,this),!1)}deleteImage(pZb){let qZb=this.images[pZb];qZb&&(qZb.dispose(),delete this.images[pZb])}getDefaultImage(){return this.images.image_0}getImage(rZb){return this.images[rZb]??this.deletedImage}image(sZb){return"string"==typeof sZb?this.getImage(sZb):this.imageHolderCache.load(sZb)}addCanvas(tZb,uZb){return this.canvases[tZb]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.canvases[tZb].updateSrc(uZb),!0):(this.canvases[tZb]=new AQb(uZb,this),!1)}canvas(vZb){return this.canvases[vZb]}addVideo(wZb,xZb){return this.videos[wZb]?(this.videos[wZb].updateSrc(xZb.data),!0):(this.videos[wZb]=new AQb(xZb,this),!1)}deleteVideo(yZb){let zZb=this.videos[yZb];zZb&&(zZb.dispose(),delete this.videos[yZb])}getVideo(AZb){return this.videos[AZb]??this.deletedVideo}video(BZb){return"string"==typeof BZb?this.getVideo(BZb):this.imageHolderCache.load(BZb)}addColor(CZb,DZb){return this.colors[CZb]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in DZb?this.colors[CZb].setRGBA(DZb.r,DZb.g,DZb.b,DZb.a):this.colors[CZb].setRGBA(DZb.r,DZb.g,DZb.b,1),!0):("a"in DZb?this.colors[CZb]=new ZQb(DZb.r,DZb.g,DZb.b,DZb.a):this.colors[CZb]=new ZQb(DZb.r,DZb.g,DZb.b,1),!1)}updateColor(EZb,FZb){if(this.colors[EZb]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let GZb=this.colors[EZb];return this.colors[EZb].r=FZb.r??GZb.r,this.colors[EZb].g=FZb.g??GZb.g,this.colors[EZb].b=FZb.b??GZb.b,this.colors[EZb].a=FZb.a??GZb.a,!0}return!1}deleteColor(HZb){this.colors[HZb]&&delete this.colors[HZb]}getColor(IZb){return this.colors[IZb]}color(JZb){let KZb;if("string"!=typeof JZb)return"a"in JZb?new Vxb(JZb.r,JZb.g,JZb.b,JZb.a):new Vxb(JZb.r,JZb.g,JZb.b,1);{let LZb=this.getColor(JZb);LZb?KZb=LZb:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),KZb=new Vxb(0,0,0,0))}return KZb}addAudio(MZb,NZb){this.audios[MZb]=NZb}getAudio(OZb){let PZb=this.audios[OZb];if(PZb instanceof lVb)return PZb;{let QZb=new lVb({src:PZb.data});return this.audios[OZb]=QZb,QZb}}addParticle(RZb,SZb){this.particles[RZb]=SZb}getParticle(TZb){return this.particles[TZb]}deleteParticle(UZb){this.particles[UZb]&&delete this.particles[UZb]}deleteAudio(VZb){let WZb=this.audios[VZb];WZb&&(WZb instanceof lVb&&WZb.dispose(),delete this.audios[VZb])}addFont(XZb,YZb){this.fonts[XZb]=new tWb(YZb),this.fonts[XZb].loadingPromise.then(()=>this.requestRender())}getFont(ZZb){return this.fonts[ZZb]}deleteFont($Zb){this.fonts[$Zb]&&delete this.fonts[$Zb]}dispose(){Object.keys(this.materials).forEach(a=>this.deleteMaterial(a)),this._requestRender=void 0,Object.values(this.audios).forEach(a=>{a instanceof lVb&&a.dispose()}),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(_Zb,a$b){return void 0===this.variables[_Zb]?(this.variables[_Zb]={value:a$b.value,locations:[]},"dynamicVariableType"in a$b&&(this.variables[_Zb].dynamicVariablePlayState="Playing",this.variables[_Zb].dynamicVariableToggleIsForward=void 0),!0):(this.variables[_Zb].value=a$b.value,!1)}resetDynamicVariablePlayState(){for(let b$b in this.variables)void 0!==this.variables[b$b].dynamicVariablePlayState&&(this.variables[b$b].dynamicVariablePlayState="Playing",this.variables[b$b].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(c$b,d$b){this.updateVariable(c$b,d$b.value)}updateVariable(e$b,f$b){if(void 0===this.variables[e$b])return!1;this.variables[e$b].value=f$b;let g$b=f$b;for(;"string"==typeof g$b;)g$b=this.variables[g$b].value;let h$b=this.entityOpContext.scene;for(let i$b=this.variables[e$b].locations.length-1;i$b>=0;i$b--){let j$b=this.variables[e$b].locations[i$b];if("material"===j$b[0]){let k$b=j$b[1],l$b=g$b,m$b={scene:h$b,shared:this},n$b=j$b.slice(2);h$b.traverseMaterial(a=>{let b=a.root??a;b.uuid===k$b&&b.onVariableUpdate(n$b,l$b,m$b)});let o$b=this.materials[k$b];o$b&&o$b.onVariableUpdate(n$b,l$b,m$b)}else{let p$b=h$b.find(j$b[0]);if(void 0===p$b){this.variables[e$b].locations.splice(i$b,1);continue}if("geometry"!==j$b[1]&&"particles"!==j$b[1]){for(let q$b=1;q$b<j$b.length-1;q$b++)p$b=p$b[j$b[q$b]];"rotation"===j$b[1]?p$b[j$b[j$b.length-1]]=g$b*Db.DEG2RAD:p$b[j$b[j$b.length-1]]=g$b}if("ParticleEmitter"===(p$b=h$b.find(j$b[0])).type&&p$b.updateVariableState(g$b,j$b),Fsb.is(p$b)){if("position"===j$b[1]||"rotation"===j$b[1]||"scale"===j$b[1])p$b.onVariableUpdate();else if("geometry"===j$b[1]){let r$b=p$b;p$b.component&&(r$b=p$b.component);let s$b=r$b.dataPatched;r$b.chooseGeoemtryCache(this).forceDelete(s$b.geometry),r$b.createGeometryDelayed(this.entityOpContext),r$b.onVariableUpdate(!0),r$b.instances.forEach(a=>{let b=a.dataPatched;a.chooseGeoemtryCache(this).forceDelete(b.geometry),a.createGeometryDelayed(this.entityOpContext),a.onVariableUpdate(!0)})}}}}return this.requestRender(),!0}deleteVariable(t$b){this.variables[t$b]&&delete this.variables[t$b]}getVariable(u$b,v$b){if(Array.isArray(u$b)){if("mouse"===u$b[0])return this.mouseProperty?.[u$b[1]]??0;if("raycast"===u$b[0])return this.raycastProperty?.[u$b[1]]??0;let w$b=this.entityOpContext.scene.find(u$b[0]);if("width"===u$b[1]||"height"===u$b[1]||"depth"===u$b[1])return w$b.geometry.userData.parameters[u$b[1]];for(let x$b=1;x$b<u$b.length;x$b++)w$b=w$b[u$b[x$b]];return"rotation"===u$b[1]&&(w$b*=Db.RAD2DEG),w$b}for(let y$b in this.variables){if(void 0===v$b)break;let z$b=this.variables[y$b],A$b=z$b.locations?.findIndex(a=>aGa.equal(a,v$b));void 0!==A$b&& -1!==A$b&&z$b.locations.splice(A$b,1)}if("string"!=typeof u$b)return u$b;{let B$b=u$b,C$b=u$b;do{if(C$b=B$b,void 0===this.variables[B$b])break;B$b=this.variables[B$b].value}while("string"==typeof B$b);return v$b&& void 0!==this.variables[C$b]&&this.variables[C$b].locations.push(v$b),B$b}}getVariables(){return this.variables}getDynamicVariablePlayState(D$b){return this.variables[D$b]?.dynamicVariablePlayState}setDynamicVariablePlayState(E$b,F$b){void 0!==this.variables[E$b]&&(this.variables[E$b].dynamicVariablePlayState=F$b)}getDynamicVariableToggleIsForward(G$b){return this.variables[G$b]?.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(H$b,I$b){void 0!==this.variables[H$b]&&(this.variables[H$b].dynamicVariableToggleIsForward=I$b)}resetLib(J$b){for(let[K$b,L$b]of Object.entries(J$b.images))this.addImage(K$b,L$b.asset);for(let[M$b,N$b]of Object.entries(J$b.audios))this.addAudio(M$b,N$b.asset);for(let[O$b,P$b]of Object.entries(J$b.particles))this.addParticle(O$b,P$b.asset);for(let[Q$b,R$b]of Object.entries(J$b.colors))this.addColor(Q$b,R$b.asset);for(let[S$b,T$b]of Object.entries(J$b.fonts))this.addFont(S$b,T$b.asset);for(let[U$b,V$b]of Object.entries(J$b.materials))this.addMaterial(U$b,V$b.asset);for(let[W$b,X$b]of Object.entries(J$b.videos))this.addVideo(W$b,X$b.asset);for(let[Y$b,Z$b]of Object.entries(J$b.variables))this.addVariableHolder(Y$b,Z$b.asset)}updateLibByOp($$b,_$b){"images"===$$b.path[0]?1===$$b.path.length&&1===$$b.type?this.addImage($$b.id,$$b.data.asset):1===$$b.path.length&&2===$$b.type&&this.deleteImage($$b.id):"videos"===$$b.path[0]?1===$$b.path.length&&1===$$b.type?this.addVideo($$b.id,$$b.data.asset):1===$$b.path.length&&2===$$b.type&&this.deleteVideo($$b.id):"audios"===$$b.path[0]?1===$$b.path.length&&1===$$b.type?this.addAudio($$b.id,$$b.data.asset):1===$$b.path.length&&2===$$b.type&&this.deleteAudio($$b.id):"particles"===$$b.path[0]?1===$$b.path.length&&1===$$b.type?this.addParticle($$b.id,$$b.data.asset):1===$$b.path.length&&2===$$b.type&&this.deleteParticle($$b.id):"colors"===$$b.path[0]?1===$$b.path.length&&1===$$b.type?this.addColor($$b.id,$$b.data.asset):1===$$b.path.length&&2===$$b.type&&this.deleteColor($$b.id):"materials"===$$b.path[0]?1===$$b.path.length&&1===$$b.type?this.addMaterial($$b.id,$$b.data.asset):1===$$b.path.length&&2===$$b.type&&this.deleteMaterial($$b.id):"fonts"===$$b.path[0]?1===$$b.path.length&&1===$$b.type?this.addFont($$b.id,$$b.data.asset):1===$$b.path.length&&2===$$b.type&&this.deleteFont($$b.id):"variables"===$$b.path[0]?1===$$b.path.length&&1===$$b.type?this.addVariableHolder($$b.id,$$b.data.asset):1===$$b.path.length&&2===$$b.type&&this.deleteVariable($$b.id):"components"===$$b.path[0]&&_$b.updateByLibOp($$b,this)}updateByOp(a_b,b_b,c_b){this.data=b_b,"images"===a_b.path[0]?2===a_b.path.length&&0===a_b.type?a_b.props.data&&this.getImage(a_b.path[1]).updateSrc(a_b.props.data):1===a_b.path.length&&1===a_b.type?this.addImage(a_b.id,a_b.data):1===a_b.path.length&&2===a_b.type&&this.deleteImage(a_b.id):"videos"===a_b.path[0]?2===a_b.path.length&&0===a_b.type?a_b.props.data&&this.getVideo(a_b.path[1]).updateSrc(a_b.props.data):1===a_b.path.length&&1===a_b.type?this.addVideo(a_b.id,a_b.data):1===a_b.path.length&&2===a_b.type&&this.deleteVideo(a_b.id):"audios"===a_b.path[0]?2===a_b.path.length&&0===a_b.type?a_b.props.data&&this.addAudio(a_b.path[1],b_b.audios[a_b.path[1]]):1===a_b.path.length&&1===a_b.type?this.addAudio(a_b.id,a_b.data):1===a_b.path.length&&2===a_b.type&&this.deleteAudio(a_b.id):"particles"===a_b.path[0]?2===a_b.path.length&&0===a_b.type?a_b.props.data&&this.addParticle(a_b.path[1],b_b.particles[a_b.path[1]]):1===a_b.path.length&&1===a_b.type?this.addParticle(a_b.id,a_b.data):1===a_b.path.length&&2===a_b.type&&this.deleteParticle(a_b.id):"colors"===a_b.path[0]?2===a_b.path.length&&0===a_b.type?this.updateColor(a_b.path[1],a_b.props):1===a_b.path.length&&1===a_b.type?this.addColor(a_b.id,a_b.data):1===a_b.path.length&&2===a_b.type&&this.deleteColor(a_b.id):"materials"===a_b.path[0]?1===a_b.path.length&&1===a_b.type?this.addMaterial(a_b.id,a_b.data):1===a_b.path.length&&2===a_b.type?this.deleteMaterial(a_b.id):a_b.path.length>1&&this.getMaterial(a_b.path[1]).updateByOp($Fa.drop(a_b,2),b_b.materials[a_b.path[1]],{shared:this,scene:c_b}):"fonts"===a_b.path[0]?2===a_b.path.length&&0===a_b.type?this.updateFont(a_b.path[1],a_b,c_b):1===a_b.path.length&&1===a_b.type?this.addFont(a_b.id,a_b.data):1===a_b.path.length&&2===a_b.type&&this.deleteFont(a_b.id):"variables"===a_b.path[0]?2===a_b.path.length&&0===a_b.type&&"value"in a_b.props?this.updateVariable(a_b.path[1],a_b.props.value):1===a_b.path.length&&4===a_b.type?this.addVariableHolder(a_b.id,a_b.data):1===a_b.path.length&&5===a_b.type&&this.deleteVariable(a_b.id):"lib"===a_b.path[0]&&this.updateLibByOp($Fa.drop(a_b,1),c_b)}updateFont(d_b,e_b,f_b){if(e_b.props.url){let g_b=this.getFont(d_b),h_b={...this.data.fonts[d_b],url:e_b.props.url};g_b.update(h_b),g_b.loadingPromise.then(()=>this.requestRender()),f_b.updateFont(d_b,this)}}};new AYb(fOa.emptyData());var i_b=class extends Bvb{updateByPatchedOp(j_b,k_b,l_b){if(super.updateByPatchedOp(j_b,k_b,l_b),null!==(function(a,b){let c=[];if(b.length!==a.length)return null;for(var d=0;d<a.length;){if("*"===b[d])c.push(a[d]);else if(a[d]!==b[d])return null;d+=1}return c})(j_b.path,["materials"])&&0===j_b.type&&Array.isArray(this.material))for(let[m_b,n_b]of Object.entries(j_b.props)){let o_b=l_b.shared.material(n_b);this.material[Number(m_b)]=o_b}else if(TFa(j_b.path,["material"])&&this.material instanceof lTb)"material"in k_b&&"string"!=typeof k_b.material&&this.material.updateByOp($Fa.drop(j_b,1),k_b.material,l_b);else if(TFa(j_b.path,["materials","*"])&&Array.isArray(this.material)){let p_b=j_b.path[1];if("materials"in k_b&&p_b<this.material.length){let q_b=k_b.materials[p_b];"string"!=typeof q_b&&this.material[p_b].updateByOp($Fa.drop(j_b,2),q_b,l_b)}}}get needsAO(){return void 0!==this.material&&(Array.isArray(this.material)?this.material[0]:this.material).hasAO}updateState(r_b,s_b){super.updateState(r_b,s_b),void 0!==r_b.castShadow&&(this.castShadow=r_b.castShadow),void 0!==r_b.receiveShadow&&(this.receiveShadow=r_b.receiveShadow);let t_b=this.dataPatched;if(r_b.geometry?.type!=="NonParametricGeometry"&&"material"in r_b&& void 0!==r_b.material&&(this.disposeMaterial(),this.material=s_b.shared.material(r_b.material).getFlavor(t_b.flatShading,t_b.side,t_b.wireframe),s_b.scene.markNeedsUpdateRendererDirty()),(r_b.geometry?.type==="NonParametricGeometry"||"materials"in r_b)&&("materials"in r_b&& void 0!==r_b.materials?(this.disposeMaterial(),this.material=r_b.materials.map(a=>s_b.shared.material(a).getFlavor(t_b.flatShading,t_b.side,t_b.wireframe)),s_b.scene.markNeedsUpdateRendererDirty()):"material"in r_b&& void 0!==r_b.material&&(this.disposeMaterial(),this.material=[s_b.shared.material(r_b.material).getFlavor(t_b.flatShading,t_b.side,t_b.wireframe)],s_b.scene.markNeedsUpdateRendererDirty())),void 0!==r_b.flatShading|| void 0!==r_b.wireframe|| void 0!==r_b.side)if(Array.isArray(this.material))for(let u_b=0;u_b<this.material.length;u_b++)this.material[u_b]=this.material[u_b].getFlavor(t_b.flatShading,t_b.side,t_b.wireframe);else this.material=this.material.getFlavor(t_b.flatShading,t_b.side,t_b.wireframe)}disposeMaterial(){this.material&&Wya(this.material).forEach(a=>{a instanceof lTb&&(a instanceof fVb||a.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},v_b=new fm,w_b=new sh,x_b=new sh,y_b=new fm,z_b=new rs,A_b=class extends i_b{constructor(B_b,C_b,D_b){super(B_b,C_b),this.data=C_b,this.isSkinnedMesh=!1,this.localGeometry=void 0,C_b.bindMode&&C_b.bindMatrix&&(this.bindMode=C_b.bindMode,this.bindMatrix=new rs().fromArray(C_b.bindMatrix),this.bindMatrixInverse=new rs)}chooseGeoemtryCache(E_b){return E_b.geometryCache}markGeometryAsReachable(F_b){this.geometryCreateDeleyed instanceof nE&&this.chooseGeoemtryCache(F_b).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(void 0!==this.localGeometry)return this.localGeometry;if(this.geometryCreateDeleyed instanceof AYb){let G_b=this.geometryCreateDeleyed,H_b=this.chooseGeoemtryCache(G_b);this.geometryCreateDeleyed=H_b.get(this.dataPatched.geometry,G_b,this)}return this.geometryCreateDeleyed}set geometry(I_b){this.localGeometry=I_b}get is2DAndNoDepth(){let J_b=this.dataPatched.geometry;return sNa.is2DParametricMesh(J_b.type)&&0===J_b.depth}get is2DType(){return sNa.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return"NonParametricGeometry"===this.geometry.userData.type}updateByPatchedOp(K_b,L_b,M_b){super.updateByPatchedOp(K_b,L_b,M_b),TFa(K_b.path,["geometry"])&&this.updateByPatchedOpGeometry($Fa.drop(K_b,1),L_b.geometry,M_b)}removeInteractionGeometry(N_b){this.localGeometry?.dispose(),this.localGeometry=void 0}updateGeometryInteractions(O_b,P_b){this.invalidateDownstreamBooleanData();let Q_b=this.data.geometry.type;if("NonParametricGeometry"===Q_b||"SubdivGeometry"===Q_b){let R_b=O_b;if(void 0===this.localGeometry){let S_b={...this.data.geometry,...R_b};this.localGeometry=Msb(S_b,P_b,this.data.flatShading,this)}let T_b,U_b,V_b;R_b.scaleBaked?[T_b,U_b,V_b]=R_b.scaleBaked:{width:T_b,height:U_b,depth:V_b}=R_b;let W_b=this.localGeometry.userData;void 0!==W_b.sxPrev&&Osb(this.localGeometry.attributes,T_b/W_b.sxPrev,U_b/W_b.syPrev,V_b/W_b.szPrev),W_b.sxPrev=T_b,W_b.syPrev=U_b,W_b.szPrev=V_b}else{let X_b={...this.data.geometry,...O_b};this.localGeometry?.dispose(),this.localGeometry=Msb(X_b,P_b,this.data.flatShading,this)}}refreshAttachedCloners(Y_b){for(let Z_b of this.attachedSurfaceCloners)Y_b.scene.addPendingUpdateCloner(Z_b.object)}refreshAttachedPaths($_b){for(let __b of this.attachedPaths)$_b.scene.addPendingCommand(()=>__b.updateShape())}createGeometryDelayed(a0b){this.geometryCreateDeleyed=a0b.shared,this.refreshAttachedCloners(a0b),this.refreshAttachedPaths(a0b)}updateByPatchedOpGeometry(b0b,c0b,d0b){let e0b=!1;0===b0b.type&&0===b0b.path.length&&Object.keys(b0b.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof Wsb&&this.chooseGeoemtryCache(d0b.shared).mutateIfUnique(this.geometryCreateDeleyed.data,c0b)===this.geometryCreateDeleyed&&(e0b=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(c0b,b0b.props.scaleBaked),this.refreshAttachedCloners(d0b),this.refreshAttachedPaths(d0b)),e0b||(d0b.scene?.markGeometryCacheDirty(),this.createGeometryDelayed(d0b)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(f0b,g0b){this.createGeometryDelayed(g0b)}updateState(h0b,i0b){void 0!==h0b.geometry&&this.updateGeometryOnStateUpdate(h0b.geometry,i0b),super.updateState(h0b,i0b)}updateGeometryGroupsIfNeeded(){Array.isArray(this.material)&&0===this.geometry.groups.length&&this.geometry.addGroup(0,Math.max(this.geometry.getIndex()?.count??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(j0b,k0b){let l0b=this.geometry.userData.parameters;this.is2DType?j0b.set(0,0,.5*l0b.depth):this.isNonParametric?(j0b.setScalar(0),this.geometry.boundingSphere&&j0b.copy(this.geometry.boundingSphere.center),k0b.set(l0b.width,l0b.height,l0b.depth??0).multiplyScalar(.5)):j0b.setScalar(0),k0b.set(l0b.width,l0b.height,l0b.depth??0).multiplyScalar(.5)}updateMatrixWorld(m0b){super.updateMatrixWorld(m0b),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(n0b,o0b){this.skeleton=n0b,this.isSkinnedMesh=!0,void 0===o0b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),o0b=this.matrixWorld),this.bindMatrix.copy(o0b),this.bindMatrixInverse.copy(o0b).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(p0b){let q0b=new sh,r0b=this.geometry.attributes.skinWeight;for(let s0b=0,t0b=r0b.count;s0b<t0b;s0b++){q0b.fromBufferAttribute(r0b,s0b);let u0b=1/q0b.manhattanLength();u0b!==1/0?q0b.multiplyScalar(u0b):q0b.set(1,0,0,0),r0b.setXYZW(s0b,q0b.x,q0b.y,q0b.z,q0b.w)}}boneTransform(v0b,w0b){let x0b=this.skeleton;if(void 0===x0b)return;let y0b=this.geometry;w_b.fromBufferAttribute(y0b.attributes.skinIndex,v0b),x_b.fromBufferAttribute(y0b.attributes.skinWeight,v0b),v_b.copy(w0b).applyMatrix4(this.bindMatrix),w0b.set(0,0,0);for(let z0b=0;z0b<4;z0b++){let A0b=x_b.getComponent(z0b);if(0!==A0b){let B0b=w_b.getComponent(z0b);z_b.multiplyMatrices(x0b.bones[B0b].matrixWorld,x0b.boneInverses[B0b]),w0b.addScaledVector(y_b.copy(v_b).applyMatrix4(z_b),A0b)}}return w0b.applyMatrix4(this.bindMatrixInverse)}};function C0b(a){if(Array.isArray(a.material)){for(let b of a.material)if(0===b.getLayersOfType("outline").length)return}else if(!(a.material instanceof lTb)||0===a.material.getLayersOfType("outline").length)return;a instanceof A_b&&a.is2DAndNoDepth?(function(a){if(a.geometry.attributes.extrudeNormals||!a.geometry.attributes.position)return;let b=a.geometry.attributes.position.array,c=new Float32Array(b.length),d=new fm;for(let e=0;e<b.length;e+=3)d.set(b[e],b[e+1],b[e+2]).normalize(),c[e]=d.x,c[e+1]=d.y,c[e+2]=d.z;a.geometry.setAttribute("extrudeNormal",new cE(c,3))})(a):(function(a){if(a.geometry.attributes.extrudeNormal||!a.geometry.attributes.position||!a.geometry.attributes.normal)return;let b=new Map,c=a.geometry.attributes,d=c.position.array,e=c.normal.array,f=new Float32Array(d.length);for(let g=0;g<d.length;g+=3){let h=`${d[g]}_${d[g+1]}_${d[g+2]}`,i=new fm(e[g],e[g+1],e[g+2]);b.has(h)?b.get(h)?.normals.push(i):b.set(h,{normals:[i],result:new fm})}b.forEach((a,b)=>{for(let c of a.normals)a.result.add(c);a.result.divideScalar(a.normals.length)});for(let j=0;j<d.length;j+=3){let k=b.get(`${d[j]}_${d[j+1]}_${d[j+2]}`)?.result;k&&(f[j]=k.x,f[j+1]=k.y,f[j+2]=k.z)}a.geometry.setAttribute("extrudeNormal",new cE(f,3))})(a)}function D0b(a){if(!a.geometry.attributes.position)return;let b=a.geometry.attributes.position.array,c=new Float32Array(b.length),d=parseInt(a.uuid.replace(/\D/g,"")),e=[Db.seededRandom(d),Db.seededRandom(d+1e4),Db.seededRandom(d+2e4)];for(let f=0;f<b.length;f++)c[f]=e[f%3];a.geometry.setAttribute("randomColor",new RC(c,3))}var E0b=new Io,F0b=new fm,G0b=class extends A_b{constructor(H0b,I0b,J0b){super(H0b,I0b,J0b),this.data=I0b,this.hiddenMatrixOld=new rs,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(K0b){return this.dataPatched.flatShading?K0b.geometryCache:K0b.geometryCache2}get subdivPointerNew(){return void 0!==this.localGeometry?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return void 0!==this.localGeometry?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(L0b,M0b){let N0b=this.geometry.userData.parameters;L0b.copy(this.originalGeometryNew.boundingSphere.center),M0b.set(N0b.width,N0b.height,N0b.depth??0).multiplyScalar(.5)}createGeometryByControls(O0b){if(!0===this.skipReactionUpdate)return;let P0b=this.localGeometry?.uuid,{originalGeometry:Q0b,subdividedGeometry:R0b,subdivPointer:S0b}=Wsb.build(O0b,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=S0b,void 0!==Q0b&&(this.originalGeometry?.dispose(),this.originalGeometry=Q0b),void 0!==R0b&&(this.subdividedGeometry?.dispose(),this.subdividedGeometry=R0b??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,C0b(this),D0b(this),this.calcBoundingBox(),P0b&&(this.localGeometry.uuid=P0b)}updateState(T0b,U0b){if(super.updateState(T0b,U0b),void 0!==T0b.flatShading){let V0b=this.material;this.material=Array.isArray(V0b)?V0b.map(a=>a.getFlavor(!1,a.side,a.wireframe)):V0b.getFlavor(!1,V0b.side,V0b.wireframe),this.smoothShading=!T0b.flatShading,this.createGeometryDelayed(U0b)}}updateMesh(W0b=!1){Wsb.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,W0b&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&Wsb.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,W0b&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=Wsb.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=Wsb.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(X0b,Y0b){let Z0b=this.localGeometry;this.localGeometry=this.originalGeometryNew,Bvb.prototype.raycast.call(this,X0b,Y0b),this.localGeometry=Z0b}activateSVDCompensation(){this.hasNonUniformScale&&(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){this.hasNonUniformScale&&(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let $0b=this.originalGeometry;null===$0b.boundingSphere&&($0b.boundingSphere=new pq,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=$0b.boundingSphere));let _0b=$0b.attributes.position,a1b=$0b.boundingSphere.center;E0b.setFromBufferAttribute(_0b),E0b.getCenter(a1b),$0b.boundingSphere.radius=a1b.distanceTo(E0b.max),isNaN($0b.boundingSphere.radius)&&console.error("THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.",this),E0b.getSize(F0b),this.hasNonUniformScale&&F0b.divide(this.scale);let b1b={width:F0b.x,height:F0b.y,depth:F0b.z};return this.geometry.userData.parameters=b1b,b1b}updateBoundingSphere(c1b){let d1b=this.originalGeometry;E0b.min.set(c1b[0],c1b[2],c1b[4]),E0b.max.set(c1b[1],c1b[3],c1b[5]),this.hasNonUniformScale&&(E0b.min.applyMatrix4(this.shearScaleInv),E0b.max.applyMatrix4(this.shearScaleInv)),null===d1b.boundingSphere&&(d1b.boundingSphere=new pq);let e1b=d1b.boundingSphere.center;E0b.getCenter(e1b),d1b.boundingSphere.radius=e1b.distanceTo(E0b.max)}freeSubdivPointer(){this.subdivPointer&&(Wsb.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,this.originalGeometry?.dispose(),this.subdividedGeometry?.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(f1b,g1b,h1b){super.updateByPatchedOpGeometry(f1b,g1b,h1b),this.localGeometry&&this.createGeometryByControls(g1b)}},i1b=-1,j1b=1,k1b={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},l1b={polygon_center:0,edge:1,vertex:2},m1b=(a,b)=>(c,d)=>b&&0!==c&&0!==a?a*d/100:0,n1b=(a,b)=>{let c=Math.abs(b),d=-1*c;return(a-i1b)*(c-d)/(j1b-i1b)+d},o1b=new fm,p1b=new fm,q1b=new fm,r1b=new fm;function s1b(a,b){let c=q1b.fromArray(a),d=r1b.fromArray(b);p1b.copy(d).sub(c);let e=p1b.length();return p1b.normalize().multiplyScalar(.5*e),o1b.copy(c).add(p1b).toArray()}var t1b=new TA,u1b=new fm,v1b=new fm,w1b=new fm,x1b=4,y1b=.5,z1b=a=>.5*(1-Math.cos(a*Math.PI)),A1b=class{constructor(){this.perlin=new Array(4096)}noise(B1b,C1b=0,D1b=0){if(null==this.perlin){this.perlin=new Array(4096);for(let E1b=0;E1b<4096;E1b++)this.perlin[E1b]=Math.random()}B1b<0&&(B1b=-B1b),C1b<0&&(C1b=-C1b),D1b<0&&(D1b=-D1b);let F1b=Math.floor(B1b),G1b=Math.floor(C1b),H1b=Math.floor(D1b),I1b=B1b-F1b,J1b=C1b-G1b,K1b=D1b-H1b,L1b,M1b,N1b=0,O1b=.5,P1b,Q1b,R1b;for(let S1b=0;S1b<x1b;S1b++){let T1b=F1b+(G1b<<4)+(H1b<<8);L1b=z1b(I1b),M1b=z1b(J1b),P1b=this.perlin[4095&T1b],P1b+=L1b*(this.perlin[T1b+1&4095]-P1b),Q1b=this.perlin[T1b+16&4095],Q1b+=L1b*(this.perlin[T1b+16+1&4095]-Q1b),P1b+=M1b*(Q1b-P1b),T1b+=256,Q1b=this.perlin[4095&T1b],Q1b+=L1b*(this.perlin[T1b+1&4095]-Q1b),R1b=this.perlin[T1b+16&4095],R1b+=L1b*(this.perlin[T1b+16+1&4095]-R1b),Q1b+=M1b*(R1b-Q1b),P1b+=z1b(K1b)*(Q1b-P1b),N1b+=P1b*O1b,O1b*=y1b,F1b<<=1,I1b*=2,G1b<<=1,J1b*=2,H1b<<=1,K1b*=2,I1b>=1&&(F1b++,I1b--),J1b>=1&&(G1b++,J1b--),K1b>=1&&(H1b++,K1b--)}return N1b}noiseSeed(U1b){let V1b,W1b,X1b={setSeed(a){W1b=V1b=(a??4294967296*Math.random())>>>0},getSeed(){return V1b},rand(){return(W1b=(1664525*W1b+1013904223)%4294967296)/4294967296}};X1b.setSeed(U1b),this.perlin=new Array(4096);for(let Y1b=0;Y1b<4096;Y1b++)this.perlin[Y1b]=X1b.rand()}},Z1b=new fm,$1b=new rs,_1b=new $q;function a2b(a){let b=!1;return a.scene.objects.traverse((a,c)=>{"Mesh"===c.type&&"TextGeometry"===c.geometry.type&&(b=!0)}),b}var b2b,c2b,d2b,e2b,f2b,g2b=class extends A_b{constructor(h2b,i2b,j2b){super(h2b,i2b,j2b),this.data=i2b}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){let k2b=this.dataPatched;return this.font?.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,k2b.geometry.height,this.fontScale,k2b.geometry.verticalAlign)??0}get fontScale(){let l2b=this.dataPatched;return this.font?l2b.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){return(this.font?.ascender??1)*this.fontScale}get descender(){return(this.font?.descender??1)*this.fontScale}get lineHeight(){let m2b=this.dataPatched;return m2b.geometry.fontSize*m2b.geometry.lineHeight}raycast(n2b,o2b){let{matrixWorld:p2b}=this;if(!(isNaN(n2b.ray.origin.x)||0===this.scale.x||0===this.scale.y||0===this.scale.z)&&($1b.copy(p2b).invert(),_1b.copy(n2b.ray).applyMatrix4($1b),_1b.intersectBox(this.singleBBox,Z1b))){let q2b=Z1b.applyMatrix4(p2b),r2b=n2b.ray.origin.distanceTo(q2b);o2b.push({distance:r2b,point:q2b.clone(),object:this})}}},s2b=1e-4,t2b=new fm,u2b=new fm;Jsb.then(a=>{d2b=[(c2b=a).get_face_center,c2b.get_edge_midpoint,c2b.get_vertex_position],e2b=[c2b.get_face_normal,c2b.get_edge_normal,c2b.get_vertex_normal],f2b=[c2b.face_count,c2b.edge_count,c2b.vertex_count]});var v2b=new rs,w2b=new rs,x2b=new fm,y2b=new fm,z2b=new fm,A2b=new fm,B2b=new fm,C2b=new fm,D2b=new A1b,E2b=class extends bSa(Iy){constructor(F2b,G2b){super(),this.parameters=G2b,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.object=F2b}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(H2b){if(null===this.parent)this.updateState(this.parameters,H2b);else for(let I2b of this.children)I2b instanceof eSa&&I2b.expand()}invalidateTransform(J2b){this.matrixWorldNeedsUpdate=!0,this.traverse(a=>{a instanceof eSa&&a.object===J2b&&(a.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){"toObject"!==this.parameters.type&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let K2b of this.children)K2b.updateMatrix(),K2b.hasNonUniformScale&&(K2b.updateMatrixWorld(),K2b.updateMatrixWorldSVD())}_updateCount(L2b){let M2b;if(M2b=void 0!==L2b?L2b:"grid"===this.parameters.type?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,"toObject"!==this.parameters.type||this.parameters.toObject.object||(M2b=0),"toObject"===this.parameters.type&&this.objectForSample){for(let N2b=0,O2b=this.children.length;N2b<O2b;++N2b)this.remove(this.children[0]);let P2b=this.children;if(P2b.length===M2b)return;if(P2b.length<M2b)for(let Q2b=0,R2b=M2b-P2b.length;Q2b<R2b;++Q2b){let S2b=new eSa(this.object);S2b.expand(),this.add(S2b)}else for(let T2b=0,U2b=P2b.length-M2b;T2b<U2b;++T2b)this.remove(P2b[T2b])}else{if(this.children.length===M2b)return;if(this.children.length<M2b)for(let V2b=0,W2b=M2b-this.children.length;V2b<W2b;++V2b){let X2b=new eSa(this.object);X2b.expand(),this.add(X2b)}else for(let Y2b=0,Z2b=this.children.length-M2b;Y2b<Z2b;++Y2b)this.remove(this.children[0])}}_updateRadial($2b){let _2b=$2b.radial,a3b=_2b.start*Db.DEG2RAD,b3b=a3b-_2b.end*Db.DEG2RAD,c3b=new Ex(_2b.rotation[0],_2b.rotation[1],_2b.rotation[2]),d3b;switch(_2b.axis){case"z":d3b=new fm(0,0,1);break;case"y":d3b=new fm(0,1,0);break;default:case"x":d3b=new fm(1,0,0);break}let e3b=$2b.randomnessObject??HJa.defaultData([1,1,1]).randomnessObject,f3b="perlin"===e3b.noiseType;D2b.noiseSeed(e3b.seed);let g3b=wRa((0,oRa.default)(e3b.seed)),h3b=m1b(e3b.strength,this.parameters.randomness);for(let[i3b,j3b]of this.children.entries()){let k3b=i3b*(e3b.freqScale/10)+e3b.movement,l3b=f3b?D2b.noise(k3b):g3b(k3b,k3b),m3b=i3b+1;j3b.scale.x=_2b.scale[0]+h3b(m3b,n1b(l3b,e3b.scale[0]))||s2b,j3b.scale.y=_2b.scale[1]+h3b(m3b,n1b(l3b,e3b.scale[1]))||s2b,j3b.scale.z=_2b.scale[2]+h3b(m3b,n1b(l3b,e3b.scale[2]))||s2b,j3b.position.setScalar(0);let n3b=b3b/$2b.count*i3b-a3b;switch(_2b.axis){case"x":j3b.rotation.set(0,n3b,0);break;case"y":j3b.rotation.set(0,0,n3b);break;case"z":j3b.rotation.set(n3b,0,0);break}j3b.translateOnAxis(d3b,_2b.radius),j3b.position.x+=_2b.position[0]+h3b(m3b,n1b(l3b,e3b.position[0])),j3b.position.y+=_2b.position[1]+h3b(m3b,n1b(l3b,e3b.position[1])),j3b.position.z+=_2b.position[2]+h3b(m3b,n1b(l3b,e3b.position[2]));let o3b=h3b(m3b,n1b(l3b,e3b.rotation[0])),p3b=h3b(m3b,n1b(l3b,e3b.rotation[1])),q3b=h3b(m3b,n1b(l3b,e3b.rotation[2]));!0===_2b.alignment?(j3b.rotation.x+=c3b.x+o3b,j3b.rotation.y+=c3b.y+p3b,j3b.rotation.z+=c3b.z+q3b):j3b.rotation.set(c3b.x+o3b,c3b.y+p3b,c3b.z+q3b)}}_updateLinear(r3b){if("linear"!==r3b.type)throw new Error;let s3b=r3b.linear,t3b=new Ex(s3b.rotation[0],s3b.rotation[1],s3b.rotation[2]),u3b=r3b.randomnessObject??HJa.defaultData([1,1,1]).randomnessObject,v3b="perlin"===u3b.noiseType;D2b.noiseSeed(u3b.seed);let w3b=wRa((0,oRa.default)(u3b.seed)),x3b=m1b(u3b.strength,this.parameters.randomness);for(let[y3b,z3b]of this.children.entries()){let A3b=y3b*(u3b.freqScale/10)+u3b.movement,B3b=v3b?D2b.noise(A3b):w3b(A3b,A3b),C3b=y3b+1,D3b=x3b(C3b,n1b(B3b,u3b.rotation[0])),E3b=x3b(C3b,n1b(B3b,u3b.rotation[1])),F3b=x3b(C3b,n1b(B3b,u3b.rotation[2]));z3b.scale.x=1+(s3b.scale[0]-1)*y3b+x3b(C3b,n1b(B3b,u3b.scale[0]))||s2b,z3b.scale.y=1+(s3b.scale[1]-1)*y3b+x3b(C3b,n1b(B3b,u3b.scale[1]))||s2b,z3b.scale.z=1+(s3b.scale[2]-1)*y3b+x3b(C3b,n1b(B3b,u3b.scale[2]))||s2b,z3b.rotation.x=t3b.x*y3b+D3b,z3b.rotation.y=t3b.y*y3b+E3b,z3b.rotation.z=t3b.z*y3b+F3b,z3b.position.x=s3b.position[0]*y3b+x3b(C3b,n1b(B3b,u3b.position[0])),z3b.position.y=s3b.position[1]*y3b+x3b(C3b,n1b(B3b,u3b.position[1])),z3b.position.z=s3b.position[2]*y3b+x3b(C3b,n1b(B3b,u3b.position[2]))}}_updateGrid(G3b){let H3b=0,I3b=G3b.grid,J3b=G3b.randomnessObject??HJa.defaultData([1,1,1]).randomnessObject,K3b=m1b(J3b.strength,this.parameters.randomness),L3b="perlin"===J3b.noiseType;D2b.noiseSeed(J3b.seed);let M3b=function(a=Math.random){let b=xRa(a),c=new Float64Array(b).map(a=>vRa[a%12*3]),d=new Float64Array(b).map(a=>vRa[a%12*3+1]),e=new Float64Array(b).map(a=>vRa[a%12*3+2]);return function(a,f,g){let h,i,j,k,l=(a+f+g)*rRa,m=tRa(a+l),n=tRa(f+l),o=tRa(g+l),p=(m+n+o)*sRa,q=m-p,r=n-p,s=o-p,t=a-q,u=f-r,v=g-s,w,x,y,z,A,B;t>=u?u>=v?(w=1,x=0,y=0,z=1,A=1,B=0):t>=v?(w=1,x=0,y=0,z=1,A=0,B=1):(w=0,x=0,y=1,z=1,A=0,B=1):u<v?(w=0,x=0,y=1,z=0,A=1,B=1):t<v?(w=0,x=1,y=0,z=0,A=1,B=1):(w=0,x=1,y=0,z=1,A=1,B=0);let C=t-w+sRa,D=u-x+sRa,E=v-y+sRa,F=t-z+2*sRa,G=u-A+2*sRa,H=v-B+2*sRa,I=t-1+3*sRa,J=u-1+3*sRa,K=v-1+3*sRa,L=255&m,M=255&n,N=255&o,O=.6-t*t-u*u-v*v;if(O<0)h=0;else{let P=L+b[M+b[N]];h=(O*=O)*O*(c[P]*t+d[P]*u+e[P]*v)}let Q=.6-C*C-D*D-E*E;if(Q<0)i=0;else{let R=L+w+b[M+x+b[N+y]];i=(Q*=Q)*Q*(c[R]*C+d[R]*D+e[R]*E)}let S=.6-F*F-G*G-H*H;if(S<0)j=0;else{let T=L+z+b[M+A+b[N+B]];j=(S*=S)*S*(c[T]*F+d[T]*G+e[T]*H)}let U=.6-I*I-J*J-K*K;if(U<0)k=0;else{let V=L+1+b[M+1+b[N+1]];k=(U*=U)*U*(c[V]*I+d[V]*J+e[V]*K)}return 32*(h+i+j+k)}}((0,oRa.default)(J3b.seed));if(!0===I3b.useCenter){let N3b={x:I3b.count[0]%2==0?2:1,y:I3b.count[1]%2==0?2:1,z:I3b.count[2]%2==0?2:1},O3b=new fm(I3b.size[0]*(I3b.count[0]-N3b.x)*.5,I3b.size[1]*(I3b.count[1]-N3b.y)*.5,I3b.size[2]*(I3b.count[2]-N3b.z)*.5);for(let P3b=0;P3b<I3b.count[0];P3b++)for(let Q3b=0;Q3b<I3b.count[1];Q3b++)for(let R3b=0;R3b<I3b.count[2];R3b++){let S3b=[(P3b+1)*(J3b.freqScale/10)+J3b.movement,(Q3b+1)*(J3b.freqScale/10)+J3b.movement,(R3b+1)*(J3b.freqScale/10)+J3b.movement],T3b=L3b?D2b.noise(...S3b):M3b(...S3b),U3b=this.children[H3b++];U3b.scale.x=1+K3b(H3b,n1b(T3b,J3b.scale[0]))||s2b,U3b.scale.y=1+K3b(H3b,n1b(T3b,J3b.scale[1]))||s2b,U3b.scale.z=1+K3b(H3b,n1b(T3b,J3b.scale[2]))||s2b;let V3b=K3b(H3b,n1b(T3b,J3b.rotation[0])),W3b=K3b(H3b,n1b(T3b,J3b.rotation[1])),X3b=K3b(H3b,n1b(T3b,J3b.rotation[2]));U3b.rotation.set(V3b,W3b,X3b),U3b.position.x=I3b.size[0]*P3b-O3b.x+K3b(H3b,n1b(T3b,J3b.position[0])),U3b.position.y=I3b.size[1]*Q3b-O3b.y+K3b(H3b,n1b(T3b,J3b.position[1])),U3b.position.z=I3b.size[2]*R3b-O3b.z+K3b(H3b,n1b(T3b,J3b.position[2]))}}else for(let Y3b=0;Y3b<I3b.count[0];Y3b++)for(let Z3b=0;Z3b<I3b.count[1];Z3b++)for(let $3b=0;$3b<I3b.count[2];$3b++){let _3b=[(Y3b+1)*(J3b.freqScale/10)+J3b.movement,(Z3b+1)*(J3b.freqScale/10)+J3b.movement,($3b+1)*(J3b.freqScale/10)+J3b.movement],a4b=L3b?D2b.noise(..._3b):M3b(..._3b),b4b=this.children[H3b++];b4b.scale.x=1+K3b(H3b,n1b(a4b,J3b.scale[0]))||s2b,b4b.scale.y=1+K3b(H3b,n1b(a4b,J3b.scale[1]))||s2b,b4b.scale.z=1+K3b(H3b,n1b(a4b,J3b.scale[2]))||s2b;let c4b=K3b(H3b,n1b(a4b,J3b.rotation[0])),d4b=K3b(H3b,n1b(a4b,J3b.rotation[1])),e4b=K3b(H3b,n1b(a4b,J3b.rotation[2]));b4b.rotation.set(c4b,d4b,e4b),b4b.position.x=I3b.size[0]*Y3b+K3b(H3b,n1b(a4b,J3b.position[0])),b4b.position.y=-I3b.size[1]*Z3b+K3b(H3b,n1b(a4b,J3b.position[1])),b4b.position.z=-I3b.size[2]*$3b+K3b(H3b,n1b(a4b,J3b.position[2]))}}_updateToObject(f4b){if("toObject"!==f4b.type)throw new Error;let{toObject:g4b}=f4b,h4b=new Ex(g4b.rotation[0],g4b.rotation[1],g4b.rotation[2]),i4b=f4b.randomnessObject??HJa.defaultData([1,1,1]).randomnessObject,j4b="perlin"===i4b.noiseType;D2b.noiseSeed(i4b.seed);let k4b=wRa((0,oRa.default)(i4b.seed)),l4b=m1b(i4b.strength,this.parameters.randomness);if(!g4b.object){for(let[,m4b]of this.children.entries())m4b.position.set(0,0,0),m4b.scale.setScalar(1),m4b.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof g2b)if(this.objectForSample.font?.isLoaded&& void 0!==this.objectForSample.geometry.attributes.position)this._pendingMediaLoad=!1;else{this._pendingMediaLoad=!0;return}if(void 0===this.objectForSample.geometry&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let n4b=this.getSubdivData(),o4b=[],p4b=a=>{let b=a.length,c=a.map(a=>a[0]).reduce((a,b)=>a+b,0),d=a.map(a=>a[1]).reduce((a,b)=>a+b,0),e=a.map(a=>a[2]).reduce((a,b)=>a+b,0);return[c/b,d/b,e/b]},q4b=a=>Math.round(1e6*a)/1e6;n4b.forEach(a=>{let b=n4b.filter(b=>q4b(a.pos[0])===q4b(b.pos[0])&&q4b(a.pos[1])===q4b(b.pos[1])&&q4b(a.pos[2])===q4b(b.pos[2]));b.length>1?o4b.push({pos:a.pos,norm:p4b(b.map(a=>a.norm))}):o4b.push(a)});let r4b=function(a){let b=[],c={};for(var d=0,e=a.length;d<e;d++){var f=JSON.stringify(a[d].pos.map(a=>Math.round(1e4*a)/1e4));c[f]||(b.push(a[d]),c[f]=!0)}return b}(o4b);if(r4b.length>0){let s4b=Math.round(r4b.length*g4b.count/100);this._updateCount(s4b)}else{let t4b=this.objectForSample.geometry.getAttribute("position");if(!t4b||isNaN(t4b.count)||0===t4b.count){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let u4b=new ARa(this.objectForSample).build(),v4b=k1b[g4b.axis],w4b=this.children;for(let[x4b,y4b]of(u4b.setRandomGenerator((0,oRa.default)(this.object.uuid+g4b.seed)),w4b.entries())){let z4b=x4b*(i4b.freqScale/10)+i4b.movement,A4b=j4b?D2b.noise(z4b):k4b(z4b,z4b),B4b=x4b+1,C4b=l4b(B4b,n1b(A4b,i4b.rotation[0])),D4b=l4b(B4b,n1b(A4b,i4b.rotation[1])),E4b=l4b(B4b,n1b(A4b,i4b.rotation[2]));"random"===g4b.spreadType?u4b.sample(z2b,A2b):(r4b.length&&(z2b.fromArray(r4b[x4b].pos),A2b.fromArray(r4b[x4b].norm)),this.objectForSample instanceof G0b&&z2b.applyMatrix4(v2b.copy(this.objectForSample.matrixWorld).invert())),z2b.applyMatrix4(this.object.hiddenMatrix.clone().invert()),y4b.position.copy(z2b),x2b.fromArray(v4b);let F4b="normal"===g4b.align?A2b:this.object.getWorldDirection(C2b),G4b=y2b.fromArray(g4b.position);y2b.x+=l4b(B4b,n1b(A4b,i4b.position[0])),y2b.y+=l4b(B4b,n1b(A4b,i4b.position[1])),y2b.z+=l4b(B4b,n1b(A4b,i4b.position[2]));let H4b=Math.acos(F4b.dot(x2b)),I4b=B2b.crossVectors(x2b,F4b).normalize(),J4b=w2b.makeRotationAxis(I4b,H4b),K4b=F4b.clone().cross(this.object.up).normalize(),L4b=K4b.clone().cross(F4b).normalize(),M4b=new rs().makeBasis(K4b,F4b,L4b),N4b=new fm(x2b.y,x2b.z,x2b.x).normalize(),O4b=N4b.clone().cross(x2b).normalize(),P4b=new rs().makeBasis(N4b,x2b,O4b).invert(),Q4b=new rs().multiplyMatrices(M4b,P4b);y4b.rotation.setFromRotationMatrix(Q4b),G4b.applyMatrix4(J4b),y4b.position.add(G4b),y4b.rotation.x=y4b.rotation.x+h4b.x+C4b,y4b.rotation.y=y4b.rotation.y+h4b.y+D4b,y4b.rotation.z=y4b.rotation.z+h4b.z+E4b,y4b.scale.setScalar(1),y4b.scale.x=y4b.scale.x+g4b.scale[0]+l4b(B4b,n1b(A4b,i4b.scale[0]))||s2b,y4b.scale.y=y4b.scale.y+g4b.scale[1]+l4b(B4b,n1b(A4b,i4b.scale[1]))||s2b,y4b.scale.z=y4b.scale.z+g4b.scale[2]+l4b(B4b,n1b(A4b,i4b.scale[2]))||s2b,y4b.scale.multiply(this.object.scale),y4b.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let R4b=this.parameters.toObject.spreadType;if("random"===R4b)return[];if(!(this.objectForSample instanceof G0b))return(this.objectForSample.geometry.index?(function(a){let b=[];for(let c=0;c<=a.index.count;c++)if(u1b.fromArray(a.index.array,3*c),t1b.setFromAttributeAndIndices(a.attributes.position,u1b.x,u1b.y,u1b.z),t1b.getNormal(v1b),t1b.getMidpoint(w1b),!(isNaN(w1b.x)||isNaN(w1b.y)||isNaN(w1b.z))){let{a:d,b:e,c:f}=t1b,g=d.toArray(),h=e.toArray(),i=f.toArray(),j=d.distanceTo(e),k=e.distanceTo(f),l=f.distanceTo(d),m=s1b(g,h),n=s1b(h,i),o=s1b(i,g),p=[j,k,l],q=Math.max(...p),r=p.filter(a=>Math.round(a)===Math.round(q)).length>1,s=[],t=t1b.getMidpoint(w1b).toArray();q!==j||r||(s=[n,o,o],t=m),q!==k||r||(s=[m,o,o],t=n),q!==l||r||(s=[m,n,n],t=o),r&&(s=[m,n,o]),b.push({vertices:[g,h,i],faceCenters:s,midpoint:t,norm:t1b.getNormal(v1b).toArray()})}return b})(this.objectForSample.geometry):(function(a){let b=[],{position:c}=a.attributes;for(let d=0;d<c.count;d++){t1b.setFromAttributeAndIndices(c,3*d,3*d+1,3*d+2),t1b.getNormal(v1b),t1b.getMidpoint(w1b);let e=t1b.a.toArray(),f=t1b.b.toArray(),g=t1b.c.toArray();b.push({vertices:[e,f,g],faceCenters:[s1b(e,f),s1b(f,g),s1b(g,e)],midpoint:w1b.toArray(),norm:v1b.toArray()})}return b})(this.objectForSample.geometry)).map((a,b)=>"polygon_center"===R4b?{pos:a.midpoint,norm:a.norm}:"vertex"===R4b?[{pos:a.vertices[0],norm:a.norm},{pos:a.vertices[1],norm:a.norm},{pos:a.vertices[2],norm:a.norm}]:"edge"===R4b?[{pos:a.faceCenters[0],norm:a.norm},{pos:a.faceCenters[1],norm:a.norm},{pos:a.faceCenters[2],norm:a.norm}]:[]).flat();{let S4b=this.objectForSample,T4b=l1b[R4b],U4b=f2b[T4b],V4b=d2b[T4b],W4b=e2b[T4b],X4b=[],Y4b=U4b(S4b.subdivPointerNew);for(let Z4b=0;Z4b<=Y4b-1;Z4b++){let $4b=V4b(S4b.subdivPointerNew,Z4b),_4b=W4b(S4b.subdivPointerNew,Z4b);t2b.fromArray($4b).applyMatrix4(S4b.matrixWorld),u2b.fromArray(_4b),X4b.push({pos:t2b.toArray(),norm:u2b.toArray()})}return X4b}}updateState(a5b,b5b){if(this.parameters=Uxa(a5b),"toObject"!==this.parameters.type)(null===this.parent||this.parent!==this.object)&&(this.removeFromParent(),this.object.parent?.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(null===this.parent||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let c5b=b5b.find(this.parameters.toObject.object);c5b instanceof Bvb?this.objectForSample=c5b:this.objectForSample=void 0,this.matrix=new rs,this.hiddenMatrix=new rs,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,c5b&&c5b.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},d5b=a=>{var b;return(b=class extends a{}).geometryHelper=new XI(30,30,30),b},e5b=new $q,f5b=new pq,g5b=new rs,h5b=(a,b,c,d,e=!1)=>{let f=b,g=a.matrixWorld;if(null===f.boundingSphere&&f.computeBoundingSphere(),f5b.copy(f.boundingSphere),f5b.applyMatrix4(g),!1===c.ray.intersectsSphere(f5b)||(g5b.copy(g).invert(),e5b.copy(c.ray).applyMatrix4(g5b),null!==f.boundingBox&& !1===e5b.intersectsBox(f.boundingBox)))return;let h,i,j,k,l=f.index,m=f.attributes.position,n=f.drawRange,o,p;if(!1===e){let q=Math.max(0,n.start),r=Math.min(l.count,n.start+n.count);for(o=q,p=r;o<p;o+=3)if(i=l.getX(o),j=l.getX(o+1),k=l.getX(o+2),h=F(a,c,e5b,m,i,j,k)){h.faceIndex=Math.floor(o/3),d.push(h);return}}else{let s=f.attributes.position,t=new fm,u=new fm,v=new fm,w=new fm,x=2,y=1/((a.scale.x+a.scale.y+a.scale.z)/3),z=y*y,A=Math.max(0,n.start),B=Math.min(s.count,n.start+n.count);for(let C=A,D=B-1;C<D;C+=x){if(t.fromBufferAttribute(s,C),u.fromBufferAttribute(s,C+1),e5b.distanceSqToSegment(t,u,w,v)>z)continue;w.applyMatrix4(a.matrixWorld);let E=c.ray.origin.distanceTo(w);E<c.near||E>c.far||d.push({distance:E,point:v.clone().applyMatrix4(a.matrixWorld),object:a})}}function F(a,b,c,d,e,f,g){let h=new fm,i=new fm,j=new fm,k=new fm,l=new fm;if(h.fromBufferAttribute(d,e),i.fromBufferAttribute(d,f),j.fromBufferAttribute(d,g),null===c.intersectTriangle(h,i,j,!1,k))return null;l.copy(k),l.applyMatrix4(a.matrixWorld);let m=b.ray.origin.distanceTo(l);return m<b.near||m>b.far?null:{faceIndex:1,distance:m,point:l.clone(),object:a}}},i5b=new fm,j5b=new yJ,k5b=class extends IZ{constructor(l5b){let m5b=new nE,n5b=new JY({color:16777215,vertexColors:!0,toneMapped:!1}),o5b=[],p5b=[],q5b={},r5b=new df(15711266),s5b=new df(15711266),t5b=new df(2857471);function u5b(a,b,c){v5b(a,c),v5b(b,c)}function v5b(a,b){o5b.push(0,0,0),p5b.push(b.r,b.g,b.b),void 0===q5b[a]&&(q5b[a]=[]),q5b[a].push(o5b.length/3-1)}u5b("n1","n2",r5b),u5b("n2","n4",r5b),u5b("n4","n3",r5b),u5b("n3","n1",r5b),u5b("f1","f2",r5b),u5b("f2","f4",r5b),u5b("f4","f3",r5b),u5b("f3","f1",r5b),u5b("n1","f1",r5b),u5b("n2","f2",r5b),u5b("n3","f3",r5b),u5b("n4","f4",r5b),u5b("p","n1",s5b),u5b("p","n2",s5b),u5b("p","n3",s5b),u5b("p","n4",s5b),u5b("u1","u2",t5b),u5b("u2","u3",t5b),u5b("u3","u1",t5b),m5b.setAttribute("position",new cE(o5b,3)),m5b.setAttribute("color",new cE(p5b,3)),super(m5b,n5b),this.type="CameraHelper",this.camera=l5b,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=l5b.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=q5b,this.update()}update(){let w5b=this.geometry,x5b=this.pointMap,y5b=!0;j5b.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-0.099999,-0,-0,-1.0000000000000002,.100001];let z5b=1,A5b=1,B5b=y5b?.8:1e-4;F5b("n1",x5b,w5b,j5b,-z5b,-A5b,B5b),F5b("n2",x5b,w5b,j5b,z5b,-A5b,B5b),F5b("n3",x5b,w5b,j5b,-z5b,A5b,B5b),F5b("n4",x5b,w5b,j5b,z5b,A5b,B5b);let C5b=B5b;F5b("f1",x5b,w5b,j5b,-z5b,-A5b,C5b),F5b("f2",x5b,w5b,j5b,z5b,-A5b,C5b),F5b("f3",x5b,w5b,j5b,-z5b,A5b,C5b),F5b("f4",x5b,w5b,j5b,z5b,A5b,C5b);let D5b=C5b,E5b=.5;F5b("u1",x5b,w5b,j5b,.7*z5b*E5b,1.1*A5b,D5b),F5b("u2",x5b,w5b,j5b,-(.7*z5b)*E5b,1.1*A5b,D5b),F5b("u3",x5b,w5b,j5b,0,A5b*(1.1+.9*E5b),D5b),w5b.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function F5b(a,b,c,d,e,f,g){i5b.set(e,f,g).unproject(d);let h=b[a];if(void 0!==h){let i=c.getAttribute("position");for(let j=0,k=h.length;j<k;j++)i.setXYZ(h[j],i5b.x,i5b.y,i5b.z)}}var G5b=class extends d5b(k5b){constructor(H5b){super(H5b),this.object=H5b,this.object=H5b,this.name=`CombinedCameraHelper: ${H5b.uuid}`}updateMatrixWorld(I5b){super.updateMatrixWorld(I5b),this.updateTarget()}updateTarget(){let J5b=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(J5b)}raycast(K5b,L5b){h5b(this.object,this.geometry,K5b,L5b,!0)}};(Etc||(Etc={})).is=a=>"objectHelper"in a;var M5b=(a,b)=>class extends cTa(a){constructor(){super(...arguments),this.objectHelper=new b(this),this.gizmos={}}get geometryHelper(){return b.geometryHelper}raycast(c,d){this.objectHelper.raycast(c,d)}showGizmos(){for(let e in this.gizmos){let f=this.gizmos[e];f instanceof hra&&(f.visible=!0)}}updateEntityBoxSize(g,h){this.objectHelper.visible&&this.geometryHelper instanceof XI?(g.setScalar(0),h.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(g,h)}hideGizmos(){for(let i in this.gizmos){let j=this.gizmos[i];j instanceof hra&&(j.visible=!1)}}},N5b=790,O5b=new fm,P5b=new fm,Q5b=new Fj,R5b=new fm,S5b=new fm,T5b=new fm,U5b=class extends M5b(yJ,G5b){constructor(V5b="",W5b={...MNa.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=GJa.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(V5b,W5b),this.previousProjectionMatrix=new rs,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let X5b=this.width,Y5b=this.height;this.orthoCamera=new wO(-0.5*X5b,.5*X5b,.5*Y5b,-0.5*Y5b,-5e4,1e4),this.perspCamera=new GJ(45,X5b/Y5b,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return"PerspectiveCamera"===this.cameraType}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(Z5b){this.perspCamera.fov=Z5b}get fov(){return this.perspCamera.fov}setNear($5b,_5b){"PerspectiveCamera"===$5b?this.perspCamera.near=_5b:this.orthoCamera.near=_5b}setZoom(a6b,b6b){b6b>=0&&("PerspectiveCamera"===a6b?this.perspCamera.zoom=b6b:this.orthoCamera.zoom=b6b)}set cameraType(c6b){"PerspectiveCamera"===c6b?this.toPerspective():"OrthographicCamera"===c6b&&this.toOrthographic()}get near(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.near:this.orthoCamera.near}set near(d6b){"PerspectiveCamera"===this._cameraType?this.perspCamera.near=d6b:this.orthoCamera.near=d6b}get zoom(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e6b){e6b>=0&&("PerspectiveCamera"===this._cameraType?this.perspCamera.zoom=e6b:this.orthoCamera.zoom=e6b)}lookAt(f6b,g6b,h6b){"number"==typeof f6b&&(f6b=new fm(f6b,g6b,h6b)),super.lookAt(f6b),this.getWorldPosition(O5b),this.targetOffset=O5b.distanceTo(f6b)}getTarget(i6b=new fm){return this.getWorldDirection(P5b),this.getWorldPosition(O5b),P5b.multiplyScalar(this.targetOffset),i6b.copy(O5b).add(P5b),i6b}getDistanceToTarget(){let j6b=this.getTarget();return this.getWorldPosition(O5b),O5b.distanceTo(j6b)}updateUp(){this.getWorldQuaternion(Q5b),R5b.set(0,0,1).applyQuaternion(Q5b),S5b.copy(Iy.DEFAULT_UP),this.isUpVectorFlipped&&S5b.negate(),S5b.applyQuaternion(Q5b),T5b.copy(Iy.DEFAULT_UP).projectOnPlane(R5b),this.angleOffsetFromUp=T5b.angleTo(S5b),this.angleOffsetFromUp*=T5b.cross(S5b).dot(R5b)>=0?1:-1}updateTransformState(k6b,l6b){let m6b=super.updateTransformState(k6b,l6b);return void 0!==k6b.isUpVectorFlipped&&(this.isUpVectorFlipped=k6b.isUpVectorFlipped),this.updateUp(),m6b}getViewFrontToObject(n6b){let o6b=n6b.getWorldPosition(new fm),p6b=n6b.getWorldDirection(new fm).multiplyScalar(this.targetOffset);return{position:o6b.clone().add(p6b),target:o6b}}getViewToTarget(q6b){let r6b=this.getWorldDirection(new fm).multiplyScalar(this.targetOffset);return{position:q6b.clone().sub(r6b),target:q6b}}getViewToObject(s6b){let t6b=new fm;return s6b.getWorldPosition(t6b),this.getViewToTarget(t6b)}setViewplaneSize(u6b,v6b,w6b=!1){if(this.aspect=u6b/v6b,w6b){let x6b=u6b>v6b?this.aspect:1,y6b=u6b>v6b?1:this.aspect;this.left=-(.5*N5b)*x6b,this.right=.5*N5b*x6b,this.top=.5*N5b*(1/y6b),this.bottom=-(.5*N5b)*(1/y6b)}else this.left=-(.5*u6b),this.right=.5*u6b,this.top=.5*v6b,this.bottom=-(.5*v6b);this.updateProjectionMatrix()}copyViewPlaneSize(z6b){this.aspect=z6b.aspect,this.left=z6b.left,this.right=z6b.right,this.top=z6b.top,this.bottom=z6b.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(A6b){this.perspCamera.setFocalLength(A6b),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(B6b,C6b,D6b,E6b,F6b,G6b){"PerspectiveCamera"===this._cameraType?this.perspCamera.setViewOffset(B6b,C6b,D6b,E6b,F6b,G6b):this.orthoCamera.setViewOffset(B6b,C6b,D6b,E6b,F6b,G6b)}clearViewOffset(){"PerspectiveCamera"===this._cameraType?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){"PerspectiveCamera"===this._cameraType?this.toPerspective():"OrthographicCamera"===this._cameraType&&this.toOrthographic()}updateMatrixWorld(H6b){super.updateMatrixWorld(H6b),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(I6b,J6b){super.updateWorldMatrix(I6b,J6b),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(K6b,L6b){return super.copy(K6b,L6b),this.parent=K6b.parent,this.orthoCamera.copy(K6b.orthoCamera),this.perspCamera.copy(K6b.perspCamera),this.left=K6b.left,this.right=K6b.right,this.top=K6b.top,this.bottom=K6b.bottom,this.far=K6b.far,this.view=null===K6b.view?null:Object.assign({},K6b.view),this._cameraType=K6b._cameraType,this.aspect=K6b.aspect,this.fov=K6b.fov,this.focus=K6b.focus,this.filmGauge=K6b.filmGauge,this.filmOffset=K6b.filmOffset,this.targetOffset=K6b.targetOffset,this.updateProjectionMatrix(),this}toCameraState(M6b=[]){return Aya({type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped},M6b)}updateCameraSubtype(N6b,O6b){let P6b="perspective"===N6b?"PerspectiveCamera":"OrthographicCamera";void 0!==O6b.zoom&&this.setZoom(P6b,O6b.zoom),void 0!==O6b.near&&this.setNear(P6b,O6b.near),void 0!==O6b.fov&&"PerspectiveCamera"===P6b&&(this.fov=O6b.fov)}updateState(Q6b,R6b){this.updateCameraState(Q6b,R6b)}updateCameraState(S6b,T6b){this.updateState_Entity(S6b,T6b),void 0!==S6b.far&&(this.far=S6b.far),void 0!==S6b.orthographic&&this.updateCameraSubtype("orthographic",S6b.orthographic),void 0!==S6b.perspective&&this.updateCameraSubtype("perspective",S6b.perspective),void 0!==S6b.type&&(this.cameraType=S6b.type),void 0!==S6b.up&&this.up.fromArray(S6b.up),void 0!==S6b.targetOffset&&(this.targetOffset=S6b.targetOffset),void 0!==S6b.isUpVectorFlipped&&(this.isUpVectorFlipped=S6b.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(U6b,V6b,W6b){super.updateByPatchedOp(U6b,V6b,W6b),1===U6b.path.length&&0===U6b.type&&this.updateCameraSubtype(U6b.path[0],U6b.props)}toState(X6b){return{...super.toState(X6b),...this.toCameraState(X6b),type:this.cameraType}}},Y6b=new rs,Z6b=new rs;function $6b(a){let b=!1;return a.scene.objects.traverse((a,c)=>{c.geometry?.type==="BooleanGeometry"&&(b=!0)}),b}var _6b=class extends i_b{constructor(a7b,b7b,c7b){super(a7b,b7b),this.data=b7b,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new nE,this.onAfterRender=(a,b,c,d,e,f)=>{super.onAfterRender(a,b,c,d,e,f),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(d7b,e7b,f7b){super.updateByPatchedOp(d7b,e7b,f7b),1===d7b.path.length&&"geometry"===d7b.path[0]&&0===d7b.type&& void 0!==d7b.props.operation&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(g7b,h7b=!0){if(-1!==this.booleanMeshSetAddress&&!g7b)return;for(let i7b=0;i7b<this.children.length;i7b++){let j7b=this.children[i7b];j7b instanceof _6b&& !0===j7b.dataPatched.visible&&j7b.recomputeBoolean(!0===g7b,h7b)}this.meshSetAddresses=[];for(let k7b=0;k7b<this.children.length;k7b++){let l7b=this.children[k7b];if(l7b instanceof Bvb&& !0===l7b.dataPatched.visible&&l7b.geometry.attributes.position?.count>0&&l7b.geometry.drawRange.count>0&&0!==l7b.booleanMeshSetAddress){Y6b.multiplyMatrices(l7b.hiddenMatrix,l7b.matrix);try{if(-1===l7b.booleanMeshSetAddress){if((l7b.geometry.index??l7b.geometry.getAttribute("position")).count/3<15e5&&(l7b.booleanMeshSetAddress=dvb.getMeshSet(l7b.geometry,!0===g7b,h7b)),-1===l7b.booleanMeshSetAddress)return;dvb.transformMeshSet(l7b.booleanMeshSetAddress,Y6b),l7b.booleanMatrixInvOld.copy(Y6b).invert(),l7b.booleanWasTransformed=!1}else l7b instanceof _6b&& !0===l7b.needsTransformForDownstream?(dvb.transformMeshSet(l7b.booleanMeshSetAddress,Y6b),l7b.needsTransformForDownstream=!1):!0===l7b.booleanWasTransformed&&(dvb.transformMeshSet(l7b.booleanMeshSetAddress,Z6b.multiplyMatrices(Y6b,l7b.booleanMatrixInvOld)),l7b.booleanMatrixInvOld.copy(Y6b).invert(),l7b.booleanWasTransformed=!1)}catch(m7b){console.error(m7b),l7b.booleanMeshSetAddress=0,l7b.geometry.userData.booleanOperationDidFail=!0;continue}!1===dvb.hasOpenEdges(l7b.booleanMeshSetAddress)||k7b===this.children.length-1&&2===this.booleanOp?(this.meshSetAddresses.push(l7b.booleanMeshSetAddress),l7b.geometry.userData.booleanOperationDidFail=!1):l7b.geometry.userData.booleanOperationDidFail="openEdges"}}if(0===this.meshSetAddresses.length){this.geometry.setAttribute("position",new cE([],0)),this.geometry.setDrawRange(0,0);return}if(!0===g7b)return dvb.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let n7b=this.geometry;n7b.dispose(),this.geometry=new nE,this.geometry.userData=n7b.userData,this.geometry.boundingSphere=n7b.boundingSphere;try{this.booleanMeshSetAddress=dvb.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(o7b){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(o7b)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,C0b(this),D0b(this)}dispose(){super.dispose(),this.geometry.dispose()}};(Ftc||(Ftc={})).is=function(a){return Fsb.is(a)&&a instanceof Tea};var p7b=(a,b)=>class extends M5b(a,b){updateState_Light(c,d){this.updateState_Entity(c,d),void 0!==c.color&&(this.color=d.shared.color(c.color)),void 0!==c.intensity&&(this.intensity=c.intensity),void 0!==c.depth&&(this.shadow.camera.far=c.depth,this.shadow.needsUpdate=!0),void 0!==c.shadows&&(this.castShadow=c.shadows)}},q7b=a=>a instanceof Bvb,r7b=a=>null!==a&&a instanceof _6b,s7b=a=>a instanceof U5b,t7b=a=>Ftc.is(a),u7b=a=>Etc.is(a),v7b=class extends d5b(pra){constructor(w7b,x7b=15){super(x7b),this.object=w7b,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${w7b.uuid}`,this.matrix=w7b.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(y7b,z7b){h5b(this.object,v7b.geometryHelper,y7b,z7b)}update(){}},A7b=class extends M5b(ZT,v7b){constructor(B7b,C7b){super(),this.super_Entity(B7b,C7b),this.objectHelper.update()}updateState(D7b,E7b){this.updateState_Entity(D7b,E7b),"buffer"in D7b&&1===Object.keys(D7b).length&&E7b.scene.reloadSplats()}},F7b=class extends M5b(ZT,v7b){constructor(G7b,H7b,I7b){super(),this.super_Entity(G7b,H7b),this.context=I7b,this.objectHelper.update()}updateState(J7b,K7b){this.updateState_Entity(J7b,K7b)}},L7b={RED:0,GREEN:1,BLUE:2,ALPHA:3},M7b="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",N7b=class extends pJ{constructor(O7b=!1,P7b=!1){super({name:"BokehMaterial",defines:{PASS:O7b?"2":"1"},uniforms:{kernel64:new Eoa(null),kernel16:new Eoa(null),inputBuffer:new Eoa(null),cocBuffer:new Eoa(null),texelSize:new Eoa(new Eb),scale:new Eoa(1)},blending:S,depthWrite:!1,depthTest:!1,fragmentShader:`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,vertexShader:M7b}),this.toneMapped=!1,P7b&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(Q7b){this.uniforms.inputBuffer.value=Q7b}setInputBuffer(R7b){this.uniforms.inputBuffer.value=R7b}set cocBuffer(S7b){this.uniforms.cocBuffer.value=S7b}setCoCBuffer(T7b){this.uniforms.cocBuffer.value=T7b}get scale(){return this.uniforms.scale.value}set scale(U7b){this.uniforms.scale.value=U7b}getScale(V7b){return this.uniforms.scale.value=V7b}setScale(W7b){this.uniforms.scale.value=W7b}generateKernel(){let X7b=2.39996323,Y7b=new Float32Array(128),Z7b=new Float32Array(32),$7b=0,_7b=0;for(let a8b=0;a8b<80;++a8b){let b8b=a8b*X7b,c8b=Math.sqrt(a8b)/Math.sqrt(80),d8b=c8b*Math.cos(b8b),e8b=c8b*Math.sin(b8b);a8b%5==0?(Z7b[_7b++]=d8b,Z7b[_7b++]=e8b):(Y7b[$7b++]=d8b,Y7b[$7b++]=e8b)}let f8b=[],g8b=[];for(let h8b=0;h8b<128;)f8b.push(new sh(Y7b[h8b++],Y7b[h8b++],Y7b[h8b++],Y7b[h8b++]));for(let i8b=0;i8b<32;)g8b.push(new sh(Z7b[i8b++],Z7b[i8b++],Z7b[i8b++],Z7b[i8b++]));this.uniforms.kernel64.value=f8b,this.uniforms.kernel16.value=g8b}setTexelSize(j8b,k8b){this.uniforms.texelSize.value.set(j8b,k8b)}setSize(l8b,m8b){this.uniforms.texelSize.value.set(1/l8b,1/m8b)}};function n8b(a,b,c){return a*(b-c)-b}function o8b(a,b,c){return Math.min(Math.max((a+b)/(b-c),0),1)}var p8b=class extends pJ{constructor(q8b){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Eoa(null),focusDistance:new Eoa(0),focusRange:new Eoa(0),cameraNear:new Eoa(.3),cameraFar:new Eoa(1e3)},blending:S,depthWrite:!1,depthTest:!1,fragmentShader:`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,vertexShader:M7b}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(q8b)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(r8b){this.uniforms.depthBuffer.value=r8b}set depthPacking(s8b){this.defines.DEPTH_PACKING=s8b.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t8b,u8b=Ua){this.depthBuffer=t8b,this.depthPacking=u8b}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(v8b){this.uniforms.focusDistance.value=v8b}get worldFocusDistance(){return-n8b(this.focusDistance,this.near,this.far)}set worldFocusDistance(w8b){this.focusDistance=o8b(-w8b,this.near,this.far)}getFocusDistance(x8b){this.uniforms.focusDistance.value=x8b}setFocusDistance(y8b){this.uniforms.focusDistance.value=y8b}get focalLength(){return this.focusRange}set focalLength(z8b){this.focusRange=z8b}get focusRange(){return this.uniforms.focusRange.value}set focusRange(A8b){this.uniforms.focusRange.value=A8b}get worldFocusRange(){return-n8b(this.focusRange,this.near,this.far)}set worldFocusRange(B8b){this.focusRange=o8b(-B8b,this.near,this.far)}getFocalLength(C8b){return this.focusRange}setFocalLength(D8b){this.focusRange=D8b}adoptCameraSettings(E8b){E8b&&(this.uniforms.cameraNear.value=E8b.near,this.uniforms.cameraFar.value=E8b.far,E8b instanceof GJ?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},F8b=class extends pJ{constructor(G8b=new Eb){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Eoa(null),texelSize:new Eoa(new Eb),halfTexelSize:new Eoa(new Eb),kernel:new Eoa(0),scale:new Eoa(1)},blending:S,depthWrite:!1,depthTest:!1,fragmentShader:`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,vertexShader:"uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1,this.setTexelSize(G8b.x,G8b.y)}set inputBuffer(H8b){this.uniforms.inputBuffer.value=H8b}setInputBuffer(I8b){this.inputBuffer=I8b}get scale(){return this.uniforms.scale.value}set scale(J8b){this.uniforms.scale.value=J8b}getScale(){return this.uniforms.scale.value}setScale(K8b){this.uniforms.scale.value=K8b}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(L8b){this.uniforms.kernel.value=L8b}setKernel(M8b){this.kernel=M8b}setTexelSize(N8b,O8b){this.uniforms.texelSize.value.set(N8b,O8b),this.uniforms.halfTexelSize.value.set(N8b,O8b).multiplyScalar(.5)}setSize(P8b,Q8b){let R8b=this.uniforms;R8b.texelSize.value.set(1/P8b,1/Q8b),R8b.halfTexelSize.value.copy(R8b.texelSize.value).multiplyScalar(.5)}},S8b=class extends pJ{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Eoa(null),opacity:new Eoa(1)},blending:S,depthWrite:!1,depthTest:!1,fragmentShader:`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,vertexShader:M7b}),this.toneMapped=!1}set inputBuffer(T8b){this.uniforms.inputBuffer.value=T8b}setInputBuffer(U8b){this.uniforms.inputBuffer.value=U8b}getOpacity(V8b){return this.uniforms.opacity.value}setOpacity(W8b){this.uniforms.opacity.value=W8b}},X8b=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,Y8b=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,Z8b={DEPTH:0,LUMA:1,COLOR:2},$8b={DISABLED:0,DEPTH:1,CUSTOM:2},_8b=class extends pJ{constructor(a9b=new Eb,b9b=Z8b.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:L.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Eoa(null),depthBuffer:new Eoa(null),predicationBuffer:new Eoa(null),texelSize:new Eoa(a9b)},blending:S,depthWrite:!1,depthTest:!1,fragmentShader:X8b,vertexShader:Y8b}),this.toneMapped=!1,this.edgeDetectionMode=b9b}set depthBuffer(c9b){this.uniforms.depthBuffer.value=c9b}set depthPacking(d9b){this.defines.DEPTH_PACKING=d9b.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e9b,f9b=Ua){this.depthBuffer=e9b,this.depthPacking=f9b}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(g9b){this.defines.EDGE_DETECTION_MODE=g9b.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(h9b){this.edgeDetectionMode=h9b}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(i9b){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=i9b.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(j9b){this.localContrastAdaptationFactor=j9b}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(k9b){this.defines.EDGE_THRESHOLD=k9b.toFixed("6"),this.defines.DEPTH_THRESHOLD=(.1*k9b).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(l9b){this.edgeDetectionThreshold=l9b}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(m9b){this.defines.PREDICATION_MODE=m9b.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(n9b){this.predicationMode=n9b}set predicationBuffer(o9b){this.uniforms.predicationBuffer.value=o9b}setPredicationBuffer(p9b){this.uniforms.predicationBuffer.value=p9b}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(q9b){this.defines.PREDICATION_THRESHOLD=q9b.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(r9b){this.predicationThreshold=r9b}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(s9b){this.defines.PREDICATION_SCALE=s9b.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(t9b){this.predicationScale=t9b}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(u9b){this.defines.PREDICATION_STRENGTH=u9b.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(v9b){this.predicationStrength=v9b}setSize(w9b,x9b){this.uniforms.texelSize.value.set(1/w9b,1/x9b)}},y9b=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,z9b="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",A9b={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},B9b=class extends pJ{constructor(C9b,D9b,E9b,F9b,G9b=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:L.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Eoa(null),depthBuffer:new Eoa(null),resolution:new Eoa(new Eb),texelSize:new Eoa(new Eb),cameraNear:new Eoa(.3),cameraFar:new Eoa(1e3),aspect:new Eoa(1),time:new Eoa(0)},blending:S,depthWrite:!1,depthTest:!1,dithering:G9b}),this.toneMapped=!1,C9b&&this.setShaderParts(C9b),D9b&&this.setDefines(D9b),E9b&&this.setUniforms(E9b),this.adoptCameraSettings(F9b)}set inputBuffer(H9b){this.uniforms.inputBuffer.value=H9b}setInputBuffer(I9b){this.uniforms.inputBuffer.value=I9b}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(J9b){this.uniforms.depthBuffer.value=J9b}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(K9b){this.defines.DEPTH_PACKING=K9b.toFixed(0),this.needsUpdate=!0}setDepthBuffer(L9b,M9b=Ua){this.depthBuffer=L9b,this.depthPacking=M9b}setShaderParts(N9b){return this.fragmentShader=y9b.replace(A9b.FRAGMENT_HEAD,N9b.get(A9b.FRAGMENT_HEAD)).replace(A9b.FRAGMENT_MAIN_UV,N9b.get(A9b.FRAGMENT_MAIN_UV)).replace(A9b.FRAGMENT_MAIN_IMAGE,N9b.get(A9b.FRAGMENT_MAIN_IMAGE)),this.vertexShader=z9b.replace(A9b.VERTEX_HEAD,N9b.get(A9b.VERTEX_HEAD)).replace(A9b.VERTEX_MAIN_SUPPORT,N9b.get(A9b.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(O9b){for(let P9b of O9b.entries())this.defines[P9b[0]]=P9b[1];return this.needsUpdate=!0,this}setUniforms(Q9b){for(let R9b of Q9b.entries())this.uniforms[R9b[0]]=R9b[1];return this}setExtensions(S9b){for(let T9b of(this.extensions={},S9b))this.extensions[T9b]=!0;return this}get encodeOutput(){return void 0!==this.defines.ENCODE_OUTPUT}set encodeOutput(U9b){this.encodeOutput!==U9b&&(U9b?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(V9b){return this.encodeOutput}setOutputEncodingEnabled(W9b){this.encodeOutput=W9b}get time(){return this.uniforms.time.value}set time(X9b){this.uniforms.time.value=X9b}setDeltaTime(Y9b){this.uniforms.time.value+=Y9b}adoptCameraSettings(Z9b){Z9b&&(this.uniforms.cameraNear.value=Z9b.near,this.uniforms.cameraFar.value=Z9b.far,Z9b instanceof GJ?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize($9b,_9b){let aac=this.uniforms;aac.resolution.value.set($9b,_9b),aac.texelSize.value.set(1/$9b,1/_9b),aac.aspect.value=$9b/_9b}static get Section(){return A9b}},bac=class extends pJ{constructor(cac=!1,dac=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:L.replace(/\D+/g,"")},uniforms:{inputBuffer:new Eoa(null),threshold:new Eoa(0),smoothing:new Eoa(1),range:new Eoa(null)},blending:S,depthWrite:!1,depthTest:!1,fragmentShader:`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,vertexShader:M7b}),this.toneMapped=!1,this.colorOutput=cac,this.luminanceRange=dac}set inputBuffer(eac){this.uniforms.inputBuffer.value=eac}setInputBuffer(fac){this.uniforms.inputBuffer.value=fac}get threshold(){return this.uniforms.threshold.value}set threshold(gac){this.smoothing>0||gac>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=gac}getThreshold(){return this.threshold}setThreshold(hac){this.threshold=hac}get smoothing(){return this.uniforms.smoothing.value}set smoothing(iac){this.threshold>0||iac>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=iac}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(jac){this.smoothing=jac}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(kac){}get colorOutput(){return void 0!==this.defines.COLOR}set colorOutput(lac){lac?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(mac){return this.colorOutput}setColorOutputEnabled(nac){this.colorOutput=nac}get useRange(){return null!==this.luminanceRange}set useRange(oac){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(pac){null!==pac?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=pac,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(qac){this.luminanceRange=qac}},rac=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,sac={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},tac=class extends pJ{constructor(uac=null){super({name:"MaskMaterial",uniforms:{maskTexture:new Eoa(uac),inputBuffer:new Eoa(null),strength:new Eoa(1)},blending:S,depthWrite:!1,depthTest:!1,fragmentShader:rac,vertexShader:M7b}),this.toneMapped=!1,this.setColorChannel(L7b.RED),this.setMaskFunction(sac.DISCARD)}set inputBuffer(vac){this.uniforms.inputBuffer.value=vac}setInputBuffer(wac){this.uniforms.inputBuffer.value=wac}set maskTexture(xac){this.uniforms.maskTexture.value=xac,delete this.defines.MASK_PRECISION_HIGH,xac.type!==ya&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(yac){this.maskTexture=yac}set colorChannel(zac){this.defines.COLOR_CHANNEL=zac.toFixed(0),this.needsUpdate=!0}setColorChannel(Aac){this.colorChannel=Aac}set maskFunction(Bac){this.defines.MASK_FUNCTION=Bac.toFixed(0),this.needsUpdate=!0}setMaskFunction(Cac){this.maskFunction=Cac}get inverted(){return void 0!==this.defines.INVERTED}set inverted(Dac){this.inverted&&!Dac?delete this.defines.INVERTED:Dac&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(Eac){this.inverted=Eac}get strength(){return this.uniforms.strength.value}set strength(Fac){this.uniforms.strength.value=Fac}getStrength(){return this.strength}setStrength(Gac){this.strength=Gac}},Hac=class extends pJ{constructor(Iac=new Eb,Jac=new Eb){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Eoa(null),searchTexture:new Eoa(null),areaTexture:new Eoa(null),resolution:new Eoa(Jac),texelSize:new Eoa(Iac)},blending:S,depthWrite:!1,depthTest:!1,fragmentShader:`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,vertexShader:"uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1}set inputBuffer(Kac){this.uniforms.inputBuffer.value=Kac}setInputBuffer(Lac){this.uniforms.inputBuffer.value=Lac}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(Mac){this.uniforms.searchTexture.value=Mac}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(Nac){this.uniforms.areaTexture.value=Nac}setLookupTextures(Oac,Pac){this.searchTexture=Oac,this.areaTexture=Pac}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(Qac){let Rac=Math.min(Math.max(Qac,0),112);this.defines.MAX_SEARCH_STEPS_INT=Rac.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=Rac.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(Sac){this.orthogonalSearchSteps=Sac}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(Tac){let Uac=Math.min(Math.max(Tac,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=Uac.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=Uac.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(Vac){this.diagonalSearchSteps=Vac}get diagonalDetection(){return void 0===this.defines.DISABLE_DIAG_DETECTION}set diagonalDetection(Wac){Wac?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(Xac){this.diagonalDetection=Xac}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(Yac){let Zac=Math.min(Math.max(Yac,0),100);this.defines.CORNER_ROUNDING=Zac.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(Zac/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding($ac){this.cornerRounding=$ac}get cornerDetection(){return void 0===this.defines.DISABLE_CORNER_DETECTION}set cornerDetection(_ac){_ac?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(abc){this.cornerDetection=abc}setSize(bbc,cbc){let dbc=this.uniforms;dbc.texelSize.value.set(1/bbc,1/cbc),dbc.resolution.value.set(bbc,cbc)}},ebc=new yJ,fbc=null,gbc=class{constructor(hbc="Pass",ibc=new zV,jbc=ebc){this.name=hbc,this.renderer=null,this.scene=ibc,this.camera=jbc,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(kbc){if(this.rtt===kbc){let lbc=this.getFullscreenMaterial();null!==lbc&&(lbc.needsUpdate=!0),this.rtt=!kbc}}setRenderer(mbc){this.renderer=mbc}isEnabled(){return this.enabled}setEnabled(nbc){this.enabled=nbc}get fullscreenMaterial(){return null!==this.screen?this.screen.material:null}set fullscreenMaterial(obc){let pbc=this.screen;null!==pbc?pbc.material=obc:((pbc=new GH(function(){if(null===fbc){let a=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),b=new Float32Array([0,0,2,0,0,2]);void 0!==(fbc=new nE).setAttribute?(fbc.setAttribute("position",new RC(a,3)),fbc.setAttribute("uv",new RC(b,2))):(fbc.addAttribute("position",new RC(a,3)),fbc.addAttribute("uv",new RC(b,2)))}return fbc}(),obc)).frustumCulled=!1,null===this.scene&&(this.scene=new zV),this.scene.add(pbc),this.screen=pbc)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(qbc){this.fullscreenMaterial=qbc}getDepthTexture(){return null}setDepthTexture(rbc,sbc=Ua){}render(tbc,ubc,vbc,wbc,xbc){throw new Error("Render method not implemented!")}setSize(ybc,zbc){}initialize(Abc,Bbc,Cbc){}dispose(){for(let Dbc of Object.keys(this)){let Ebc=this[Dbc];if(null!==Ebc&&"function"==typeof Ebc.dispose){if(Ebc instanceof zV||Ebc===this.renderer)continue;this[Dbc].dispose()}}}},Fbc=class extends gbc{constructor(Gbc,Hbc=!0){super("CopyPass"),this.fullscreenMaterial=new S8b,this.needsSwap=!1,this.renderTarget=Gbc,void 0===Gbc&&(this.renderTarget=new Yi(1,1,{minFilter:va,magFilter:va,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=Hbc}get resize(){return this.autoResize}set resize(Ibc){this.autoResize=Ibc}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(Jbc){this.autoResize=Jbc}render(Kbc,Lbc,Mbc,Nbc,Obc){this.fullscreenMaterial.inputBuffer=Lbc.texture,Kbc.setRenderTarget(this.renderToScreen?null:this.renderTarget),Kbc.render(this.scene,this.camera)}setSize(Pbc,Qbc){this.autoResize&&this.renderTarget.setSize(Pbc,Qbc)}initialize(Rbc,Sbc,Tbc){void 0!==Tbc&&(this.renderTarget.texture.type=Tbc,Tbc!==ya?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":Rbc.outputEncoding===Ta&&(this.renderTarget.texture.encoding=Ta))}},Ubc=class extends gbc{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(Vbc,Wbc,Xbc,Ybc,Zbc){let $bc=Vbc.state.buffers.stencil;$bc.setLocked(!1),$bc.setTest(!1)}},_bc=new df,acc=class extends gbc{constructor(bcc=!0,ccc=!0,dcc=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=bcc,this.depth=ccc,this.stencil=dcc,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(ecc,fcc,gcc){this.color=ecc,this.depth=fcc,this.stencil=gcc}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(hcc){this.overrideClearColor=hcc}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(icc){this.overrideClearAlpha=icc}render(jcc,kcc,lcc,mcc,ncc){let occ=this.overrideClearColor,pcc=this.overrideClearAlpha,qcc=jcc.getClearAlpha(),rcc=null!==occ,scc=pcc>=0;rcc?(_bc.copy(jcc.getClearColor(_bc)),jcc.setClearColor(occ,scc?pcc:qcc)):scc&&jcc.setClearAlpha(pcc),jcc.setRenderTarget(this.renderToScreen?null:kcc),jcc.clear(this.color,this.depth,this.stencil),rcc?jcc.setClearColor(_bc,qcc):scc&&jcc.setClearAlpha(qcc)}},tcc=-1,ucc=class extends ab{constructor(vcc,wcc=tcc,xcc=tcc,ycc=1){super(),this.resizable=vcc,this.base=new Eb(1,1),this.preferred=new Eb(wcc,xcc),this.target=this.preferred,this.s=ycc}get width(){let{base:zcc,preferred:Acc,scale:Bcc}=this;return Acc.width!==tcc?Acc.width:Acc.height!==tcc?Math.round(Acc.height*(zcc.width/Math.max(zcc.height,1))):Math.round(zcc.width*Bcc)}set width(Ccc){this.preferredWidth=Ccc}get height(){let{base:Dcc,preferred:Ecc,scale:Fcc}=this;return Ecc.height!==tcc?Ecc.height:Ecc.width!==tcc?Math.round(Ecc.width/Math.max(Dcc.width/Math.max(Dcc.height,1),1)):Math.round(Dcc.height*Fcc)}set height(Gcc){this.preferredHeight=Gcc}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(Hcc){this.s!==Hcc&&(this.s=Hcc,this.preferred.setScalar(tcc),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(Icc){this.scale=Icc}get baseWidth(){return this.base.width}set baseWidth(Jcc){this.base.width!==Jcc&&(this.base.width=Jcc,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(Kcc){this.base.width!==Kcc&&(this.base.width=Kcc,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(Lcc){this.base.height!==Lcc&&(this.base.height=Lcc,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(Mcc){this.baseHeight=Mcc}setBaseSize(Ncc,Occ){(this.base.width!==Ncc||this.base.height!==Occ)&&(this.base.set(Ncc,Occ),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(Pcc){this.preferred.width!==Pcc&&(this.preferred.width=Pcc,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(Qcc){this.preferredWidth=Qcc}get preferredHeight(){return this.preferred.height}set preferredHeight(Rcc){this.preferred.height!==Rcc&&(this.preferred.height=Rcc,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(Scc){this.preferredHeight=Scc}setPreferredSize(Tcc,Ucc){(this.preferred.width!==Tcc||this.preferred.height!==Ucc)&&(this.preferred.set(Tcc,Ucc),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(Vcc){this.base.set(Vcc.getBaseWidth(),Vcc.getBaseHeight()),this.preferred.set(Vcc.getPreferredWidth(),Vcc.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return tcc}},Wcc=!1,Xcc=class{constructor(Ycc=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(Ycc),this.meshCount=0,this.replaceMaterial=a=>{if(a.isMesh){let b;if(a.material.flatShading)switch(a.material.side){case R:b=this.materialsFlatShadedDoubleSide;break;case Q:b=this.materialsFlatShadedBackSide;break;default:b=this.materialsFlatShaded;break}else switch(a.material.side){case R:b=this.materialsDoubleSide;break;case Q:b=this.materialsBackSide;break;default:b=this.materials;break}this.originalMaterials.set(a,a.material),a.isSkinnedMesh?a.material=b[2]:a.isInstancedMesh?a.material=b[1]:a.material=b[0],++this.meshCount}}}setMaterial(Zcc){if(this.disposeMaterials(),this.material=Zcc,null!==Zcc){let $cc=this.materials=[Zcc.clone(),Zcc.clone(),Zcc.clone()];for(let _cc of $cc)_cc.uniforms=Object.assign({},Zcc.uniforms),_cc.side=P;$cc[2].skinning=!0,this.materialsBackSide=$cc.map(a=>{let b=a.clone();return b.uniforms=Object.assign({},Zcc.uniforms),b.side=Q,b}),this.materialsDoubleSide=$cc.map(a=>{let b=a.clone();return b.uniforms=Object.assign({},Zcc.uniforms),b.side=R,b}),this.materialsFlatShaded=$cc.map(a=>{let b=a.clone();return b.uniforms=Object.assign({},Zcc.uniforms),b.flatShading=!0,b}),this.materialsFlatShadedBackSide=$cc.map(a=>{let b=a.clone();return b.uniforms=Object.assign({},Zcc.uniforms),b.flatShading=!0,b.side=Q,b}),this.materialsFlatShadedDoubleSide=$cc.map(a=>{let b=a.clone();return b.uniforms=Object.assign({},Zcc.uniforms),b.flatShading=!0,b.side=R,b})}}render(adc,bdc,cdc){let ddc=adc.shadowMap.enabled;if(adc.shadowMap.enabled=!1,Wcc){let edc=this.originalMaterials;for(let fdc of(this.meshCount=0,bdc.traverse(this.replaceMaterial),adc.render(bdc,cdc),edc))fdc[0].material=fdc[1];this.meshCount!==edc.size&&edc.clear()}else{let gdc=bdc.overrideMaterial;bdc.overrideMaterial=this.material,adc.render(bdc,cdc),bdc.overrideMaterial=gdc}adc.shadowMap.enabled=ddc}disposeMaterials(){if(null!==this.material){let hdc=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let idc of hdc)idc.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Wcc}static set workaroundEnabled(jdc){Wcc=jdc}},kdc=class extends gbc{constructor(ldc,mdc,ndc=null){super("RenderPass",ldc,mdc),this.needsSwap=!1,this.clearPass=new acc,this.overrideMaterialManager=null===ndc?null:new Xcc(ndc),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(odc){super.renderToScreen=odc,this.clearPass.renderToScreen=odc}get overrideMaterial(){let pdc=this.overrideMaterialManager;return null!==pdc?pdc.material:null}set overrideMaterial(qdc){let rdc=this.overrideMaterialManager;null!==qdc?null!==rdc?rdc.setMaterial(qdc):this.overrideMaterialManager=new Xcc(qdc):null!==rdc&&(rdc.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(sdc){this.overrideMaterial=sdc}get clear(){return this.clearPass.enabled}set clear(tdc){this.clearPass.enabled=tdc}getSelection(){return this.selection}setSelection(udc){this.selection=udc}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(vdc){this.ignoreBackground=vdc}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(wdc){this.skipShadowMapUpdate=wdc}getClearPass(){return this.clearPass}render(xdc,ydc,zdc,Adc,Bdc){let Cdc=this.scene,Ddc=this.camera,Edc=this.selection,Fdc=Ddc.layers.mask,Gdc=Cdc.background,Hdc=xdc.shadowMap.autoUpdate,Idc=this.renderToScreen?null:ydc;null!==Edc&&Ddc.layers.set(Edc.getLayer()),this.skipShadowMapUpdate&&(xdc.shadowMap.autoUpdate=!1),(this.ignoreBackground||null!==this.clearPass.overrideClearColor)&&(Cdc.background=null),this.clearPass.enabled&&this.clearPass.render(xdc,ydc),xdc.setRenderTarget(Idc),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(xdc,Cdc,Ddc):xdc.render(Cdc,Ddc),Ddc.layers.mask=Fdc,Cdc.background=Gdc,xdc.shadowMap.autoUpdate=Hdc}},Jdc=class extends gbc{constructor(Kdc,Ldc,{resolutionScale:Mdc=1,width:Ndc=ucc.AUTO_SIZE,height:Odc=ucc.AUTO_SIZE,renderTarget:Pdc}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new kdc(Kdc,Ldc,new LT({depthPacking:Va}));let Qdc=this.renderPass;Qdc.skipShadowMapUpdate=!0,Qdc.ignoreBackground=!0;let Rdc=Qdc.getClearPass();Rdc.overrideClearColor=new df(16777215),Rdc.overrideClearAlpha=1,this.renderTarget=Pdc,void 0===this.renderTarget&&(this.renderTarget=new Yi(1,1,{minFilter:sa,magFilter:sa,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let Sdc=this.resolution=new ucc(this,Ndc,Odc,Mdc);Sdc.addEventListener("change",a=>this.setSize(Sdc.baseWidth,Sdc.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(Tdc){this.resolution.scale=Tdc}render(Udc,Vdc,Wdc,Xdc,Ydc){let Zdc=this.renderToScreen?null:this.renderTarget;this.renderPass.render(Udc,Zdc)}setSize($dc,_dc){let aec=this.resolution;aec.setBaseSize($dc,_dc),this.renderTarget.setSize(aec.width,aec.height)}};new Float32Array([255/256/16777216,255/256/65536,255/256/256,255/256]);var bec={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},cec="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",dec="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",eec="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",fec="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",gec="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",hec="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",iec="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",jec="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",kec="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",lec="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",mec="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",nec="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",oec="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",pec="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",qec="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",rec="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",sec="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",tec="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",uec=new Map([[bec.SKIP,null],[bec.ADD,cec],[bec.ALPHA,dec],[bec.AVERAGE,eec],[bec.COLOR_BURN,fec],[bec.COLOR_DODGE,gec],[bec.DARKEN,hec],[bec.DIFFERENCE,iec],[bec.EXCLUSION,jec],[bec.LIGHTEN,kec],[bec.MULTIPLY,lec],[bec.DIVIDE,mec],[bec.NEGATION,nec],[bec.NORMAL,oec],[bec.OVERLAY,pec],[bec.REFLECT,qec],[bec.SCREEN,rec],[bec.SOFT_LIGHT,sec],[bec.SUBTRACT,tec]]),vec=class extends ab{constructor(wec,xec=1){super(),this.f=wec,this.opacity=new Eoa(xec)}getOpacity(){return this.opacity.value}setOpacity(yec){this.opacity.value=yec}get blendFunction(){return this.f}set blendFunction(zec){this.f=zec,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(Aec){this.blendFunction=Aec}getShaderCode(){return uec.get(this.blendFunction)}},Bec={NONE:0,DEPTH:1,CONVOLUTION:2},Cec=class extends ab{constructor(Dec,Eec,{attributes:Fec=Bec.NONE,blendFunction:Gec=bec.SCREEN,defines:Hec=new Map,uniforms:Iec=new Map,extensions:Jec=null,vertexShader:Kec=null}={}){super(),this.name=Dec,this.renderer=null,this.attributes=Fec,this.fragmentShader=Eec,this.vertexShader=Kec,this.defines=Hec,this.uniforms=Iec,this.extensions=Jec,this.blendMode=new vec(Gec),this.blendMode.addEventListener("change",a=>this.setChanged())}getName(){return this.name}setRenderer(Lec){this.renderer=Lec}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(Mec){this.attributes=Mec,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(Nec){this.fragmentShader=Nec,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(Oec){this.vertexShader=Oec,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(Pec,Qec=Ua){}update(Rec,Sec,Tec){}setSize(Uec,Vec){}initialize(Wec,Xec,Yec){}dispose(){for(let Zec of Object.keys(this)){let $ec=this[Zec];if(null!==$ec&&"function"==typeof $ec.dispose){if($ec instanceof zV||$ec===this.renderer)continue;this[Zec].dispose()}}}};function _ec(a,b,c){for(let d of b){let e="$1"+a+d.charAt(0).toUpperCase()+d.slice(1),f=new RegExp("([^\\.])(\\b"+d+"\\b)","g");for(let g of c.entries())null!==g[1]&&c.set(g[0],g[1].replace(f,e))}}function afc(a,b,c,d,e,f,g){let h=new Map([["fragment",b.getFragmentShader()],["vertex",b.getVertexShader()]]),i=void 0!==h.get("fragment")&&/mainImage/.test(h.get("fragment")),j=void 0!==h.get("fragment")&&/mainUv/.test(h.get("fragment")),k=[],l=[],m=!1,n=!1;if(void 0===h.get("fragment"))console.error("Missing fragment shader",b);else if(j&&(g&Bec.CONVOLUTION)!=0)console.error("Effects that transform UV coordinates are incompatible with convolution effects",b);else if(i||j){let o=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,p=B9b.Section;if(j){let q=`	${a}MainUv(UV);
`;c.set(p.FRAGMENT_MAIN_UV,c.get(p.FRAGMENT_MAIN_UV)+q),m=!0}if(null!==h.get("vertex")&&/mainSupport/.test(h.get("vertex"))){let r=`	${a}MainSupport(`;r+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(h.get("vertex"))?`vUv);
`:`);
`,c.set(p.VERTEX_MAIN_SUPPORT,c.get(p.VERTEX_MAIN_SUPPORT)+r),k=k.concat([...h.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(a=>a[1])),l=l.concat(k).concat([...h.get("vertex").matchAll(o)].map(a=>a[1]))}l=(l=(l=l.concat([...h.get("fragment").matchAll(o)].map(a=>a[1]))).concat([...b.defines.keys()].map(a=>a.replace(/\([\w\s,]*\)/g,"")))).concat([...b.uniforms.keys()]),b.uniforms.forEach((b,c)=>f.set(a+c.charAt(0).toUpperCase()+c.slice(1),b)),b.defines.forEach((b,c)=>e.set(a+c.charAt(0).toUpperCase()+c.slice(1),b)),_ec(a,l,e),_ec(a,l,h);let s=b.blendMode;if(d.set(s.blendFunction,s),i){let t=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,u=`${a}MainImage(color0, UV, `;(g&Bec.DEPTH)!=0&&t.test(h.get("fragment"))&&(u+="depth, ",n=!0),u+=`color1);
	`;let v=a+"BlendOpacity";f.set(v,s.opacity),u+=`color0 = blend${s.blendFunction}(color0, color1, ${v});

	`,c.set(p.FRAGMENT_MAIN_IMAGE,c.get(p.FRAGMENT_MAIN_IMAGE)+u),u=`uniform float ${v};

`,c.set(p.FRAGMENT_HEAD,c.get(p.FRAGMENT_HEAD)+u)}c.set(p.FRAGMENT_HEAD,c.get(p.FRAGMENT_HEAD)+h.get("fragment")+`
`),null!==h.get("vertex")&&c.set(p.VERTEX_HEAD,c.get(p.VERTEX_HEAD)+h.get("vertex")+`
`)}else console.error("The fragment shader contains neither a mainImage nor a mainUv function",b);return{varyings:k,transformedUv:m,readDepth:n}}var bfc=class extends gbc{constructor(cfc,...dfc){super("EffectPass"),this.fullscreenMaterial=new B9b(null,null,null,cfc),this.effects=dfc.sort((a,b)=>b.attributes-a.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(efc){this.fullscreenMaterial.encodeOutput=efc}get dithering(){return this.fullscreenMaterial.dithering}set dithering(ffc){let gfc=this.fullscreenMaterial;gfc.dithering=ffc,gfc.needsUpdate=!0}verifyResources(){let hfc=this.renderer.capabilities,ifc=Math.min(hfc.maxFragmentUniforms,hfc.maxVertexUniforms);this.uniformCount>ifc&&console.warn("The current rendering context doesn't support more than "+ifc+" uniforms, but "+this.uniformCount+" were defined"),ifc=hfc.maxVaryings,this.varyingCount>ifc&&console.warn("The current rendering context doesn't support more than "+ifc+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let jfc=B9b.Section,kfc=new Map([[jfc.FRAGMENT_HEAD,""],[jfc.FRAGMENT_MAIN_UV,""],[jfc.FRAGMENT_MAIN_IMAGE,""],[jfc.VERTEX_HEAD,""],[jfc.VERTEX_MAIN_SUPPORT,""]]),lfc=new Map,mfc=new Map,nfc=new Map,ofc=new Set,pfc=0,qfc=0,rfc=0,sfc=!1,tfc=!1;for(let ufc of this.effects)if(ufc.blendMode.blendFunction===bec.SKIP)rfc|=ufc.getAttributes()&Bec.DEPTH;else if((rfc&ufc.getAttributes()&Bec.CONVOLUTION)!=0)console.error("Convolution effects cannot be merged",ufc);else{rfc|=ufc.getAttributes();let vfc=afc("e"+pfc++,ufc,kfc,lfc,mfc,nfc,rfc);if(qfc+=vfc.varyings.length,sfc=sfc||vfc.transformedUv,tfc=tfc||vfc.readDepth,null!==ufc.extensions)for(let wfc of ufc.extensions)ofc.add(wfc)}let xfc=/\bblend\b/g;for(let yfc of lfc.values()){let zfc=yfc.getShaderCode().replace(xfc,`blend${yfc.blendFunction}`);kfc.set(jfc.FRAGMENT_HEAD,kfc.get(jfc.FRAGMENT_HEAD)+zfc+`
`)}if((rfc&Bec.DEPTH)!=0){if(tfc){let Afc=`float depth = readDepth(UV);

	`;kfc.set(jfc.FRAGMENT_MAIN_IMAGE,Afc+kfc.get(jfc.FRAGMENT_MAIN_IMAGE))}this.needsDepthTexture=null===this.getDepthTexture()}else this.needsDepthTexture=!1;if(sfc){let Bfc=`vec2 transformedUv = vUv;
`;kfc.set(jfc.FRAGMENT_MAIN_UV,Bfc+kfc.get(jfc.FRAGMENT_MAIN_UV)),mfc.set("UV","transformedUv")}else mfc.set("UV","vUv");kfc.forEach((a,b,c)=>c.set(b,a.trim().replace(/^#/,`
#`))),this.uniformCount=nfc.size,this.varyingCount=qfc,this.skipRendering=0===pfc,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(kfc).setExtensions(ofc).setUniforms(nfc).setDefines(mfc)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(Cfc,Dfc=Ua){for(let Efc of(this.fullscreenMaterial.depthBuffer=Cfc,this.fullscreenMaterial.depthPacking=Dfc,this.effects))Efc.setDepthTexture(Cfc,Dfc)}render(Ffc,Gfc,Hfc,Ifc,Jfc){for(let Kfc of this.effects)Kfc.update(Ffc,Gfc,Ifc);if(!this.skipRendering||this.renderToScreen){let Lfc=this.fullscreenMaterial;Lfc.inputBuffer=Gfc.texture,Lfc.time+=Ifc,Ffc.setRenderTarget(this.renderToScreen?null:Hfc),Ffc.render(this.scene,this.camera)}}setSize(Mfc,Nfc){for(let Ofc of(this.fullscreenMaterial.setSize(Mfc,Nfc),this.effects))Ofc.setSize(Mfc,Nfc)}initialize(Pfc,Qfc,Rfc){for(let Sfc of(this.renderer=Pfc,this.effects))Sfc.initialize(Pfc,Qfc,Rfc),Sfc.addEventListener("change",a=>this.handleEvent(a));this.updateMaterial(),this.verifyResources(),void 0!==Rfc&&Rfc!==ya&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){for(let Tfc of(super.dispose(),this.effects))Tfc.dispose()}handleEvent(Ufc){switch(Ufc.type){case"change":this.recompile();break}}},Vfc=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Wfc=class extends gbc{constructor({resolutionScale:Xfc=.5,width:Yfc=ucc.AUTO_SIZE,height:Zfc=ucc.AUTO_SIZE,kernelSize:$fc=Ihc.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Yi(1,1,{minFilter:va,magFilter:va,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let _fc=this.resolution=new ucc(this,Yfc,Zfc,Xfc);_fc.addEventListener("change",a=>this.setSize(_fc.baseWidth,_fc.baseHeight)),this.blurMaterial=new F8b,this.ditheredBlurMaterial=new F8b,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=$fc}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(agc){this.resolution.preferredWidth=agc}get height(){return this.resolution.height}set height(bgc){this.resolution.preferredHeight=bgc}get scale(){return this.blurMaterial.scale}set scale(cgc){this.blurMaterial.scale=cgc}getScale(){return this.blurMaterial.scale}setScale(dgc){this.blurMaterial.scale=dgc}getKernelSize(){return this.kernelSize}setKernelSize(egc){this.kernelSize=egc}getResolutionScale(){return this.resolution.scale}setResolutionScale(fgc){this.resolution.scale=fgc}render(ggc,hgc,igc,jgc,kgc){let lgc=this.scene,mgc=this.camera,ngc=this.renderTargetA,ogc=this.renderTargetB,pgc=Vfc[this.kernelSize],qgc=this.blurMaterial,rgc=hgc,sgc,tgc;for(this.fullscreenMaterial=qgc,sgc=0,tgc=pgc.length-1;sgc<tgc;++sgc){let ugc=(1&sgc)==0?ngc:ogc;qgc.kernel=pgc[sgc],qgc.inputBuffer=rgc.texture,ggc.setRenderTarget(ugc),ggc.render(lgc,mgc),rgc=ugc}this.dithering&&(qgc=this.ditheredBlurMaterial,this.fullscreenMaterial=qgc),qgc.kernel=pgc[sgc],qgc.inputBuffer=rgc.texture,ggc.setRenderTarget(this.renderToScreen?null:igc),ggc.render(lgc,mgc)}setSize(vgc,wgc){let xgc=this.resolution;xgc.setBaseSize(vgc,wgc);let ygc=xgc.width,zgc=xgc.height;this.renderTargetA.setSize(ygc,zgc),this.renderTargetB.setSize(ygc,zgc),this.blurMaterial.setSize(ygc,zgc),this.ditheredBlurMaterial.setSize(ygc,zgc)}initialize(Agc,Bgc,Cgc){void 0!==Cgc&&(this.renderTargetA.texture.type=Cgc,this.renderTargetB.texture.type=Cgc,Cgc!==ya?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):Agc.outputEncoding===Ta&&(this.renderTargetA.texture.encoding=Ta,this.renderTargetB.texture.encoding=Ta))}static get AUTO_SIZE(){return ucc.AUTO_SIZE}},Dgc=class extends gbc{constructor({width:Egc=ucc.AUTO_SIZE,height:Fgc=ucc.AUTO_SIZE,renderTarget:Ggc,luminanceRange:Hgc,colorOutput:Igc}={}){super("LuminancePass"),this.fullscreenMaterial=new bac(Igc,Hgc),this.needsSwap=!1,this.renderTarget=Ggc,void 0===this.renderTarget&&(this.renderTarget=new Yi(1,1,{minFilter:va,magFilter:va,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let Jgc=this.resolution=new ucc(this,Egc,Fgc);Jgc.addEventListener("change",a=>this.setSize(Jgc.baseWidth,Jgc.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(Kgc,Lgc,Mgc,Ngc,Ogc){this.fullscreenMaterial.inputBuffer=Lgc.texture,Kgc.setRenderTarget(this.renderToScreen?null:this.renderTarget),Kgc.render(this.scene,this.camera)}setSize(Pgc,Qgc){let Rgc=this.resolution;Rgc.setBaseSize(Pgc,Qgc),this.renderTarget.setSize(Rgc.width,Rgc.height)}initialize(Sgc,Tgc,Ugc){void 0!==Ugc&&Ugc!==ya&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Vgc=class extends gbc{constructor(Wgc,Xgc){super("MaskPass",Wgc,Xgc),this.needsSwap=!1,this.clearPass=new acc(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(Ygc){this.inverse=Ygc}get clear(){return this.clearPass.enabled}set clear(Zgc){this.clearPass.enabled=Zgc}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted($gc){this.inverted=$gc}render(_gc,ahc,bhc,chc,dhc){let ehc=_gc.getContext(),fhc=_gc.state.buffers,ghc=this.scene,hhc=this.camera,ihc=this.clearPass,jhc=this.inverted?0:1,khc=1-jhc;fhc.color.setMask(!1),fhc.depth.setMask(!1),fhc.color.setLocked(!0),fhc.depth.setLocked(!0),fhc.stencil.setTest(!0),fhc.stencil.setOp(ehc.REPLACE,ehc.REPLACE,ehc.REPLACE),fhc.stencil.setFunc(ehc.ALWAYS,jhc,4294967295),fhc.stencil.setClear(khc),fhc.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?ihc.render(_gc,null):(ihc.render(_gc,ahc),ihc.render(_gc,bhc))),this.renderToScreen?(_gc.setRenderTarget(null),_gc.render(ghc,hhc)):(_gc.setRenderTarget(ahc),_gc.render(ghc,hhc),_gc.setRenderTarget(bhc),_gc.render(ghc,hhc)),fhc.color.setLocked(!1),fhc.depth.setLocked(!1),fhc.stencil.setLocked(!1),fhc.stencil.setFunc(ehc.EQUAL,1,4294967295),fhc.stencil.setOp(ehc.KEEP,ehc.KEEP,ehc.KEEP),fhc.stencil.setLocked(!0)}},lhc=class extends gbc{constructor(mhc,nhc="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=mhc,this.inputBufferUniform=null,this.setInput(nhc)}setInput(ohc){if(this.inputBufferUniform=null,null!==this.fullscreenMaterial){let phc=this.fullscreenMaterial.uniforms;void 0!==phc&& void 0!==phc[ohc]&&(this.inputBufferUniform=phc[ohc])}}render(qhc,rhc,shc,thc,uhc){null!==this.inputBufferUniform&&null!==rhc&&(this.inputBufferUniform.value=rhc.texture),qhc.setRenderTarget(this.renderToScreen?null:shc),qhc.render(this.scene,this.camera)}initialize(vhc,whc,xhc){void 0!==xhc&&xhc!==ya&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},yhc=.001,zhc=1e3,Ahc=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(Bhc){return this.fixedDeltaEnabled=Bhc,this}isAutoResetEnabled(Chc){return this.autoReset}setAutoResetEnabled(Dhc){return"u">typeof document&& void 0!==document.hidden&&(Dhc?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=Dhc),this}getDelta(){return this.delta*yhc}getFixedDelta(){return this.fixedDelta*yhc}setFixedDelta(Ehc){return this.fixedDelta=Ehc*zhc,this}getElapsed(){return this.elapsed*yhc}getTimescale(){return this.timescale}setTimescale(Fhc){return this.timescale=Fhc,this}update(Ghc){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=void 0!==Ghc?Ghc:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(Hhc){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},Ihc={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},Jhc=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,Khc=class extends Cec{constructor({blendFunction:Lhc=bec.SCREEN,luminanceThreshold:Mhc=.9,luminanceSmoothing:Nhc=.025,resolutionScale:Ohc=.5,intensity:Phc=1,width:Qhc=ucc.AUTO_SIZE,height:Rhc=ucc.AUTO_SIZE,kernelSize:Shc=Ihc.LARGE}={}){super("BloomEffect",Jhc,{blendFunction:Lhc,uniforms:new Map([["map",new Eoa(null)],["intensity",new Eoa(Phc)]])}),this.renderTarget=new Yi(1,1,{minFilter:va,magFilter:va,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new Dgc({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=Mhc,this.luminanceMaterial.smoothingFactor=Nhc,this.blurPass=new Wfc({resolutionScale:Ohc,width:Qhc,height:Rhc,kernelSize:Shc});let Thc=this.blurPass.getResolution();Thc.addEventListener("change",a=>this.setSize(Thc.baseWidth,Thc.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(Uhc){this.resolution.preferredWidth=Uhc}get height(){return this.resolution.height}set height(Vhc){this.resolution.preferredHeight=Vhc}get dithering(){return this.blurPass.dithering}set dithering(Whc){this.blurPass.dithering=Whc}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(Xhc){this.blurPass.kernelSize=Xhc}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(Yhc){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(Zhc){this.uniforms.get("intensity").value=Zhc}getIntensity(){return this.intensity}setIntensity($hc){this.intensity=$hc}getResolutionScale(){return this.resolution.scale}setResolutionScale(_hc){this.resolution.scale=_hc}update(aic,bic,cic){let dic=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(aic,bic,dic),this.blurPass.render(aic,dic,dic)):this.blurPass.render(aic,bic,dic)}setSize(eic,fic){let gic=this.resolution;gic.setBaseSize(eic,fic),this.renderTarget.setSize(gic.width,gic.height),this.luminancePass.resolution.copy(gic)}initialize(hic,iic,jic){this.blurPass.initialize(hic,iic,jic),void 0!==jic&&(this.renderTarget.texture.type=jic,hic.outputEncoding===Ta&&(this.renderTarget.texture.encoding=Ta))}},kic="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",lic=class extends Cec{constructor({blendFunction:mic=bec.NORMAL,brightness:nic=0,contrast:oic=0}={}){super("BrightnessContrastEffect",kic,{blendFunction:mic,uniforms:new Map([["brightness",new Eoa(nic)],["contrast",new Eoa(oic)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(pic){this.uniforms.get("brightness").value=pic}getBrightness(qic){return this.brightness}setBrightness(ric){this.brightness=ric}get contrast(){return this.uniforms.get("contrast").value}set contrast(sic){this.uniforms.get("contrast").value=sic}getContrast(tic){return this.contrast}setContrast(uic){this.contrast=uic}},vic="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",wic=class extends Cec{constructor(xic=bec.NORMAL){super("ColorAverageEffect",vic,{blendFunction:xic})}},yic="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",zic="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",Aic=class extends Cec{constructor({blendFunction:Bic=bec.NORMAL,offset:Cic=new Eb(.001,5e-4)}={}){super("ChromaticAberrationEffect",yic,{vertexShader:zic,blendFunction:Bic,attributes:Bec.CONVOLUTION,uniforms:new Map([["offset",new Eoa(Cic)]])})}get offset(){return this.uniforms.get("offset").value}set offset(Dic){this.uniforms.get("offset").value=Dic}getOffset(){return this.offset}setOffset(Eic){this.offset=Eic}},Fic=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,Gic=class extends Cec{constructor(Hic,{blendFunction:Iic=bec.NORMAL,worldFocusDistance:Jic,worldFocusRange:Kic,focusDistance:Lic=0,focalLength:Mic=.1,focusRange:Nic=Mic,bokehScale:Oic=1,width:Pic=ucc.AUTO_SIZE,height:Qic=ucc.AUTO_SIZE}={}){super("DepthOfFieldEffect",Fic,{blendFunction:Iic,attributes:Bec.DEPTH,uniforms:new Map([["nearColorBuffer",new Eoa(null)],["farColorBuffer",new Eoa(null)],["nearCoCBuffer",new Eoa(null)],["scale",new Eoa(1)]])}),this.camera=Hic,this.renderTarget=new Yi(1,1,{minFilter:va,magFilter:va,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new lhc(new p8b(Hic));let Ric=this.cocMaterial;Ric.focusDistance=Lic,Ric.focusRange=Nic,void 0!==Jic&&(Ric.worldFocusDistance=Jic),void 0!==Kic&&(Ric.worldFocusRange=Kic),this.blurPass=new Wfc({kernelSize:Ihc.MEDIUM,width:Pic,height:Qic});let Sic=this.blurPass.getResolution();Sic.addEventListener("change",a=>this.setSize(Sic.getBaseWidth(),Sic.getBaseHeight())),this.maskPass=new lhc(new tac(this.renderTargetCoC.texture));let Tic=this.maskPass.fullscreenMaterial;Tic.maskFunction=sac.MULTIPLY,Tic.colorChannel=L7b.GREEN,this.bokehNearBasePass=new lhc(new N7b(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new lhc(new N7b(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new lhc(new N7b(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new lhc(new N7b(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=Oic}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(Uic){let Vic=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let Wic of Vic)Wic.fullscreenMaterial.setScale(Uic);this.maskPass.fullscreenMaterial.setStrength(Uic),this.uniforms.get("scale").value=Uic}getBokehScale(){return this.bokehScale}setBokehScale(Xic){this.bokehScale=Xic}getTarget(){return this.target}setTarget(Yic){this.target=Yic}calculateFocusDistance(Zic){let $ic=this.camera;return o8b(-$ic.position.distanceTo(Zic),$ic.near,$ic.far)}setDepthTexture(_ic,ajc=Ua){this.circleOfConfusionMaterial.depthBuffer=_ic,this.circleOfConfusionMaterial.depthPacking=ajc}update(bjc,cjc,djc){let ejc=this.renderTarget,fjc=this.renderTargetCoC,gjc=this.renderTargetCoCBlurred,hjc=this.renderTargetMasked;if(null!==this.target){let ijc=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=ijc}this.cocPass.render(bjc,null,fjc),this.blurPass.render(bjc,fjc,gjc),this.maskPass.render(bjc,cjc,hjc),this.bokehFarBasePass.render(bjc,hjc,ejc),this.bokehFarFillPass.render(bjc,ejc,this.renderTargetFar),this.bokehNearBasePass.render(bjc,cjc,ejc),this.bokehNearFillPass.render(bjc,ejc,this.renderTargetNear)}setSize(jjc,kjc){let ljc=this.resolution;ljc.setBaseSize(jjc,kjc);let mjc=ljc.width,njc=ljc.height,ojc=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];ojc.push(this.renderTargetCoC,this.renderTargetMasked),ojc.forEach(a=>a.setSize(jjc,kjc)),(ojc=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred]).forEach(a=>a.setSize(mjc,njc)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(a=>a.fullscreenMaterial.setSize(mjc,njc))}initialize(pjc,qjc,rjc){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(a=>a.initialize(pjc,qjc,rjc)),this.blurPass.initialize(pjc,qjc,ya),void 0!==rjc&&(this.renderTarget.texture.type=rjc,this.renderTargetNear.texture.type=rjc,this.renderTargetFar.texture.type=rjc,this.renderTargetMasked.texture.type=rjc,pjc.outputEncoding===Ta&&(this.renderTarget.texture.encoding=Ta,this.renderTargetNear.texture.encoding=Ta,this.renderTargetFar.texture.encoding=Ta,this.renderTargetMasked.texture.encoding=Ta))}};new fm,new rs;var sjc="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",tjc=class extends Cec{constructor({blendFunction:ujc=bec.NORMAL,hue:vjc=0,saturation:wjc=0}={}){super("HueSaturationEffect",sjc,{blendFunction:ujc,uniforms:new Map([["hue",new Eoa(new fm)],["saturation",new Eoa(wjc)]])}),this.hue=vjc}get saturation(){return this.uniforms.get("saturation").value}set saturation(xjc){this.uniforms.get("saturation").value=xjc}getSaturation(){return this.saturation}setSaturation(yjc){this.saturation=yjc}get hue(){return Math.acos((3*this.uniforms.get("hue").value.x-1)/2)}set hue(zjc){let Ajc=Math.sin(zjc),Bjc=Math.cos(zjc);this.uniforms.get("hue").value.set((2*Bjc+1)/3,(-Math.sqrt(3)*Ajc-Bjc+1)/3,(Math.sqrt(3)*Ajc-Bjc+1)/3)}getHue(){return this.hue}setHue(Cjc){this.hue=Cjc}};new df;var Djc=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,Ejc=class extends Cec{constructor({blendFunction:Fjc=bec.SCREEN,premultiply:Gjc=!1}={}){super("NoiseEffect",Djc,{blendFunction:Fjc}),this.premultiply=Gjc}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(Hjc){this.premultiply!==Hjc&&(Hjc?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(Ijc){this.premultiply=Ijc}},Jjc="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",Kjc=class extends Cec{constructor(Ljc=30){super("PixelationEffect",Jjc,{uniforms:new Map([["active",new Eoa(!1)],["d",new Eoa(new Eb)]])}),this.resolution=new Eb,this.d=0,this.granularity=Ljc}get granularity(){return this.d}set granularity(Mjc){let Njc=Math.floor(Mjc);Njc%2>0&&(Njc+=1),this.d=Njc,this.uniforms.get("active").value=Njc>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(Ojc){this.granularity=Ojc}setSize(Pjc,Qjc){this.resolution.set(Pjc,Qjc),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};Math.PI,new fm,new fm;var Rjc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",Sjc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",Tjc="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",Ujc="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",Vjc={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},Wjc=class extends Cec{constructor({preset:Xjc=Vjc.MEDIUM,edgeDetectionMode:Yjc=Z8b.COLOR,predicationMode:Zjc=$8b.DISABLED}={}){super("SMAAEffect",Tjc,{vertexShader:Ujc,blendFunction:bec.NORMAL,attributes:Bec.CONVOLUTION|Bec.DEPTH,uniforms:new Map([["weightMap",new Eoa(null)]])});let $jc,_jc;arguments.length>1&&($jc=arguments[0],_jc=arguments[1],arguments.length>2&&(Xjc=arguments[2]),arguments.length>3&&(Yjc=arguments[3])),this.renderTargetEdges=new Yi(1,1,{minFilter:va,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new acc(!0,!1,!1),this.clearPass.overrideClearColor=new df(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new lhc(new _8b),this.edgeDetectionMaterial.edgeDetectionMode=Yjc,this.edgeDetectionMaterial.predicationMode=Zjc,this.weightsPass=new lhc(new Hac);let akc=new Rda;akc.onLoad=()=>{let a=new ah($jc);a.name="SMAA.Search",a.magFilter=sa,a.minFilter=sa,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;let b=new ah(_jc);b.name="SMAA.Area",b.magFilter=va,b.minFilter=va,b.generateMipmaps=!1,b.needsUpdate=!0,b.flipY=!1,this.weightsMaterial.areaTexture=b,this.dispatchEvent({type:"load"})},akc.itemStart("search"),akc.itemStart("area"),void 0!==$jc&& void 0!==_jc?(akc.itemEnd("search"),akc.itemEnd("area")):"u">typeof Image&&($jc=new Image,_jc=new Image,$jc.addEventListener("load",()=>akc.itemEnd("search")),_jc.addEventListener("load",()=>akc.itemEnd("area")),$jc.src=Rjc,_jc.src=Sjc),this.applyPreset(Xjc)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(bkc){this.edgeDetectionMaterial.edgeDetectionThreshold=bkc}setOrthogonalSearchSteps(ckc){this.weightsMaterial.orthogonalSearchSteps=ckc}applyPreset(dkc){let ekc=this.edgeDetectionMaterial,fkc=this.weightsMaterial;switch(dkc){case Vjc.LOW:ekc.edgeDetectionThreshold=.15,fkc.orthogonalSearchSteps=4,fkc.diagonalDetection=!1,fkc.cornerDetection=!1;break;case Vjc.MEDIUM:ekc.edgeDetectionThreshold=.1,fkc.orthogonalSearchSteps=8,fkc.diagonalDetection=!1,fkc.cornerDetection=!1;break;case Vjc.HIGH:ekc.edgeDetectionThreshold=.1,fkc.orthogonalSearchSteps=16,fkc.diagonalSearchSteps=8,fkc.cornerRounding=25,fkc.diagonalDetection=!0,fkc.cornerDetection=!0;break;case Vjc.ULTRA:ekc.edgeDetectionThreshold=.05,fkc.orthogonalSearchSteps=32,fkc.diagonalSearchSteps=16,fkc.cornerRounding=25,fkc.diagonalDetection=!0,fkc.cornerDetection=!0;break}}setDepthTexture(gkc,hkc=Ua){this.edgeDetectionMaterial.depthBuffer=gkc,this.edgeDetectionMaterial.depthPacking=hkc}update(ikc,jkc,kkc){this.clearPass.render(ikc,this.renderTargetEdges),this.edgeDetectionPass.render(ikc,jkc,this.renderTargetEdges),this.weightsPass.render(ikc,this.renderTargetEdges,this.renderTargetWeights)}setSize(lkc,mkc){this.edgeDetectionMaterial.setSize(lkc,mkc),this.weightsMaterial.setSize(lkc,mkc),this.renderTargetEdges.setSize(lkc,mkc),this.renderTargetWeights.setSize(lkc,mkc)}dispose(){let{searchTexture:nkc,areaTexture:okc}=this.weightsMaterial;null!==nkc&&null!==okc&&(nkc.dispose(),okc.dispose()),super.dispose()}static get searchImageDataURL(){return Rjc}static get areaImageDataURL(){return Sjc}},pkc=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,qkc={DEFAULT:0,ESKIL:1},rkc=class extends Cec{constructor({blendFunction:skc=bec.NORMAL,technique:tkc=qkc.DEFAULT,eskil:ukc=!1,offset:vkc=.5,darkness:wkc=.5}={}){super("VignetteEffect",pkc,{blendFunction:skc,defines:new Map([["VIGNETTE_TECHNIQUE",tkc.toFixed(0)]]),uniforms:new Map([["offset",new Eoa(vkc)],["darkness",new Eoa(wkc)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(xkc){this.technique!==xkc&&(this.defines.set("VIGNETTE_TECHNIQUE",xkc.toFixed(0)),this.setChanged())}get eskil(){return this.technique===qkc.ESKIL}set eskil(ykc){this.technique=ykc?qkc.ESKIL:qkc.DEFAULT}getTechnique(){return this.technique}setTechnique(zkc){this.technique=zkc}get offset(){return this.uniforms.get("offset").value}set offset(Akc){this.uniforms.get("offset").value=Akc}getOffset(){return this.offset}setOffset(Bkc){this.offset=Bkc}get darkness(){return this.uniforms.get("darkness").value}set darkness(Ckc){this.uniforms.get("darkness").value=Ckc}getDarkness(){return this.darkness}setDarkness(Dkc){this.darkness=Dkc}};function Ekc(a,b,c){return a+(b-a)*c}function Fkc(a,b,c,d){let e=Ekc(a,b,.75),f=Ekc(c,d,.75);return Ekc(e,f,.875)}new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array(2),new Float32Array(2),new Float32Array([0,-0.25,.25,-0.125,.125,-0.375,.375]),new Float32Array([0,0]),new Float32Array([.25,-0.25]),new Float32Array([-0.25,.25]),new Float32Array([.125,-0.125]),new Float32Array([-0.125,.125]),new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4]),new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3]),new Map([[Fkc(0,0,0,0),new Float32Array([0,0,0,0])],[Fkc(0,0,0,1),new Float32Array([0,0,0,1])],[Fkc(0,0,1,0),new Float32Array([0,0,1,0])],[Fkc(0,0,1,1),new Float32Array([0,0,1,1])],[Fkc(0,1,0,0),new Float32Array([0,1,0,0])],[Fkc(0,1,0,1),new Float32Array([0,1,0,1])],[Fkc(0,1,1,0),new Float32Array([0,1,1,0])],[Fkc(0,1,1,1),new Float32Array([0,1,1,1])],[Fkc(1,0,0,0),new Float32Array([1,0,0,0])],[Fkc(1,0,0,1),new Float32Array([1,0,0,1])],[Fkc(1,0,1,0),new Float32Array([1,0,1,0])],[Fkc(1,0,1,1),new Float32Array([1,0,1,1])],[Fkc(1,1,0,0),new Float32Array([1,1,0,0])],[Fkc(1,1,0,1),new Float32Array([1,1,0,1])],[Fkc(1,1,1,0),new Float32Array([1,1,1,0])],[Fkc(1,1,1,1),new Float32Array([1,1,1,1])]]);var Gkc=class{constructor(Hkc,Ikc){this.enabled=!1,this.effect=new Hkc(Ikc),Object.defineProperty(this,"opacity",{enumerable:!0,set(a){this.effect.blendMode.opacity.value=a},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(a){this.effect.blendMode.setBlendFunction(Number(a))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=bec.NORMAL}},Jkc=class extends Gkc{constructor(){super(Khc),this.blendFunction=bec.SCREEN}set intensity(Kkc){this.effect.intensity=Kkc}get intensity(){return this.effect.intensity}set luminanceThreshold(Lkc){this.effect.luminanceMaterial.threshold=Lkc}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(Mkc){this.effect.luminanceMaterial.smoothing=Mkc}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(Nkc){this.effect.blurPass.scale=Nkc}get blurScale(){return this.effect.blurPass.scale}set kernelSize(Okc){this.effect.blurPass.kernelSize=Okc}get kernelSize(){return this.effect.blurPass.kernelSize}},Pkc=class extends Gkc{constructor(){super(lic)}set contrast(Qkc){this.effect.uniforms.get("contrast").value=Qkc}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(Rkc){this.effect.uniforms.get("brightness").value=Rkc}get brightness(){return this.effect.uniforms.get("brightness").value}},Skc=class extends Gkc{constructor(){super(Aic),this.effect.offset=new Eb(.01,.01)}set offset(Tkc){this.effect.offset.set(Tkc[0]/1e3,Tkc[1]/1e3)}get offset(){return[1e3*this.effect.offset.x,1e3*this.effect.offset.y]}},Ukc=class extends Gkc{constructor(){super(wic)}},Vkc=class extends Gkc{constructor(){super(tjc),this._hue=0}set hue(Wkc){this._hue=Wkc,this.effect.setHue(Wkc)}get hue(){return this._hue}set saturation(Xkc){this.effect.uniforms.get("saturation").value=Xkc}get saturation(){return this.effect.uniforms.get("saturation").value}},Ykc=class extends Gkc{constructor(){super(Ejc),this.blendFunction=bec.OVERLAY}},Zkc=class extends Gkc{constructor(){super(rkc)}get eskil(){return this.effect.eskil}set eskil($kc){this.effect.eskil=$kc}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(_kc){this.effect.uniforms.get("darkness").value=_kc}get offset(){return this.effect.uniforms.get("offset").value}set offset(alc){this.effect.uniforms.get("offset").value=alc}},blc=class extends Gkc{constructor(clc){super(Gic,clc)}set focalLength(dlc){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=dlc}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(elc){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=elc}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(flc){this.effect.bokehScale=flc}},glc=class extends Gkc{constructor(){super(Kjc)}get granularity(){return this.effect.getGranularity()}set granularity(hlc){this.effect.setGranularity(hlc)}},ilc=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,jlc=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,klc=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,llc=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,mlc=class extends pJ{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new Eoa(null)},blending:S,depthWrite:!1,depthTest:!1,vertexShader:klc,fragmentShader:llc})}set inputBuffer(nlc){this.uniforms.inputBuffer.value=nlc}},olc=class extends gbc{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new mlc,this.resolutionVector=new Eb,this.resolveMaterial=new pJ({name:"TAAResolveMaterial",uniforms:{inputBuffer:new Eoa(null),historyBuffer:new Eoa(null),velocityBuffer:new Eoa(null),depthBuffer:new Eoa(null),resolution:new Eoa(new Eb)},blending:S,depthWrite:!1,depthTest:!1,vertexShader:ilc,fragmentShader:jlc}),this.historyRenderTarget=new Yi(1024,1024,{minFilter:va,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Yi(1024,1024,{minFilter:va,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(plc,qlc){this.historyRenderTarget.setSize(plc,qlc),this.resultRenderTarget.setSize(plc,qlc)}render(rlc,slc){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=slc.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=slc.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=slc.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(slc.width,slc.height),rlc.setRenderTarget(this.resultRenderTarget),rlc.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,rlc.setRenderTarget(this.historyRenderTarget),rlc.render(this.scene,this.camera);let tlc=this.renderToScreen?null:slc;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,rlc.setRenderTarget(tlc),rlc.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},ulc=class extends gbc{constructor(vlc,wlc,xlc){super("TransmissionPass",void 0,wlc),this.MRTCompatible=!0,this.depthPass=new Jdc(vlc,wlc,{renderTarget:xlc.transmissionDepthTarget}),this.passThroughMaterial=new mlc,this.splineScene=vlc,this.needsSwap=!1}updatePasses(ylc){this.passThroughMaterial=new mlc,this.depthPass=new Jdc(this.splineScene,this.camera,{renderTarget:ylc.transmissionDepthTarget})}setCamera(zlc){this.camera=zlc}setScene(Alc){this.splineScene=Alc}render(Blc,Clc,Dlc){let Elc=this.camera.layers.mask,Flc=Blc;Flc.setRenderTarget(Flc.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=Clc.texture[0],Flc.clear(),Flc.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(Blc,Clc,Dlc),Flc.shadowMap.needsUpdate=!1,Flc.shadowMap.autoUpdate=!1;let Glc=this.renderToScreen?null:Clc;this.camera.layers.set(3),Blc.setRenderTarget(Glc),Blc.render(this.splineScene,this.camera),this.camera.layers.mask=Elc}},Hlc=new zV,Ilc=new pJ({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),Jlc=class extends gbc{constructor(Klc,Llc,Mlc){super("OpaquePass",Llc??Hlc,Mlc),this.MRTCompatible=!0,this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.originalMaterials=new Map,this.MRTCompatible=Klc}set splatViewer(Nlc){this._splatViewer=Nlc}get splatViewer(){return this._splatViewer}setCamera(Olc){this.camera=Olc}setScene(Plc){this.scene=Plc??Hlc}getScene(){return this.scene}render(Qlc,Rlc){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.clear(),this.scene.traverse(a=>{a.layers.isEnabled(3)&&a instanceof Bvb&&(this.originalMaterials.set(a.id,a.material),a.material=Ilc)}),Qlc.shadowMap.needsUpdate=!0,Qlc.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let Slc=this.renderToScreen?null:Rlc;if(Qlc.setRenderTarget(Slc),this.clearColorOnly&&Qlc.clear(!0,!1,!0),this.clear&&Qlc.clear(),this._splatViewer?.splatRenderingInitialized=== !0){let Tlc=Qlc.autoClear;Qlc.autoClear=!1,Qlc.render(this.scene,this.camera),this._splatViewer.update(),Qlc.render(this._splatViewer.splatMesh,this.camera),Qlc.autoClear=Tlc}else Qlc.render(this.scene,this.camera);this.clearDepth&&Qlc.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach((a,b)=>{let c=this.scene.getObjectById(b);c&&(c.material=a)})}},Ulc=class{constructor(Vlc,{depthBuffer:Wlc=!0,stencilBuffer:Xlc=!1,multisampling:Ylc=0,frameBufferType:Zlc=0}={}){this.renderer=Vlc,this.helperStartIndex=0,this.copyPass=new Fbc,this.depthTexture=null,this.timer=new Ahc,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(Wlc,Xlc,Zlc,Ylc,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(Wlc,Xlc,Zlc,Ylc,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(Wlc,Xlc,Zlc,Ylc,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(Vlc)}get multisampling(){return this.inputBuffer.samples||0}set multisampling($lc){let _lc=this.inputBuffer,amc=this.multisampling;amc>0&&$lc>0?(this.inputBuffer.samples=$lc,this.outputBuffer.samples=$lc,this.inputBuffer.dispose(),this.outputBuffer.dispose()):amc!==$lc&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(_lc.depthBuffer,_lc.stencilBuffer,_lc.texture.type,$lc,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(bmc){if(this.renderer=bmc,null!==bmc){let cmc=bmc.getSize(new Eb),dmc=bmc.getContext().getContextAttributes()?.alpha?? !1,emc=this.inputBuffer.texture[0].type;for(let fmc of(emc===ya&&bmc.outputEncoding===Ta&&(this.inputBuffer.texture[0].encoding=Ta,this.outputBuffer.texture[0].encoding=Ta,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),bmc.autoClear=!1,this.setSize(cmc.width,cmc.height,!1),this.passes))fmc.initialize(bmc,dmc,emc)}}replaceRenderer(gmc,hmc=!0){let imc=this.renderer,jmc=imc.domElement.parentNode;return this.setRenderer(gmc),hmc&&null!==jmc&&(jmc.removeChild(imc.domElement),jmc.appendChild(gmc.domElement)),imc}createDepthTexture(){let kmc=this.depthTexture=new zU(this._width,this._height);return this.inputBuffer.depthTexture=kmc,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(kmc.format=Fa,kmc.type=Ca):kmc.type=za,kmc}deleteDepthTexture(){if(null!==this.depthTexture)for(let lmc of(this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose(),this.passes))lmc.setDepthTexture(null)}createBuffer(mmc,nmc,omc,pmc,qmc,rmc){let smc=this.renderer,tmc=null===smc?new Eb:smc.getDrawingBufferSize(new Eb),umc={minFilter:va,magFilter:va,wrapS:qa,wrapT:qa,stencilBuffer:nmc,depthBuffer:mmc},vmc;return pmc>0?(vmc=new Yi(tmc.width,tmc.height,umc)).samples=pmc:(qmc?(vmc=new qj(tmc.width,tmc.height,2,umc)).texture[1].type=Ba:vmc=new Yi(tmc.width,tmc.height,umc),vmc.depthTexture=new zU(2048,2048),vmc.depthTexture.type=Aa),omc===ya&&null!==smc&&smc.outputEncoding===Ta&&(Array.isArray(vmc.texture)?vmc.texture.forEach(a=>a.encoding=Ta):vmc.texture.encoding=Ta),Array.isArray(vmc.texture)?vmc.texture.forEach((a,b)=>{a.name=`EffectComposer.Buffer ${qmc} ${b}`,a.generateMipmaps=!1}):(vmc.texture.name=`EffectComposer.Buffer ${qmc}`,vmc.texture.generateMipmaps=!1),vmc.name=rmc,vmc}addPass(wmc,xmc){let ymc=this.passes,zmc=this.renderer,Amc=zmc.getDrawingBufferSize(new Eb),Bmc=zmc.getContext().getContextAttributes()?.alpha?? !1,Cmc;if(wmc.MRTCompatible&&(Cmc=this.inputBuffer.texture[0].type),wmc.MRTCompatible||(Cmc=this.inputBuffer.texture.type),wmc.setRenderer(zmc),wmc.setSize(Amc.width,Amc.height),wmc.initialize(zmc,Bmc,Cmc),this.autoRenderToScreen&&(ymc.length>0&&(ymc[ymc.length-1].renderToScreen=!1),wmc.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==xmc?ymc.splice(xmc,0,wmc):ymc.push(wmc),this.autoRenderToScreen&&(ymc[ymc.length-1].renderToScreen=!0),wmc.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){let Dmc=this.createDepthTexture();for(wmc of ymc)wmc.setDepthTexture(Dmc)}else wmc.setDepthTexture(this.depthTexture)}setHelperStartIndex(Emc){this.helperStartIndex=Emc}removePass(Fmc){let Gmc=this.passes,Hmc=Gmc.indexOf(Fmc);if(-1!==Hmc&&Gmc.splice(Hmc,1).length>0){if(null!==this.depthTexture){let Imc=(a,b)=>a||b.needsDepthTexture;Gmc.reduce(Imc,!1)||(Fmc.getDepthTexture()===this.depthTexture&&Fmc.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&Hmc===Gmc.length&&(Fmc.renderToScreen=!1,Gmc.length>0&&(Gmc[Gmc.length-1].renderToScreen=!0))}}removeAllPasses(){let Jmc=this.passes;this.deleteDepthTexture(),Jmc.length>0&&(this.autoRenderToScreen&&(Jmc[Jmc.length-1].renderToScreen=!1),this.passes=[])}render(Kmc){let Lmc=this.renderer,Mmc=this.copyPass,Nmc=this.inputBuffer,Omc=this.outputBuffer,Pmc=this.inputBufferSingle,Qmc=this.outputBufferSingle,Rmc=!1,Smc,Tmc,Umc,Vmc;for(let Wmc of(void 0===Kmc&&(Kmc=this.timer.update().getDelta()),this.passes))Wmc.enabled&&(Wmc.MRTCompatible?Wmc.render(Lmc,Nmc,Omc,Kmc,Rmc):Wmc.render(Lmc,Pmc,Qmc,Kmc,Rmc),Wmc.needsSwap&&(Rmc&&(Mmc.renderToScreen=Wmc.renderToScreen,Smc=Lmc.getContext(),Tmc=Lmc.state.buffers.stencil,Tmc.setFunc(Smc.NOTEQUAL,1,4294967295),Mmc.render(Lmc,Nmc,Omc,Kmc,Rmc),Tmc.setFunc(Smc.EQUAL,1,4294967295)),Umc=Nmc,Vmc=Pmc,Nmc=Omc,Pmc=Qmc,Omc=Umc,Qmc=Vmc),Wmc instanceof Vgc?Rmc=!0:Wmc instanceof Ubc&&(Rmc=!1))}setSize(Xmc,Ymc,Zmc){let $mc=this.renderer;if(this._width=Xmc,this._height=Ymc,void 0===Xmc|| void 0===Ymc){let _mc=$mc.getSize(new Eb);Xmc=_mc.width,Ymc=_mc.height}$mc.setSize(Xmc,Ymc,Zmc);let anc=$mc.getDrawingBufferSize(new Eb);for(let bnc of(this.inputBuffer.setSize(anc.width,anc.height),this.outputBuffer.setSize(anc.width,anc.height),this.inputBufferSingle.setSize(anc.width,anc.height),this.outputBufferSingle.setSize(anc.width,anc.height),this.passes))bnc.setSize(anc.width,anc.height)}reset(){let cnc=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(cnc)}dispose(){for(let dnc of this.passes)dnc.dispose();this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),null!==this.inputBufferSingle&&this.inputBufferSingle.dispose(),null!==this.outputBufferSingle&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},enc=new pJ({name:"CombineMaterial",uniforms:{inputBufferA:new Eoa(null),inputBufferB:new Eoa(null)},blending:S,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),fnc=class extends gbc{constructor(gnc){super("HelperPass",void 0,gnc),this.MRTCompatible=!1,this.fullscreenMaterial=enc,this.helperPass=new Jlc(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new Jlc(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let hnc=new Wjc({preset:Vjc.LOW,edgeDetectionMode:Z8b.COLOR});this.effectPass=new bfc(this.camera,hnc),this.rt=new Yi(10,10,{minFilter:va,magFilter:va,wrapS:qa,wrapT:qa,depthBuffer:!0})}setSize(inc,jnc){this.rt.setSize(inc,jnc),this.effectPass.setSize(inc,jnc)}set sceneHelpers(knc){this.helperPass.setScene(knc)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(lnc){this.helperPassOnTop.setScene(lnc)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(mnc){this.helperPass.setCamera(mnc),this.helperPassOnTop.setCamera(mnc)}initialize(nnc,onc,pnc){super.initialize(nnc,onc,pnc),this.effectPass.initialize(nnc,onc,pnc)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(qnc,rnc,snc){this.rt.depthTexture=rnc.depthTexture;let tnc=qnc.getClearAlpha();qnc.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(qnc,this.rt),this.helperPassOnTop.render(qnc,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(qnc,this.rt,snc),this.fullscreenMaterial.uniforms.inputBufferA.value=snc.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=rnc.texture,qnc.setClearAlpha(tnc),qnc.setRenderTarget(null),qnc.clear(),qnc.render(this.scene,this.camera)}},unc=`#define GLSLIFY 1
#include <skinning_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,vnc=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,wnc=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,xnc=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,ync=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,znc=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,Anc=[[.478712,.875764],[-0.337956,-0.793959],[-0.955259,-0.028164],[.864527,.325689],[.209342,-0.395657],[-0.106779,.672585],[.156213,.235113],[-0.413644,-0.082856],[-0.415667,.323909],[.141896,-0.93998],[.954932,-0.182516],[-0.766184,.410799],[-0.434912,-0.458845],[.415242,-0.078724],[.728335,-0.491777],[-0.058086,-0.066401],[.20299,.686837],[-0.808362,-0.556402],[.507386,-0.640839],[-0.723494,-0.22924],[.48974,.317826],[-0.622663,.765301],[-0.01064,.929347],[.663146,.647618],[-0.096674,-0.413835],[.525945,-0.321063],[-0.122533,.366019],[.195235,-0.687983],[-0.563203,.098748],[.418563,.561335],[-0.378595,.800367],[.826922,.001024],[-0.085372,-0.766651],[-0.92192,.183673],[-0.590008,-0.721799],[.167751,-0.164393],[.032961,-0.56253],[.6329,-0.107059],[-0.46408,.569669],[-0.173676,-0.958758],[-0.242648,-0.234303],[-0.275362,.157163],[.382295,-0.795131],[.562955,.115562],[.190586,.470121],[.770764,-0.297576],[.237281,.93105],[-0.666642,-0.455871],[-0.905649,-0.298379],[.33952,.157829],[.701438,-0.7041],[-0.062758,.160346],[-0.220674,.957141],[.642692,.432706],[-0.77339,-0.015272],[-0.671467,.24688],[.158051,.062859],[.806009,.527232],[-0.05762,-0.247071],[.333436,-0.51671],[-0.550658,-0.315773],[-0.652078,.589846],[.008818,.530556],[-0.210004,.519896]],Bnc=new pJ({vertexShader:unc,fragmentShader:vnc}),Cnc=new pJ({vertexShader:ync,fragmentShader:znc,uniforms:{texture_ao_lrez:new Eoa(null),texture_depth_lrez:new Eoa(null),texture_depth_hrez:new Eoa(null),near:new Eoa(null),far:new Eoa(null)}}),Dnc=class extends gbc{constructor(Enc,Fnc){super("AmbientOcclusionPass",void 0,Fnc),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let Gnc=1024,Hnc=1024;this.gBuffer=new Yi(Gnc,Hnc,{type:Aa,depthTexture:new zU(Gnc,Hnc),minFilter:va,magFilter:va}),this.depthBufferHighRes=new Yi(Gnc,Hnc,{depthTexture:new zU(Gnc,Hnc)}),this.aoBuffer=new Yi(Gnc,Hnc,{minFilter:va,magFilter:va}),this.splineScene=Enc,this.splineCamera=Fnc;let Inc=new Float32Array(2*Anc.length);for(let Jnc=0;Jnc<Anc.length;Jnc++){let Knc=2*Jnc;Inc[Knc+0]=Anc[Jnc][0],Inc[Knc+1]=Anc[Jnc][1]}this.blueNoiseInDiskTexture=new YW(Inc,Anc.length,1,Ga,Aa),this.blueNoiseInDiskTexture.wrapS=pa,this.blueNoiseInDiskTexture.wrapT=pa,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new pJ({vertexShader:wnc,fragmentShader:xnc,uniforms:{near:new Eoa(null),far:new Eoa(null),fov:new Eoa(null),proj_info:new Eoa(new sh),is_ortho:new Eoa(!1),resolution:new Eoa(new Eb),radius_of_influence:new Eoa(8),radius_in_screen_space:new Eoa(1),exponent:new Eoa(1),ao_color:new Eoa(new fm),bias:new Eoa(.5),texture_depth:new Eoa(null),texture_normals:new Eoa(null),texture_blue_noise:new Eoa(null),texture_blue_noise_in_disk:new Eoa(this.blueNoiseInDiskTexture),frame_index:new Eoa(0),fog_enabled:new Eoa(!1),fog_near:new Eoa(1),fog_far:new Eoa(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Yi(Gnc,Hnc,{minFilter:va,magFilter:va,wrapS:qa,wrapT:qa,depthBuffer:!1,type:Aa});let Lnc=new Wjc({preset:Vjc.ULTRA,edgeDetectionMode:Z8b.COLOR});this.effectPass=new bfc(this.camera,Lnc)}initialize(Mnc,Nnc,Onc){super.initialize(Mnc,Nnc,Onc),this.effectPass.initialize(Mnc,Nnc,Onc)}setBlueNoiseTexture(Pnc){this.hbaoMaterial.uniforms.texture_blue_noise.value=Pnc}setSize(Qnc,Rnc){this._width=Qnc,this._height=Rnc,this.depthBufferHighRes.setSize(Qnc,Rnc);let Snc=this._runHalfRes?.5:1,Tnc=Qnc*Snc,Unc=Rnc*Snc;this.gBuffer.setSize(Tnc,Unc),this.aoBuffer.setSize(Tnc,Unc),this.hbaoMaterial.uniforms.resolution.value.set(Tnc,Unc),this.aaBuffer.setSize(Tnc,Unc),this.effectPass.setSize(Tnc,Unc)}get runHalfRes(){return this._runHalfRes}set runHalfRes(Vnc){this._runHalfRes=Vnc,this.setSize(this._width,this._height)}setCamera(Wnc){this.splineCamera=Wnc}setScene(Xnc){this.splineScene=Xnc}render(Ync,Znc,$nc){this.splineScene.overrideMaterial=Bnc;let _nc=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),Ync.setRenderTarget(this.gBuffer),Ync.clear(),Ync.render(this.splineScene,this.splineCamera),Ync.setRenderTarget(this.depthBufferHighRes),Ync.clear(),Ync.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=_nc,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let aoc=this.splineCamera.perspCamera.projectionMatrix.elements,boc=2/aoc[0],coc=2/aoc[5],doc=-(1-aoc[8])/aoc[0],eoc=-(1+aoc[9])/aoc[5];this.hbaoMaterial.uniforms.proj_info.value.set(boc,coc,doc,eoc);let foc=this.splineCamera.perspCamera.fov*(Math.PI/180),goc=this.hbaoMaterial.uniforms.resolution.value.y/(2*Math.tan(.5*foc)),hoc=.5*this.hbaoMaterial.uniforms.radius_of_influence.value*goc;this.hbaoMaterial.uniforms.radius_in_screen_space.value=hoc,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let ioc=this.splineCamera.orthoCamera.projectionMatrix.elements,joc=2/ioc[0],koc=2/ioc[5],loc=-(1+ioc[12])/ioc[0],moc=-(1-ioc[13])/ioc[5];this.hbaoMaterial.uniforms.proj_info.value.set(joc,koc,loc,moc);let noc=.5*(this.hbaoMaterial.uniforms.resolution.value.y/koc),ooc=this.hbaoMaterial.uniforms.radius_of_influence.value*noc;this.hbaoMaterial.uniforms.radius_in_screen_space.value=ooc,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,Ync.setRenderTarget(this.aoBuffer),Ync.clear(),Ync.render(this.scene,this.camera),this.fullscreenMaterial=Cnc,Cnc.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,Cnc.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,Cnc.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,Ync.setRenderTarget(Ync.aoRenderTarget),Ync.clear(),Ync.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,Ync.setRenderTarget(this.aaBuffer),Ync.clear(),Ync.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(Ync,this.aaBuffer,Ync.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},poc=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,qoc=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,roc=class extends lhc{constructor(){super(new pJ({vertexShader:poc,fragmentShader:qoc,uniforms:{tInput:new Eoa(null),tMap:new Eoa(null),uResolution:new Eoa(new Eb),uSize:new Eoa(new Eb),uCoords:new Eoa(new Eb),uScale:new Eoa(1),uSceneColor:new Eoa(new df(16711680)),uDPR:new Eoa(1),uCurrent:new Eoa(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(soc){this.uniforms.tMap.value=soc}},toc=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,uoc=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,voc=[],woc=class extends lhc{constructor(){super(new pJ({vertexShader:toc,fragmentShader:uoc,uniforms:{toScene:new Eoa(null),fromScene:new Eoa(null),uResolution:new Eoa(new Eb),uDPR:new Eoa(1),mixRatio:new Eoa(0),threshold:new Eoa(.1),useTexture:new Eoa(0),tMixTexture:{value:voc[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(xoc){this.uniforms.fromScene.value=xoc}},yoc=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,zoc=`
uniform sampler2D inputBuffer;
uniform sampler2D blurredInputBuffer;
uniform sampler2D overlay;
uniform float blurIntensity;

uniform vec2 uResolution;
uniform float uDPR;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( overlay, screenUv );
	vec4 texel2 = texture2D( inputBuffer, screenUv );
	vec4 texel3 = texture2D( blurredInputBuffer, screenUv );

	float blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;
    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );
	gl_FragColor.a = 1.0;
}
`,Aoc=class extends lhc{constructor(){super(new pJ({vertexShader:yoc,fragmentShader:zoc,uniforms:{inputBuffer:new Eoa(null),blurredInputBuffer:new Eoa(null),overlay:new Eoa(null),uResolution:new Eoa(new Eb),uDPR:new Eoa(1),blurIntensity:new Eoa(0)}})),this._blurEnabled=!1,this.blurTarget=new Yi(1,1,{minFilter:va,magFilter:va,wrapS:qa,wrapT:qa}),this.blurPass=new Wfc({width:window.innerWidth,height:window.innerHeight,kernelSize:Ihc.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(Boc){this.uniforms.overlay.value=Boc}setResolution(Coc,Doc,Eoc=1){this.uniforms.uResolution.value.set(Coc,Doc).divideScalar(Eoc),this.uniforms.uDPR.value=Eoc,this.blurPass.setSize(Coc,Doc),this.blurTarget.setSize(Coc,Doc),this.blurPass.setSize(Coc,Doc)}get uiCanvas(){return this._uiCanvas}set uiCanvas(Foc){this._uiCanvas=Foc,Foc.texture&&(this.uniforms.overlay.value=Foc.texture);let Goc=Foc.frame;if(Goc){let Hoc=Goc.data.backgroundBlur,Ioc=Hoc.radius;this._blurEnabled=Hoc.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=Ioc/3}}render(Joc,Koc,Loc,Moc,Noc){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(Joc,Koc,this.blurTarget,Moc,Noc)),super.render(Joc,Koc,Loc,Moc,Noc)}};function Ooc(a,b){return b&&b.enabled&&a.push(b.effect),a}var Poc=a=>Object.values(bec).includes(a)?a:bec.NORMAL,Qoc=class extends ab{constructor(Roc){super(),this.postprocessingState=wNa.defaultData,this._scene=new zV,this._camera=new U5b,this.effects=new Map,this.blueNoiseTexture=new YW,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new Nga,this.renderer=Roc,this.debug=!1,this.effects.set("bloom",new Jkc),this.effects.set("chromaticAberration",new Skc),this.effects.set("vignette",new Zkc),this.effects.set("noise",new Ykc),this.effects.set("colorAverage",new Ukc),this.effects.set("hueSaturation",new Vkc),this.effects.set("brightnessContrast",new Pkc),this.effects.set("depthOfField",new blc),this.effects.set("pixelation",new glc),this.effectComposer=new Ulc(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new Jlc(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new ulc(this.scene,this.camera,this.renderer),this.aoPass=new Dnc(this.scene,this.camera),this.taaPass=new olc,this.taaPass.renderToScreen=!1,this.helperPass=new fnc(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new roc,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new Aoc,this.uiOverlayPass.enabled=!1,this.sceneTransitionPass=new woc,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(Soc){void 0!==Soc?(this.stylesOverlayPass.texture=Soc,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(Toc){this.helperPass.sceneHelpers=Toc}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(Uoc){this.helperPass.sceneHelpersOnTop=Uoc}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(Voc){this._scene=Voc,this.opaquePass.setScene(Voc),this.transmissionPass.setScene(Voc),this.aoPass.setScene(Voc)}get camera(){return this._camera}set camera(Woc){this._camera=Woc,this.opaquePass.setCamera(Woc),this.transmissionPass.setCamera(Woc),this.aoPass.setCamera(Woc),this.helperPass.setCamera(Woc)}updateRenderToScreen(){let Xoc=!1;for(let Yoc=this.effectComposer.passes.length-1;Yoc>=0;Yoc--){let Zoc=this.effectComposer.passes[Yoc];if(!0===Zoc.enabled&&!Xoc&&this._renderToScreen){Zoc.renderToScreen=!0,Xoc=!0;continue}Zoc.renderToScreen=!1}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture($oc){this.blueNoiseTexture=new YW($oc,128,128),this.blueNoiseTexture.wrapS=pa,this.blueNoiseTexture.wrapT=pa,this.blueNoiseTexture.minFilter=sa,this.blueNoiseTexture.magFilter=sa,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(_oc,apc,bpc,cpc,dpc,epc,fpc,gpc){this.aoPass.enabled=_oc,this.aoPass.radius=apc,this.aoPass.bias=bpc,this.aoPass.aoColor=cpc,this.aoPass.fogEnabled=dpc,this.aoPass.fogNear=epc,this.aoPass.fogFar=fpc,!gpc!==this.aoPass.runHalfRes&&(this.aoPass.runHalfRes=!gpc)}setTransmissionPassEnabled(hpc){this.transmissionPass.enabled=hpc,this.opaquePass.hasTransmissionPass=hpc}_initPasses(){if(this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let ipc=[this.effects.get("pixelation")].reduce(Ooc,[]);ipc.length>0&&(this.uvEffectPass=new bfc(this.camera,...ipc),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let jpc=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(Ooc,[]);jpc.length>0&&(this.effectPass=new bfc(this.camera,...jpc),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass))}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass)}_initCopyPass(){if(this._savePass)return;let kpc=new Eb;this.renderer.getDrawingBufferSize(kpc),this._rt=new Yi(kpc.x,kpc.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:pa,wrapT:pa}),this._rt.samples=0,this._savePass=new Fbc(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(lpc){this._rt=lpc,this._savePass=new Fbc(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(mpc){if(this._renderToScreen===mpc)return;let npc=this.effectComposer;npc&&(!0===mpc?npc.removePass(this._savePass):npc.addPass(this._savePass),this._renderToScreen=mpc,this.updateRenderToScreen())}set sceneTransitionFromTexture(opc){opc!==this.sceneTransitionPass.texture&&(null!==opc?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=opc)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(ppc){let{enabled:qpc,...rpc}=ppc,spc=!1;for(let tpc of(qpc!==this.postprocessingState.enabled&&(spc=!0),Object.entries(rpc))){let upc=tpc[1],vpc=this.effects.get(tpc[0]);if(vpc)for(let[wpc,xpc]of(vpc.enabled!==upc.enabled&&(spc=!0),vpc.enabled=upc.enabled,Object.entries(upc)))"blendFunction"===wpc?vpc.blendFunction=Poc(xpc):vpc[wpc]=xpc}this.postprocessingState=ppc,spc&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(ypc,zpc,Apc,Bpc){ypc instanceof sh?(this.effectComposer.inputBuffer.scissor.set(ypc.x,ypc.y,ypc.z,ypc.w),this.effectComposer.outputBuffer.scissor.set(ypc.x,ypc.y,ypc.z,ypc.w)):(this.effectComposer.inputBuffer.scissor.set(ypc,zpc,Apc,Bpc),this.effectComposer.outputBuffer.scissor.set(ypc,zpc,Apc,Bpc));let Cpc=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(Cpc),this.effectComposer.outputBuffer.scissor.multiplyScalar(Cpc),this.renderer.setScissor(ypc,zpc,Apc,Bpc)}setScissorTest(Dpc){this.effectComposer.inputBuffer.scissorTest=Dpc,this.effectComposer.outputBuffer.scissorTest=Dpc,this.renderer.setScissorTest(Dpc)}setViewport(Epc,Fpc,Gpc,Hpc){Epc instanceof sh?(this.effectComposer.inputBuffer.viewport.copy(Epc),this.effectComposer.outputBuffer.viewport.copy(Epc)):(this.effectComposer.inputBuffer.viewport.set(Epc,Fpc,Gpc,Hpc),this.effectComposer.outputBuffer.viewport.set(Epc,Fpc,Gpc,Hpc))}resize(Ipc,Jpc,Kpc){if(this.effectComposer.setSize(Ipc,Jpc,Kpc),this._rt){let Lpc=this.renderer.getPixelRatio();this._rt.setSize(Ipc*Lpc,Jpc*Lpc)}}dispose(){this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.dispose()}},Mpc=a=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${a};
const int gShadowSamples = ${a};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,Npc=mO.lights_fragment_begin,Opc=mO.shadowmask_pars_fragment,Ppc=null,Qpc=a=>{switch(a){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},Rpc=(a="medium")=>{if(Ppc===a)return!1;Ppc=a;let b=Qpc(a);mO.shadowmap_pars_fragment=Mpc(b);let c=Npc.slice();c=(c=c.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]")).replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),mO.lights_fragment_begin=c;let d=Opc.slice();return d=d.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),mO.shadowmask_pars_fragment=d,!0},Spc=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;

void main()
{
vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
}
`,Tpc=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,Upc=new pJ({vertexShader:Spc,fragmentShader:Tpc,uniforms:{depthContrast:{value:1}}}),Vpc=new ah,Wpc=class extends uV{constructor(Xpc){super(Xpc),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new Eb,this.pipeline=new Qoc(this),this.dummyCamera=new U5b,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(a=!0,b=!0,c=!0)=>{let d=this.getContext(),e=0;a&&(e|=d.COLOR_BUFFER_BIT),b&&(e|=d.DEPTH_BUFFER_BIT),c&&(e|=d.STENCIL_BUFFER_BIT),d.clear(e),d.clearBufferfv(d.COLOR,1,[0,0,0,1])},this.autoClear=!1;let Ypc=this.setPixelRatio.bind(this),Zpc=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=N,this.dummyCamera.matrixAutoUpdate=!1;let $pc=this.getContext();if($pc&&"drawingBufferColorSpace"in $pc)try{$pc.drawingBufferColorSpace="display-p3"}catch(_pc){console.warn(_pc)}this.setPixelRatio=a=>{this._pixelRatio!==a&&(this._pixelRatio=a,Ypc(a))},this.setSize=(a,b,c=!0)=>{(this.viewportWidth!==a||this.viewportHeight!==b)&&(this.viewportWidth=a,this.viewportHeight=b,Zpc(a,b,c),this.normalRenderTarget?.setSize(a*this._pixelRatio,b*this._pixelRatio),this._resizeTransmission(a,b),this.transmissionDepthTarget?.setSize(a*this._pixelRatio/2,b*this._pixelRatio/2),this.pipeline.resize(a,b,c))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){void 0===this.aoRenderTarget&&(this.aoRenderTarget=new Yi(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:va,magFilter:va,wrapS:qa,wrapT:qa,depthBuffer:!1}))}_resizeTransmission(aqc,bqc){this.transmissionRenderTarget?.setSize(aqc*this._pixelRatio/(this.hdTransmission?1:2),bqc*this._pixelRatio/(this.hdTransmission?1:2)),this.aoRenderTarget?.setSize(aqc*this._pixelRatio/1,bqc*this._pixelRatio/1)}get hdTransmission(){return 1===WNb.transmissionLod.value}set hdTransmission(cqc){WNb.transmissionLod.value=!0===cqc?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){void 0===this.transmissionRenderTarget&&(this.transmissionRenderTarget=new Yi(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:xa,magFilter:va,wrapS:qa,wrapT:qa,depthBuffer:!1}),this.transmissionDepthTarget=new Yi(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:sa,magFilter:sa,depthBuffer:!1}))}createNormalRenderTarget(){void 0===this.normalRenderTarget&&(this.normalRenderTarget=new Yi(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:sa,magFilter:sa,type:Aa,depthTexture:new zU(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(dqc,eqc,fqc){this.normalRenderTarget&&(this.setClearColor(0),fqc.layers.enable(8),fqc.layers.disable(0),fqc.layers.disable(3),eqc.traverseEntity(a=>{a.layers.isEnabled(8)&&(a.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),fqc instanceof U5b?Upc.uniforms.depthContrast.value=(fqc.far-fqc.near)/1e4:Upc.uniforms.depthContrast.value=1,eqc.overrideMaterial=Upc,this.render(eqc,fqc),this.setClearColor(eqc.bgColor,eqc.bgColor.a),this.setRenderTarget(null),eqc.overrideMaterial=dqc.wireframeState?bSc:null,fqc.layers.enable(0),fqc.layers.enable(3),eqc.traverseEntity(a=>{a.layers.isEnabled(8)&&(a.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(gqc,hqc,iqc=1){this.dummyCamera.updateCameraState(hqc.dataPatched),this.dummyCamera.matrix.copy(hqc.matrixWorld);let jqc=hqc.height,kqc=hqc.width,lqc=this.viewportWidth/this.viewportHeight;kqc<jqc?kqc=jqc*lqc:jqc=kqc/lqc,this.dummyCamera.setViewplaneSize(kqc,jqc);for(let mqc=0;mqc<iqc;mqc++)this.renderSplineScene(gqc,this.dummyCamera)}renderSplineScene(nqc,oqc,{sceneHelpers:pqc,sceneHelpersOnTop:qqc,overrideTransmission:rqc,overrideNormal:sqc}={}){let tqc=nqc instanceof dSc?nqc.activePage:nqc,uqc=tqc.visible;tqc.visible=!0;let vqc=tqc.scene;this.xr.enabled&&(!1===this.isXRCopyPassSet&&null!==this.getRenderTarget()&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(oqc)),this.setClearColor(tqc.bgColor,tqc.bgColor.a),tqc.penumbraSizeArray.forEach((a,b)=>{WNb.penumbraSize.value[b]=a}),WNb.pixelRatioNode.value=this.getPixelRatio(),0!==this.resolution.x&&0!==this.resolution.y?WNb.resolution.value.set(this.resolution.x,this.resolution.y):WNb.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),void 0!==sqc?(WNb.normalRenderTarget.value=sqc,WNb.normalRenderTargetDepth.value=Vpc):vqc.needsNormal()&&(this.createNormalRenderTarget(),WNb.normalRenderTarget.value=this.normalRenderTarget.texture,WNb.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(vqc,tqc,oqc));let wqc=tqc.data.ao,xqc=wqc.occlusion;xqc&&(this.createAORenderTarget(),WNb.aoRenderTarget.value=this.aoRenderTarget.texture),WNb.aoEnabled.value=xqc,this.pipeline.setAmbientOcclusionParams(wqc.occlusion,wqc.radius,wqc.bias,tqc.aoColor,null!==tqc.fog,tqc.backupFog.near,tqc.backupFog.far,wqc.aoFullRes),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&tqc.uiCanvas?.enabled&&tqc.uiCanvas.texture&&tqc.uiCanvas.texture.image.width>0?((tqc.uiCanvas.width!==this.viewportWidth||tqc.uiCanvas.height!==this.viewportHeight)&&tqc.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight}),tqc.uiCanvas.render(),this.pipeline.uiOverlayPass.uiCanvas=tqc.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(this.domElement.width,this.domElement.height,window.devicePixelRatio),this.pipeline.updateRenderToScreen()):(this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen());let yqc=!1;if(void 0!==rqc)WNb.transmissionRenderTarget.value=rqc,WNb.transmissionRenderTargetDepth.value=Vpc,this.pipeline.setTransmissionPassEnabled(!1);else{var zqc,Aqc;let Bqc=vqc.needsTransmission();Bqc&&(void 0===this.transmissionRenderTarget&&(yqc=!0),this.createTransmissionRenderTarget(),WNb.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,zqc=this.viewportWidth,Aqc=this.viewportHeight,WNb.aspectRatio.value=zqc>=Aqc?new Eb(Aqc/zqc,1):new Eb(1,zqc/Aqc),WNb.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(Bqc)}oqc.layers.enable(3),oqc.layers.enable(8),this.pipeline.sceneHelpers=pqc,this.pipeline.sceneHelpersOnTop=qqc,this.pipeline.scene=tqc,this.pipeline.camera=oqc,yqc&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState===tqc.postprocessing||(this.pipeline.updatePostprocessing(tqc.postprocessing),pqc||qqc||this.pipeline.disableHelpers()),void 0!==this.clearAlphaOverride&&this.setClearAlpha(this.clearAlphaOverride),tqc.overrideMaterial=vqc.wireframeState?bSc:null,this.pipeline.render(),WNb.frameIndex.value=(WNb.frameIndex.value+1)%16,oqc instanceof U5b&&oqc.copyHistory(),tqc.visible=uqc}renderFromSceneForSceneTransitionPass(Cqc,Dqc,Eqc){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(Cqc,Dqc),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=Eqc,this.sceneTransitionTimeRemaining=Eqc,this.pipeline.renderToScreen=!0;let Fqc=this.pipeline.sceneTransitionPass.uniforms;Fqc.uDPR.value=window.devicePixelRatio,Fqc.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){this._superDispose(),this.pipeline.dispose(),this.aoRenderTarget?.dispose(),this.transmissionRenderTarget?.dispose(),this.transmissionDepthTarget?.dispose(),this.normalRenderTarget?.dispose(),this.normalRenderTarget?.depthTexture?.dispose()}},Gqc=class extends d5b(Cqa){constructor(Hqc,Iqc=15,Jqc=10066329){super(Hqc,Iqc,Jqc),this.object=Hqc,this.added=!1,this.name=`DirectionalLightHelper: ${Hqc.uuid}`}raycast(Kqc,Lqc){h5b(this.object,Gqc.geometryHelper,Kqc,Lqc)}},Mqc=class extends d5b(vqa){constructor(Nqc,Oqc=15,Pqc=6710886){super(Nqc,Oqc,Pqc),this.object=Nqc,this.name=`PointLightHelper: ${Nqc.uuid}`}raycast(Qqc,Rqc){h5b(this.object,Mqc.geometryHelper,Qqc,Rqc)}},Sqc=class extends d5b(iqa){constructor(Tqc,Uqc=6710886){super(Tqc,Uqc),this.object=Tqc,this.name=`SpotLightHelper: ${Tqc.uuid}`}raycast(Vqc,Wqc){h5b(this.object,Sqc.geometryHelper,Vqc,Wqc)}update(){if(void 0!==this.object){let Xqc=Sqc._vector,Yqc=this.object.distance?this.object.distance:1e3,Zqc=Yqc*Math.tan(this.object.angle);this.cone.scale.set(Zqc,Zqc,Yqc),Xqc.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(Xqc);let $qc=void 0!==this.color?this.color:this.light.color;if(this.cone.material instanceof Array)for(let _qc=0,arc=this.cone.material.length;_qc<arc;_qc++)this.cone.material[_qc].color.set($qc);else this.cone.material.color.set($qc)}}},brc=Sqc;brc._vector=new fm;var crc=class extends p7b(Vfa,Gqc){constructor(drc,erc,frc){super(),this.super_Entity(drc,erc),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let grc=this.shadow.camera;grc.top=1250,grc.bottom=-1250,grc.right=1250,grc.left=-1250,grc.near=-1e4,grc.far=2500;let hrc=new Kqa(this.shadow.camera);hrc.visible=!1,this.gizmos.shadowmap=hrc}update(){for(let irc in this.shadow.camera.updateProjectionMatrix(),this.gizmos){let jrc=this.gizmos[irc];jrc instanceof Kqa&&jrc.update()}}updateMatrixWorld(krc){super.updateMatrixWorld(krc),this.objectHelper&&this.objectHelper.update()}updateState(lrc,mrc){var nrc,orc;this.updateState_Light(lrc,mrc);let prc=void 0!==lrc.depth&&lrc.depth!==this.shadow.camera.far|| void 0!==lrc.size&&lrc.size/2!==this.shadow.camera.right;void 0!==lrc.size&&(nrc=this,orc=lrc.size,nrc.shadow.camera.right=orc/2,nrc.shadow.camera.left=-orc/2,nrc.shadow.camera.top=orc/2,nrc.shadow.camera.bottom=-orc/2,nrc.shadow.needsUpdate=!0),void 0!==lrc.shadowRadius&&(this.shadow.radius=lrc.shadowRadius),void 0!==lrc.shadowResolution&&(this.shadow.mapSize.set(lrc.shadowResolution,lrc.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),void 0!==lrc.penumbraSize&&mrc.scene.markPenumbraSizeDirty(),prc&&this.update()}},qrc=new fm,rrc=new fm,src=new Fj,trc=class extends p7b(pfa,brc){constructor(urc,vrc,wrc){super(),this.super_Entity(urc,vrc),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let xrc=this.shadow.camera;xrc.fov=2*Db.RAD2DEG*this.angle,xrc.aspect=1,xrc.near=100,xrc.far=2500;let yrc=new Kqa(this.shadow.camera);yrc.visible=!1,this.gizmos.shadowmap=yrc,this.update()}update(){for(let zrc in this.shadow.camera.updateProjectionMatrix(),this.gizmos){let Arc=this.gizmos[zrc];Arc instanceof Kqa&&Arc.update()}}updateMatrixWorld(Brc){super.updateMatrixWorld(Brc),rrc.setFromMatrixPosition(this.matrixWorld),src.setFromRotationMatrix(this.matrixWorld),qrc.copy(this.up).applyQuaternion(src).negate().multiplyScalar(this.distance),this.target.position.copy(rrc).add(qrc),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(Crc,Drc){this.updateState_Light(Crc,Drc),void 0!==Crc.distance&&(this.distance=Crc.distance),void 0!==Crc.decay&&(this.decay=Crc.decay),void 0!==Crc.angle&&(this.angle=Crc.angle),void 0!==Crc.penumbra&&(this.penumbra=Crc.penumbra),void 0!==Crc.shadowRadius&&(this.shadow.radius=Crc.shadowRadius),void 0!==Crc.penumbraSize&&Drc.scene.markPenumbraSizeDirty(),void 0!==Crc.shadowResolution&&(this.shadow.mapSize.set(Crc.shadowResolution,Crc.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function Erc(a,b){return[[a[0][0]*b[0][0]+a[0][1]*b[1][0],a[0][0]*b[0][1]+a[0][1]*b[1][1]],[a[1][0]*b[0][0]+a[1][1]*b[1][0],a[1][0]*b[0][1]+a[1][1]*b[1][1]]]}function Frc(a){return[[a[0][0],a[1][0]],[a[0][1],a[1][1]]]}(a=>{function b(a){return[a[0],a[3],a[1],a[4],a[2],a[5]]}a.identity=function(){return[1,0,0,0,1,0,0,0,1]},a.copy=function(b,c=a.identity()){for(let d=0,e=b.length;d<e;d++)c[d]=b[d];return c},a.create=function(b,c,d,e,f,g){return a.setAbcdef(a.identity(),b,c,d,e,f,g)},a.setAbcdef=function(a,b,c,d,e,f,g){return a[0]=b,a[1]=d,a[2]=f,a[3]=c,a[4]=e,a[5]=g,a},a.append=function(c,d){let[e,f,g,h,i,j]=b(c),[k,l,m,n,o,p]=b(d);return a.create(k*e+l*g,k*f+l*h,m*e+n*g,m*f+n*h,o*e+p*g+i,o*f+p*h+j)},a.prepend=function(c,d){let[e,f,g,h,i,j]=b(c),[k,l,m,n,o,p]=b(d),q=e,r=f,s=g,t=h;return(1!==k||0!==l||0!==m||1!==n)&&(q=e*k+f*m,r=e*l+f*n,s=g*k+h*m,t=g*l+h*n),a.create(q,r,s,t,i*k+j*m+o,i*l+j*n+p)},a.getAbcdef=b,a.invert=function(b){let[c,d,e,f,g,h]=a.getAbcdef(b),i=c*f-d*e;return a.create(f/i,-d/i,-e/i,c/i,(e*h-f*g)/i,-(c*h-d*g)/i)},a.apply=function([b,c],d){let[e,f,g,h,i,j]=a.getAbcdef(d);return[e*b+g*c+i,f*b+h*c+j]},a.applyInverse=function(b,c){let[d,e,f,g,h,i]=a.getAbcdef(c),j=1/(d*g+ -(f*e)),[k,l]=b;return[g*j*k+ -f*j*l+(i*f-h*g)*j,d*j*l+ -e*j*k+(-i*d+h*e)*j]},a.scale=function(b,c,d=c){let[e,f,g,h,i,j]=a.getAbcdef(b);return a.setAbcdef(b,e*c,f*d,g*c,h*d,i*c,j*d),b},a.rotate=function(b,c){let d=Math.cos(c),e=Math.sin(c),[f,g,h,i,j,k]=a.getAbcdef(b);return a.setAbcdef(b,f*d-g*e,f*e+g*d,h*d-i*e,h*e+i*d,j*d-k*e,j*e+k*d),b},a.rotateAround=function(b,c,d){let[e,f]=d,g=a.translate(b,-e,-f);return g=a.rotate(g,c),g=a.translate(g,e,f)},a.translate=function(b,c,d){let[e,f,g,h,i,j]=a.getAbcdef(b);return a.setAbcdef(b,e,f,g,h,i+c,j+d),b},a.setTranslate=function(b,c,d){let[e,f,g,h]=a.getAbcdef(b);return a.setAbcdef(b,e,f,g,h,c,d),b},a.setPosition=function(b,c,d){let[e,f,g,h]=a.getAbcdef(b);return a.setAbcdef(b,e,f,g,h,c,d),b},a.getScale=function(b){let[c,d,e,f]=a.getAbcdef(b),g=Math.sqrt(c*c+d*d),h=Math.sqrt(e*e+f*f);return[g,h]},a.getPosition=function(b){let[,,,,c,d]=a.getAbcdef(b);return[c,d]},a.getRotation=function(b,c){return a.decompose(b,c).rotation},a.decompose=function(b,c){let[d,e,f,g,h,i]=a.getAbcdef(b),{rotation:j,scale:k,shear:l}=function(a){var b;let c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,[r,s,t]=(c=((b=a)[0][0]+b[1][1])/2,d=(b[0][0]-b[1][1])/2,e=(b[1][0]+b[0][1])/2,f=(b[1][0]-b[0][1])/2,g=Math.sqrt(c*c+f*f),h=Math.sqrt(d*d+e*e),i=g+h,j=g-h,k=Math.atan2(e,d),l=Math.atan2(f,c),m=(l-k)/2,n=(l+k)/2,o=[[Math.cos(n),Math.sin(n)],[-Math.sin(n),Math.cos(n)]],p=[[i,0],[0,j]],q=[[Math.cos(m),Math.sin(m)],[-Math.sin(m),Math.cos(m)]],o[0][0]*=-1,o[0][1]*=-1,q[0][0]*=-1,q[1][0]*=-1,[o,p,q]),u=Erc(r,Frc(t)),v=Erc(Erc(t,s),Frc(t)),w=Math.atan2(u[1][0],u[0][0]),x=[v[0][0],v[1][1]],y=[v[0][1]/v[1][1],v[1][0]/v[0][0]];return{rotation:w,scale:x,shear:y}}([[d,f],[e,g]]);return{position:[h+(c[0]*d+c[1]*f)-c[0],i+(c[0]*e+c[1]*g)-c[1]],scale:k,rotation:j,shear:l,pivot:c}},a.compose=function(b,c,d,e,f=[0,0]){let[g,h]=b,[i,j]=e,[k,l,m,n]=function({rotation:a,scale:b,shear:c}){let d=Math.cos(a),e=Math.sin(a),f=Erc([[d,-e],[e,d]],[[b[0],c[0]*b[1]],[c[1]*b[0],b[1]]]);return[f[0][0],f[1][0],f[0][1],f[1][1]]}({rotation:d,scale:c,shear:f});return a.create(k,l,m,n,g-(i*k+j*m)+i,h-(i*l+j*n)+j)}})(Gtc||(Gtc={})),Math.PI;var Grc=Math.PI/180,Hrc=class{constructor(Irc,Jrc,Krc){var Lrc;this.uuid=Irc,this.data=Jrc,this.localMatrix=Gtc.identity(),this.worldMatrix=Gtc.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new Ktc,this._recursiveBBox=new Ktc,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter={all:Lrc=Lrc||new Map,on:function(a,b){var c=Lrc.get(a);c?c.push(b):Lrc.set(a,[b])},off:function(a,b){var c=Lrc.get(a);c&&(b?c.splice(c.indexOf(b)>>>0,1):Lrc.set(a,[]))},emit:function(a,b){var c=Lrc.get(a);c&&c.slice().map(function(a){a(b)}),(c=Lrc.get("*"))&&c.slice().map(function(c){c(a,b)})}},this.dpr=Krc.dpr??1,this.dataPatched=Jrc}project(Mrc,Nrc){let Orc=this.worldMatrix;return Nrc&&(Orc=Gtc.append(Nrc.worldMatrix,Orc)),Gtc.applyInverse(Mrc,Orc)}intersects(Prc,Qrc,Rrc,Src=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([Prc,Qrc],Rrc),Src)}intersectsInLocalSpace(Trc,Urc,Vrc=!1){let{min:Wrc,max:Xrc}=Vrc?this.recursiveBBox:this.singleBBox;return Trc>=Wrc[0]&&Trc<=Xrc[0]&&Urc>=Wrc[1]&&Urc<=Xrc[1]}applyTransforms(Yrc){Yrc.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=Gtc.compose(this.position,this.scale,this.rotation*Grc,yOa.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(Zrc,$rc,_rc){let asc=this.parent;$rc&&null!=asc&&asc.updateWorldMatrix(Zrc,!0,!1),Zrc&&this.updateLocalMatrix(),this.parent?this.worldMatrix=Gtc.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=Gtc.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return yOa.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(a=>{a.resetBBoxNeedsUpdateSelf()})}updateTransformState(bsc){let csc=!1;void 0!==bsc.position&&(csc=!0,this.position=bsc.position),void 0!==bsc.rotation&&(csc=!0,this.rotation=bsc.rotation),void 0!==bsc.scale&&(csc=!0,this.scale=bsc.scale),void 0!==bsc.shear&&(csc=!0,this.shear=bsc.shear),csc&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(dsc,esc,fsc){0===dsc.type&& void 0!==dsc.props.visible&&(this.visible=dsc.props.visible),this.data=esc,this.data=esc;let gsc=dsc,hsc=TFa(dsc.path,["states","*"]);if(null!==hsc){if(0===dsc.type){let[isc]=hsc;if(this?.stateSelection===isc){let jsc={...dsc.props};if(delete jsc.name,Object.values(dsc.props).some(a=>void 0===a)){let ksc=this.data;if(void 0!==ksc){let lsc=aGa.zoom(ksc,dsc.path.slice(2));if(lsc)for(let msc in dsc.props)void 0===dsc.props[msc]&&msc in lsc&&(jsc[msc]=lsc[msc])}}gsc={...dsc,props:jsc,path:dsc.path.slice(2)}}}}else if(0===dsc.type){let nsc=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==nsc){if(void 0!==dsc.props.name&&nsc.name){let{name:osc,...psc}=nsc;nsc=psc}let qsc=aGa.removeOverridden(dsc.path,dsc.props,nsc);gsc={...dsc,props:qsc}}}this.updateByPatchedOpBase(gsc,nOa.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),fsc)}changeSelectedState(rsc,ssc,tsc=!1){if(!(0===this.data.states.length&&!tsc)){for(let usc of this.data.states)nOa.toOps(this.data,usc.data).forEach(a=>{let b=ZFa.replaceProps(a,this.data);this.dataPatched=this.data,this.updateByPatchedOp(b,this.data,ssc)});if(null!==rsc){let vsc=this.data.states.data(rsc);vsc&&(this.dataPatched=nOa.patch(this.data,vsc),nOa.toOps(this.data,vsc).forEach(a=>{this.updateByPatchedOp(a,this.dataPatched,ssc)}))}tsc&&this.updateTransformState(this.dataPatched),this.stateSelection=rsc}}updateState(wsc,xsc){void 0!==wsc.name&&(this.name=wsc.name),void 0!==wsc.visible&&(this.visible=wsc.visible),this.updateTransformState(wsc)}updateByPatchedOpBase(ysc,zsc,Asc){this.dataPatched=zsc,this.updateByPatchedOp(ysc,zsc,Asc)}updateByPatchedOp(Bsc,Csc,Dsc){0===Bsc.path.length&&0===Bsc.type&&this.updateState(Bsc.props,Dsc),this.requestRender()}traverseFrameAncestors(Esc){this.traverseAncestors(a=>{"frame2d"===a.data.type&&Esc(a)})}traverseAncestors(Fsc){let Gsc=this.parent;for(;Gsc;)Fsc(Gsc),Gsc=Gsc.parent}requestRender(){this.traverseFrameAncestors(a=>{a.requestRender()})}clone(Hsc){let Isc=new Hrc(this.uuid,this.data,Hsc);return Isc.parent=void 0,Isc}addEventListener(Jsc,Ksc){this.emitter.on(Jsc,Ksc)}removeEventListener(Lsc,Msc){this.emitter.off(Lsc,Msc)}dispatchEvent(Nsc){this.emitter.emit(Nsc.type,{...Nsc,target:Nsc.target??this})}traverseSortNextHelper(){let Osc=this.parent;if(Osc){let Psc=Osc.children;if(Psc){let Qsc=Psc.indexOf(this)+1;return Psc[Qsc]?Psc[Qsc]:Osc.traverseSortNextHelper()}}}sortNext(){let Rsc=this.children;return Rsc&&Rsc.length>0&&Rsc[0]?Rsc[0]:this.traverseSortNextHelper()}isDescendantOf(Ssc){Ssc instanceof Hrc&&(Ssc=Ssc.uuid);let Tsc=this;for(;Tsc.parent;){if(Tsc.parent.uuid===Ssc)return!0;Tsc=Tsc.parent}return!1}},Usc=class extends Hrc{constructor(Vsc,Wsc,Xsc){super(Vsc,Wsc,Xsc),this.uuid=Vsc,this.data=Wsc,this.context=Xsc,this.children=[]}add(Ysc){Ysc.parent&&Ysc.parent instanceof Usc&&Ysc.parent.remove(Ysc),this.children.push(Ysc),Ysc.parent=this}remove(Zsc){let $sc=this.children.indexOf(Zsc);$sc>=0&&(this.children.splice($sc,1),Zsc.parent=void 0)}traverse(_sc){let atc=_sc(this);if(!0!==atc)for(let btc of this.children)btc instanceof Usc?btc.traverse(_sc):atc=_sc(btc)}intersectsChildren(ctc,dtc,etc,ftc=!1,gtc=[],htc=!1){for(let itc of this.children){let jtc=itc instanceof vtc;if(itc instanceof Usc&&!jtc&&htc&&itc.intersectsChildren(ctc,dtc,etc,ftc,gtc,!1),itc.intersects(ctc,dtc,etc,jtc)&&(gtc.push(itc),ftc))break}return gtc}updateWorldMatrix(ktc,ltc,mtc){if(super.updateWorldMatrix(ktc,ltc,mtc),mtc&&this.children)for(let ntc of this.children)ntc.updateWorldMatrix(ktc,!1,!0)}find(otc){let ptc;return this.traverse(a=>{a.uuid===otc&&(ptc=a)}),ptc}innerDrawChildren(qtc){for(let rtc=this.children.length-1;rtc>=0;rtc--)this.children[rtc].draw(qtc)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse(a=>{a.resetBBoxNeedsUpdateSelf()})}clone(stc){let ttc=new Usc(this.uuid,this.data,stc);for(let utc of(ttc.parent=void 0,this.children))ttc.add(utc.clone(stc));return ttc}},vtc=class extends Usc{constructor(wtc,xtc,ytc){super(wtc,xtc,ytc),this.uuid=wtc,this.data=xtc,this.updateState(xtc,ytc)}draw(ztc){this.visible&&(ztc.save(),this.applyTransforms(ztc),this.innerDrawChildren(ztc),ztc.restore())}clone(Atc){let Btc=new vtc(this.uuid,this.data,Atc);for(let Ctc of(Btc.parent=void 0,this.children))Btc.add(Ctc.clone(Atc));return Btc}};function Dtc(a,b){let[[c,d],[e,f]]=a,[[g,h],[i,j]]=b,k=(c-e)*(h-j)-(d-f)*(g-i);if(0===k)return!1;let l=((c-g)*(h-j)-(d-h)*(g-i))/k,m=-((c-e)*(d-h)-(d-f)*(c-g))/k;return l>=0&&l<=1&&m>=0&&m<=1}var Etc,Ftc,Gtc,Htc,Itc=[[-1,1],[-1,-1],[1,-1],[1,1]],Jtc=(a,b,c)=>{let d=a.getCenter(),e=a.getHalfSize(),f=Gtc.append(b,a.worldMatrix);0===e[0]&&0===e[1]?c.push(Gtc.apply(d,f)):Itc.forEach(a=>{let b=[a[0]*e[0]+d[0],a[1]*e[1]+d[1]];c.push(Gtc.apply(b,f))})},Ktc=class{constructor(){this.matrix=Gtc.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(Ltc,Mtc=!1){Ltc.updateWorldMatrix(),this.makeEmpty(),Gtc.copy(Ltc.worldMatrix,this.matrix);let Ntc=Gtc.invert(Ltc.worldMatrix);this.expandByObjectSize(Ltc,Ntc,Mtc)}expandByObjectSize(Otc,Ptc,Qtc=!1){let Rtc=[];!0===Qtc&&Otc instanceof Usc?Otc.traverse(a=>{a.visible&&Jtc(a,Ptc,Rtc)}):Jtc(Otc,Ptc,Rtc),this.setFromPoints(Rtc)}getCenter(){let[Stc,Ttc]=this.min,[Utc,Vtc]=this.getHalfSize();return Gtc.apply([Stc+Utc,Ttc+Vtc],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[(this.max[0]-this.min[0])*.5,(this.max[1]-this.min[1])*.5]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(Wtc){for(let Xtc of(this.makeEmpty(),Wtc))this.expandByPoint(Xtc)}expandByPoint(Ytc){this.min=[Math.min(this.min[0],Ytc[0]),Math.min(this.min[1],Ytc[1])],this.max=[Math.max(this.max[0],Ytc[0]),Math.max(this.max[1],Ytc[1])]}computeVertices(){let[Ztc,$tc]=this.getHalfSize(),_tc=this.getCenter(),[auc,buc,cuc,duc]=Gtc.getAbcdef(this.matrix),euc=Gtc.create(auc,buc,cuc,duc,_tc[0],_tc[1]);this.vertices=Itc.map(([a,b])=>Gtc.apply([a*Ztc,b*$tc],euc))}computeEdges(){this.edges=[];for(let fuc=0,guc=this.vertices.length;fuc<guc;++fuc)this.edges.push([this.vertices[fuc],this.vertices[(fuc+1)%guc]])}project(huc,iuc){let juc=this.matrix;return iuc&&(juc=Gtc.append(iuc.worldMatrix,juc)),Gtc.applyInverse(huc,juc)}intersects(kuc,luc,muc){return this.intersectsInLocalSpace(...this.project([kuc,luc],muc))}intersectsInLocalSpace(nuc,ouc){let{min:puc,max:quc}=this;return nuc>=puc[0]&&nuc<=quc[0]&&ouc>=puc[1]&&ouc<=quc[1]}containsPoint(ruc){let[suc,tuc]=ruc,[uuc,vuc]=this.min,[wuc,xuc]=this.max;return suc>=uuc&&suc<=wuc&&tuc>=vuc&&tuc<=xuc}intersectsBBox2D(yuc){for(let zuc=0,Auc=this.edges.length;zuc<Auc;zuc++){let Buc=this.edges[zuc];for(let Cuc=0,Duc=yuc.edges.length;Cuc<Duc;Cuc++)if(Dtc(Buc,yuc.edges[Cuc]))return!0}for(let Euc=0,Fuc=yuc.vertices.length;Euc<Fuc;Euc++){let Guc=yuc.vertices[Euc];if(this.containsPoint(Guc))return!0}return!1}ensureMinMax(){let Huc=this.min,Iuc=this.max;this.min=[Math.min(Huc[0],Iuc[0]),Math.min(Huc[1],Iuc[1])],this.max=[Math.max(Huc[0],Iuc[0]),Math.max(Huc[1],Iuc[1])]}copy(Juc){this.min=[...Juc.min],this.max=[...Juc.max],Gtc.copy(Juc.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let Kuc=new Ktc;return Kuc.copy(this),Kuc}},Luc=new Promise(a=>{Htc=a}),Muc=!1;function Nuc(a){let b=!1;return a.scene.objects.traverse((a,c)=>{("Mesh"===c.type&&"UIGeometry"===c.geometry.type||"Page"===c.type&& void 0!==c.uiFrame)&&(b=!0)}),b}async function Ouc(a){let b=await Luc;pxc||(qxc||(qxc=b({locateFile:()=>a})),pxc=await qxc)}var Puc=Gtc.identity(),Quc=class{constructor(Ruc,Suc=1){this.canvas=Ruc,this.dpr=Suc,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=AJa.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=AJa.transparent,this._fonts=new Map;try{let Tuc=Ruc.getBoundingClientRect();Ruc.width=Tuc.width*Suc,Ruc.height=Tuc.height*Suc}catch{console.log(Ruc.width,Suc)}this._currentM3Transform=Puc,this._currentTransform=new Float32Array(Puc)}async init(){if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await Ouc(this.wasmURL),this._surface=pxc.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas(),this._paint=new pxc.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(pxc.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(pxc.PaintStyle.Stroke),this.ctx?.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(Uuc){this._currentM3Transform=Uuc,this._currentTransform.set(Uuc)}async loadFont(Vuc,Wuc){let Xuc=await (await fetch(Vuc)).arrayBuffer();this.registerFont(Xuc,Wuc)}registerFont(Yuc,Zuc){if(this._fonts.has(Zuc))return;let $uc=pxc.FontMgr.FromData(Yuc);if($uc)this._fonts.set(Zuc,$uc);else throw new Error("Invalid font data for "+Zuc)}get width(){return this._width}get height(){return this._height}set strokeColor(_uc){this._paintStroke&&this._paintStroke.setColor(nxc(_uc),pxc.ColorSpace.DISPLAY_P3)}set fillColor(avc){this._paintFill&&this._paintFill.setColor(nxc(avc),pxc.ColorSpace.DISPLAY_P3)}set lineWidth(bvc){this._paintStroke&&this._paintStroke.setStrokeWidth("center"===this._strokeMode?bvc:2*bvc)}set strokeMode(cvc){this._strokeMode=cvc}set dropShadowBlur(dvc){this._dropShadowBlur=dvc}set dropShadowColor(evc){this._dropShadowColor=evc}set dropShadowOffsetX(fvc){this._dropShadowOffsetX=fvc}set dropShadowOffsetY(gvc){this._dropShadowOffsetY=gvc}set innerShadowBlur(hvc){this._innerShadowBlur=hvc}set innerShadowColor(ivc){this._innerShadowColor=ivc}set innerShadowOffsetX(jvc){this._innerShadowOffsetX=jvc}set innerShadowOffsetY(kvc){this._innerShadowOffsetY=kvc}set innerShadowSpread(lvc){this._innerShadowSpread=lvc}set layerBlur(mvc){this._layerBlur=mvc}set backgroundBlur(nvc){this._backgroundBlur=nvc}clear(){this.ctx?.clear(pxc.TRANSPARENT)}save(){this.ctx?.save()}restore(){this.ctx?.restore()}beginPath(){this._currentPath?.delete(),this._currentPath=new pxc.Path}closePath(){let ovc=this._currentPath;if(ovc){if(ovc.isEmpty())return;let pvc=ovc.getBounds();(pvc[3]-pvc[1]||pvc[2]-pvc[0])&&ovc.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(qvc,rvc,svc,tvc,uvc=0,vvc=0,wvc=0,xvc=0){let yvc=pxc.XYWHRect(qvc,rvc,svc,tvc);if(0===uvc&&0===vvc&&0===xvc&&0===wvc)this.ctx?.clipRect(yvc,pxc.ClipOp.Intersect,!0);else{let zvc=pxc.RRectXY(yvc,uvc,uvc);zvc[4]=zvc[5]=uvc,zvc[6]=zvc[7]=vvc,zvc[8]=zvc[9]=wvc,zvc[10]=zvc[11]=xvc,this.ctx?.clipRRect(zvc,pxc.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let Avc=Gtc.invert(this.currentTransform);this.ctx.concat(Avc);let Bvc=Gtc.translate(Gtc.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(Bvc),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(Cvc,Dvc,Evc=!0){if(this.ctx&&this._currentPath){let Fvc,Gvc=!1;if(Evc&&this._hasDropShadow()){let Hvc=Cvc.copy();Hvc.setColor(nxc(this._dropShadowColor));let Ivc;this._dropShadowBlur>0&&(Ivc=pxc.MaskFilter.MakeBlur(pxc.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(this.camera?.scale??1),!1),Hvc.setMaskFilter(Ivc)),this.ctx.save(),this.ctx.clipPath(this._currentPath,pxc.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),Dvc(Hvc),this.ctx.restore(),Hvc.delete(),Ivc?.delete()}if(this._backgroundBlur>0&&Evc){this.ctx.save(),this.ctx.clipPath(this._currentPath,pxc.ClipOp.Intersect,!0);let Jvc=pxc.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,pxc.TileMode.Clamp,null),Kvc=Cvc.copy();Kvc.setImageFilter(Jvc),Kvc.setAlphaf(1);let Lvc=this._currentPath.computeTightBounds();this.ctx.saveLayer(Kvc,Lvc,null,pxc.SaveLayerInitWithPrevious),this.ctx.drawColor(Cvc.getColor()),this.ctx.restore(),this.ctx.restore(),Kvc.delete(),Jvc.delete(),Gvc=!0}if(this._layerBlur>0){let Mvc=Cvc.copy();Fvc=pxc.MaskFilter.MakeBlur(pxc.BlurStyle.Normal,this._layerBlur*this.dpr*(this.camera?.scale??1),!1),Mvc.setMaskFilter(Fvc),Dvc(Mvc),Mvc.delete(),Fvc.delete(),Gvc=!0}if(Gvc||Dvc(Cvc),Evc&&this._hasInnerShadow()){let Nvc=new pxc.Paint;Nvc.setAntiAlias(!0),Nvc.setStyle(pxc.PaintStyle.Fill),Nvc.setColor(nxc(this._innerShadowColor));let Ovc;this._innerShadowBlur>0&&(Ovc=pxc.MaskFilter.MakeBlur(pxc.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(this.camera?.scale??1),!1),Nvc.setMaskFilter(Ovc));let Pvc=this._currentPath.computeTightBounds(),[Qvc,Rvc,Svc,Tvc]=Pvc,Uvc=Svc-Qvc,Vvc=Tvc-Rvc;this.ctx.save(),this.ctx.clipPath(this._currentPath,pxc.ClipOp.Intersect,!0),this.ctx.saveLayer(Nvc,Pvc,null,pxc.SaveLayerInitWithPrevious),this.ctx?.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(pxc.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+Uvc+Math.abs(2*this._innerShadowOffsetX),2e3+Vvc+Math.abs(2*this._innerShadowOffsetY)),Nvc),Nvc.setBlendMode(pxc.BlendMode.Clear),this.ctx.drawPath(this._currentPath,Nvc),this.ctx.restore(),this.ctx.restore(),Nvc.delete(),Ovc?.delete()}}}_paintInner(Wvc,Xvc=!0){if(this.ctx&&this._currentPath&&Wvc){let Yvc=this.ctx,Zvc=this._currentPath;this._applyEffectsToPaint(Wvc,a=>{let b=!1;Xvc||"center"===this._strokeMode||(Yvc.save(),Yvc.clipPath(Zvc,"outside"===this._strokeMode?pxc.ClipOp.Difference:pxc.ClipOp.Intersect,!0),b=!0),Yvc.drawPath(Zvc,a),b&&Yvc.restore()},Xvc)}}_hasDropShadow(){return this._dropShadowColor?.a>0}_hasInnerShadow(){return this._innerShadowColor?.a>0}path($vc){this._currentPath?.addPath(pxc.Path.MakeFromSVGString($vc))}ellipse(_vc,awc,bwc,cwc,dwc,ewc,fwc,gwc){if(!mxc([_vc,awc,bwc,cwc])||!this._currentPath)return;if(bwc<0||cwc<0)throw Error("radii cannot be negative");let hwc=pxc.XYWHRect(_vc-bwc,awc-cwc,2*bwc,2*cwc);this._currentPath?.addOval(hwc)}rect(iwc,jwc,kwc,lwc,mwc=0,nwc=0,owc=0,pwc=0){let qwc=pxc.XYWHRect(iwc,jwc,kwc,lwc);if(mxc(qwc))if(0===mwc&&0===nwc&&0===pwc&&0===owc)this._currentPath?.addRect(qwc);else{let rwc=pxc.RRectXY(qwc,mwc,mwc);rwc[4]=rwc[5]=mwc,rwc[6]=rwc[7]=nwc,rwc[8]=rwc[9]=owc,rwc[10]=rwc[11]=pwc,this._currentPath?.addRRect(rwc)}}getHorizontalAlign(swc){switch(swc){case 2:return pxc.TextAlign.Right;case 3:return pxc.TextAlign.Center;case 4:return pxc.TextAlign.Justify;case 1:default:return pxc.TextAlign.Left}}drawTextInner(twc,uwc,vwc,[wwc,xwc,ywc,zwc],Awc,Bwc,Cwc=!0){let Dwc=0,{ctx:Ewc}=this;if(!Ewc)return Dwc;let Fwc=Bwc.copy(),Gwc=Bwc.copy();return Gwc.setAlphaf(0),this._applyEffectsToPaint(Fwc,a=>{uwc.pushPaintStyle(vwc,a,Gwc),uwc.addText(twc);let b=uwc.build();b.layout(ywc);let c=xwc;2===Awc?c+=(zwc-b.getHeight())/2:3===Awc&&(c+=zwc-b.getHeight()),Ewc.drawParagraph(b,wwc,c),Dwc=b.getHeight(),uwc.reset(),b.delete()},Cwc),Fwc.delete(),Gwc.delete(),Dwc}drawText(Hwc,Iwc){let Jwc=0,Kwc=this._fonts.get(Iwc.font),{ctx:Lwc,_paintFill:Mwc,_paintStroke:Nwc}=this;if(Kwc&&Lwc){let Owc=new pxc.TextStyle({fontFamilies:[Iwc.font],fontSize:Iwc.fontSize,heightMultiplier:Iwc.lineHeight,letterSpacing:Iwc.letterSpacing}),Pwc=new pxc.ParagraphStyle({textStyle:Owc,textAlign:this.getHorizontalAlign(Iwc.horizontalAlign)}),Qwc=pxc.XYWHRect(Iwc.x,Iwc.y,Iwc.width,Iwc.height),Rwc=pxc.ParagraphBuilder.Make(Pwc,Kwc);Mwc&&(Jwc=this.drawTextInner(Hwc,Rwc,Owc,Qwc,Iwc.verticalAlign,Mwc,!0)),Nwc&&(Jwc=this.drawTextInner(Hwc,Rwc,Owc,Qwc,Iwc.verticalAlign,Nwc,!1)),Rwc.delete()}return{height:Jwc}}render(){this._surface?.flush()}moveTo(Swc,Twc){this._currentPath?.moveTo(Swc,Twc)}lineTo(Uwc,Vwc){this._currentPath?.lineTo(Uwc,Vwc)}bezierCurveTo(Wwc,Xwc,Ywc,Zwc,$wc,_wc){this._currentPath?.cubicTo(Wwc,Xwc,Ywc,Zwc,$wc,_wc)}quadraticCurveTo(axc,bxc,cxc,dxc){this._currentPath?.quadTo(axc,bxc,cxc,dxc)}setTransform(exc,fxc=!1){if(!this.ctx)return;let gxc=this.ctx.getTotalMatrix(),hxc=Gtc.invert(gxc);if(hxc&&this.ctx.concat(hxc),this.ctx?.scale(this.dpr,this.dpr),this.camera?.enabled&&(this.ctx?.concat(this.camera.worldMatrix),fxc)){let ixc=Gtc.getScale(this.camera.worldMatrix);this.ctx?.scale(1/ixc[0],1/ixc[1])}this.ctx?.concat(exc),this.currentTransform=exc}transform(jxc){this.ctx?.concat(jxc)}setSize(kxc,lxc){kxc===this._width&&lxc===this._height||(this._width=kxc,this._height=lxc,this.canvas.style.width=kxc+"px",this.canvas.style.height=lxc+"px",this.canvas.width=kxc*this.dpr,this.canvas.height=lxc*this.dpr,this._surface&&(this._surface=pxc.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas()))}};function mxc(a){for(let b=0;b<a.length;b++)if(void 0!==a[b]&&!Number.isFinite(a[b]))return!1;return!0}function nxc({r:a,g:b,b:c,a:d}){return pxc.Color4f(a,b,c,d)}var oxc,pxc,qxc,rxc,sxc,txc,uxc=class{constructor(vxc,wxc,xxc){this.uuid=vxc,this.data=wxc,this.enabled=!1,this.color=AJa.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(wxc)}update(yxc){void 0!==yxc.color&&(this.color=yxc.color),void 0!==yxc.enabled&&(this.enabled=yxc.enabled),void 0!==yxc.blurRadius&&(this.blurRadius=yxc.blurRadius),void 0!==yxc.offset&&(this.offset=yxc.offset),void 0!==yxc.spread&&(this.spread=yxc.spread)}},zxc=class{constructor(Axc,Bxc,Cxc){this.uuid=Axc,this.data=Bxc,this.enabled=!1,this.radius=0,this.update(Bxc)}update(Dxc){void 0!==Dxc.enabled&&(this.enabled=Dxc.enabled),void 0!==Dxc.radius&&(this.radius=Dxc.radius)}},Exc=class extends Hrc{constructor(Fxc,Gxc,Hxc){super(Fxc,Gxc,Hxc),this.uuid=Fxc,this.data=Gxc,this.autoClose=!0,this.fill=new class{constructor(Ixc,Jxc,Kxc){this.uuid=Ixc,this.data=Jxc,this.enabled=!1,this.color=AJa.transparent,this.update(Jxc)}update(Lxc){void 0!==Lxc.enabled&&(this.enabled=Lxc.enabled),void 0!==Lxc.color&&(this.color=Lxc.color)}}(Fxc+"-fill",Gxc.fill,Hxc),this.stroke=new class{constructor(Mxc,Nxc,Oxc){this.uuid=Mxc,this.data=Nxc,this.enabled=!1,this.color=AJa.transparent,this.thickness=0,this.mode="inside",this.update(Nxc)}update(Pxc){void 0!==Pxc.enabled&&(this.enabled=Pxc.enabled),void 0!==Pxc.color&&(this.color=Pxc.color),void 0!==Pxc.thickness&&(this.thickness=Pxc.thickness),void 0!==Pxc.mode&&(this.mode=Pxc.mode)}}(Fxc+"-stroke",Gxc.stroke,Hxc),this.dropShadow=new uxc(Fxc+"-dropShadow",Gxc.dropShadow,Hxc),this.innerShadow=new uxc(Fxc+"-innerShadow",Gxc.innerShadow,Hxc),this.backgroundBlur=new zxc(Fxc+"-backgroundBlur",Gxc.backgroundBlur,Hxc),this.layerBlur=new zxc(Fxc+"-layerBlur",Gxc.layerBlur,Hxc)}applyFillStroke(Qxc){Qxc.fillColor=this.fill.enabled?this.fill.color:AJa.transparent,Qxc.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:AJa.transparent,Qxc.strokeMode=this.stroke.mode,Qxc.lineWidth=this.stroke.thickness}applyFilters(Rxc){this.layerBlur.enabled?Rxc.layerBlur=5*this.layerBlur.radius:Rxc.layerBlur=0,this.backgroundBlur.enabled?Rxc.backgroundBlur=5*this.backgroundBlur.radius:Rxc.backgroundBlur=0,this.dropShadow.enabled?(Rxc.dropShadowBlur=5*this.dropShadow.blurRadius,Rxc.dropShadowColor=this.dropShadow.color,Rxc.dropShadowOffsetX=this.dropShadow.offset[0],Rxc.dropShadowOffsetY=this.dropShadow.offset[1]):Rxc.dropShadowColor=AJa.transparent,this.innerShadow.enabled?(Rxc.innerShadowSpread=this.innerShadow.spread,Rxc.innerShadowBlur=5*this.innerShadow.blurRadius,Rxc.innerShadowColor=this.innerShadow.color,Rxc.innerShadowOffsetX=this.innerShadow.offset[0],Rxc.innerShadowOffsetY=this.innerShadow.offset[1]):Rxc.innerShadowColor=AJa.transparent}innerDraw(Sxc){}draw(Txc){this.visible&&(Txc.save(),this.applyTransforms(Txc),this.applyFilters(Txc),this.applyFillStroke(Txc),Txc.beginPath(),this.innerDraw(Txc),this.autoClose&&Txc.closePath(),this.fill.enabled&&Txc.fill(),this.stroke.enabled&&Txc.stroke(),Txc.restore())}updateByPatchedOp(Uxc,Vxc,Wxc){super.updateByPatchedOp(Uxc,Vxc,Wxc),0===Uxc.type&&(TFa(Uxc.path,["fill"])?this.fill.update(Uxc.props):TFa(Uxc.path,["stroke"])?this.stroke.update(Uxc.props):TFa(Uxc.path,["dropShadow"])?this.dropShadow.update(Uxc.props):TFa(Uxc.path,["innerShadow"])?this.innerShadow.update(Uxc.props):TFa(Uxc.path,["layerBlur"])?this.layerBlur.update(Uxc.props):TFa(Uxc.path,["backgroundBlur"])?this.backgroundBlur.update(Uxc.props):this.resetBBoxNeedsUpdate())}updateState(Xxc,Yxc){super.updateState(Xxc,Yxc),void 0!==Xxc.fill&&this.fill.update(Xxc.fill),void 0!==Xxc.stroke&&this.stroke.update(Xxc.stroke),void 0!==Xxc.dropShadow&&this.dropShadow.update(Xxc.dropShadow),void 0!==Xxc.innerShadow&&this.innerShadow.update(Xxc.innerShadow),void 0!==Xxc.layerBlur&&this.layerBlur.update(Xxc.layerBlur),void 0!==Xxc.backgroundBlur&&this.backgroundBlur.update(Xxc.backgroundBlur)}clone(Zxc){let $xc=new Exc(this.uuid,this.data,Zxc);return $xc.parent=void 0,$xc}},_xc=class extends Exc{constructor(ayc,byc,cyc){super(ayc,byc,cyc),this.uuid=ayc,this.data=byc,this.width=0,this.height=0,this.updateState(byc,cyc)}innerDraw(dyc){dyc.ellipse(.5*this.width,.5*this.height,.5*this.width,.5*this.height,0,0,2*Math.PI)}intersectsInLocalSpace(eyc,fyc){var gyc,hyc,iyc,jyc,kyc,lyc;let myc,nyc;return gyc=eyc,hyc=fyc,iyc=.5*this.width,jyc=.5*this.height,kyc=.5*this.width,lyc=.5*this.height,(myc=gyc-iyc)*myc/(kyc*kyc)+(nyc=hyc-jyc)*nyc/(lyc*lyc)<=1}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateSizeState(oyc){let pyc=!1;void 0!==oyc.width&&(this.width="number"==typeof oyc.width?oyc.width:this.width,pyc=!0),void 0!==oyc.height&&(this.height="number"==typeof oyc.height?oyc.height:this.height,pyc=!0),pyc&&this.updateWorldMatrix(!0,!1,!0)}updateState(qyc,ryc){super.updateState(qyc,ryc),this.updateSizeState(qyc)}clone(syc){let tyc=new _xc(this.uuid,this.data,syc);return tyc.parent=void 0,tyc}},uyc=class extends Exc{constructor(vyc,wyc,xyc){super(vyc,wyc,xyc),this.uuid=vyc,this.data=wyc,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(wyc,xyc)}innerDraw(yyc){yyc.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateCornerState(zyc){void 0!==zyc.cornerRadius&&(this.cornerRadius=zyc.cornerRadius)}updateSizeState(Ayc){let Byc=!1;void 0!==Ayc.width&&(this.width="number"==typeof Ayc.width?Ayc.width:this.width,Byc=!0),void 0!==Ayc.height&&(this.height="number"==typeof Ayc.height?Ayc.height:this.height,Byc=!0),Byc&&this.updateWorldMatrix(!0,!1,!0)}updateState(Cyc,Dyc){super.updateState(Cyc,Dyc),this.updateSizeState(Cyc),this.updateCornerState(Cyc)}clone(Eyc){let Fyc=new uyc(this.uuid,this.data,Eyc);return Fyc.parent=void 0,Fyc}},Gyc=class extends Exc{constructor(Hyc,Iyc,Jyc){super(Hyc,Iyc,Jyc),this.uuid=Hyc,this.data=Iyc,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(Iyc,Jyc)}get textHeight(){return this._textHeight}applyFillStroke(Kyc){Kyc.fillColor=this.fill.enabled?this.fill.color:AJa.transparent,Kyc.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:AJa.transparent,Kyc.strokeMode="center",Kyc.lineWidth=this.stroke.thickness}innerDraw(Lyc){this._fontHolder?.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&Lyc.registerFont(this._fontHolder.arrayBuffer,this.data.font);let Myc=this.data.textTransform,Nyc=this.data.text.textValue.toString(),Oyc=2===Myc?Nyc.toUpperCase():3===Myc?Nyc.toLowerCase():Nyc,{height:Pyc}=Lyc.drawText(Oyc,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=Pyc}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateSizeState(Qyc){let Ryc=!1;void 0!==Qyc.width&&(this.width="number"==typeof Qyc.width?Qyc.width:this.width,Ryc=!0),void 0!==Qyc.height&&(this.height="number"==typeof Qyc.height?Qyc.height:this.height,Ryc=!0),Ryc&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(Syc,{shared:Tyc}){void 0!==Syc.font&&(this._fontHolder=Tyc.getFont(Syc.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then(()=>{this.requestRender()}))}updateState(Uyc,Vyc){super.updateState(Uyc,Vyc),this.updateSizeState(Uyc),this.updateFontState(Uyc,Vyc)}clone(Wyc){let Xyc=new Gyc(this.uuid,this.data,Wyc);return Xyc.parent=void 0,Xyc}},Yyc=class extends Exc{constructor(Zyc,$yc,_yc){super(Zyc,$yc,_yc),this.uuid=Zyc,this.data=$yc,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState($yc,_yc)}computeExtremas(){0===this.curves.length&&this.computeCurves();let azc=this.curves.map(a=>rxc.extremas(a)),bzc=[1/0,1/0],czc=[-1/0,-1/0];for(let dzc=0,ezc=azc.length;dzc<ezc;dzc++){let fzc=azc[dzc];fzc[0][0]<bzc[0]&&(bzc[0]=fzc[0][0]),fzc[0][1]<bzc[1]&&(bzc[1]=fzc[0][1]),fzc[1][0]>czc[0]&&(czc[0]=fzc[1][0]),fzc[1][1]>czc[1]&&(czc[1]=fzc[1][1])}return this.extremasBBox.min=[bzc[0],bzc[1]],this.extremasBBox.max=[czc[0],czc[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let gzc=1,hzc=this.data.points.length;gzc<hzc;gzc++){let izc=this.data.points[gzc].data,jzc=this.data.points[gzc-1].data,kzc={start:jzc.position,cp1:jzc.controlNext.position,cp2:izc.controlPrevious.position,end:izc.position};this.curves.push(kzc)}let lzc=this.data.points[0].data,mzc=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let nzc={start:mzc.position,cp1:mzc.controlNext.position,cp2:lzc.controlPrevious.position,end:lzc.position};this.curves.push(nzc)}}getCenter(){let[ozc,pzc]=this.extremasBBox.min,[qzc,rzc]=this.getHalfSize();return[ozc+qzc,pzc+rzc]}getHalfSize(){let{min:szc,max:tzc}=this.extremasBBox;return[(tzc[0]-szc[0])*.5,(tzc[1]-szc[1])*.5]}innerDraw(uzc){for(let vzc=0,wzc=this.data.points.length;vzc<wzc;vzc++){let xzc=this.data.points[vzc].data;if(0===vzc){let[yzc,zzc]=xzc.position;uzc.moveTo(yzc,zzc)}else{let Azc=this.data.points[vzc-1].data,[Bzc,Czc]=Azc.controlNext.position,[Dzc,Ezc]=xzc.controlPrevious.position,[Fzc,Gzc]=xzc.position,Hzc={start:Azc.position,cp1:Azc.controlNext.position,cp2:xzc.controlPrevious.position,end:xzc.position};rxc.derive(Hzc),uzc.bezierCurveTo(Bzc,Czc,Dzc,Ezc,Fzc,Gzc)}}let Izc=this.data.points[0].data,Jzc=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[Kzc,Lzc]=Jzc.controlNext.position,[Mzc,Nzc]=Izc.controlPrevious.position,[Ozc,Pzc]=Izc.position;uzc.bezierCurveTo(Kzc,Lzc,Mzc,Nzc,Ozc,Pzc)}}updateState(Qzc,Rzc){super.updateState(Qzc,Rzc),this.computeExtremas()}clone(Szc){let Tzc=new Yyc(this.uuid,this.data,Szc);return Tzc.parent=void 0,Tzc}};(a=>{function b(a,b,c,d=!1){let e=a-2*b+c;if(0!==e){let f=-Math.sqrt(Math.abs(b*b-a*c)),g=-a+b,h=-(f+g)/e,i=-(-f+g)/e;return[h,i]}return b!==c&&0===e?[(2*b-c)/(2*(b-c))]:[]}a.derive=function(a){let b=a.start,c=a.cp1,d=a.cp2,e=a.end,f={start:[3*(c[0]-b[0]),3*(c[1]-b[1])],cp:[3*(d[0]-c[0]),3*(d[1]-c[1])],end:[3*(e[0]-d[0]),3*(e[1]-d[1])]};return a.derivative=f,f.derivative=sVc.derive(f),f},a.droot=function(c){let d=c.derivative??a.derive(c),e=d.start,f=d.cp,g=d.end;return[b(e[0],f[0],g[0]),b(e[1],f[1],g[1])]},a.extremas=function(b){let[c,d]=a.droot(b),e=[b.start[0],b.end[0]],f=[b.start[1],b.end[1]];for(let g of c)e.push(a.compute(b,Math.min(1,Math.max(0,g)))[0]);for(let h of d)f.push(a.compute(b,Math.min(1,Math.max(0,h)))[1]);return e.sort((a,b)=>a-b),f.sort((a,b)=>a-b),[[e[0],f[0]],[e[e.length-1],f[f.length-1]]]},a.compute=function(a,b){if(0===b)return[...a.start];if(1===b)return[...a.end];let c=1-b,d=c*c,e=b*b,f=d*c,g=d*b*3,h=c*e*3,i=b*e;return[f*a.start[0]+g*a.cp1[0]+h*a.cp2[0]+i*a.end[0],f*a.start[1]+g*a.cp1[1]+h*a.cp2[1]+i*a.end[1]]}})(rxc||(rxc={})),(sxc=sVc||(sVc={})).derive=function(a){let b=a.start,c=a.cp,d=a.end,e={start:[2*(c[0]-b[0]),2*(c[1]-b[1])],end:[2*(d[0]-c[0]),2*(d[1]-c[1])]};return e.derivative=tVc.derive(e),a.derivative=e,e},sxc.droot=function(a){let b=a.derivative??sxc.derive(a),c=b.start,d=b.end;return[c[0]!==d[0]?c[0]/(c[0]-d[0]):0,c[1]!==d[1]?c[1]/(c[1]-d[1]):0]},sxc.compute=function(a,b){if(0===b)return[...a.start];if(1===b)return[...a.end];let c=1-b,d=c*c,e=b*b,f=d,g=c*b*2,h=e;return[f*a.start[0]+g*a.cp[0]+h*a.end[0],f*a.start[1]+g*a.cp[1]+h*a.end[1]]},(txc=tVc||(tVc={})).derive=function(a){let b=a.start,c=a.end,d=[c[0]-b[0],c[1]-b[1]];return a.derivative=d,a.derivative},txc.compute=function(a,b){if(0===b)return[...a.start];if(1===b)return[...a.end];let c=a.start,d=a.end;return[c[0]+(d[0]-c[0])*b,c[1]+(d[1]-c[1])*b]};var Uzc=class extends Usc{constructor(Vzc,Wzc,Xzc){super(Vzc,Wzc,Xzc),this.uuid=Vzc,this.width=0,this.height=0,this.clipped=!0,this.background=new uyc(Vzc+"-background",sOa.defaultData,Xzc),this.background.parent=this,this.updateState(Wzc,Xzc)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(Yzc){this.background.cornerRadius=Yzc}updateLocalMatrix(){super.updateLocalMatrix(),this.background?.updateLocalMatrix()}updateWorldMatrix(Zzc,$zc,_zc){super.updateWorldMatrix(Zzc,$zc,_zc),this.background?.updateWorldMatrix(Zzc,$zc,_zc)}draw(aAc){if(!this.visible)return;aAc.save();let bAc=this.width,cAc=this.height;this.applyTransforms(aAc),this.background.width=bAc,this.background.height=cAc,this.background.draw(aAc),this.clipped&&aAc.clipRect(0,0,bAc,cAc,...this.cornerRadius),this.innerDrawChildren(aAc),aAc.restore()}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateCornerState(dAc){void 0!==dAc.cornerRadius&&(this.cornerRadius=dAc.cornerRadius)}updateSizeState(eAc){let fAc=!1;void 0!==eAc.width&&(this.width="number"==typeof eAc.width?eAc.width:this.width,fAc=!0),void 0!==eAc.height&&(this.height="number"==typeof eAc.height?eAc.height:this.height,fAc=!0),fAc&&this.updateWorldMatrix(!0,!1,!0)}updateState(gAc,hAc){super.updateState(gAc,hAc),this.updateSizeState(gAc),this.updateCornerState(gAc),void 0!==gAc.fill&&this.fill.update(gAc.fill),void 0!==gAc.stroke&&this.stroke.update(gAc.stroke),void 0!==gAc.dropShadow&&this.dropShadow.update(gAc.dropShadow),void 0!==gAc.innerShadow&&this.innerShadow.update(gAc.innerShadow),void 0!==gAc.layerBlur&&this.layerBlur.update(gAc.layerBlur),void 0!==gAc.backgroundBlur&&this.backgroundBlur.update(gAc.backgroundBlur),void 0!==gAc.clipped&&(this.clipped=gAc.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(iAc,jAc,kAc){super.updateByPatchedOp(iAc,jAc,kAc),0===iAc.type&&(TFa(iAc.path,["fill"])?this.fill.update(iAc.props):TFa(iAc.path,["stroke"])?this.stroke.update(iAc.props):TFa(iAc.path,["dropShadow"])?this.dropShadow.update(iAc.props):TFa(iAc.path,["innerShadow"])?this.innerShadow.update(iAc.props):TFa(iAc.path,["layerBlur"])?this.layerBlur.update(iAc.props):TFa(iAc.path,["backgroundBlur"])?this.backgroundBlur.update(iAc.props):this.resetBBoxNeedsUpdate())}clone(lAc){let mAc=new Uzc(this.uuid,this.data,lAc);for(let nAc of(mAc.parent=void 0,this.children))mAc.add(nAc.clone(lAc));return mAc}},oAc=r(B(),1),pAc=class extends Exc{constructor(qAc,rAc,sAc){super(qAc,rAc,sAc),this.uuid=qAc,this.data=rAc,this._pathBBox=new DOMRect,this.path="",this.updateState(rAc,sAc),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let tAc=document.createElementNS("http://www.w3.org/2000/svg","svg"),uAc=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(tAc),uAc.setAttribute("d",this.path),tAc.appendChild(uAc),this._pathBBox=uAc.getBBox(),tAc.remove()}innerDraw(vAc){vAc.path(this.path)}intersectsInLocalSpace(wAc,xAc){return wAc>=this._pathBBox.x&&wAc<=this._pathBBox.x+this._pathBBox.width&&xAc>=this._pathBBox.y&&xAc<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(yAc,zAc){super.updateState(yAc,zAc),void 0!==yAc.path&&(this.path=yAc.path,this.computeSVGBBox())}clone(AAc){let BAc=new pAc(this.uuid,this.data,AAc);return BAc.parent=void 0,BAc}},CAc=class{constructor(DAc,EAc,FAc){this.uuid=DAc,this.data=EAc,this.group=new vtc(CAc.GROUP_ID,{...wOa.defaultData},FAc),this.createChildrenObjects(EAc.objects,this.group,FAc)}createObject(GAc,HAc,IAc,JAc,KAc,LAc){let MAc=function(a,b,c){switch(b.type){case"ellipse2d":return new _xc(a,b,c);case"rectangle2d":return new uyc(a,b,c);case"text2d":return new Gyc(a,b,c);case"vector2d":return new Yyc(a,b,c);case"path2d":return new pAc(a,b,c);case"frame2d":return new Uzc(a,b,c);case"group2d":default:return new vtc(a,b,c)}}(GAc,HAc,LAc);MAc&&(JAc.add(MAc),JAc.children.splice(KAc,0,JAc.children.pop()),MAc.updateWorldMatrix(),IAc.length>0&&(MAc instanceof vtc||MAc instanceof Uzc)&&this.createChildrenObjects(IAc,MAc,LAc))}createChildrenObjects(NAc,OAc,PAc){let QAc=0;for(let RAc of NAc)this.createObject(RAc.id,RAc.data,RAc.children,OAc,QAc,PAc),QAc+=1}draw(SAc){this.group.draw(SAc)}updateEntityByOp(TAc,UAc,VAc,WAc){let XAc=this.find(TAc);if(XAc)try{XAc.updateByOp(UAc,VAc,{shared:WAc})}catch(YAc){console.error(YAc)}}updateTreeByOp(ZAc,$Ac){if(0===ZAc.path.length&&7===ZAc.type){let _Ac=null===ZAc.parent?this.group:this.find(ZAc.parent);void 0!==_Ac&&_Ac instanceof Usc&&(this.createObject(ZAc.id,ZAc.data,ZAc.children,_Ac,ZAc.localIndex,$Ac),_Ac.requestRender())}else if(0===ZAc.path.length&&8===ZAc.type){let aBc=this.find(ZAc.id);if(void 0!==aBc&& void 0!==aBc.parent&&aBc.parent instanceof Usc){let bBc=aBc.parent;aBc.resetBBoxNeedsUpdate(),bBc?.remove(aBc),bBc?.requestRender()}}else if(0===ZAc.path.length&&9===ZAc.type){let cBc=this.find(ZAc.id);if(void 0!==cBc){let dBc=cBc.parent,eBc=null===ZAc.parent?this:this.find(ZAc.parent);if(eBc instanceof Usc||eBc===this){eBc.add(cBc);let fBc=ZAc.localIndex;eBc.children.splice(fBc,0,eBc.children.pop()),cBc.updateWorldMatrix(!0,!1,!0),dBc?.requestRender(),cBc.requestRender()}cBc.resetBBoxNeedsUpdate()}}}add(gBc){this.group.add(gBc)}remove(hBc){this.group.remove(hBc)}traverse(iBc){this.group.traverse(a=>{a!==this.group&&iBc(a)})}intersectsChildren(jBc,kBc,lBc,mBc=!1,nBc=[]){return this.group.intersectsChildren(jBc,kBc,lBc,mBc,nBc,!0)}find(oBc){return this.group.find(oBc)}get children(){return this.group.children}project(pBc,qBc){return this.group.project(pBc,qBc)}getWithSortKey(rBc){let sBc=this.find(rBc);if(void 0===sBc)return;let tBc=[],uBc=sBc;for(;uBc!==this.group;){let vBc=uBc;uBc=uBc.parent;let wBc=uBc.children.indexOf(vBc);tBc.splice(0,0,wBc)}return{entity:sBc,sortKey:tBc}}getAllSorted(xBc){let yBc=[];for(let zBc of xBc){let ABc=this.getWithSortKey(zBc.id);void 0!==ABc&&yBc.push(ABc)}return yBc.sort((a,b)=>Xya(a.sortKey,b.sortKey)),yBc.map(a=>a.entity)}},BBc=CAc;function CBc({constraints:a,newParentWidth:b,newParentHeight:c,initialParentWidth:d,initialParentHeight:e,objectInitialWidth:f,objectInitialHeight:g,objectInitialPosition:h}){let{horizontalConstraint:i,verticalConstraint:j}=a,k=b-d,l=c-e,m=f,n=g,o=h[0],p=h[1];if(0!==i){if(1===i)o+=k;else if(3===i)o+=k/2;else if(2===i)m=Math.max(1,m+k);else if(4===i){let q=b/d;m*=q,o*=q}}if(0!==j){if(1===j)p+=l;else if(3===j)p+=l/2;else if(2===j)n=Math.max(1,n+l);else if(4===j){let r=c/e;n*=r,p*=r}}return{width:m,height:n,position:[o,p]}}BBc.GROUP_ID="scene2d",r(B(),1);var DBc=Gtc.identity(),EBc=class{constructor(FBc,GBc,HBc,IBc){this.uuid=FBc,this.width=GBc,this.height=HBc,this.context=IBc,this.enabled=!0,this.isScreenSpace=!1,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this.onFrameOverrideObjectEvent=a=>{if(a.target?.uuid!==void 0){let b=this.frameRoot?.find(a.target.uuid);b&&b.dispatchEvent({...a,target:b})}},this.scene2d=new BBc(Db.generateUUID(),zOa.defaultData,{dpr:window.devicePixelRatio,shared:IBc.shared}),this.canvas=document.createElement("canvas"),this.renderer=new Quc(this.canvas),IBc.shared.addCanvas(this.uuid,this.canvas),this.textureHolder=IBc.shared.canvas(this.uuid),this.promise=this.init()}async init(){this.renderer instanceof Quc&&(this.renderer.wasmURL=YNb.skiaWasmUrl),await this.renderer.init()}render(){this.isFrameDirty&&(this.renderer.clear(),this.frameOverride?.draw(this.renderer),this.renderer.render(),this.textureHolder?.setNeedsUpdate(!0),this.isFrameDirty=!1)}updateEntity2DByOp(JBc,KBc,LBc,MBc){this.scene2d.updateEntityByOp(JBc,KBc,LBc,MBc),this.applySize()}updateTreeByOp(NBc,OBc){this.scene2d.updateTreeByOp(NBc,OBc),this.applySize()}applyOverrides(PBc){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let QBc=PBc?.width??this.width,RBc=PBc?.height??this.height;this.frameOverride.width=QBc,this.frameOverride.height=RBc,this.frameOverride.localMatrix=DBc,this.isScreenSpace&&(this.frameOverride.fill.color=AJa.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:QBc,height:RBc},YBc({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(SBc){let TBc=SBc?.width??this.width,UBc=SBc?.height??this.height;this.width=TBc,this.height=UBc,this.renderer.dpr=this.isScreenSpace?window.devicePixelRatio:Math.floor(2048/Math.max(TBc,UBc)),this.renderer.setSize(TBc,UBc),this.textureHolder?.dispose(),this.applyOverrides(SBc),this.frameOverride?.requestRender()}applyFrame(VBc){let WBc=this.context.scene.find2D(VBc);if(!(!WBc||!(WBc instanceof Uzc)))return this.disposeFrameOverride(),this.frameRoot=WBc,this.frameOverride=WBc.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),this.textureHolder?.dispose(),this.frame?.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse(a=>{a.addEventListener("beginState",this.onFrameOverrideObjectEvent)}),this.frameOverride.traverse(a=>{a.addEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frame?.requestRender(),WBc}get frame(){return this.frameOverride}get frameId(){return this.frame?.uuid}find(XBc){return this.scene2d.find(XBc)}get texture(){return this.textureHolder?.getTexture(1001)}disposeFrameOverride(){this.frameOverride?.removeEventListener("render",this.onRenderRequestedDownstream),this.frameOverride?.traverse(a=>{a.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)}),this.frameOverride?.traverse(a=>{a.removeEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function YBc({objectOverride:a,objectRoot:b,newParentWidth:c,newParentHeight:d,initialParentWidth:e,initialParentHeight:f}){if(a instanceof Uzc&&b instanceof Uzc||a instanceof vtc&&b instanceof vtc)for(let g=0,h=a.children.length;g<h;g++){let i=a.children[g],j=b.children[g];i&&j&&i.uuid===j.uuid&&ZBc({objectOverride:i,objectRoot:j,newParentWidth:c,newParentHeight:d,initialParentWidth:e,initialParentHeight:f})}}function ZBc({objectOverride:a,objectRoot:b,newParentWidth:c,newParentHeight:d,initialParentWidth:e,initialParentHeight:f}){let[g,h]=function(a){if(_Bc(a))return[a.width,a.height];if(a instanceof pAc){let[b,c]=a.getHalfSize();return[2*b,2*c]}if(a instanceof vtc){let[d,e]=a.recursiveBBox.getHalfSize();return[2*d,2*e]}return[0,0]}(b),{width:i,height:j,position:k}=CBc({constraints:a.data,newParentWidth:c,newParentHeight:d,initialParentWidth:e,initialParentHeight:f,objectInitialWidth:g,objectInitialHeight:h,objectInitialPosition:b.position});if(a.position=k,a.data={...a.data,position:k},a.states)for(let l in a.states)$Bc({stateId:l,objectOverride:a,objectRoot:b,newParentWidth:c,newParentHeight:d,initialParentWidth:e,initialParentHeight:f});if(_Bc(a)||a instanceof vtc)_Bc(a)&&(a.width=i,a.height=j,a.data={...a.data,width:i,height:j}),YBc({objectOverride:a,objectRoot:b,newParentWidth:i,newParentHeight:j,initialParentWidth:g,initialParentHeight:h});else if(a instanceof pAc){let m=b,n=0!==g?i/g:1,o=0!==h?j/h:1;a.path=(function(a,b=1,c=1){if(b<=0||c<=0)return a;let d,e;return d=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"],(0,oAc.parseSVG)(a).map(a=>{let d={...a};return"x"in d&&(d.x=d.x*b),"y"in d&&(d.y=d.y*c),"x1"in d&&(d.x1=d.x1*b),"x2"in d&&(d.x2=d.x2*b),"y1"in d&&(d.y1=d.y1*c),"y2"in d&&(d.y2=d.y2*c),"rx"in d&&(d.rx=d.rx*b),"ry"in d&&(d.ry=d.ry*c),d}).map(a=>{let b=[];d.forEach(c=>{if(c in a){let d=1*a[c];b.length&&d>=0&&b.push(","),b.push(d)}});let c=(e===a.code?b[0]<0?"":",":a.code)+b.join("");return e=a.code,c}).join("")})(m.path,n,o),a.data={...a.data,path:a.path}}}function $Bc({stateId:a,objectOverride:b,objectRoot:c,newParentWidth:d,newParentHeight:e,initialParentWidth:f,initialParentHeight:g}){let h=b.states?.[a],i=c.states?.[a];if(h&&i){let{width:j,height:k,position:l}=CBc({constraints:b.data,newParentWidth:d,newParentHeight:e,initialParentWidth:f,initialParentHeight:g,objectInitialWidth:yOa.isResizeable(i)?i.width:0,objectInitialHeight:yOa.isResizeable(i)?i.height:0,objectInitialPosition:i.position});Object.assign(b.states[a],{position:l}),yOa.isResizeable(h)&&Object.assign(b.states[a],{width:j,height:k})}}function _Bc(a){return a instanceof uyc||a instanceof Uzc||a instanceof _xc||a instanceof Gyc}var aCc=class extends cTa(zV){constructor(bCc,cCc,dCc){super(),this.data=cCc,this.bgColor=new Vxb(1,1,1,1),this.fog=null,this.backupFog=new vV(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new df,this.penumbraSizeArrayCache=null,this.super_Entity(bCc,cCc),this.personalCamera=new U5b(QIa,{...MNa.defaultData,...cCc.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new $ea(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),cCc.uiScene?this.uiScene=new BBc((Array.isArray(bCc)?bCc[0]:bCc)+"-ui",cCc.uiScene,{dpr:window.devicePixelRatio,shared:dCc.shared}):cCc.uiFrame&&this.createUICanvas(cCc.uiFrame,dCc)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){return this.uiCanvas?.frame}createUICanvas(eCc,fCc){this.uiCanvas=new EBc(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,fCc),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then(()=>{this.uiCanvas?.applyFrame(eCc),this.uiCanvas?.applySize()})}updateVisible(){}setBackgroundColor(gCc){this.bgColor=gCc,!0===this.fogUseBGColor&&(this.backupFog.color=gCc)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(hCc,iCc){void 0!==hCc.color&&(this.ambientLight.color=WQb(hCc.color,iCc)),void 0!==hCc.intensity&&(this.ambientLight.intensity=hCc.intensity),void 0!==hCc.enabled&&(hCc.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(jCc){this.isActive=!0,jCc.fog=this.fog,this.traverseEntity(a=>{a instanceof _6b&&a.recomputeBoolean()}),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(a=>{if(a instanceof i_b)if(Array.isArray(a.material))for(let b of a.material)b.needsUpdate=!0;else a.material.needsUpdate=!0,a.material.dispose()})}updateShadow(kCc){void 0!==kCc.softShadowQuality&&this.isActive&&Rpc(kCc.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(lCc,mCc){lCc.enabled?this.fog=this.backupFog:this.fog=null,this.isActive&&(this.scene.fog=this.fog),this.fogUseBGColor=lCc.useBackgroundColor,lCc.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=WQb(lCc.color,mCc),this.backupFog.near=lCc.near,this.backupFog.far=lCc.far}updateAo(nCc,oCc){void 0!==nCc.aoColor&&(this.aoColor=WQb(nCc.aoColor,oCc))}updateByOp(pCc,qCc,rCc,sCc){let tCc=this.data.uiFrame;super.updateByOp(pCc,qCc,rCc,sCc);let uCc=qCc;TFa(pCc.path,["fog"])?this.updateFog(uCc.fog,rCc.shared):TFa(pCc.path,["ao"])?this.updateAo(uCc.ao,rCc.shared):TFa(pCc.path,["ambient"])?this.updateAmbientLight(uCc.ambient,rCc.shared):TFa(pCc.path,["shadow"])?this.updateShadow(uCc.shadow):0===pCc.type&&0===pCc.path.length&&(void 0!==pCc.props.uiFrame||tCc!==uCc.uiFrame)&&this.updateUIFrame(pCc.props.uiFrame,rCc)}updateUIFrame(vCc,wCc){vCc?(this.uiCanvas||this.createUICanvas(vCc,wCc),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(vCc)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(xCc,yCc){this.updateState_Entity(xCc,yCc),void 0!==xCc.backgroundColor&&this.setBackgroundColor(WQb(xCc.backgroundColor,yCc.shared)),void 0!==xCc.fog&&this.updateFog(xCc.fog,yCc.shared),void 0!==xCc.ambient&&this.updateAmbientLight(xCc.ambient,yCc.shared),void 0!==xCc.ao&&this.updateAo(xCc.ao,yCc.shared),void 0!==xCc.shadow&&this.updateShadow(xCc.shadow)}createFrame(zCc,ACc){}raycast(BCc,CCc){super.raycast(BCc,CCc)}switchActiveCamera(DCc){DCc&&DCc.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=DCc,DCc.objectHelper.visible=!1)}get playCamera(){return this.scene?.find(this.data.publish.playCamera)??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return null===this.penumbraSizeArrayCache&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let ECc=0,FCc=0;this.traverseEntity(a=>{if(!a.visible)return!0;a instanceof crc&&a.visible&&ECc<3&&(this.penumbraSizeArrayCache[ECc]=a.data.penumbraSize,ECc+=1),a instanceof trc&&a.visible&&ECc<2&&(this.penumbraSizeArrayCache[3+FCc]=a.data.penumbraSize,FCc+=1)})}raycastWithClones(GCc){let HCc=[],ICc=a=>{for(let b of a.children){let c=b.cloner;Fsb.is(b)&&(b.visible||c?.object.data.visible)&&((q7b(b)||u7b(b)&&this.scene.enableHelpers&&b.objectHelper.visible)&&(GCc.intersectObject(b,!1,HCc),vIc(b,GCc,HCc,!0)),ICc(b))}};return ICc(this),HCc}updateEntity2DByOp(JCc,KCc,LCc,MCc){this.uiCanvas?.updateEntity2DByOp(JCc,KCc,LCc,MCc)}},NCc=class extends p7b(Ifa,Mqc){constructor(OCc,PCc,QCc){super(),this.super_Entity(OCc,PCc),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let RCc=this.shadow.camera;RCc.fov=90,RCc.aspect=1,RCc.near=100,RCc.far=2500;let SCc=new fm(-RCc.far+this.position.x,-RCc.far+this.position.y,-RCc.far+this.position.z),TCc=new fm(RCc.far+this.position.x,RCc.far+this.position.y,RCc.far+this.position.z),UCc=new Io(SCc,TCc),VCc=new hra(UCc,new df(16755200));VCc.visible=!1,this.gizmos.shadowmap=VCc,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let WCc in this.gizmos){let XCc=this.gizmos[WCc];if(XCc instanceof hra){let YCc=this.shadow.camera,ZCc=new fm(-YCc.far+this.position.x,-YCc.far+this.position.y,-YCc.far+this.position.z),$Cc=new fm(YCc.far+this.position.x,YCc.far+this.position.y,YCc.far+this.position.z);XCc.box.set(ZCc,$Cc),XCc.updateMatrixWorld(!0)}}}updateMatrixWorld(_Cc){super.updateMatrixWorld(_Cc),this.objectHelper&&this.objectHelper.update()}updateState(aDc,bDc){this.updateState_Light(aDc,bDc),void 0!==aDc.distance&&(this.distance=aDc.distance),void 0!==aDc.decay&&(this.decay=aDc.decay),void 0!==aDc.shadowRadius&&(this.shadow.radius=aDc.shadowRadius),void 0!==aDc.shadowResolution&&(this.shadow.mapSize.set(aDc.shadowResolution,aDc.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},cDc=class extends A_b{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(dDc,eDc){let fDc=this.geometry.getAttribute("position");void 0!==fDc?Avb(fDc,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:fDc.count,dDc,eDc):super.updateEntityBoxSize(dDc,eDc)}},gDc=class extends A_b{constructor(hDc,iDc,jDc){super(hDc,iDc,jDc),this._shapeId=null,this._context=jDc}updateState(kDc,lDc){super.updateState(kDc,lDc),this.updateShape()}updateShape(){let mDc={...this.data.geometry.extrusion.shape};for(let nDc in mDc)"string"==typeof mDc[nDc]&&(mDc[nDc]=this._context.shared.getVariable(mDc[nDc],[this.uuid,"geometry","extrusion","shape",nDc]));let oDc;if("Custom"===mDc.type){let pDc=mDc.shapeId;if(pDc!==this._shapeId&&this.detachShape(),pDc){this._shapeId=pDc;let qDc=this._context.scene.find(pDc);qDc?.data&&(qDc.attachedPaths.add(this),oDc=qDc.geometry.userData?.shape),oDc||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let rDc;switch(mDc.type){case"Rectangle":rDc=lib;break;case"Ellipse":rDc=W4a;break;case"Polygon":rDc=Lfb;break;case"Star":rDc=skb;break;default:throw new Error(`Unknown shape type: ${mDc.type}`)}oDc=rDc.create({parameters:mDc}).userData.shape}let sDc=this.geometry;oDc&&sDc.inputs&&(sDc.inputs.shapeData=oDc,sDc.build(),this.attachedSurfaceCloners.forEach(a=>a.update()))}detachShape(){null!==this._shapeId&&this._context.scene.find(this._shapeId)?.attachedPaths.delete(this)}createGeometryDelayed(tDc){this.geometryCreateDeleyed=tDc.shared,this.updateShape(),this.refreshAttachedPaths(tDc)}updateTransformState(uDc,vDc){return super.updateTransformState(uDc,vDc)}updateGeometryInteractions(wDc,xDc){super.updateGeometryInteractions(wDc,xDc),this.updateShape()}updateEntityBoxSize(yDc,zDc){let ADc=this.geometry.getAttribute("position");void 0!==ADc?Avb(ADc,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:ADc.count,yDc,zDc):super.updateEntityBoxSize(yDc,zDc)}},BDc=class extends M5b(ZT,v7b){constructor(CDc,DDc,EDc){super(),"Instance"===DDc.type&&"string"==typeof CDc&&(DDc=this.transformAssignData(DDc,EDc)),this.super_Entity(CDc,DDc),this.objectHelper.update()}get isComponentRoot(){return"Component"===this.data.type&&"string"==typeof this.identity}get isInstanceRoot(){return"Instance"===this.data.type&&"string"==typeof this.identity}transformAssignData(FDc,GDc){let HDc=iOa.getComponentData({scene:GDc.scene.data,shared:GDc.shared.data},FDc.component);if(!HDc)return{...GNa.defaultData,...FDc,...Eya(GNa.defaultData,PNa.rootOverrideProps)};{let IDc,JDc;for(let KDc of PNa.rootOverrideProps)void 0===FDc[KDc]?(void 0===IDc&&(IDc={...FDc}),IDc[KDc]=HDc.data[KDc]):(void 0===JDc&&(JDc={}),JDc[KDc]=FDc[KDc],void 0===IDc&&(IDc={...FDc}),IDc[KDc]=GCa.apply(HDc.data[KDc],FDc[KDc]));return this.overrideData=JDc,IDc}}updateByOp(LDc,MDc,NDc,ODc){let PDc;if(this.isInstanceRoot&&!ODc){if(MDc=this.transformAssignData(MDc,NDc),0===LDc.type&&0===LDc.path.length&&this.component)for(let QDc of PNa.rootOverrideProps)QDc in LDc.props&& void 0===LDc.props[QDc]&&(void 0===PDc&&(PDc={...LDc,props:{...LDc.props}}),PDc.props[QDc]=this.component.data[QDc]);else if(0===LDc.type&&LDc.path.length>0&&PNa.rootOverrideProps.includes(LDc.path[0])){let RDc=LDc.path[0];void 0===PDc&&(PDc={...LDc,path:[],props:{[RDc]:MDc[RDc]}})}}super.updateByOp(PDc??LDc,MDc,NDc,ODc)}updateState(SDc,TDc){this.updateState_Entity(SDc,TDc)}expandInstanceChildren(UDc){let VDc=this.data;if(void 0===this.component){let WDc=UDc.scene.find(VDc.component)??null,XDc=!1;if(WDc!==this.oldComponent){if(this.oldComponent){let YDc=0;for(let ZDc of this.children)if(Fsb.is(ZDc))UDc.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(ZDc),bEc(ZDc),YDc+=1;else break;this.children.splice(0,YDc)}XDc=!0}if(WDc){let $Dc={};for(let _Dc of(dEc(UDc,[this.uuid],VDc.overrides,this,WDc,WDc,0,XDc,$Dc),this.children))if(Fsb.is(_Dc)){let aEc=_Dc.data;"Empty"===aEc.type&&aEc.animations&&_Dc.traverseEntity(a=>{if(a instanceof A_b&&a.isSkinnedMesh){let b=a.dataPatched;if(b.bones&&b.boneInverses){let c=b.bones.map(a=>UDc.scene.find($Dc[a])),d=b.boneInverses.map(a=>new rs().fromArray(a)),e=new lX(c,d);a.bind(e,a.bindMatrix)}}else a.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function bEc(a){if(a.component){let b=a.component.instances.indexOf(a);for(let c of(b>=0&&a.component.instances.splice(b,1),a.children))Fsb.is(c)&&bEc(c)}}function cEc(a,b,c,d){return a.component===b&&uya(a.identity,d)?a.overrideData===c?2:1:0}function dEc(a,b,c,d,e,f,g,h,i){if(g>50)return!1;if(d.component!==e){if(d.component){let j=d.component.instances.indexOf(d);j>=0&&d.component.instances.splice(j,1)}e.instances.find(a=>a===d)||e.instances.push(d),d.component=e}e instanceof BDc&&e.isInstanceRoot&&e.expandInstanceChildren(a);let k=0;for(let l of e.children)if(Fsb.is(l)){let m=[...b,..."string"==typeof l.identity?[l.identity]:l.identity],n=ONa.resolve(c,m,1);null==n||n instanceof ICa||(Object.setPrototypeOf(n,ICa.prototype),console.error("wrong prototype"));let o=null,p;if(!h){let q=d.children[k];if(null!==(o=Fsb.is(q)?q:null)){let r=cEc(o,l,n,m);p=r>=1?o.stateSelection:void 0,2!==r&&(o=null)}if(null===o&&null!==(o=a.scene.findInstance(m)??null)){let s=cEc(o,l,n,m);if(p=s>=1?o.stateSelection:void 0,2!==s)o=null;else{let t=o.parent.children.indexOf(o);o.parent.children.splice(t,1),d.children.splice(k,0,o),o.parent===d?t<=k&&console.error("not possible"):(o.parent=d,o.matrixWorldNeedsUpdate=!0,o.resetBBoxNeedsUpdate(),o.updateVisible(),a.pendingDeletes.delete(o))}}}if(null===o){let u=n?GCa.apply(l.data,n):l.data;FJa.is(u.type)&&(u={...u,type:"Empty"}),(o=HSa.createEntity(m,u,a)).overrideData=n,d.add(o),d.children.splice(d.children.length-1,1),d.children.splice(k,0,o),o.updateState(o.data,a),p&&o.changeSelectedState(p,a),a.scene.registerInstanceAndSetUuid(o)}o.isBone&&(i[o.identity[o.identity.length-1]]=o.uuid),k+=1,dEc(a,b,c,o,l,f,g+1,h,i)}if(!h){let v=k;for(;;){let w=d.children[k];if(Fsb.is(w))a.pendingDeletes.add(w);else break;k+=1}d.children.splice(v,k-v)}return!0}var eEc=class extends M5b(XW,v7b){constructor(fEc,gEc){super(),this.super_Entity(fEc,gEc),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(hEc,iEc){this.updateState_Entity(hEc,iEc)}},jEc=class extends A_b{constructor(kEc,lEc,mEc){super(kEc,lEc,mEc),this.onBeforeRender=()=>{this.uiCanvas.render()},this.uiCanvas=new EBc(kEc+"-canvas",lEc.geometry.width,lEc.geometry.height,mEc),this.uiCanvas.promise.then(()=>{this.applyFrame(this.dataPatched.geometry.frame,mEc.shared)})}updateByPatchedOpGeometry(nEc,oEc,pEc){super.updateByPatchedOpGeometry(nEc,oEc,pEc),0===nEc.type&&(void 0!==nEc.props.frame&&this.applyFrame(nEc.props.frame,pEc.shared),(void 0!==nEc.props.width|| void 0!==nEc.props.height)&&this.applySize(nEc.props,pEc.shared))}applySize(qEc,rEc){let sEc=qEc?.width??this.dataPatched.geometry.width,tEc=qEc?.height??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:sEc,height:tEc}),this.applyGeometryParametersFromFrame(rEc)}applyFrame(uEc,vEc){this.uiCanvas.applyFrame(uEc),this.applyGeometryParametersFromFrame(vEc),this.applyMaterialParametersFromFrame({shared:vEc})}applyGeometryParametersFromFrame(wEc){let xEc=this.frame;xEc&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:xEc.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:xEc.cornerRadius,cornerType:0})}),this.localGeometry?.dispose(),this.localGeometry=Msb(this.dataPatched.geometry,wEc,this.data.flatShading,this))}applyMaterialParametersFromFrame(yEc){let zEc=this.frame;if(zEc){let AEc=zEc.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:AEc.radius,alpha:AEc.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:AEc.radius,alpha:AEc.enabled?1:0}),this.material.reset(this.dataPatched.material,yEc,!0)}}updateEntity2DByOp(BEc,CEc,DEc,EEc){this.uiCanvas.updateEntity2DByOp(BEc,CEc,DEc,EEc),BEc===this.frameId&&0===CEc.type&&(void 0!==CEc.props.cornerRadius?this.applyGeometryParametersFromFrame(EEc):TFa(CEc.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:EEc}))}get frame(){return this.uiCanvas.frame}get frameId(){return this.frame?.uuid}removeInteractionGeometry(FEc){super.removeInteractionGeometry(FEc),this.applySize({},FEc)}updateGeometryInteractions(GEc,HEc){super.updateGeometryInteractions(GEc,HEc),this.applySize({width:GEc.width,height:GEc.height},HEc)}},IEc=class{constructor(JEc,KEc,LEc){this.variables=[],this.currentTextureIndex=0;let MEc=Aa,NEc=new zV,OEc=new yJ;OEc.position.z=1;let PEc={passThruTexture:{value:null}},QEc=TEc(`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`,PEc),REc=new GH(new XM(2,2),QEc);function SEc(a){a.defines.resolution="vec2( "+JEc.toFixed(1)+", "+KEc.toFixed(1)+" )"}function TEc(a,b){b=b||{};let c=new pJ({uniforms:b,vertexShader:UEc(),fragmentShader:a});return SEc(c),c}function UEc(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}NEc.add(REc),this.setDataType=function(a){return MEc=a,this},this.addVariable=function(a,b,c){let d={name:a,initialValueTexture:c,material:this.createShaderMaterial(b),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:sa,magFilter:sa};return this.variables.push(d),d},this.setVariableDependencies=function(a,b){a.dependencies=b},this.init=function(){if(!1===LEc.capabilities.isWebGL2&& !1===LEc.extensions.has("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===LEc.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(let a=0;a<this.variables.length;a++){let b=this.variables[a];b.renderTargets[0]=this.createRenderTarget(JEc,KEc,b.wrapS,b.wrapT,b.minFilter,b.magFilter),b.renderTargets[1]=this.createRenderTarget(JEc,KEc,b.wrapS,b.wrapT,b.minFilter,b.magFilter),this.renderTexture(b.initialValueTexture,b.renderTargets[0]),this.renderTexture(b.initialValueTexture,b.renderTargets[1]);let c=b.material,d=c.uniforms;if(null!==b.dependencies)for(let e=0;e<b.dependencies.length;e++){let f=b.dependencies[e];if(f.name!==b.name){let g=!1;for(let h=0;h<this.variables.length;h++)if(f.name===this.variables[h].name){g=!0;break}if(!g)return"Variable dependency not found. Variable="+b.name+", dependency="+f.name}d[f.name]={value:null},c.fragmentShader=`
uniform sampler2D `+f.name+`;
`+c.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let a=this.currentTextureIndex,b=0===this.currentTextureIndex?1:0;for(let c=0,d=this.variables.length;c<d;c++){let e=this.variables[c];if(null!==e.dependencies){let f=e.material.uniforms;for(let g=0,h=e.dependencies.length;g<h;g++){let i=e.dependencies[g];f[i.name].value=i.renderTargets[a].texture}}this.doRenderTarget(e.material,e.renderTargets[b])}this.currentTextureIndex=b},this.getCurrentRenderTarget=function(a){return a.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(a){return a.renderTargets[0===this.currentTextureIndex?1:0]},this.dispose=function(){REc.geometry.dispose(),REc.material.dispose();let a=this.variables;for(let b=0;b<a.length;b++){let c=a[b];c.initialValueTexture&&c.initialValueTexture.dispose();let d=c.renderTargets;for(let e=0;e<d.length;e++)d[e].dispose()}},this.addResolutionDefine=SEc,this.createShaderMaterial=TEc,this.createRenderTarget=function(a,b,c,d,e,f){return a=a||JEc,b=b||KEc,c=c||qa,d=d||qa,e=e||sa,f=f||sa,new Yi(a,b,{wrapS:c,wrapT:d,minFilter:e,magFilter:f,format:Da,type:MEc,depthBuffer:!1})},this.createTexture=function(){let a=new Float32Array(JEc*KEc*4),b=new YW(a,JEc,KEc,Da,Aa);return b.needsUpdate=!0,b},this.renderTexture=function(a,b){PEc.passThruTexture.value=a,this.doRenderTarget(QEc,b),PEc.passThruTexture.value=null},this.doRenderTarget=function(a,b){let c=LEc.getRenderTarget(),d=LEc.xr.enabled,e=LEc.shadowMap.autoUpdate,f=LEc.outputEncoding,g=LEc.toneMapping;LEc.xr.enabled=!1,LEc.shadowMap.autoUpdate=!1,LEc.outputEncoding=Sa,LEc.toneMapping=ia,REc.material=a,LEc.setRenderTarget(b),LEc.render(NEc,OEc),REc.material=QEc,LEc.xr.enabled=d,LEc.shadowMap.autoUpdate=e,LEc.outputEncoding=f,LEc.toneMapping=g,LEc.setRenderTarget(c)}}},VEc=new TA,WEc=new fm,XEc=class{constructor(YEc){let ZEc=YEc.geometry;if(!ZEc.isBufferGeometry||3!==ZEc.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");ZEc.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),ZEc=ZEc.toNonIndexed()),this.geometry=ZEc,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute($Ec){return this.weightAttribute=$Ec?this.geometry.getAttribute($Ec):null,this}build(){let _Ec=this.positionAttribute,aFc=this.weightAttribute,bFc=new Float32Array(_Ec.count/3);for(let cFc=0;cFc<_Ec.count;cFc+=3){let dFc=1;aFc&&(dFc=aFc.getX(cFc)+aFc.getX(cFc+1)+aFc.getX(cFc+2)),VEc.a.fromBufferAttribute(_Ec,cFc),VEc.b.fromBufferAttribute(_Ec,cFc+1),VEc.c.fromBufferAttribute(_Ec,cFc+2),dFc*=VEc.getArea(),bFc[cFc/3]=dFc}this.distribution=new Float32Array(_Ec.count/3);let eFc=0;for(let fFc=0;fFc<bFc.length;fFc++)eFc+=bFc[fFc],this.distribution[fFc]=eFc;return this}setRandomGenerator(gFc){return this.randomFunction=gFc,this}sample(hFc,iFc,jFc){let kFc=this.distribution[this.distribution.length-1],lFc=this.binarySearch(this.randomFunction()*kFc);return this.sampleFace(lFc,hFc,iFc,jFc)}binarySearch(mFc){let nFc=this.distribution,oFc=0,pFc=nFc.length-1,qFc=-1;for(;oFc<=pFc;){let rFc=Math.ceil((oFc+pFc)/2);if(0===rFc||nFc[rFc-1]<=mFc&&nFc[rFc]>mFc){qFc=rFc;break}mFc<nFc[rFc]?pFc=rFc-1:oFc=rFc+1}return qFc}sampleFace(sFc,tFc,uFc,vFc){let wFc=this.randomFunction(),xFc=this.randomFunction();return wFc+xFc>1&&(wFc=1-wFc,xFc=1-xFc),VEc.a.fromBufferAttribute(this.positionAttribute,3*sFc),VEc.b.fromBufferAttribute(this.positionAttribute,3*sFc+1),VEc.c.fromBufferAttribute(this.positionAttribute,3*sFc+2),tFc.set(0,0,0).addScaledVector(VEc.a,wFc).addScaledVector(VEc.b,xFc).addScaledVector(VEc.c,1-(wFc+xFc)),void 0!==uFc&&VEc.getNormal(uFc),void 0!==vFc&& void 0!==this.colorAttribute&&(VEc.a.fromBufferAttribute(this.colorAttribute,3*sFc),VEc.b.fromBufferAttribute(this.colorAttribute,3*sFc+1),VEc.c.fromBufferAttribute(this.colorAttribute,3*sFc+2),WEc.set(0,0,0).addScaledVector(VEc.a,wFc).addScaledVector(VEc.b,xFc).addScaledVector(VEc.c,1-(wFc+xFc)),vFc.r=WEc.x,vFc.g=WEc.y,vFc.b=WEc.z),this}};function yFc(a,b){let c=a,d=new Float32Array(4*b*b);for(let e=0;e<b*b;e++)d[4*e]=c[3*e],d[4*e+1]=c[3*e+1],d[4*e+2]=c[3*e+2],d[4*e+3]=0;let f=new YW(d,b,b,Da,Aa);return f.needsUpdate=!0,f}var zFc=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform float uTime;
uniform float uSpeed;     // update speed of the particles
uniform vec3 uWorldOffset;    
uniform vec4 uWorldQuaternion;
uniform float uMaxLifeTime;
uniform vec3 uEmitterSize;
uniform float uFPSRatio;     // 1  for 60 FPS

float random (vec2 st) {
    return fract(sin(dot(st.xy,
        vec2(12.9898,78.233)))*
        43758.5453123);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
    vec3 acceleration = force / mass;
    
    return acceleration;
  }
  

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted
    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided
    float lifeTime = uMaxLifeTime;

    // Calculate the position adjustment based on collision
    //     if (collisionFlag > .5) {  
    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0
    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise
    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);

    // Update position based on collision or normal movement
    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);
    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);

    // EMISSION RATE - BIRTH
    // if (isSpawning == 1.0) {
    // Better Approach to avoid If statement
    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;
    originalPosition = mix(originalPosition, newPosition, isSpawning);
    position = mix(position, originalPosition, isSpawning);;
    timeStart = mix(timeStart, uTime, isSpawning);

    // Calculate timeLeft for life normalization
    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);
    float life_Normalize = timeLeft / lifeTime;

    // Use isActive to blend between the calculated color and black
    vec4 activeColor = vec4(position, life_Normalize);
    // if (isActive == 1.0) {
    gl_FragColor = mix(vec4(0.0), activeColor, isActive);

}
`,AFc=`

    vec3 mod289(vec3 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 mod289(vec4 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 permute(vec4 x) {
        return mod289(((x*34.0)+1.0)*x);
    }
    
    vec4 taylorInvSqrt(vec4 r)
    {
    return 1.79284291400159 - 0.85373472095314 * r;
    }
    
    vec3 fade(vec3 t) {
  return t*t*t*(t*(t*6.0-15.0)+10.0);
}

    float snoise(vec3 v)
    {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
    
    // Permutations
    i = mod289(i);
    vec4 p = permute( permute( permute(
                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
    
    // Gradients: 7x7 points over a square, mapped onto an octahedron.
    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
    
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
    
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
    
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
    
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
    
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
    
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
    
    //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
    
    // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
    }
    
    vec3 snoiseVec3( vec3 x ){
    
      float s  = snoise(vec3( x ));
      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));
      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));
      vec3 c = vec3( s , s1 , s2 );
      return c;
    
    }
    
      
    vec3 curlNoise( vec3 p, float seed){
      p += seed;
      const float e = .1;
      vec3 dx = vec3( e   , 0.0 , 0.0 );
      vec3 dy = vec3( 0.0 , e   , 0.0 );
      vec3 dz = vec3( 0.0 , 0.0 , e   );
    
      vec3 p_x0 = snoiseVec3( p - dx );
      vec3 p_x1 = snoiseVec3( p + dx );
      vec3 p_y0 = snoiseVec3( p - dy );
      vec3 p_y1 = snoiseVec3( p + dy );
      vec3 p_z0 = snoiseVec3( p - dz );
      vec3 p_z1 = snoiseVec3( p + dz );
    
      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;
      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;
      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;
    
      const float divisor = 1.0 / ( 2.0 * e );
      return normalize( vec3( x , y , z ) * divisor );
    
    }


// Classic Perlin noise
float cnoise(vec3 P)
{
  vec3 Pi0 = floor(P); // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P); // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
  return 2.2 * n_xyz;
}


vec3 fbm_vec3(vec3 p, float frequency, float offset)
{
  return vec3(
    cnoise((p+vec3(offset))*frequency),
    cnoise((p+vec3(offset+20.0))*frequency),
    cnoise((p+vec3(offset-30.0))*frequency)
  );
}

`,BFc=`
  #ifdef USE_COLLIDER
    float restitution = max(uBounce * 2., .01); // Energy Loss
    // SPHERE COLLIDER
    // **************************************************************
    #ifdef USE_SPHERE_COLLIDER       
      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
      vec3 radii = uColliderSize;
      // Adjust position relative to collider
      vec3 relPos = position - uColliderPos;
      // Apply rotation of the collider to the relative position
      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
      // Scale relative position by radii (for ellipsoid collision detection)
      vec3 scaledPos = relPos / radii;
      // Calculate ellipsoidal distance
      float dist = length(scaledPos); // Distance in terms of ellipsoid
      
      // Check for collision
      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {
          // Compute the normal at the collision point, accounting for particle size
        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          
        // Compute the normal at the collision point
        vec3 normal = ellipsoidNormal(adjustedPos, radii);
        // Rotate the normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);
        // Reflect the velocity vector off the normal
        velocity = reflect(velocity, normal) * restitution;

        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif

    // BOX COLLIDER or PLANE COLLIDER 
    // **************************************************************
    #ifdef USE_BOX_COLLIDER
      // Box dimensions and repulsion variables
      vec3 boxHalfSize = uColliderSize / 2.0;
      // Convert world position to box's local space
      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
      // Collision detection
      vec3 localDistance = abs(localPos) - boxHalfSize;
      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    

      // Collision Detected
      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      
        // Find the nearest face normal for bounce direction
        vec3 normal;
        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {
            normal = vec3(sign(localPos.x), 0.0, 0.0);
        } else if (localDistance.y > localDistance.z) {
            normal = vec3(0.0, sign(localPos.y), 0.0);
        } else {
            normal = vec3(0.0, 0.0, sign(localPos.z));
        }            
        // Rotate normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);      
        // Reflect velocity and apply repulsion force
        velocity = reflect(velocity, normal) * restitution;
        
        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif      
  #endif      
  // END COLLIDER    
`,CFc=`
  #ifdef USE_ATTRACTOR

      #ifdef USE_SPHERE_COLLIDER      
        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
        vec3 radii = uColliderSize;
        // Adjust position relative to collider
        vec3 relPos = position - uColliderPos;
        // Apply rotation of the collider to the relative position
        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
        // Scale relative position by radii (for ellipsoid collision detection)
        vec3 scaledPos = relPos / radii;
        // Calculate ellipsoidal distance
        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid
        float insideCheck = 1.0;

      #endif


      #ifdef USE_BOX_COLLIDER
        // Box dimensions
        vec3 boxHalfSize = uColliderSize / 2.0;
        // Convert world position to box's local space
        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
        vec3 localDistance = abs(localPos) - boxHalfSize;
        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));
        float insideCheck = particleSize;
      #endif      
  
      // Apply vortex force inside the Helper
      #ifdef USE_FORCE_LOCAL_SPACE
        if (distToSurface <= insideCheck ) {    
            // Define parameters for the attractor field
            #ifdef USE_SPHERE_COLLIDER      
              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed
            #endif

            #ifdef USE_BOX_COLLIDER
              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed
              #endif

            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)
          
            // Use the same radii calculation code as for the collider
            vec3 attractorRadii = uColliderSize;
            // Adjust position relative to attractor center
            vec3 relPos = position - uColliderPos;
            // Apply rotation of the collider to the relative position
            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
            // Scale relative position by radii (for ellipsoid attraction)
            vec3 scaledPos = relPos / attractorRadii;

            // Calculate ellipsoidal distance as attractor radius
            float attractorRadius = length(scaledPos);
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * attractorStrength;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= attractorDamping;
        }
      #else 
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= uForceDamping;
      #endif    
  #endif      
`,DFc=`
  #ifdef USE_VORTEX
    // Box dimensions
    vec3 boxHalfSize = uColliderSize / 2.0;
    // Convert world position to box's local space
    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
    vec3 localDistance = abs(localPos) - boxHalfSize;
    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));

    // Apply vortex force inside the box
    if (distToSurface <= particleSize) {
      float vortexStrength = uForceIntensity;
      vec3 localTopCenter = vec3(0.0, 0., 0.0);

      // Transform the local top center to the world space
      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);
      // Calculate the vector from particle to vortex center
      vec3 vortexVector = vortexCenter - position;

      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector
      // Note: important to add a tiny z component to the up vector to avoid instability
      vec3 upVector = vec3(0.0, 1.0, 0.01);
      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));
      rotationAxis = normalize(rotationAxis);

      // Add rotational component to velocity
      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; 

      vec3 rotationVelocity = rotationAxis * rotationSpeed;
      // velocity += rotationVelocity * 0.005 ;
      velocity = rotationVelocity * 0.005 ;

      // Calculate vortex force
      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;
      // Apply the vortex force to the particle
      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);
      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);
    }
  #endif      
`,EFc=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform sampler2D uDirections;     
uniform vec3 uDirectionsAxis;
uniform vec4 uWorldQuaternion;
uniform vec3 uGravity;        
uniform float uNoiseStrength;     // Variation of the noise
uniform float uNoiseScale;        // Scale of the noise
uniform float uNoiseSeed;         // Seed of the noise
uniform float particleSize;
uniform float uSpeed;     // update speed of the particles
uniform float uRandomMassFactor;

// COLLIDER
uniform vec3 uColliderPos;                // Collider Position
uniform vec3 uColliderSize;               // Collider Dimension
uniform vec4 uColliderQuaternion;         // Collider Rotation
uniform vec4 uColliderQuaternionInvert;   // Collider Rotation
uniform float uBounce;                    // Bounce factor
uniform float uForceDamping;
uniform float uForceIntensity;


`+AFc+`
float rand(vec2 co){
    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
 } 
vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
  
  return acceleration;
}

vec4 conjugate(vec4 q) {
  return vec4(q.w, -q.x, -q.y, -q.z);
}

// Function to compute the normal of the ellipsoid at a given point
vec3 ellipsoidNormal(vec3 p, vec3 radii) {
  return normalize(p / (radii * radii));
}

float friction = .3;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    vec3 directions = texture2D( uDirections, vUv ).xyz;    
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float mass = rand(originalPosition.xy) * 0.5 + 0.5;
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active
    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision

    // Randomness Mass
    mass = (1.0 - (uRandomMassFactor * mass));
    
    if (isActive == 1.0) {
      // **************************************************************
      // FORCES NOISES
      // **************************************************************
      #ifdef USE_CURL_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {
          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;
        }
      #endif
      // **************************************************************
      #ifdef USE_SIMPLEX_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {
          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);
        }
      #endif
      // ************************************************************** 
      #ifdef USE_FBM_NOISE
        if (uNoiseScale > 0.0 ) {
          float offset = 0.0;
          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), offset);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      
          float offset = 0.0;
          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;
        }
      #endif

      // COLLIDER
      ${BFc}
      // ATTRACTION
      ${CFc}  
      // VORTEX
      ${DFc}
    } 
    // End isActive

    // SPAWN BIRTH 
    // **************************************************************
    // if (isSpawning == 1.)
    #ifdef USE_NORMALS
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);
    #else
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    
    #endif
    
    // if (collisionFlag == 0.0)
    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);

    gl_FragColor = vec4(velocity, collisionFlag);
}
`,FFc=`

  // Linear Fade In
  float linearFadeIn(float t) {
    return t;
  }


  // linear fade out
  float linearFadeOut(float t) {
    return 1.0 - t;
  }
  
  float linearInOut(float t) {
    return t < 0.5 ? t :  (1.0 - t);  
  }

    // lerp
    float lerp(float a, float b, float t) {
      return a + (b - a) * t;
    }

  // Ease In Out Quart
  float exponentialInOut(float t) {
    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :
    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :
    1.0;
   }

  // constant
  float constant(float t) {
    return 1.0;
  } 
`,GFc=`

float rand(vec3 co){
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

vec3 applyQuaternionToVector( vec4 q, vec3 v ){
  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
    
  return acceleration;
}
`,HFc=`
vec3 rgb2xyz (in vec3 rgb) {
    float r = rgb.r;
	float g = rgb.g;
	float b = rgb.b;

	r = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);
	g = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);
	b = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);

	float x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);
	float y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);
	float z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);
    
    vec3 xyz = vec3(
        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,
        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,
        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0
    );
    return(xyz);
}

vec3 xyz2lab (in vec3 xyz) {
	float x = xyz.x / 95.047;
	float y = xyz.y / 100.0;
	float z = xyz.z / 108.883;

	x = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);
	y = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);
	z = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);

    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));
    return(lab);
}

vec3 rgb2lab(in vec3 rgb) {
    vec3 xyz = rgb2xyz(rgb);
    vec3 lab = xyz2lab(xyz);
    return(lab);
}

vec3 xyz2rgb (in vec3 xyz) {
	float x = xyz.x / 100.0;
	float y = xyz.y / 100.0;
	float z = xyz.z / 100.0;
	
    
	float r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);
	float g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);
	float b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);

	r = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;
	g = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;
	b = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;

	r = min(max(0.0, r), 1.0);
	g = min(max(0.0, g), 1.0);
	b = min(max(0.0, b), 1.0);

	return(vec3(r, g, b));
}

vec3 lab2xyz (in vec3 lab) {
    float l = lab.x;
	float a = lab.y;
	float b = lab.z;

  	float y = (l + 16.0) / 116.0;
	float x = a / 500.0 + y;
	float z = y - b / 200.0;

	float y2 = pow(y, 3.0);
	float x2 = pow(x, 3.0);
	float z2 = pow(z, 3.0);

  	y = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;
	x = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;
	z = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;

	x *= 95.047;
	y *= 100.0;
	z *= 108.883;

	return(vec3(x, y, z));
}
vec3 lab2rgb (in vec3 lab) {
    vec3 xyz = lab2xyz(lab);
    vec3 rgb = xyz2rgb(xyz);
    return(rgb);
}

`,IFc=`
  uniform sampler2D uPosition;
  uniform float uSize;
  uniform float uSizeEnd;
  uniform vec3 uWorldOffset;
  uniform vec4 uWorldQuaternion;
  // Billboard Behavior - Currently at Zero, but we can change that
  uniform float uRotation;
  uniform float uRotationEnd;
  uniform vec2 center;

  // Randomness
  uniform float uRandScaleFactor;
  uniform float uRandRotationFactor;

  attribute vec2 ref;

  varying float v_LifeLeft;    // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  ${GFc}
  ${FFc}
`,JFc=({easeSize:a="linearFadeOut"})=>`
  vUv = uv;  
  vRef = ref;
  // Normalized LifeTime 1 to 0
  float lifeLeft = texture2D(uPosition, ref).w;
  v_LifeLeft = lifeLeft;
  // Position From DataTexture Simulation
  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;
  // Apply World Quaternion
  pos = applyQuaternionToVector(uWorldQuaternion, pos);  
            
  #ifdef  USE_SIZE_END
    // Scaled Over Time
    float t = 1. - lifeLeft;
    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd
    vec3 scaledPosition = position * vec3(currentSize);
  #else
    // Change Size Behavior over LifeTime
    float easeSize = ${a}(1. - lifeLeft);
    // Scaled Over Time
    vec3 scaledPosition = position * vec3(uSize * easeSize);
  #endif

  // Billboard Behavior
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    
  // Randomness 
  float randRef = rand(ref);
  scale *= (1.0 - (uRandScaleFactor * randRef));
  // Rotation
  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);
  float originalRotation = (1.0 - uRotation) * 2.0 * PI;
  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;
  // OverTime
  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);

  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;
  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;
  
  mat4 instanceMatrix = mat4(
    vec4(1.0, 0.0, 0.0, 0.0),
    vec4(0.0, 1.0, 0.0, 0.0),
    vec4(0.0, 0.0, 1.0, 0.0),
    vec4(pos.x, pos.y, pos.z, 1.0)
  );  

  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  mvPosition.xy += rotatedPosition;
  gl_Position = projectionMatrix  * mvPosition;   
`,KFc=`
  uniform vec4 uColor;                // start color
  uniform vec4 uColor2;               // end color
  uniform sampler2D uTexture;         // texture
  varying float v_LifeLeft;   // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  float random(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
  }
  `+FFc+`  
  ${HFc}

`,LFc=({easeOpacity:a="linearFadeOut"})=>`  
  // if Particle is dead, hide it
  if (v_LifeLeft <= 0.005 ) {
    discard;
  }

  #ifdef USE_RANDOM_COLORING
    float randVal = random(vRef); // Generate a random value based on the reference
    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors
  #else
    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);
  #endif

  // Opacity over Life Time
  float finalAlpha = ${a}(1. - v_LifeLeft);  
  vec4 textureColor = texture2D(uTexture, vUv).rgba; 
  finalColor = textureColor.rgb * color.rgb;
  finalAlpha = color.a * textureColor.a * finalAlpha;
  
  gl_FragColor = vec4(finalColor, finalAlpha);     

`,MFc=class extends pJ{constructor(NFc,OFc){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(NFc,OFc),this.context=OFc}reset(){}init(PFc,QFc){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=PFc.ease,this.easeSize=PFc.easeSize,this.layers=[],this.lightLayer=new GSb(0,"",{...UJa.defaultData("light","phong"),visible:!1},new ZNb,{},QFc.shared),this.build()}updateState(RFc){void 0!==RFc.coloring&&(this.isColoringRandom="random"===RFc.coloring),void 0!==RFc.color&&(RFc.color instanceof Array?this.uniforms.uColor.value=RFc.color:this.uniforms.uColor.value=this.context.shared.color(RFc.color)),void 0!==RFc.color2&&(RFc.color2 instanceof Array?this.uniforms.uColor2.value=RFc.color2:this.uniforms.uColor2.value=this.context.shared.color(RFc.color2)),void 0!==RFc.size&&(this.uniforms.uSize.value=RFc.size[0],this.uniforms.uSizeEnd.value=RFc.size[1],RFc.size[0]!==RFc.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),void 0!==RFc.ease&&(this.easeOpacity=RFc.ease,this.build()),void 0!==RFc.easeSize&&(this.easeSize=RFc.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(SFc){this.build(),SFc.defines=this.defines,SFc.uniforms=this.uniforms,SFc.vertexShader=this.vertexShader,SFc.fragmentShader=this.fragmentShader}build(){let TFc=new cEb;return TFc.needsJitter=this.needsJitter,TFc.addFragmentParsCode(YDb),TFc.buildShader("vertex",this.fragment),TFc.buildShader("fragment",this.fragment),TFc.addFragmentFinalCode(ZDb),this.isColoringRandom&&TFc.define("USE_RANDOM_COLORING"),this.useSizeEnd&&TFc.define("USE_SIZE_END"),TFc.addVertexParsCode(IFc),TFc.addFragmentParsCode(KFc),TFc.addVertexFinalCode(JFc({easeSize:this.easeSize})),TFc.addFragmentFinalCode(LFc({easeOpacity:this.easeOpacity})),this.vertexShader=TFc.getCode("vertex"),this.fragmentShader=TFc.getCode("fragment"),this.defines=TFc.defines,this.uniforms={...TFc.uniforms,...this.uniforms},this.extensions=TFc.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach(a=>a.dispose()),super.dispose()}},UFc=class{constructor(VFc,WFc,XFc,YFc){var ZFc;this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=VFc,this.type=XFc,ZFc=WFc,this.textureSize=Math.max(Math.ceil(Math.sqrt(ZFc)),1),this.targetMesh=YFc?.type==="Mesh"&&YFc?YFc:this.getMesh(XFc,1);let{positions:$Fc,dataTexture:_Fc,dataTextureNormals:aGc}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(XFc,1));this.positionsTexture=_Fc,this.positionsAttribute=$Fc,this.directionsTexture=aGc}createPositions(bGc,cGc){let{positions:dGc,normals:eGc}=function(a,b){let c=new GH(a.geometry,a.material),d=[],e=[],f=new fm,g=new fm;null!==c.geometry.index&&(c.geometry=c.geometry.toNonIndexed());let h=new XEc(c).build();for(let i=0;i<b;i++)h.sample(f,g),d.push(f.x,f.y,f.z),e.push(g.x,g.y,g.z);let j=new Float32Array(d),k=new Float32Array(e);return{positions:j,normals:k}}(cGc,bGc*bGc),fGc=yFc(dGc,bGc),gGc=yFc(eGc,bGc);return{dataTexture:fGc,positions:dGc,dataTextureNormals:gGc}}getMesh(hGc,iGc){let jGc=null;switch(hGc){case"SphereEmitterShape":jGc=new D7(.5*iGc,32,32);break;case"TorusEmitterShape":jGc=new f8(.5*iGc,.3,15,40);break;case"ConeEmitterShape":jGc=new I5(iGc,iGc,15);break;case"BoxEmitterShape":jGc=new XI(iGc,iGc,iGc);break;case"PlaneEmitterShape":(jGc=new XM(iGc,iGc)).rotateX(-Math.PI/2);break;case"MeshEmitterShape":jGc=new D7(iGc,32,32);break;default:jGc=new D7(iGc,32,32);break}return new GH(jGc,new MC({color:16711680}))}applyToShader(kGc,lGc){this.size=new fm().fromArray(lGc.size),kGc.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function mGc(a){let b={...a},c=LJa.defaultData;b.forceFieldObjectId&&(b.colliderEntityId=b.forceFieldObjectId);let d={...c.shape,...b.shape},e={...c.renderMaterial,...b.renderMaterial};return{...c,...b,shape:d,renderMaterial:e}}var nGc=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU

uniform sampler2D uIndex; // Texture with corresponding index
uniform float uLastIndexEmitted; // Last emitted index
uniform float uParticlesToEmit; // Number of particles to emit on that frame
uniform float uTime;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    float particleIndex = texture(uIndex, vUv).x;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;


    // ********** Detect Colision to Create a flag and use it in position **********
    // We are doing this here, so

    // ********** Emit Particles **********
    // X = isSpawning 0.0 or 1.0
    // Y = isActive 0.0 or 1.0
    // Check if the vertex index is between the first value and the last value
    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {
    //     // Emit a particle by writing 1 to the red channel of the color output
    //     // r: 1. == emit the particle
    //     // g: 1. == particle is now active
    //     timeStart = uTime;
    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);
    // } else {
    //     // The Particle is either already emitted or not in the range of the particles to emit
    //     // Do not emit a particle by writing 0 to the red channel of the color output        
    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);
    // }
    // Determine if the particle is within the emission range
    float emitLowerBound = step(uLastIndexEmitted, particleIndex);
    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);
    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise

    // Set timeStart and color
    timeStart = mix(timeStart, uTime, emitParticle);
    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);


}
`,oGc=class extends Iy{constructor(pGc,qGc){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new Lea,this.currentWorldPosition=new fm,this.systemQuaternion=new Fj,this.worldGravity=new fm(0,0,0),this.directionAxis=new fm(0,0,0),this.colliderV3=new fm(0,0,0),this.colliderQuaternion=new Fj(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=pGc,this.system=qGc,this.shared=qGc.context.shared;let rGc=qGc.data;this.material=new MFc(rGc.renderMaterial,qGc.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:rGc.renderMaterial.color},uColor2:{value:rGc.renderMaterial.color2},uPosition:{value:new fm(0,0,0)},uEmissionData:{value:new fm(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new fm(0,0,0)},uWorldQuaternion:{value:new sh(0,0,0,1)},uRandScaleFactor:{value:rGc.randomScale??0},uRandRotationFactor:{value:rGc.randomRotation??0},uRotation:{value:rGc.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:rGc.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,rGc.renderMaterial.texture),this.init(rGc)}setTexture(sGc,tGc){let uGc=tGc.data;if("string"==typeof tGc){let vGc=this.shared.image(tGc),wGc=new ah(vGc.img);wGc.needsUpdate=!0,sGc.uTexture.value=wGc;return}if("string"!=typeof uGc){let xGc=new Image;xGc.onload=()=>{let a=new ah(xGc);a.needsUpdate=!0,sGc.uTexture.value=a};let yGc=new Blob([uGc],{type:"image/*"}),zGc=URL.createObjectURL(yGc);xGc.src=zGc}}updateGeometryAttributes(AGc,BGc){let CGc=function(a){let b=new Float32Array(a*a*2);for(let c=0;c<a;c++)for(let d=0;d<a;d++){let e=c*a+d;b[2*e+0]=c/(a-1),b[2*e+1]=d/(a-1)}return b}(BGc);this.emitterShape?.positionsAttribute&&AGc.geometry.setAttribute("ref",new aY(CGc,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let DGc=this.system;DGc.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),DGc.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(EGc,FGc){if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset){this.reset();return}this.applyWorldSpace(),this.globalTime=EGc,this.positionSimRT.material.uniforms.uTime.value=EGc,this.emissionRateSimRT.material.uniforms.uTime.value=EGc;let GGc=1e3/FGc,HGc=this.targetFPS/GGc,IGc=this.previousRatio+(HGc-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=IGc,this.previousRatio=IGc;let JGc=this.isEmitting?this.GoEmitSomeParticles(EGc,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=JGc,this.material.uniforms.uPosition.value=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT)?.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let KGc=this.system.colliderEntities[0];if(!KGc)return;KGc.getWorldPosition(this.colliderV3),0===this.colliderV3.y&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let LGc=KGc.data.size;this.colliderV3.fromArray(LGc),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),KGc.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(MGc){this.velocitySimRT&&this.positionSimRT&&(MGc.renderMaterial&&this.updateMaterialState(MGc.renderMaterial),this.updateParticleState(MGc))}updateVariableState(NGc,OGc){if(!this.velocitySimRT||!this.positionSimRT)return;"size"===OGc[2]&&this.material.updateState({size:[NGc,this.material.uniforms.uSizeEnd.value]}),"sizeEnd"===OGc[2]&&this.material.updateState({size:[this.material.uniforms.uSize.value,NGc]});let PGc=(a,b)=>{let c=[...this.system.data.shape.size];c[a]=b,this.updateParticleState({shape:{...this.system.data.shape,size:c}})};"shape_size_0"===OGc[2]&&PGc(0,NGc),"shape_size_1"===OGc[2]&&PGc(1,NGc),"shape_size_2"===OGc[2]&&PGc(2,NGc),"speed"===OGc[2]&&(this.velocitySimRT.material.uniforms.uSpeed.value=NGc/10),"gravity"===OGc[2]&&this.worldGravity.set(0,NGc/100,0),"noiseStrength"===OGc[2]&&(this.noiseStrength=NGc,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),"noiseScale"===OGc[2]&&(this.noiseScale=NGc,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),"direction_x"===OGc[2]&&(this.directionAxis=this.getDirectionAxis([Number(NGc),this.system.data.direction[1],this.system.data.direction[2]])),"direction_y"===OGc[2]&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(NGc),this.system.data.direction[2]])),"direction_z"===OGc[2]&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(NGc)]))}updateMaterialState(QGc){this.material.updateState({...QGc,size:QGc.size?[Number(this.shared.getVariable(QGc.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(QGc.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),QGc.texture&&(this.setTexture(this.material.uniforms,QGc.texture),this.material.needsUpdate=!0)}updateParticleState(RGc){if(!(!this.positionSimRT||!this.velocitySimRT)){if(this.shouldReInitGPUCompute(RGc)&&this.init(mGc(this.system.data)),void 0!==RGc.life&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=RGc.life),void 0!==RGc.speed&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(RGc.speed,[this.uuid,"particles","speed"]))/10),void 0!==RGc.collisionBounce&&(this.velocitySimRT.material.uniforms.uBounce.value=RGc.collisionBounce),void 0!==RGc.noiseStrength&&(this.noiseStrength=Number(this.shared.getVariable(RGc.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),void 0!==RGc.noiseScale&&(this.noiseScale=Number(this.shared.getVariable(RGc.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),void 0!==RGc.noiseSeed&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=RGc.noiseSeed),void 0!==RGc.randomMass&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=RGc.randomMass),RGc.renderMaterial?.size!==void 0){let SGc=this.shared.getVariable(RGc.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(SGc)}if(RGc.renderMaterial?.spriteRotation!==void 0&&(this.material.uniforms.uRotation.value=RGc.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=RGc.renderMaterial.spriteRotation[1]),void 0!==RGc.shape){let TGc=RGc.shape.size??this.system.data.shape.size,UGc=[Number(this.shared.getVariable(TGc[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(TGc[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(TGc[2],[this.uuid,"particles","shape_size_2"]))],VGc={...mGc(this.system.data).shape,size:UGc};this.emitterShape?.applyToShader(this.positionSimRT.material.uniforms,VGc)}if(void 0!==RGc.gravity&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),void 0!==RGc.direction){let WGc=this.getDirectionFromVariable(RGc.direction);this.directionAxis=this.getDirectionAxis(WGc),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}void 0!==RGc.randomRotation&&(this.material.uniforms.uRandRotationFactor.value=RGc.randomRotation),void 0!==RGc.randomScale&&(this.material.uniforms.uRandScaleFactor.value=RGc.randomScale)}}updateForceFieldParameters(XGc){this.velocitySimRT&&(void 0!==XGc.forceIntensity&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=XGc.forceIntensity),void 0===XGc.forceDambing||(this.velocitySimRT.material.uniforms.uForceDamping.value=XGc.forceDambing))}getDirectionAxis(YGc){let ZGc=[Number(YGc[0])*Db.DEG2RAD,Number(YGc[1])*Db.DEG2RAD,Number(YGc[2])*Db.DEG2RAD],$Gc=new Ex(ZGc[0],ZGc[1],ZGc[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler($Gc).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(_Gc){let{birthRatePerSec:aHc,rootObjectType:bHc,colliderEntityId:cHc,shape:dHc,emitTimeDuration:eHc,emitTimeCycle:fHc,life:gHc,directionMode:hHc,noiseType:iHc}=_Gc;return void 0!==aHc|| void 0!==bHc||cHc||null===cHc|| void 0!==fHc|| void 0!==dHc|| void 0!==gHc|| void 0!==eHc|| void 0!==hHc|| void 0!==iHc}init(jHc){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:jHc.birthRatePerSec,particleMaxLifeTime:jHc.life,loopDuration:"infinity"===jHc.emitTimeCycle?0:jHc.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(jHc.shape,this.particlesAmount);let kHc=setInterval(()=>{if(this.emitterShape)if(isNaN(this.emitterShape.positionsTexture.source.data.data[0])){this.init(jHc);return}else clearInterval(kHc)},100);if(!this.emitterShape)return;let lHc=new IEc(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),mHc=this.updateSimulationDefinition(jHc),nHc=lHc.addVariable("uCurrentPosition",mHc+zFc,this.emitterShape.positionsTexture),oHc=lHc.addVariable("uCurrentVelocity",mHc+EFc,this.emitterShape.directionsTexture),pHc=lHc.addVariable("uCurrentEmissionRate",nGc,function(a){let b=new Float32Array(4*a*a);for(let c=0;c<a*a;c++)b[4*c]=0,b[4*c+1]=0,b[4*c+2]=0,b[4*c+3]=0;let d=new YW(b,a,a,Da,Aa);return d.needsUpdate=!0,d}(this.emitterShape.textureSize));lHc.setVariableDependencies(nHc,[nHc,oHc,pHc]),lHc.setVariableDependencies(oHc,[nHc,oHc,pHc]),lHc.setVariableDependencies(pHc,[nHc,oHc,pHc]);let qHc=function({size:a}){let b=new Float32Array(4*a*a);for(let c=0;c<a*a;c++)b[4*c]=c,b[4*c+1]=0,b[4*c+2]=0,b[4*c+3]=0;let d=new YW(b,a,a,Da,Aa);return d.needsUpdate=!0,d}({size:this.emitterShape.textureSize}),rHc={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new fm(0,0,0)},uWorldQuaternion:{value:new sh(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:jHc.life},uEmitterSize:{value:new fm(Number(this.shared.getVariable(jHc.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(jHc.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(jHc.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};nHc.material.uniforms=rHc;let sHc=this.getDirectionFromVariable(jHc.direction);this.directionAxis=this.getDirectionAxis(sHc),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(jHc.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(jHc.noiseScale,[this.uuid,"particles","noiseScale"]));let tHc=jHc.colliderEntityId&&this.system.getColliderData(jHc.colliderEntityId),uHc={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new sh(0,0,0,1)},uColliderPos:{value:new fm(0,0,0)},uColliderSize:{value:new fm(0,0,0)},uForceIntensity:{value:tHc?tHc.forceIntensity:0},uForceDamping:{value:tHc?tHc.forceDambing:0},uColliderQuaternion:{value:new sh(0,0,0,1)},uColliderQuaternionInvert:{value:new sh(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:jHc.noiseSeed},uRandomMassFactor:{value:jHc.randomMass},uBounce:{value:jHc.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(jHc.speed,[this.uuid,"particles","speed"]))/10}};oHc.material.uniforms=uHc;let vHc={uIndex:{value:qHc},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};pHc.material.uniforms=vHc;let wHc=[Number(this.shared.getVariable(jHc.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(jHc.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(jHc.shape.size[2],[this.uuid,"particles","shape_size_2"]))],xHc={...mGc(this.system.data).shape,size:wHc};this.emitterShape.applyToShader(nHc.material.uniforms,xHc),lHc.init(),this.gpuCompute=lHc,this.positionSimRT=nHc,this.velocitySimRT=oHc,this.emissionRateSimRT=pHc,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(yHc){let zHc=Number(this.shared.getVariable(yHc[0],[this.uuid,"particles","direction_x"])),AHc=Number(this.shared.getVariable(yHc[1],[this.uuid,"particles","direction_y"])),BHc=Number(this.shared.getVariable(yHc[2],[this.uuid,"particles","direction_z"]));return[zHc,AHc,BHc]}updateSimulationDefinition(CHc){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,CHc.colliderEntityId&&this.system.colliderEntities.length>0){let DHc=this.system.getColliderData(CHc.colliderEntityId);switch(DHc?.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0;break}let EHc=DHc?.colliderType;"sphere"===EHc&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),"box"===EHc&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),DHc?.forceRange==="helper"&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}"normals"===CHc.directionMode&&(this.simFeaturesDefinition.USE_NORMALS=!0),"curl"===CHc.noiseType&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),"simplex"===CHc.noiseType&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),"fbm"===CHc.noiseType&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let FHc="";for(let[GHc,HHc]of Object.entries(this.simFeaturesDefinition))HHc&&(FHc+=`#define ${GHc}
`);return FHc}createShape(IHc,JHc){this.emitterShape&&this.emitterShape.dispose();let KHc=new fm(Number(this.shared.getVariable(IHc.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(IHc.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(IHc.size[2],[this.uuid,"particles","shape_size_2"])));if("MeshEmitterShape"!==IHc.type)return new UFc(KHc,JHc,IHc.type);{let LHc=null;return this.system.context.scene.traverseEntity(a=>{a.uuid===IHc.fromMeshId&&(LHc=a)}),LHc?new UFc(KHc,JHc,IHc.type,LHc):new UFc(KHc,JHc,"SphereEmitterShape")}}createPrimaryEmitter(MHc){let NHc;return NHc=new mY(new XM(1,1,1),this.material,MHc*MHc),this.updateGeometryAttributes(NHc,MHc),this.material.needsUpdate=!0,NHc.onBeforeRender=()=>{this.applyWorldSpace()},NHc}getMaxParticlesAmount({birthRatePerSecond:OHc,particleMaxLifeTime:PHc,loopDuration:QHc=0}){return Math.ceil(OHc*(PHc+QHc))}dispose(){this.gpuCompute&&(this.rootObject?.parent?.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),this.emitterShape?.dispose())}GoEmitSomeParticles(RHc,SHc){let THc=RHc-this.lastEmitTime,UHc=1/SHc;if(THc>=UHc){let VHc=Math.max(1,Math.floor(THc/UHc));return this.lastEmitTime=RHc,this.emittedParticlesAmount+VHc>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=VHc,VHc}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(mGc(this.system.data))}startEmitting(WHc){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=WHc}stopEmitting(){this.isEmitting=!1}},XHc=class extends Bvb{constructor(YHc,ZHc,$Hc){super(YHc,ZHc),this.type="ParticleSystem",this.geometry=new nE,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=a=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(a))},this.context=$Hc,this.data={...ZHc,...mGc(ZHc)},this.geometry.setAttribute("position",new cE([],3)),this.material=new MC({colorWrite:!1}),this.frustumCulled=!1}init(_Hc){this.renderer=_Hc,this.emitter=new oGc(_Hc,this),this.add(this.emitter),this.updateParticleState(this.data)}update(aIc){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=aIc,this.stopped||(this.currentLoopTime+=aIc);let bIc="one_time"===this.data.emitTimeCycle;if(("loop"===this.data.emitTimeCycle||bIc)&&this.currentLoopTime>1e3*this.data.emitTimeDuration&&(this.stopped||(this.stop(),bIc||this.start("start"===this.data.emitTimeLoopDelayStart?0:1e3*this.data.emitTimeDelay))),this.emitter&&this.started){let cIc=this.actualTime/1e3;this.emitter.update(cIc,aIc)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(dIc){return this.colliderEntities.some(a=>a.identity===dIc)}getColliderData(eIc){let fIc=this.colliderEntities.find(a=>a.identity===eIc);return fIc?fIc.data:null}updateByPatchedOp(gIc,hIc,iIc){super.updateByPatchedOp(gIc,hIc,iIc),TFa(gIc.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...$Fa.drop(gIc,1).props}}),TFa(gIc.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...$Fa.drop(gIc,1).props}})}updateState(jIc,kIc){super.updateState(jIc,kIc),this.updateParticleState(jIc)}updateParticleState(lIc){if(this.emitter){if(void 0!==lIc.colliderEntityId&&null!==lIc.colliderEntityId){let mIc=this.context.scene.find(lIc.colliderEntityId);this.colliderEntities=mIc?[mIc]:[]}null===lIc.colliderEntityId&&(this.colliderEntities=[]),this.emitter.updateState(lIc),lIc.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(nIc){this.emitter&&(this.emitter.updateForceFieldParameters(nIc),this.stop(),this.start())}start(oIc=0){if(this.currentLoopTime=0,oIc){setTimeout(()=>{this.start(0)},oIc);return}this.started=!0,this.stopped=!1,this.isFrozen=!1,this.emitter?.startEmitting(this.actualTime/1e3)}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){this.stopped=!0,this.currentLoopTime=0,this.emitter?.stopEmitting()}reset(){this.started=!1,this.stopped=!1,this.emitter?.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function pIc(a,b,c){var d,e,f;return console.assert(void 0!==b.type),"Mesh"===b.type?(d=a,e=b,f=c,"TextGeometry"===e.geometry.type?new g2b(d,e,f):"SubdivGeometry"===e.geometry.type?new G0b(d,e,f):"PathGeometry"===e.geometry.type?new gDc(d,e,f):"VectorGeometry"===e.geometry.type?new cDc(d,e,f):"BooleanGeometry"===e.geometry.type?new _6b(d,e,f):"UIGeometry"===e.geometry.type?new jEc(d,e,f):new A_b(d,e,f)):"Empty"===b.type?new A7b(a,b):"Particle"===b.type?new XHc(a,b,c):"ParticleCollider"===b.type?new F7b(a,b,c):"Splat"===b.type?new A7b(a,b):"Bone"===b.type?new eEc(a,b):"Page"===b.type?new aCc(a,b,c):"PointLight"===b.type?new NCc(a,b,c):"SpotLight"===b.type?new trc(a,b,c):"DirectionalLight"===b.type?new crc(a,b,c):"Component"===b.type||"Instance"===b.type?new BDc(a,b,c):FJa.is(b.type)?new U5b(a,b):(console.error(b),new A7b(a,b))}function qIc(a,b){let c=!1,d=b.getLayersOfType("transmission"),e=b.getLayersOfType("outline");return e.length>0&&(a.layers.set(8),d.length>0&&a.layers.enable(3),c=!0,D0b(a),C0b(a)),0===d.length&&0===e.length&&a.layers.set(0),a instanceof i_b&&a.needsAO&&a.layers.enable(5),c}function rIc(a,b){if(!b.layers)return!1;let c=!1,d=b.getLayersOfType("transmission").filter(a=>a.data.visible),e=b.getLayersOfType("outline").filter(a=>a.data.visible);return d.length>0&&(a.layers.set(3),e.length>0&&a.layers.enable(8),c=!0),0===d.length&&0===e.length&&a.layers.set(0),a.needsAO&&a.layers.enable(5),c}HSa.createEntity=pIc,HSa.changeEntityProptotype=function(a,b,c){let d=pIc(a.identity,b,c),e=a.children,f=a.attachedPaths,g=a.parent,h=a.component,i=a.instances,j=a.overrideData,k=a.uuid,l=a.stateSelection;for(let m of(a.dispose(),Object.keys(a)))delete a[m];for(let n of(Object.setPrototypeOf(a,Object.getPrototypeOf(d)),Object.keys(d)))a[n]=d[n];a.children=[...a.children,...e],a.attachedPaths=f,a.parent=g,a.component=h,a.instances=i,a.uuid=k,a.overrideData=j,a.updateState(a.data,c),l&&a.changeSelectedState(l,c),a.resetBBoxNeedsUpdate()},HSa.Cloner=E2b;var sIc=new Goa,tIc=new rs,uIc=new $q;function vIc(a,b,c,d=!1){let e=a.cloner;if(e)for(let f of e.children){let g=tIc.copy(f.matrixWorld).invert(),h=uIc.copy(b.ray).applyMatrix4(g),i=a.matrixWorld;h.applyMatrix4(i);let j=sIc;j.set(h.origin,h.direction),j.near=b.near,j.far=b.far;let k=j.intersectObject(a,!1);k.length>0&&c.push({...k[0],object:d?f:a})}}var wIc=class{constructor(){this._constraints=new Map}setConstraint(xIc,yIc){null===yIc?this._constraints.delete(xIc):this._constraints.set(xIc,yIc)}removeDependencies(zIc){this._constraints.delete(zIc)}applyConstraints(AIc){let BIc=new Set;this._constraints.forEach((a,b)=>{let c=[b,a],d=a;for(;this._constraints.has(d);)d=this._constraints.get(d),BIc.has(d)||c.push(d);for(let e=c.length-2;e>=0;e--)if(!BIc.has(c[e])){let f=AIc.find(c[e]);f?f.applyPathSnapping(AIc):console.warn(`missing entity ${c[e]}`),BIc.add(c[e])}})}findDependency(CIc,DIc){let EIc=CIc;for(;this._constraints.has(EIc);)if((EIc=this._constraints.get(EIc))===DIc)return!0;return!1}},FIc=r(E()),GIc=r(J()),HIc=r(E()),IIc=r(J()),JIc=class{constructor(KIc,LIc,MIc){this._dataNormalized=KIc,this._minD=LIc,this._maxD=MIc}static createFromUnnormalized(NIc){let OIc=IIc.sup(NIc),PIc=IIc.inf(NIc),QIc=(0,HIc.default)(new Float32Array(NIc.size),NIc.shape),RIc=OIc-PIc;return RIc<1e-4?IIc.assigns(QIc,0):(IIc.subs(QIc,NIc,PIc),IIc.divs(QIc,QIc,RIc)),new JIc(QIc,PIc,OIc)}get data(){return this._dataNormalized}get minD(){return this._minD}get maxD(){return this._maxD}denormalize(){let SIc=(0,HIc.default)(new Float32Array(this._dataNormalized.size),this._dataNormalized.shape);return IIc.muls(SIc,this._dataNormalized,this._maxD-this._minD),IIc.adds(SIc,SIc,this._minD),SIc}},TIc=class{constructor(UIc,VIc){this._quantized=UIc,this._method=VIc}get quantized(){return this._quantized}static maxIntBits(WIc){return 2**WIc-1}static fromNormalized(XIc,YIc){let ZIc=XIc.data,$Ic;if("norm8x"===YIc){let _Ic=TIc.maxIntBits(8),aJc=(0,HIc.default)(new Float32Array(ZIc.size),ZIc.shape);IIc.muls(aJc,ZIc,_Ic),IIc.roundeq(aJc),$Ic=(0,HIc.default)(new Uint8Array(aJc.data),ZIc.shape)}else if("norm565"===YIc){let bJc=(0,HIc.default)(new Float32Array(ZIc.size),ZIc.shape);IIc.assign(bJc,ZIc),IIc.mulseq(bJc.pick(null,0),TIc.maxIntBits(5)),IIc.mulseq(bJc.pick(null,1),TIc.maxIntBits(6)),IIc.mulseq(bJc.pick(null,2),TIc.maxIntBits(5)),IIc.roundeq(bJc);let cJc=(0,HIc.default)(new Uint16Array(bJc.data),ZIc.shape),dJc=(0,HIc.default)(new Uint16Array(ZIc.shape[0]),[ZIc.shape[0]]),eJc=(0,HIc.default)(new Uint16Array(ZIc.shape[0]),[ZIc.shape[0]]);IIc.lshifts(dJc,cJc.pick(null,0),11),IIc.lshifts(eJc,cJc.pick(null,1),5),IIc.boreq(dJc,eJc),IIc.boreq(dJc,cJc.pick(null,2)),$Ic=dJc}else{let fJc=(0,HIc.default)(new Float32Array(ZIc.size),ZIc.shape);IIc.assign(fJc,ZIc),IIc.mulseq(fJc.pick(null,0),TIc.maxIntBits(11)),IIc.mulseq(fJc.pick(null,1),TIc.maxIntBits(10)),IIc.mulseq(fJc.pick(null,2),TIc.maxIntBits(11)),IIc.roundeq(fJc);let gJc=(0,HIc.default)(new Uint32Array(fJc.data),ZIc.shape),hJc=(0,HIc.default)(new Uint32Array(ZIc.shape[0]),[ZIc.shape[0]]),iJc=(0,HIc.default)(new Uint32Array(ZIc.shape[0]),[ZIc.shape[0]]);IIc.lshifts(hJc,gJc.pick(null,0),21),IIc.lshifts(iJc,gJc.pick(null,1),11),IIc.boreq(hJc,iJc),IIc.boreq(hJc,gJc.pick(null,2)),$Ic=hJc}return new TIc($Ic,YIc)}dequantize(jJc,kJc){let lJc=this._method,mJc,nJc=this._quantized;if("norm8x"===lJc){let oJc=TIc.maxIntBits(8);mJc=(0,HIc.default)(new Float32Array(nJc.size),nJc.shape),IIc.muls(mJc,nJc,1/oJc)}else if("norm565"===lJc){let pJc=(0,HIc.default)(new Uint8Array(nJc.shape[0]),[nJc.shape[0]]),qJc=(0,HIc.default)(new Uint8Array(nJc.shape[0]),[nJc.shape[0]]),rJc=(0,HIc.default)(new Uint8Array(nJc.shape[0]),[nJc.shape[0]]);IIc.rrshifts(pJc,nJc,11),IIc.rrshifts(qJc,nJc,5),IIc.bandseq(qJc,TIc.maxIntBits(6)),IIc.bands(rJc,nJc,TIc.maxIntBits(5)),mJc=(0,HIc.default)(new Float32Array(3*nJc.shape[0]),[nJc.shape[0],3]),IIc.muls(mJc.pick(null,0),pJc,1/TIc.maxIntBits(5)),IIc.muls(mJc.pick(null,1),qJc,1/TIc.maxIntBits(6)),IIc.muls(mJc.pick(null,2),rJc,1/TIc.maxIntBits(5))}else{let sJc=(0,HIc.default)(new Uint16Array(nJc.shape[0]),[nJc.shape[0]]),tJc=(0,HIc.default)(new Uint16Array(nJc.shape[0]),[nJc.shape[0]]),uJc=(0,HIc.default)(new Uint16Array(nJc.shape[0]),[nJc.shape[0]]);IIc.rrshifts(sJc,nJc,21),IIc.rrshifts(tJc,nJc,11),IIc.bandseq(tJc,TIc.maxIntBits(10)),IIc.bands(uJc,nJc,TIc.maxIntBits(11)),mJc=(0,HIc.default)(new Float32Array(3*nJc.shape[0]),[nJc.shape[0],3]),IIc.muls(mJc.pick(null,0),sJc,1/TIc.maxIntBits(11)),IIc.muls(mJc.pick(null,1),tJc,1/TIc.maxIntBits(10)),IIc.muls(mJc.pick(null,2),uJc,1/TIc.maxIntBits(11))}return new JIc(mJc,jJc,kJc)}},vJc=class{constructor(wJc,xJc,yJc,zJc,AJc,BJc=!1){this._quantized=wJc,this._minMaxMatrix=xJc,this._chunkSize=yJc,this._quantizationMethod=zJc,this._variableChunkSize=AJc,this._isDynamicChunks=BJc}get length(){return this._quantized.shape[0]}get nchunks(){return this._minMaxMatrix.shape[0]}get quantized(){return this._quantized}get method(){return this._quantizationMethod}get minmaxMatrix(){return this._minMaxMatrix}_createPrunedMinMax(CJc){let DJc=CJc.length,EJc=this.minmaxMatrix.shape[0]-DJc,FJc=(0,FIc.default)(new Float32Array(2*EJc),[EJc,2]),GJc=0,HJc=EJc,IJc=0,JJc=this.minmaxMatrix.shape[0];for(let KJc=0;KJc<CJc.length;KJc++)(HJc=(JJc=CJc[KJc])-IJc+GJc)>GJc&&GIc.assign(FJc.hi(HJc,2).lo(GJc,0),this.minmaxMatrix.hi(JJc,2).lo(IJc,0)),GJc=HJc,IJc=JJc+1;return GJc<EJc&&GIc.assign(FJc.lo(GJc,0),this.minmaxMatrix.lo(IJc,0)),FJc}_createPrunedQuantized(LJc){let MJc=LJc.length,NJc=this.quantized.shape[0]-MJc,OJc=this._quantizationMethod,PJc,QJc;if("norm8x"===OJc){let RJc=(QJc=this._quantized.shape[1])?NJc*QJc:NJc;PJc=(0,FIc.default)(new Uint8Array(RJc),QJc?[NJc,QJc]:[NJc,1])}else PJc="norm565"===OJc?(0,FIc.default)(new Uint16Array(NJc),[NJc]):(0,FIc.default)(new Uint32Array(NJc),[NJc]);let SJc=0,TJc=NJc,UJc=0,VJc=PJc.shape[0];for(let WJc=0;WJc<LJc.length;WJc++)(TJc=(VJc=LJc[WJc])-UJc+SJc)>SJc&&(QJc?GIc.assign(PJc.hi(TJc,QJc).lo(SJc,0),this._quantized.hi(VJc,QJc).lo(UJc,0)):GIc.assign(PJc.hi(TJc).lo(SJc),this._quantized.hi(VJc).lo(UJc))),SJc=TJc,UJc=VJc+1;return SJc<NJc&&(QJc?GIc.assign(PJc.lo(SJc,0),this._quantized.lo(UJc,0)):GIc.assign(PJc.lo(SJc),this._quantized.lo(UJc))),PJc}pruneFeature(XJc,YJc,ZJc){let $Jc=this._createPrunedQuantized(XJc),_Jc=this._createPrunedMinMax(YJc);return new vJc($Jc,_Jc,this._chunkSize,this._quantizationMethod,ZJc,!0)}static getRequiredNChunks(aKc,bKc){return Math.floor(aKc/bKc)}static fromArray(cKc,dKc,eKc){let fKc=cKc.shape[0],gKc=Math.floor(fKc/eKc),hKc=(0,FIc.default)(new Float32Array(2*gKc),[gKc,2],[2,1]),iKc;iKc="norm8x"===dKc?(0,FIc.default)(new Uint8Array(cKc.size),cKc.shape):"norm565"===dKc?(0,FIc.default)(new Uint16Array(cKc.shape[0]),[cKc.shape[0]]):(0,FIc.default)(new Uint32Array(cKc.shape[0]),[cKc.shape[0]]);for(let jKc=0;jKc<gKc;jKc++){let kKc=jKc*eKc,lKc=jKc+1<gKc?(jKc+1)*eKc:fKc,mKc;mKc=cKc.shape.length>1?JIc.createFromUnnormalized(cKc.hi(lKc,cKc.shape[1]).lo(kKc,0)):JIc.createFromUnnormalized(cKc.hi(lKc).lo(kKc)),hKc.set(jKc,0,mKc.minD),hKc.set(jKc,1,mKc.maxD),iKc.shape.length>1?GIc.assign(iKc.hi(lKc,iKc.shape[1]).lo(kKc,0),TIc.fromNormalized(mKc,dKc).quantized):GIc.assign(iKc.hi(lKc).lo(kKc),TIc.fromNormalized(mKc,dKc).quantized)}return new vJc(iKc,hKc,eKc,dKc)}denormDequant(){let nKc=this._minMaxMatrix.shape[0],oKc=this._quantized,pKc=oKc.shape[0],qKc=this._quantizationMethod,rKc=this._chunkSize,sKc;if(this._isDynamicChunks){if(!this._variableChunkSize)throw new Error("variable chunk must exists if chunkSize isDynamic");sKc=this._variableChunkSize}let tKc;tKc="norm8x"===qKc?(0,FIc.default)(new Float32Array(oKc.size),oKc.shape):(0,FIc.default)(new Float32Array(3*pKc),[pKc,3]);let uKc=0,vKc=rKc;for(let wKc=0;wKc<nKc;wKc++){let[xKc,yKc]=[this._minMaxMatrix.get(wKc,0),this._minMaxMatrix.get(wKc,1)];this._isDynamicChunks&&(vKc=sKc[wKc]);let zKc=wKc+1<nKc?uKc+vKc:pKc,AKc;AKc=oKc.shape.length>1?new TIc(oKc.hi(zKc,oKc.shape[1]).lo(uKc,0),qKc):new TIc(oKc.hi(zKc).lo(uKc),qKc),GIc.assign(tKc.hi(zKc,tKc.shape[1]).lo(uKc,0),AKc.dequantize(xKc,yKc).denormalize()),uKc=zKc}return tKc}static async fetchArrayBuffer(BKc){return await (await fetch(BKc,{mode:"cors"})).arrayBuffer()}},CKc=r(E()),DKc=r(J()),EKc=r(E()),FKc=r(J()),GKc=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function HKc(a){return a<1e5?a<100?a<10?0:1:a<1e4?a<1e3?2:3:4:a<1e7?a<1e6?5:6:a<1e9?a<1e8?7:8:9}function IKc(a,b){if(a===b)return 0;if(~~a===a&& ~~b===b){if(0===a||0===b)return a<b?-1:1;if(a<0||b<0){if(b>=0)return -1;if(a>=0)return 1;a=-a,b=-b}let c=HKc(a),d=HKc(b),e=0;return c<d?(a*=GKc[d-c-1],b/=10,e=-1):c>d&&(b*=GKc[c-d-1],a/=10,e=1),a===b?e:a<b?-1:1}let f=String(a),g=String(b);return f===g?0:f<g?-1:1}function JKc(a,b,c,d){let e=b+1;if(e===c)return 1;if(0>d(a[e++],a[b])){for(;e<c&&0>d(a[e],a[e-1]);)e++;KKc(a,b,e)}else for(;e<c&&d(a[e],a[e-1])>=0;)e++;return e-b}function KKc(a,b,c){for(c--;b<c;){let d=a[b];a[b++]=a[c],a[c--]=d}}function LKc(a,b,c,d,e){for(d===b&&d++;d<c;d++){let f=a[d],g=b,h=d;for(;g<h;){let i=g+h>>>1;0>e(f,a[i])?h=i:g=i+1}let j=d-g;switch(j){case 3:a[g+3]=a[g+2];case 2:a[g+2]=a[g+1];case 1:a[g+1]=a[g];break;default:for(;j>0;)a[g+j]=a[g+j-1],j--}a[g]=f}}function MKc(a,b,c,d,e,f){let g=0,h=0,i=1;if(f(a,b[c+e])>0){for(h=d-e;i<h&&f(a,b[c+e+i])>0;)g=i,i=(i<<1)+1,i<=0&&(i=h);i>h&&(i=h),g+=e,i+=e}else{for(h=e+1;i<h&&0>=f(a,b[c+e-i]);)g=i,i=(i<<1)+1,i<=0&&(i=h);i>h&&(i=h);let j=g;g=e-i,i=e-j}for(g++;g<i;){let k=g+(i-g>>>1);f(a,b[c+k])>0?g=k+1:i=k}return i}function NKc(a,b,c,d,e,f){let g=0,h=0,i=1;if(0>f(a,b[c+e])){for(h=e+1;i<h&&0>f(a,b[c+e-i]);)g=i,i=(i<<1)+1,i<=0&&(i=h);i>h&&(i=h);let j=g;g=e-i,i=e-j}else{for(h=d-e;i<h&&f(a,b[c+e+i])>=0;)g=i,i=(i<<1)+1,i<=0&&(i=h);i>h&&(i=h),g+=e,i+=e}for(g++;g<i;){let k=g+(i-g>>>1);0>f(a,b[c+k])?i=k:g=k+1}return i}var OKc=class{constructor(PKc,QKc){s(this,"array",null),s(this,"compare",null),s(this,"minGallop",7),s(this,"length",0),s(this,"tmpStorageLength",256),s(this,"stackLength",0),s(this,"runStart",null),s(this,"runLength",null),s(this,"stackSize",0),this.array=PKc,this.compare=QKc,this.length=PKc.length,this.length<512&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength)}pushRun(RKc,SKc){this.runStart[this.stackSize]=RKc,this.runLength[this.stackSize]=SKc,this.stackSize+=1}mergeRuns(){for(;this.stackSize>1;){let TKc=this.stackSize-2;if(TKc>=1&&this.runLength[TKc-1]<=this.runLength[TKc]+this.runLength[TKc+1]||TKc>=2&&this.runLength[TKc-2]<=this.runLength[TKc]+this.runLength[TKc-1])this.runLength[TKc-1]<this.runLength[TKc+1]&&TKc--;else if(this.runLength[TKc]>this.runLength[TKc+1])break;this.mergeAt(TKc)}}forceMergeRuns(){for(;this.stackSize>1;){let UKc=this.stackSize-2;UKc>0&&this.runLength[UKc-1]<this.runLength[UKc+1]&&UKc--,this.mergeAt(UKc)}}mergeAt(VKc){let WKc=this.compare,XKc=this.array,YKc=this.runStart[VKc],ZKc=this.runLength[VKc],$Kc=this.runStart[VKc+1],_Kc=this.runLength[VKc+1];this.runLength[VKc]=ZKc+_Kc,VKc===this.stackSize-3&&(this.runStart[VKc+1]=this.runStart[VKc+2],this.runLength[VKc+1]=this.runLength[VKc+2]),this.stackSize--;let aLc=NKc(XKc[$Kc],XKc,YKc,ZKc,0,WKc);YKc+=aLc,ZKc-=aLc,0!==ZKc&&0!==(_Kc=MKc(XKc[YKc+ZKc-1],XKc,$Kc,_Kc,_Kc-1,WKc))&&(ZKc<=_Kc?this.mergeLow(YKc,ZKc,$Kc,_Kc):this.mergeHigh(YKc,ZKc,$Kc,_Kc))}mergeLow(bLc,cLc,dLc,eLc){let fLc=this.compare,gLc=this.array,hLc=this.tmp,iLc=0;for(iLc=0;iLc<cLc;iLc++)hLc[iLc]=gLc[bLc+iLc];let jLc=0,kLc=dLc,lLc=bLc;if(gLc[lLc++]=gLc[kLc++],0== --eLc){for(iLc=0;iLc<cLc;iLc++)gLc[lLc+iLc]=hLc[jLc+iLc];return}if(1===cLc){for(iLc=0;iLc<eLc;iLc++)gLc[lLc+iLc]=gLc[kLc+iLc];gLc[lLc+eLc]=hLc[jLc];return}let mLc=this.minGallop;for(;;){let nLc=0,oLc=0,pLc=!1;do if(0>fLc(gLc[kLc],hLc[jLc])){if(gLc[lLc++]=gLc[kLc++],oLc++,nLc=0,0== --eLc){pLc=!0;break}}else if(gLc[lLc++]=hLc[jLc++],nLc++,oLc=0,1== --cLc){pLc=!0;break}while((nLc|oLc)<mLc);if(pLc)break;do{if(0!==(nLc=NKc(gLc[kLc],hLc,jLc,cLc,0,fLc))){for(iLc=0;iLc<nLc;iLc++)gLc[lLc+iLc]=hLc[jLc+iLc];if(lLc+=nLc,jLc+=nLc,cLc-=nLc,cLc<=1){pLc=!0;break}}if(gLc[lLc++]=gLc[kLc++],0== --eLc){pLc=!0;break}if(0!==(oLc=MKc(hLc[jLc],gLc,kLc,eLc,0,fLc))){for(iLc=0;iLc<oLc;iLc++)gLc[lLc+iLc]=gLc[kLc+iLc];if(lLc+=oLc,kLc+=oLc,eLc-=oLc,0===eLc){pLc=!0;break}}if(gLc[lLc++]=hLc[jLc++],1== --cLc){pLc=!0;break}mLc--}while(nLc>=7||oLc>=7);if(pLc)break;mLc<0&&(mLc=0),mLc+=2}if(this.minGallop=mLc,mLc<1&&(this.minGallop=1),1===cLc){for(iLc=0;iLc<eLc;iLc++)gLc[lLc+iLc]=gLc[kLc+iLc];gLc[lLc+eLc]=hLc[jLc]}else{if(0===cLc)throw new Error("mergeLow preconditions were not respected");for(iLc=0;iLc<cLc;iLc++)gLc[lLc+iLc]=hLc[jLc+iLc]}}mergeHigh(qLc,rLc,sLc,tLc){let uLc=this.compare,vLc=this.array,wLc=this.tmp,xLc=0;for(xLc=0;xLc<tLc;xLc++)wLc[xLc]=vLc[sLc+xLc];let yLc=qLc+rLc-1,zLc=tLc-1,ALc=sLc+tLc-1,BLc=0,CLc=0;if(vLc[ALc--]=vLc[yLc--],0== --rLc){for(BLc=ALc-(tLc-1),xLc=0;xLc<tLc;xLc++)vLc[BLc+xLc]=wLc[xLc];return}if(1===tLc){for(ALc-=rLc,yLc-=rLc,CLc=ALc+1,BLc=yLc+1,xLc=rLc-1;xLc>=0;xLc--)vLc[CLc+xLc]=vLc[BLc+xLc];vLc[ALc]=wLc[zLc];return}let DLc=this.minGallop;for(;;){let ELc=0,FLc=0,GLc=!1;do if(0>uLc(wLc[zLc],vLc[yLc])){if(vLc[ALc--]=vLc[yLc--],ELc++,FLc=0,0== --rLc){GLc=!0;break}}else if(vLc[ALc--]=wLc[zLc--],FLc++,ELc=0,1== --tLc){GLc=!0;break}while((ELc|FLc)<DLc);if(GLc)break;do{if(0!=(ELc=rLc-NKc(wLc[zLc],vLc,qLc,rLc,rLc-1,uLc))){for(ALc-=ELc,yLc-=ELc,rLc-=ELc,CLc=ALc+1,BLc=yLc+1,xLc=ELc-1;xLc>=0;xLc--)vLc[CLc+xLc]=vLc[BLc+xLc];if(0===rLc){GLc=!0;break}}if(vLc[ALc--]=wLc[zLc--],1== --tLc){GLc=!0;break}if(0!=(FLc=tLc-MKc(vLc[yLc],wLc,0,tLc,tLc-1,uLc))){for(ALc-=FLc,zLc-=FLc,tLc-=FLc,CLc=ALc+1,BLc=zLc+1,xLc=0;xLc<FLc;xLc++)vLc[CLc+xLc]=wLc[BLc+xLc];if(tLc<=1){GLc=!0;break}}if(vLc[ALc--]=vLc[yLc--],0== --rLc){GLc=!0;break}DLc--}while(ELc>=7||FLc>=7);if(GLc)break;DLc<0&&(DLc=0),DLc+=2}if(this.minGallop=DLc,DLc<1&&(this.minGallop=1),1===tLc){for(ALc-=rLc,yLc-=rLc,CLc=ALc+1,BLc=yLc+1,xLc=rLc-1;xLc>=0;xLc--)vLc[CLc+xLc]=vLc[BLc+xLc];vLc[ALc]=wLc[zLc]}else{if(0===tLc)throw new Error("mergeHigh preconditions were not respected");for(BLc=ALc-(tLc-1),xLc=0;xLc<tLc;xLc++)vLc[BLc+xLc]=wLc[xLc]}}};function HLc(a){let b=(0,EKc.default)(new Int32Array(a.shape[0]),[a.shape[0]]),c=(0,EKc.default)(new Int32Array(a.shape[0]),[a.shape[0]]);return FKc.bands(b,a,1023),FKc.lshifts(c,b,16),FKc.bxoreq(b,c),FKc.bandseq(b,4278190335),FKc.lshifts(c,b,8),FKc.bxoreq(b,c),FKc.bandseq(b,50393103),FKc.lshifts(c,b,4),FKc.bxoreq(b,c),FKc.bandseq(b,51130563),FKc.lshifts(c,b,2),FKc.bxoreq(b,c),FKc.bandseq(b,153391689),b}function ILc(a,b){if(a.shape[0]!==b.shape[0])throw new Error("wrong length");let c=(0,EKc.default)(new Float32Array(a.size),a.shape,a.stride,a.offset);for(let d=0;d<b.shape[0];d++){let e=b.get(d);if(a.shape.length>1)for(let f=0;f<a.shape[1];f++)c.set(d,f,a.get(e,f));else c.set(d,a.get(e))}return c}var JLc=class{constructor(KLc,LLc,MLc,NLc,OLc,PLc,QLc,RLc,SLc,TLc){this.propertyDescs=KLc,this.format=LLc,this.nsplats=MLc,this.xyz=NLc,this.colors=OLc,this.harmonics=PLc,this.opacity=QLc,this.scaling=RLc,this.rotation=SLc,this.maxSHDegree=TLc}getPlyBinary(){let ULc=JLc._generateHeaderString(this.propertyDescs,this.format,this.nsplats),VLc=new TextEncoder().encode(ULc),WLc=Object.keys(this.propertyDescs).length,XLc=(0,CKc.default)(new Float32Array(this.nsplats*WLc),[this.nsplats,WLc]);if(DKc.assign(XLc.pick(null,this.propertyDescs.x.index),this.xyz.pick(null,0)),DKc.assign(XLc.pick(null,this.propertyDescs.y.index),this.xyz.pick(null,1)),DKc.assign(XLc.pick(null,this.propertyDescs.z.index),this.xyz.pick(null,2)),DKc.assign(XLc.pick(null,this.propertyDescs.f_dc_0.index),this.colors.pick(null,0)),DKc.assign(XLc.pick(null,this.propertyDescs.f_dc_1.index),this.colors.pick(null,1)),DKc.assign(XLc.pick(null,this.propertyDescs.f_dc_2.index),this.colors.pick(null,2)),DKc.assign(XLc.pick(null,this.propertyDescs.opacity.index),this.opacity.pick(null,0)),DKc.assign(XLc.pick(null,this.propertyDescs.scale_0.index),this.scaling.pick(null,0)),DKc.assign(XLc.pick(null,this.propertyDescs.scale_1.index),this.scaling.pick(null,1)),DKc.assign(XLc.pick(null,this.propertyDescs.scale_2.index),this.scaling.pick(null,2)),DKc.assign(XLc.pick(null,this.propertyDescs.rot_0.index),this.rotation.pick(null,0)),DKc.assign(XLc.pick(null,this.propertyDescs.rot_1.index),this.rotation.pick(null,1)),DKc.assign(XLc.pick(null,this.propertyDescs.rot_2.index),this.rotation.pick(null,2)),DKc.assign(XLc.pick(null,this.propertyDescs.rot_3.index),this.rotation.pick(null,3)),this.harmonics&&this.harmonics.length>0)for(let YLc=0;YLc<this.harmonics.length;YLc++){let ZLc=3*YLc;DKc.assign(XLc.pick(null,this.propertyDescs[`f_rest_${ZLc}`].index),this.harmonics[YLc].pick(null,0)),DKc.assign(XLc.pick(null,this.propertyDescs[`f_rest_${ZLc+1}`].index),this.harmonics[YLc].pick(null,1)),DKc.assign(XLc.pick(null,this.propertyDescs[`f_rest_${ZLc+2}`].index),this.harmonics[YLc].pick(null,2))}let $Lc=new Uint8Array(XLc.data.buffer),_Lc=new Uint8Array($Lc.length+VLc.length);return _Lc.set(VLc),_Lc.set($Lc,VLc.length),_Lc.buffer}save(aMc,bMc){let cMc=this.getPlyBinary(),dMc=new Blob([cMc],{type:"application/octet-stream"}),eMc=new File([dMc],aMc),fMc=new FormData;fMc.append("file",eMc),fMc.append("filename",aMc),fMc.append("basedir",bMc),fetch("http://127.0.0.1:8000/push_file",{method:"POST",body:fMc})}static async loadFile(gMc){return await (await fetch(gMc)).arrayBuffer()}mortonPositionSplatsSort(){var hMc,iMc;let jMc,kMc,lMc,mMc,nMc,oMc,pMc,qMc,rMc,sMc,tMc=(hMc=this.xyz,jMc=FKc.sup(hMc),kMc=FKc.inf(hMc),lMc=(0,EKc.default)(new Float32Array(hMc.data),hMc.shape),FKc.mulseq(lMc,1e3/Math.min(1e3,jMc-kMc)),pMc=(0,EKc.default)(new Int32Array(lMc.data),hMc.shape),mMc=HLc((iMc=pMc).pick(null,0)),nMc=HLc(iMc.pick(null,1)),FKc.lshiftseq(nMc,1),oMc=HLc(iMc.pick(null,2)),FKc.lshiftseq(oMc,2),FKc.boreq(mMc,nMc),FKc.boreq(mMc,oMc),qMc=mMc,rMc=Array.from(qMc.data).map((a,b)=>[a,b]),!function(a,b,c,d){if(!Array.isArray(a))throw new TypeError("Can only sort arrays");b?"function"!=typeof b&&(d=c,c=b,b=IKc):b=IKc,c||(c=0),d||(d=a.length);let e=d-c;if(e<2)return;let f=0;if(e<32){f=JKc(a,c,d,b),LKc(a,c,d,c+f,b);return}let g=new OKc(a,b),h=function(a){let b=0;for(;a>=32;)b|=1&a,a>>=1;return a+b}(e);do{if((f=JKc(a,c,d,b))<h){let i=e;i>h&&(i=h),LKc(a,c,c+i,c+f,b),f=i}g.pushRun(c,f),g.mergeRuns(),e-=f,c+=f}while(0!==e);g.forceMergeRuns()}(rMc,(a,b)=>a[0]-b[0]),sMc=rMc.map(([a,b])=>b),(0,EKc.default)(Uint32Array.from(sMc))),uMc=ILc(this.xyz,tMc),vMc=ILc(this.colors,tMc),wMc=ILc(this.opacity,tMc),xMc=ILc(this.scaling,tMc),yMc=ILc(this.rotation,tMc),zMc=[];for(let AMc=0;AMc<this.harmonics.length;AMc++)zMc.push(ILc(this.harmonics[AMc],tMc));return new JLc(this.propertyDescs,this.format,this.nsplats,uMc,vMc,zMc,wMc,xMc,yMc,this.maxSHDegree)}static _generateHeaderString(BMc,CMc,DMc){let EMc=`ply
format ${CMc.format} ${CMc.version}
element vertex ${DMc}`,FMc=Array(Object.keys(BMc).length);for(let GMc in BMc){let HMc=BMc[GMc];FMc[HMc.index]={name:GMc,dtype:HMc.dtype}}for(let IMc=0;IMc<FMc.length;IMc++)EMc=`${EMc}
property ${FMc[IMc].dtype} ${FMc[IMc].name}`;return`${EMc}
end_header
`}static fromArrayBuffer(JMc,KMc=3){let{splatCount:LMc,vertexData:MMc,propertiesDesc:NMc,format:OMc}=JLc.decodeHeader(JMc),PMc=MMc.buffer.slice(MMc.byteOffset),QMc=Object.keys(NMc).length,RMc=(0,CKc.default)(new Float32Array(PMc),[LMc,QMc]),SMc=0,TMc={},UMc={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1};for(let VMc in NMc)if(NMc.hasOwnProperty(VMc)){let WMc=NMc[VMc].dtype;TMc[VMc]=SMc,SMc+=UMc[WMc]}let XMc=(0,CKc.default)(new Float32Array(3*LMc),[LMc,3]);DKc.assign(XMc.pick(null,0),RMc.pick(null,TMc.x/4)),DKc.assign(XMc.pick(null,1),RMc.pick(null,TMc.y/4)),DKc.assign(XMc.pick(null,2),RMc.pick(null,TMc.z/4));let YMc=(0,CKc.default)(new Float32Array(3*LMc),[LMc,3]);DKc.assign(YMc.pick(null,0),RMc.pick(null,TMc.scale_0/4)),DKc.assign(YMc.pick(null,1),RMc.pick(null,TMc.scale_1/4)),DKc.assign(YMc.pick(null,2),RMc.pick(null,TMc.scale_2/4));let ZMc=(0,CKc.default)(new Float32Array(3*LMc),[LMc,3]);DKc.assign(ZMc.pick(null,0),RMc.pick(null,TMc.f_dc_0/4)),DKc.assign(ZMc.pick(null,1),RMc.pick(null,TMc.f_dc_1/4)),DKc.assign(ZMc.pick(null,2),RMc.pick(null,TMc.f_dc_2/4));let $Mc=(0,CKc.default)(new Float32Array(4*LMc),[LMc,4]);DKc.assign($Mc.pick(null,0),RMc.pick(null,TMc.rot_1/4)),DKc.assign($Mc.pick(null,1),RMc.pick(null,TMc.rot_2/4)),DKc.assign($Mc.pick(null,2),RMc.pick(null,TMc.rot_3/4)),DKc.assign($Mc.pick(null,3),RMc.pick(null,TMc.rot_0/4));for(let _Mc=0;_Mc<LMc;_Mc++){let aNc=$Mc.pick(_Mc,null),bNc=Math.sqrt(aNc.get(0)**2+aNc.get(1)**2+aNc.get(2)**2+aNc.get(3)**2);DKc.divseq(aNc,bNc)}let cNc=(0,CKc.default)(new Float32Array(1*LMc),[LMc,1]);DKc.assign(cNc.pick(null,0),RMc.pick(null,TMc.opacity/4));let dNc=(Math.min(Math.max(KMc,0),3)+1)**2-1,eNc=[];for(let fNc=0;fNc<dNc;fNc++){let gNc=(0,CKc.default)(new Float32Array(3*LMc),[LMc,3]),hNc=3*fNc;DKc.assign(gNc.pick(null,0),RMc.pick(null,TMc[`f_rest_${hNc}`]/4)),DKc.assign(gNc.pick(null,1),RMc.pick(null,TMc[`f_rest_${hNc+1}`]/4)),DKc.assign(gNc.pick(null,2),RMc.pick(null,TMc[`f_rest_${hNc+2}`]/4)),eNc.push(gNc)}return new JLc(NMc,OMc,LMc,XMc,ZMc,eNc,cNc,YMc,$Mc,KMc)}static async fromPLYFile(iNc,jNc=3){let kNc=await JLc.loadFile(iNc);return JLc.fromArrayBuffer(kNc,jNc)}static decodeHeader(lNc){let mNc=new TextDecoder,nNc=0,oNc="",pNc=100;for(;;){if(nNc+pNc>=lNc.byteLength)throw new Error("End of file reached while searching for end of header");let qNc=new Uint8Array(lNc,nNc,pNc);oNc+=mNc.decode(qNc);let rNc=(nNc+=pNc)-2*pNc,sNc=new Uint8Array(lNc,Math.max(0,rNc),rNc>0?2*pNc:pNc);if(mNc.decode(sNc).includes("end_header"))break}let tNc=oNc.split(`
`),uNc=0,vNc={},wNc={},xNc=0,yNc;for(let zNc=0;zNc<tNc.length;zNc++){let ANc=tNc[zNc].trim();if(ANc.startsWith("element vertex")){let BNc=ANc.match(/\d+/);BNc&&(uNc=parseInt(BNc[0]))}else if(ANc.startsWith("property")){let CNc=ANc.match(/(\w+)\s+(\w+)\s+(\w+)/);if(CNc){let DNc=CNc[2],ENc=CNc[3];vNc[ENc]=xNc,wNc[ENc]={dtype:DNc,index:xNc},xNc++}}else if(ANc.startsWith("format")){let FNc=ANc.match(/(\w+)\s+(\w+)\s+(\d+\.?\d*)/);FNc&&(yNc={format:FNc[2],version:FNc[3]})}else if("end_header"===ANc)break}let GNc=oNc.indexOf("end_header")+10+1;return{splatCount:uNc,vertexData:new DataView(lNc,GNc),headerOffset:nNc,propertiesDesc:wNc,format:yNc}}},HNc=class{constructor(INc,JNc,KNc,LNc,MNc,NNc,ONc,PNc){this.config=INc,this.xyz=JNc,this.scaling=KNc,this.color=LNc,this.opacity=MNc,this.harmonics=ONc,this.quaternion=NNc,this.variableChunkSize=PNc}get isDynamicChunks(){return this.variableChunkSize&&this.variableChunkSize.length>0}get nchunks(){return this.xyz.nchunks}get nsplats(){return this.xyz.length}get chunkSize(){return this.config.chunkSize}static compressFromGaussianData(QNc,RNc){let SNc=vJc.fromArray(QNc.xyz,RNc.xyz,RNc.chunkSize),TNc=vJc.fromArray(QNc.scaling,RNc.scaling,RNc.chunkSize),UNc=vJc.fromArray(QNc.colors,RNc.color,RNc.chunkSize),VNc=vJc.fromArray(QNc.opacity,RNc.opacity,RNc.chunkSize),WNc=vJc.fromArray(QNc.rotation,RNc.quaternion,RNc.chunkSize),XNc=QNc.harmonics,YNc=[];if(RNc.harmonics)for(let ZNc=0;ZNc<XNc.length;ZNc++){let $Nc=vJc.fromArray(XNc[ZNc],RNc.harmonics,RNc.chunkSize);YNc.push($Nc)}return new HNc(RNc,SNc,TNc,UNc,VNc,WNc,YNc)}_countIndexesInChunks(_Nc){let aOc=[],bOc=this.nchunks,cOc=this.chunkSize,dOc=this.nsplats;if(bOc===vJc.getRequiredNChunks(dOc,cOc))for(let eOc=0;eOc<_Nc.length;eOc++){let fOc=_Nc[eOc],gOc=Math.floor(fOc/this.chunkSize);gOc in aOc?aOc[gOc].push(fOc):aOc[gOc]=[fOc]}else{let hOc=this.variableChunkSize,iOc={},jOc=0;for(let kOc=0;kOc<bOc;kOc++)iOc[kOc]=jOc,jOc+=hOc[kOc];for(let lOc=0;lOc<_Nc.length;lOc++){let mOc=_Nc[lOc],nOc=Math.min(Math.floor(mOc/cOc),bOc-1);for(;mOc>=iOc[nOc]+hOc[nOc];)nOc++;nOc in aOc?aOc[nOc].push(mOc):aOc[nOc]=[mOc]}}return aOc}pruneSplats(oOc){let pOc=this._countIndexesInChunks(oOc),qOc,rOc=[];return pOc.length>0&&(qOc=this.variableChunkSize?[...this.variableChunkSize]:Array(this.nchunks).fill(this.chunkSize),pOc.forEach((a,b)=>{qOc[b]-=a.length,qOc[b]<=0&&rOc.push(b)}),qOc=qOc.filter(a=>a>0)),new HNc(this.config,this.xyz.pruneFeature(oOc,rOc,qOc),this.scaling.pruneFeature(oOc,rOc,qOc),this.color.pruneFeature(oOc,rOc,qOc),this.opacity.pruneFeature(oOc,rOc,qOc),this.quaternion.pruneFeature(oOc,rOc,qOc),this.harmonics?this.harmonics.map(a=>a.pruneFeature(oOc,rOc,this.variableChunkSize)):void 0,qOc)}static async loadConfig(sOc){return await (await fetch(sOc,{method:"GET",mode:"cors",headers:{Accept:"application/json"}})).json()}toGaussians(){let tOc={},uOc=0;if(tOc.x={dtype:"float",index:uOc},uOc++,tOc.y={dtype:"float",index:uOc},uOc++,tOc.z={dtype:"float",index:uOc},uOc++,tOc.f_dc_0={dtype:"float",index:uOc},uOc++,tOc.f_dc_1={dtype:"float",index:uOc},uOc++,tOc.f_dc_2={dtype:"float",index:uOc},uOc++,this.harmonics&&this.harmonics.length>0)for(let vOc=0;vOc<this.harmonics.length;vOc++)tOc[`f_rest_${vOc}`]={dtype:"float",index:uOc},uOc++,tOc[`f_rest_${vOc+1}`]={dtype:"float",index:uOc},uOc++,tOc[`f_rest_${vOc+2}`]={dtype:"float",index:uOc},uOc++;tOc.opacity={dtype:"float",index:uOc},uOc++,tOc.scale_0={dtype:"float",index:uOc},uOc++,tOc.scale_1={dtype:"float",index:uOc},uOc++,tOc.scale_2={dtype:"float",index:uOc},uOc++,tOc.rot_0={dtype:"float",index:uOc},uOc++,tOc.rot_1={dtype:"float",index:uOc},uOc++,tOc.rot_2={dtype:"float",index:uOc},uOc++,tOc.rot_3={dtype:"float",index:uOc},uOc++;let wOc=this.harmonics?.map(a=>a.denormDequant());return new JLc(tOc,{format:"binary_little_endian",version:"1.0"},this.xyz.length,this.xyz.denormDequant(),this.color.denormDequant(),wOc||[],this.opacity.denormDequant(),this.scaling.denormDequant(),this.quaternion.denormDequant(),3)}},xOc=r(E()),yOc=r(J()),zOc={xyz:3,color:3,opacity:1,scaling:3,quaternion:4,harmonics:3},AOc=class{constructor(BOc){this._buffer=BOc}get buffer(){return this._buffer}get decoded(){return this._decoded||(this._decoded=this.decodeBuffer()),this._decoded}get colorsA(){let COc=this.decoded.color.denormDequant(),DOc=this.decoded.opacity.denormDequant(),EOc=(0,xOc.default)(new Float32Array(4*COc.shape[0]),[COc.shape[0],4]);return yOc.mulseq(COc,.28209479177387814),yOc.addseq(COc,.5),yOc.mulseq(COc,255),yOc.maxseq(COc,0),yOc.minseq(COc,255),yOc.negeq(DOc),yOc.expeq(DOc),yOc.addseq(DOc,1),yOc.recipeq(DOc),yOc.mulseq(DOc,255),yOc.assign(EOc.hi(COc.shape[0],3).lo(0,0),COc),yOc.assign(EOc.hi(COc.shape[0],4).lo(0,3),DOc),(0,xOc.default)(new Uint8Array(EOc.data),[COc.shape[0],4]).data}get nsplats(){return this.decoded.nsplats}getSplatCount(){return this.decoded.nsplats}get precomputedCovarianceBufferData(){return this._precomputedCovarianceBufferData}decodeBuffer(){let{splatCount:FOc,chunkCount:GOc,chunkSize:HOc,typeChunks:IOc,vertexData:JOc,propertiesDesc:KOc}=this.decodeHeader(),LOc={xyz:KOc.xyz.compressionMethod,color:KOc.color.compressionMethod,opacity:KOc.opacity.compressionMethod,scaling:KOc.scaling.compressionMethod,quaternion:KOc.quaternion.compressionMethod,chunkSize:HOc};KOc.harmonics_0&&(LOc.harmonics=KOc.harmonics_0.compressionMethod);let MOc=JOc.byteOffset,NOc=Array(Object.keys(KOc).length);for(let OOc in KOc)NOc[KOc[OOc].index]={name:OOc,method:KOc[OOc].compressionMethod};let POc=8*GOc,QOc=MOc,ROc="dynamic"===IOc?2*GOc:0,SOc,TOc=!1;if(ROc>0){let UOc=new Uint16Array(JOc.buffer.slice(QOc,QOc+ROc));QOc+=ROc,SOc=Array.from(UOc),TOc=!0}let VOc={};for(let WOc of NOc){let XOc=0,YOc=!0;if("norm8x"===WOc.method)XOc=1*FOc*zOc[WOc.name];else if("norm11"===WOc.method)XOc=4*FOc;else if("norm565"===WOc.method)XOc=2*FOc;else throw YOc=!1,new Error(`Not Implemented format: ${WOc.method}`);let ZOc;if(YOc){let $Oc=JOc.buffer.slice(QOc,QOc+POc);ZOc=(0,xOc.default)(new Float32Array($Oc),[GOc,2]),QOc+=POc}else throw new Error("loading chunk byt hasnot minmax!");let _Oc=JOc.buffer.slice(QOc,QOc+XOc);QOc+=XOc;let aPc;if("norm8x"===WOc.method)aPc=(0,xOc.default)(new Uint8Array(_Oc),[FOc,zOc[WOc.name]]);else if("norm11"===WOc.method)aPc=(0,xOc.default)(new Uint32Array(_Oc));else if("norm565"===WOc.method)aPc=(0,xOc.default)(new Uint16Array(_Oc));else throw new Error(`Not Implemented format: ${WOc.method}`);VOc[WOc.name]=new vJc(aPc,ZOc,HOc,WOc.method,SOc,TOc)}let bPc=[];for(let cPc=0;cPc<15;cPc++){let dPc=VOc[`harmonics_${cPc}`];dPc&&(bPc.push(dPc),delete VOc[`harmonics_${cPc}`])}return bPc.length>0&&(VOc.harmonics=bPc),new HNc(LOc,VOc.xyz,VOc.scaling,VOc.color,VOc.opacity,VOc.quaternion,VOc.harmonics,SOc)}buildPreComputedBuffers(){let ePc=this.decoded,fPc=ePc.nsplats,gPc=new ArrayBuffer(24*fPc),hPc=new Float32Array(gPc),iPc=ePc.scaling.denormDequant(),jPc=ePc.quaternion.denormDequant(),kPc=new Fj,lPc=new Rc,mPc=new Rc,nPc=new Rc,oPc=new rs;for(let pPc=0;pPc<fPc;pPc++){oPc.makeScale(Math.exp(iPc.get(pPc,0)),Math.exp(iPc.get(pPc,1)),Math.exp(iPc.get(pPc,2))),mPc.setFromMatrix4(oPc),kPc.set(jPc.get(pPc,0),jPc.get(pPc,1),jPc.get(pPc,2),jPc.get(pPc,3)),oPc.makeRotationFromQuaternion(kPc),lPc.setFromMatrix4(oPc),nPc.copy(lPc).multiply(mPc);let qPc=nPc.elements;hPc[6*pPc]=qPc[0]*qPc[0]+qPc[3]*qPc[3]+qPc[6]*qPc[6],hPc[6*pPc+1]=qPc[0]*qPc[1]+qPc[3]*qPc[4]+qPc[6]*qPc[7],hPc[6*pPc+2]=qPc[0]*qPc[2]+qPc[3]*qPc[5]+qPc[6]*qPc[8],hPc[6*pPc+3]=qPc[1]*qPc[1]+qPc[4]*qPc[4]+qPc[7]*qPc[7],hPc[6*pPc+4]=qPc[1]*qPc[2]+qPc[4]*qPc[5]+qPc[7]*qPc[8],hPc[6*pPc+5]=qPc[2]*qPc[2]+qPc[5]*qPc[5]+qPc[8]*qPc[8]}this._precomputedCovarianceBufferData=gPc}decodeHeader(){let rPc=this._buffer,sPc=new TextDecoder,tPc=0,uPc="",vPc=100;for(;;){if(tPc+vPc>=rPc.byteLength)throw new Error("End of file reached while searching for end of header");let wPc=new Uint8Array(rPc,tPc,vPc);uPc+=sPc.decode(wPc);let xPc=(tPc+=vPc)-2*vPc,yPc=new Uint8Array(rPc,Math.max(0,xPc),xPc>=0?2*vPc:vPc);if(sPc.decode(yPc).includes("end_header"))break}let zPc=uPc.split(`
`),APc=0,BPc=0,CPc=0,DPc=0,EPc="",FPc={};for(let GPc=0;GPc<zPc.length;GPc++){let HPc=zPc[GPc].trim();if(HPc.startsWith("element vertex")){let IPc=HPc.match(/\d+/);IPc&&(APc=parseInt(IPc[0]))}else if(HPc.startsWith("property")){let JPc=HPc.match(/(\w+)\s+(\w+)\s+(\w+)/);if(JPc){let KPc=JPc[2],LPc=JPc[3];FPc[KPc]={compressionMethod:LPc,index:DPc},DPc++}}else if(HPc.startsWith("element chunks")){let MPc=HPc.match(/\d+/);MPc&&(BPc=parseInt(MPc[0]))}else if(HPc.startsWith("element chunkSize")){let NPc=HPc.match(/\d+/);NPc&&(CPc=parseInt(NPc[0]))}else if(HPc.startsWith("element typeChunks")){let OPc=HPc.match(/(\w+)\s+(\w+)\s+(\w+)/);OPc&&(EPc=OPc[3])}else if("end_header"===HPc)break}let PPc=uPc.indexOf("end_header")+10+1;return{splatCount:APc,chunkCount:BPc,chunkSize:CPc,typeChunks:EPc,vertexData:new DataView(rPc,PPc),propertiesDesc:FPc}}pruneSplats(QPc){let RPc=this.decodeBuffer().pruneSplats(QPc);return AOc.fromCompressedGaussianSplats(RPc)}static fromCompressedGaussianSplats(SPc){let TPc=SPc.xyz.length,UPc=SPc.xyz.nchunks,VPc=`gspline
element vertex ${TPc}
element chunks ${UPc}
element chunkSize ${SPc.chunkSize}
element typeChunks ${SPc.isDynamicChunks?"dynamic":"static"}
property xyz ${SPc.xyz.method}
property color ${SPc.color.method}
property opacity ${SPc.opacity.method}
property scaling ${SPc.scaling.method}
property quaternion ${SPc.quaternion.method}`;if(SPc.harmonics&&SPc.harmonics.length>0)for(let WPc=0;WPc<SPc.harmonics.length;WPc++)VPc=`${VPc}
property harmonics_${WPc} ${SPc.harmonics[WPc].method}`;VPc=`${VPc}
end_header
`;let XPc=new TextEncoder().encode(VPc),YPc=8*UPc,ZPc=SPc.xyz.quantized.data.buffer.byteLength,$Pc=SPc.xyz instanceof vJc?YPc:0,_Pc=SPc.color.quantized.data.buffer.byteLength,aQc=SPc.color instanceof vJc?YPc:0,bQc=SPc.opacity.quantized.data.buffer.byteLength,cQc=SPc.opacity instanceof vJc?YPc:0,dQc=SPc.scaling.quantized.data.buffer.byteLength,eQc=SPc.scaling instanceof vJc?YPc:0,fQc=SPc.quaternion.quantized.data.buffer.byteLength,gQc=SPc.quaternion instanceof vJc?YPc:0,hQc=SPc.variableChunkSize?Uint16Array.from(SPc.variableChunkSize):void 0,iQc=hQc?hQc.byteLength:0,jQc=XPc.byteLength+iQc+ZPc+$Pc+_Pc+aQc+bQc+cQc+dQc+eQc+fQc+gQc,kQc=0,lQc=0;if(SPc.harmonics&&SPc.harmonics.length>0)for(let mQc=0;mQc<SPc.harmonics.length;mQc++)kQc+=SPc.harmonics[mQc].quantized.data.buffer.byteLength,lQc+=SPc.harmonics[mQc]instanceof vJc?YPc:0;jQc+=(kQc=0)+(lQc=0);let nQc=new Uint8Array(jQc),oQc=0;if(nQc.set(XPc,oQc),oQc+=XPc.byteLength,iQc>0&&(nQc.set(new Uint8Array(hQc.buffer),oQc),oQc+=iQc),SPc.xyz instanceof vJc&&(nQc.set(new Uint8Array(SPc.xyz.minmaxMatrix.data.buffer),oQc),oQc+=YPc),nQc.set(new Uint8Array(SPc.xyz.quantized.data.buffer),oQc),oQc+=ZPc,SPc.color instanceof vJc&&(nQc.set(new Uint8Array(SPc.color.minmaxMatrix.data.buffer),oQc),oQc+=YPc),nQc.set(new Uint8Array(SPc.color.quantized.data.buffer),oQc),oQc+=_Pc,SPc.opacity instanceof vJc&&(nQc.set(new Uint8Array(SPc.opacity.minmaxMatrix.data.buffer),oQc),oQc+=YPc),nQc.set(new Uint8Array(SPc.opacity.quantized.data.buffer),oQc),oQc+=bQc,SPc.scaling instanceof vJc&&(nQc.set(new Uint8Array(SPc.scaling.minmaxMatrix.data.buffer),oQc),oQc+=YPc),nQc.set(new Uint8Array(SPc.scaling.quantized.data.buffer),oQc),oQc+=dQc,SPc.quaternion instanceof vJc&&(nQc.set(new Uint8Array(SPc.quaternion.minmaxMatrix.data.buffer),oQc),oQc+=YPc),nQc.set(new Uint8Array(SPc.quaternion.quantized.data.buffer),oQc),oQc+=fQc,kQc>0&&SPc.harmonics&&SPc.harmonics.length>0)for(let pQc=0;pQc<SPc.harmonics.length;pQc++){let qQc=SPc.harmonics[pQc];qQc instanceof vJc&&(nQc.set(new Uint8Array(qQc.minmaxMatrix.data.buffer),oQc),oQc+=YPc),nQc.set(new Uint8Array(qQc.quantized.data.buffer),oQc),oQc+=qQc.quantized.data.byteLength}return new AOc(nQc.buffer)}},rQc=class{};function sQc(a){let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;function r(a,b,g){let h=new Float32Array(k,f,3*c);d=0;let i=new Uint32Array(k,e,c);for(let j=0;j<g.length-1;j++){let l=b[j],m=a[j].elements,o=l.filter(a=>a.enabled&&"Include"===a.mode).map(a=>"Box"===a.type?u(a):x(a)),p=l.filter(a=>a.enabled&&"Exclude"===a.mode).map(a=>"Box"===a.type?u(a):x(a));for(let q=g[j];q<g[j+1];q++){let r=n[3*q],t=n[3*q+1],v=n[3*q+2];if((0===o.length||s(r,t,v,o))&&(0===p.length||!s(r,t,v,p))){let w=1/(m[3]*r+m[7]*t+m[11]*v+m[15]);h[3*d]=(m[0]*r+m[4]*t+m[8]*v+m[12])*w,h[3*d+1]=(m[1]*r+m[5]*t+m[9]*v+m[13])*w,h[3*d+2]=(m[2]*r+m[6]*t+m[10]*v+m[14])*w,i[d]=q,d++}}}}function s(a,b,c,d,e){return d["Intersect"===e?"every":"some"](d=>{let e=t(a,b,c,d.invRotationMatrix,d.cropCenter);return Array.isArray(d)?w(e.x,e.y,e.z,d):y(e.x,e.y,e.z,d)})}function t(a,b,c,d,e){let f=a-e[0],g=b-e[1],h=c-e[2],i=1/(d[3]*f+d[7]*g+d[11]*h+d[15]);return{x:(d[0]*f+d[4]*g+d[8]*h+d[12])*i+e[0],y:(d[1]*f+d[5]*g+d[9]*h+d[13])*i+e[1],z:(d[2]*f+d[6]*g+d[10]*h+d[14])*i+e[2]}}function u(a){let b=a.cropSize[0]/2,c=a.cropSize[1]/2,d=a.cropSize[2]/2,e=[a.cropCenter[0]-b,a.cropCenter[1]-c,a.cropCenter[2]-d,a.cropCenter[0]+b,a.cropCenter[1]+c,a.cropCenter[2]+d],f=v(a.cropRotation);return Object.assign(e,{invRotationMatrix:f,cropCenter:a.cropCenter})}function v(a){let b=[],c=a[0]*Math.PI/180,d=a[1]*Math.PI/180,e=a[2]*Math.PI/180,f=Math.cos(c),g=Math.sin(c),h=Math.cos(d),i=Math.sin(d),j=Math.cos(e),k=Math.sin(e),l=f*j,m=f*k,n=g*j,o=g*k;return b[0]=h*j,b[1]=-h*k,b[2]=i,b[4]=m+n*i,b[5]=l-o*i,b[6]=-g*h,b[8]=o-l*i,b[9]=n+m*i,b[10]=f*h,b[12]=0,b[13]=0,b[14]=0,b[3]=0,b[7]=0,b[11]=0,b[15]=1,b}function w(a,b,c,d){return a>=d[0]&&a<=d[3]&&b>=d[1]&&b<=d[4]&&c>=d[2]&&c<=d[5]}function x(a){let b=2/a.cropSize[0],c=2/a.cropSize[1],d=2/a.cropSize[2],e=v(a.cropRotation);return{invRadiusX:b,invRadiusY:c,invRadiusZ:d,cropCenter:a.cropCenter,invRotationMatrix:e}}function y(a,b,c,d){let e=(a-d.cropCenter[0])*d.invRadiusX,f=(b-d.cropCenter[1])*d.invRadiusY,g=(c-d.cropCenter[2])*d.invRadiusZ;return e*e+f*f+g*g<=1}a.onmessage=t=>{if(t.data.getCroppedIndexes){let v=new Uint32Array(function(a,b){let c=[],d=b.filter(a=>a.enabled&&"Include"===a.mode).map(a=>"Box"===a.type?u(a):x(a)),e=b.filter(a=>a.enabled&&"Exclude"===a.mode).map(a=>"Box"===a.type?u(a):x(a)),f=a.length;for(let g=0;g<f;g+=3){let h=a[g],i=a[g+1],j=a[g+2];(0===d.length||s(h,i,j,d))&&(0===e.length||!s(h,i,j,e))||c.push(g/3)}return console.log(c),c}(new Float32Array(t.data.positions),t.data.crops)).buffer;a.postMessage({outOfBoundsIndexes:v},[v])}else if(t.data.positions)l=t.data.positions,n=new Float32Array(l),p=t.data.meshMatrixWorlds,q=t.data.cropsArray,o=t.data.meshIndexIntervals,r(p,q,o),a.postMessage({sortSetupComplete:!0});else if(t.data.sort||t.data.newMatrixWorlds||t.data.newCropsArray)(t.data.newMatrixWorlds||t.data.newCropsArray)&&(q=t.data.newCropsArray||q,p=t.data.newMatrixWorlds||p,r(p,q,o)),(function(l){let n=new Float64Array(k,g,16);for(let o=0;o<16;o++)n[o]=l[o];let p;if(d>1){b.exports.sortIndexes(e,f,j,g,h,i,m.DepthMapRange,d);let q=new Uint32Array(d);p=q.buffer,q.set(new Uint32Array(k,i,d))}else if(1===d){let r=new Uint32Array(d);r[0]=new Uint32Array(k,e,c)[0],p=r.buffer}else p=new ArrayBuffer(0);a.postMessage({sortDone:!0,indexesBuffer:p},[p])})(t.data.sort.view,t.data.sort.cameraPosition);else if(t.data.init){m=t.data.init.Constants,c=t.data.init.splatCount;let w=m.BytesPerInt,y=3*m.BytesPerFloat,z=new Uint8Array(t.data.init.sorterWasmBytes),A=c*(w+y),B=c*m.BytesPerInt*2+m.DepthMapRange*m.BytesPerInt*2,C=32*m.MemoryPageSize,D=A+B+C,E=Math.floor(D/m.MemoryPageSize)+1,F={module:{},env:{memory:new WebAssembly.Memory({initial:2*E,maximum:3*E,shared:!0})}};WebAssembly.compile(z).then(a=>WebAssembly.instantiate(a,F)).then(d=>{b=d,e=0,i=(h=(j=(g=(f=c*w)+c*y)+16*m.BytesPerFloat*2)+c*m.BytesPerInt)+m.DepthMapRange*m.BytesPerInt,k=F.env.memory.buffer,a.postMessage({sortSetupPhase1Complete:!0})})}}}s(rQc,"DepthMapRange",65536),s(rQc,"MemoryPageSize",65536),s(rQc,"BytesPerFloat",4),s(rQc,"BytesPerInt",4);let tQc,uQc;var vQc=(tQc=new Float32Array(1),uQc=new Int32Array(tQc.buffer),function(a){return tQc[0]=a,uQc[0]}),wQc=new Eb,xQc=class extends GH{constructor(yQc,zQc,AQc,BQc,CQc=!1,DQc=1,EQc,FQc){super(AQc,BQc),this.splatCount=zQc,this.meshIndexIntervals=EQc,this.meshMatrixWorlds=FQc,this.splatBuffers=yQc,this.geometry=AQc,this.material=BQc,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=CQc,this.devicePixelRatio=DQc,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(GQc,HQc,IQc=!1,JQc=1,KQc,LQc){let MQc=xQc.buildGeomtery(HQc),NQc=xQc.buildMaterial(KQc);return new xQc(GQc,HQc,MQc,NQc,IQc,JQc,KQc,LQc)}static buildMaterial(OQc){let PQc=`
            precision highp float;
            #include <common>

            attribute uint splatIndex;

            uniform highp sampler2D covariancesTexture;
            uniform highp usampler2D centersColorsTexture;
            uniform vec2 focal;
            uniform vec2 viewport;
            uniform vec2 basisViewport;
            uniform vec2 covariancesTextureSize;
            uniform vec2 centersColorsTextureSize;
						uniform highp sampler2D meshMatrixWorldsTexture;
						uniform uint meshIndexIntervals[257];
						uniform float orthoZoom;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;

            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);
            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));
            const uvec4 shift4 = uvec4(0, 8, 16, 24);
            vec4 uintToRGBAVec (uint u) {
               uvec4 urgba = mask4 & u;
               urgba = urgba >> shift4;
               vec4 rgba = vec4(urgba) * encodeNorm4;
               return rgba;
            }

            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {
                vec2 samplerUV = vec2(0.0, 0.0);
                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;
                samplerUV.y = float(floor(d)) / dimensions.y;
                samplerUV.x = fract(d);
                return samplerUV;
            }

            void main () {
                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));
                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));
                vColor = uintToRGBAVec(sampledCenterColor.r);

                vPosition = position.xy * 2.0;

								uint meshIndex;
								for (int i = 1; i < 257; i++) {
									if (splatIndex < meshIndexIntervals[i]) {
										meshIndex = uint(i - 1);
										break;
									}
								}

								float strideMulmeshIndex = float(4u*meshIndex);
								float meshMatrixWorldsTextureLength = float(256*4);

								mat4 modelMat = mat4(
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))
								);
								mat4 modelViewMat = viewMatrix * modelMat;
								vec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); 
                vec4 clipCenter = projectionMatrix * viewCenter;

                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;
                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;
                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;

                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);
                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);

                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix
                mat3 Vrk = mat3(
                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,
                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,
                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z
                );
                float s = 1.0 / (viewCenter.z * viewCenter.z);

                mat3 W = transpose(mat3(modelViewMat));
                mat3 T = orthoZoom > 0.0 ? W : W * mat3(
									focal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,
									0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,
									0., 0., 0.
								);
                mat3 cov2Dm = transpose(T) * Vrk * T;
                cov2Dm[0][0] += 0.3;
                cov2Dm[1][1] += 0.3;

                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because
                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],
                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't
                // need cov2Dm[1][0] because it is a symetric matrix.
                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);

                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;

                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix
                // so that we can determine the 2D basis for the splat. This is done using the method described
                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html
                //
                // This is a different approach than in the original work at INRIA. In that work they compute the
                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle
                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance
                // matrix (called 'conic') to determine fragment opacity.
                float a = cov2Dv.x;
                float d = cov2Dv.z;
                float b = cov2Dv.y;
                float D = a * d - b * b;
                float trace = a + d;
                float traceOver2 = 0.5 * trace;
                float term2 = sqrt(trace * trace / 4.0 - D);
                float eigenValue1 = traceOver2 + term2;
								float eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value

                const float maxSplatSize = 1024.0;
                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));
                // since the eigen vectors are orthogonal, we derive the second one from the first
                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);
                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);
                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);

                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;

								if (orthoZoom > 0.0) {
									ndcOffset *= orthoZoom;
								}

                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            }`,QQc=`
            precision highp float;
            #include <common>

            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;
						layout(location = 1) out vec4 gVelocity; 

            void main () {
                // compute the negative squared distance from the center of the splat to the
                // current fragment in the splat's local space.
                float A = -dot(vPosition, vPosition);
                if (A < -4.0) discard;
                vec3 color = vColor.rgb;
                A = exp(A) * vColor.a;
                gl_FragColor = vec4(color.rgb, A);
								gVelocity = vec4(0.0); // so it is ignored by TAA
            }`,RQc={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:OQc},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new Eb},viewport:{type:"v2",value:new Eb},basisViewport:{type:"v2",value:new Eb},debugColor:{type:"v3",value:new df},covariancesTextureSize:{type:"v2",value:new Eb(1024,1024)},centersColorsTextureSize:{type:"v2",value:new Eb(1024,1024)},orthoZoom:{type:"f",value:-1}};return new pJ({uniforms:RQc,vertexShader:PQc,fragmentShader:QQc,transparent:!0,alphaTest:1,blending:T,depthTest:!0,depthWrite:!1,side:R})}static buildGeomtery(SQc){let TQc=new nE;TQc.setIndex([0,1,2,0,2,3]);let UQc=new Float32Array(12),VQc=new RC(UQc,3);TQc.setAttribute("position",VQc),VQc.setXYZ(0,-1,-1,0),VQc.setXYZ(1,-1,1,0),VQc.setXYZ(2,1,1,0),VQc.setXYZ(3,1,-1,0),VQc.needsUpdate=!0;let WQc=new Zfa().copy(TQc),XQc=new Uint32Array(SQc),YQc=new aY(XQc,1,!1);return YQc.setUsage(35048),WQc.setAttribute("splatIndex",YQc),WQc.instanceCount=SQc,WQc}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(a=>a.buildPreComputedBuffers()),this.covariances=new Float32Array(6*this.splatCount),this.colors=new Uint8Array(4*this.splatCount),this.centers=new Float32Array(3*this.splatCount);let ZQc=0,$Qc=0,_Qc=0;for(let aRc of this.splatBuffers){let bRc=aRc.nsplats;this.colors.subarray(ZQc,ZQc+4*bRc).set(aRc.colorsA),ZQc+=4*bRc,this.centers.subarray($Qc,$Qc+3*bRc).set(aRc.decoded.xyz.denormDequant().data),$Qc+=3*bRc,this.covariances.subarray(_Qc,_Qc+6*bRc).set(new Float32Array(aRc.precomputedCovarianceBufferData)),_Qc+=6*bRc}}allocateAndStoreLocalSplatDataInTextures(){let cRc=this.splatCount,dRc=new Eb(4096,1024);for(;dRc.x*dRc.y*2<6*cRc;)dRc.y*=2;let eRc=new Eb(4096,1024);for(;eRc.x*eRc.y*4<4*cRc;)eRc.y*=2;let fRc,gRc;if(this.halfPrecisionCovariancesOnGPU){gRc=new Uint16Array(dRc.x*dRc.y*2);for(let hRc=0;hRc<this.covariances.length;hRc++)gRc[hRc]=Ara.toHalfFloat(this.covariances[hRc]);fRc=new YW(gRc,dRc.x,dRc.y,Ga,Ba)}else(gRc=new Float32Array(dRc.x*dRc.y*2)).set(this.covariances),fRc=new YW(gRc,dRc.x,dRc.y,Ga,Aa);fRc.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=fRc,this.material.uniforms.covariancesTextureSize.value.copy(dRc);let iRc=new Uint32Array(eRc.x*eRc.y*4);for(let jRc=0;jRc<cRc;jRc++){var kRc,lRc,mRc,nRc;let oRc=4*jRc,pRc=3*jRc,qRc=4*jRc;kRc=this.colors[oRc],lRc=this.colors[oRc+1],mRc=this.colors[oRc+2],nRc=this.colors[oRc+3],iRc[qRc]=kRc+(lRc<<8)+(mRc<<16)+(nRc<<24),iRc[qRc+1]=vQc(this.centers[pRc]),iRc[qRc+2]=vQc(this.centers[pRc+1]),iRc[qRc+3]=vQc(this.centers[pRc+2])}let rRc=new YW(iRc,eRc.x,eRc.y,1033,za);rRc.internalFormat="RGBA32UI",rRc.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=rRc,this.material.uniforms.centersColorsTextureSize.value.copy(eRc);let sRc=new Float32Array(4096);for(let tRc=0;tRc<this.meshMatrixWorlds.length;tRc++)sRc.set(this.meshMatrixWorlds[tRc].elements,16*tRc);let uRc=new YW(sRc,1024,1,Da,Aa);uRc.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=uRc,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:gRc,texture:fRc,size:dRc},centerColors:{data:iRc,texture:rRc,size:eRc},meshMatrixWorlds:{data:sRc,texture:uRc}}}updateIndexes(vRc){let wRc=this.geometry;wRc.attributes.splatIndex.set(vRc),wRc.attributes.splatIndex.needsUpdate=!0,wRc.instanceCount=vRc.length}updateUniforms(xRc,yRc,zRc,ARc){this.splatCount>0&&(wQc.set(xRc.x*this.devicePixelRatio,xRc.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(wQc),this.material.uniforms.basisViewport.value.set(2/wQc.x,2/wQc.y),this.material.uniforms.focal.value.set(yRc,zRc),this.material.uniforms.orthoZoom.value=ARc,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose())}},BRc=class{constructor(CRc={}){let DRc;s(this,"updateSplatMeshUniforms",(DRc=new Eb,function(){null!==this.splatMesh&&this.splatMesh.getSplatCount()>0&&(this.renderer.getSize(DRc),this.cameraFocalLengthX=this.camera.projectionMatrix.elements[0]*this.devicePixelRatio*DRc.x*.45,this.cameraFocalLengthY=this.camera.projectionMatrix.elements[5]*this.devicePixelRatio*DRc.y*.45,this.splatMesh.updateUniforms(DRc,this.cameraFocalLengthX,this.cameraFocalLengthY,this.camera.isPerspectiveCamera?-1:this.camera.zoom*this.devicePixelRatio))}));let ERc,FRc,GRc,HRc,IRc,JRc;s(this,"updateView",(ERc=new rs,FRc=[],GRc=new fm(0,0,-1),HRc=new fm(0,0,-1),IRc=new fm,JRc=new fm,function(a=!1){let b=this.updateMatrixWorldsInWorkerIfNeeded(),c=this.cropsChanged();if(!a){HRc.set(0,0,-1).applyQuaternion(this.camera.quaternion);let d=!1,e=!1;if(.95>=HRc.dot(GRc)&&(d=!0),JRc.copy(this.camera.position).sub(IRc).length()>=1&&(e=!0),!d&&!e&&!b&&!c)return}IRc.copy(this.camera.position),GRc.copy(HRc),ERc.copy(this.camera.matrixWorld).invert(),ERc.premultiply(this.camera.perspCamera.projectionMatrix),FRc[0]=this.camera.position.x,FRc[1]=this.camera.position.y,FRc[2]=this.camera.position.z;let f={sort:{view:ERc.elements,cameraPosition:FRc,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...b?{newMatrixWorlds:this.meshMatrixWorlds}:{},...c?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=f:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(f))})),this.scene=CRc.scene,this.currentPage=null,this.renderer=CRc.renderer,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.splatRenderingInitialized=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null}get camera(){return this.scene.activeCamera}reloadSplats(){this.splatRenderingInitialized=!1;let KRc=this.loadSplat();this.renderer.pipeline.opaquePass.splatViewer=KRc?this:null}loadSplat(LRc={}){this.activePage=this.scene.activePage,LRc.position&&(LRc.position=new fm().fromArray(LRc.position)),LRc.orientation&&(LRc.orientation=new Fj().fromArray(LRc.orientation)),LRc.halfPrecisionCovariances=!!LRc.halfPrecisionCovariances;let MRc=[];if(this.splatEntries=MRc,this.activePage.traverseEntity(a=>{if("Splat"===a.data.type){let b=a.visible;a.traverseAncestors(a=>{b&&(b=a.visible)}),b&&MRc.push(a)}}),this.splatMesh&&this.splatMesh.dispose(),0===MRc.length)return this.splatMesh=null,!1;this.meshMatrixWorlds=MRc.map(a=>a.matrixWorld),this.meshMatrixWorldsOld=MRc.map(a=>a.matrixWorld.clone()),this.cropsArray=MRc.map(a=>a.data.crops.map(a=>a.data));let NRc=MRc.map(a=>new AOc(new Uint8Array(a.data.buffer).buffer)),ORc=0,PRc=[0];for(let QRc of NRc)ORc+=QRc.getSplatCount(),PRc.push(ORc);return this.setupSplatMesh(NRc,ORc,LRc.position,LRc.orientation,LRc.halfPrecisionCovariances,this.devicePixelRatio,PRc,this.meshMatrixWorlds),this.setupSortWorker(ORc),!0}updateMatrixWorldsInWorkerIfNeeded(){let RRc=this.splatDataTextures.meshMatrixWorlds.data;for(let SRc=0;SRc<this.meshMatrixWorlds.length;SRc++)RRc.set(this.meshMatrixWorlds[SRc].elements,16*SRc);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,!this.meshMatrixWorlds.every((a,b)=>a.equals(this.meshMatrixWorldsOld[b]))&&(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(a=>a.clone()),!0)}cropsChanged(){let TRc=!1;return this.splatEntries.forEach((a,b)=>{a.data.crops.forEach((a,c)=>{void 0===this.cropsArray[b][c]?(TRc=!0,this.cropsArray[b][c]=a.data):Object.entries(a.data).forEach(([a,d])=>{Array.isArray(d)&&d.some((d,e)=>d!==this.cropsArray[b][c][a][e])?(TRc=!0,this.cropsArray[b][c][a]=d):d!==this.cropsArray[b][c]?.[a]&&(TRc=!0,this.cropsArray[b][c][a]=d)})}),a.data.crops.length!==this.cropsArray[b]?.length&&(this.cropsArray[b].length=a.data.crops.length,TRc=!0)}),TRc}setupSplatMesh(URc,VRc,WRc=new fm,XRc=new Fj,YRc=!1,ZRc=1,$Rc,_Rc){this.splatMesh=xQc.buildMesh(URc,VRc,YRc,ZRc,$Rc,_Rc),this.splatMesh.position.copy(WRc),this.splatMesh.quaternion.copy(XRc),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=10,this.updateSplatMeshUniforms(),this.splatRenderCount=VRc}setupSortWorker(aSc){this.sortWorker=(function(a){let b=new Worker(URL.createObjectURL(new Blob(["(",sQc.toString(),")(self)"],{type:"application/javascript"}))),c=atob("AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL"),d=new Uint8Array(c.length);for(let e=0;e<c.length;e++)d[e]=c.charCodeAt(e);return b.postMessage({init:{sorterWasmBytes:d.buffer,splatCount:a,Constants:{BytesPerFloat:rQc.BytesPerFloat,BytesPerInt:rQc.BytesPerInt,DepthMapRange:rQc.DepthMapRange,MemoryPageSize:rQc.MemoryPageSize}}}),b})(aSc),this.sortWorker.onmessage=a=>{a.data.sortDone?(this.sortRunning=!1,this.splatMesh?.updateIndexes(new Uint32Array(a.data.indexesBuffer)),this.lastSortTime=a.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):a.data.sortCanceled?this.sortRunning=!1:a.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):a.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.updateView(!0,!0),this.splatRenderingInitialized=!0)}}update(){!1!==this.splatRenderingInitialized&&(this.updateSplatMeshUniforms(),this.updateView())}getSplatMesh(){return this.splatMesh}},bSc=new MC;bSc.wireframe=!0;var cSc=new fm,dSc=class extends zV{constructor(eSc,fSc){super(),this.data=eSc,this.sharedAssets=fSc,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new wIc,this.invisibleObjects=new A7b("jflkdsafjasdifjaslk",{...HNa.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(eSc,fSc),this.matrixAutoUpdate=!1,this.errorPage=new aCc("fdasfa",{...QNa.defaultData,name:""},{shared:fSc,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){var gSc;let hSc;return this.needsTransmissionDirty&&(gSc=this,hSc=!1,gSc.traverseEntity(a=>{if(a instanceof i_b)if(Array.isArray(a.material))for(let b=0;b<a.material.length;b++)rIc(a,a.material[b])&&(hSc=!0);else rIc(a,a.material)&&(hSc=!0)}),this._needsTransmission=hSc,this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){var iSc;let jSc;return this.needsNormalDirty&&(iSc=this,jSc=!1,iSc.traverseEntity(a=>{if(a instanceof i_b)if(Array.isArray(a.material))for(let b=0;b<a.material.length;b++)qIc(a,a.material[b])&&(jSc=!0);else qIc(a,a.material)&&(jSc=!0)}),this._needsNormal=jSc,this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(kSc){let lSc=kSc.identity.join("-"),mSc=this.entityIdentityToEntity[lSc];mSc&&(kSc.uuid=mSc.uuid),this.entityIdentityToEntity[lSc]=kSc,this.entityByUuid[kSc.uuid]=kSc}markPenumbraSizeDirty(){for(let nSc of this.children)nSc instanceof aCc&&(nSc.penumbraSizeArrayCache=null)}findInstance(oSc){return this.entityIdentityToEntity[oSc.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(pSc){let qSc=this.find(pSc);if(void 0===qSc)return;let rSc=[],sSc=qSc;for(;sSc!==this;){let tSc=sSc;sSc=sSc.parent;let uSc=sSc.children.indexOf(tSc);rSc.splice(0,0,uSc)}return{entity:qSc,sortKey:rSc}}getAllSorted(vSc){let wSc=[];for(let xSc of vSc){let ySc=this.getWithSortKey(xSc.id);void 0!==ySc&&wSc.push(ySc)}return wSc.sort((a,b)=>Xya(a.sortKey,b.sortKey)),wSc.map(a=>a.entity)}nonExistOrDescendantOf(zSc,ASc){let BSc=this.find(zSc);if(void 0===BSc)return!0;for(;BSc;){if(BSc.uuid===ASc)return!0;BSc=BSc.parent}return!1}find(CSc){if(this.activePage&&this.activePage.personalCamera.parent){if("f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera"===CSc)return this.activePage.personalCamera;if(CSc===QIa)return this.activePage.personalCamera}if(""===CSc|| void 0===CSc)return;let DSc=this.entityByUuid[CSc];return void 0===DSc?this.getObjectByProperty("uuid",CSc):DSc}find2D(ESc){for(let FSc of this.children)if(FSc instanceof aCc&&FSc.uiScene){let GSc=FSc.uiScene.find(ESc);if(GSc)return GSc}}findScene2DfromObject2D(HSc){for(let ISc of this.children)if(ISc instanceof aCc&&ISc.uiScene&&ISc.uiScene.find(HSc))return ISc.uiScene}find2DInUIObjects(JSc){let KSc;return this.traverseEntity(a=>{void 0===KSc&&a instanceof jEc&&(KSc=a.uiCanvas.find(JSc))}),KSc}traverse2D(LSc){for(let MSc of this.children)MSc instanceof aCc&&MSc.uiScene&&MSc.uiScene.traverse(LSc)}debugEnsureEntity(NSc){let OSc=this.find(NSc);OSc?Array.isArray(OSc.identity)&& void 0===this.findInstance(OSc.identity)&&console.error("not found instance"):console.error("not found")}addPendingExpandCloner(PSc){this.toExpandCloner.add(PSc)}addPendingUpdateCloner(QSc){this.toUpdateCloner.add(QSc)}markToExpandCloner(RSc){this.toExpandCloner.add(RSc),RSc.traverseEntityAncestors(a=>{this.toExpandCloner.add(a)})}doPendingExpandCloner(){this.toExpandCloner.forEach(a=>{a.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(a=>{a.cloner?.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(SSc){this.pendingCommands.push(SSc)}applyPendingCommands(){this.pendingCommands.forEach(a=>a()),this.pendingCommands.length=0}updateByLibOp(TSc,USc){1===TSc.path.length&&"components"===TSc.path[0]&&1===TSc.type&&this.createChildrenObjects([{...TSc.data.asset,id:TSc.id}],this.invisibleObjects,USc)}updateTreeByOp(VSc,WSc){if(0===VSc.path.length&&7===VSc.type){let XSc=null===VSc.parent?this:this.find(VSc.parent);if(void 0===XSc)throw new Error("unexpected");let YSc=this.createObject(VSc.id,VSc.data,VSc.children,XSc,VSc.localIndex,WSc);YSc.updateVisible(this),YSc.resetBBoxNeedsUpdate(),q7b(YSc)&&r7b(YSc.parent)&&(YSc.invalidateUpstreamBooleanData(),YSc.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(XSc),this.markNeedsRecomputeInstancesForChildren(YSc),this.markToExpandCloner(YSc),this.markPenumbraSizeDirty(),YSc.updatePathSnapping()}else if(0===VSc.path.length&&8===VSc.type){let ZSc=this.find(VSc.id);if(void 0===ZSc)throw new Error("unexpected");this.markToExpandCloner(ZSc),ZSc.resetBBoxNeedsUpdate(),this.unregisterObject(ZSc);let $Sc=ZSc.parent;this.markNeedsRecomputeInstancesForAncessors($Sc),this.markNeedsRecomputeInstancesForChildren(ZSc),this.markPenumbraSizeDirty(),ZSc.parent.remove(ZSc),r7b(ZSc.parent)&&(ZSc.parent.invalidateUpstreamBooleanData(),ZSc.parent.invalidateDownstreamBooleanData().recomputeBoolean()),q7b(ZSc)&&(ZSc.freeBooleanPointer(),$Sc instanceof _6b&&$Sc.invalidateDownstreamBooleanData().recomputeBoolean()),ZSc instanceof gDc&&ZSc.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(ZSc),this.pathConstraints.removeDependencies(ZSc.uuid),ZSc.updatePathSnapping()}else if(0===VSc.path.length&&9===VSc.type){let _Sc=this.find(VSc.id);if(void 0===_Sc)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(_Sc);let aTc=_Sc.parent;this.markNeedsRecomputeInstancesForAncessors(aTc),_Sc.cloner?.resetOnMove(),this.markToExpandCloner(_Sc);let bTc=null===VSc.parent?this:this.find(VSc.parent);if(void 0===bTc)throw new Error("unexpected");bTc.add(_Sc),this.markNeedsRecomputeInstancesForAncessors(bTc),this.markToExpandCloner(_Sc),_Sc.invalidateClonerTransform(_Sc),_Sc.updateVisible(this),_Sc.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let cTc=VSc.localIndex;bTc.children.splice(cTc,0,bTc.children.pop()),q7b(_Sc)&&(_Sc.invalidateUpstreamBooleanData(),r7b(_Sc.parent)?_Sc.parent.invalidateDownstreamBooleanData().recomputeBoolean():aTc instanceof _6b&&aTc.invalidateDownstreamBooleanData().recomputeBoolean()),_Sc.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(dTc){for(let eTc of(this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage,this.children))eTc instanceof aCc&&(eTc.visible=eTc.uuid===dTc,eTc.visible&&(this.activePage=eTc,this.activePage.onActive(this)));this.activePage!==this.splatViewer?.activePage&&this.reloadSplats()}updateEntityByOp(fTc,gTc,hTc,iTc){if(0===gTc.type){if(("overrides"in gTc.props||"component"in gTc.props)&&this.markNeedsRecomputeInstances(),"visible"in gTc.props&&this.markPenumbraSizeDirty(),gTc.path.includes("overrides")&&"states"in gTc.props){let{rest:jTc}=gTc.props;gTc={...gTc,props:jTc},this.markNeedsRecomputeInstances()}"pathSnapping"===gTc.path[0]&& void 0!==gTc.props.pathId&&this.pathConstraints.setConstraint(fTc,gTc.props.pathId)}let kTc=this.find(fTc);if(kTc)try{(function(a,b,c,d){a.updateByOp(b,c,d,!1)})(kTc,gTc,hTc,{scene:this,shared:iTc}),kTc instanceof A_b&&kTc.updateGeometryGroupsIfNeeded()}catch(lTc){console.error(lTc)}}updateEntity2DByOp(mTc,nTc,oTc,pTc,qTc,rTc=[]){mTc.updateEntityByOp(nTc,oTc,pTc,qTc),this.traverseEntity(a=>{(a instanceof jEc||a instanceof aCc)&&(rTc.includes(a.frameId??"")||a.frameId===nTc)&&a.updateEntity2DByOp(nTc,oTc,pTc,qTc)})}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(sTc){this.activePage.switchActiveCamera(sTc)}isInvisibleObjects(tTc){return tTc===this.invisibleObjects||tTc.hasAnccestor(this.invisibleObjects)}init(uTc,vTc){let wTc=Object.entries(vTc.data.lib.components).map((a,b)=>({data:a[1].asset.data,children:a[1].asset.children,id:a[0],fi:b}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:vTc}),this.add(this.invisibleObjects),this.createChildrenObjects(wTc,this.invisibleObjects,vTc),this.createChildrenObjects(uTc.objects,this,vTc),this.updatePage(uTc.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(vTc,!0),this.traverseEntity(a=>{a instanceof U5b&&a.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(xTc){xTc.traverseEntity(a=>{("Component"===a.data.type||"Instance"===a.data.type)&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(yTc){Fsb.is(yTc)&&("Component"===yTc.data.type&&this.markNeedsRecomputeInstances(),yTc.traverseAncestors(a=>{Fsb.is(a)&&"Component"===a.data.type&&this.markNeedsRecomputeInstances()}))}relativeizeInner(zTc,ATc,BTc,CTc,DTc,ETc,FTc){if(zTc){let GTc=CTc.find(zTc);GTc&&GTc!==CTc&&DTc.forInstancesRec(a=>{a.data=RFa(a.data,b=>{let c=b.events.data(FTc.id),d=a.goUp(ETc);if(d){let e=[...Wya(d.identity),zTc].join("-"),f=this.entityIdentityToEntity[e];if(f){let g=f.uuid;aGa.zoom(c,ATc)[BTc]=g}else console.warn("cannot find instance")}}).data})}}rewriteActions(HTc,ITc,JTc,KTc,LTc,MTc){HTc.forEach(a=>{"Transition"===a.data.type?this.relativeizeInner(a.data.object,[...ITc,a.id],"object",JTc,KTc,LTc,MTc):"Animation"===a.data.type&&this.relativeizeInner(a.data.object,[...ITc,a.id],"object",JTc,KTc,LTc,MTc)})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(a=>{if(a instanceof BDc&&"string"==typeof a.identity&&"Component"===a.data.type)return a.traverseEntity((b,c)=>{b.data.events.forEach(d=>{if("GameControl"===d.data.type){let e=!1;if(b.forInstancesRec(a=>{a.data=RFa(a.data,b=>{a.isInstanceRoot||(b.events.delete(d.id),e=!0)}).data}),!1===e)for(let f of gOa.list)this.rewriteActions(d.data.gameActions[f],["gameActions",f],a,b,c,d)}else"Conditional"===d.data.type?("Distance"===d.data.condition.type?(this.relativeizeInner(d.data.condition.fromObject,["condition"],"fromObject",a,b,c,d),this.relativeizeInner(d.data.condition.toObject,["condition"],"toObject",a,b,c,d)):"State"===d.data.condition.type?this.relativeizeInner(d.data.condition.object,["condition"],"object",a,b,c,d):"Comparison"===d.data.condition.type&&("Property"===d.data.condition.lOperand.type&&this.relativeizeInner(d.data.condition.lOperand.value[0],["condition","lOperand","value"],0,a,b,c,d),"Property"===d.data.condition.rOperand.type&&this.relativeizeInner(d.data.condition.rOperand.value[0],["condition","rOperand","value"],0,a,b,c,d)),this.rewriteActions(d.data.inActions,["inActions"],a,b,c,d),this.rewriteActions(d.data.outActions,["outActions"],a,b,c,d)):"actions"in d.data&&this.rewriteActions(d.data.actions,["actions"],a,b,c,d)})}),!0})}expandInstances(NTc,OTc,PTc){let QTc=new Set;for(let RTc of(this.traverseEntity(a=>{if(a instanceof BDc&&a.isInstanceRoot)return a.expandInstanceChildren({scene:this,shared:NTc,pendingDeletes:QTc}),OTc||a.resetBBoxNeedsUpdate(),PTc&&a.traverseEntity(a=>{PTc.addClip(a)}),!0}),QTc))this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(RTc),bEc(RTc)}recomputeInstances(STc,TTc){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(a=>{a instanceof BDc&&a.isInstanceRoot&&(a.component=void 0)}),this.expandInstances(STc,!1,TTc))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(UTc){UTc.traverseEntity(a=>{let b="string"==typeof a.identity?a.identity:a.identity.join("-");this.entityIdentityToEntity[b]===a&&(delete this.entityByUuid[a.uuid],delete this.entityIdentityToEntity[b]),a.dispose()})}clearScene(){for(let VTc of this.children)Fsb.is(VTc)&&VTc.disposeRecursively();this.children.length=0}resetAfterClear(WTc,XTc){this.init(WTc,XTc)}raycast(YTc){return this.raycast1(YTc,!1)}raycast1(ZTc,$Tc){let _Tc=[],aUc=a=>{for(let b of a.children){let c=b.cloner;if(Fsb.is(b)&&!b.raycastLock&&(b.visible||c?.object.data.visible))if(!0===$Tc&&b.isInstanceRoot){let d=[];if(ZTc.intersectObject(b,!0,d),d.length){let e=d[0];e.object=b,e.point.applyMatrix4(e.object.matrixWorld);let f=b.matrixWorld.clone().invert();e.point.applyMatrix4(f),_Tc.push(e)}}else(q7b(b)||u7b(b)&&this.enableHelpers&&b.objectHelper.visible)&&(ZTc.intersectObject(b,!1,_Tc),vIc(b,ZTc,_Tc)),aUc(b)}};return aUc(this.activePage),_Tc}raycastWithClones(bUc){let cUc=[],dUc=a=>{for(let b of a.children){let c=b.cloner;Fsb.is(b)&&(b.visible||c?.object.data.visible)&&((q7b(b)||u7b(b)&&this.enableHelpers&&b.objectHelper.visible)&&(bUc.intersectObject(b,!1,cUc),vIc(b,bUc,cUc,!0)),dUc(b))}};return dUc(this),cUc}forEachEntity(eUc){for(let fUc of this.children)Fsb.is(fUc)&&eUc(fUc)}traverseConcreteEntity(gUc){for(let hUc of this.children)Fsb.is(hUc)&&hUc.isConcreteEntity&&hUc.traverseEntity(gUc)}traverseEntity(iUc){for(let jUc of this.children)Fsb.is(jUc)&&jUc.traverseEntity(iUc)}updateFont(kUc,lUc){this.traverseEntity(a=>{if(a instanceof A_b&&"Mesh"===a.data.type&&"TextGeometry"===a.data.geometry.type&&a.data.geometry.font===kUc){let b=a.geometry,c=a.data.geometry;b.updateFont(kUc,lUc).then(()=>{b.update(c);let d=a.invalidateDownstreamBooleanData();r7b(d)&&d.recomputeBoolean()})}})}traverseObject(mUc){for(let nUc of this.children)yRa.is(nUc)&&nUc.traverseObject(mUc)}traverseVisibleEntity(oUc){for(let pUc of this.children)Fsb.is(pUc)&&pUc.visible&&pUc.traverseVisibleEntity(oUc)}dispose(){this.clearScene()}createChildrenObjects(qUc,rUc,sUc){let tUc=0;for(let uUc of qUc)this.createObject(uUc.id,uUc.data,uUc.children,rUc,tUc,sUc),tUc+=1}registerObjectCreatedInLegacy(vUc){this.entityByUuid[vUc.uuid]=vUc}unregisterObject(wUc){for(let xUc of(delete this.entityByUuid[wUc.uuid],wUc.children))this.unregisterObject(xUc)}createObject(yUc,zUc,AUc,BUc,CUc,DUc){let EUc={scene:this,shared:DUc},FUc=pIc(yUc,zUc,EUc);return FUc&&(this.entityByUuid[yUc]=FUc,BUc.add(FUc),BUc.children.splice(CUc,0,BUc.children.pop()),AUc.length>0&&(FUc.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(AUc,FUc,DUc)),FUc.updateState(zUc,EUc),FUc instanceof A_b&&FUc.updateGeometryGroupsIfNeeded(),FUc.updateVisible(this),FUc.cloner&&this.toExpandCloner.add(FUc),zUc.pathSnapping?.pathId&&this.pathConstraints.setConstraint(yUc,zUc.pathSnapping.pathId)),"Empty"===zUc.type&&zUc.animations&&FUc.traverseEntity(a=>{let b=a.dataPatched;if(a instanceof A_b&&b.bones&&b.boneInverses){let c=b.bones.map(a=>this.find(a)),d=b.boneInverses.map(a=>new rs().fromArray(a)),e=new lX(c,d);a.bind(e,a.bindMatrix)}else a.matrixAutoUpdate=!0}),FUc}getCenter(GUc){let HUc=[];for(let IUc=0,JUc=GUc.length;IUc<JUc;++IUc){let{id:KUc,recursive:LUc}=GUc[IUc],MUc=this.find(KUc),NUc=LUc?MUc.recursiveBBox:MUc.singleBBox;HUc.push(...NUc.vertices)}let OUc=new Io;return OUc.setFromPoints(HUc),OUc.getCenter(cSc),cSc}copyMatrixWorld(PUc,QUc){if(null===PUc){QUc.identity();return}let RUc=this.find(PUc);RUc?QUc.copy(RUc.matrixWorld):QUc.identity()}copyParentMatrixWorld(SUc,TUc){if(null===SUc){TUc.identity();return}let UUc=this.find(SUc)?.parent;UUc?TUc.copy(UUc.matrixWorld):TUc.identity()}traverseMaterial(VUc){this.traverseEntity(a=>{if(a instanceof Bvb)if(Array.isArray(a.material))for(let b=0;b<a.material.length;b++)a.material[b]instanceof lTb&&VUc(a.material[b]);else a.material instanceof lTb&&VUc(a.material)})}updateViewPlaneSize(WUc,XUc,YUc=!1){this.traverseConcreteEntity(a=>{a instanceof U5b&&a.setViewplaneSize(WUc,XUc,YUc)})}initializeSplatViewer(ZUc){this.splatViewer=new BRc({scene:this,renderer:ZUc}),this.reloadSplats()}reloadSplats(){this.splatViewer?.reloadSplats()}},$Uc=(a,b)=>{let c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},_Uc=(a,b)=>{let c=b.x-a.x,d=b.y-a.y;return cVc(Math.atan2(d,c))},aVc=(a,b,c)=>{let d={x:0,y:0};return c=bVc(c),d.x=a.x-b*Math.cos(c),d.y=a.y-b*Math.sin(c),d},bVc=a=>a*(Math.PI/180),cVc=a=>a*(180/Math.PI),dVc=a=>isNaN(a.buttons)?0!==a.pressure:0!==a.buttons,eVc=new Map,fVc=a=>{eVc.has(a)&&clearTimeout(eVc.get(a)),eVc.set(a,setTimeout(a,100))},gVc=(a,b,c)=>{let d=b.split(/[ ,]+/g),e;for(let f=0;f<d.length;f+=1)e=d[f],a.addEventListener?a.addEventListener(e,c,!1):a.attachEvent&&a.attachEvent(e,c)},hVc=(a,b,c)=>{let d=b.split(/[ ,]+/g),e;for(let f=0;f<d.length;f+=1)e=d[f],a.removeEventListener?a.removeEventListener(e,c):a.detachEvent&&a.detachEvent(e,c)},iVc=a=>(a.preventDefault(),a.type.match(/^touch/)?a.changedTouches:a),jVc=()=>{if(typeof window>"u")return;let a=void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,b=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:a,y:b}},kVc=(a,b)=>{b.top||b.right||b.bottom||b.left?(a.style.top=b.top,a.style.right=b.right,a.style.bottom=b.bottom,a.style.left=b.left):(a.style.left=b.x+"px",a.style.top=b.y+"px")},lVc=(a,b,c)=>{let d=nVc(a);for(let e in d)if(d.hasOwnProperty(e))if("string"==typeof b)d[e]=b+" "+c;else{let f="";for(let g=0,h=b.length;g<h;g+=1)f+=b[g]+" "+c+", ";d[e]=f.slice(0,-2)}return d},mVc=(a,b)=>{let c=nVc(a);for(let d in c)c.hasOwnProperty(d)&&(c[d]=b);return c},nVc=a=>{let b={};return b[a]="",["webkit","Moz","o"].forEach(function(c){b[c+a.charAt(0).toUpperCase()+a.slice(1)]=""}),b},oVc=(a,b)=>{for(let c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},pVc=(a,b)=>{let c={};for(let d in a)a.hasOwnProperty(d)&&b.hasOwnProperty(d)?c[d]=b[d]:a.hasOwnProperty(d)&&(c[d]=a[d]);return c},qVc=(a,b)=>{if(a.length)for(let c=0,d=a.length;c<d;c+=1)b(a[c]);else b(a)},rVc=(a,b,c)=>({x:Math.min(Math.max(a.x,b.x-c),b.x+c),y:Math.min(Math.max(a.y,b.y-c),b.y+c)});"u">typeof window&&(uVc="ontouchstart"in window,vVc=!!window.PointerEvent,wVc=!!window.MSPointerEvent);var sVc,tVc,uVc,vVc,wVc,xVc,yVc={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},zVc={};function AVc(){}vVc?xVc=yVc.pointer:wVc?xVc=yVc.MSPointer:uVc?(xVc=yVc.touch,zVc=yVc.mouse):xVc=yVc.mouse,AVc.prototype.on=function(a,b){var c,d=this,e=a.split(/[ ,]+/g);d._handlers_=d._handlers_||{};for(var f=0;f<e.length;f+=1)c=e[f],d._handlers_[c]=d._handlers_[c]||[],d._handlers_[c].push(b);return d},AVc.prototype.off=function(a,b){var c=this;return c._handlers_=c._handlers_||{},void 0===a?c._handlers_={}:void 0===b?c._handlers_[a]=null:c._handlers_[a]&&c._handlers_[a].indexOf(b)>=0&&c._handlers_[a].splice(c._handlers_[a].indexOf(b),1),c},AVc.prototype.trigger=function(a,b){var c,d=this,e=a.split(/[ ,]+/g);d._handlers_=d._handlers_||{};for(var f=0;f<e.length;f+=1)c=e[f],d._handlers_[c]&&d._handlers_[c].length&&d._handlers_[c].forEach(function(a){a.call(d,{type:c,target:d},b)})},AVc.prototype.config=function(a){var b=this;b.options=b.defaults||{},a&&(b.options=pVc(b.options,a))},AVc.prototype.bindEvt=function(a,b){var c=this;return c._domHandlers_=c._domHandlers_||{},c._domHandlers_[b]=function(){"function"==typeof c["on"+b]?c["on"+b].apply(c,arguments):console.warn("[WARNING] : Missing \"on"+b+"\" handler.")},gVc(a,xVc[b],c._domHandlers_[b]),zVc[b]&&gVc(a,zVc[b],c._domHandlers_[b]),c},AVc.prototype.unbindEvt=function(a,b){var c=this;return c._domHandlers_=c._domHandlers_||{},hVc(a,xVc[b],c._domHandlers_[b]),zVc[b]&&hVc(a,zVc[b],c._domHandlers_[b]),delete c._domHandlers_[b],this};var BVc=AVc;function CVc(a,b){return this.identifier=b.identifier,this.position=b.position,this.frontPosition=b.frontPosition,this.collection=a,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(b),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=CVc.id,CVc.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}CVc.prototype=new BVc,CVc.constructor=CVc,CVc.id=0,CVc.prototype.buildEl=function(a){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},CVc.prototype.stylize=function(){if(this.options.dataOnly)return this;var a=this.options.fadeTime+"ms",b=mVc("borderRadius","50%"),c=lVc("transition","opacity",a),d={};return d.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},d.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},d.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},oVc(d.el,c),"circle"===this.options.shape&&oVc(d.back,b),oVc(d.front,b),this.applyStyles(d),this},CVc.prototype.applyStyles=function(a){for(var b in this.ui)if(this.ui.hasOwnProperty(b))for(var c in a[b])this.ui[b].style[c]=a[b][c];return this},CVc.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},CVc.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},CVc.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},CVc.prototype.show=function(a){var b=this;return b.options.dataOnly||(clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.addToDom(),b.restCallback(),setTimeout(function(){b.ui.el.style.opacity=1},0),b.showTimeout=setTimeout(function(){b.trigger("shown",b.instance),"function"==typeof a&&a.call(this)},b.options.fadeTime)),b},CVc.prototype.hide=function(a){var b=this;if(b.options.dataOnly)return b;if(b.ui.el.style.opacity=b.options.restOpacity,clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.removeTimeout=setTimeout(function(){var c="dynamic"===b.options.mode?"none":"block";b.ui.el.style.display=c,"function"==typeof a&&a.call(b),b.trigger("hidden",b.instance)},b.options.fadeTime),b.options.restJoystick){let c=b.options.restJoystick,d={};d.x=!0===c|| !1!==c.x?0:b.instance.frontPosition.x,d.y=!0===c|| !1!==c.y?0:b.instance.frontPosition.y,b.setPosition(a,d)}return b},CVc.prototype.setPosition=function(a,b){var c=this;c.frontPosition={x:b.x,y:b.y};var d=c.options.fadeTime+"ms",e={};e.front=lVc("transition",["top","left"],d);var f={front:{}};f.front={left:c.frontPosition.x+"px",top:c.frontPosition.y+"px"},c.applyStyles(e),c.applyStyles(f),c.restTimeout=setTimeout(function(){"function"==typeof a&&a.call(c),c.restCallback()},c.options.fadeTime)},CVc.prototype.restCallback=function(){var a={};a.front=lVc("transition","none",""),this.applyStyles(a),this.trigger("rested",this.instance)},CVc.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},CVc.prototype.computeDirection=function(a){var b,c,d,e=a.angle.radian,f=Math.PI/4,g=Math.PI/2;if(e>f&&e<3*f&&!a.lockX?b="up":e> -f&&e<=f&&!a.lockY?b="left":e> -(3*f)&&e<= -f&&!a.lockX?b="down":a.lockY||(b="right"),a.lockY||(c=e> -g&&e<g?"left":"right"),a.lockX||(d=e>0?"up":"down"),a.force>this.options.threshold){var h,i={};for(h in this.direction)this.direction.hasOwnProperty(h)&&(i[h]=this.direction[h]);var j={};for(h in this.direction={x:c,y:d,angle:b},a.direction=this.direction,i)i[h]===this.direction[h]&&(j[h]=!0);if(j.x&&j.y&&j.angle)return a;j.x&&j.y||this.trigger("plain",a),j.x||this.trigger("plain:"+c,a),j.y||this.trigger("plain:"+d,a),j.angle||this.trigger("dir dir:"+b,a)}else this.resetDirection();return a};var DVc=CVc;function EVc(a,b){var c=this;c.nipples=[],c.idles=[],c.actives=[],c.ids=[],c.pressureIntervals={},c.manager=a,c.id=EVc.id,EVc.id+=1,c.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},c.config(b),("static"===c.options.mode||"semi"===c.options.mode)&&(c.options.multitouch=!1),c.options.multitouch||(c.options.maxNumberOfNipples=1);let d=getComputedStyle(c.options.zone.parentElement);return d&&"flex"===d.display&&(c.parentIsFlex=!0),c.updateBox(),c.prepareNipples(),c.bindings(),c.begin(),c.nipples}EVc.prototype=new BVc,EVc.constructor=EVc,EVc.id=0,EVc.prototype.prepareNipples=function(){var a=this.nipples;a.on=this.on.bind(this),a.off=this.off.bind(this),a.options=this.options,a.destroy=this.destroy.bind(this),a.ids=this.ids,a.id=this.id,a.processOnMove=this.processOnMove.bind(this),a.processOnEnd=this.processOnEnd.bind(this),a.get=function(b){if(void 0===b)return a[0];for(var c=0,d=a.length;c<d;c+=1)if(a[c].identifier===b)return a[c];return!1}},EVc.prototype.bindings=function(){var a=this;a.bindEvt(a.options.zone,"start"),a.options.zone.style.touchAction="none",a.options.zone.style.msTouchAction="none"},EVc.prototype.begin=function(){var a=this.options;if("static"===a.mode){var b=this.createNipple(a.position,this.manager.getIdentifier());b.add(),this.idles.push(b)}},EVc.prototype.createNipple=function(a,b){var c=this.manager.scroll,d={},e=this.options,f={x:this.parentIsFlex?c.x:c.x+this.box.left,y:this.parentIsFlex?c.y:c.y+this.box.top};if(a.x&&a.y)d={x:a.x-f.x,y:a.y-f.y};else if(a.top||a.right||a.bottom||a.left){var g=document.createElement("DIV");g.style.display="hidden",g.style.top=a.top,g.style.right=a.right,g.style.bottom=a.bottom,g.style.left=a.left,g.style.position="absolute",e.zone.appendChild(g);var h=g.getBoundingClientRect();e.zone.removeChild(g),d=a,a={x:h.left+c.x,y:h.top+c.y}}var i=new DVc(this,{color:e.color,size:e.size,threshold:e.threshold,fadeTime:e.fadeTime,dataOnly:e.dataOnly,restJoystick:e.restJoystick,restOpacity:e.restOpacity,mode:e.mode,identifier:b,position:a,zone:e.zone,frontPosition:{x:0,y:0},shape:e.shape});return e.dataOnly||(kVc(i.ui.el,d),kVc(i.ui.front,i.frontPosition)),this.nipples.push(i),this.trigger("added "+i.identifier+":added",i),this.manager.trigger("added "+i.identifier+":added",i),this.bindNipple(i),i},EVc.prototype.updateBox=function(){var a=this;a.box=a.options.zone.getBoundingClientRect()},EVc.prototype.bindNipple=function(a){var b,c=this,d=function(a,d){b=a.type+" "+d.id+":"+a.type,c.trigger(b,d)};a.on("destroyed",c.onDestroyed.bind(c)),a.on("shown hidden rested dir plain",d),a.on("dir:up dir:right dir:down dir:left",d),a.on("plain:up plain:right plain:down plain:left",d)},EVc.prototype.pressureFn=function(a,b,c){var d=this,e=0;clearInterval(d.pressureIntervals[c]),d.pressureIntervals[c]=setInterval((function(){var c=a.force||a.pressure||a.webkitForce||0;c!==e&&(b.trigger("pressure",c),d.trigger("pressure "+b.identifier+":pressure",c),e=c)}).bind(d),100)},EVc.prototype.onstart=function(a){var b=this,c=b.options,d=a;return a=iVc(a),b.updateBox(),qVc(a,function(e){b.actives.length<c.maxNumberOfNipples?b.processOnStart(e):d.type.match(/^touch/)&&(Object.keys(b.manager.ids).forEach(function(c){if(0>Object.values(d.touches).findIndex(function(a){return a.identifier===c})){var e=[a[0]];e.identifier=c,b.processOnEnd(e)}}),b.actives.length<c.maxNumberOfNipples&&b.processOnStart(e))}),b.manager.bindDocument(),!1},EVc.prototype.processOnStart=function(a){var b,c=this,d=c.options,e=c.manager.getIdentifier(a),f=a.force||a.pressure||a.webkitForce||0,g={x:a.pageX,y:a.pageY},h=c.getOrCreate(e,g);h.identifier!==e&&c.manager.removeIdentifier(h.identifier),h.identifier=e;var i=function(b){b.trigger("start",b),c.trigger("start "+b.id+":start",b),b.show(),f>0&&c.pressureFn(a,b,b.identifier),c.processOnMove(a)};if((b=c.idles.indexOf(h))>=0&&c.idles.splice(b,1),c.actives.push(h),c.ids.push(h.identifier),"semi"!==d.mode)i(h);else if($Uc(g,h.position)<=d.catchDistance)i(h);else{h.destroy(),c.processOnStart(a);return}return h},EVc.prototype.getOrCreate=function(a,b){var c,d=this.options;return/(semi|static)/.test(d.mode)?(c=this.idles[0])?(this.idles.splice(0,1),c):"semi"===d.mode?this.createNipple(b,a):(console.warn("Coudln't find the needed nipple."),!1):c=this.createNipple(b,a)},EVc.prototype.processOnMove=function(a){var b=this,c=b.options,d=b.manager.getIdentifier(a),e=b.nipples.get(d),f=b.manager.scroll;if(!dVc(a)){this.processOnEnd(a);return}if(!e){console.error("Found zombie joystick with ID "+d),b.manager.removeIdentifier(d);return}if(c.dynamicPage){var g=e.el.getBoundingClientRect();e.position={x:f.x+g.left,y:f.y+g.top}}e.identifier=d;var h=e.options.size/2,i={x:a.pageX,y:a.pageY};c.lockX&&(i.y=e.position.y),c.lockY&&(i.x=e.position.x);var j,k,l=$Uc(i,e.position),m=_Uc(i,e.position),n=bVc(m),o=l/h,p={distance:l,position:i};if("circle"===e.options.shape?(j=Math.min(l,h),k=aVc(e.position,j,m)):j=$Uc(k=rVc(i,e.position,h),e.position),c.follow){if(l>h){let q=i.x-k.x,r=i.y-k.y;e.position.x+=q,e.position.y+=r,e.el.style.top=e.position.y-(b.box.top+f.y)+"px",e.el.style.left=e.position.x-(b.box.left+f.x)+"px",l=$Uc(i,e.position)}}else i=k,l=j;var s=i.x-e.position.x,t=i.y-e.position.y;e.frontPosition={x:s,y:t},c.dataOnly||kVc(e.ui.front,e.frontPosition);var u={identifier:e.identifier,position:i,force:o,pressure:a.force||a.pressure||a.webkitForce||0,distance:l,angle:{radian:n,degree:m},vector:{x:s/h,y:-t/h},raw:p,instance:e,lockX:c.lockX,lockY:c.lockY};(u=e.computeDirection(u)).angle={radian:bVc(180-m),degree:180-m},e.trigger("move",u),b.trigger("move "+e.id+":move",u)},EVc.prototype.processOnEnd=function(a){var b=this,c=b.options,d=b.manager.getIdentifier(a),e=b.nipples.get(d),f=b.manager.removeIdentifier(e.identifier);!e||(c.dataOnly||e.hide(function(){"dynamic"===c.mode&&(e.trigger("removed",e),b.trigger("removed "+e.id+":removed",e),b.manager.trigger("removed "+e.id+":removed",e),e.destroy())}),clearInterval(b.pressureIntervals[e.identifier]),e.resetDirection(),e.trigger("end",e),b.trigger("end "+e.id+":end",e),b.ids.indexOf(e.identifier)>=0&&b.ids.splice(b.ids.indexOf(e.identifier),1),b.actives.indexOf(e)>=0&&b.actives.splice(b.actives.indexOf(e),1),/(semi|static)/.test(c.mode)?b.idles.push(e):b.nipples.indexOf(e)>=0&&b.nipples.splice(b.nipples.indexOf(e),1),b.manager.unbindDocument(),/(semi|static)/.test(c.mode)&&(b.manager.ids[f.id]=f.identifier))},EVc.prototype.onDestroyed=function(a,b){this.nipples.indexOf(b)>=0&&this.nipples.splice(this.nipples.indexOf(b),1),this.actives.indexOf(b)>=0&&this.actives.splice(this.actives.indexOf(b),1),this.idles.indexOf(b)>=0&&this.idles.splice(this.idles.indexOf(b),1),this.ids.indexOf(b.identifier)>=0&&this.ids.splice(this.ids.indexOf(b.identifier),1),this.manager.removeIdentifier(b.identifier),this.manager.unbindDocument()},EVc.prototype.destroy=function(){for(var a in this.unbindEvt(this.options.zone,"start"),this.nipples.forEach(function(a){a.destroy()}),this.pressureIntervals)this.pressureIntervals.hasOwnProperty(a)&&clearInterval(this.pressureIntervals[a]);this.trigger("destroyed",this.nipples),this.manager.unbindDocument(),this.off()};var FVc=EVc;function GVc(a){var b=this;b.ids={},b.index=0,b.collections=[],b.scroll=jVc(),b.config(a),b.prepareCollections();var c=function(){var a;b.collections.forEach(function(c){c.forEach(function(c){a=c.el.getBoundingClientRect(),c.position={x:b.scroll.x+a.left,y:b.scroll.y+a.top}})})};if(typeof window>"u")return b.collections;gVc(window,"resize",function(){fVc(c)});var d=function(){b.scroll=jVc()};return gVc(window,"scroll",function(){fVc(d)}),b.collections}GVc.prototype=new BVc,GVc.constructor=GVc,GVc.prototype.prepareCollections=function(){var a=this;a.collections.create=a.create.bind(a),a.collections.on=a.on.bind(a),a.collections.off=a.off.bind(a),a.collections.destroy=a.destroy.bind(a),a.collections.get=function(b){var c;return a.collections.every(function(a){return!(c=a.get(b))}),c}},GVc.prototype.create=function(a){return this.createCollection(a)},GVc.prototype.createCollection=function(a){var b=new FVc(this,a);return this.bindCollection(b),this.collections.push(b),b},GVc.prototype.bindCollection=function(a){var b,c=this,d=function(a,d){b=a.type+" "+d.id+":"+a.type,c.trigger(b,d)};a.on("destroyed",c.onDestroyed.bind(c)),a.on("shown hidden rested dir plain",d),a.on("dir:up dir:right dir:down dir:left",d),a.on("plain:up plain:right plain:down plain:left",d)},GVc.prototype.bindDocument=function(){var a=this;a.binded||(a.bindEvt(document,"move").bindEvt(document,"end"),a.binded=!0)},GVc.prototype.unbindDocument=function(a){var b=this;Object.keys(b.ids).length&& !0!==a||(b.unbindEvt(document,"move").unbindEvt(document,"end"),b.binded=!1)},GVc.prototype.getIdentifier=function(a){var b;return a?void 0===(b=void 0===a.identifier?a.pointerId:a.identifier)&&(b=this.latest||0):b=this.index,void 0===this.ids[b]&&(this.ids[b]=this.index,this.index+=1),this.latest=b,this.ids[b]},GVc.prototype.removeIdentifier=function(a){var b={};for(var c in this.ids)if(this.ids[c]===a){b.id=c,b.identifier=this.ids[c],delete this.ids[c];break}return b},GVc.prototype.onmove=function(a){return this.onAny("move",a),!1},GVc.prototype.onend=function(a){return this.onAny("end",a),!1},GVc.prototype.oncancel=function(a){return this.onAny("end",a),!1},GVc.prototype.onAny=function(a,b){var c,d=this,e="processOn"+a.charAt(0).toUpperCase()+a.slice(1);b=iVc(b);var f=function(a,b,c){c.ids.indexOf(b)>=0&&(c[e](a),a._found_=!0)};return qVc(b,function(a){c=d.getIdentifier(a),qVc(d.collections,f.bind(null,a,c)),a._found_||d.removeIdentifier(c)}),!1},GVc.prototype.destroy=function(){var a=this;a.unbindDocument(!0),a.ids={},a.index=0,a.collections.forEach(function(a){a.destroy()}),a.off()},GVc.prototype.onDestroyed=function(a,b){if(0>this.collections.indexOf(b))return!1;this.collections.splice(this.collections.indexOf(b),1)};var HVc=new GVc,IVc={create:function(a){return HVc.create(a)},factory:HVc},JVc=new Map,KVc=new Map,LVc=class{constructor(MVc,NVc,OVc,PVc){this.data=NVc;let{audio:QVc,volume:RVc,delay:SVc,loop:TVc}=NVc;if(!QVc)throw new Error("Missing property");let UVc="string"==typeof QVc?PVc.getAudio(QVc).src:QVc.data;this.audioPlayer=new lVb({src:UVc,volume:RVc,delay:SVc,loop:TVc}),KVc.has(OVc.uuid)?KVc.get(OVc.uuid).push(this):KVc.set(OVc.uuid,[this]),JVc.set(MVc,this)}playByToggle(){"stop"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):"pause"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},VVc=class{constructor(WVc){this.data=WVc}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(XVc){let YVc=JVc.get(XVc);YVc&&(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{YVc.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):YVc.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(ZVc){let $Vc=KVc.get(ZVc);$Vc?.length&&(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{$Vc.forEach(a=>a.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):$Vc.forEach(a=>a.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let _Vc=[...KVc.values()];_Vc.length&&(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{_Vc.forEach(a=>{a.forEach(a=>{a.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):_Vc.forEach(a=>{a.forEach(a=>{a.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},aWc=class{constructor(bWc,cWc,dWc,eWc,fWc){if(this.data=cWc,this.shared=eWc,this.condition=fWc,"play"===cWc.interaction)this.interaction=new LVc(bWc,cWc,dWc,eWc);else if("pause"===cWc.interaction||"stop"===cWc.interaction)this.interaction=new VVc(cWc);else throw new Error("Missing property")}dispatchBasic(){if(!1===ZZc(this.shared,this.condition))return!1;this.interaction instanceof LVc?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(!1===ZZc(this.shared,this.condition))return!1;this.interaction instanceof LVc?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(gWc){if(!1===ZZc(this.shared,this.condition))return!1;this.interaction instanceof LVc&&("start"===gWc?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},hWc=class{constructor(iWc,jWc,kWc,lWc){this.data=iWc,this.page=jWc,this.shared=kWc,this.condition=lWc,this.delay=0,this.emission=iWc.emission,void 0!==iWc.delay&&(this.delay=iWc.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop():this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze():this.unFreeze()}start(mWc=0){if(mWc){this.delayTimerId=window.setTimeout(()=>{this.start(0),this.clearDelay()},this.delay);return}this.particleSystem.start()}stop(){this.particleSystem.stop(),this.clearDelay()}freeze(){this.particleSystem.froze(),this.clearDelay()}unFreeze(){this.particleSystem.unFroze(),this.clearDelay()}reset(){this.particleSystem.reset(),this.clearDelay()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze();break}}dispatchBasic(){if(!1===ZZc(this.shared,this.condition)||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze();break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop();break;case"reset":this.reset();break;default:break}}dispatchConditional(){if(!1===ZZc(this.shared,this.condition)||!this.particleSystem)return!1;switch(this.emission){case"start":this.particleSystem.start();break;case"stop":this.particleSystem.stop();break;case"reset":this.particleSystem.reset();break;default:break}}dispatchGameControl(nWc){if(!1===ZZc(this.shared,this.condition)||!this.particleSystem)return!1;"start"===nWc?this.particleSystem.start():this.particleSystem.stop()}dispose(){this.particleSystem&&(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},oWc=(a,b)=>b.some(b=>b instanceof RegExp?b.test(a):b===a),pWc=(a,{stripHash:b})=>{let c=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(a);if(!c)throw new Error(`Invalid URL: ${a}`);let{type:d,data:e,hash:f}=c.groups,g=d.split(";");f=b?"":f;let h=!1;"base64"===g[g.length-1]&&(g.pop(),h=!0);let i=(g.shift()||"").toLowerCase(),j=[...g.map(a=>{let[b,c=""]=a.split("=").map(a=>a.trim());return"charset"===b&&"us-ascii"===(c=c.toLowerCase())?"":`${b}${c?`=${c}`:""}`}).filter(Boolean)];return h&&j.push("base64"),(j.length>0||i&&"text/plain"!==i)&&j.unshift(i),`data:${j.join(";")},${h?e.trim():e}${f?`#${f}`:""}`},qWc=class{constructor({url:rWc,context:sWc},tWc,uWc,vWc){if(this.controlsManager=tWc,this.shared=uWc,this.condition=vWc,!rWc)throw new Error("Missing property");this.url=rWc.startsWith("mailto:")?rWc:(function(a,b){if(b={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...b},a=a.trim(),/^data:/i.test(a))return pWc(a,b);if(/^view-source:/i.test(a))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let c=a.startsWith("//");!c&&/^\.*\//.test(a)||(a=a.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,b.defaultProtocol));let d=new URL(a);if(b.forceHttp&&b.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(b.forceHttp&&"https:"===d.protocol&&(d.protocol="http:"),b.forceHttps&&"http:"===d.protocol&&(d.protocol="https:"),b.stripAuthentication&&(d.username="",d.password=""),b.stripHash?d.hash="":b.stripTextFragment&&(d.hash=d.hash.replace(/#?:~:text.*?$/i,"")),d.pathname){let e=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,f=0,g="";for(;;){let h=e.exec(d.pathname);if(!h)break;let i=h[0],j=h.index;g+=d.pathname.slice(f,j).replace(/\/{2,}/g,"/"),g+=i,f=j+i.length}g+=d.pathname.slice(f,d.pathname.length).replace(/\/{2,}/g,"/"),d.pathname=g}if(d.pathname)try{d.pathname=decodeURI(d.pathname)}catch{}if(!0===b.removeDirectoryIndex&&(b.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(b.removeDirectoryIndex)&&b.removeDirectoryIndex.length>0){let k=d.pathname.split("/");oWc(k[k.length-1],b.removeDirectoryIndex)&&(k=k.slice(0,-1),d.pathname=k.slice(1).join("/")+"/")}if(d.hostname&&(d.hostname=d.hostname.replace(/\.$/,""),b.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(d.hostname)&&(d.hostname=d.hostname.replace(/^www\./,""))),Array.isArray(b.removeQueryParameters))for(let l of[...d.searchParams.keys()])oWc(l,b.removeQueryParameters)&&d.searchParams.delete(l);if(!0===b.removeQueryParameters&&(d.search=""),b.sortQueryParameters){d.searchParams.sort();try{d.search=decodeURIComponent(d.search)}catch{}}b.removeTrailingSlash&&(d.pathname=d.pathname.replace(/\/$/,""));let m=a;return a=d.toString(),b.removeSingleSlash||"/"!==d.pathname||m.endsWith("/")||""!==d.hash||(a=a.replace(/\/$/,"")),(b.removeTrailingSlash||"/"===d.pathname)&&""===d.hash&&b.removeSingleSlash&&(a=a.replace(/\/$/,"")),c&&!b.normalizeProtocol&&(a=a.replace(/^http:\/\//,"//")),b.stripProtocol&&(a=a.replace(/^(?:https?:)?\/\//,"")),a})(rWc,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=sWc??"tab"}dispatch(){if(!1===ZZc(this.shared,this.condition))return!1;Rya?window.location.assign(this.url):("tab"===this.context?window.open(this.url,"_blank"):"window"===this.context?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),this.controlsManager.orbitControls?.onPointerUp(Zya[0]),Zya.splice(0,Zya.length))}},wWc=class{constructor(xWc,yWc,zWc,AWc,BWc){this.data=xWc,this.page=yWc,this.controlsManager=zWc,this.shared=AWc,this.condition=BWc,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=a=>{this.timeoutIdQueue.shift();let b=this.page.scene.find(a);if(void 0===b)return;let c=this.controlsManager.sharedGameControlGlobals.rapierWorld,d=!c||b.dataPatched.physics?.fusedBody;if(b.cloner){for(let e of b.cloner.children)d?(e.playModeVisible=!1,e.rigidBody&&b.dataPatched.physics?.rigidBody==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(e.rigidBody.collider(0).handle),c.removeRigidBody(e.rigidBody),e.rigidBody=void 0),e.bvhGeometry&&(e.bvhGeometry=void 0)):void 0===this.clone||this.clone===e?(e.playModeVisible=!1,e.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(e.rigidBody.collider(0).handle),c.removeRigidBody(e.rigidBody),e.rigidBody=void 0)):void 0===e.playModeVisible&&(e.playModeVisible=!0);(d|| void 0===this.clone|| !1===this.clone)&&(b.visible=!1,b.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(b.rigidBody.collider(0).handle),c.removeRigidBody(b.rigidBody),b.rigidBody=void 0),b.bvhGeometry&&(b.bvhGeometry=void 0))}else b.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(b.rigidBody.collider(0).handle),c.removeRigidBody(b.rigidBody),b.rigidBody=void 0),b.bvhGeometry&&(b.bvhGeometry=void 0),b.visible=!1;void 0===c?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(a=>void 0!==a.bvhGeometry):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(a=>void 0!==a.rigidBody),b.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...xWc.objects]}dispatch(CWc){if(!1===ZZc(this.shared,this.condition))return!1;this.clone=CWc,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay)):this.dispatchInner()}dispatchFromStart(){if(!1===ZZc(this.shared,this.condition))return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay))}dispose(){this.timeoutIdQueue.forEach(a=>window.clearTimeout(a))}},DWc=class{constructor(EWc,FWc,GWc,HWc,IWc){this.data=EWc,this.page=FWc,this.shared=GWc,this.eventManager=HWc,this.condition=IWc,this.shared=GWc}dispatch(){if(!1===ZZc(this.shared,this.condition))return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{this.shared.reset(this.shared.data,!0),gYc(this.page,this.shared,!0),this.eventManager.reset(),this.eventManager.controlsManager.gameControl?.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},JWc={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},KWc={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},LWc=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],MWc={CSS:{},springs:{}};function NWc(a,b,c){return Math.min(Math.max(a,b),c)}function OWc(a,b){return a.indexOf(b)> -1}function PWc(a,b){return a.apply(null,b)}var QWc={arr:function(a){return Array.isArray(a)},obj:function(a){return OWc(Object.prototype.toString.call(a),"Object")},pth:function(a){return QWc.obj(a)&&a.hasOwnProperty("totalLength")},svg:function(a){return a instanceof SVGElement},inp:function(a){return a instanceof HTMLInputElement},dom:function(a){return!("isNode"in a)&&(a.nodeType||QWc.svg(a))},str:function(a){return"string"==typeof a},fnc:function(a){return"function"==typeof a},und:function(a){return typeof a>"u"},hex:function(a){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(a)},rgb:function(a){return/^rgb/.test(a)},hsl:function(a){return/^hsl/.test(a)},col:function(a){return QWc.hex(a)||QWc.rgb(a)||QWc.hsl(a)},key:function(a){return!JWc.hasOwnProperty(a)&&!KWc.hasOwnProperty(a)&&"targets"!==a&&"keyframes"!==a}};function RWc(a){var b=/\(([^)]+)\)/.exec(a);return b?b[1].split(",").map(function(a){return parseFloat(a)}):[]}function SWc(a,b){var c=RWc(a),d=NWc(QWc.und(c[0])?1:c[0],.1,100),e=NWc(QWc.und(c[1])?100:c[1],.1,100),f=NWc(QWc.und(c[2])?10:c[2],.1,100),g=NWc(QWc.und(c[3])?0:c[3],.1,100),h=Math.sqrt(e/d),i=f/(2*Math.sqrt(e*d)),j=i<1?h*Math.sqrt(1-i*i):0,k=i<1?(i*h+ -g)/j:-g+h;function l(a){var c=b?b*a/1e3:a;return c=i<1?Math.exp(-c*i*h)*(1*Math.cos(j*c)+k*Math.sin(j*c)):(1+k*c)*Math.exp(-c*h),0===a||1===a?a:1-c}return b?l:function(){var b=MWc.springs[a];if(b)return b;for(var c=1/6,d=0,e=0;;)if(1===l(d+=c)){if(e++,e>=16)break}else e=0;var f=d*c*1e3;return MWc.springs[a]=f,f}}function TWc(a){return void 0===a&&(a=10),function(b){return Math.ceil(NWc(b,1e-6,1)*a)*(1/a)}}var UWc,VWc,WWc=function(){function a(a,b){return 1-3*b+3*a}function b(a,b){return 3*b-6*a}function c(a){return 3*a}function d(d,e,f){return((a(e,f)*d+b(e,f))*d+c(e))*d}function e(d,e,f){return 3*a(e,f)*d*d+2*b(e,f)*d+c(e)}return function(a,b,c,f){if(0<=a&&a<=1&&0<=c&&c<=1){var g=new Float32Array(11);if(a!==b||c!==f)for(var h=0;h<11;++h)g[h]=d(.1*h,a,c);return function(e){return a===b&&c===f||0===e||1===e?e:d(i(e),b,f)}}function i(b){for(var f=0,h=1;10!==h&&g[h]<=b;++h)f+=.1;--h;var i=f+(b-g[h])/(g[h+1]-g[h])*.1,j=e(i,a,c);return j>=.001?(function(a,b,c,f){for(var g=0;g<4;++g){var h=e(b,c,f);if(0===h)return b;b-=(d(b,c,f)-a)/h}return b})(b,i,a,c):0===j?i:(function(a,b,c,e,f){var g,h,i=0;do(g=d(h=b+(c-b)/2,e,f)-a)>0?c=h:b=h;while(Math.abs(g)>1e-7&& ++i<10);return h})(b,f,f+.1,a,c)}}}(),XWc=(UWc={linear:function(){return function(a){return a}}},VWc={Sine:function(){return function(a){return 1-Math.cos(a*Math.PI/2)}},Circ:function(){return function(a){return 1-Math.sqrt(1-a*a)}},Back:function(){return function(a){return a*a*(3*a-2)}},Bounce:function(){return function(a){for(var b,c=4;a<((b=Math.pow(2,--c))-1)/11;);return 1/Math.pow(4,3-c)-7.5625*Math.pow((3*b-2)/22-a,2)}},Elastic:function(a,b){void 0===a&&(a=1),void 0===b&&(b=.5);var c=NWc(a,1,10),d=NWc(b,.1,2);return function(a){return 0===a||1===a?a:-c*Math.pow(2,10*(a-1))*Math.sin((a-1-d/(2*Math.PI)*Math.asin(1/c))*(2*Math.PI)/d)}}},["Quad","Cubic","Quart","Quint","Expo"].forEach(function(a,b){VWc[a]=function(){return function(a){return Math.pow(a,b+2)}}}),Object.keys(VWc).forEach(function(a){var b=VWc[a];UWc["easeIn"+a]=b,UWc["easeOut"+a]=function(a,c){return function(d){return 1-b(a,c)(1-d)}},UWc["easeInOut"+a]=function(a,c){return function(d){return d<.5?b(a,c)(2*d)/2:1-b(a,c)(-2*d+2)/2}}}),UWc);function YWc(a,b){if(QWc.fnc(a))return a;var c=a.split("(")[0],d=XWc[c],e=RWc(a);switch(c){case"spring":return SWc(a,b);case"cubicBezier":return PWc(WWc,e);case"steps":return PWc(TWc,e);default:return PWc(d,e)}}function ZWc(a){try{return document.querySelectorAll(a)}catch{return}}function $Wc(a,b){for(var c=a.length,d=arguments.length>=2?arguments[1]:void 0,e=[],f=0;f<c;f++)if(f in a){var g=a[f];b.call(d,g,f,a)&&e.push(g)}return e}function _Wc(a){return a.reduce(function(a,b){return a.concat(QWc.arr(b)?_Wc(b):b)},[])}function aXc(a){return QWc.arr(a)?a:(QWc.str(a)&&(a=ZWc(a)||a),a instanceof NodeList||a instanceof HTMLCollection?[].slice.call(a):[a])}function bXc(a,b){return a.some(function(a){return a===b})}function cXc(a){var b={};for(var c in a)b[c]=a[c];return b}function dXc(a,b){var c=cXc(a);for(var d in a)c[d]=b.hasOwnProperty(d)?b[d]:a[d];return c}function eXc(a,b){var c=cXc(a);for(var d in b)c[d]=QWc.und(a[d])?b[d]:a[d];return c}function fXc(a){var b=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(a);if(b)return b[1]}function gXc(a,b){return QWc.fnc(a)?a(b.target,b.id,b.total):a}function hXc(a,b){return a.getAttribute(b)}function iXc(a,b,c){if(bXc([c,"deg","rad","turn"],fXc(b)))return b;var d=MWc.CSS[b+c];if(!QWc.und(d))return d;var e=100,f=document.createElement(a.tagName),g=a.parentNode&&a.parentNode!==document?a.parentNode:document.body;g.appendChild(f),f.style.position="absolute",f.style.width=e+c;var h=e/f.offsetWidth;g.removeChild(f);var i=h*parseFloat(b);return MWc.CSS[b+c]=i,i}function jXc(a,b,c){if(b in a.style){var d=b.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),e=a.style[b]||getComputedStyle(a).getPropertyValue(d)||"0";return c?iXc(a,e,c):e}}function kXc(a,b){return QWc.dom(a)&&!QWc.inp(a)&&(hXc(a,b)||QWc.svg(a)&&a[b])?"attribute":QWc.dom(a)&&bXc(LWc,b)?"transform":QWc.dom(a)&&"transform"!==b&&jXc(a,b)?"css":null!=a[b]?"object":void 0}function lXc(a){if(QWc.dom(a)){for(var b,c=a.style.transform||"",d=/(\w+)\(([^)]*)\)/g,e=new Map;b=d.exec(c);)e.set(b[1],b[2]);return e}}function mXc(a,b,c,d){switch(kXc(a,b)){case"transform":var e,f,g,h,i,j,k;return e=a,f=b,g=d,h=c,j=OWc(f,"scale")?1:0+(OWc(i=f,"translate")||"perspective"===i?"px":OWc(i,"rotate")||OWc(i,"skew")?"deg":void 0),k=lXc(e).get(f)||j,g&&(g.transforms.list.set(f,k),g.transforms.last=f),h?iXc(e,k,h):k;case"css":return jXc(a,b,c);case"attribute":return hXc(a,b);default:return a[b]||0}}function nXc(a,b){var c=/^(\*=|\+=|-=)/.exec(a);if(!c)return a;var d=fXc(a)||0,e=parseFloat(b),f=parseFloat(a.replace(c[0],""));switch(c[0][0]){case"+":return e+f+d;case"-":return e-f+d;case"*":return e*f+d}}function oXc(a,b){if(QWc.col(a)){var c,d,e,f,g,h,i,j;return c=a,QWc.rgb(c)?(d=c,(e=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(d))?"rgba("+e[1]+",1)":d):QWc.hex(c)?(f=c.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,b,c,d){return b+b+c+c+d+d}),h=parseInt((g=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(f))[1],16),i=parseInt(g[2],16),j=parseInt(g[3],16),"rgba("+h+","+i+","+j+",1)"):QWc.hsl(c)?(function(a){var b,c,d,e=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(a)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(a),f=parseInt(e[1],10)/360,g=parseInt(e[2],10)/100,h=parseInt(e[3],10)/100,i=e[4]||1;function j(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+(b-a)*6*c:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a}if(0==g)b=c=d=h;else{var k=h<.5?h*(1+g):h+g-h*g,l=2*h-k;b=j(l,k,f+1/3),c=j(l,k,f),d=j(l,k,f-1/3)}return"rgba("+255*b+","+255*c+","+255*d+","+i+")"})(c):void 0}if(/\s/g.test(a))return a;var k=fXc(a),l=k?a.substr(0,a.length-k.length):a;return b?l+b:l}function pXc(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))}function qXc(a){for(var b,c=a.points,d=0,e=0;e<c.numberOfItems;e++){var f=c.getItem(e);e>0&&(d+=pXc(b,f)),b=f}return d}function rXc(a){var b,c,d,e;if(a.getTotalLength)return a.getTotalLength();switch(a.tagName.toLowerCase()){case"circle":return 2*Math.PI*hXc(a,"r");case"rect":return 2*hXc(b=a,"width")+2*hXc(b,"height");case"line":return pXc({x:hXc(c=a,"x1"),y:hXc(c,"y1")},{x:hXc(c,"x2"),y:hXc(c,"y2")});case"polyline":return qXc(a);case"polygon":return e=(d=a).points,qXc(d)+pXc(e.getItem(e.numberOfItems-1),e.getItem(0))}}function sXc(a,b){var c=b||{},d=c.el||function(a){for(var b=a.parentNode;QWc.svg(b)&&QWc.svg(b.parentNode);)b=b.parentNode;return b}(a),e=d.getBoundingClientRect(),f=hXc(d,"viewBox"),g=e.width,h=e.height,i=c.viewBox||(f?f.split(" "):[0,0,g,h]);return{el:d,viewBox:i,x:i[0]/1,y:i[1]/1,w:g/i[2],h:h/i[3]}}function tXc(a,b){function c(c){return void 0===c&&(c=0),a.el.getPointAtLength(b+c>=1?b+c:0)}var d=sXc(a.el,a.svg),e=c(),f=c(-1),g=c(1);switch(a.property){case"x":return(e.x-d.x)*d.w;case"y":return(e.y-d.y)*d.h;case"angle":return 180*Math.atan2(g.y-f.y,g.x-f.x)/Math.PI}}function uXc(a,b){var c=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,d=oXc(QWc.pth(a)?a.totalLength:a,b)+"";return{original:d,numbers:d.match(c)?d.match(c).map(Number):[0],strings:QWc.str(a)||b?d.split(c):[]}}function vXc(a){return $Wc(a?_Wc(QWc.arr(a)?a.map(aXc):aXc(a)):[],function(a,b,c){return c.indexOf(a)===b})}function wXc(a){var b=vXc(a);return b.map(function(a,c){return{target:a,id:c,total:b.length,transforms:{list:lXc(a)}}})}function xXc(a,b){var c=cXc(b);if(/^spring/.test(c.easing)&&(c.duration=SWc(c.easing)),QWc.arr(a)){var d=a.length;2!==d||QWc.obj(a[0])?QWc.fnc(b.duration)||(c.duration=b.duration/d):a={value:a}}var e=QWc.arr(a)?a:[a];return e.map(function(a,c){var d=QWc.obj(a)&&!QWc.pth(a)?a:{value:a};return QWc.und(d.delay)&&(d.delay=c?0:b.delay),QWc.und(d.endDelay)&&(d.endDelay=c===e.length-1?b.endDelay:0),d}).map(function(a){return eXc(a,c)})}var yXc={css:function(a,b,c){return a.style[b]=c},attribute:function(a,b,c){return a.setAttribute(b,c)},object:function(a,b,c){return a[b]=c},transform:function(a,b,c,d,e){if(d.list.set(b,c),b===d.last||e){var f="";d.list.forEach(function(a,b){f+=b+"("+a+") "}),a.style.transform=f}}};function zXc(a,b){wXc(a).forEach(function(a){for(var c in b){var d=gXc(b[c],a),e=a.target,f=fXc(d),g=mXc(e,c,f,a),h=nXc(oXc(d,f||fXc(g)),g);yXc[kXc(e,c)](e,c,h,a.transforms,!0)}})}function AXc(a,b){var c=a.length,d=function(a){return a.timelineOffset?a.timelineOffset:0},e={};return e.duration=c?Math.max.apply(Math,a.map(function(a){let b=a.startOnceDelay??0,c=a.pingPongDelayCorrection??0,e=a.pingPongEndDelayCorrection??0;return d(a)+b+c+e+a.duration*(a.loop??1)})):b.duration,e.delay=c?Math.min.apply(Math,a.map(function(a){let b=a.startOnceDelay??0,c=a.pingPongDelayCorrection??0;return d(a)+b+c+a.delay})):b.delay,e.endDelay=c?e.duration-Math.max.apply(Math,a.map(function(a){let b=a.startOnceDelay??0,c=a.pingPongDelayCorrection??0,e=a.pingPongEndDelayCorrection??0;return d(a)+b+c+a.duration*(a.loop??1)-a.endDelay-e})):b.endDelay,e}var BXc,CXc=0,DXc=[],EXc=[],FXc=function(){function a(){BXc=requestAnimationFrame(b)}function b(b){var c=DXc.length;if(c){for(var d=0;d<c;){var e=DXc[d];e.paused?(DXc.splice(d,1),c-=1):(e.tick(b),d++)}a()}else BXc=cancelAnimationFrame(BXc)}return a}();function GXc(a){void 0===a&&(a={});var b,c,d=0,e=0,f=0,g=0,h=null;function i(a){var b=window.Promise&&new Promise(function(a){return h=a});return a.finished=b,b}var j,k,l,m,n,o,p,q,r,s,t=(m=dXc(JWc,j=a),n=dXc(KWc,j),o=function(a,b){var c=[],d=b.keyframes;for(var e in d&&(b=eXc(function(a){for(var b=$Wc(_Wc(a.map(function(a){return Object.keys(a)})),function(a){return QWc.key(a)}).reduce(function(a,b){return 0>a.indexOf(b)&&a.push(b),a},[]),c={},d=0;d<b.length;d++)!function(d){var e=b[d];c[e]=a.map(function(a){var b={};for(var c in a)QWc.key(c)?c==e&&(b.value=a[c]):b[c]=a[c];return b})}(d);return c}(d),b)),b)QWc.key(e)&&c.push({name:e,tweens:xXc(b[e],a)});return c}(n,j),p=wXc(j.targets),k=p,l=o,q=$Wc(_Wc(k.map(function(a){return l.map(function(b){return(function(a,b){var c=kXc(a.target,b.name);if(c){var d,e,f,g=(d=b,e=a,d.tweens.map(function(a){var b=function(a,b){var c={};for(var d in a){var e=gXc(a[d],b);QWc.arr(e)&&1===(e=e.map(function(a){return gXc(a,b)})).length&&(e=e[0]),c[d]=e}return c.duration=parseFloat(c.duration),c.delay=parseFloat(c.delay),c}(a,e),c=b.value,g=QWc.arr(c)?c[1]:c,h=fXc(g),i=mXc(e.target,d.name,h,e),j=f?f.to.original:i,k=QWc.arr(c)?c[0]:j,l=fXc(k)||fXc(i),m=h||l;return QWc.und(g)&&(g=j),b.from=uXc(k,m),b.to=uXc(nXc(g,k),m),b.start=f?f.end:0,b.end=b.start+b.delay+b.duration+b.endDelay,b.easing=YWc(b.easing,b.duration),b.isPath=QWc.pth(c),b.isColor=QWc.col(b.from.original),b.isColor&&(b.round=1),f=b,b})),h=g[g.length-1];return{type:c,property:b.name,animatable:a,tweens:g,duration:h.end,delay:g[0].delay,endDelay:h.endDelay}}})(a,b)})})),function(a){return!QWc.und(a)}),r=AXc(q,n),s=CXc,CXc++,eXc(m,{id:s,children:[],animatables:p,animations:q,duration:r.duration,delay:r.delay,endDelay:r.endDelay,startOnceDelay:n.startOnceDelay,pingPongDelayCorrection:n.pingPongDelayCorrection,pingPongEndDelayCorrection:n.pingPongEndDelayCorrection})),u=i(t);function v(){var a=t.direction;"alternate"!==a&&(t.direction="normal"!==a?"normal":"reverse"),t.reversed=!t.reversed,c.forEach(function(a){(1===a.loop||a.loop%2==0)&&(a.reversed=t.reversed)})}function w(a){return t.reversed?t.duration-a:a}function x(a,b,c=!1){b&&(t.reversed?b.seek(b.duration*b.loop-(a-b.timelineOffset-b.pingPongDelayCorrection),c):b.seek(a-b.timelineOffset-b.startOnceDelay-b.pingPongDelayCorrection,c))}function y(a){var b=0,c=t.animations,d=c.length;for("alternate"!==t.direction&&t.parent?.direction==="alternate"?t.parent?.rewind=== !1&& !0===t.reversePlayback&& !1===t.rewind&&(a=t.parent?.reversed&&"alternate"===t.direction?t.duration-t.delay+t.endDelay-a:t.duration+t.delay-t.endDelay-a):B(!1,t.parent?.rewind,t.rewind,t.parent?.reversePlayback,t.reversePlayback)&&(a=t.parent?.reversed&&"alternate"===t.direction?t.duration-t.delay+t.endDelay-a:t.duration+t.delay-t.endDelay-a);b<d;){var e=c[b],f=e.animatable,g=e.tweens,h=g.length-1,i=g[h];h&&(i=$Wc(g,function(b){return a<b.end})[0]||i);let j;j=t.parent?.reversed&&"alternate"===t.direction?NWc(a-i.start-i.endDelay,0,i.duration)/i.duration:NWc(a-i.start-i.delay,0,i.duration)/i.duration;for(var k=isNaN(j)?1:i.easing(j),l=i.to.strings,m=i.round,n=[],o=i.to.numbers.length,p=void 0,q=0;q<o;q++){var r=void 0;let s,u;"alternate"!==t.direction?t.parent?.rewind=== !1&& !0===t.reversePlayback&& !1===t.rewind?(s=i.to.numbers[q],u=i.from.numbers[q]||0):(u=i.to.numbers[q],s=i.from.numbers[q]||0):B(!0,t.parent?.rewind,t.rewind,t.parent?.reversePlayback,t.reversePlayback)?(s=i.to.numbers[q],u=i.from.numbers[q]||0):(u=i.to.numbers[q],s=i.from.numbers[q]||0),r=i.isPath?tXc(i.value,k*u):s+k*(u-s),m&&(i.isColor&&q>2||(r=Math.round(r*m)/m)),n.push(r)}var v=l.length;if(v){p=l[0];for(var w=0;w<v;w++){l[w];var x=l[w+1],y=n[w];isNaN(y)||(x?p+=y+x:p+=y+" ")}}else p=n[0];yXc[e.type](f.target,e.property,p,f.transforms),e.currentValue=p,b++}}function z(a){t[a]&&!t.passThrough&&t[a](t)}let A={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function B(a,b,c,d,e){return A[a<<4|b<<3|c<<2|d<<1|e]}function C(a,b=!1){var e=t.duration;let f=t.delay,j=e-t.endDelay;t.parent?.reversed&&"alternate"===t.direction&&(f=t.endDelay,j=e-t.delay);var k=w(a);if(t.progress=NWc(k/e*100,0,100),b||(t.reversePlayback=k<t.currentTime),g&&(function(a,b=!1){if(t.reversed)for(var d=g;d--;)x(a,c[d],b);else for(var e=0;e<g;e++)x(a,c[e],b)})(k,b),!t.began&&t.currentTime>=0&&(t.began=!0,z("begin")),!t.loopBegan&&t.currentTime>0&&(t.loopBegan=!0,z("loopBegin")),(t.reversed||k>=0)&&k<=f&&0!==t.currentTime&&(y(0),z("change")),(k>=j&&t.currentTime!==e+t.pingPongDelayCorrection||!e)&&(y(e),z("change")),k>f&&k<j?(t.changeBegan||(t.changeBegan=!0,t.changeCompleted=!1,z("changeBegin")),y(k),z("change")):t.changeBegan?(t.changeCompleted=!0,t.changeBegan=!1,z("change"),g&&z("timelineChangeComplete")):t.began&&k>j&&z("changeComplete"),t.currentTime=NWc(k,0,e+t.pingPongDelayCorrection),t.began&&z("update"),a>=e)if(t.remaining&& !0!==t.remaining&&t.remaining--,t.remaining){for(let l of(g?d+=t.duration/GXc.speed:d+=t.duration,c))l.setStartTime(0),l.remaining=l.loop;z("loopComplete"),t.loopBegan=!1,"alternate"===t.direction?v():g&&(t.direction="normal",t.reversed=!1,c.forEach(function(a){return a.reversed=!1}))}else t.paused=!0,t.completed||(t.completed=!0,z("loopComplete"),z("complete"),!t.passThrough&&"Promise"in window&&(h(),u=i(t)))}return t.reset=function(){var a=t.direction;t.passThrough=!1,t.currentTime=0,t.progress=0,t.paused=!0,t.began=!1,t.loopBegan=!1,t.changeBegan=!1,t.completed=!1,t.changeCompleted=!1,t.reversePlayback=!1,t.reversed="reverse"===a,t.remaining=t.loop,g=(c=t.children).length;for(var b=g;b--;)t.children[b].reset();y(t.reversed?t.duration:0)},t.setStartTime=function(a){d=a},t.set=function(a,b){return zXc(a,b),t},t.tick=function(a){f=a,d||(d=f),C((f+(e-d))*GXc.speed)},t.seek=function(a,b=!1){C(a-d,b)},t.pause=function(a){t.paused=!0,g&&(b=a??performance.now())},t.play=function(a){!t.paused||(t.completed&&t.reset(),t.paused=!1,DXc.push(t),g&& void 0!==b&&(d+=(a??performance.now())-b),BXc||FXc())},t.reverse=function(){v(),t.completed=!t.reversed,d=0,e=w(t.currentTime)*(1/GXc.speed)},t.restart=function(){t.reset(),t.play()},t.reset(),t.autoplay&&t.play(),t}function HXc(a,b){for(var c=b.length;c--;)bXc(a,b[c].animatable.target)&&b.splice(c,1)}"u">typeof document&&document.addEventListener("visibilitychange",function(a){document.hidden?(DXc.forEach(function(b){return b.pause(a.timeStamp)}),EXc=DXc.slice(0),GXc.running=DXc=[]):EXc.forEach(function(b){return b.play(a.timeStamp)})}),GXc.version="3.2.0",GXc.speed=1,GXc.running=DXc,GXc.remove=function(a){for(var b=vXc(a),c=DXc.length;c--;){var d=DXc[c],e=d.animations,f=d.children;HXc(b,e);for(var g=f.length;g--;){var h=f[g],i=h.animations;HXc(b,i),i.length||h.children.length||f.splice(g,1)}e.length||f.length||d.pause()}},GXc.get=mXc,GXc.set=zXc,GXc.convertPx=iXc,GXc.path=function(a,b){var c=QWc.str(a)?ZWc(a)[0]:a,d=b||100;return function(a){return{property:a,el:c,svg:sXc(c),totalLength:rXc(c)*(d/100)}}},GXc.setDashoffset=function(a){var b=rXc(a);return a.setAttribute("stroke-dasharray",b),b},GXc.stagger=function(a,b){void 0===b&&(b={});var c=b.direction||"normal",d=b.easing?YWc(b.easing):null,e=b.grid,f=b.axis,g=b.from||0,h="first"===g,i="center"===g,j="last"===g,k=QWc.arr(a),l=parseFloat(k?a[0]:a),m=k?parseFloat(a[1]):0,n=fXc(k?a[1]:a)||0,o=b.start||0+(k?l:0),p=[],q=0;return function(a,b,r){if(h&&(g=0),i&&(g=(r-1)/2),j&&(g=r-1),!p.length){for(var s=0;s<r;s++){if(e){var t=i?(e[0]-1)/2:g%e[0],u=i?(e[1]-1)/2:Math.floor(g/e[0]),v=s%e[0],w=Math.floor(s/e[0]),x=t-v,y=u-w,z=Math.sqrt(x*x+y*y);"x"===f&&(z=-x),"y"===f&&(z=-y),p.push(z)}else p.push(Math.abs(g-s));q=Math.max.apply(Math,p)}d&&(p=p.map(function(a){return d(a/q)*q})),"reverse"===c&&(p=p.map(function(a){return f?a<0?-1*a:-a:Math.abs(q-a)}))}return o+(k?(m-l)/q:l)*(Math.round(100*p[b])/100)+n}},GXc.timeline=function(a){void 0===a&&(a={});var b=GXc(a);return b.duration=0,b.add=function(c,d){var e=DXc.indexOf(b),f=b.children;function g(a){a.passThrough=!0}e> -1&&DXc.splice(e,1);for(var h=0;h<f.length;h++)g(f[h]);var i=eXc(c,dXc(KWc,a));i.targets=i.targets||a.targets;var j=b.duration;i.autoplay=!1,i.timelineOffset=QWc.und(d)?j:nXc(d,j),g(b);var k=GXc(i);g(k),f.push(k),k.parent=b;var l=AXc(f,a);return b.delay=l.delay,b.endDelay=l.endDelay,b.duration=l.duration,!0===k.loop&&(b.duration=1/0),b.seek(0),b.reset(),b.autoplay&&b.play(),b},b},GXc.easing=YWc,GXc.penner=XWc,GXc.random=function(a,b){return Math.floor(Math.random()*(b-a+1))+a};var IXc=GXc,JXc=new fm,KXc=new fm,LXc=new Fj;function MXc(a,b,c,d,e,f){let g=c[a]?c[a]:void 0,h=d[a];if(null==h)return;let i=null!=g?"string"==typeof g?Number(e.getVariable(g)??0):g:b[a],j="string"==typeof h?Number(e.getVariable(h)??0):h;if(i!==j)return{update:c=>{let d=Db.lerp(i,j,c);f?b[a]=Math.trunc(d):b[a]=d},start:()=>{b[a]=i},end:()=>{b[a]=j}}}function NXc(a,b,c,d,e,f){let g=c[a]?c[a]:void 0,h=d[a];if(!h)return;let i=b[a],j=[...g??i].map(a=>"string"==typeof a?Number(e.getVariable(a)??0):a),k=[...h].map(a=>"string"==typeof a?Number(e.getVariable(a)??0):a);if(!(j.length!==k.length||uya(j,k)))return{update:c=>{j.forEach((d,e)=>{let g=Db.lerp(d,k[e],c);b[a][e]=f?Math.trunc(g):g})},start:()=>{Object.assign(b[a],j)},end:()=>{Object.assign(b[a],k)}}}function OXc(a,b,c){return b.forEach((b,d)=>{a.setComponent(d,"string"==typeof b?Number(c.getVariable(b)??0):b)}),a}function PXc(a,b,c,d,e){let f=c[a]?c[a]:void 0,g=d[a];if(!g)return;let h=b[a],i=f?OXc(new fm,f,e):h.clone(),j=OXc(new fm,g,e);if(!i.equals(j))return{update:a=>{h.lerpVectors(i,j,a)},start:()=>{h.copy(i)},end:()=>{h.copy(j)}}}function QXc(a,b,c){return b.forEach((b,d)=>{a.setComponent(d,"string"==typeof b?Number(c.getVariable(b)??0):b)}),a}function RXc(a,b,c,d,e){let f=c[a]?c[a]:void 0,g=d[a];if(!g)return;let h=b[a],i=!(h instanceof Eb),j=h instanceof Eb?h:new Eb().fromArray(h),k=f?QXc(new Eb,f,e):j.clone(),l=QXc(new Eb,g,e);if(!k.equals(l))return{update:c=>{j.lerpVectors(k,l,c),i&&(b[a]=j.toArray())},start:()=>{j.copy(k),i&&(b[a]=j.toArray())},end:()=>{j.copy(l),i&&(b[a]=j.toArray())}}}function SXc(a,b,c,d,e){let f=c[a]?c[a]:void 0,g=d[a];if(!g)return;let h=b[a],i=new Vxb(h.r,h.g,h.b,h.a),j=f?"string"==typeof f?e.getColor(f).clone():new Vxb(f.r,f.g,f.b,f.a):i.clone(),k="string"==typeof g?e.getColor(g).clone():new Vxb(g.r,g.g,g.b,g.a);if(!j.equals(k))return{update:c=>{i.lerpColors(j,k,c);let d=Db.lerp(j.a,k.a,c);i.a=d,b[a]={r:i.r,g:i.g,b:i.b,a:i.a}},start:()=>{i.copy(j)},end:()=>{i.copy(k)}}}function TXc(a,b,c,d,e){return"number"==typeof b[a]?MXc(a,b,c??{},d,e):Array.isArray(b[a])?NXc(a,b,c??{},d,e):void 0}function UXc(a,b,c,d){let e=[],f=kTb(c,d)|| !!b.layers&&kTb(b,d);for(let g of(e.push(bYc(a,f)),a.layers)){let h=b.layers?.data(g.uuid),i=c.layers.data(g.uuid);if(!i||"light"!==g.type&&(!(g.visible?? !0)||!(i.visible?? !0)))continue;let j=g.getNames().filter(a=>!WJa.some(b=>a.includes(b)));for(let k of j)try{let l=g.getValue(k),m;if("colors"===k)m=_Xc(g,h,i,k);else if(Array.isArray(l))"steps"===k&&(m=$Xc(g,h,i,k));else if("number"==typeof l)m=VXc(g,h,i,k,d);else{if("boolean"==typeof l)continue;l instanceof Eb?m=WXc(g,h,i,k):l instanceof fm?m=XXc(g,h,i,k,d):l instanceof Vxb?m=ZXc(g,h,i,k,d):l instanceof df?m=YXc(g,h,i,k,d):"isTexture"in l&&(m=aYc(g,h,i,k))}m&&(Array.isArray(m)?e.push(...m):e.push(m))}catch(n){console.error(`lerpMaterial: unexpected material layer for ${k}`,n)}}return e}function VXc(a,b,c,d,e){if(!a.hasValue(d)||!(d in c))return;let f=b?b[d]:a.getValue(d),g=c[d],h="string"==typeof f?Number(e.getVariable(f)??0):f,i="string"==typeof g?Number(e.getVariable(g)??0):g;if(h!==i)return{update:b=>{a.setValue(d,Db.lerp(h,i,b))},start:()=>{a.setValue(d,h)},end:()=>{a.setValue(d,i)}}}function WXc(a,b,c,d){if(!a.hasValue(d)||!(d in c))return;let e=a.getValue(d),f=b?new Eb().fromArray(b[d]):e.clone(),g=new Eb().fromArray(c[d]);if(!f.equals(g))return{update:a=>{e.lerpVectors(f,g,a)},start:()=>{e.copy(f)},end:()=>{e.copy(g)}}}function XXc(a,b,c,d,e){if(!a.hasValue(d)||!(d in c))return;let f=a.getValue(d),g=b?b[d]:void 0,h=c[d],i=g?OXc(new fm,g,e):f.clone(),j=OXc(new fm,h,e);if(!i.equals(j))return{update:a=>{f.lerpVectors(i,j,a)},start:()=>{f.copy(i)},end:()=>{f.copy(j)}}}function YXc(a,b,c,d,e){if(!a.hasValue(d)||!(d in c))return;let f=b?b[d]:void 0,g=c[d],h=a.getValue(d),i=f?"string"==typeof f?e.getColor(f).clone():new df().setRGB(f.r,f.g,f.b):h.clone(),j="string"==typeof g?e.getColor(g).clone():new df().setRGB(g.r,g.g,g.b);if(i.equals(j))return;let k=h.clone();return{update:b=>{a.getValue(d)!==k&&a.setValue(d,k),k.lerpColors(i,j,b)},start:()=>{k.copy(i)},end:()=>{k.copy(j)}}}function ZXc(a,b,c,d,e){if(!a.hasValue(d)||!(d in c))return;let f=b?b[d]:void 0,g=c[d],h=a.getValue(d),i=f?"string"==typeof f?e.getColor(f).clone():new df().setRGB(f.r,f.g,f.b):h.clone(),j="string"==typeof g?e.getColor(g).clone():new Vxb(g.r,g.g,g.b,g.a);if(i.equals(j))return;let k=h.clone();return{update:b=>{a.getValue(d)!==k&&a.setValue(d,k),k.lerpColors(i,j,b)},start:()=>{k.copy(i)},end:()=>{k.copy(j)}}}function $Xc(a,b,c,d="steps"){if(!a.hasValue(d)||!(d in c))return;let e=[],f=a.getValue(d),g=b?b[d]:f,h=c[d];for(let i=0;i<f.length;++i){let j=g[i],k=h[i];j!==k&&e.push({update:a=>{f[i]=Db.lerp(j,k,a)},start:()=>{f[i]=j},end:()=>{f[i]=k}})}return e.length?e:void 0}function _Xc(a,b,c,d="colors"){if(!a.hasValue(d)||!(d in c))return;let e=[],f=a.getValue(d),g=b?b[d]:f.map(a=>a.toArray()),h=c[d];for(let i=0;i<f.length;++i){let j=[...g[i]],k=[...h[i]];xJa.isEqual(j,k)||e.push({update:a=>{f[i].fromArray(xJa.lerp(j,k,a))},start:()=>{f[i].fromArray(j)},end:()=>{f[i].fromArray(k)}})}return e.length?e:void 0}function aYc(a,b,c,d="texture"){if(!a.hasValue(d)||!(d in c))return;let e=a.getNode("mat");if(!e)return;let f=b?b[d]:e,g=c[d],h=[...f.repeat],i=[...f.offset],j=[...g.repeat],k=[...g.offset];if(!vJa.isEqual(h,j)||!vJa.isEqual(i,k))return{update:a=>{e.repeat=vJa.lerp(h,j,a),e.offset=vJa.lerp(i,k,a),e.updateMatrix()},start:()=>{e.repeat=[...h],e.offset=[...i],e.updateMatrix()},end:()=>{e.repeat=[...j],e.offset=[...k],e.updateMatrix()}}}function bYc(a,b){return{update:()=>{a.transparent=b}}}var cYc=new fm,dYc=new Ex;function eYc(a,b,c,d,e){let f=[];return a.data.visible&&f.push(...function(a,b,c,d,e){let f=[],g,h,i,j,k,l,m,n;if(a instanceof Hrc?((g=RXc("position",a,b,c,e))&&f.push(g),(i=MXc("rotation",a,b,c,e))&&f.push(i),(j=RXc("shear",a,b,c,e))&&f.push(j)):((l=MXc("slide",n={slide:((b.pathSnapping?.slide??a.updatedPathSnapping?.slide)??a.dataPatched.pathSnapping?.slide)??0,offset:((b.pathSnapping?.offset??a.updatedPathSnapping?.offset)??a.dataPatched.pathSnapping?.offset)??0},(b.pathSnapping??a.updatedPathSnapping)??a.dataPatched.pathSnapping,c.pathSnapping??a.dataPatched.pathSnapping,e))&&f.push(l),(m=MXc("offset",n,(b.pathSnapping??a.updatedPathSnapping)??a.dataPatched.pathSnapping,c.pathSnapping??a.dataPatched.pathSnapping,e))&&f.push(m),!l&&!m&&((g=PXc("position",a,b,c,e))&&f.push(g),(h=PXc("scale",a,b,c,e))&&f.push(h),(i=(function(a,b,c,d,e){let f=b?.rotation?b.rotation.map(a=>("string"==typeof a?Number(e.getVariable(a)??0):a)*Db.DEG2RAD):void 0,g=c.rotation?.map(a=>("string"==typeof a?Number(e.getVariable(a)??0):a)*Db.DEG2RAD);if(!g)return;let h=f?new fm().fromArray(f):new fm().setFromEuler(a.rotation),i=new fm().fromArray(g);if(h.equals(i))return;let j=cYc.subVectors(i,h);if(!(d&&j.toArray().every(a=>Math.abs(a)<2*Math.PI)))return{update:b=>{cYc.lerpVectors(h,i,b),a.rotation.setFromVector3(cYc)},start:()=>{a.rotation.setFromVector3(h)},end:()=>{a.rotation.setFromVector3(i)}};{let k=new Fj().setFromEuler(dYc.setFromVector3(h)),l=new Fj().setFromEuler(dYc.setFromVector3(i));return{update:b=>{!function(a,b,c,d){if(0===d)return c.copy(a);if(1===d)return c.copy(b);let e=a.w*b.w+a.x*b.x+a.y*b.y+a.z*b.z;if(e>=1)return c.copy(a);let f=1-e*e;if(f<=Number.EPSILON){let g=1-d;return c.w=g*a.w+d*b.w,c.x=g*a.x+d*b.x,c.y=g*a.y+d*b.y,c.z=g*a.z+d*b.z,c.normalize(),c}let h=Math.sqrt(f),i=Math.atan2(h,e),j=Math.sin((1-d)*i)/h,k=Math.sin(d*i)/h;return c.w=a.w*j+b.w*k,c.x=a.x*j+b.x*k,c.y=a.y*j+b.y*k,c.z=a.z*j+b.z*k,c}(k,l,a.quaternion,b)},start:()=>{a.rotation.setFromVector3(h)},end:()=>{a.rotation.setFromVector3(i)}}}})(a,b,c,d,e))&&f.push(i),(k=(function(a,b,c,d){let e=c[a]?c[a]:void 0,f=d[a];if(!f)return;let g=b[a],h=e?new rs().fromArray(e):g.clone(),i=new fm,j=new Fj,k=new fm;h.decompose(i,j,k);let l=new rs().fromArray(f),m=new fm,n=new Fj,o=new fm;if(l.decompose(m,n,o),!h.equals(l))return{update:a=>{LXc.slerpQuaternions(j,n,a),JXc.lerpVectors(i,m,a),KXc.lerpVectors(k,o,a),g.compose(JXc,LXc,KXc)},start:()=>{g.compose(i,j,k)},end:()=>{g.compose(m,n,o)}}})("hiddenMatrix",a,b,c))&&f.push(k))),g||h||i||k||l||m){let o=a instanceof Hrc?()=>{a.updateWorldMatrix(!0)}:()=>{a.updateMatrix(),a.hasNonUniformScale&&(a.updateMatrixWorld(),a.updateMatrixWorldSVD()),a.parent?.matrixWorldFusedFalse&&(a.matrixWorld.multiplyMatrices(a.parent.matrixWorldFusedFalse,a.matrix),a.matrixWorldNeedsUpdate=!1),q7b(a)&&r7b(a.parent)&&a.invalidateDownstreamBooleanData(!0),a.updatePathSnapping(Object.assign({},b.pathSnapping,n))};f.push({update:o,start:o,end:o})}return f}(a,b,c,e,d)),a instanceof Hrc?f.push(...function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q;let r=[],s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;if("width"in a&&(s=MXc("width",a,b,c,e))&&r.push(s),"height"in a&&(t=MXc("height",a,b,c,e))&&r.push(t),a instanceof Exc||a instanceof Uzc){let H={...b.fill},I={...c.fill};void 0!==H.enabled&&H.enabled!==I.enabled&&(r.push((f=a,g=!0,{update:()=>{f instanceof Exc&&(f.fill.enabled=g)}})),H.enabled||Object.assign(H,{enabled:!0,color:{...H.color,a:0}}),I.enabled||Object.assign(I,{enabled:!0,color:{...I.color,a:0}})),(u=SXc("color",a.fill,H,I,e))&&r.push(u)}if(a instanceof Exc){let J={...b.stroke},K={...c.stroke};(J.enabled||K.enabled)&&(r.push((h=a,i=!0,{update:()=>{h instanceof Exc&&(h.stroke.enabled=i)}})),J.enabled||Object.assign(J,{enabled:!0,color:{...J.color,a:0}}),K.enabled||Object.assign(K,{enabled:!0,color:{...K.color,a:0}})),(v=SXc("color",a.stroke,J,K,e))&&r.push(v),(w=MXc("thickness",a.stroke,J,K,e))&&r.push(w)}if(a instanceof Exc){let L={...b.dropShadow},M={...c.dropShadow};(L.enabled||M.enabled)&&(r.push((j=a,k=!0,{update:()=>{j instanceof Exc&&(j.dropShadow.enabled=k)}})),L.enabled||Object.assign(L,{enabled:!0,color:{...L.color,a:0}}),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}})),(x=SXc("color",a.dropShadow,L,M,e))&&r.push(x),(y=MXc("blurRadius",a.dropShadow,L,M,e))&&r.push(y),(A=MXc("spread",a.dropShadow,L,M,e))&&r.push(A),(z=RXc("offset",a.dropShadow,L,M,e))&&r.push(z)}if(a instanceof Exc){let N={...b.innerShadow},O={...c.innerShadow};(N.enabled||O.enabled)&&(r.push((l=a,m=!0,{update:()=>{l instanceof Exc&&(l.innerShadow.enabled=m)}})),N.enabled||Object.assign(N,{enabled:!0,color:{...N.color,a:0}}),O.enabled||Object.assign(O,{enabled:!0,color:{...O.color,a:0}})),(B=SXc("color",a.innerShadow,N,O,e))&&r.push(B),(C=MXc("blurRadius",a.innerShadow,N,O,e))&&r.push(C),(E=MXc("spread",a.innerShadow,N,O,e))&&r.push(E),(D=RXc("offset",a.innerShadow,N,O,e))&&r.push(D)}if(a instanceof Exc||a instanceof Uzc){let P={...b.backgroundBlur},Q={...c.backgroundBlur};(P.enabled||Q.enabled)&&(r.push((n=a,o=!0,{update:()=>{n instanceof Exc&&(n.backgroundBlur.enabled=o)}})),P.enabled||Object.assign(P,{enabled:!0,radius:0}),Q.enabled||Object.assign(Q,{enabled:!0,radius:0})),(F=MXc("radius",a.backgroundBlur,P,Q,e))&&r.push(F)}if(a instanceof Exc){let R={...b.layerBlur},S={...c.layerBlur};(R.enabled||S.enabled)&&(r.push((p=a,q=!0,{update:()=>{p instanceof Exc&&(p.layerBlur.enabled=q)}})),R.enabled||Object.assign(R,{enabled:!0,radius:0}),S.enabled||Object.assign(S,{enabled:!0,radius:0})),(G=MXc("radius",a.layerBlur,R,S,e))&&r.push(G)}if(a instanceof Uzc||a instanceof uyc){let T=NXc("cornerRadius",a,b,c,e);T&&r.push(T)}return r}(a,b,c,e,d)):(a.data.visible&&f.push(...function(a,b,c,d){let e=[];if(!("cloner"in c)||!a.cloner)return e;let f=a.cloner,g="cloner"in b?b.cloner:{},h=c.cloner;cJa.forEach(a=>{let b;(b="count"===a?MXc("count",f.parameters,g,h,d,!0):TXc(a,f.parameters,g??{},h,d))&&e.push(b)});let i=function(a,b,c,d){if("radial"!==a.parameters.type)return;let e=b.radial,f=c.radial;if(!f)return;let g=a.parameters.radial,h=[];return dJa.forEach(a=>{let b=TXc(a,g,e??{},f,d);b&&h.push(b)}),h}(f,g,h,d);i?.length&&e.push(...i);let j=function(a,b,c,d){if("linear"!==a.parameters.type)return;let e=b.linear,f=c.linear;if(!f)return;let g=[],h=a.parameters.linear;return eJa.forEach(a=>{let b=TXc(a,h,e??{},f,d);b&&g.push(b)}),g}(f,g,h,d);j?.length&&e.push(...j);let k=function(a,b,c,d){if("grid"!==a.parameters.type)return;let e=b.grid,f=c.grid;if(!f)return;let g=[],h=a.parameters.grid;return fJa.forEach(a=>{let b;(b="count"===a?NXc(a,h,e??{},f,d,!0):TXc(a,h,e??{},f,d))&&g.push(b)}),g}(f,g,h,d);k?.length&&e.push(...k);let l=function(a,b,c,d){if("toObject"!==a.parameters.type)return;let e=b.toObject,f=c.toObject;if(!f)return;let g=[],h=a.parameters.toObject;return gJa.forEach(a=>{let b;(b="count"===a?MXc(a,h,e??{},f,d,!0):TXc(a,h,e??{},f,d))&&g.push(b)}),g}(f,g,h,d);l?.length&&e.push(...l);let m=function(a,b,c,d){if(!a.parameters.randomness)return;let e=b.randomnessObject,f=c.randomnessObject;if(!f)return;let g=[],h=a.parameters.randomnessObject;return hJa.forEach(a=>{let b=TXc(a,h,e??{},f,d);b&&g.push(b)}),g}(f,g,h,d);return m?.length&&e.push(...m),e.length&&e.push({update:()=>{f.update()}}),e}(a,b,c,d)),q7b(a)?(a instanceof A_b&&a.data.visible&&f.push(...function(a,b,c,d){let e=[];if(!("geometry"in c))return e;let f=a.geometry.userData.parameters,g="geometry"in b?b.geometry:{},h=c.geometry;if(a instanceof G0b){let i=function(a,b,c,d){if(void 0===c.scaleBaked)return;let e=(b.scaleBaked??a.data.geometry.scaleBaked).map(a=>"string"==typeof a?Number(d.getVariable(a)??0):a),f=c.scaleBaked.map(a=>"string"==typeof a?Number(d.getVariable(a)??0):a);if(wJa.isEqual(e,f))return;let g=[];return g.push({update:b=>{a.updateGeometryInteractions({scaleBaked:[Db.lerp(e[0],f[0],b),Db.lerp(e[1],f[1],b),Db.lerp(e[2],f[2],b)]},d),a.invalidateDownstreamBooleanData()},start:()=>{a.updateGeometryInteractions({scaleBaked:e},d),a.invalidateDownstreamBooleanData()},end:()=>{a.updateGeometryInteractions({scaleBaked:f},d),a.invalidateDownstreamBooleanData()}}),g}(a,g,h,d);i&&e.push(...i)}else{let j={};if(Object.assign(j,Eya(f,aKa)),aKa.forEach(a=>{let b=TXc(a,j,g,h,d);b&&e.push(b)}),a instanceof gDc){Object.assign(j,{extrusion:{...f.extrusion}});let k=function(a,b,c,d){if(!c.extrusion)return;let e=a.extrusion,f=b.extrusion??{},g=c.extrusion,h=[];return _Ja.forEach(a=>{let b=TXc(a,e,f,g,d);b&&h.push(b)}),h}(j,g,h,d);k&&e.push(...k)}e.length&&e.push({update:b=>{a.updateGeometryInteractions(j,d),a.updateGeometryGroupsIfNeeded()},start:b=>{a.updateGeometryInteractions(j,d),a.updateGeometryGroupsIfNeeded()},end:b=>{a.updateGeometryInteractions(j,d),a.updateGeometryGroupsIfNeeded()}})}return e}(a,b,c,d)),a.data.visible&&f.push(...function(a,b,c,d){let e=[];if(Array.isArray(a.material)){if(!("materials"in c&&c.materials))return e;let f="materials"in b&&b.materials?b.materials:[],g=c.materials;a.material.forEach((a,b)=>{if(!g[b])return;let c=f[b]??{},h=g[b];"string"==typeof c||"string"==typeof h||e.push(...UXc(a,c,h,d))})}else{if(!("material"in c&&c.material))return e;let h="material"in b&&b.material?b.material:{},i=c.material;if("string"==typeof h||"string"==typeof i)return e;e.push(...UXc(a.material,h,i,d))}return e}(a,b,c,d))):t7b(a)?a.data.visible&&f.push(...function(a,b,c,d){let e=[];if(void 0!==c.intensity){let f=MXc("intensity",a,b,c,d);f&&e.push(f)}if(void 0!==c.color){let g=function(a,b,c,d,e){let f=c[a]?c[a]:void 0,g=d[a];if(!g)return;let h=b[a],i=f?"string"==typeof f?e.getColor(f).clone():new df().setRGB(f.r,f.g,f.b):h.clone(),j="string"==typeof g?e.getColor(g).clone():new df().setRGB(g.r,g.g,g.b);if(i.equals(j))return;let k=h.clone();return b[a]=k,{update:a=>{k.lerpColors(i,j,a)},start:()=>{k.copy(i)},end:()=>{k.copy(j)}}}("color",a,b,c,d);g&&e.push(g)}return e}(a,b,c,d)):s7b(a)&&f.push(...function(a,b,c,d){let e=[],f="OrthographicCamera"===a.cameraType?b.orthographic?.zoom:b.perspective?.zoom,g="OrthographicCamera"===a.cameraType?c.orthographic?.zoom:c.perspective?.zoom;if(void 0!==g){let h=f??a.zoom,i=g;h!==i&&e.push({update:b=>{a.zoom=Db.lerp(h,i,b),a.updateProjectionMatrix()},start:()=>{a.zoom=h,a.updateProjectionMatrix()},end:()=>{a.zoom=i,a.updateProjectionMatrix()}})}if(void 0!==c.targetOffset){let j=MXc("targetOffset",a,b,c,d);j&&e.push(j)}return e}(a,b,c,d))),f.length?{update:a=>{f.forEach(b=>b.update(a))},start:a=>{f.forEach(b=>b.start?.(a))},end:a=>{f.forEach(b=>b.end?.(a))}}:void 0}var fYc=new fm;function gYc(a,b,c=!1){let d=[],e=c=>{let d=c.data;for(let e of(delete c.states,c.currentState=null,c.reversibleToState=null,c.currentTransitionEvent=null,d.states)){let f={...e.data};c.states||(c.states={}),c.states[e.id]=nOa.patch(d,f)}iYc(a.scene,c,null,b,void 0!==d.events.find(a=>"Follow"===a.data.type||"LookAt"===a.data.type)),hYc(a)};a.scene.traverse2D(e),a.traverseChildren(f=>{if(c&&(f.rigidBody?.setTranslation(f.position0,!0),f.rigidBody?.setRotation(f.rotation0,!0),f.rigidBody?.setLinvel(fYc,!0),f.rigidBody?.setAngvel(fYc,!0)),!Fsb.is(f))return;let g=f.uuid,h=f.data;if(delete f.states,f.uuid===QIa)return;let i=!1;for(let j of(d.some(b=>a.scene.find(g)?.isDescendantOf(b))?i=!0:h.physics?.fusedBody=== !0&&"dynamic"===h.physics.rigidBody&&d.push(g),f.data=h,f.currentState=null,f.reversibleToState=null,f.currentTransitionEvent=null,h.states)){let k={...j.data};!0===a.data.globalPhysics.usePhysics&&h.physics&&("dynamic"===h.physics.rigidBody||i)&&(void 0!==j.data.position&&delete k.position,void 0!==j.data.rotation&&delete k.rotation,void 0!==j.data.hiddenMatrix&&delete k.hiddenMatrix),f.states||(f.states={}),f.states[j.id]=SNa.patch(h,k)}iYc(a.scene,f,null,b,void 0!==h.events.find(a=>"Follow"===a.data.type||"LookAt"===a.data.type)),hYc(a),f instanceof jEc&&f.frame&&(f.frame.traverse(a=>e(a)),f.uiCanvas?.applySize())}),a.frame&&(a.frame.traverse(a=>e(a)),a.uiCanvas?.applySize())}function hYc(a){a.traverseEntity(b=>{for(let c of b.data.events){let d=[];switch(c.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":d.push(...c.data.actions);break;case"GameControl":for(let e of Object.values(c.data.gameActions))d.push(...e);break;case"DragDrop":d.push(...c.data.dragDropActions.drag,...c.data.dragDropActions.drop);break;case"Conditional":d.push(...c.data.inActions,...c.data.outActions);break}for(let f of d)if("Create"===f.data.type&&"Yes"===f.data.hideBase){let g=a.scene.find(f.data.object);g&&(g.visible=!1)}}})}function iYc(a,b,c,d,e=!1){if(b instanceof A_b&&b.removeInteractionGeometry(d),b instanceof Hrc?b.changeSelectedState(c,{shared:d},e):b.changeSelectedState(c,{scene:a,shared:d},e),b instanceof A_b&&b.updateGeometryGroupsIfNeeded(),b instanceof U5b&&b.updateCameraState(b.dataPatched,{scene:a,shared:d}),!(b instanceof Hrc)){if(b.cloner)for(let f of b.cloner.children)f.playModeVisible=void 0;b.updateVisible(a)}}function jYc(a){let b;if(5===a.easing){let{control1:c,control2:d}=a;b=`cubicBezier(
			${c[0]}, ${c[1]}, ${d[0]}, ${d[1]}
		)`}else if(6===a.easing){let{mass:e,stiffness:f,damping:g,velocity:h}=a;b=`spring( ${e}, ${f}, ${g}, ${h} )`}else{let i;switch(a.easing){case 0:i=EJa.linear;break;case 1:i=EJa.ease;break;case 2:i=EJa.easeIn;break;case 3:i=EJa.easeOut;break;case 4:i=EJa.easeInOut;break;default:i=EJa.linear}let[j,k,l,m]=i;b=`cubicBezier( ${j}, ${k}, ${l}, ${m} )`}return{duration:Math.max(a.duration,1e-4),easing:b}}function kYc(a){let b={delay:0,loop:-1===a.repeat||a.repeat+1};if(0===a.repeat)b.direction="normal",b.rewind=!1;else switch(a.direction){case"pingpong":b.direction="alternate",b.rewind=!1;break;case"pingpong-rewind":b.direction="alternate",b.rewind=!0;break;default:b.direction="normal",b.rewind=!1;break}switch(b.delay=0,b.endDelay=0,b.startOnceDelay=0,b.pingPongDelayCorrection=0,b.pingPongEndDelayCorrection=0,a.delayDirection){case"start-once":b.startOnceDelay=a.delay;break;case"start":b.delay=a.delay;break;case"end":b.endDelay=a.delay;break;case"start-end":case void 0:b.delay=a.delay,b.endDelay=a.delay;break}return"alternate"===b.direction&&(b.delay/=2,b.endDelay/=2,"start"===a.delayDirection?(b.pingPongDelayCorrection=b.delay,"number"==typeof b.loop&&b.loop%2==0&&(b.pingPongEndDelayCorrection=b.delay)):"end"===a.delayDirection?"number"==typeof b.loop&&b.loop%2!=0&&(b.pingPongEndDelayCorrection=b.endDelay):"start-end"===a.delayDirection&&(b.pingPongDelayCorrection=b.delay,b.pingPongEndDelayCorrection=b.endDelay)),b}var lYc={type:"beginState"},mYc={type:"completeState",isfromEntity:!1},nYc=class{constructor(oYc,pYc,qYc,rYc,sYc,tYc){if(this.object=oYc,this.data=rYc,this.sharedAssets=sYc,this.allowSlerp=tYc,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),0===this.targets.t||1===this.targets.t?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let a=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"beginState",state:a}),this.object instanceof Hrc||this.object.traverseEntity(a=>{a!==this.object&&a instanceof U5b&&a.dispatchEvent(lYc)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let a=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"completeState",state:a}),this.object instanceof Hrc||this.object.traverseEntity(a=>{a!==this.object&&a instanceof U5b&&a.dispatchEvent(mYc)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=eYc(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},void 0===pYc){let uYc=ZYc(this.object,this.object.currentState===qYc?this.object.prevState:this.object.currentState);if(!uYc)throw new Error("Missing property");this.from=uYc}else{let vYc=ZYc(this.object,pYc);if(!vYc)throw new Error("Missing property");this.from=vYc}if(void 0===qYc)throw new Error("Missing property");{let wYc=ZYc(this.object,qYc);if(!wYc)throw new Error("Missing property");this.to=wYc}this.useCurrentState=void 0===pYc|| void 0===qYc,this.params={targets:this.targets,t:1,autoplay:!1,...kYc(rYc),...jYc(rYc),change:this.onChange},this.callback=eYc(this.object,void 0===pYc?{}:this.from.data,void 0===qYc?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},xYc=class extends ab{constructor(yYc,zYc,AYc,BYc){if(super(),this.data=yYc,this.page=zYc,this.shared=AYc,this.condition=BYc,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.useToggle=!1,this.onTimelineChangeComplete=()=>{"normal"!==this.data.tweens[0].data.direction&&(this.toggleIsForward=!this.toggleIsForward),!1!==this.timelineNeedsRebuild&&(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!yYc.object)throw new Error("Missing property");let CYc=(this.page.scene.find(yYc.object)??this.page.uiCanvas?.find(yYc.object))??this.page.scene.find2DInUIObjects(yYc.object);if(!CYc)throw new Error("Missing property");if(!CYc.states)throw new Error("Missing property");if(this.object=CYc,yYc.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay="start-once"===yYc.tweens[0].data.delayDirection?yYc.tweens[0].data.delay:0,this.init()}get playing(){return this.timeline?.paused=== !1}get changeBegan(){return this.tweens.some(a=>a.changeBegan)?? !1}init(){this.initialCurrentState=ZYc(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.useToggle?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:DYc=!0,needsRebuild:EYc=!1,isRebuild:FYc=!1}={}){try{let GYc=kYc(this.data.tweens[0].data);FYc&&"number"==typeof GYc.loop&&GYc.loop--,this.timeline?.pause(),this.timeline=IXc.timeline({autoplay:!1,...GYc,...!0===GYc.loop||GYc.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let HYc=this.tweens.findIndex(a=>a?.changeBegan);if(!0===EYc&&(this.timelineNeedsRebuild=!0),DYc){let IYc=-1===HYc?0:HYc;for(let JYc=IYc;JYc<this.data.tweens.length-1;JYc++){let KYc=this.data.tweens[JYc],LYc=this.data.tweens[JYc+1],MYc;JYc===IYc&&(!0===this.object.wasMovedByUser||this.object.previousAction?.changeBegan=== !0)?(MYc=void 0,this.object instanceof U5b&&(this.object.wasMovedByUser=!1)):MYc=void 0===KYc.data.state?this.currentState:KYc.data.state;let NYc=new nYc(this.object,MYc,void 0===LYc.data.state?this.currentState:LYc.data.state,LYc.data,this.shared,this.data.allowSlerp?? !1);-1!==HYc&&JYc===IYc&&Object.assign(NYc.params,{startOnceDelay:0}),this.tweens[JYc]=NYc,this.timeline.add(NYc.params,this.timeline.duration+(JYc===IYc?GYc.delay:0))}this.timeline.duration+=GYc.endDelay}else{let OYc=-1===HYc?this.data.tweens.length-1:HYc+1;for(let PYc=OYc;PYc>0;PYc--){let QYc=this.data.tweens[PYc],RYc=this.data.tweens[PYc-1],SYc;PYc===OYc&&(!0===this.object.wasMovedByUser||this.object.previousAction?.changeBegan=== !0)?(SYc=void 0,this.object instanceof U5b&&(this.object.wasMovedByUser=!1)):SYc=void 0===QYc.data.state?this.currentState:QYc.data.state;let TYc=new nYc(this.object,SYc,void 0===RYc.data.state?this.currentState:RYc.data.state,QYc.data,this.shared,this.data.allowSlerp?? !1);-1!==HYc&&PYc===OYc&&Object.assign(TYc.params,{startOnceDelay:0}),this.tweens[PYc-1]=TYc,this.timeline.add(TYc.params,this.timeline.duration+(PYc===OYc?GYc.endDelay:0))}this.timeline.duration+=GYc.delay}}catch(UYc){UYc instanceof Error&&console.error(UYc.message)}this.object.previousAction?.playing=== !0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(!1===ZZc(this.shared,this.condition)||this.playing)return!1;clearTimeout(this.timeoutId);let VYc=kYc(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(a){a instanceof Error&&console.error(a.message)}},this.startOnceDelay+VYc)}pause(){this.timeline?.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let WYc=void 0===this.data.tweens[0].data.state?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof Hrc?this.object.changeSelectedState(WYc,{shared:this.shared}):this.object.changeSelectedState(WYc,{scene:this.page.scene,shared:this.shared}),this.object.currentState=WYc}seek(XYc){void 0===this.timeline&&this.buildTimeline(),this.timeline?.seek(XYc*this.timeline.duration,!0)}toggle(YYc){if(!1===ZZc(this.shared,this.condition))return!1;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=YYc?? !this.toggleIsForward,this.playing?(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function ZYc(a,b){let c,d;if("string"==typeof b?d=a.states?.[c=b]:null===b&&(c=null,d=a.data),!(void 0===c|| void 0===d))return{id:c,data:d}}var $Yc={type:"beginState"},_Yc={type:"completeState",isfromEntity:!1},aZc={type:"requestRender"},bZc=class extends ab{constructor(cZc,dZc,eZc,fZc){super(),this.data=cZc,this.page=dZc,this.shared=eZc,this.condition=fZc,this.toggleIsForward=!1,this.useToggle=!1,this.posStart=new fm,this.posEnd=new fm,this.qStart=new Fj,this.qEnd=new Fj,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(gZc=!1){if(!this.data.animate)return;let hZc=this.page.scene.find(this.data.targetCamera);if(!hZc||!hZc.visible)throw new ReferenceError("Target camera not founded or not visible");let iZc={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=IXc({targets:iZc,t:1,...jYc(this.data),update:()=>{0===iZc.t&&(this.useToggle&&!this.toggleIsForward?(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(hZc.position),this.qEnd.copy(hZc.quaternion),this.zoomEnd=hZc.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(hZc.uuid)),this.page.activeCamera.dispatchEvent($Yc));let a=this.page.activeCamera;a.position.lerpVectors(this.posStart,this.posEnd,iZc.t),a.quaternion.slerpQuaternions(this.qStart,this.qEnd,iZc.t),a.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*iZc.t,a.wasMovedBySwitchCameraAction=!0,a.updateMatrix(),a.updateMatrixWorld(),a.updateProjectionMatrix(),a.dispatchEvent(aZc),1===iZc.t&&a.dispatchEvent(_Yc)}})}switchCamera(jZc){let kZc=this.page.activeCamera,lZc=this.page.scene.find(jZc);if(!lZc||!lZc.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(lZc),kZc.dispatchEvent({type:"cameraChange",camera:lZc})}play(){if(!1===ZZc(this.shared,this.condition))return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{delete this.timeoutId,this.data.animate?(this.buildAnimation(),this.animation?.play()):this.switchCamera(this.data.targetCamera)},1e3*this.data.delay)}catch{}}pause(){this.animation?.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(mZc){if(!1===ZZc(this.shared,this.condition))return!1;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=mZc?? !this.toggleIsForward;try{this.playing?(this.animation?.pause(),this.buildAnimation(!0),this.animation?.play()):this.timeoutId=window.setTimeout(()=>{delete this.timeoutId,this.data.animate?(this.animation?.pause(),this.buildAnimation(),this.animation?.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(_Yc),this.page.activeCamera.dispatchEvent(aZc))},1e3*this.data.delay)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}},nZc=class extends ab{constructor(oZc,pZc,qZc,rZc,sZc){super(),this.page=pZc,this.animationControls=qZc,this.shared=rZc,this.condition=sZc,this.startOnceDelay=0,this.toggleIsForward=!1;let tZc=oZc.object,uZc=pZc.scene.find(oZc.object);uZc&&Array.isArray(uZc.identity)&&(tZc=uZc.identity[0]),this.data={...oZc,object:tZc};let vZc=this.animationControls.clipIdToAction[oZc.clipId+"/"+tZc];this.duration=vZc?.getClip()?.duration??1;let wZc=vZc?.getClip()?.tracks[0]?.times.length??1/0;this.leftFrameTime=this.data.crop[0]/wZc*this.duration,this.rightFrameTime=this.data.crop[1]/wZc*this.duration,this.startOnceDelay=oZc.delay}get playing(){return this.threeAnimAction?.isRunning()?? !1}play(xZc=!1){if(!1===ZZc(this.shared,this.condition))return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let a=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([b,c])=>{let d=b.split("/")[1];this.threeAnimAction!==c&&d===a&&c.isRunning()&&(xZc?c.fadeOut(.2):c.stop())}),xZc&&this.threeAnimAction?.fadeIn(.2)},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){this.threeAnimAction?.fadeOut(.2)}seek(yZc){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=Db.clamp(this.threeAnimAction.time+1/60*yZc,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(zZc,AZc=!1){if(!1===ZZc(this.shared,this.condition))return!1;this.toggleIsForward=zZc?? !this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let a=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([b,c])=>{let d=b.split("/")[1];this.threeAnimAction!==c&&d===a&&c.isRunning()&&(AZc?c.fadeOut(.2):c.stop())}),AZc&&this.threeAnimAction?.fadeIn(.2)}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){let BZc=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object]?.getClip();BZc&&(BZc.duration=this.duration),this.pause()}},CZc=class{constructor(DZc,EZc,FZc,GZc,HZc){this.data=DZc,this.page=EZc,this.eventManager=FZc,this.shared=GZc,this.condition=HZc,this.timeOutId=-1,this.scene=EZc.scene}dispatch(){if(!1===ZZc(this.shared,this.condition))return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},1e3*this.data.delay))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(a=>a.uuid!==this.data.target))return;"fade"===this.data.transition&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,1e3*this.data.duration),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let IZc=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity(a=>{"ParticleSystem"===a.type&&(a.sleep(),a.wakeUp(),a.data.autoPlay?a.start():a.stop())}),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(IZc),gYc(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},JZc=class{constructor(KZc,LZc,MZc,NZc){this.data=KZc,this.page=LZc,this.shared=MZc,this.condition=NZc,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=ZZc(this.shared,this.condition)}dispatch(){if(!1===this.evaluatedCondition)return!1;let OZc=this.shared.getVariable(this.data.variableId),PZc=Qnb(this.data.expression,this.shared,aOa.typeOfVariable(OZc));void 0!==PZc&&this.shared.updateVariable(this.data.variableId,"string"==typeof PZc?{textValue:PZc}:PZc)}dispose(){}},QZc=class{constructor(RZc,SZc,TZc,UZc){this.data=RZc,this.page=SZc,this.shared=TZc,this.condition=UZc,this.timeoutId=null}dispatchInner(){if(!1===ZZc(this.shared,this.condition))return!1;let VZc=this.shared.getDynamicVariablePlayState(this.data.variableId);if("PlayPause"===this.data.mode)void 0===this.shared.getDynamicVariableToggleIsForward(this.data.variableId)&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"===VZc?"Paused":"Playing");else if("Play"===this.data.mode&&"Playing"!==VZc)void 0===this.shared.getDynamicVariableToggleIsForward(this.data.variableId)&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if("Stop"===this.data.mode&&"Stopped"!==VZc)this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if("Pause"===this.data.mode&&"Paused"!==VZc)this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if("Restart"===this.data.mode)this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if("Toggle"===this.data.mode){let WZc=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);"Playing"===VZc?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,void 0!==WZc&&!WZc):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!WZc),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let XZc=this.data.delay,YZc=this.shared.getDynamicVariablePlayState(this.data.variableId);"PlayPause"===this.data.mode&&"Playing"===YZc&&(XZc=this.data.pauseDelay),0!==XZc?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},XZc)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}};function ZZc(a,b){if(void 0===b)return!0;if(0===b.expression.length)return!1;let c=Qnb(b.expression,a,"boolean");return b.negate?!c:!!c}function $Zc(a,b,c,d,e,f){let g={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[]},h=b=>({id:i,data:j})=>{try{"Audio"===j.type?JIa[a.type].includes("Audio")&&g.Audio.push(new aWc(i,j,f,d,b)):"Video"!==j.type||f instanceof Hrc?"Particles"===j.type?JIa[a.type].includes("Particles")&&g.Particles.push(new hWc(j,c,d,b)):"Link"===j.type?JIa[a.type].includes("Link")&&g.Link.push(new qWc(j,e.controlsManager,d,b)):"Create"===j.type?JIa[a.type].includes("Create")&&g.Create.push(new F$c(j,c,e.controlsManager,d,b)):"Destroy"===j.type?JIa[a.type].includes("Destroy")&&g.Destroy.push(new wWc(j,c,e.controlsManager,d,b)):"Reset"===j.type?JIa[a.type].includes("Reset")&&g.Reset.push(new DWc(j,c,d,e,b)):"Transition"===j.type?JIa[a.type].includes("Transition")&&g.Transition.push(new xYc(j,c,d,b)):"SwitchCamera"===j.type?JIa[a.type].includes("SwitchCamera")&&g.SwitchCamera.push(new bZc(j,c,d,b)):"SceneTransition"===j.type?JIa[a.type].includes("SceneTransition")&&g.SceneTransition.push(new CZc(j,c,e,d,b)):"Animation"===j.type?JIa[a.type].includes("Animation")&&g.Animation.push(new nZc(j,c,e.animationControls,d,b)):"SetVariable"===j.type?JIa[a.type].includes("SetVariable")&&g.SetVariable.push(new JZc(j,c,d,b)):"DynamicVariablePlay"===j.type?JIa[a.type].includes("DynamicVariablePlay")&&g.DynamicVariablePlay.push(new QZc(j,c,d,b)):"Conditional"===j.type&&JIa[a.type].includes("Conditional")&&(j.ifActions.forEach(h({expression:j.condition,negate:!1})),j.elseActions.forEach(h({expression:j.condition,negate:!0}))):JIa[a.type].includes("Video")&&g.Video.push(new u$c(i,j,f,d,b))}catch(k){}};return b.forEach(h()),g}function _Zc(a){Object.values(a).forEach(a=>{a.forEach(a=>{(a instanceof aWc||a instanceof u$c||a instanceof hWc||a instanceof nZc||a instanceof xYc||a instanceof F$c||a instanceof wWc||a instanceof bZc||a instanceof CZc||a instanceof DWc||a instanceof JZc||a instanceof QZc)&&a.dispose()})})}var a$c=new Map,b$c=new Map,c$c=class{constructor(d$c,e$c,f$c){this.data=e$c,this.delay=0,this.status="stopped";let{layerId:g$c,loop:h$c,volume:i$c,delay:j$c}=e$c;if(this.object=f$c,void 0===g$c)throw new Error("Missing property");let k$c=function(a,b){let c;if("material"in a){let d=a.material;c=Array.isArray(d)?a.material[0].layers.find(a=>a.uuid===b):a.material.layers.find(a=>a.uuid===b)}if(c)return c.color.texture.image.img instanceof HTMLVideoElement?c.color.texture.image.img:void 0}(f$c,g$c);k$c&&(this.videoElement=k$c,this.videoElement.loop=h$c===1/0,Rya&&(this.videoElement.autoplay=!0),void 0!==i$c&&(this.videoElement.volume=i$c)),void 0!==j$c&&(this.delay=j$c),b$c.has(f$c.uuid)?b$c.get(f$c.uuid).push(this):b$c.set(f$c.uuid,[this]),a$c.set(d$c,this),this.pause()}mute(){this.videoElement&&(this.videoElement.muted=!0)}unMute(){this.videoElement&&(this.videoElement.muted=!1)}play(l$c){if(!this.videoElement)return;let m$c=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);l$c?(this.mute(),this.delay+=150):m$c?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let a=this.videoElement.play();void 0!==a&&a.then(a=>{}).catch(a=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){this.videoElement&&(this.videoElement.pause(),this.status="paused")}stop(){this.videoElement&&(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){"stop"===this.data.toggle?"playing"===this.status?this.stop():(this.stop(),this.play()):"pause"===this.data.toggle?"playing"===this.status?this.pause():this.play():(this.stop(),this.play())}dispose(){this.videoElement&&(this.stop(),this.videoElement.muted=!0)}},n$c=class{constructor(o$c){this.data=o$c}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(p$c){let q$c=a$c.get(p$c);q$c&&(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{q$c[this.data.interaction](),this.disposeDelay()},this.data.delay)):q$c[this.data.interaction]())}pauseAllVideosFromObject(r$c){let s$c=b$c.get(r$c);s$c?.length&&(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{s$c.forEach(a=>a[this.data.interaction]()),this.disposeDelay()},this.data.delay)):s$c.forEach(a=>a[this.data.interaction]()))}pauseAllVideos(){let t$c=[...b$c.values()];t$c.length&&(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t$c.forEach(a=>{a.forEach(a=>{a[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):t$c.forEach(a=>{a.forEach(a=>{a[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},u$c=class{constructor(v$c,w$c,x$c,y$c,z$c){if(this.data=w$c,this.shared=y$c,this.condition=z$c,"play"===w$c.interaction)this.interaction=new c$c(v$c,w$c,x$c);else if("pause"===w$c.interaction||"stop"===w$c.interaction)this.interaction=new n$c(w$c);else throw new Error("Missing property")}dispatchBasic(){if(!1===ZZc(this.shared,this.condition))return!1;this.interaction instanceof c$c?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(!1===ZZc(this.shared,this.condition))return!1;this.interaction instanceof c$c?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},A$c=(()=>{let a,b,c,d;function e(c){a||B$c()||!(b?.sharedGameControlGlobals.createdObjects.length>0)||(a=requestAnimationFrame(f)),c&&(b=c,d=c.requestRender)}function f(e){let g=c?e-c:0,h=b.sharedGameControlGlobals.createdObjects,i=b.sharedGameControlGlobals.nCreatedPerAction,j=h.length,k=0;for(;k<j;){let l=h[k];void 0===l.userData.createdTime&&(l.userData.createdTime=e),void 0===l.userData.lifetime&& void 0===l.userData.quantity||l.userData.lifetime&&e-l.userData.createdTime<l.userData.lifetime||l.userData.quantity&&i[l.userData.actionId]<=l.userData.quantity?(l.userData.velocity&&(l.position.addScaledVector(l.userData.velocity,g/1e3),l.updateMatrix(),d()),k++):(i[l.userData.actionId]>l.userData.quantity&&i[l.userData.actionId]--,h.splice(k,1),l.removeFromParent(),b.sharedGameControlGlobals.rapierWorld&&l.rigidBody?(b.sharedGameControlGlobals.colliderToEntity.delete(l.rigidBody.collider(0).handle),b.sharedGameControlGlobals.rapierWorld.removeRigidBody(l.rigidBody)):(l.bvhGeometry=void 0,b.sharedGameControlGlobals.entitiesWithTransformAnim=b.sharedGameControlGlobals.entitiesWithTransformAnim.filter(a=>void 0!==a.bvhGeometry)),j--,d())}a=k>0?requestAnimationFrame(f):void 0,c=k>0?e:void 0}return"u">typeof document&&document.addEventListener("visibilitychange",function(){B$c()?a&&(cancelAnimationFrame(a),a=void 0,c=void 0):e()}),e})();function B$c(){return!!document&&document.hidden}var C$c=new Fj,D$c=new fm,E$c=new fm,F$c=class{constructor(G$c,H$c,I$c,J$c,K$c){this.data=G$c,this.page=H$c,this.controlsManager=I$c,this.shared=J$c,this.condition=K$c,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=Db.generateUUID(),this.dispatch=()=>{if(!1===ZZc(this.shared,this.condition))return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay)):this.dispatchInner()},this.dispatchFromStart=()=>{if(!1===ZZc(this.shared,this.condition))return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay))},this.dispatchThrottled=(function(a,b,c){var d=!0,e=!0;if("function"!=typeof a)throw new TypeError("Expected a function");return Gua(c)&&(d="leading"in c?!!c.leading:d,e="trailing"in c?!!c.trailing:e),sya(a,b,{leading:d,maxWait:b,trailing:e})})(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{null===this.intervalId&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{null!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let a=new eSa(this.object);if(a.playModeVisible=!0,a.expand(),"world"!==this.data.coordinateSystem){let b=this.data.coordinateSystem,c=this.page.scene.find(b);c&&(c.updateMatrixWorldSVD(),a.hiddenMatrix.copy(c.matrixWorldRigid))}a.position.fromArray(this.data.position),a.rotation.fromArray(this.data.rotation),a.updateMatrix(),this.page.add(a);let d=this.controlsManager.sharedGameControlGlobals;d.createdObjects.push(a),void 0===d.nCreatedPerAction[this.uniqueId]?d.nCreatedPerAction[this.uniqueId]=1:d.nCreatedPerAction[this.uniqueId]++,a.updateWorldMatrix(!0,!0),a.traverseObject(this.traverseObjectCB),A$c(),this.controlsManager.requestRender()},this.traverseObjectCB=a=>{a.hasNonUniformScale&&a.updateMatrixWorldSVD();let b;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(a instanceof E2b)if(!a.objectForSample)return!0===a.object.dataPatched.physics.fusedBody&&"dynamic"===a.object.dataPatched.physics.rigidBody||void 0;else{if(a.objectForSample.dataPatched.physics.fusedBody)return;b=a.object}else if(a instanceof eSa)b=a.object;else if((b=a).dataPatched.cloner?.hideBase)return!0}else{if(a instanceof E2b)return;b=a instanceof eSa?a.object:a}"Time"===this.data.destroy?a.userData.lifetime=1e3*this.data.lifetime:"Quantity"===this.data.destroy&&(a.userData.quantity=this.data.destroyAfterQuantity,a.userData.actionId=this.uniqueId);let c=new fm().fromArray(this.data.velocity),d=b.dataPatched;if(!("visibility"===d.physics.enabled?!d.visible:!d.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(a,b,{fromCreate:!0,dynamic:this.data.dynamic}),"Collision"===this.data.destroy&&(a.rigidBody?.collider(0).setActiveEvents(1),a.userData.hasCollisionDestroy=!0),a.matrixWorld.decompose(D$c,C$c,E$c),c.applyQuaternion(C$c),this.data.velocity.some(a=>0!==a)&&this.data.dynamic&&a.rigidBody?.setLinvel(c.divideScalar(this.controlsManager.pixelsPerMeter),!0)):("geometry"in a.object&&this.controlsManager.addBoundsTree(a),this.data.velocity.some(a=>0!==a)&&this.data.dynamic&&(a.userData.velocity=c)),b.dataPatched.physics?.fusedBody=== !0))return!0};let L$c=this.page.scene.find(this.data.object);if(!L$c)throw new Error("Missing Property");if(this.object=L$c,"world"!==this.data.coordinateSystem&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");A$c(I$c)}dispose(){null!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(a=>window.clearTimeout(a)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}};new fm;var M$c=new fm,N$c=new fm,O$c=new fm,P$c=new fm,Q$c=new fm,R$c=new fm,S$c=new rs,T$c=new rs,U$c=new rs,V$c=new rs,W$c=new Fj,X$c=new Fj,Y$c=new Ex(0,0,0,"YXZ"),Z$c=new fm(1,0,0),$$c=new fm(0,1,0),_$c=new fm(0,0,1),a_c=new fm(1,1,1),b_c=new pq,c_c=new Ppa,d_c=new Io,e_c={type:"requestRender"},f_c={type:"updateMatrix"},g_c=Math.PI/6,h_c=class extends ab{constructor(i_c,j_c,k_c,l_c,m_c,n_c,o_c,p_c,q_c){super(),this.object=i_c,this.domElement=j_c,this.data=k_c,this.gloabalPhysics=l_c,this.controlsManager=m_c,this.cameraFollow=n_c,this.camera=o_c,this.page=p_c,this.sharedAssets=q_c,this.enableDamping=!0,this.hiddenMatrix0=new rs,this.target0=new fm,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=200,this.euler0=new Ex(0,0,0,"YXZ"),this.position0Cam=new fm,this.quat0Cam=new Fj,this.scale0Cam=new fm,this.hiddenMatrix0Cam=new rs,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new Ppa(new fm(0,-40,0),new fm(0,40,0)),matrix:new rs,position:new fm,rotation:new Fj},this.euler=new Ex(0,0,0,"YXZ"),this.eulerDelta=new fm,this.lastPosition=new fm,this.lastCameraQuaternion=new Fj,this.lastCameraPosition=new fm,this.PI_2=Math.PI/2,this.prevMouse=new Eb,this.velocityTarget=new fm,this.velocity=new fm,this.directionXZ=new fm,this.rotVelocityStick=new fm,this.rotVelocityTarget=new fm,this.rotVelocity=new fm,this.rotDirection=new fm,this.nonColliderRotOffset=new rs,this.nonColliderPosOffset=new rs,this.firstPointerId=-1,this.rot=new fm,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new rs,this.objectToTarget=new fm,this.objectToTarget0=new fm,this.objectToCamXZ=new fm,this.objectToCamXZ0=new fm,this.targetToCamera=new fm,this.targetToCamera0=new fm,this.cameraPolarAxis0=new fm,this.targetPos=new fm,this.targetQuat=new Fj,this.lerpFactorPos=new fm().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new Fj,this.objXZQuatInv=new Fj,this.objXZRotMat=new rs,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new fm,this.pushedVelocity=new fm,this.groundYRotation=0,this.objectRealQuat=new Fj,this.colliderWorldQuat=new Fj,this.groundNormal=new fm,this.groundTilt=new Fj,this.groundTiltInv=new Fj,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new fm,this.quaternion=new Fj,this.scale=new fm,this.initialAction=!0,this.onPointerDown=a=>{a.target!==this.domElement|| -1!==this.firstPointerId||(this.firstPointerId=a.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),"keys"===this.rotBy||Tya||Uya&&!(Vya>=15.5)||this.domElement.requestPointerLock(),this.prevMouse.set(a.clientX,a.clientY))},this.onPointerUp=a=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),"mouse"===a.pointerType&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=a=>{if(a.pointerId!==this.firstPointerId)return;let b=a.clientX-this.prevMouse.x,c=a.clientY-this.prevMouse.y;this.prevMouse.set(a.clientX,a.clientY),"mouse"===a.pointerType&&"keys"!==this.rotBy&&(Uya&&Vya<15.5&&!Tya?(this.eulerDelta.y=-b*this.mouseOrbitSensitivity,this.eulerDelta.x=-c*this.mouseOrbitSensitivity):(this.eulerDelta.y=-a.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-a.movementY*this.mouseOrbitSensitivity)),"mouse"!==a.pointerType&&"drag"===this.rotByTouch&&(this.eulerDelta.y=-b*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-c*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=a=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?h_c.isLocked=!0:h_c.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document?.hidden)for(let a in this.movementState)this.movementState[a]=0},this.onKeyDown=a=>{for(let b of(a.target instanceof HTMLInputElement||"ArrowLeft"!==a.code&&"ArrowUp"!==a.code&&"ArrowRight"!==a.code&&"ArrowDown"!==a.code&&"Space"!==a.code||a.preventDefault(),this.keyAssignments))if(a.key.toUpperCase()===b[1]||a.key===b[1]){this.movementState[b[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=a=>{for(let b of this.keyAssignments)if(a.key.toUpperCase()===b[1]||a.key===b[1]||a.code.slice(3,a.code.length).toUpperCase()===b[1]){this.movementState[b[0]]=0;break}},this.copyVRGamePadValues=(a,b)=>{for(let c=2;c<4;c++){let d=a.axes[c];0===b?2===c?this.movementState.movePosX=d:this.movementState.movePosZ=d:(a.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,2===c?(.3>Math.abs(this.movementState.rotPosY)&&Math.abs(d)>=.3&&(this.vrEulerYOffset+=d<0?1:-1),this.movementState.rotPosY=d):"fly"===this.moveMode&&(this.movementState.moveNegY=d))}},this.sharedGameControlGlobals=m_c.sharedGameControlGlobals,i_c===o_c&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let r_c=this.euler0.clone(),s_c=r_c.y;if(this.objectRealQuat.copy(this.quaternion),r_c.y=0,this.quaternion.setFromEuler(r_c),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),r_c.set(0,s_c,0),this.quaternion.setFromEuler(r_c),this.rot.setFromEuler(r_c),this.object.matrixAutoUpdate=!1,(this.isFirstPerson|| !0===this.cameraFollow)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),!0===this.cameraFollow){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy(this.camera?.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let t_c=new fm(0,0,-1).applyQuaternion(this.camera.quaternion),u_c=new fm().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(u_c),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let v_c,w_c;1e-6>Math.abs(t_c.y)?(u_c.y=0,t_c.y=0,w_c=u_c.projectOnVector(t_c)):w_c=u_c.y/t_c.y>0?t_c.multiplyScalar(u_c.y/t_c.y):t_c.multiplyScalar(u_c.length()),this.targetToCamera0.copy(w_c).negate(),v_c=this.camera.position.clone().add(w_c),this.objectToTarget0.subVectors(v_c,this.position);let x_c=new Ex().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-x_c.x,x_c.x=0,x_c.z=0,x_c.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(x_c)}if(this.object instanceof U5b&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=k_c.rotByTouch??"joystick",this.rotBy=k_c.rotBy??"keys",this.rotationMode=k_c.rotationMode??"normal",this.moveMode=k_c.moveMode??"walk",this.collisionEnabled=k_c.collisionEnabled,this.speedTranslate=(k_c.speedTranslate??250)*1,this.speedOrbit=(k_c.speedRotate??100)*.025,this.mouseOrbitSensitivity=(k_c.speedRotate??100)*16e-6,this.keyAssignments=k_c.keyAssignments.map(a=>{let b=[a[0],a[1]];return""===b[1]?b[1]="ArrowUp":""===b[1]?b[1]="ArrowLeft":""===b[1]?b[1]="ArrowDown":""===b[1]?b[1]="ArrowRight":""===b[1]?b[1]="Shift":""===b[1]?b[1]="Enter":"Space"===b[1]?b[1]=" ":""===b[1]?b[1]="Meta":"Ctrl"===b[1]?b[1]="Control":"Esc"===b[1]&&(b[1]="Escape"),b}),"mouse"===k_c.rotBy){let y_c;-1!==(y_c=this.keyAssignments.findIndex(a=>"rotNegX"===a[0]))&&(this.keyAssignments[y_c][1]=""),-1!==(y_c=this.keyAssignments.findIndex(a=>"rotPosX"===a[0]))&&(this.keyAssignments[y_c][1]=""),-1!==(y_c=this.keyAssignments.findIndex(a=>"rotPosY"===a[0]))&&(this.keyAssignments[y_c][1]=""),-1!==(y_c=this.keyAssignments.findIndex(a=>"rotNegY"===a[0]))&&(this.keyAssignments[y_c][1]="")}this.lerpFactorPosStart=1-.02**(1/((k_c.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((k_c.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((k_c.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((k_c.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((k_c.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((k_c.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??ANa.defaultData.gravity)*12,this.usePhysics=this.gloabalPhysics.usePhysics??ANa.defaultData.usePhysics,this.jumpPower=20*k_c.jumpPower,this.resetYPosition=this.position.y+Math.abs(k_c.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=k_c.alignToGround?? !1,this.orientMode=k_c.autoOrientMove?k_c.orientMode:"none",this.orientWith=k_c.orientWith??hOa.defaultDataThirdPerson.orientWith,this.slopeThresh=65*Math.PI/180,"capsule"===k_c.collider.type?(this.collider.radius=k_c.collider.radius,this.collider.segment.start.y=k_c.collider.height/2-k_c.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=.02*k_c.collider.height/this.pixelsPerMeter,this.stepThresh=.3*k_c.collider.height/this.pixelsPerMeter,this.colliderHeight=k_c.collider.height):"sphere"===k_c.collider.type?(this.collider.radius=k_c.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*k_c.collider.radius*.02/this.pixelsPerMeter,this.stepThresh=2*k_c.collider.radius*.3/this.pixelsPerMeter,this.colliderHeight=2*k_c.collider.radius):(this.offset=.02*k_c.collider.height/this.pixelsPerMeter,this.stepThresh=.3*k_c.collider.height/this.pixelsPerMeter,this.colliderHeight=k_c.collider.height),this.collider.type=k_c.collider.type;let z_c=new fm().fromArray(k_c.collider.position),A_c=new Fj().setFromEuler(new Ex().fromArray([...k_c.collider.rotation,"XYZ"]));this.collider.position.copy(z_c).multiply(this.scale),this.collider.rotation.copy(A_c),this.collider.matrix.compose(z_c,A_c,a_c),void 0!==k_c.cameraXAxis&&(this.cameraXAxis=k_c.cameraXAxis,this.cameraYAxis=k_c.cameraYAxis,this.minPolarAngle=k_c.cameraRotXLimits[0],this.maxPolarAngle=k_c.cameraRotXLimits[1],this.minAzimuthAngleRel=k_c.cameraRotYLimits[0],this.maxAzimuthAngleRel=k_c.cameraRotYLimits[1]),this.forwardDir=k_c.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=k_c.runMultiplier??2;let B_c=2*k_c.navmesh.destinationHelperRadius;if(B_c>0){let C_c=new LBa;C_c.push({fi:0,data:{...UJa.defaultData("light","phong"),alpha:0},id:"layer1"}),C_c.push({fi:0,data:{...UJa.defaultData("color"),color:k_c.navmesh.destinationHelperColor,alpha:k_c.navmesh.destinationHelperColor.a},id:"layer2"});let D_c=new CTb({layers:C_c},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new GH(dTa.create({parameters:{width:B_c,height:B_c/10,hollow:.7}}),D_c),this.navMeshPathDest.material.userData.opacity0=k_c.navmesh.destinationHelperColor.a}this.activate()}reset(E_c=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),E_c){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let F_c=new Ex().setFromQuaternion(this.quaternion,"YXZ"),G_c=F_c.y;this.objectRealQuat.copy(this.quaternion),F_c.y=0,this.quaternion.setFromEuler(F_c),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),F_c.set(0,G_c,0),this.quaternion.setFromEuler(F_c),this.rot.setFromEuler(F_c),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof U5b?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();!0===this.cameraFollow&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){this.deactivate(),this.navMeshPathDest?.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let H_c=this.data,I_c=this.sharedAssets;void 0!==H_c.gameActions&&(this.actions={},gOa.list.forEach(a=>{this.actions[a]=$Zc({...H_c,disabled:!1,type:"GameControl"},H_c.gameActions[a],this.page,I_c,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),_Zc(this.actions.idle),_Zc(this.actions.move),_Zc(this.actions.run),_Zc(this.actions.jump)}dispatchStartEvent(J_c){void 0!==this.actions[J_c]&&(this.actionState[J_c]||(this.actionState[J_c]=!0,this.actions[J_c].Transition.forEach(a=>{a.play()}),this.actions[J_c].Animation.forEach(a=>{a.play(!1===this.initialAction)}),this.actions[J_c].Create.forEach(a=>{a.dispatchStart()}),this.actions[J_c].Audio.forEach(a=>{a.dispatchGameControl("start")}),this.actions[J_c].Particles.forEach(a=>{a.dispatchGameControl("start")})))}dispatchStopEvent(K_c){void 0===this.actions[K_c]||this.actionState[K_c]&&(this.actionState[K_c]=!1,this.actions[K_c].Transition.forEach(a=>{a.stop(),null!==a.object.currentState&&a.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[K_c].Create.forEach(a=>{a.dispatchStop()}),this.actions[K_c].Audio.forEach(a=>{a.dispatchGameControl("stop")}),this.actions[K_c].Particles.forEach(a=>{a.dispatchGameControl("stop")}))}get colliderWorldPosition(){return P$c.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(L_c,M_c,N_c){if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let O_c=(this.isFirstFrame?16.6:L_c)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let P_c=60*O_c,Q_c=!1;if(this.usePhysics&&this.collisionEnabled){let R_c=Q$c.set(0,(0===this.velocity.y?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/120,1)*(this.gravity>0?1:-1):this.velocity.y)*O_c,0).divideScalar(this.pixelsPerMeter),S_c=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,R_c,this.object.rigidBody?.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(S_c){this.onObject=!0,this.groundNormal.set(S_c.normal2.x,S_c.normal2.y,S_c.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(Q_c=!0),0===S_c.collider.parent()?.bodyType()&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let T_c=S_c.collider.parent();for(let U_c of(this.groundYRotation=0,this.groundVelocity.set(0,0,0),this.sharedGameControlGlobals.entitiesWithTransformAnim))if(U_c.rigidBody===T_c&&U_c.userData.isFollowingObj!==this.object.uuid){(U_c.hasNonUniformScale?U_c.matrixWorldRigid:U_c.matrixWorld).decompose(P$c,X$c,Q$c),this.groundVelocity.subVectors(P$c,U_c.prevT),this.object.getWorldPosition(Q$c).add(this.collider.position).sub(P$c),this.groundYRotation=Y$c.setFromQuaternion(X$c).y-U_c.prevR.y,R$c.copy(Q$c).applyAxisAngle($$c,this.groundYRotation),this.groundVelocity.add(R$c.sub(Q$c)).divideScalar(O_c);break}}else this.onObject=!1}if("walk"===this.moveMode&&this.collisionEnabled&&(1===this.movementState.jump&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*P_c),"fly"===this.moveMode&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,"+z"===this.forwardDir&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let V_c=this.navMeshPathDest.material;if("walk"===this.moveMode&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let W_c=P$c.subVectors(this.path[1],this.position),X_c=Q$c.subVectors(this.path[1],this.path[0]);0>W_c.dot(X_c)?this.path.shift():(this.directionXZ.x=X_c.x,this.directionXZ.z=X_c.z),V_c.opacity=V_c.userData.opacity0}else V_c.opacity-=.05*V_c.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,("walk"===this.moveMode?this.velocityTarget.x+this.velocityTarget.z===0:0===this.velocityTarget.manhattanLength())?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),"walk"===this.moveMode&&(this.lerpFactorPos.y=1),!1===this.didHit&&0===this.pushedVelocity.manhattanLength()|| !1===this.usePhysics?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**P_c),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**P_c),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**P_c)):this.velocity.copy(this.velocityTarget),("walk"===this.moveMode?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let Y_c=O$c.copy(this.velocity);if("none"!==this.orientMode&& !1===this.isFirstPerson){let Z_c=Q$c.copy(Y_c);Z_c.y=0,Y_c.set(0,Y_c.y,Z_c.length()*("+z"===this.forwardDir?1:-1))}if(this.directionXZ.manhattanLength()>0&&"none"!==this.orientMode&& !1===this.isFirstPerson)if("camera"===this.orientWith&&this.path.length<=1){let $_c=P$c;this.camera.getWorldDirection($_c);let __c=R$c.copy($$c).multiplyScalar($_c.dot($$c));$_c.sub(__c);let a0c=Q$c.copy(this.directionXZ);a0c.x*=-1,this.rot.y=$_c.angleTo(a0c)*($_c.cross(a0c).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*("+z"===this.forwardDir?1:-1);if(Y$c.setFromVector3(this.rot),"walk"===this.moveMode&&(Y$c.x=0),Y_c.applyEuler(Y$c),Q_c&&(X$c.setFromUnitVectors($$c,this.groundNormal),Y_c.applyQuaternion(X$c)),N_c){let b0c=Y$c.set(0,this.vrEulerYOffset*g_c,0);N_c.applyEuler(b0c),Y_c.x+=N_c.x,Y_c.z+=N_c.z,this.nonColliderPosOffset.elements[13]+=N_c.y*O_c}if(!0===this.usePhysics){let c0c=Q$c;for(let d0c of(this.pushedVelocity.set(0,0,0),this.sharedGameControlGlobals.entitiesWithTransformAnim)){let e0c=R$c.setFromMatrixPosition(d0c.matrixWorld).sub(d0c.prevT).divideScalar(O_c).divideScalar(this.pixelsPerMeter),f0c=d0c.rigidBody.collider(0).castCollider(e0c,this.object.rigidBody.collider(0),P$c.copy(Y_c).divideScalar(this.pixelsPerMeter),O_c,!1);e0c.multiplyScalar(this.pixelsPerMeter);let g0c=Fsb.is(d0c)?d0c:d0c.object;if(null!==f0c&&this.lastHitObj!==g0c){let h0c;d0c instanceof eSa&&(h0c=d0c);let i0c=this.sharedGameControlGlobals.entityToCollisionEvents[g0c.uuid];if(i0c)for(let j0c of i0c)"character"===j0c.data.target&&(j0c.dispatch(h0c),g0c.dispatchEvent(Jcd));this.lastHitObj=g0c}if(null!==f0c){this.pushedVelocity.copy(e0c),c0c.copy(f0c.normal1).applyQuaternion(d0c.quaternion);break}}if(0!==this.pushedVelocity.manhattanLength()){let k0c=c0c.dot(Y_c);k0c<0&&Y_c.addScaledVector(c0c,-k0c),Y_c.add(this.pushedVelocity)}else Y_c.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),"normal"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)||"steer"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||"walk"===this.moveMode)?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,"normal"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)||"steer"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(O_c),this.rotVelocityStick),0===this.rotVelocityTarget.manhattanLength()?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**P_c):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**P_c),this.euler.x+=this.rotVelocity.x*O_c,this.euler.y+=this.rotVelocity.y*O_c+this.groundYRotation,0===this.rotVelocityTarget.y&&0===this.directionXZ.manhattanLength()?this.rotationAccumWhenOrientWithCamera=0:(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*O_c),!1===this.isFirstPerson&&"none"!==this.orientMode&&this.directionXZ.manhattanLength()>0){if("radial"===this.orientMode){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle($$c,this.euler.y-this.euler0.y);let l0c=Q$c.copy(this.objectToCamXZ).normalize(),m0c=R$c.copy(Y_c).multiplyScalar(O_c);m0c.y=0;let n0c=m0c.sub(P$c.copy(l0c).multiplyScalar(m0c.dot(l0c))).cross(l0c).y;this.euler.y-=Math.atan2(n0c,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*O_c+this.groundYRotation,0!==this.rotVelocityTarget.y&&(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.euler.y=this.rot.y);if(!0===this.cameraFollow&&("walk"===this.moveMode?"Limit"===this.cameraXAxis?this.euler.x=Db.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=Db.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):"Limit"===this.cameraXAxis&&(this.euler.x=Db.clamp(this.euler.x,-this.PI_2,this.PI_2))),"fly"===this.moveMode?this.rot.x=this.euler.x:this.isFirstPerson&&(M_c?(Y$c.copy(M_c),Y$c.y=0):(Y$c.copy(this.euler),Y$c.y=0),this.nonColliderRotOffset.makeRotationFromEuler(Y$c)),M_c&&("walk"===this.moveMode?(this.rot.y=M_c.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(M_c),this.rot.y+=this.vrEulerYOffset*g_c),W$c.setFromAxisAngle(Z$c,this.rot.x),X$c.setFromAxisAngle($$c,this.rot.y),X$c.multiply(W$c),W$c.setFromAxisAngle(_$c,this.rot.z),X$c.multiply(W$c),this.quaternion.copy(X$c),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let o0c=Q$c.copy(Y_c).multiplyScalar(O_c/this.pixelsPerMeter),p0c=null;this.didHit=!1;let q0c=new fm;for(let r0c=0;r0c<5;r0c++){let s0c=o0c.length(),t0c=R$c.copy(o0c).normalize();if(null!==(p0c=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(q0c),this.colliderWorldQuat,t0c,this.object.rigidBody?.collider(0).shape,s0c,!1,24,void 0,void 0,this.object.rigidBody))){this.didHit=!0;let u0c=this.sharedGameControlGlobals.colliderToEntity.get(p0c.collider.handle);if(u0c!==this.lastHitObj&&0===r0c){this.lastHitObj=u0c;let v0c=this.sharedGameControlGlobals.entityToCollisionEvents[u0c?.uuid];if(v0c){for(let w0c of v0c)if("character"===w0c.data.target){let x0c=this.sharedGameControlGlobals.rapierWorld?.getCollider(p0c.collider.handle)._parent,y0c;if(u0c.cloner){for(let z0c of u0c.cloner.children)if(z0c.rigidBody===x0c){y0c=z0c;break}}w0c.dispatch(y0c),u0c.dispatchEvent(Jcd)}}}let A0c=M$c.set(p0c.normal2.x,p0c.normal2.y,p0c.normal2.z).applyQuaternion(this.colliderWorldQuat),B0c=N$c.copy(t0c).multiplyScalar(p0c.toi).dot(A0c),C0c=p0c.toi;if(0===C0c&&(this.position.y+=this.offset*this.pixelsPerMeter),B0c>this.offset&&(C0c=p0c.toi*(B0c-this.offset)/B0c,q0c.addScaledVector(t0c,C0c)),o0c.copy(t0c).multiplyScalar(s0c-C0c),Math.acos(-A0c.y)>this.slopeThresh){let D0c=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(q0c),E0c=R$c.copy(p0c.witness2).applyQuaternion(this.colliderWorldQuat);E0c.y=0;let F0c=D0c.add(E0c);F0c.y+=this.stepThresh;let G0c=this.sharedGameControlGlobals.rapierWorld.castShape(F0c,this.colliderWorldQuat,o0c,this.object.rigidBody?.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);null!==G0c&&0===G0c.toi&&(A0c.y=0,A0c.normalize())}o0c.addScaledVector(A0c,-o0c.dot(A0c))}else{0===r0c&&0!==this.directionXZ.manhattanLength()&&(this.lastHitObj=null),q0c.add(o0c);break}}this.position.addScaledVector(q0c,this.pixelsPerMeter),this.object.rigidBody?.setTranslation(P$c.copy(this.position).divideScalar(this.pixelsPerMeter),!0),this.object.rigidBody?.setRotation(W$c.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let H0c=this.onObject?1:5,I0c=Y_c.multiplyScalar(O_c/H0c);for(let J0c=0;J0c<H0c;J0c++)this.position.add(I0c),this.collisionAdjustment(O_c/H0c)}else this.position.addScaledVector(Y_c,O_c);if("walk"===this.moveMode&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),!0===this.cameraFollow){this.updateFollowArms();let K0c=this.objectToTarget.add(this.position),L0c=this.targetToCamera.add(K0c);S$c.lookAt(L0c,K0c,$$c).setPosition(L0c),S$c.decompose(this.targetPos,this.targetQuat,P$c),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**P_c),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**P_c),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),"Limit"===this.cameraYAxis&&"cartesian"===this.orientMode&&(this.euler.y=Db.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=Db.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(f_c),(!(this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(void 0===this.camera||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate))||"fly"!==this.moveMode&& !0!==this.onObject&& !1!==this.collisionEnabled||null!==this.navMeshPathDest&&!(this.navMeshPathDest.material.opacity< -0.04*this.navMeshPathDest?.material?.userData.opacity0))&&(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(e_c),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let M0c=W$c.setFromAxisAngle($$c,"Limit"===this.cameraYAxis&&"radial"!==this.orientMode?Db.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&this.objectToTarget.applyQuaternion(M0c);let N0c;N0c="Limit"===this.cameraXAxis?Db.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):Db.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let O0c=P$c.copy(this.cameraPolarAxis0);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&O0c.applyQuaternion(M0c);let P0c=X$c.setFromAxisAngle(O0c,N0c);"Locked"!==this.cameraYAxis&&this.targetToCamera.applyQuaternion(M0c),"Locked"!==this.cameraXAxis&&this.targetToCamera.applyQuaternion(P0c)}groundTiltAdjustment(Q0c){180*$$c.angleTo(Q0c)/Math.PI<15||180*$$c.angleTo(Q0c)/Math.PI>85?W$c.identity():W$c.setFromUnitVectors($$c,Q0c),this.groundTilt.slerp(W$c,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(R0c){let S0c=N$c.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let T0c=S$c.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(P$c,W$c,Q$c).compose(P$c,W$c,a_c);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(a=>{if(a===this.object||a.isDescendantOf(this.object))return;d_c.makeEmpty(),a.updateMatrixWorldSVD();let b=a.matrixWorldRigid,c=T$c.copy(b).invert(),d=U$c.copy(T$c).multiply(T0c);c_c.copy(this.collider.segment),c_c.start.applyMatrix4(d),c_c.end.applyMatrix4(d);let e=M$c.copy(this.position).applyMatrix4(c);d_c.expandByPoint(c_c.start),d_c.expandByPoint(c_c.end),d_c.min.addScalar(-this.collider.radius),d_c.max.addScalar(this.collider.radius),a.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(a){return a.distanceToPoint(c_c.end)},intersectsBounds:a=>a.intersectsBox(d_c),intersectsTriangle:a=>{let c=P$c,d=Q$c,f=a.closestPointToSegment(c_c,c,d);if(f<this.collider.radius){let g=this.collider.radius-f,h=d.sub(c).normalize(),i=R$c.copy(e);i.addScaledVector(h,g);let j=i.applyMatrix4(b).sub(this.position);S0c.add(j),c_c.start.addScaledVector(h,g),c_c.end.addScaledVector(h,g)}}})}),d_c.makeEmpty(),c_c.copy(this.collider.segment),c_c.start.applyMatrix4(T0c),c_c.end.applyMatrix4(T0c),d_c.expandByPoint(c_c.start),d_c.expandByPoint(c_c.end),d_c.min.addScalar(-this.collider.radius),d_c.max.addScalar(this.collider.radius),this.sharedGameControlGlobals.staticMeshBVH?.shapecast({traverseBoundsOrder(a){return a.distanceToPoint(c_c.end)},intersectsBounds:a=>a.intersectsBox(d_c),intersectsTriangle:a=>{let b=P$c,c=Q$c,d=a.closestPointToSegment(c_c,b,c);if(d<this.collider.radius){let e=this.collider.radius-d,f=c.sub(b).normalize();this.alignToGround&&this.groundTiltAdjustment(f),S0c.addScaledVector(f,e),c_c.start.addScaledVector(f,e),c_c.end.addScaledVector(f,e)}}}),this.onObject=Math.abs(S0c.y)>Math.abs(R0c*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let U0c=Math.max(0,S0c.length()-1e-5);S0c.normalize().multiplyScalar(U0c),this.position.add(S0c)}},V0c=h_c;V0c.isLocked=!1;var W0c=r(u());function X0c(a,b){let c=new nE;if(!a.getAttribute("position"))return c.setAttribute("position",new cE([],3)),c.setIndex([]),c;let{positions:d,triIndices:e}=Zub(a.getAttribute("position"),a.getIndex());return c.setAttribute("position",new cE(d,3)),c.setIndex(e),b&&c.applyMatrix4(b),c}var Y0c=new rs,Z0c=new rs,$0c=[[0,0,0],[0,0,0],[0,0,0]];function _0c(a){let b=a.elements;$0c[0][0]=b[0],$0c[0][1]=b[4],$0c[0][2]=b[8],$0c[1][0]=b[1],$0c[1][1]=b[5],$0c[1][2]=b[9],$0c[2][0]=b[2],$0c[2][1]=b[6],$0c[2][2]=b[10];let{u:c,v:d}=(0,W0c.SVD)($0c),e=Y0c.set(c[0][0],c[0][1],c[0][2],0,c[1][0],c[1][1],c[1][2],0,c[2][0],c[2][1],c[2][2],0,0,0,0,1),f=Z0c.set(d[0][0],d[0][1],d[0][2],0,d[1][0],d[1][1],d[1][2],0,d[2][0],d[2][1],d[2][2],0,0,0,0,1);return e.multiply(f.transpose())}var a1c=class extends Goa{constructor(){super(),this.layers.enable(3),this.layers.enable(8)}setFromCamera(b1c,c1c){c1c.isOrthographicCamera?(this.ray.origin.set(b1c.x,b1c.y,-1).unproject(c1c),this.ray.direction.set(0,0,-1).transformDirection(c1c.matrixWorld),this.camera=c1c):c1c.isPerspectiveCamera?(this.ray.origin.set(b1c.x,b1c.y,-1).unproject(c1c),this.ray.direction.set(b1c.x,b1c.y,.5).unproject(c1c).sub(this.ray.origin).normalize(),this.camera=c1c):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(d1c,e1c=!0,f1c=[]){return d1c.forEach(a=>{a.visible&&this.intersectObject(a,e1c,f1c)}),f1c}createRaycastLineHelper(){let g1c=new JY({color:65280,linewidth:10}),h1c=new fm(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i1c=new fm(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),j1c=this.camera.far-this.camera.near,k1c=new fm().addVectors(h1c,i1c.multiplyScalar(j1c)),l1c=new nE;return l1c.setFromPoints([h1c,k1c]),new RY(l1c,g1c)}},m1c=a=>a instanceof A7b||a instanceof BDc;function n1c(a,b){return a.distance-b.distance}function o1c(a,b,c){if(!(!ZSa(b)||!b.visible))for(let d of(q7b(b)&&b.raycast(a,c),b.children))o1c(a,d,c)}function p1c(a,b,c,d=!1){if(!d&&!c.some(b=>void 0!==s1c(a,b)))return[];let e=[];return b.children.forEach(b=>o1c(a,b,e)),e.sort(n1c),e}function q1c(a){let b=[];if(a.length){let c=a[0].object;ZSa(c)&&b.push(c);let d=c.parent;for(;d;)m1c(d)&&b.push(d),d=d.parent}return b}function r1c(a,b,c,d){let e=a.frame;if(e){let f=b[0]*e.width,g=(1-b[1])*e.height;for(let h of c){let i=h===e.uuid?e:e.find(h);if(i?.intersects(f,g))return d(i),!0}}return!1}function s1c(a,b){if(q7b(b)){if(b.visible){let c=[];return b.raycast(a,c),c.length?c[0]:void 0}}else if(m1c(b))return t1c(a,b)}function t1c(a,b){if(!(!ZSa(b)||!b.visible)){if(q7b(b)){let c=[];if(b.raycast(a,c),c.length)return c[0]}for(let d of b.children){let e=t1c(a,d);if(e)return e}}}var u1c=class{constructor(v1c,w1c,x1c,y1c,z1c,A1c,B1c,C1c){this.renderer=v1c,this.publish=w1c,this.scene=x1c,this.getCamera=y1c,this.sharedAssets=z1c,this.requestRender=A1c,this.isExport=B1c,this.frame=C1c,this.raycaster=new a1c,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents="window"===w1c.mouseEventTarget,this.domElement=v1c.domElement,this.eventElement=this._useWindowEvents?window:v1c.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(D1c){this._useWindowEvents=D1c,this.eventElement=D1c?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(E1c){this._domRect=E1c}get domRect(){return this._domRect}updateRaycaster(F1c){var G1c,H1c,I1c,J1c,K1c,L1c;let{pageX:M1c,pageY:N1c}=F1c.touches?.length>0?F1c.touches[0]:F1c;G1c=M1c,H1c=N1c,I1c=this._domRect,this.pointerWorld={x:(G1c-(I1c.left+window.scrollX))/I1c.width*2-1,y:-(2*((H1c-(I1c.top+window.scrollY))/I1c.height))+1},J1c=M1c,K1c=N1c,L1c=this._domRect,this.pointerScreen={x:(J1c-(L1c.left+window.scrollX))/L1c.width,y:1-(K1c-(L1c.top+window.scrollY))/L1c.height},this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},O1c=class{constructor(P1c){this.eventContext=P1c,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},Q1c=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],R1c=a=>Q1c.find(([b,c])=>c===a)?.[0],S1c=a=>Q1c.find(([b])=>b===a)?.[1],T1c=(a,b)=>{let c=R1c(a);if(c){let d=new CustomEvent(c,{bubbles:!0});return Object.defineProperty(d,"target",{writable:!1,value:b}),d}},U1c=class extends O1c{constructor(V1c){super(V1c),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=a=>{if(!a.eventName||!a.target||"Scroll"===a.eventName)return;let b=this.splineEvents[R1c(a.eventName)]?.[a.target.uuid];if(!b)return;"Scroll"===a.eventName&& void 0!==a.deltaY&&Object.assign(b,{deltaY:a.deltaY});let{domElement:c}=this.eventContext;c.dispatchEvent(b)};let{page:W1c}=this.eventContext;W1c.traverseEntity(a=>{if(a.data?.events.length){for(let[b,c]of Q1c)if(a.data.events.some(a=>a.data.type===c&&!a.data.disabled)){this.objectsPerEvents.has(b)?this.objectsPerEvents.get(b)?.push(a):this.objectsPerEvents.set(b,[a]);let d=T1c(c,{id:a.uuid,name:a.name}),e=this.splineEvents[b];e?e[a.uuid]=d:this.splineEvents[b]={[a.uuid]:d}}}})}connect(){this.objectsPerEvents.forEach(a=>{a.forEach(a=>{a.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(a=>{a.forEach(a=>{a.removeEventListener("beginEvent",this.onBeginEvent)})})}},X1c=class{constructor(Y1c,Z1c,$1c,_1c,a2c,b2c){if(this.id=Y1c,this.data=Z1c,this.object=$1c,this.entered=!1,this.alreadyPlayedNonTogglingActions=new Set,this.useToggle="Toggle"===Z1c.runMode,("KeyDown"===Z1c.type||"KeyUp"===Z1c.type||"KeyPress"===Z1c.type)&&!Z1c.key)throw new Error("Missing property");this.actions=$Zc(Z1c,Z1c.actions,_1c,a2c,b2c,$1c)}disconnect(){_Zc(this.actions)}dispatchHeld(c2c){this.actions.Create.forEach(a=>{c2c&&a.dispatchThrottled.cancel(),a.dispatchThrottled()})}dispatch(d2c=!1){this.actions.Transition.forEach(a=>{a.object.currentTransitionEvent!==this?(a.object.currentTransitionEvent=this,a.init()):"Once"===this.data.runMode&&this.alreadyPlayedNonTogglingActions.add(a)}),this.useToggle?(this.actions.Transition.forEach(a=>{a.toggle()}),this.actions.Animation.forEach(a=>{a.toggle()}),this.actions.SwitchCamera.forEach(a=>{a.toggle()})):"MousePress"===this.data.type||"KeyPress"===this.data.type?this.entered||(this.entered=!0,this.actions.Transition.forEach(a=>a.playFromCurrent()),this.actions.Animation.forEach(a=>a.playFromCurrent()),this.actions.SwitchCamera.forEach(a=>a.playFromCurrent()),this.actions.Create.forEach(a=>a.dispatchStart())):(this.actions.Transition.some(a=>a.playing)||this.actions.Transition.forEach(a=>{!1===this.alreadyPlayedNonTogglingActions.has(a)&&a.play()}),this.actions.SwitchCamera.some(a=>a.playing)||this.actions.SwitchCamera.forEach(a=>{a.play()}),this.actions.Animation.forEach(a=>{a.play()})),this.actions.Link.forEach(a=>{a.dispatch()}),this.actions.SceneTransition.forEach(a=>{a.dispatch()}),!1===d2c&&this.actions.Create.forEach(a=>{a.dispatch()}),this.actions.Destroy.forEach(a=>{a.dispatch()}),this.actions.Reset.forEach(a=>{a.dispatch()}),this.actions.Audio.forEach(a=>{a.dispatchBasic()}),this.actions.Video.forEach(a=>{a.dispatchBasic()}),this.actions.Particles.forEach(a=>{a.dispatchBasic()}),this.actions.SetVariable.forEach(a=>a.checkConditions()),this.actions.SetVariable.forEach(a=>a.dispatch()),this.actions.DynamicVariablePlay.forEach(a=>a.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(a=>a.reverseFromCurrent()),this.actions.Particles.forEach(a=>a.reverseFromCurrent()),this.actions.Animation.forEach(a=>a.reverseFromCurrent()),this.actions.SwitchCamera.forEach(a=>a.reverseFromCurrent()),this.actions.Create.forEach(a=>a.dispatchStop()))}dispatchUserEvent(e2c){this.actions.Transition.forEach(a=>{a.object.currentTransitionEvent!==this&&(a.object.currentTransitionEvent=this,a.init())}),e2c?(this.actions.Transition.forEach(a=>a.reverseFromCurrent()),this.actions.Animation.forEach(a=>a.reverseFromCurrent()),this.actions.SwitchCamera.forEach(a=>a.reverseFromCurrent())):(this.actions.Transition.forEach(a=>a.playFromCurrent()),this.actions.Animation.forEach(a=>a.playFromCurrent()),this.actions.SwitchCamera.forEach(a=>a.playFromCurrent())),this.actions.Link.forEach(a=>{a.dispatch()}),this.actions.SceneTransition.forEach(a=>{a.dispatch()}),this.actions.Create.forEach(a=>{a.dispatch()}),this.actions.Destroy.forEach(a=>{a.dispatch()}),this.actions.Reset.forEach(a=>{a.dispatch()}),this.actions.Audio.forEach(a=>{a.dispatchBasic()}),this.actions.Video.forEach(a=>{a.dispatchBasic()}),this.actions.Particles.forEach(a=>{a.dispatchBasic()}),this.actions.SetVariable.forEach(a=>a.checkConditions()),this.actions.SetVariable.forEach(a=>a.dispatch()),this.actions.DynamicVariablePlay.forEach(a=>a.dispatch())}},f2c=class extends O1c{constructor(g2c,h2c,i2c){super(g2c),this.useForRaycastProperty=i2c,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=a=>{if(!0===this.useForRaycastProperty&&null===this.sceneInterects){this.eventContext.updateRaycaster(a);let{raycaster:b,page:c}=this.eventContext,d=p1c(b,c,[],!0);this.sceneInterects=d,d.length&&(this.eventContext.sharedAssets.raycastProperty={x:d[0].point.x,y:d[0].point.y,z:d[0].point.z,objX:d[0].object.matrixWorld.elements[12],objY:d[0].object.matrixWorld.elements[13],objZ:d[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=a=>{(a.target===this.eventContext.domElement||"SPLINE-VIEWER"===a.target.tagName)&&this.canvasMouseEvents.forEach(b=>{("MouseDown"===b.data.type||"MousePress"===b.data.type)&&(this.onCanvasRaycast(a),b.dispatch())})},this.onCanvasMouseUp=a=>{(a.target===this.eventContext.domElement||"SPLINE-VIEWER"===a.target.tagName)&&this.canvasMouseEvents.forEach(b=>{"MouseUp"===b.data.type?(this.onCanvasRaycast(a),b.dispatch()):"MousePress"===b.data.type&&b.dispatchRelease()})},this.onMouseDown=a=>{Zya.length>1||(this.eventContext.updateRaycaster(a),this.handleMouseEvent("MouseDown"))},this.onMouseUp=a=>{Zya.length>1||(this.eventContext.updateRaycaster(a),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=a=>{Zya.length>1||(this.eventContext.updateRaycaster(a),this.handleMousePressEvent())},this.onMousePressRelease=a=>{Zya.length>1||(this.eventContext.updateRaycaster(a),this.handleMousePressEvent(!0))},this.onKeyDown=a=>{this.heldKeys[a.key]||(this.handleKeyEvent(a,"KeyDown"),this.handleKeyEventHeld(a,"KeyDown",!0)),this.heldKeys[a.key]=!0},this.onKeyUp=a=>{this.handleKeyEvent(a,"KeyUp"),this.handleKeyEventHeld(a,"KeyUp",!0)},this.onKeyPressDown=a=>{this.heldKeysPress[a.key]?this.handleKeyEventHeld(a,"KeyPress"):(this.handleKeyEvent(a,"KeyPress"),this.handleKeyEventHeld(a,"KeyPress",!0)),this.heldKeysPress[a.key]=!0},this.onKeyPressUp=a=>{this.handleKeyEvent(a,"KeyPress",!0)},this.releaseHeldKey=a=>{delete this.heldKeys[a.key]},this.releaseHeldKeyPress=a=>{delete this.heldKeysPress[a.key]},this._onUserEvent=({eventName:a,target:b,reverse:c})=>{if(!a||!b)return;let d=S1c(a);d&&("MouseDown"===d||"MouseUp"===d||"MousePress"===d?(b.dispatchEvent({type:"beginEvent",eventName:d}),this.eventsPerObjects[d]?.[b.uuid]?.forEach(a=>{a.dispatchUserEvent(c)})):("KeyDown"===d||"KeyUp"===d||"KeyPress"===d)&&(b.dispatchEvent({type:"beginEvent",eventName:d}),this.eventsPerObjects[d]?.[b.uuid]?.forEach(a=>{a.dispatchUserEvent()})))};let{page:j2c,sharedAssets:k2c}=this.eventContext,l2c=(a,b)=>{if(!a.data?.events.length)return;let c=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let d of c){let e=this.eventsPerObjects[d];a.data.events.filter(({data:a})=>a.type===d&& !0!==a.disabled).forEach(({id:b,data:c})=>{try{let d=new X1c(b,c,a,j2c,k2c,h2c);d.actions.Video.length&&(this.hasVideoAction=!0),("MouseDown"===c.type||"MouseUp"===c.type||"MousePress"===c.type)&&("Canvas"===c.mode||"Window"===c.mode)?this.canvasMouseEvents.push(d):e[a.uuid]?e[a.uuid].some(a=>a.id===d.id)||e[a.uuid].push(d):e[a.uuid]=[d]}catch(f){}}),e[a.uuid]?.length&&this.objectsPerTypes[d].push(a instanceof Hrc&&("MouseDown"===d||"MouseUp"===d||"MousePress"===d)?b:a)}};j2c.traverseEntity(a=>{(a instanceof jEc||a instanceof aCc)&&a.frame?.traverse(b=>{l2c(b,a)}),l2c(a)})}connect(){let{domElement:m2c}=this.eventContext;this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),m2c.addEventListener("pointerdown",this.onCanvasMouseDown),m2c.addEventListener("pointerup",this.onCanvasMouseUp),(this.objectsPerTypes.MouseDown?.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),m2c.addEventListener("pointerdown",this.onMouseDown)),this.objectsPerTypes.MouseUp?.length&&(this.domEventsNeeded.add("pointerup"),m2c.addEventListener("pointerup",this.onMouseUp)),this.objectsPerTypes.MousePress?.length&&(this.domEventsNeeded.add("pointerdown"),m2c.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),m2c.addEventListener("pointerup",this.onMousePressRelease)),this.objectsPerTypes.KeyDown?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),this.objectsPerTypes.KeyUp?.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),this.objectsPerTypes.KeyPress?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([a,b])=>{b.forEach(a=>{a.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:n2c}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},n2c.removeEventListener("pointerdown",this.onCanvasMouseDown),n2c.removeEventListener("pointerup",this.onCanvasMouseUp),n2c.removeEventListener("pointerdown",this.onMouseDown),n2c.removeEventListener("pointerdown",this.onMousePressDown),n2c.removeEventListener("pointerup",this.onMouseUp),n2c.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(a=>{Object.values(a).forEach(a=>{a.forEach(a=>{a.disconnect()})})}),this.canvasMouseEvents.forEach(a=>{a.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([a,b])=>{b.forEach(a=>{a.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(o2c){let{stopRaycast:p2c,raycaster:q2c,page:r2c,pointerScreen:s2c}=this.eventContext,t2c=this.objectsPerTypes[o2c],u2c=t2c.filter(a=>!(a instanceof Hrc));if(!(!t2c.length&&!this.useForRaycastProperty)&&!(r2c.uiCanvas&&r1c(r2c,[s2c.x,s2c.y],Object.keys(this.eventsPerObjects[o2c]),a=>{this.handleObjectMouseEventDispatch(a,o2c)}))){if(p2c||this.useForRaycastProperty){let v2c;if(null===this.sceneInterects?v2c=p1c(q2c,r2c,u2c,this.useForRaycastProperty):(v2c=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&v2c.length&&(this.eventContext.sharedAssets.raycastProperty={x:v2c[0].point.x,y:v2c[0].point.y,z:v2c[0].point.z,objX:v2c[0].object.matrixWorld.elements[12],objY:v2c[0].object.matrixWorld.elements[13],objZ:v2c[0].object.matrixWorld.elements[14]}),p2c){let w2c=[v2c[0]?.uv?.x??0,v2c[0]?.uv?.y??0];q1c(v2c).forEach(a=>{a instanceof jEc&&r1c(a,w2c,Object.keys(this.eventsPerObjects[o2c]),a=>{this.handleObjectMouseEventDispatch(a,o2c)}),this.eventsPerObjects[o2c][a.uuid]&&this.handleObjectMouseEventDispatch(a,o2c)})}}p2c||u2c.forEach(a=>{let b=s1c(q2c,a);b&&(this.handleObjectMouseEventDispatch(a,o2c),a instanceof jEc&&r1c(a,[b?.uv?.x??0,b?.uv?.y??0],Object.keys(this.eventsPerObjects[o2c]),a=>{this.handleObjectMouseEventDispatch(a,o2c)}))})}}handleMousePressEvent(x2c=!1){let y2c="MousePress",z2c=this.objectsPerTypes[y2c],A2c=z2c.filter(a=>!(a instanceof Hrc)),B2c=[];if(z2c.length){if(!x2c){let{stopRaycast:C2c,raycaster:D2c,page:E2c,pointerScreen:F2c}=this.eventContext,G2c=!1;if(E2c.uiCanvas&&(G2c=r1c(E2c,[F2c.x,F2c.y],Object.keys(this.eventsPerObjects[y2c]),a=>{B2c.push(a)})),C2c&&!G2c){let H2c=p1c(D2c,E2c,A2c);B2c=q1c(H2c),H2c.forEach(a=>{a.object instanceof jEc&&r1c(a.object,[a?.uv?.x??0,a?.uv?.y??0],Object.keys(this.eventsPerObjects[y2c]),a=>{B2c.push(a)})})}else A2c.forEach(a=>{let b=s1c(D2c,a);b&&(B2c.push(a),a instanceof jEc&&r1c(a,[b?.uv?.x??0,b?.uv?.y??0],Object.keys(this.eventsPerObjects[y2c]),a=>{B2c.push(a)}))})}this._prevObjects.length&&this._prevObjects.forEach(a=>{B2c.includes(a)||this.handleObjectMouseEventDispatchRelease(a,y2c)}),B2c.length&&B2c.forEach(a=>{this.handleObjectMouseEventDispatch(a,y2c)}),this._prevObjects=B2c}}handleObjectMouseEventDispatch(I2c,J2c){I2c.dispatchEvent({type:"beginEvent",eventName:J2c}),this.eventsPerObjects[J2c]?.[I2c.uuid]?.forEach(a=>{a.dispatch()})}handleObjectMouseEventDispatchRelease(K2c,L2c){K2c.dispatchEvent({type:"beginEvent",eventName:L2c}),this.eventsPerObjects[L2c]?.[K2c.uuid]?.forEach(a=>{a.dispatchRelease()})}handleKeyEvent(M2c,N2c,O2c=!1){this.objectsPerTypes[N2c].forEach(a=>{let b=this.eventsPerObjects[N2c][a.uuid];b.some(({data:a})=>"key"in a&&a.key===M2c.key)&&a.dispatchEvent({type:"beginEvent",eventName:N2c}),b.forEach(a=>{"key"in a.data&&a.data.key===M2c.key&&(O2c?a.dispatchRelease():a.dispatch(!0))})})}handleKeyEventHeld(P2c,Q2c,R2c=!1){this.objectsPerTypes[Q2c].forEach(a=>{this.eventsPerObjects[Q2c][a.uuid].forEach(a=>{"key"in a.data&&a.data.key===P2c.key&&a.dispatchHeld(R2c)})})}},S2c=new fm,T2c=new fm,U2c=class{constructor(V2c,W2c,X2c,Y2c,Z2c){this.actionsIn=$Zc(V2c,V2c.inActions,X2c,Y2c,Z2c,W2c),this.actionsOut=$Zc(V2c,V2c.outActions,X2c,Y2c,Z2c,W2c)}disconnect(){_Zc(this.actionsIn),_Zc(this.actionsOut)}},$2c=class extends U2c{constructor(_2c,a3c,b3c,c3c,d3c,e3c){super(a3c,b3c,c3c,d3c,e3c),this.id=_2c,this.data=a3c,this.object=b3c,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let a of this.objects)if(!a.visible)return;let b=S2c.setFromMatrixPosition(this.objects[0].matrixWorld),c=T2c.setFromMatrixPosition(this.objects[1].matrixWorld),d=b.distanceTo(c)<=this.distance?"in":"out";if(this.stage!==d){this.stage=d;let e="in"===d?this.actionsIn:this.actionsOut;e.Audio.forEach(a=>a.dispatchConditional()),e.Particles.forEach(a=>a.dispatchConditional()),e.Video.forEach(a=>a.dispatchConditional()),e.Link.forEach(a=>a.dispatch()),e.Create.forEach(a=>a.dispatch()),e.Destroy.forEach(a=>a.dispatch()),e.Reset.forEach(a=>a.dispatch()),e.Transition.forEach(a=>{a.object.currentTransitionEvent!==this&&(a.object.currentTransitionEvent=this),a.init()}),e.Transition.forEach(a=>a.play()),e.Animation.forEach(a=>a.play()),e.SwitchCamera.forEach(a=>a.play()),e.SceneTransition.forEach(a=>a.dispatch()),e.SetVariable.forEach(a=>a.checkConditions()),e.SetVariable.forEach(a=>a.dispatch()),e.DynamicVariablePlay.forEach(a=>a.dispatch())}};let{distance:f3c,fromObject:g3c,toObject:h3c}=a3c.condition;for(let i3c of(this.distance=f3c,[g3c,h3c])){if(!i3c)throw new Error("Missing property");let j3c=c3c.find(i3c);if(!j3c)throw new Error("Missing property");this.objects.push(j3c)}}connect(){window.setTimeout(()=>{this.objects.forEach(a=>{a.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(a=>{a.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},k3c=class extends U2c{constructor(l3c,m3c,n3c,o3c,p3c,q3c){super(m3c,n3c,o3c,p3c,q3c),this.id=l3c,this.data=m3c,this.object=n3c,this.onBegin=({target:a,state:b})=>{this.toState!==b&&(this.actionsOut.Audio.forEach(a=>a.dispatchConditional()),this.actionsOut.Particles.forEach(a=>a.dispatchConditional()),this.actionsOut.Video.forEach(a=>a.dispatchConditional()),this.actionsOut.Link.forEach(a=>a.dispatch()),this.actionsOut.Create.forEach(a=>a.dispatch()),this.actionsOut.Destroy.forEach(a=>a.dispatch()),this.actionsOut.Reset.forEach(a=>a.dispatch()),this.actionsIn.Transition.forEach(a=>a.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(a=>a.play()),this.actionsOut.Animation.forEach(a=>a.play()),this.actionsIn.SwitchCamera.forEach(a=>a.pause()),this.actionsOut.SwitchCamera.forEach(a=>a.play()),this.actionsOut.SceneTransition.forEach(a=>a.dispatch()),this.actionsOut.SetVariable.forEach(a=>a.checkConditions()),this.actionsOut.SetVariable.forEach(a=>a.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(a=>a.dispatch()))},this.onComplete=({target:a,state:b})=>{this.toState===b&&(this.actionsIn.Audio.forEach(a=>a.dispatchConditional()),this.actionsIn.Particles.forEach(a=>a.dispatchConditional()),this.actionsIn.Video.forEach(a=>a.dispatchConditional()),this.actionsIn.Link.forEach(a=>a.dispatch()),this.actionsIn.Create.forEach(a=>a.dispatch()),this.actionsIn.Destroy.forEach(a=>a.dispatch()),this.actionsIn.Reset.forEach(a=>a.dispatch()),this.actionsOut.Transition.forEach(a=>a.pause()),this.actionsOut.Transition.forEach(a=>a.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(a=>a.play()),this.actionsIn.Animation.forEach(a=>a.play()),this.actionsOut.SwitchCamera.forEach(a=>a.pause()),this.actionsIn.SwitchCamera.forEach(a=>a.play()),this.actionsIn.SceneTransition.forEach(a=>a.dispatch()),this.actionsIn.SetVariable.forEach(a=>a.checkConditions()),this.actionsIn.SetVariable.forEach(a=>a.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(a=>a.dispatch()))};let{condition:r3c}=m3c;if(!r3c.object)throw new Error("Missing property");let s3c=o3c.find(r3c.object)??o3c.scene.find2D(r3c.object);if(!s3c)throw new Error("Missing property");if(this.toObject=s3c,r3c.state&&!this.toObject.states?.[r3c.state])throw new Error("Missing property");this.toState=r3c.state}connect(){awa(this.actionsOut).forEach(a=>{this.actionsOut[a]?.length&&this.toObject.addEventListener("beginState",this.onBegin)}),awa(this.actionsIn).forEach(a=>{this.actionsIn[a]?.length&&this.toObject.addEventListener("completeState",this.onComplete)})}disconnect(){super.disconnect(),awa(this.actionsOut).forEach(a=>{this.actionsIn[a]?.length&&this.toObject.removeEventListener("beginState",this.onBegin)}),awa(this.actionsIn).forEach(a=>{this.actionsIn[a]?.length&&this.toObject.removeEventListener("completeState",this.onComplete)})}},t3c=class extends O1c{constructor(u3c,v3c){super(u3c),this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1;let{page:w3c,sharedAssets:x3c}=this.eventContext;w3c.traverseEntity(a=>{if(a.data?.events.length){for(let{id:b,data:c}of a.data.events)if(!c.disabled&&"Conditional"===c.type)try{let d;"Comparison"===c.condition.type||("Distance"===c.condition.type?d=new $2c(b,c,a,w3c,x3c,v3c):"State"===c.condition.type&&(d=new k3c(b,c,a,w3c,x3c,v3c))),d&&(this.eventsPerConditions[c.condition.type].push(d),(d.actionsIn.Video.length||d.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch(e){}}})}connect(){super.connect(),Object.values(this.eventsPerConditions).forEach(a=>a.forEach(a=>a.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(a=>a.forEach(a=>a.disconnect()))}},y3c=new fm,z3c=new fm,A3c=new fm,B3c=new jL,C3c=new fm,D3c=new fm,E3c=new fm,F3c=new Fj,G3c=new Ex,H3c=new rs,I3c=new Rc,J3c=new fm,K3c=new fm;function L3c(a,b){!b||(b[0]<b[1]&&(a.x=Math.min(Math.max(a.x,b[0]),b[1])),b[2]<b[3]&&(a.y=Math.min(Math.max(a.y,b[2]),b[3])),b[4]<b[5]&&(a.z=Math.min(Math.max(a.z,b[4]),b[5])))}let M3c;var N3c=(M3c=new rs,(a,b,c)=>{let d=a.obj;M3c.copy(d.hiddenMatrix),null!==d.parent&&M3c.premultiply(d.parent.matrixWorld),M3c.invert(),d.position.copy(b),"global"===a.reference&&L3c(d.position,a.limits),d.position.applyMatrix4(M3c),"parent"===a.reference?L3c(d.position,a.limits):"local"===a.reference&&(F3c.copy(a.quat0).invert(),d.position.sub(a.position0),d.position.applyQuaternion(F3c),L3c(d.position,a.limits),F3c.invert(),d.position.applyQuaternion(F3c),d.position.add(a.position0)),M3c.multiply(c??d.matrixWorld).decompose(C3c,d.quaternion,D3c),d.updateMatrix(),d.hasNonUniformScale&&(d.updateMatrixWorld(),d.updateMatrixWorldSVD()),d instanceof Bvb&&r7b(d.parent)&&d.invalidateDownstreamBooleanData(!0)}),O3c=class{constructor(P3c,Q3c,R3c,S3c,T3c,U3c){this.object=P3c,this.data=Q3c,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=0===this.data.resetSpeed?1:8/this.data.resetSpeed+1,this.snapDampingFactor=0===this.data.snapSpeed?1:8/this.data.snapSpeed+1,this.actionsDrag=$Zc(Q3c,Q3c.dragDropActions.drag,R3c,S3c,T3c,this.object),this.actionsDrop=$Zc(Q3c,Q3c.dragDropActions.drop,R3c,S3c,T3c,this.object);let V3c=[];this.data.objects.forEach(a=>{let b=R3c.find(a);!b|| !1!==b.data.visible&&(V3c.push(b),U3c[b.uuid]&&U3c[b.uuid].forEach(a=>{let b=R3c.find(a);b&& !1!==b.data.visible&&V3c.push(b)}))}),this.data.dropDestinations.forEach(a=>{let b=R3c.find(a);!b|| !1!==b.data.visible&&(this.dropDestIds.push(b.uuid),U3c[b.uuid]&&U3c[b.uuid].forEach(a=>{let b=R3c.find(a);b&& !1!==b.data.visible&&this.dropDestIds.push(b.uuid)}))}),this.dragItems=V3c.map(a=>("locked"===this.data.planeMode&&(a.userData.lockedPlane=!0),a.userData.worldPosition0=new fm().setFromMatrixPosition(a.matrixWorld),{obj:a,fromPosition:new fm().setFromMatrixPosition(a.matrixWorld),pointStart:new fm,pointEnd:new fm,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new fm().copy(a.position),quat0:new Fj().copy(a.quaternion),snapped:!1,orientationMatrix:new rs,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return null!==this.activeIdx?this.dragItems[this.activeIdx]:null}dispose(){_Zc(this.actionsDrag),_Zc(this.actionsDrop),this.dragItems.forEach(a=>{a.fromPosition.copy(a.obj.userData.worldPosition0),a.pointStart.copy(a.fromPosition),a.pointEnd.copy(a.pointStart),a.obj.recursiveBBoxNeedsUpdate=!0,a.obj.userData.lockedPlane=void 0,a.obj.position.copy(a.position0),a.obj.quaternion.copy(a.quat0),a.obj.updateMatrix()})}},W3c=class extends O1c{constructor(X3c,Y3c){super(X3c),this.eventManager=Y3c,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=a=>{if(Zya.length>1)return;this.eventContext.updateRaycaster(a);let{raycaster:b,page:c}=this.eventContext,d=c.raycastWithClones(b);if(this.lastDropDestination=null,0===d.length){this.activeEvent=null;return}for(let e of this.events){let f=0;for(let{obj:g,pointEnd:h,pointStart:i}of e.dragItems){if(g===d[0].object||g===d[0].object.object||Fsb.is(g)&&g.isAncestorOf(d[0].object.uuid)){if(e.activeIdx=f,e.activeDragItem.reset=!1,e.activeDragItem.currentDampingFactor=e.data.dampingFactor,e.activeDragItem.snapped=!1,"hand"===e.data.cursor&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){e.activeDragItem.obj.rigidBody&&e.activeDragItem.obj.rigidBody.setBodyType(2,!0);let j=e.activeDragItem.obj;g.hasNonUniformScale&&g.updateMatrixWorldSVD(),(j.hasNonUniformScale?j.matrixWorldRigid:j.matrixWorld).decompose(C3c,F3c,D3c),G3c.setFromQuaternion(F3c),void 0===j.prevR?(j.prevR=G3c.clone(),j.prevT=C3c.clone()):(j.prevR.copy(G3c),j.prevT.copy(C3c)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(e.activeDragItem.obj)}this.calcPlaneIntersectPos(g,i,e.data.plane,e.data.referenceFrame),h.copy(i),(this.eventManager.controlsManager.usePhysics&&g.data.physics?.rigidBody==="dynamic"|| !1===e.data.drop|| !1===e.data.resetOnSnapFail)&&e.activeDragItem.fromPosition.setFromMatrixPosition(e.activeDragItem.obj.matrixWorld),this.activeEvent=e,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}f++}}this.activeEvent=null},this.onPointerMove=a=>{if(Zya.length>1)return;this.eventContext.updateRaycaster(a);let{raycaster:b,page:c}=this.eventContext,d=c.raycastWithClones(b);if(0===Zya.length){let e=!1;for(let f of this.events){for(let{obj:g}of f.dragItems)if(g===d[0]?.object||g===d[0]?.object?.object||Fsb.is(g)&&g.isAncestorOf(d[0]?.object.uuid)){switch(e=!0,f.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break;default:break}break}if(e)break}e||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let h=this.activeEvent.activeDragItem;h.snapped=!1;let i;if(this.activeEvent.data.drop&&(i=d.filter(a=>h.obj!==a.object&&!h.obj.isAncestorOf(a.object.uuid)&&!(a.object instanceof A7b)&&("all"===this.activeEvent.data.dropOn||this.activeEvent.dropDestIds.some(b=>b===a.object.uuid||c.scene.find(b).isAncestorOf(a.object.uuid))))[0]),i){let j=E3c.copy(i.face.normal).applyMatrix3(I3c.getNormalMatrix(i.object.matrixWorld));if("center"===this.activeEvent.data.snapTo)h.fromPosition.setFromMatrixPosition(i.object.matrixWorld);else if("surface"===this.activeEvent.data.snapTo){if(h.fromPosition.copy(i.point),"bbox"===this.activeEvent.data.snapSurfaceMode){C3c.copy(j).applyMatrix3(I3c.setFromMatrix4(h.obj.matrixWorld).transpose());let k=h.obj;C3c.x>.2?D3c.x=-k.recursiveBBox.min.x:C3c.x< -0.2&&(D3c.x=-k.recursiveBBox.max.x),C3c.y>.2?D3c.y=-k.recursiveBBox.min.y:C3c.y< -0.2&&(D3c.y=-k.recursiveBBox.max.y),C3c.z>.2?D3c.z=-k.recursiveBBox.min.z:C3c.z< -0.2&&(D3c.z=-k.recursiveBBox.max.z),D3c.applyMatrix3(I3c.invert())}else D3c.copy(j).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);h.fromPosition.add(D3c)}this.activeEvent.data.autoOrient&&(C3c.set(0,1,0).cross(j),1e-4>C3c.length()&&C3c.set(-1,0,0).cross(j),D3c.crossVectors(E3c,C3c),h.orientationMatrix.makeBasis(C3c,D3c,j)),h.pointStart.copy(h.fromPosition),h.pointEnd.copy(h.pointStart),h.currentDampingFactor=this.activeEvent.snapDampingFactor,h.snapped=!0,this.lastDropDestination!==i.object&&(this.lastDropDestination=i.object,this.activeEvent.actionsDrop.Transition.forEach(a=>{a.play()}),this.activeEvent.actionsDrop.Animation.forEach(a=>{a.play()}),this.activeEvent.actionsDrop.Audio.forEach(a=>{a.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Particles.forEach(a=>{a.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(a=>{a.dispatchThrottled()}))}else h.orientationMatrix.makeRotationFromQuaternion(h.quat0),this.lastDropDestination=null,h.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(h.obj,h.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(a=>{a.stop(),null!==a.object.currentState&&a.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(a=>{a.stop()}),this.activeEvent.actionsDrop.Audio.forEach(a=>{a.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.Particles.forEach(a=>{a.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(a=>{a.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(a=>a.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(a=>a.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(a=>a.dispatch()),!1===this.activeEvent.wasDragEventTriggered&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(a=>{a.play()}),this.activeEvent.actionsDrag.Animation.forEach(a=>{a.play()}),this.activeEvent.actionsDrag.Audio.forEach(a=>{a.dispatchGameControl("start")}),this.activeEvent.actionsDrag.Particles.forEach(a=>{a.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{this.activeEvent&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(a=>{a.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(a=>{a.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(a=>{a.stop(),null!==a.object.currentState&&a.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(a=>{a.stop()}))},500),this.updateDragItem(h),h.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=a=>{if(this.activeEvent&&this.activeEvent.activeDragItem){"hand"===this.activeEvent.data.cursor&&this.setCursor("grab");let b=this.activeEvent.activeDragItem.obj.data.physics?.rigidBody==="dynamic";!1===this.activeEvent.activeDragItem.snapped&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(!1===this.eventManager.controlsManager.usePhysics||!b)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&b&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),!0===this.activeEvent.wasDragEventTriggered&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(a=>{a.stop(),null!==a.object.currentState&&a.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(a=>{a.stop()}),this.activeEvent.actionsDrag.Audio.forEach(a=>{a.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(a=>{a.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(a=>a.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(a=>a.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(a=>a.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}};let Z3c={};X3c.page.traverseEntity(a=>{a.component&&(Z3c[a.component.uuid]?Z3c[a.component.uuid].push(a.uuid):Z3c[a.component.uuid]=[a.uuid])}),X3c.page.traverseEntity(a=>{a.data?.events.filter(a=>"DragDrop"===a.data.type&&!a.data.disabled).forEach(b=>{this.events.push(new O3c(a,b.data,X3c.page,X3c.sharedAssets,Y3c,Z3c))})})}connect(){if(!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let $3c=this.eventContext.domElement;$3c.addEventListener("pointerdown",this.onPointerDown),$3c.addEventListener("pointermove",this.onPointerMove),$3c.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let _3c=this.eventContext.domElement;_3c.removeEventListener("pointerdown",this.onPointerDown),_3c.removeEventListener("pointermove",this.onPointerMove),_3c.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(a=>a.dispose())}setCursor(a4c){this.eventContext.domElement.style.cursor=a4c}onAnimationFrameDamping(){for(let b4c of this.events)for(let c4c of b4c.dragItems)c4c.paused||this.updateDragItem(c4c,!0)}calcPlaneIntersectPos(d4c,e4c,f4c,g4c){let{getCamera:h4c,raycaster:i4c}=this.eventContext;h4c().getWorldDirection(z3c),z3c.negate();let j4c=F3c.identity();switch("parent"===g4c?H3c.multiplyMatrices(d4c.parent.matrixWorld,d4c.hiddenMatrix).decompose(C3c,j4c,D3c):"local"===g4c&&d4c.matrixWorld.decompose(C3c,j4c,D3c),f4c){case"x":C3c.set(1,0,0).applyQuaternion(j4c),J3c.copy(z3c).cross(C3c),K3c.copy(C3c).cross(J3c);break;case"y":C3c.set(0,1,0).applyQuaternion(j4c),J3c.copy(z3c).cross(C3c),K3c.copy(C3c).cross(J3c);break;case"z":C3c.set(0,0,1).applyQuaternion(j4c),J3c.copy(z3c).cross(C3c),K3c.copy(C3c).cross(J3c);break;case"xy":K3c.set(0,0,1).applyQuaternion(j4c);break;case"yz":K3c.set(1,0,0).applyQuaternion(j4c);break;case"xz":K3c.set(0,1,0).applyQuaternion(j4c);break;case"adaptive":z3c.angleTo(D3c.set(0,1,0))>Math.PI/6?(C3c.crossVectors(D3c.set(0,1,0),z3c),K3c.crossVectors(C3c,D3c)):K3c.set(0,1,0);break;default:K3c.copy(z3c);break}A3c.setFromMatrixPosition(d4c.matrixWorld);let k4c=d4c.userData.lockedPlane?d4c.userData.worldPosition0:A3c;if(B3c.setFromNormalAndCoplanarPoint(K3c,k4c),i4c.ray.intersectPlane(B3c,e4c)&&("x"===f4c||"y"===f4c||"z"===f4c)){let l4c=D3c.subVectors(e4c,k4c).dot(C3c);e4c.copy(k4c).addScaledVector(C3c,l4c)}}updateDragItem(m4c,n4c=!1){A3c.setFromMatrixPosition(m4c.obj.matrixWorld),"current"===m4c.reset?y3c.subVectors(m4c.fromPosition,A3c).divideScalar(m4c.currentDampingFactor):"original"===m4c.reset?(y3c.subVectors(m4c.obj.userData.worldPosition0,A3c).divideScalar(m4c.currentDampingFactor),m4c.fromPosition.copy(m4c.obj.userData.worldPosition0),m4c.pointStart.copy(m4c.fromPosition),m4c.pointEnd.copy(m4c.pointStart)):y3c.subVectors(m4c.pointEnd,m4c.pointStart).add(m4c.fromPosition).sub(A3c).divideScalar(m4c.currentDampingFactor),m4c.paused=!(m4c.currentDampingFactor>1)||.01>y3c.length(),(this.activeEvent&&1===this.activeEvent.data.dampingFactor||n4c)&&N3c(m4c,y3c.add(A3c),this.activeEvent?.data.drop&&this.activeEvent?.data.autoOrient?m4c.orientationMatrix:null),m4c.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}};let o4c,p4c,q4c;var r4c=new fm,s4c=new fm,t4c=new fm,u4c=new fm,v4c=new jL,w4c={type:"requestRender"},x4c=(o4c=new fm,p4c=new fm,(a,b,c)=>c>0?(o4c.subVectors(a,b),o4c.length()<=c?a:p4c.copy(b).add(o4c.normalize().multiplyScalar(c))):b),y4c=(q4c=new rs,(a,b)=>{a.position.copy(b),null!==a.parent&&(q4c.copy(a.parent.matrixWorld).invert(),a.position.applyMatrix4(q4c)),q4c.copy(a.hiddenMatrix).invert(),a.position.applyMatrix4(q4c),a.updateMatrix(),a.hasNonUniformScale&&(a.updateMatrixWorld(),a.updateMatrixWorldSVD()),a instanceof Bvb&&r7b(a.parent)&&a.invalidateDownstreamBooleanData(!0)}),z4c=class{constructor(A4c,B4c,C4c,D4c,E4c){this.data=A4c,this.object=B4c,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new fm,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...mJa.defaultData,...A4c,...void 0===A4c.resetOnPointerLeave&&{resetOnPointerLeave:!1}},void 0===A4c.target||"cursor"===A4c.target||(this.target=C4c.find(A4c.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=$Zc(A4c,A4c.actions,C4c,D4c,E4c,B4c)}},F4c=class extends O1c{constructor(G4c,H4c){super(G4c),this.events=[],this.pairOfEventListeners=[],this.onMouseMove=a=>{if(!(Zya.length>1))for(let b of(this.eventContext.updateRaycaster(a),this.events))void 0===b.target&&this.updateSingleEvent(b)},this.onMouseEnter=a=>{for(let b of this.events)void 0===b.target&&(b.isReset=!1,b.currentDampingFactor=b.data.dampingFactor)},this.onMouseLeave=a=>{for(let b of this.events)void 0===b.target&&(b.data.resetOnPointerLeave&&(b.isReset=!0,b.currentDampingFactor=b.resetDampingFactor),this.updateSingleEvent(b))},this.onTargetChange=a=>()=>{this.updateSingleEvent(a)};let{page:I4c}=this.eventContext;I4c.traverseEntity(a=>{let b=a.data?.events.find(a=>"Follow"===a.data.type&&!a.data.disabled);b&&(!I4c.data.globalPhysics.usePhysics||a.dataPatched.physics?.rigidBody!=="dynamic")&&this.events.push(new z4c(b.data,a,I4c,G4c.sharedAssets,H4c))})}connect(){if(!this.events.length)return;let{domElement:J4c,eventElement:K4c}=this.eventContext;for(let L4c of(this.domEventsNeeded.clear(),Tya&&(this.domEventsNeeded.add("pointerdown"),J4c.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),K4c.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(J4c.addEventListener("pointerenter",this.onMouseEnter),J4c.addEventListener("pointerleave",this.onMouseLeave)),this.events))if(void 0!==L4c.target){let M4c=L4c.target,N4c=this.onTargetChange(L4c);this.pairOfEventListeners.push([M4c,N4c]),M4c.addEventListener("requestRender",N4c)}}disconnect(){if(!this.events.length)return;let{domElement:O4c,eventElement:P4c}=this.eventContext;for(let[Q4c,R4c]of(this.domEventsNeeded.clear(),Tya&&O4c.removeEventListener("pointerdown",this.onMouseMove),P4c.removeEventListener("pointermove",this.onMouseMove),O4c.removeEventListener("pointerenter",this.onMouseEnter),O4c.removeEventListener("pointerleave",this.onMouseLeave),this.pairOfEventListeners))Q4c.removeEventListener("requestRender",R4c);for(let S4c of this.events)S4c.paused=!0,S4c.isReset=!1,_Zc(S4c.actions)}onAnimationFrameDamping(){for(let T4c of this.events)T4c.paused||this.updateSingleEvent(T4c,!0)}updateSingleEvent(U4c,V4c=!1){this.events.forEach(a=>{a.actions.Create.forEach(a=>{a.dispatchThrottled()})});let{plane:W4c,limitDistance:X4c,limitDistanceEnabled:Y4c}=U4c.data;if(U4c.object.getWorldPosition(t4c),U4c.isReset)u4c.copy(U4c.worldPosition0);else if(U4c.target)U4c.target.getWorldPosition(u4c);else{let{getCamera:Z4c,raycaster:$4c}=this.eventContext;if("custom"===W4c?(Z4c().getWorldDirection(s4c),s4c.negate(),r4c.copy(s4c)):"xy"===W4c?r4c.set(0,0,1):"xz"===W4c?r4c.set(0,1,0):"yz"===W4c&&r4c.set(1,0,0),v4c.setFromNormalAndCoplanarPoint(r4c,t4c),!$4c.ray.intersectPlane(v4c,u4c))return}if(!U4c.isReset){if(u4c.distanceTo(U4c.worldPosition0)>X4c&&Y4c&&U4c.target)if(U4c.snapComplete=!1,U4c.data.snapDelay&&(U4c.delayFinished=!1,"u">typeof window&&null!==U4c.timeoutId&&(window.clearTimeout(U4c.timeoutId),U4c.timeoutId=null)),U4c.wasOutside=!0,!U4c.data.resetAfterDistanceLimit)return;else u4c.copy(U4c.worldPosition0),U4c.currentDampingFactor=U4c.resetDampingFactor;else if(U4c.wasOutside&&(U4c.data.snapDelay&&"u">typeof window&&(U4c.timeoutId=window.setTimeout(()=>{U4c.delayFinished=!0,U4c.paused=!1,this.updateSingleEvent(U4c)},1e3*U4c.data.snapDelay)),U4c.currentDampingFactor=U4c.data.dampingFactor,U4c.wasOutside=!1),!1===U4c.delayFinished)return}!1===U4c.data.enabledTranslation[0]&&(u4c.x=t4c.x),!1===U4c.data.enabledTranslation[1]&&(u4c.y=t4c.y),!1===U4c.data.enabledTranslation[2]&&(u4c.z=t4c.z);let _4c=x4c(t4c,u4c,U4c.wasOutside?0:U4c.data.maxDelta);if(U4c.currentDampingFactor>1){let a5c=r4c.subVectors(_4c,t4c).divideScalar(U4c.currentDampingFactor);t4c.add(a5c),V4c&&y4c(U4c.object,t4c),U4c.paused=.01>a5c.length()}else y4c(U4c.object,_4c),U4c.paused=!0;U4c.object?.dispatchEvent({type:"beginEvent",eventName:"Follow"}),U4c.object.dispatchEvent(w4c)}};let b5c;var c5c=new fm,d5c=new fm,e5c=new rs,f5c=new Fj,g5c=new Fj,h5c=new fm,i5c=new fm,j5c=new fm,k5c=new fm,l5c=new jL,m5c={type:"requestRender"},n5c={type:"changeRotation"},o5c=(b5c=new rs,function(a,b){null!==a.parent?b5c.multiplyMatrices(a.parent.matrixWorld,a.hiddenMatrix):b5c.copy(a.hiddenMatrix),b.premultiply(_0c(b5c).invert()),a.rotation.setFromRotationMatrix(b),a.updateMatrix(),a instanceof Bvb&&r7b(a.parent)&&a.invalidateDownstreamBooleanData(!0)}),p5c=class{constructor(q5c,r5c,s5c){this.object=r5c,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new Fj,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...nJa.defaultData,...q5c,...void 0===q5c.resetOnPointerLeave&&{resetOnPointerLeave:!1}},void 0===q5c.target||"cursor"===q5c.target||(this.target=s5c.find(q5c.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},t5c=class extends O1c{constructor(u5c){super(u5c),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=a=>{if(!(Zya.length>1))for(let b of(this._lastMouseEvent=a,this.eventContext.updateRaycaster(a),this.events))void 0===b.target&&this.updateSingleEvent(b)},this.onMouseEnter=a=>{for(let b of this.events)void 0===b.target&&(b.isReset=!1,b.currentDampingFactor=b.data.dampingFactor)},this.onMouseLeave=a=>{for(let b of this.events)void 0===b.target&&(b.data.resetOnPointerLeave&&(b.isReset=!0,b.currentDampingFactor=b.resetDampingFactor),this.updateSingleEvent(b))},this.onScroll=a=>{if(this._lastMouseEvent){let b=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(b)}},this.onTargetChange=a=>()=>{this.updateSingleEvent(a)},this.createUserEventListener=a=>({eventName:b,target:c})=>{if(!b||!c)return;let d=S1c(b);d&&"LookAt"===d&&this.updateSingleEvent(a)};let{page:v5c}=this.eventContext;v5c.traverseEntity(a=>{let b=a.data?.events.find(a=>"LookAt"===a.data.type&&!a.data.disabled);b&&(!v5c.data.globalPhysics.usePhysics||a.dataPatched.physics?.rigidBody!=="dynamic")&&this.events.push(new p5c(b.data,a,v5c))})}connect(){if(!this.events.length)return;let{domElement:w5c,eventElement:x5c}=this.eventContext;for(let y5c of(this.domEventsNeeded.clear(),Tya&&(this.domEventsNeeded.add("pointerdown"),w5c.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),x5c.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?x5c.addEventListener("scroll",this.onScroll):(w5c.addEventListener("pointerenter",this.onMouseEnter),w5c.addEventListener("pointerleave",this.onMouseLeave)),this.events)){if(void 0!==y5c.target){let z5c=this.onTargetChange(y5c),A5c=y5c.target;this.pairOfEventListeners.push([A5c,z5c]),A5c.addEventListener("requestRender",z5c)}let B5c=this.createUserEventListener(y5c),C5c=y5c.object;this.pairOfUserEventListeners.push([C5c,B5c]),C5c.addEventListener("userEvent",B5c)}}disconnect(){if(!this.events.length)return;let{domElement:D5c,eventElement:E5c}=this.eventContext;for(let[F5c,G5c]of(this.domEventsNeeded.clear(),Tya&&D5c.removeEventListener("pointerdown",this.onMouseMove),E5c.removeEventListener("pointermove",this.onMouseMove),D5c.removeEventListener("pointerenter",this.onMouseEnter),D5c.removeEventListener("pointerleave",this.onMouseLeave),E5c.removeEventListener("scroll",this.onScroll),this.pairOfEventListeners))F5c.removeEventListener("requestRender",G5c);for(let[H5c,I5c]of this.pairOfUserEventListeners)H5c.removeEventListener("userEvent",I5c);for(let J5c of this.events)J5c.paused=!0,J5c.isReset=!1}onAnimationFrameDamping(){for(let K5c of this.events)K5c.paused||this.updateSingleEvent(K5c)}updateSingleEvent(L5c){let{tilt:M5c,axis:N5c,distance:O5c,plane:P5c,limitDistance:Q5c,enabledRotation:R5c,limitDistanceEnabled:S5c}=L5c.data,{getCamera:T5c,raycaster:U5c}=this.eventContext,{object:V5c,target:W5c}=L5c;if(V5c.getWorldPosition(h5c),!L5c.isReset)if(L5c.target)L5c.target.getWorldPosition(i5c);else{if("custom"===P5c?(T5c().getWorldDirection(d5c),d5c.negate(),l5c.setFromNormalAndCoplanarPoint(d5c,h5c)):("xy"===P5c?c5c.set(0,0,1):"xz"===P5c?c5c.set(0,1,0):"yz"===P5c&&c5c.set(1,0,0),l5c.setFromNormalAndCoplanarPoint(c5c,h5c)),!U5c.ray.intersectPlane(l5c,i5c))return;O5c>0&&("custom"===P5c|| void 0===P5c)&&i5c.addScaledVector(d5c,O5c)}if(L5c.isReset||(W5c?"target"===M5c?j5c.copy(W5c.up).applyMatrix4(e5c.extractRotation(W5c.matrixWorld)).normalize():R5c.some(a=>!1===a)?("x"===N5c?(k5c.set(0,0,1),!1===R5c[2]&&k5c.set(0,1,0)):"y"===N5c?(k5c.set(1,0,0),!1===R5c[0]&&k5c.set(0,0,1)):(k5c.set(0,1,0),!1===R5c[1]&&k5c.set(1,0,0)),j5c.copy(k5c).applyQuaternion(L5c.worldQuaternion0).normalize()):j5c.set(0,1,0):"custom"===P5c?j5c.set(0,1,0):j5c.copy(c5c)),L5c.isReset)g5c.copy(L5c.worldQuaternion0);else if(h5c.distanceTo(i5c)>Q5c&&S5c&&W5c)if(L5c.data.snapDelay&&(L5c.delayFinished=!1,"u">typeof window&&null!==L5c.timeoutId&&(window.clearTimeout(L5c.timeoutId),L5c.timeoutId=null)),L5c.wasOutside=!0,!L5c.data.resetAfterDistanceLimit)return;else g5c.copy(L5c.worldQuaternion0),L5c.currentDampingFactor=L5c.resetDampingFactor;else{if(L5c.wasOutside&&(L5c.data.snapDelay&&"u">typeof window&&(L5c.timeoutId=window.setTimeout(()=>{L5c.delayFinished=!0,L5c.paused=!1,this.updateSingleEvent(L5c)},1e3*L5c.data.snapDelay)),L5c.currentDampingFactor=L5c.data.dampingFactor,L5c.wasOutside=!1),!1===L5c.delayFinished)return;$5c(e5c,i5c,h5c,j5c,N5c,k5c),g5c.setFromRotationMatrix(e5c),f5c.setFromUnitVectors(k5c.applyQuaternion(g5c),j5c),R5c.some(a=>!1===a)&&"target"!==M5c&&g5c.premultiply(f5c).normalize()}L5c.currentDampingFactor>1?(V5c.updateWorldMatrix(!0,!1),f5c.setFromRotationMatrix(_0c(V5c.matrixWorld)),f5c.slerp(g5c,1/L5c.currentDampingFactor),o5c(V5c,e5c.makeRotationFromQuaternion(f5c)),L5c.paused=8*(1-f5c.dot(g5c))<1e-6):(o5c(V5c,e5c.makeRotationFromQuaternion(g5c)),L5c.paused=!0),L5c.object?.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),V5c.dispatchEvent(m5c),V5c.dispatchEvent(n5c)}},X5c=new fm,Y5c=new fm,Z5c=new fm;function $5c(a,b,c,d,e,f){let g=a.elements;Z5c.subVectors(b,c),0===Z5c.lengthSq()&&(Z5c.z=1),Z5c.normalize(),Y5c.crossVectors(d,Z5c),0===Y5c.lengthSq()&&(1===Math.abs(d.z)?Z5c.x+=1e-4:Z5c.z+=1e-4,Z5c.normalize(),Y5c.crossVectors(d,Z5c)),Y5c.normalize(),X5c.crossVectors(Z5c,Y5c),"x"===e?1===f.z?[Y5c,X5c,Z5c]=[Z5c,Y5c,X5c]:(Y5c.negate(),[Y5c,Z5c]=[Z5c,Y5c]):"y"===e?1===f.x?[Y5c,X5c,Z5c]=[X5c,Z5c,Y5c]:(Y5c.negate(),[X5c,Z5c]=[Z5c,X5c]):1===f.x&&(Y5c.negate(),[Y5c,X5c]=[X5c,Y5c]),g[0]=Y5c.x,g[4]=X5c.x,g[8]=Z5c.x,g[1]=Y5c.y,g[5]=X5c.y,g[9]=Z5c.y,g[2]=Y5c.z,g[6]=X5c.z,g[10]=Z5c.z}var _5c=class{constructor(a6c,b6c,c6c,d6c,e6c,f6c){this.id=a6c,this.data=b6c,this.object=c6c,this.entered=!1,this.actions=$Zc(b6c,b6c.actions,d6c,e6c,f6c,c6c)}disconnect(){_Zc(this.actions)}dispatchEnter(){this.actions.Transition.forEach(a=>{a.object.currentTransitionEvent!==this&&(a.object.currentTransitionEvent=this,a.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(a=>a.playFromCurrent()),this.actions.Animation.forEach(a=>a.play()),this.actions.Create.forEach(a=>a.dispatch()),this.actions.Particles.forEach(a=>a.dispatchBasic()),this.actions.Destroy.forEach(a=>a.dispatch()),this.actions.SwitchCamera.forEach(a=>a.playFromCurrent()),this.actions.SceneTransition.forEach(a=>a.dispatch()),this.actions.SetVariable.forEach(a=>a.checkConditions()),this.actions.SetVariable.forEach(a=>a.dispatch()),this.actions.DynamicVariablePlay.forEach(a=>a.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(a=>{a.object.currentTransitionEvent!==this&&(a.object.currentTransitionEvent=this,a.init())}),this.entered&&(this.entered=!1,this.actions.Transition.forEach(a=>a.reverseFromCurrent()),this.actions.Particles.forEach(a=>a.reverseFromCurrent()),this.actions.SwitchCamera.forEach(a=>a.reverseFromCurrent()))}dispatchUserEvent(g6c){this.actions.Transition.forEach(a=>{a.object.currentTransitionEvent!==this&&(a.object.currentTransitionEvent=this,a.init())}),g6c?(this.actions.Transition.forEach(a=>a.reverseFromCurrent()),this.actions.Particles.forEach(a=>a.reverseFromCurrent()),this.actions.Animation.forEach(a=>a.reverseFromCurrent()),this.actions.SwitchCamera.forEach(a=>a.reverseFromCurrent())):(this.actions.Transition.forEach(a=>a.playFromCurrent()),this.actions.Animation.forEach(a=>a.playFromCurrent()),this.actions.Create.forEach(a=>a.dispatch()),this.actions.Particles.forEach(a=>a.dispatchBasic()),this.actions.Destroy.forEach(a=>a.dispatch()),this.actions.SwitchCamera.forEach(a=>a.playFromCurrent())),this.actions.SceneTransition.forEach(a=>a.dispatch()),this.actions.SetVariable.forEach(a=>a.checkConditions()),this.actions.SetVariable.forEach(a=>a.dispatch()),this.actions.DynamicVariablePlay.forEach(a=>a.dispatch())}},h6c=class extends O1c{constructor(i6c,j6c){super(i6c),this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=a=>{Zya.length>1||(this.eventContext.updateRaycaster(a),this.handleMouseHoverEvent())},this.onMouseUp=a=>{Zya.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=a=>{Zya.length>1||(this.eventContext.updateRaycaster(a),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:a,target:b,reverse:c})=>{if(!a||!b)return;let d=S1c(a);d&&"MouseHover"===d&&(b.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[b.uuid]?.forEach(a=>a.dispatchUserEvent(c)))};let{page:k6c,sharedAssets:l6c}=this.eventContext,m6c=(a,b)=>{if(!(!a.visible||!a.data?.events.length)){for(let{id:c,data:d}of a.data.events)if(!d.disabled&&"MouseHover"===d.type)try{let e=new _5c(c,d,a,k6c,l6c,j6c);this.eventsPerObjects[a.uuid]?this.eventsPerObjects[a.uuid].push(e):this.eventsPerObjects[a.uuid]=[e]}catch(f){}this.eventsPerObjects[a.uuid]?.length&&this.objects.push(a instanceof Hrc?b:a)}};k6c.traverseEntity(a=>{(a instanceof jEc||a instanceof aCc)&&a.frame?.traverse(b=>{m6c(b,a)}),m6c(a)})}connect(){if(!this.objects.length)return;let{domElement:n6c}=this.eventContext;this.domEventsNeeded.clear(),Tya&&(this.domEventsNeeded.add("pointerdown"),n6c.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),n6c.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),n6c.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(a=>{a.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:o6c}=this.eventContext;this.domEventsNeeded.clear(),Tya&&(o6c.removeEventListener("pointerdown",this.onMouseDown),o6c.removeEventListener("pointerup",this.onMouseUp)),o6c.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(a=>{a.forEach(a=>{a.disconnect()})}),this.objects.forEach(a=>{a.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(p6c=!1){let q6c=[];if(!p6c){let{stopRaycast:r6c,raycaster:s6c,page:t6c,pointerScreen:u6c}=this.eventContext,v6c=!1;if(t6c.uiCanvas&&(v6c=r1c(t6c,[u6c.x,u6c.y],Object.keys(this.eventsPerObjects),a=>{q6c.push(a)})),r6c&&!v6c){let w6c=p1c(s6c,t6c,this.objects);q6c=q1c(w6c),w6c.forEach(a=>{a.object instanceof jEc&&r1c(a.object,[a?.uv?.x??0,a?.uv?.y??0],Object.keys(this.eventsPerObjects),a=>{q6c.push(a)})})}else this.objects.forEach(a=>{let b=s1c(s6c,a);b&&(q6c.push(a),a instanceof jEc&&r1c(a,[b?.uv?.x??0,b?.uv?.y??0],Object.keys(this.eventsPerObjects),a=>{q6c.push(a)}))})}this._prevObjects.length&&this._prevObjects.forEach(a=>{q6c.includes(a)||(a.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[a.uuid]?.forEach(a=>a.dispatchLeave()))}),q6c.length&&q6c.forEach(a=>{a.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[a.uuid]?.forEach(a=>a.dispatchEnter())}),this._prevObjects=q6c}},x6c=class{constructor(y6c,z6c,A6c,B6c,C6c,D6c){this.id=y6c,this.data=z6c,this.object=A6c,this.scrollCounter=0,this.actions=$Zc(z6c,z6c.actions,B6c,C6c,D6c,A6c)}connect(){this.scrollCounter=0}disconnect(){_Zc(this.actions)}dispatch(E6c){this.actions.Transition.forEach(a=>{a.object.currentTransitionEvent!==this&&(a.object.currentTransitionEvent=this,a.init())});let F6c=E6c>0?1:-1;this.scrollCounter+=F6c,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let G6c=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(a=>a.seek(G6c)),this.actions.Animation.forEach(a=>a.seek(F6c)),this.actions.Create.forEach(a=>a.dispatchThrottled()),this.actions.SetVariable.forEach(a=>a.checkConditions()),this.actions.SetVariable.forEach(a=>a.dispatch()),this.actions.DynamicVariablePlay.forEach(a=>a.dispatch())}dispatchUserEvent(H6c){this.actions.Transition.forEach(a=>{a.object.currentTransitionEvent!==this&&(a.object.currentTransitionEvent=this,a.init())}),H6c?(this.actions.Transition.forEach(a=>a.reverseFromCurrent()),this.actions.Animation.forEach(a=>a.reverseFromCurrent())):(this.actions.Transition.forEach(a=>{a.playFromCurrent()}),this.actions.Animation.forEach(a=>{a.playFromCurrent()})),this.actions.Create.forEach(a=>a.dispatchThrottled()),this.actions.SetVariable.forEach(a=>a.checkConditions()),this.actions.SetVariable.forEach(a=>a.dispatch()),this.actions.DynamicVariablePlay.forEach(a=>a.dispatch())}},I6c=class{constructor(J6c,K6c,L6c,M6c,N6c,O6c,P6c){this.id=J6c,this.data=K6c,this.object=L6c,this.domElement=O6c,this.eventManager=P6c,this.scrollStart=0,this.scrollEnd=0,this.actions=$Zc(K6c,K6c.actions,M6c,N6c,P6c,L6c)}computeScrollBounds(){let Q6c=this.domElement.getBoundingClientRect(),R6c=document.body,S6c=document.documentElement,T6c=window.pageYOffset||S6c.scrollTop||R6c.scrollTop,U6c=S6c.clientTop||R6c.clientTop||0,V6c=Math.round(Q6c.top+T6c-U6c);if("enter"===this.data.startFrom){let W6c=window.innerHeight,X6c=Q6c.height,Y6c=this.data.enterAnchor,Z6c="top"===Y6c?W6c:"bottom"===Y6c?W6c-X6c:W6c-.5*X6c;this.scrollStart=V6c-Z6c}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=Q6c,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){_Zc(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return void 0===this.box||0===this.box.width&&0===this.box.height&&0===this.box.top&&0===this.box.bottom}computeScroll({x:$6c,y:_6c}){this.actions.Transition.forEach(a=>{a.object.currentTransitionEvent!==this&&(a.object.currentTransitionEvent=this,a.init())});let a7c=this.scrollEnd-this.scrollStart,b7c=Math.min(1,Math.max(0,(_6c-this.scrollStart)/a7c));this.actions.Transition.forEach(a=>a.seek(b7c)),this.actions.Animation.forEach(a=>a.seek(b7c)),this.actions.Create.forEach(a=>a.dispatchThrottled()),this.actions.SetVariable.forEach(a=>a.checkConditions()),this.actions.SetVariable.forEach(a=>a.dispatch()),this.actions.DynamicVariablePlay.forEach(a=>a.dispatch())}dispatch(c7c){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(c7c)}dispatchUserEvent(d7c){this.actions.Transition.forEach(a=>{a.object.currentTransitionEvent!==this&&(a.object.currentTransitionEvent=this,a.init())}),d7c?(this.actions.Transition.forEach(a=>a.reverseFromCurrent()),this.actions.Animation.forEach(a=>a.reverseFromCurrent())):(this.actions.Transition.forEach(a=>{a.playFromCurrent()}),this.actions.Animation.forEach(a=>{a.playFromCurrent()})),this.actions.Create.forEach(a=>a.dispatchThrottled()),this.actions.SetVariable.forEach(a=>a.checkConditions()),this.actions.SetVariable.forEach(a=>a.dispatch()),this.actions.DynamicVariablePlay.forEach(a=>a.dispatch())}},e7c=class extends O1c{constructor(f7c,g7c){super(f7c),this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([a,b])=>{b.forEach(a=>a.handleResize())})},this.onScroll=a=>{if(!this.isInview)return;let b={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([a,c])=>{a.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:b}),c.forEach(a=>a.dispatch(b))})},this.onWheel=a=>{!this.isInview||a.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([b,c])=>{b.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:a.deltaY}),c.forEach(b=>b.dispatch(a.deltaY))})},this.onUserEvent=({eventName:a,target:b,reverse:c})=>{if(!a||!b)return;let d=S1c(a);d&&"Scroll"===d&&(b.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),this.wheelEventsPerObject.get(b)?.forEach(a=>{a.dispatchUserEvent(c)}))};let{page:h7c,sharedAssets:i7c,domElement:j7c,isExport:k7c}=this.eventContext,l7c=a=>{if(a.data?.events.length){for(let{id:b,data:c}of a.data.events)if(!c.disabled&&"Scroll"===c.type)if("load"!==c.trigger&&k7c){let d=new I6c(b,c,a,h7c,i7c,j7c,g7c);this.scrollEventsPerObject.has(a)?this.scrollEventsPerObject.get(a)?.push(d):this.scrollEventsPerObject.set(a,[d])}else{let e=new x6c(b,c,a,h7c,i7c,g7c);this.wheelEventsPerObject.has(a)?this.wheelEventsPerObject.get(a)?.push(e):this.wheelEventsPerObject.set(a,[e])}}};h7c.traverseEntity(a=>{(a instanceof jEc||a instanceof aCc)&&a.frame?.traverse(a=>{l7c(a)}),l7c(a)}),this.intersectionObserver=new IntersectionObserver(a=>{let b=a[0];b&&(this.isInview=b.isIntersecting)},{root:null})}connect(){this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([a,b])=>{b.forEach(a=>a.connect()),a.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([a,b])=>{b.forEach(a=>a.connect()),a.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(a=>a.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(a=>a.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([a,b])=>{b.forEach(a=>a.disconnect()),a.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([a,b])=>{b.forEach(a=>a.disconnect()),a.removeEventListener("userEvent",this.onUserEvent)})}},m7c=class{constructor(n7c,o7c,p7c,q7c,r7c,s7c){this.id=n7c,this.data=o7c,this.object=p7c,this.actions=$Zc(o7c,o7c.actions,q7c,r7c,s7c,p7c)}disconnect(){_Zc(this.actions)}dispatch(){this.actions.Transition.forEach(a=>{a.play()}),this.actions.Animation.forEach(a=>{a.play()}),this.actions.SwitchCamera.forEach(a=>{a.play()}),this.actions.SceneTransition.forEach(a=>{a.dispatch()}),this.actions.Reset.forEach(a=>a.dispatch()),this.actions.SetVariable.forEach(a=>a.checkConditions()),this.actions.SetVariable.forEach(a=>a.dispatch()),this.actions.DynamicVariablePlay.forEach(a=>a.dispatch()),this.actions.Create.forEach(a=>{a.dispatchFromStart()}),this.actions.Destroy.forEach(a=>{a.dispatchFromStart()})}dispatchAfter(t7c){this.actions.Audio.forEach(a=>{(a.interaction.data.triggerAfter??"any")===t7c&&(a.interaction instanceof LVc?a.interaction.audioPlayer.play():a.interaction instanceof VVc&&a.interaction.dispatch())}),this.actions.Video.forEach(a=>{let b=a.interaction.data.triggerAfter??"autoplay";b===t7c&&(a.interaction instanceof c$c?a.interaction.play("autoplay"===b):a.interaction instanceof n$c&&a.interaction.dispatch())}),this.actions.Particles.forEach(a=>{(a.data.triggerAfter??"any")===t7c&&a.dispatchBasic()})}dispatchUserEvent(u7c){this.actions.Transition.forEach(a=>{a.object.currentTransitionEvent!==this&&(a.object.currentTransitionEvent=this,a.init())}),u7c?(this.actions.Transition.forEach(a=>a.reverseFromCurrent()),this.actions.Animation.forEach(a=>a.reverseFromCurrent()),this.actions.SwitchCamera.forEach(a=>a.reverseFromCurrent())):(this.actions.Transition.forEach(a=>a.playFromCurrent()),this.actions.Animation.forEach(a=>a.playFromCurrent()),this.actions.SwitchCamera.forEach(a=>a.playFromCurrent())),this.actions.SceneTransition.forEach(a=>a.dispatch()),this.actions.Reset.forEach(a=>a.dispatch()),this.actions.SetVariable.forEach(a=>a.checkConditions()),this.actions.SetVariable.forEach(a=>a.dispatch()),this.actions.DynamicVariablePlay.forEach(a=>a.dispatch()),this.actions.Create.forEach(a=>{a.dispatch()}),this.actions.Destroy.forEach(a=>{a.dispatch()}),this.actions.Audio.forEach(a=>{a.interaction instanceof LVc?a.interaction.audioPlayer.play():a.interaction instanceof VVc&&a.interaction.dispatch()}),this.actions.Video.forEach(a=>{a.interaction instanceof c$c?a.interaction.play():a.interaction instanceof n$c&&a.interaction.dispatch()}),this.actions.Particles.forEach(a=>{a.dispatchBasic()})}},v7c=class extends O1c{constructor(w7c,x7c){super(w7c),this.eventManager=x7c,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([a,b])=>{a.dispatchEvent({type:"beginEvent",eventName:"Start"}),b.forEach(a=>{a.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([a,b])=>{a.dispatchEvent({type:"beginEvent",eventName:"Start"}),b.forEach(a=>{a.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:a,isExport:b}=this.eventContext;(b?document:a).removeEventListener("pointerdown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,b])=>{a.dispatchEvent({type:"beginEvent",eventName:"Start"}),b.forEach(a=>{a.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([a,b])=>{a.dispatchEvent({type:"beginEvent",eventName:"Start"}),b.forEach(a=>{a.actions.Audio.forEach(a=>{a.interaction instanceof LVc&&a.interaction.audioPlayer.play()}),a.actions.Video.forEach(a=>{let b=a.interaction.data.triggerAfter??"autoplay";a.interaction instanceof c$c&&a.interaction.play("autoplay"===b)}),a.actions.Particles.forEach(a=>{a.dispatchBasic()})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([a,b])=>{a.dispatchEvent({type:"beginEvent",eventName:"Start"}),b.forEach(a=>{a.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:a,target:b,reverse:c})=>{if(!a||!b)return;let d=S1c(a);d&&"Start"===d&&(b instanceof Hrc||b.dispatchEvent({type:"beginEvent",eventName:"Start"}),this.eventsPerObject.get(b)?.forEach(a=>{a.dispatchUserEvent(c)}),this.eventsAfterPerObject.get(b)?.forEach(a=>{a.dispatchUserEvent(c)}))}}connect(){let{sharedAssets:y7c,page:z7c}=this.eventContext,A7c=a=>{if(a.data?.events.length)for(let{id:b,data:c}of a.data.events){if(c.disabled||"Start"!==c.type)continue;let d=new m7c(b,c,a,z7c,y7c,this.eventManager);(d.actions.Transition.length||d.actions.Animation.length||d.actions.SwitchCamera.length||d.actions.Create.length||d.actions.Destroy.length||d.actions.SceneTransition.length||d.actions.Reset.length||d.actions.SetVariable.length||d.actions.DynamicVariablePlay.length)&&(this.eventsPerObject.has(a)?this.eventsPerObject.get(a)?.push(d):this.eventsPerObject.set(a,[d])),d.actions.Audio.length&&(this.eventsAfterPerObject.has(a)?this.eventsAfterPerObject.get(a)?.push(d):this.eventsAfterPerObject.set(a,[d])),d.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(a)?this.eventsAfterPerObject.get(a)?.push(d):this.eventsAfterPerObject.set(a,[d])),d.actions.Particles.length&&(this.eventsAfterPerObject.has(a)?this.eventsAfterPerObject.get(a)?.push(d):this.eventsAfterPerObject.set(a,[d]))}};if(z7c.traverseEntity(a=>{(a instanceof jEc||a instanceof aCc)&&a.frame?.traverse(a=>{A7c(a)}),A7c(a)}),[...this.eventsAfterPerObject.values()].some(a=>a.length)){if(0===this.eventManager.activateCount){let{domElement:B7c,isExport:C7c}=this.eventContext,D7c=C7c?document:B7c;D7c.addEventListener("pointerdown",this.onMouseDown,{once:!0}),D7c.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),D7c.addEventListener("pointerdown",this.onAny),D7c.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,b])=>{a.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([a,b])=>{a.dispatchEvent({type:"beginEvent",eventName:"Start"}),b.forEach(a=>a.dispatch()),a.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(a=>a.length)){let{domElement:E7c,isExport:F7c}=this.eventContext,G7c=F7c?document:E7c;G7c.removeEventListener("pointerdown",this.onMouseDown),G7c.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),G7c.removeEventListener("pointerdown",this.onAny),G7c.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,b])=>{a.removeEventListener("userEvent",this.onUserEvent),b.forEach(a=>a.disconnect())})}[...this.eventsPerObject.entries()].forEach(([a,b])=>{a.removeEventListener("userEvent",this.onUserEvent),b.forEach(a=>a.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},H7c=class{constructor(I7c,J7c,K7c,L7c,M7c,N7c){this.id=I7c,this.data=J7c,this.object=K7c,this.disabled=!1,this.alreadyPlayedNonTogglingActions=new Set,this.actions=$Zc(J7c,J7c.actions,L7c,M7c,N7c,K7c),this.target=J7c.target,this.useToggle="Toggle"===J7c.runMode}disconnect(){_Zc(this.actions)}dispatch(O7c){this.disabled||(this.actions.Transition.forEach(a=>{a.object.currentTransitionEvent!==this?(a.object.currentTransitionEvent=this,a.init()):"Once"===this.data.runMode&&this.alreadyPlayedNonTogglingActions.add(a)}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.useToggle?(this.actions.Transition.forEach(a=>{a.toggle()}),this.actions.Animation.forEach(a=>{a.toggle()})):(this.actions.Transition.forEach(a=>{!1===this.alreadyPlayedNonTogglingActions.has(a)&&a.play()}),this.actions.Animation.forEach(a=>{a.play()})),this.actions.Reset.forEach(a=>{a.dispatch()}),this.actions.Link.forEach(a=>{a.dispatch()}),this.actions.Reset.forEach(a=>{a.dispatch()}),this.actions.Create.forEach(a=>{a.dispatch()}),this.actions.Destroy.forEach(a=>{a.dispatch(O7c?? !1)}),this.actions.SetVariable.forEach(a=>a.checkConditions()),this.actions.SetVariable.forEach(a=>a.dispatch()),this.actions.DynamicVariablePlay.forEach(a=>a.dispatch()),this.actions.Audio.forEach(a=>{a.dispatchBasic()}),this.actions.Particles.forEach(a=>{a.dispatchBasic()}),this.actions.Video.forEach(a=>{a.dispatchBasic()}))}},P7c=class extends O1c{constructor(Q7c,R7c,S7c,T7c,U7c){super(Q7c),this.sharedVariables=R7c,this.eventManager=S7c,this.needsMouse=T7c,this.needsRaycast=U7c,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.events=[],this.onFrame=a=>{this.rafId=window.requestAnimationFrame(this.onFrame);let b=new Date,c=[],d=[];for(let e=0;e<this.propertiesToWatch.length;e++){let{objectId:f,property:g,prevValue:h}=this.propertiesToWatch[e],i=this.eventContext.scene.find(f),j=uJa.propertyPaths[g];if("width"===j[0]||"height"===j[0]||"depth"===j[0])i=i.geometry.userData.parameters[j[0]];else for(let k=0;k<j.length;k++)i=i[j[k]];null===h?this.propertiesToWatch[e].prevValue=i instanceof fm?i.clone():i:(i instanceof fm?i.equals(h):h===i)||(d.push({objId:f,property:g}),i instanceof fm?this.propertiesToWatch[e].prevValue.copy(i):this.propertiesToWatch[e].prevValue=i)}for(let l=0;l<this.variablesToWatch.length;l++){let{id:m,prevValue:n}=this.variablesToWatch[l],o=this.shared.getVariable(m);o!==n&&(c.push(m),this.variablesToWatch[l].prevValue=o)}for(let p=0;p<this.dynamicVars.length;p++){let{id:q,expectedTime:r,last:s,data:t,timerSeconds:u,startValue:v}=this.dynamicVars[p],w=1e3;if(("timer"===t.dynamicVariableType||"stopwatch"===t.dynamicVariableType)&&"number3decimal"===t.format?w=1:"counter"===t.dynamicVariableType?w=t.updateInterval:"random"===t.dynamicVariableType&&(w=t.isStatic?1/0:t.updateInterval),-1===r){this.dynamicVars[p].last=a,this.dynamicVars[p].expectedTime=a+w;continue}if(!(("Stopped"===this.shared.getDynamicVariablePlayState(q)||"Restarted"===this.shared.getDynamicVariablePlayState(q))&&(this.dynamicVars[p].last=a,this.dynamicVars[p].expectedTime=a+w,"counter"===t.dynamicVariableType&&this.shared.getVariable(q)!==v&&(this.shared.updateVariable(q,v),this.eventManager.requestRender()),("timer"===t.dynamicVariableType||"stopwatch"===t.dynamicVariableType)&&this.dynamicVars[p].timerSeconds!==v&&(this.dynamicVars[p].timerSeconds=v,this.shared.updateVariable(q,fOa.getFormattedTimerTime(v,t)),this.eventManager.requestRender()),"Restarted"===this.shared.getDynamicVariablePlayState(q)&&this.shared.setDynamicVariablePlayState(q,"Playing"),"Stopped"===this.shared.getDynamicVariablePlayState(q)))){if("Paused"===this.shared.getDynamicVariablePlayState(q)){void 0===this.dynamicVars[p].deltaToExpectedTime&&(this.dynamicVars[p].deltaToExpectedTime=Math.max(this.dynamicVars[p].expectedTime-a,0)),this.dynamicVars[p].last=a-(w-this.dynamicVars[p].deltaToExpectedTime),this.dynamicVars[p].expectedTime=a+this.dynamicVars[p].deltaToExpectedTime;continue}if(this.dynamicVars[p].deltaToExpectedTime=void 0,a>=r)if(this.dynamicVars[p].last=a,this.dynamicVars[p].expectedTime+=w,"random"===t.dynamicVariableType){let x=t.min+Math.random()*(t.max-t.min),y=t.decimals;x=Math.round(x*Math.pow(10,y))/Math.pow(10,y),this.shared.updateVariable(q,x),c.push(q),this.eventManager.requestRender()}else if("counter"===t.dynamicVariableType){if(0===t.increment)continue;let z=this.shared.getVariable(q),A=this.shared.getDynamicVariableToggleIsForward(q)?? !0,B=this.shared.getVariable(q)+t.increment*(A?1:-1);t.hasEnd&&((B=t.increment>0?Db.clamp(B,v,t.endValue):Db.clamp(B,t.endValue,v))===v&&this.shared.setDynamicVariableToggleIsForward(q,void 0),t.repeat?B===t.endValue&&(B=v):(B===v||B===t.endValue)&&this.shared.setDynamicVariablePlayState(q,"Paused")),B!==z&&(c.push(q),this.shared.updateVariable(q,B),this.eventManager.requestRender())}else if("time"===t.dynamicVariableType)this.shared.updateVariable(q,XQb(b,t)),c.push(q),this.eventManager.requestRender();else{let C=aOa.isTextValue(t.endValue)?d8c(t.endValue.textValue):t.endValue,D=this.shared.getDynamicVariableToggleIsForward(q)?? !0,E=u+(a-s)/1e3*("timer"===t.dynamicVariableType?-1:1)*(D?1:-1);E=Math.max(E,0),t.hasEnd&&((E="stopwatch"===t.dynamicVariableType?Db.clamp(E,v,C):Db.clamp(E,C,v))===v&&this.shared.setDynamicVariableToggleIsForward(q,void 0),t.repeat?Math.abs(E-C)<("number3decimal"===t.format?1e-4:.1)&&(E=v):(Math.abs(E-v)<("number3decimal"===t.format?1e-4:.1)||Math.abs(E-C)<("number3decimal"===t.format?1e-4:.1))&&this.shared.setDynamicVariablePlayState(q,"Paused")),E!==u&&(c.push(q),this.dynamicVars[p].timerSeconds=E,this.shared.updateVariable(q,fOa.getFormattedTimerTime(E,t)),this.eventManager.requestRender())}}}this.needsMouse&&this.shared.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=this.shared.mouseProperty,this.events.forEach(a=>{"mouseProperty"===a.data.variableId&&(a.dispatch(),this.eventManager.requestRender())}));let F=!1;this.shared.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=this.shared.mouseProperty,F=!0);let G=!1;this.shared.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=this.shared.raycastProperty,G=!0),this.events.forEach(a=>{(c.includes(a.data.variableId)||d.find(b=>b.objId===a.data.objectId&&b.property===a.data.property)||"mouseProperty"===a.data.variableId&&F||"raycastProperty"===a.data.variableId&&G)&&(a.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()},Q7c.page.traverseEntity(a=>{a.data?.events.filter(a=>"VariableChange"===a.data.type&&!a.data.disabled).forEach(b=>{this.events.push(new X7c(a.uuid,b.data,a,Q7c.page,Q7c.sharedAssets,S7c))})}),this.propertiesToWatch=this.events.filter(a=>"objectProperty"===a.data.variableId&&null!==a.data.objectId).map(a=>({objectId:a.data.objectId,property:a.data.property,prevValue:null})),this.shared=Q7c.sharedAssets,this.sharedVariables.forEach(({id:a,data:b})=>{if(!("dynamicVariableType"in b)){this.events.find(b=>b.data.variableId===a)&&this.variablesToWatch.push({id:a,prevValue:this.shared.getVariable(a)});return}let c;if("timer"===b.dynamicVariableType||"stopwatch"===b.dynamicVariableType){let d;if(aOa.isTextValue(b.value)&&Array.isArray(b.value.textValue)){let e=b.value.textValue;d=3===e.length?e[2]+60*e[1]+3600*e[0]:e[1]+60*e[0]}else d=b.value;c=d,this.dynamicVars.push({id:a,last:-1,expectedTime:-1,data:b,timerSeconds:d,startValue:c})}else"time"===b.dynamicVariableType&&this.shared.updateVariable(a,XQb(new Date,b)),"counter"===b.dynamicVariableType&&(c=aOa.isTextValue(b.value)?d8c(b.value.textValue):b.value),this.dynamicVars.push({id:a,last:-1,expectedTime:-1,data:b,startValue:c})})}pause(){this.pauseTime=Date.now()}resume(){let V7c=Date.now()-this.pauseTime;for(let W7c=0;W7c<this.dynamicVars.length;W7c++)this.dynamicVars[W7c].last+=V7c,this.dynamicVars[W7c].expectedTime+=V7c}connect(){this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(a=>a.dispose())}},X7c=class{constructor(Y7c,Z7c,$7c,_7c,a8c,b8c){this.id=Y7c,this.data=Z7c,this.object=$7c,this.actions=$Zc(Z7c,Z7c.actions,_7c,a8c,b8c,$7c)}dispatch(){let c8c=this.actions;c8c.Audio.forEach(a=>a.dispatchConditional()),c8c.Particles.forEach(a=>a.dispatchConditional()),c8c.Video.forEach(a=>a.dispatchConditional()),c8c.Create.forEach(a=>a.dispatch()),c8c.Destroy.forEach(a=>a.dispatch()),c8c.Reset.forEach(a=>a.dispatch()),c8c.Transition.forEach(a=>{a.object.currentTransitionEvent!==this&&(a.object.currentTransitionEvent=this),a.init()}),c8c.Transition.forEach(a=>a.play()),c8c.Animation.forEach(a=>a.play()),c8c.SwitchCamera.forEach(a=>a.play()),c8c.SceneTransition.forEach(a=>a.dispatch()),c8c.SetVariable.forEach(a=>a.checkConditions()),c8c.SetVariable.forEach(a=>a.dispatch()),c8c.DynamicVariablePlay.forEach(a=>a.dispatch())}dispose(){_Zc(this.actions)}};function d8c(a){return 3===a.length?a[2]+60*a[1]+3600*a[0]:a[1]+60*a[0]}var e8c,f8c,g8c,h8c=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('https://unpkg.com/@splinetool/runtime@1.0.54/build/' + 'navmesh.js'),
		fetch('https://unpkg.com/@splinetool/navmesh-wasm@1.0.54/build/' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,i8c=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,j8c=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,k8c={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1};kza.then(a=>{e8c=a,f8c=new a.Vec3,g8c=new a.Vec3});var l8c=new fm,m8c=class{constructor(n8c=!1,o8c=!1){this.usePhysics=n8c,this.isExport=o8c,this.onPointerDown=a=>{if(1!==Zya.length)return;let{raycaster:b,page:c}=this.eventContext;this.eventContext.updateRaycaster(a);let d=c.raycastWithClones(b);if(0!==d.length){if(this.gameControl){let e=l8c.copy(this.gameControl.colliderWorldPosition);e.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(e,d[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(a,b)=>c=>{let d;if(c instanceof E2b)if(!c.objectForSample)return!0===c.object.dataPatched.physics.fusedBody&&"dynamic"===c.object.dataPatched.physics.rigidBody||void 0;else{if(c.objectForSample.dataPatched.physics.fusedBody)return;d=c.object}else if(c instanceof eSa)d=c.object;else if((d=c).dataPatched.cloner?.disabled=== !1&&d.dataPatched.cloner?.hideBase&&d.dataPatched.physics?.fusedBody!== !0)return!0;if(b&&!d.userData.navmesh)return;let e=d.dataPatched;if(!e.visible&&e.physics?.enabled!== !0)return!0;c.updateMatrixWorldSVD();let f=Lcd(e),g=d.userData.hasDestroy,h=d.userData.hasDrag,i=!1,j=!1;for(let k of e.events)!0!==k.data.disabled&&("GameControl"===k.data.type?i=!0:"Follow"===k.data.type&&(j=!0));if(i||f||j||g||h)return!0;if(this.usePhysics&&e.physics?.rigidBody==="dynamic"){if(this.usePhysics&&e.physics?.fusedBody)return!0}else if("geometry"in c&&c.geometry&&a.push(X0c(c.geometry,c.matrixWorld)),this.usePhysics&&e.physics?.fusedBody)return c.traverseObject((b,c)=>{if(0===c)return;let d;if(b instanceof E2b)if(!b.objectForSample)return!0===b.object.dataPatched.physics.fusedBody&&"dynamic"===b.object.dataPatched.physics.rigidBody||void 0;else{if(b.objectForSample.dataPatched.physics.fusedBody)return;d=b.object}else if(b instanceof eSa)d=b.object;else if(d=b,b.dataPatched.cloner?.hideBase)return!0;let e=d.dataPatched;if(!e.visible&&e.physics?.enabled!== !0)return!0;"geometry"in b&&b.geometry&&a.push(X0c(b.geometry,b.matrixWorld))}),!0},this.traverseNoPhysics=(a,b)=>c=>{let d;if(c instanceof E2b)return;let e=(d=c instanceof eSa?c.object:c).dataPatched;if("visibility"===e.physics.enabled?!e.visible:!e.physics.enabled)return!0;if(b&&!d.userData.navmesh)return;let f=c.geometry,g=!0===d.userData.hasDestroy,h=!0===d.userData.hasDrag;if(Lcd(e)||g||h||d.dataPatched.events.some(a=>!0!==a.data.disabled&&"GameControl"===a.data.type))return!0;f&&a.push(X0c(f,c.matrixWorld))},this.navmeshWasm=e8c,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(o8c?h8c:i8c)+j8c])),this._worker=new Worker(this._workerURL)}init(p8c,q8c,r8c){this.gameControl=q8c,this.eventContext=r8c,this.resolution=p8c.ch,this.setDefaultQueryExtent(new fm().setScalar(p8c.ch*p8c.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(r8c.page,p8c,a=>{this.buildFromNavmeshData(a.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(s8c,t8c,u8c){t8c.objects.forEach(a=>{let b=s8c.scene.find(a);b.traverseEntity(a=>{a.userData.navmesh=!0}),b.cloner?.traverseObject(a=>{a.userData.navmesh=!0})});let v8c=[],w8c=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(v8c,"custom"===t8c.zones);if(s8c.traverseChildren(w8c),t8c.objects.forEach(a=>{let b=s8c.scene.find(a);b.traverseEntity(a=>{a.userData.navmesh=void 0}),b.cloner?.traverseObject(a=>{a.userData.navmesh=void 0})}),0===v8c.length)return!1;let x8c=vKa(v8c),{positions:y8c,triIndices:z8c}=Zub(x8c.getAttribute("position"),x8c.getIndex());return this._worker.postMessage([y8c,y8c.length/3,z8c,z8c.length,{...k8c,...t8c}]),this._worker.onmessage=u8c,!0}createDebugNavGeometry(){let A8c,B8c,C8c=this.navMesh.getDebugNavMesh(),D8c=C8c.getTriangleCount(),E8c=new Uint32Array(3*D8c),F8c=new Float32Array(9*D8c);for(A8c=0;A8c<3*D8c;A8c++)E8c[A8c]=A8c;for(A8c=0;A8c<D8c;A8c++)for(B8c=0;B8c<3;B8c++){let G8c=C8c.getTriangle(A8c).getPoint(B8c);F8c[9*A8c+3*B8c+0]=G8c.x,F8c[9*A8c+3*B8c+1]=G8c.y,F8c[9*A8c+3*B8c+2]=G8c.z}let H8c=new nE;return H8c.setIndex(new RC(E8c,1)),H8c.setAttribute("position",new RC(F8c,3)),H8c}getClosestPoint(I8c){return f8c.x=I8c.x,f8c.y=I8c.y,f8c.z=I8c.z,this.navMesh.getClosestPoint(f8c)}getClosestPointToRef(J8c,K8c){f8c.x=J8c.x,f8c.y=J8c.y,f8c.z=J8c.z;let L8c=this.navMesh.getClosestPoint(f8c);K8c.set(L8c.x,L8c.y,L8c.z)}getRandomPointAround(M8c,N8c){return f8c.x=M8c.x,f8c.y=M8c.y,f8c.z=M8c.z,this.navMesh.getRandomPointAround(f8c,N8c)}getRandomPointAroundToRef(O8c,P8c,Q8c){f8c.x=O8c.x,f8c.y=O8c.y,f8c.z=O8c.z;let R8c=this.navMesh.getRandomPointAround(f8c,P8c);Q8c.set(R8c.x,R8c.y,R8c.z)}moveAlong(S8c,T8c){return f8c.x=S8c.x,f8c.y=S8c.y,f8c.z=S8c.z,g8c.x=T8c.x,g8c.y=T8c.y,g8c.z=T8c.z,this.navMesh.moveAlong(f8c,g8c)}moveAlongToRef(U8c,V8c,W8c){return f8c.x=U8c.x,f8c.y=U8c.y,f8c.z=U8c.z,g8c.x=V8c.x,g8c.y=V8c.y,g8c.z=V8c.z,this.navMesh.moveAlong(f8c,g8c)}computePath(X8c,Y8c){let Z8c=this.getClosestPoint(Y8c);g8c.x=Z8c.x,g8c.y=Z8c.y,g8c.z=Z8c.z,this.getClosestPoint(X8c);let $8c=this.navMesh.computePath(f8c,g8c),_8c=$8c.getPointCount(),a9c=[];for(let b9c=0;b9c<_8c;b9c++){let c9c=$8c.getPoint(b9c);a9c.push(new fm(c9c.x,c9c.y,c9c.z))}return a9c}createCrowd(d9c,e9c){return new x9c(this,d9c,e9c)}setDefaultQueryExtent(f9c){f8c.x=f9c.x,f8c.y=f9c.y,f8c.z=f9c.z,this.navMesh.setDefaultQueryExtent(f8c)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(g9c){let h9c=g9c.length*g9c.BYTES_PER_ELEMENT,i9c=this.navmeshWasm._malloc(h9c),j9c=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i9c,h9c);j9c.set(g9c);let k9c=new this.navmeshWasm.NavmeshData;k9c.dataPointer=j9c.byteOffset,k9c.size=g9c.length,this.navMesh.buildFromNavmeshData(k9c),this.navmeshWasm._free(j9c.byteOffset)}getNavmeshData(){let l9c=this.navMesh.getNavmeshData(),m9c=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,l9c.dataPointer,l9c.size),n9c=new Uint8Array(l9c.size);return n9c.set(m9c),this.navMesh.freeNavmeshData(l9c),n9c}getDefaultQueryExtentToRef(o9c){let p9c=this.navMesh.getDefaultQueryExtent();o9c.set(p9c.x,p9c.y,p9c.z)}dispose(){this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),this.eventContext?.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(q9c,r9c,s9c){return f8c.x=q9c.x,f8c.y=q9c.y,f8c.z=q9c.z,this.navMesh.addCylinderObstacle(f8c,r9c,s9c)}addBoxObstacle(t9c,u9c,v9c){return f8c.x=t9c.x,f8c.y=t9c.y,f8c.z=t9c.z,g8c.x=u9c.x,g8c.y=u9c.y,g8c.z=u9c.z,this.navMesh.addBoxObstacle(f8c,g8c,v9c)}removeObstacle(w9c){this.navMesh.removeObstacle(w9c)}isSupported(){return void 0!==this.navmeshWasm}},x9c=class{constructor(y9c,z9c,A9c){this.navmeshWasmWrapper=y9c,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(z9c,A9c,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(B9c,C9c){}addAgent(D9c,E9c,F9c){let G9c=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;G9c.radius=E9c.radius,G9c.height=E9c.height,G9c.maxAcceleration=E9c.maxAcceleration,G9c.maxSpeed=E9c.maxSpeed,G9c.collisionQueryRange=E9c.collisionQueryRange,G9c.pathOptimizationRange=E9c.pathOptimizationRange,G9c.separationWeight=E9c.separationWeight,G9c.updateFlags=7,G9c.obstacleAvoidanceType=0,G9c.queryFilterType=0,G9c.userData=0;let H9c=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(D9c.x,D9c.y,D9c.z),G9c);return this.transforms.push(F9c),this.agents.push(H9c),this.reachRadii.push(E9c.reachRadius?E9c.reachRadius:E9c.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new fm(0,0,0)),H9c}getAgentPosition(I9c){return this.crowd.getAgentPosition(I9c)}getAgentPositionToRef(J9c,K9c){let L9c=this.crowd.getAgentPosition(J9c);K9c.set(L9c.x,L9c.y,L9c.z)}getAgentVelocity(M9c){return this.crowd.getAgentVelocity(M9c)}getAgentVelocityToRef(N9c,O9c){let P9c=this.crowd.getAgentVelocity(N9c);O9c.set(P9c.x,P9c.y,P9c.z)}getAgentNextTargetPath(Q9c){return this.crowd.getAgentNextTargetPath(Q9c)}getAgentNextTargetPathToRef(R9c,S9c){let T9c=this.crowd.getAgentNextTargetPath(R9c);S9c.set(T9c.x,T9c.y,T9c.z)}getAgentState(U9c){return this.crowd.getAgentState(U9c)}overOffmeshConnection(V9c){return this.crowd.overOffmeshConnection(V9c)}agentGoto(W9c,X9c){this.crowd.agentGoto(W9c,new this.navmeshWasmWrapper.navmeshWasm.Vec3(X9c.x,X9c.y,X9c.z));let Y9c=this.agents.indexOf(W9c);Y9c> -1&&(this._agentDestinationArmed[Y9c]=!0,this._agentDestination[Y9c].set(X9c.x,X9c.y,X9c.z))}agentTeleport(Z9c,$9c){this.crowd.agentTeleport(Z9c,new this.navmeshWasmWrapper.navmeshWasm.Vec3($9c.x,$9c.y,$9c.z))}updateAgentParameters(_9c,aad){let bad=this.crowd.getAgentParameters(_9c);void 0!==aad.radius&&(bad.radius=aad.radius),void 0!==aad.height&&(bad.height=aad.height),void 0!==aad.maxAcceleration&&(bad.maxAcceleration=aad.maxAcceleration),void 0!==aad.maxSpeed&&(bad.maxSpeed=aad.maxSpeed),void 0!==aad.collisionQueryRange&&(bad.collisionQueryRange=aad.collisionQueryRange),void 0!==aad.pathOptimizationRange&&(bad.pathOptimizationRange=aad.pathOptimizationRange),void 0!==aad.separationWeight&&(bad.separationWeight=aad.separationWeight),this.crowd.setAgentParameters(_9c,bad)}removeAgent(cad){this.crowd.removeAgent(cad);let dad=this.agents.indexOf(cad);dad> -1&&(this.agents.splice(dad,1),this.transforms.splice(dad,1),this.reachRadii.splice(dad,1),this._agentDestinationArmed.splice(dad,1),this._agentDestination.splice(dad,1))}getAgents(){return this.agents}update(ead){if(this.navmeshWasmWrapper.navMesh.update(),ead<=.001)return;let fad=1/60,gad=10;if(fad<=.001)this.crowd.update(ead);else{let had=Math.floor(ead/fad);gad&&had>gad&&(had=gad),had<1&&(had=1);let iad=ead/had;for(let jad=0;jad<had;jad++)this.crowd.update(iad)}for(let kad=0;kad<this.agents.length;kad++){let lad=this.agents[kad],mad=this.getAgentPosition(lad);if(this.transforms[kad].copy(mad),this._agentDestinationArmed[kad]){let nad=mad.x-this._agentDestination[kad].x,oad=mad.z-this._agentDestination[kad].z,pad=this.reachRadii[kad],qad=this._agentDestination[kad].y-this.reachRadii[kad],rad=this._agentDestination[kad].y+this.reachRadii[kad],sad=nad*nad+oad*oad;mad.y>qad&&mad.y<rad&&sad<pad*pad&&(this.onReachTarget(lad,this._agentDestination[kad]),this._agentDestinationArmed[kad]=!1)}}}setDefaultQueryExtent(tad){let uad=new this.navmeshWasmWrapper.navmeshWasm.Vec3(tad.x,tad.y,tad.z);this.crowd.setDefaultQueryExtent(uad)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(vad){let wad=this.crowd.getDefaultQueryExtent();vad.set(wad.x,wad.y,wad.z)}getCorners(xad){let yad,zad=this.crowd.getCorners(xad),Aad=zad.getPointCount(),Bad=[];for(yad=0;yad<Aad;yad++){let Cad=zad.getPoint(yad);Bad.push(new fm(Cad.x,Cad.y,Cad.z))}return Bad}dispose(){this.crowd.destroy()}},Dad={type:"change"},Ead={type:"changeZoom"},Fad={type:"changePan"},Gad={type:"start"},Had={type:"end",changed:!0},Iad={type:"end",changed:!1},Jad=new Fj,Kad=new Eb,Lad=2*Math.PI,Mad=new fm,Nad=new Eb,Oad=new fm,Pad=new Fj,Qad=new rs,Rad={type:"requestRender"},Sad=class extends ab{constructor(Tad,Uad,Vad={isPlayMode:!1,isExport:!1}){super(),this.object=Tad,this.domElement=Uad,this.options=Vad,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,M.DOLLY_ROTATE,M.PAN],this.offset=new fm,this.eye=new fm,this.lastPosition=new fm,this.lastQuaternion=new Fj,this.current=new Eb,this.overShoot=new Eb,this.overRatio=new Eb,this.spherical=new Zoa,this.sphericalDelta=new Zoa,this.panOffset=new fm,this.panLeftV=new fm,this.panUpV=new fm,this.panV=new fm,this.rotateStart=new Eb,this.rotateEnd=new Eb,this.rotateDelta=new Eb,this.panStart=new Eb,this.panEnd=new Eb,this.panDelta=new Eb,this.dollyStart=new Eb,this.dollyEnd=new Eb,this.dollyDelta=new Eb,this.rotationRangeFactor=new Eb,this.panRangeFactor=new Eb,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=a=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=a.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(Oad,Pad,Mad),this.offset.copy(Oad).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&& -1===this.state&&this.rotateLeft((!0===this.autoRotateClockwise?1:-1)*this.getAutoRotationAngle()),0!==this.rotationLimitsMode&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),2!==this.rotationLimitsMode&&(this.spherical.phi+=this.sphericalDelta.phi),(1!==this.rotationLimitsMode|| !0===this.autoRotate)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),0!==this.panLimitsMode&&(this.target.applyQuaternion(Jad.copy(Pad).invert()),this.panOffset.applyQuaternion(Jad),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(Pad),this.panOffset.applyQuaternion(Pad)),2===this.panLimitsMode&&(this.panOffset.y=0),1===this.panLimitsMode&&(this.panOffset.x=0),-1!==this.state||this.gesture?(this.target.add(this.panOffset),this.panOffset.set(0,0,0)):(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)),this.offset.setFromSpherical(this.spherical),Oad.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(Qad.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(Qad));let a=this.spherical.phi%Lad;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(Iy.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),a>0&&a>Math.PI||a<0&&a> -Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),-1===this.state|| !0===this.enableDamping){let b=1===this.hoverRotatePanMode?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-b,this.sphericalDelta.phi*=1-b}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>.01||8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-8?(this.dispatchEvent(Dad),this.object.dispatchEvent(Rad),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=a=>{!1!==this.enabled&&("touch"===a.pointerType||"pen"===a.pointerType&&Tya?this.onPointerDownTouch(a):this.onPointerDownMouse(a),-1!==this.state&&(this.isPointerDown=!0,this.dispatchEvent(Gad),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),a.stopPropagation(),"touch"===a.pointerType||"pen"===a.pointerType&&Tya||this.domElement.setPointerCapture(a.pointerId)))},this.onPointerLeave=a=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(1===this.hoverRotatePanMode?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,Mad.subVectors(this.position0,this.target0),this.spherical.setFromVector3(Mad),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):2===this.hoverRotatePanMode&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=a},this.onPointerEnter=a=>{this.resetHoverEffectOnPointerLeave|| void 0===this.pointerLeaveEvent?Nad.set(a.clientX-this.domElement.clientWidth/2,a.clientY-this.domElement.clientHeight/2):Nad.set(a.clientX-this.pointerLeaveEvent.clientX,a.clientY-this.pointerLeaveEvent.clientY),1===this.hoverRotatePanMode?(this.rotateDelta.copy(Nad).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(Kad,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(a.clientX,a.clientY)):2===this.hoverRotatePanMode&&(this.panDelta.copy(Nad).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(a.clientX,a.clientY)),this.update()},this.onPointerMove=a=>{!1!==this.enabled&&(this.checkRaycastLock()||("touch"===a.pointerType||"pen"===a.pointerType&&Tya?this.onPointerMoveTouch(a):this.onPointerMoveMouse(a),a.stopPropagation()))},this.onPointerUp=a=>{this.isPointerDown=!1,0===Zya.length&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),Zya.length>1&&a.preventDefault(),this.hasChange?this.dispatchEvent(Had):this.dispatchEvent(Iad),this.state=-1,a&&(a.stopPropagation(),"touch"===a.pointerType||"pen"===a.pointerType&&Tya||this.domElement.releasePointerCapture(a.pointerId))},this.onPointerDownMouse=a=>{switch(this.useKeyEvents?this.mouseButtons[a.button]:this.mouseButtonsPlay[a.button]){case 0:if(!0!==a.altKey||a.shiftKey||Yya(a)){if(" "===this.key){if(!1===this.enablePan)return;this.handleMouseDownPan(a),this.state=2}}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(a),this.state=0}break;case 4:if(!1===this.enablePan)return;this.handleMouseDownPan(a),this.state=2;break;case 3:if(Yya(a)||a.shiftKey){if(!1===this.enablePan)return;this.handleMouseDownPan(a),this.state=2}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(a),this.state=0}break;case 5:if(Yya(a)||a.shiftKey){if(!1===this.enableRotate)return;this.handleMouseDownRotate(a),this.state=0}else{if(!1===this.enablePan)return;this.handleMouseDownPan(a),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=a=>{switch(this.state){case 0:if(!1===this.enableRotate)return;this.handleMouseMoveRotate(a);break;case 1:if(!1===this.enableZoom)return;this.handleMouseMoveDolly(a);break;case 2:if(!1===this.enablePan)return;this.handleMouseMovePan(a);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=a=>{switch(Zya.length>1&&a.preventDefault(),this.touches[Zya.length-1]){case M.ROTATE:if(!1===this.enableRotate){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case M.PAN:if(!1===this.enablePan){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case M.DOLLY_PAN:if(!1===this.enableZoom&& !1===this.enablePan)return;this.handleTouchStartDollyPan(),this.state=5;break;case M.DOLLY_ROTATE:if(!1===this.enableZoom&& !1===this.enableRotate)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=a=>{switch(Zya.length>1&&a.preventDefault(),this.state){case 3:if(!1===this.enableRotate)return;this.handleTouchMoveRotate(a),this.update();break;case 4:if(!1===this.enablePan)return;this.handleTouchMovePan(a),this.update();break;case 5:if(!1===this.enableZoom&& !1===this.enablePan)return;this.handleTouchMoveDollyPan(a),this.update();break;case 6:if(!1===this.enableZoom&& !1===this.enableRotate)return;this.handleTouchMoveDollyRotate(a),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=sya(()=>this.dispatchEvent(Had),33),this.onMouseWheel=a=>{!1===this.enabled|| !1===this.enableZoom&& !1===this.enablePan||this.checkRaycastLock()||(this.options.isExport||this.domElement.clientHeight!==document.body.clientHeight||this.domElement.clientWidth!==document.body.clientWidth||a.preventDefault(),this.dispatchEvent(Gad),this.handleMouseWheel(a),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=a=>{if(a.preventDefault(),!1!==this.enabled&&!this.checkRaycastLock()&&!Rya)if("gesturechange"===a.type){if(!1===this.enableZoom|| !1===this.isTouchZoom)return;this.dispatchEvent(Gad),a.scale>this.prevScale?this.dollyIn(this.getZoomScale()):a.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=a.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(Had)},this.onContextMenu=a=>{a.preventDefault()},this.onTouchEnd=a=>{a.preventDefault()},this.onKeyDown=a=>{!1!==this.enabled&&(this.key=a.key," "===a.key&&this.dispatchEvent(Gad))},this.onKeyUp=a=>{!1!==this.enabled&&(this.key=void 0,-1!==this.state&&"Alt"===a.key&&this.onPointerUp(Zya[0])," "===a.key&&this.dispatchEvent(Had))},this.onPointerHover=a=>{"mouse"!==a.pointerType|| !1===this.enabled|| -1!==this.state||2===this.hoverRotatePanMode&&this.isPanOverShoot||1===this.hoverRotatePanMode&&this.isRotateOverShoot||(this.isPointerDown=!0,2===this.hoverRotatePanMode?this.handleMouseMovePan(a,this.hoverRotatePanStrength):1===this.hoverRotatePanMode&&this.handleMouseMoveRotate(a,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=a=>{a.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.addEventListenersToCamera()}dispatchEvent(Wad){"start"===Wad.type?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(Wad)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(Xad){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=Xad,0!==this.hoverRotatePanMode&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),0!==this.hoverRotatePanMode&&!this.useWindowEvents){let Yad=this.useWindowEvents?window:this.domElement;Yad.addEventListener("pointerleave",this.onPointerLeave),Yad.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(Zad,$ad){this.setEnableDampingSpeed(Zad.enableDamping),this.enablePan=Zad.enablePan,this.enableZoom=Zad.enableZoom,this.enableRotate=Zad.enableRotate,this.rotationLimitsMode=Zad.rotationLimitsMode,this.thetaIsFree=Zad.rotationHorizontalOffset.min===Zad.rotationHorizontalOffset.max&&Zad.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=Zad.rotationVerticalOffset.min===Zad.rotationVerticalOffset.max&&Zad.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=Zad.panLimitsMode,this.panSoftLimit=Zad.panSoftLimit,this.rotationSoftLimit=Zad.rotationSoftLimit,this.hoverRotatePanMode=Zad.hoverRotatePanMode,this.hoverRotateDamping=Zad.hoverRotateDamping??this.dampingFactor,this.useWindowEvents="window"===$ad,0!==this.hoverRotatePanMode&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let _ad=Zad.hoverRotatePanStrength/100;this.hoverRotatePanStrength=_ad**2,this.zoomLimitsEnabled=Zad.zoomLimitsEnabled,this.minZoom=Zad.zoomLimits.min,this.maxZoom=Math.max(Zad.zoomLimits.min,Zad.zoomLimits.max),this.minDistance=1e3/Zad.zoomLimits.max,this.maxDistance=Math.max(this.minDistance,1e3/Zad.zoomLimits.min),this.autoRotate=Zad.autoRotate,this.autoRotateSpeed=Zad.autoRotateSpeed,this.autoRotateClockwise=Zad.autoRotateClockwise;let abd=this.object.getTarget().applyQuaternion(Jad.copy(this.object.quaternion).invert());this.minV=-Zad.panVerticalOffset.min+abd.y,this.maxV=Zad.panVerticalOffset.max+abd.y,this.minH=-Zad.panHorizontalOffset.min+abd.x,this.maxH=Zad.panHorizontalOffset.max+abd.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=lcd(this.spherical.phi-Zad.rotationVerticalOffset.min),this.maxPhi=lcd(this.spherical.phi+Zad.rotationVerticalOffset.max),this.minTheta=lcd(lcd(this.spherical.theta)-Zad.rotationHorizontalOffset.min),this.maxTheta=lcd(lcd(this.spherical.theta)+Zad.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,1===Zad.orbitTouches&&(this.touches[0]=M.ROTATE),1===Zad.panTouches&&(this.touches[0]=M.PAN),2===Zad.orbitTouches&&(this.touches[1]=M.DOLLY_ROTATE),2===Zad.panTouches&&(this.touches[1]=M.DOLLY_PAN),3===Zad.orbitTouches&&(this.touches[2]=M.ROTATE),3===Zad.panTouches&&(this.touches[2]=M.PAN),this.isTouchZoom=Zad.isTouchZoom,this.resetHoverEffectOnPointerLeave=Zad.resetHoverEffectOnPointerLeave?? !1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),0!==this.hoverRotatePanMode&&!this.useWindowEvents){let bbd=this.useWindowEvents?window:this.domElement;bbd.addEventListener("pointerleave",this.onPointerLeave),bbd.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(cbd,dbd,ebd,fbd,gbd,hbd,ibd,jbd){this.overShoot.set(0,0);let kbd,lbd,mbd;cbd instanceof fm?(kbd=cbd.x,lbd=cbd.y,this.current.set(this.target.x,this.target.y),mbd=!0):(kbd=cbd.theta,lbd=cbd.phi,this.current.set(lcd(this.spherical.theta),lcd(this.spherical.phi)),mbd=!1),0===ebd&&(this.current.x+=kbd,this.current.y+=lbd),(3===dbd||2===dbd)&&(!mbd&&this.isThetaFlipped?this.current.x>fbd&&this.current.x<0?this.overShoot.x=fbd-this.current.x:this.current.x<gbd&&this.current.x>0&&(this.overShoot.x=gbd-this.current.x):this.current.x>fbd?this.overShoot.x=fbd-this.current.x:this.current.x<gbd&&(this.overShoot.x=gbd-this.current.x)),(3===dbd||1===dbd)&&(this.current.y>hbd?this.overShoot.y=hbd-this.current.y:this.current.y<ibd&&(this.overShoot.y=ibd-this.current.y)),mbd||(this.overShoot.x=lcd(this.overShoot.x),this.overShoot.y=lcd(this.overShoot.y)),0!==ebd?(this.overRatio.copy(this.overShoot).divide(jbd),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),1===ebd&&(this.overRatio.x=mcd(Math.abs(this.overRatio.x)),this.overRatio.y=mcd(Math.abs(this.overRatio.y))),this.isPointerDown||1===ebd?2===ebd&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(kbd*this.overShoot.x<0&&!this.thetaIsFree&&(kbd*=1-this.overRatio.x),lbd*this.overShoot.y<0&&!this.phiIsFree&&(lbd*=1-this.overRatio.y)):2===ebd&&(!mbd&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||mbd&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(kbd=.05*this.overShoot.x),this.phiIsFree||(lbd=.05*this.overShoot.y),mbd?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):mbd?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(kbd+=this.overShoot.x,lbd+=this.overShoot.y),cbd instanceof fm?(cbd.x=kbd,cbd.y=lbd):(this.thetaIsFree||(cbd.theta=kbd),this.phiIsFree||(cbd.phi=lbd))}setEnableDampingSpeed(nbd){this.enableDamping=nbd,this.rotateSpeed=!0===nbd?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(obd){this.sphericalDelta.theta-=obd}rotateUp(pbd){this.sphericalDelta.phi-=pbd}panLeft(qbd,rbd){this.panLeftV.setFromMatrixColumn(rbd,0),this.panLeftV.multiplyScalar(-qbd),this.panOffset.add(this.panLeftV)}panUp(sbd,tbd){this.panUpV.setFromMatrixColumn(tbd,1),this.panUpV.multiplyScalar(sbd),this.panOffset.add(this.panUpV)}pan(ubd,vbd){let wbd=this.domElement;if(wbd&&this.object.isPerspectiveCamera){let xbd=this.object.position;this.panV.copy(xbd).sub(this.target);let ybd=this.panV.length();ybd*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*ubd*ybd/wbd.clientHeight,this.object.matrixWorld),this.panUp(2*vbd*ybd/wbd.clientHeight,this.object.matrixWorld)}else wbd&&this.object.isOrthographicCamera&&(this.panLeft(ubd*(this.object.right-this.object.left)/this.object.zoom/wbd.clientWidth,this.object.matrixWorld),this.panUp(vbd*(this.object.top-this.object.bottom)/this.object.zoom/wbd.clientHeight,this.object.matrixWorld));this.dispatchEvent(Fad)}dollyOut(zbd){this.object.isPerspectiveCamera?this.scale/=zbd:this.object.isOrthographicCamera&&(this.object.zoom*=zbd,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(Ead)}dollyIn(Abd){this.object.isPerspectiveCamera?this.scale*=Abd:this.object.isOrthographicCamera&&(this.object.zoom/=Abd,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(Ead)}zoomOut(Bbd=this.getZoomScale()){this.dispatchEvent(Gad),this.dollyOut(Bbd),this.dispatchEvent(Had)}zoomIn(Cbd=this.getZoomScale()){this.dispatchEvent(Gad),this.dollyIn(Cbd),this.dispatchEvent(Had)}handleMouseDownRotate(Dbd){this.rotateStart.set(Dbd.clientX,Dbd.clientY)}handleMouseDownDolly(Ebd){this.dollyStart.set(Ebd.clientX,Ebd.clientY)}handleMouseDownPan(Fbd){this.panStart.set(Fbd.clientX,Fbd.clientY)}handleMouseMoveRotate(Gbd,Hbd=1){void 0!==Gbd.movementX?this.rotateDelta.set(Gbd.movementX,Gbd.movementY):(this.rotateEnd.set(Gbd.clientX,Gbd.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*Hbd).rotateAround(Kad,-this.object.angleOffsetFromUp);let Ibd=this.domElement,Jbd=this.useWindowEvents?window.innerHeight:Ibd.clientHeight,Kbd=2*Math.PI*this.rotateDelta.x/Jbd,Lbd=2*Math.PI*this.rotateDelta.y/Jbd;this.rotateLeft(Kbd),this.rotateUp(Lbd),this.update()}handleMouseMoveDolly(Mbd){this.dollyEnd.set(Mbd.clientX,Mbd.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(Nbd,Obd=1){void 0!==Nbd.movementX?this.panDelta.set(Nbd.movementX,Nbd.movementY):(this.panEnd.set(Nbd.clientX,Nbd.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*Obd),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(Pbd){var Qbd;if(!1===Sya&& !1===Yya(Pbd)&& !0==(0===(Qbd=Pbd).wheelDeltaY||0===Qbd.deltaY?!(Qya&&Qbd.shiftKey&&Math.abs(Qbd.wheelDeltaX)>=120)&&(Qbd.wheelDeltaX?Qbd.wheelDeltaX=== -3*Qbd.deltaX||Qbd.wheelDeltaX=== -3*window.devicePixelRatio*Qbd.deltaX:0===Qbd.deltaMode):Qbd.wheelDeltaY?Qbd.wheelDeltaY=== -3*Qbd.deltaY||Qbd.wheelDeltaY=== -3*window.devicePixelRatio*Qbd.deltaY:0===Qbd.deltaMode))!1!==this.enablePan&&(this.gesture?(this.panDelta.set(-Pbd.deltaX,-Pbd.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),Pbd.altKey?this.pan(0,this.panDelta.y):Pbd.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30));else{if(!1===this.enableZoom)return;0===Pbd.deltaY?Pbd.deltaX<0?this.dollyIn(this.getZoomScale()):Pbd.deltaX>0&&this.dollyOut(this.getZoomScale()):Pbd.deltaY<0?this.dollyIn(this.getZoomScale()):Pbd.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(2===Zya.length){let Rbd=.5*(Zya[0].pageX+Zya[1].pageX),Sbd=.5*(Zya[0].pageY+Zya[1].pageY);this.rotateStart.set(Rbd,Sbd)}else this.rotateStart.set(Zya[0].pageX,Zya[0].pageY)}handleTouchStartPan(){if(2===Zya.length){let Tbd=.5*(Zya[0].pageX+Zya[1].pageX),Ubd=.5*(Zya[0].pageY+Zya[1].pageY);this.panStart.set(Tbd,Ubd)}else this.panStart.set(Zya[0].pageX,Zya[0].pageY)}handleTouchStartDolly(){let Vbd=Zya[0].pageX-Zya[1].pageX,Wbd=Zya[0].pageY-Zya[1].pageY;this.dollyStart.set(0,Math.sqrt(Vbd*Vbd+Wbd*Wbd))}handleTouchStartDollyPan(){this.enableZoom&& !0===this.isTouchZoom&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&& !0===this.isTouchZoom&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(Xbd){if(2===Zya.length){let Ybd=eza(Xbd),Zbd=.5*(Xbd.pageX+Ybd.x),$bd=.5*(Xbd.pageY+Ybd.y);this.rotateEnd.set(Zbd,$bd)}else{if(Xbd.pointerId!==Zya[0].pointerId)return;this.rotateEnd.set(Xbd.pageX,Xbd.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let _bd=this.domElement;_bd&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/_bd.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/_bd.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(acd){if(2===Zya.length){let bcd=eza(acd),ccd=.5*(acd.pageX+bcd.x),dcd=.5*(acd.pageY+bcd.y);this.panEnd.set(ccd,dcd)}else{if(acd.pointerId!==Zya[0].pointerId)return;this.panEnd.set(acd.pageX,acd.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(ecd){let fcd=eza(ecd),gcd=ecd.pageX-fcd.x,hcd=ecd.pageY-fcd.y;this.dollyEnd.set(0,Math.sqrt(gcd*gcd+hcd*hcd)),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(icd){this.enableZoom&& !0===this.isTouchZoom&&this.handleTouchMoveDolly(icd),this.enablePan&&this.handleTouchMovePan(icd)}handleTouchMoveDollyRotate(jcd){this.enableZoom&& !0===this.isTouchZoom&&this.handleTouchMoveDolly(jcd),this.enableRotate&&this.handleTouchMoveRotate(jcd)}checkRaycastLock(){if(!this.object.data.raycastLock)return!1;if(this.options.isPlayMode)return!1;{let kcd=this.options?.showCameraLock;return kcd&&kcd(),!0}}};function lcd(a){let b=2*Math.PI;for(;a<= -Math.PI;)a+=b;for(;a>Math.PI;)a-=b;return a}function mcd(a){return 1-Math.pow(1-a,4)}var ncd=class{constructor(ocd,pcd,qcd,rcd,scd,tcd){this.id=ocd,this.data=pcd,this.object=qcd,this.page=rcd,this.currentIntersectedObjects=[],this.disabled=!1,this.alreadyPlayedNonTogglingActions=new Set,this.actions=$Zc(pcd,pcd.actions,rcd,scd,tcd,qcd),this.target=pcd.target,this.useToggle="Toggle"===pcd.runMode,this.triggeringObjects=pcd.triggeringObjects.map(a=>rcd.scene.find(a))}isValidTriggeringObject(ucd){return"all"===this.target||this.triggeringObjects.some(a=>a===ucd||a.isAncestorOf(ucd.uuid)||ucd.isAncestorOf(a.uuid))}disconnect(){_Zc(this.actions)}dispatch(){this.disabled||this.object.destroyedInAction||(this.actions.Transition.forEach(a=>{a.object.currentTransitionEvent!==this?(a.object.currentTransitionEvent=this,a.init()):"Once"===this.data.runMode&&this.alreadyPlayedNonTogglingActions.add(a)}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.useToggle?(this.actions.Transition.forEach(a=>{a.toggle()}),this.actions.SwitchCamera.forEach(a=>{a.toggle()})):(this.actions.Transition.forEach(a=>{!1===this.alreadyPlayedNonTogglingActions.has(a)&&a.play()}),this.actions.SwitchCamera.forEach(a=>{a.play()})),this.actions.Link.forEach(a=>{a.dispatch()}),this.actions.Reset.forEach(a=>{a.dispatch()}),this.actions.Create.forEach(a=>{a.dispatch()}),this.actions.Destroy.forEach(a=>{a.dispatch(!1)}),this.actions.Audio.forEach(a=>{a.dispatchBasic()}),this.actions.Particles.forEach(a=>{a.dispatchBasic()}),this.actions.Video.forEach(a=>{a.dispatchBasic()}),this.actions.SceneTransition.forEach(a=>{a.dispatch()}),this.actions.SetVariable.forEach(a=>a.checkConditions()),this.actions.SetVariable.forEach(a=>a.dispatch()),this.actions.DynamicVariablePlay.forEach(a=>a.dispatch()))}};lza.then(a=>d=a);var vcd=new fm,wcd=new Fj,xcd=new fm,ycd=new Ex(0,0,0,"YXZ"),zcd=new Ex(0,0,0,"XYZ"),Acd=new fm,Bcd=new fm,Ccd=new fm(1,1,1),Dcd=new Fj,Ecd=new rs,Fcd=new rs,Gcd={type:"updateMatrix"},Hcd=new Fj,Icd=new pq,Jcd={type:"beginEvent",eventName:"Collision"},Kcd={type:"beginEvent",eventName:"Trigger"},Lcd=a=>a.states.some(a=>void 0!==a.data.position|| void 0!==a.data.rotation|| void 0!==a.data.hiddenMatrix|| void 0!==a.data.cloner|| void 0!==a.data.pathSnapping),Mcd=class{constructor(Ncd){this.eventContext=Ncd,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=a=>{if(a.bodyType()!==d.RigidBodyType.Dynamic)return;a.isSleeping()||this.nActiveRigidBodies++;let[b,c,e]=this.rigidBodyToMesh.get(a.handle);if(vcd.copy(a.translation()).multiplyScalar(this.pixelsPerMeter),wcd.copy(a.rotation()),b.matrixWorld.compose(vcd,wcd,c),b.hasNonUniformScale&&b.matrixWorld.multiply(b.shearScale),b.dispatchEvent(Gcd),e){let f=b.cloner;if(f&& void 0===f.objectForSample)for(let g of(f.matrixWorld.copy(b.matrixWorld),f.children))g.updateMatrixWorld(!0);for(let h of b.children)h.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(a,b,c)=>{if(!1===c)return;let d,e;if(this.sensorToTriggerEvent[a]?(d=this.sensorToTriggerEvent[a],e=this.sharedGameControlGlobals.colliderToEntity.get(b)):this.sensorToTriggerEvent[b]&&(d=this.sensorToTriggerEvent[b],e=this.sharedGameControlGlobals.colliderToEntity.get(a)),d&&e&&d.isValidTriggeringObject(e)){d.dispatch();return}for(let f=this.sharedGameControlGlobals.createdObjects.length-1;f>=0;f--){let g=this.sharedGameControlGlobals.createdObjects[f];if(g.userData.hasCollisionDestroy&&(g.rigidBody?.collider(0).handle===a||g.rigidBody?.collider(0).handle===b)){this.sharedGameControlGlobals.createdObjects.splice(f,1),g.removeFromParent(),requestAnimationFrame(()=>this.sharedGameControlGlobals.rapierWorld?.removeRigidBody(g.rigidBody));break}}if(this.gameControl?.object===this.sharedGameControlGlobals.colliderToEntity.get(a)){let h=this.sharedGameControlGlobals.colliderToEntity.get(b),i=this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid];if(void 0===i)return;for(let j of i)"character"===j.data.target&&this.dispatchCollisionEvent(j,h,b)}else if(this.gameControl?.object===this.sharedGameControlGlobals.colliderToEntity.get(b)){let k=this.sharedGameControlGlobals.colliderToEntity.get(a),l=this.sharedGameControlGlobals.entityToCollisionEvents[k.uuid];if(void 0===l)return;for(let m of l)"character"===m.data.target&&this.dispatchCollisionEvent(m,k,a)}else{let n=this.sharedGameControlGlobals.colliderToEntity.get(a),o=this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid];if(void 0!==o)for(let p of o)"scene"===p.data.target&&this.dispatchCollisionEvent(p,n,a);let q=this.sharedGameControlGlobals.colliderToEntity.get(b),r=this.sharedGameControlGlobals.entityToCollisionEvents[q?.uuid];if(void 0!==r)for(let s of r)"scene"===s.data.target&&this.dispatchCollisionEvent(s,q,b)}},this.isExport=Ncd.isExport,this.sharedAssets=Ncd.sharedAssets,this.renderer=Ncd.renderer,this.requestRender=Ncd.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=200,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(Ocd){Ocd.forEach(a=>{a.addEventListener("connected",a=>{"gamepad"in a.data&&"axes"in a.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(a.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(a=>{let b=a.dataPatched;for(let c of b.events){if(!0===c.data.disabled)continue;let d=c.data.actions?.find(a=>"Destroy"===a.data.type)?.data;if(d)for(let e of d.objects){let f=this.page.scene.find(e);f&&(f.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(a=>{let b=a.dataPatched;for(let c of b.events)if(!(!0===c.data.disabled||"DragDrop"!==c.data.type))for(let d of c.data.objects){let e=this.page.scene.find(d);e&&(e.userData.hasDrag=!0)}})}initBVH(){let Pcd=[];if(this.page.traverseChildren(a=>{let b;if(a instanceof E2b||a instanceof F7b||a instanceof XHc)return;let c=(b=a instanceof eSa?a.object:a).dataPatched;if(c.physics?.enabled==="visibility"?!c.visible:!c.physics?.enabled)return!0;let d=a.geometry,e=!0===b.userData.hasDestroy,f=!0===b.userData.hasDrag;if(Lcd(c)||e||f||b.dataPatched.events.some(a=>!0!==a.data.disabled&&"GameControl"===a.data.type))return a.updateMatrixWorldSVD(),this.addBoundsTree(a),!0;d&&Pcd.push(X0c(d,a.matrixWorld))}),Pcd.length>0){let Qcd=vKa(Pcd,!1);this.sharedGameControlGlobals.staticMeshBVH=new UOa(Qcd)}}addRigidBody(Rcd,Scd,Tcd){let Ucd=[],Vcd="geometry"in Rcd?Rcd.geometry:void 0,Wcd=Scd.dataPatched;if(void 0!==Vcd?.getAttribute("position")&&Ucd.push(X0c(Vcd,Rcd.shearScale)),Wcd.physics.fusedBody){let Xcd=this.gatherChildrenGeom(Rcd,Ucd);Rcd.traverseObject(Xcd),Rcd.children.forEach(a=>a.updateMatrixWorld(!0));let Ycd=Rcd.cloner;Ycd&& void 0===Ycd.objectForSample&&"dynamic"===Wcd.physics.rigidBody&&(Ycd.traverseObject(Xcd),Ycd.children.forEach(a=>a.updateMatrixWorld(!0)))}if(Ucd.length>0){let Zcd,$cd=!Tcd.fromCreate&&"dynamic"===Wcd.physics.rigidBody||Tcd.fromCreate&&Tcd.dynamic;$cd?(Zcd=d.RigidBodyDesc.dynamic()).setLinearDamping(Wcd.physics.damping).setAngularDamping(Wcd.physics.damping).setAdditionalMass(1e-9).setGravityScale(Wcd.physics.gravityScale).enabledRotations(...Wcd.physics.enabledRotation).enabledTranslations(...Wcd.physics.enabledTranslation):(Tcd.hasTransformAnim||Tcd.hasFollow||Tcd.hasDrag)&&!Tcd.fromCreate?(Zcd=d.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(Rcd)):Zcd=d.RigidBodyDesc.fixed();let _cd=vKa(Ucd);(Rcd.hasNonUniformScale?Rcd.matrixWorldRigid:Rcd.matrixWorld).decompose(vcd,wcd,xcd),Rcd.position0=vcd.clone().divideScalar(this.pixelsPerMeter),Rcd.rotation0=wcd.clone(),vcd.divideScalar(this.pixelsPerMeter),Zcd.setTranslation(vcd.x,vcd.y,vcd.z).setRotation(wcd),Vcd?_cd?.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):_cd?.scale(xcd.x/this.pixelsPerMeter,xcd.y/this.pixelsPerMeter,xcd.z/this.pixelsPerMeter);let add=this.sharedGameControlGlobals.rapierWorld.createRigidBody(Zcd);$cd&&this.rigidBodyToMesh.set(add.handle,[Rcd,xcd.clone(),Wcd.physics.fusedBody]);let bdd=!(void 0===Wcd.geometry||"SubdivGeometry"===Wcd.geometry.type||"NonParametricGeometry"===Wcd.geometry.type||"BooleanGeometry"===Wcd.geometry.type||"VectorGeometry"===Wcd.geometry.type||"StarGeometry"===Wcd.geometry.type||"RectangleGeometry"===Wcd.geometry.type||"EllipseGeometry"===Wcd.geometry.type||"TriangleGeometry"===Wcd.geometry.type||"TorusGeometry"===Wcd.geometry.type||"HelixGeometry"===Wcd.geometry.type);try{this.addCollider(add,Wcd.physics,_cd,Scd,bdd)}catch{try{this.addCollider(add,Wcd.physics,_cd,Scd,!1)}catch(cdd){console.error(cdd)}}Rcd.rigidBody=add}}addBoundsTree(ddd){let edd=[];if(void 0!==ddd.geometry?.getAttribute("position")&&ddd.geometry?.getAttribute("position").count>0&&edd.push(X0c(ddd.geometry,ddd.shearScale)),ddd.traverseObject(this.gatherChildrenGeom(ddd,edd)),ddd.children.forEach(a=>a.updateMatrixWorld(!0)),edd.length>0){let fdd=vKa(edd,!1);ddd.bvhGeometry=fdd,ddd.bvhGeometry.boundsTree=new UOa(fdd),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(ddd)}}addCollider(gdd,hdd,idd,jdd,kdd=!0){if(0===idd?.getAttribute("position").count||idd?.getIndex()?.count===0)return;let ldd;idd&&(ldd="trimesh"===hdd.colliderType?d.ColliderDesc.trimesh(idd.getAttribute("position").array,idd.getIndex().array):d.ColliderDesc.convexMesh(idd.getAttribute("position").array,kdd?idd.getIndex().array:void 0)),ldd.setFrictionCombineRule(d.CoefficientCombineRule.Average).setRestitutionCombineRule(d.CoefficientCombineRule.Average).setDensity(hdd.density).setFriction(hdd.friction).setRestitution(hdd.restitution);let mdd=this.sharedGameControlGlobals.rapierWorld.createCollider(ldd,gdd);this.sharedGameControlGlobals.colliderToEntity.set(mdd.handle,jdd),this.sharedGameControlGlobals.entityToCollisionEvents[jdd.uuid]?.some(a=>"scene"===a.target)&&mdd.setActiveEvents(d.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(ndd,odd){return(a,b)=>{if(0===b)return;let c;if(a instanceof E2b)if(!a.objectForSample)return!0===a.object.dataPatched.physics.fusedBody&&"dynamic"===a.object.dataPatched.physics.rigidBody||void 0;else{if(a.objectForSample.dataPatched.physics.fusedBody)return;c=a.object}else if(a instanceof eSa)c=a.object;else if((c=a).dataPatched.cloner?.hideBase)return!0;let d=c.dataPatched;if("visibility"===d.physics.enabled?!d.visible:!d.physics.enabled)return!0;1===b?ndd.hasNonUniformScale?a.matrixWorld.multiplyMatrices(ndd.shearScale,a.hiddenMatrix):a.matrixWorld.copy(a.hiddenMatrix):a.matrixWorld.multiplyMatrices(a.parent.matrixWorld,a.hiddenMatrix),a.matrixWorld.multiply(a.matrix);let e=a.geometry;void 0!==e?.getAttribute("position")&&odd.push(X0c(e,a.matrixWorld))}}activate(pdd){if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=pdd,this.usePhysics=this.page.data.globalPhysics.usePhysics;let qdd=this.page.playCamera,rdd=!1,sdd=5,tdd=8,udd=9,vdd="drag",wdd=this.page.data.publish.gameControlObject,xdd=null!==wdd?this.page.find(wdd):null,ydd=null;if(xdd)for(let zdd of xdd.data.events){if(zdd.data.disabled||"GameControl"!==zdd.data.type)break;let Add=xdd;for(;this.usePhysics&&(Add=Add.parent)?.parent!==null&&!Add.data.physics?.fusedBody;);zdd.data.collisionEnabled&&(this.needsCollisionDetection=!0),null===ydd&&(ydd=zdd.data)}if(this.page.traverseEntity(a=>{for(let b of a.dataPatched.events)if(!1===b.data.disabled&&"Trigger"===b.data.type)return this.needsCollisionDetection=!0,!0}),xdd&&ydd){rdd=rdd||ydd.camera===qdd.uuid||xdd.uuid===qdd.uuid;let Bdd=new V0c(xdd,this.renderer.domElement,ydd,this.eventContext.page.data.globalPhysics,this,xdd.uuid!==qdd.uuid&&ydd.camera===qdd.uuid,qdd,this.page,this.sharedAssets);this.gameControl=Bdd,sdd=ydd.joystickPosLoc,tdd=ydd.joystickRotLoc,udd=ydd.jumpTouchButtonLoc,vdd=ydd.rotByTouch,Tya&&ydd.touchControl&&(this.joystickToGameControls[sdd]="pos","walk"===ydd.moveMode&&(this.joystickToGameControls[udd]="jmp"),"joystick"===vdd&&(this.joystickToGameControls[tdd]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let Cdd=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new m8c(this.usePhysics,this.isExport);let Ddd;Ddd=Math.floor((Ddd="sphere"===Cdd.collider.type?2*Cdd.collider.radius:Cdd.collider.height)/Cdd.navmesh.ch-1),this.navigationMeshWrapper.init({...Cdd.navmesh,walkableHeight:Ddd},this.gameControl,this.eventContext)}}if(!1===rdd){let{enableRotate:Edd,enablePan:Fdd,enableZoom:Gdd,autoRotate:Hdd,hoverRotatePanMode:Idd}=this.eventManager.publish.orbitControls;(Edd||Fdd||Gdd||Hdd||0!==Idd)&&(this.orbitControls=new Sad(qdd,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let Jdd=this.renderer.domElement.width/this.renderer.getPixelRatio(),Kdd=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((a,b)=>{let c=document.body.appendChild(document.createElement("div")),[d,e,f]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[b],g=(Jdd-5*d)/4+d,h={},i="jmp"===a,j=i?0:d;for(let k in b<10?(b<5?h.top=j/2:h.bottom=j/2,h.left=j/2+b%5*g):10===b?(h.left=j/2,h.top=Kdd/2):(h.right=j/2,h.top=Kdd/2),h.top?h.top-=e[1]:h.bottom+=e[1],h.left?h.left+=e[0]:h.right-=e[0],h)h[k]+="px";if(i){let l=c.appendChild(document.createElement("div"));Object.assign(l.style,h,{position:"absolute",width:d+"px",height:d+"px",backgroundColor:`rgba(255,255,255,${"show"===f?.4:0})`,zIndex:"9999",borderRadius:d+"px",border:"show"===f?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let m=d/16*6.4;"show"===f&&(l.innerHTML=`
						<svg width="${m}" height="${.4*d}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),l.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),l.addEventListener("touchend",a=>a.preventDefault()),this.joysticks[b]=[void 0,c];return}let n={zone:c,mode:"static",position:h,size:d};"hide"===f&&(n.restOpacity=0);let o=IVc.create(n);o.on("move",(b,c)=>{let d=this.gameControl;"pos"===a?c.force<.2?d.moveForce=0:(d.movementState.movePosZ=Math.sin(-c.angle.radian),d.movementState.movePosX=Math.cos(-c.angle.radian),c.force>1.2?d.movementState.run=1:d.movementState.run=0,c.force<.3?d.moveForce=(c.force-.2)/.1:d.moveForce=1):"rot"===a&&(c.force<.2?d.rotForce=0:(d.movementState.rotPosX=c.vector.y,d.movementState.rotPosY=-c.vector.x,c.force<.3?d.rotForce=(c.force-.2)/.1:d.rotForce=1)),this.requestRender()}),o.on("end",(b,c)=>{let d=this.gameControl;"pos"===a?(d.movementState.movePosZ=0,d.movementState.movePosX=0,d.moveForce=1):"rot"===a&&(d.movementState.rotPosX=0,d.movementState.rotPosY=0,d.rotForce=1)}),this.joysticks[b]=[o,c]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(a=>a.disabled=!1)},80)}initPhysics(){this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=new d.World(new d.Vector3(0,this.gravity,0)),this.events=new d.EventQueue(!0);let Ldd=[],Mdd=[];if(this.page.traverseChildren(a=>{let b;if(a instanceof E2b)if(!a.objectForSample)return!0===a.object.dataPatched.physics.fusedBody&&"dynamic"===a.object.dataPatched.physics.rigidBody||void 0;else{if(a.objectForSample.dataPatched.physics.fusedBody)return;b=a.object}else if(a instanceof eSa)b=a.object;else{if(a instanceof XHc||a instanceof F7b)return;if((b=a).dataPatched.cloner?.disabled=== !1&&b.dataPatched.cloner?.hideBase&&b.dataPatched.physics?.fusedBody!== !0)return!0}let c=b.dataPatched,e;for(let f of c.events)!0!==f.data.disabled&&"GameControl"===f.data.type&&(e=f.data);if(!c.physics||("visibility"===c.physics.enabled?!c.visible:!c.physics.enabled))return!0;a.updateMatrixWorldSVD();let g=Lcd(c),h=!1,i=b.userData.hasDestroy,j=b.userData.hasDrag,k=!1;for(let l of c.events)if(!0!==l.data.disabled){if("Collision"===l.data.type){h=!0;let m=new H7c(l.id,l.data,b,this.page,this.sharedAssets,this.eventManager);m.disabled=!0,this.collisionEvents.push(m),this.sharedGameControlGlobals.entityToCollisionEvents[b.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[b.uuid].every(a=>a.id!==l.id)?this.sharedGameControlGlobals.entityToCollisionEvents[b.uuid].push(m):this.sharedGameControlGlobals.entityToCollisionEvents[b.uuid]=[m]}else if("Follow"===l.data.type){k=!0;let n=l.data.target;a.traverseVisible(a=>{a.userData.isFollowingObj=n})}}"dynamic"===c.physics.rigidBody&& !1===c.physics.fusedBody&&(a.matrixWorldFusedFalse=a.matrixWorld.clone());let o=a.geometry;if(void 0!==e){let p=d.RigidBodyDesc.kinematicPositionBased();(a.hasNonUniformScale?a.matrixWorldRigid:a.matrixWorld).decompose(vcd,wcd,xcd),a.position0=vcd.clone().divideScalar(this.pixelsPerMeter),a.rotation0=wcd.clone(),vcd.divideScalar(this.pixelsPerMeter),p.setTranslation(vcd.x,vcd.y,vcd.z).setRotation(wcd);let q=this.sharedGameControlGlobals.rapierWorld.createRigidBody(p);a.rigidBody=q;let r;(r="sphere"===e.collider.type?d.ColliderDesc.ball(e.collider.radius/this.pixelsPerMeter):"capsule"===e.collider.type?d.ColliderDesc.capsule((e.collider.height/2-e.collider.radius)/this.pixelsPerMeter,e.collider.radius/this.pixelsPerMeter):d.ColliderDesc.cuboid(e.collider.width/this.pixelsPerMeter/2,e.collider.height/this.pixelsPerMeter/2,e.collider.depth/this.pixelsPerMeter/2)).setFrictionCombineRule(d.CoefficientCombineRule.Average).setRestitutionCombineRule(d.CoefficientCombineRule.Average).setDensity(c.physics.density).setFriction(c.physics.friction).setRestitution(c.physics.restitution);let s=this.sharedGameControlGlobals.rapierWorld.createCollider(r,q);this.sharedGameControlGlobals.colliderToEntity.set(s.handle,b),vcd.fromArray(e.collider.position).multiply(xcd.setFromMatrixScale(b.matrixWorld)).divideScalar(this.pixelsPerMeter),s.setTranslationWrtParent(vcd);let t=new Fj().setFromEuler(new Ex().setFromVector3(new fm().fromArray(e.collider.rotation)));s.setRotationWrtParent(t),s.setActiveEvents(d.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(b,!0)}else"dynamic"===c.physics.rigidBody||g||k||i||j||h?(this.addRigidBody(a,b,{hasFollow:k,hasTransformAnim:g,hasDrag:j}),this.generateSensorColliderDescs(b,c.physics.fusedBody)):(o&&Ldd.push(X0c(o,a.matrixWorld)),c.physics.fusedBody&&a.traverseObject((a,b)=>{if(0===b)return;let c;if(a instanceof E2b)if(!a.objectForSample)return!0===a.object.dataPatched.physics.fusedBody&&"dynamic"===a.object.dataPatched.physics.rigidBody||void 0;else{if(a.objectForSample.dataPatched.physics.fusedBody)return;c=a.object}else{if(a instanceof XHc||a instanceof F7b)return;if(a instanceof eSa)c=a.object;else if((c=a).dataPatched.cloner?.hideBase)return!0}let d=c.dataPatched;if("visibility"===d.physics.enabled?!d.visible:!d.physics.enabled)return!0;let e=a.geometry;void 0!==e?.getAttribute("position")&&Ldd.push(X0c(e,a.matrixWorld))}),this.generateSensorColliderDescs(b,c.physics.fusedBody,Mdd));if(c.physics?.fusedBody=== !0||e)return!0}),0===Ldd.length)return;let Ndd=vKa(Ldd);Ndd.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let Odd=d.RigidBodyDesc.fixed(),Pdd=this.sharedGameControlGlobals.rapierWorld.createRigidBody(Odd),Qdd=d.ColliderDesc.trimesh(Ndd.getAttribute("position").array,Ndd.getIndex().array).setFrictionCombineRule(d.CoefficientCombineRule.Multiply).setRestitutionCombineRule(d.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);for(let[Rdd,Sdd]of(this.sharedGameControlGlobals.rapierWorld.createCollider(Qdd,Pdd),Mdd)){let Tdd=this.sharedGameControlGlobals.rapierWorld.createCollider(Rdd,Pdd);this.sensorToTriggerEvent[Tdd.handle]=Sdd}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(a=>{for(let b of a.dataPatched.events)if("Trigger"===b.data.type&& !0!==b.data.disabled){let c=new ncd(b.id,b.data,a,this.page,this.sharedAssets,this.eventManager),d=new rs().compose(Acd.fromArray(b.data.position),Dcd.setFromEuler(zcd.fromArray(b.data.rotation)),Ccd);if("box"===b.data.triggerZone){let e=new Io;e.min.fromArray(b.data.size).multiplyScalar(-0.5),e.max.fromArray(b.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([e,d,a,c])}else this.sharedGameControlGlobals.triggers.push([b.data.radius,d,a,c])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(a=>a.disconnect()),this.sharedGameControlGlobals.triggers.forEach(a=>a[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){if(this.isEnabled){for(let Udd of(this.isEnabled=!1,this.page.traverse(a=>{let b=a;b.matrixWorldFusedFalse&&(b.matrixWorldFusedFalse=void 0),b.rigidBody&&(b.rigidBody=void 0),b.position0&&(b.position0=void 0),b.rotation0&&(b.rotation0=void 0)}),this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),this.gameControl?.reset(),this.gameControl?.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([a,b])=>{a?.destroy(),b.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),this.navigationMeshWrapper?.dispose(),this.navigationMeshWrapper=void 0,Object.values(this.sharedGameControlGlobals.entityToCollisionEvents)))Udd.forEach(a=>a.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(Vdd,Wdd,Xdd){if(!this.isEnabled)return!0;let Ydd=!0;if(void 0!==this.orbitControls&&this.orbitControls.needsUpdate&&(Ydd=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,Ydd=!1):2===this.initializationCounter&&this.gameControl&&(Ydd=!this.gameControl.update(Vdd,Wdd,Xdd)&&Ydd),!1===this.usePhysics&&this.checkTrigger(),this.usePhysics){let Zdd=.016666666666666666;if(0===Vdd)Ydd=this.stepPhysics()&&Ydd;else{let $dd=Vdd/1e3;$dd<Zdd&&$dd>.55*Zdd&&($dd=Zdd),this.accumulator+=$dd;let _dd=performance.now(),aed=0,bed=6;for(;this.accumulator>=Zdd&&aed<bed&&(Ydd=this.stepPhysics()&&Ydd,this.accumulator-=Zdd,aed++,!(performance.now()-_dd>1e3*Zdd)););this.accumulator=this.accumulator%Zdd}}return Ydd}stepPhysics(){for(let ced of this.sharedGameControlGlobals.entitiesWithTransformAnim){(ced.hasNonUniformScale?ced.matrixWorldRigid:ced.matrixWorld).decompose(vcd,wcd,xcd),ycd.setFromQuaternion(wcd);let ded=ced;void 0===ded.prevR?(ded.prevR=ycd.clone(),ded.prevT=vcd.clone()):(ded.prevR.copy(ycd),ded.prevT.copy(vcd)),ced.rigidBody&&(ced.rigidBody.setNextKinematicTranslation(vcd.divideScalar(this.pixelsPerMeter)),ced.rigidBody.setNextKinematicRotation(wcd))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),this.events?.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(eed,fed,ged){let hed=this.sharedGameControlGlobals.rapierWorld?.getCollider(ged)._parent,ied;if(fed.cloner){for(let jed of fed.cloner.children)if(jed.rigidBody===hed){ied=jed;break}}eed.dispatch(ied),fed.dispatchEvent(Jcd)}updateUseWindowEvents(ked){this.orbitControls?.updateUseWindowEvents(ked)}generateSensorColliderDescs(led,med,ned){let oed=Fcd.copy(led.matrixWorld).invert();led.traverseEntity((a,b)=>{if(!1===med&&1===b)return!0;for(let c of a.dataPatched.events)if("Trigger"===c.data.type&& !0!==c.data.disabled){let e=new ncd(c.id,c.data,a,this.page,this.sharedAssets,this.eventManager),f;if((f="box"===c.data.triggerZone?d.ColliderDesc.cuboid(...c.data.size.map(a=>a/(2*this.pixelsPerMeter))):d.ColliderDesc.ball(c.data.radius/this.pixelsPerMeter)).setDensity(0).setSensor(!0).setActiveEvents(d.ActiveEvents.COLLISION_EVENTS),Acd.fromArray(c.data.position),Dcd.setFromEuler(zcd.fromArray(c.data.rotation)),Ecd.compose(Acd,Dcd,Ccd).premultiply(a.matrixWorld),ned?(Ecd.decompose(Acd,Dcd,Bcd),f.setActiveCollisionTypes(d.ActiveCollisionTypes.KINEMATIC_FIXED|d.ActiveCollisionTypes.DYNAMIC_FIXED)):(Ecd.premultiply(oed).decompose(Acd,Dcd,Bcd),led.rigidBody.bodyType()===d.RigidBodyType.Dynamic||(led.rigidBody.bodyType()===d.RigidBodyType.Fixed?f.setActiveCollisionTypes(d.ActiveCollisionTypes.KINEMATIC_FIXED|d.ActiveCollisionTypes.DYNAMIC_FIXED):f.setActiveCollisionTypes(d.ActiveCollisionTypes.KINEMATIC_KINEMATIC|d.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),Acd.divideScalar(this.pixelsPerMeter),f.setTranslation(Acd.x,Acd.y,Acd.z),f.setRotation(Dcd),ned)ned.push([f,e]);else{let g=this.sharedGameControlGlobals.rapierWorld.createCollider(f,led.rigidBody);this.sensorToTriggerEvent[g.handle]=e}}})}checkTrigger(){let ped;for(let qed=0;qed<this.sharedGameControlGlobals.triggers.length;qed++){let[red,sed,ted,ued]=this.sharedGameControlGlobals.triggers[qed];for(let ved=0;ved<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;ved++){let wed=this.sharedGameControlGlobals.entitiesWithTransformAnim[ved];if(ted===wed|| !1===ued.isValidTriggeringObject(Fsb.is(wed)?wed:wed.object))continue;let xed=Fcd.copy(ted.matrixWorld).decompose(Acd,Hcd,Bcd).compose(Acd,Hcd,Ccd).multiply(sed),yed=Ecd.copy(wed.matrixWorld).invert().multiply(xed);red instanceof Io?ped=wed.bvhGeometry.boundsTree.intersectsBox(red,yed):(Icd.radius=red,Icd.center.setFromMatrixPosition(yed),ped=wed.bvhGeometry.boundsTree.intersectsSphere(Icd)),ped?-1===ued.currentIntersectedObjects.indexOf(wed)&&(ued.currentIntersectedObjects.push(wed),ued.dispatch(),ted.dispatchEvent(Kcd)):ued.currentIntersectedObjects=ued.currentIntersectedObjects.filter(a=>a!==wed)}}}};function zed(a){let b=this._clip.duration,c=this._clip.start??0,d=this.loop,e=this.time+a,f=this._loopCount,g=d===Ja;if(0===a)return -1===f?e:g&&(1&f)==1?b-(e-c):e;if(d===Ha){-1===f&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(e>=b)e=b;else if(e<0)e=0;else{this.time=e;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:a<0?-1:1})}}else{if(-1===f&&(a>=0?(f=0,this._setEndings(!0,0===this.repetitions,g)):this._setEndings(0===this.repetitions,!0,g)),e>=b||e<c){let h=Math.floor((e-c)/(b-c));e-=(b-c)*h,f+=Math.abs(h);let i=this.repetitions-f;if(i<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,g||(e=a>0?b:c,1===this.repetitions&&(e=b)),this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:a>0?1:-1});else{if(1===i){let j=a<0;this._setEndings(j,!j,g)}else this._setEndings(!1,!1,g);this._loopCount=f,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:h})}}else this.time=e;if(g&&(1&f)==1)return b-(e-c)}return e}var Aed=!1,Bed=class{constructor(Ced,Ded,Eed,Fed){this.scene=Ced,this.requestRender=Ded,this.updateDisplayProgress=Eed,this.animationInspectorState=Fed,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=a=>{"Empty"===a.data.type&&a.data.animations&&a.data.animations.forEach((b,c)=>{let d=b[0]+"/";if(Array.isArray(a.identity)?d+=a.identity[0]:d+=a.uuid,this.clipIdToAction[d])return;let e=sca.parse(JSON.parse(b[2]));a.animations[c]=e;let f=this.mixer.clipAction(e,a);!1===Aed&&(Object.getPrototypeOf(f)._updateTime=zed,Aed=!0),f.clampWhenFinished=!0,this.clipIdToAction[d]=f})},this.mixer=new Nla(Ced),this.scene.traverseEntity(this.addClip)}deleteClip(Ged,Hed){let Ied=this.scene.find(Hed);if(!Ied)return;let Jed=Ied.animations.find(a=>a.uuid===Ged);if(!Jed)return;let Ked=this.clipIdToAction[Ged];Ked&&(Ked.stop(),this.mixer.uncacheClip(Jed),delete this.clipIdToAction[Ged],Ied.animations=Ied.animations.filter(a=>a.uuid!==Ged))}get isPlaying(){return Object.values(this.clipIdToAction).some(a=>a.isRunning())}playFromInspector(Led){this.mixer.stopAllAction();let Med=this.clipIdToAction[Led];Med&&(Med.play(),this.activeClip=Med.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(a=>{a.repetitions=1/0,a.loop=Ia}),this.mixer.stopAllAction(),this.requestRender()}play(Ned){let Oed=Ned.clipId+"/"+Ned.object,Ped=this.clipIdToAction[Oed];if(Ped)return Ned&&(Ned.repeat>=0&&(Ped.repetitions=Ned.repeat+1),"pingpong"===Ned.direction&&0!==Ned.repeat&&(Ped.loop=Ja)),Ped.play(),Ped.paused=!1,this.requestRender(),Ped}resumeFromInspector(Qed){let Red=this.clipIdToAction[Qed];Red&&(Red.play(),Red.paused=!1,this.requestRender())}pauseFromInspector(Sed){let Ted=this.clipIdToAction[Sed];Ted&&(Ted.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(Ued){if(this.needsUpdate)this.needsUpdate=!1;else if(!1===this.isPlaying||this.animationInspectorState?.isScrubbing)return;this.mixer.update(Ued/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*this.maxFrames%this.maxFrames)),this.requestRender()}get maxFrames(){return this.activeClip?.tracks[0]?.times.length??0}setProgressFromInspector(Ved,Wed){if(!this.clipIdToAction[Wed])return;this.activeClip!==this.clipIdToAction[Wed].getClip()&&this.playFromInspector(Wed);let Xed=this.clipIdToAction[Wed].paused;this.clipIdToAction[Wed].paused=!1,this.mixer.setTime(Math.min(this.maxFrames?Ved/this.maxFrames:0,.9999)*this.activeClip.duration),this.requestRender(),Xed&&(this.clipIdToAction[Wed].paused=!0)}},Yed=new WeakMap,Zed=class extends _da{constructor($ed){super($ed),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(_ed){return this.decoderPath=_ed,this}setDecoderConfig(afd){return this.decoderConfig=afd,this}setWorkerLimit(bfd){return this.workerLimit=bfd,this}load(cfd,dfd,efd,ffd){let gfd=new nea(this.manager);gfd.setPath(this.path),gfd.setResponseType("arraybuffer"),gfd.setRequestHeader(this.requestHeader),gfd.setWithCredentials(this.withCredentials),gfd.load(cfd,a=>{this.decodeDracoFile(a,dfd).catch(ffd)},efd,ffd)}decodeDracoFile(hfd,ifd,jfd,kfd){let lfd={attributeIDs:jfd||this.defaultAttributeIDs,attributeTypes:kfd||this.defaultAttributeTypes,useUniqueIDs:!!jfd};return this.decodeGeometry(hfd,lfd).then(ifd)}decodeGeometry(mfd,nfd){let ofd=JSON.stringify(nfd);if(Yed.has(mfd)){let pfd=Yed.get(mfd);if(pfd.key===ofd)return pfd.promise;if(0===mfd.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let qfd,rfd=this.workerNextTaskID++,sfd=mfd.byteLength,tfd=this._getWorker(rfd,sfd).then(a=>(qfd=a,new Promise((a,b)=>{qfd._callbacks[rfd]={resolve:a,reject:b},qfd.postMessage({type:"decode",id:rfd,taskConfig:nfd,buffer:mfd},[mfd])}))).then(a=>this._createGeometry(a.geometry));return tfd.catch(()=>!0).then(()=>{qfd&&rfd&&this._releaseTask(qfd,rfd)}),Yed.set(mfd,{key:ofd,promise:tfd}),tfd}_createGeometry(ufd){let vfd=new nE;ufd.index&&vfd.setIndex(new RC(ufd.index.array,1));for(let wfd=0;wfd<ufd.attributes.length;wfd++){let xfd=ufd.attributes[wfd],yfd=xfd.name,zfd=xfd.array,Afd=xfd.itemSize;vfd.setAttribute(yfd,new RC(zfd,Afd))}return vfd}_loadLibrary(Bfd,Cfd){let Dfd=new nea(this.manager);return Dfd.setPath(this.decoderPath),Dfd.setResponseType(Cfd),Dfd.setWithCredentials(this.withCredentials),new Promise((a,b)=>{Dfd.load(Bfd,a,void 0,b)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let Efd="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,Ffd=[];return Efd?Ffd.push(this._loadLibrary("draco_decoder.js","text")):(Ffd.push(this._loadLibrary("draco_wasm_wrapper.js","text")),Ffd.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(Ffd).then(a=>{let b=a[0];Efd||(this.decoderConfig.wasmBinary=a[1]);let c=Lfd.toString(),d=["/* draco decoder */",b,"","/* worker */",c.substring(c.indexOf("{")+1,c.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([d]))}),this.decoderPending}_getWorker(Gfd,Hfd){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let a=new Worker(this.workerSourceURL);a._callbacks={},a._taskCosts={},a._taskLoad=0,a.postMessage({type:"init",decoderConfig:this.decoderConfig}),a.onmessage=function(b){let c=b.data;switch(c.type){case"decode":a._callbacks[c.id].resolve(c);break;case"error":a._callbacks[c.id].reject(c);break;default:console.error("THREE.DRACOLoader: Unexpected message, \""+c.type+"\"")}},this.workerPool.push(a)}else this.workerPool.sort(function(a,b){return a._taskLoad>b._taskLoad?-1:1});let b=this.workerPool[this.workerPool.length-1];return b._taskCosts[Gfd]=Hfd,b._taskLoad+=Hfd,b})}_releaseTask(Ifd,Jfd){Ifd._taskLoad-=Ifd._taskCosts[Jfd],delete Ifd._callbacks[Jfd],delete Ifd._taskCosts[Jfd]}debug(){console.log("Task load: ",this.workerPool.map(a=>a._taskLoad))}dispose(){for(let Kfd=0;Kfd<this.workerPool.length;++Kfd)this.workerPool[Kfd].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}};function Lfd(){let a,b;function c(a,b,c,e,f,g){let h=g.num_components(),i=c.num_points()*h,j=i*f.BYTES_PER_ELEMENT,k=d(a,f),l=a._malloc(j);b.GetAttributeDataArrayForAllPoints(c,g,k,j,l);let m=new f(a.HEAPF32.buffer,l,i).slice();return a._free(l),{name:e,array:m,itemSize:h}}function d(a,b){switch(b){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}onmessage=function(d){let e=d.data;switch(e.type){case"init":a=e.decoderConfig,b=new Promise(function(b){a.onModuleLoaded=function(a){b({draco:a})},DracoDecoderModule(a)});break;case"decode":let f=e.buffer,g=e.taskConfig;b.then(a=>{let b=a.draco,d=new b.Decoder,h=new b.DecoderBuffer;h.Init(new Int8Array(f),f.byteLength);try{let i=function(a,b,d,e){let f=e.attributeIDs,g=e.attributeTypes,h,i,j=b.GetEncodedGeometryType(d);if(j===a.TRIANGULAR_MESH)h=new a.Mesh,i=b.DecodeBufferToMesh(d,h);else if(j===a.POINT_CLOUD)h=new a.PointCloud,i=b.DecodeBufferToPointCloud(d,h);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!i.ok()||0===h.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+i.error_msg());let k={index:null,attributes:[]};for(let l in f){let m=self[g[l]],n,o;if(e.useUniqueIDs)o=f[l],n=b.GetAttributeByUniqueId(h,o);else{if(-1===(o=b.GetAttributeId(h,a[f[l]])))continue;n=b.GetAttribute(h,o)}k.attributes.push(c(a,b,h,l,m,n))}return j===a.TRIANGULAR_MESH&&(k.index=(function(a,b,c){let d=3*c.num_faces(),e=4*d,f=a._malloc(e);b.GetTrianglesUInt32Array(c,e,f);let g=new Uint32Array(a.HEAPF32.buffer,f,d).slice();return a._free(f),{array:g,itemSize:1}})(a,b,h)),a.destroy(h),k}(b,d,h,g),j=i.attributes.map(a=>a.array.buffer);i.index&&j.push(i.index.array.buffer),self.postMessage({type:"decode",id:e.id,geometry:i},j)}catch(k){console.error(k),self.postMessage({type:"error",id:e.id,error:k.message})}finally{b.destroy(h),b.destroy(d)}});break}}}async function Mfd(a){if(e){let b={attributeIDs:e.defaultAttributeIDs,attributeTypes:e.defaultAttributeTypes,useUniqueIDs:!1},c;try{c=await e.decodeGeometry(new Int8Array(a).buffer,b)}catch(d){console.error(d)}if(c)return{index:c.index?{array:c.index.array}:void 0,attributes:Object.entries(c.attributes).map(([a,b])=>({name:a,itemSize:b.itemSize,array:b.array}))}}return null}async function Nfd(a,b){let[c,d]=QFa(vIa.deserialize(new Uint8Array(a)));uKa(c);let f=[];for(let g of(c.scene.objects.traverse((a,b)=>{"Mesh"===b.type&&"NonParametricGeometry"===b.geometry.type&& void 0!==b.geometry.data.draco&&f.push(b)}),f.length&&await (e||(e=new Zed).setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload(),e.decoderPending),f)){let h=await Mfd(SFa(g.geometry.data.draco));if(h){h.index&&(g.geometry.data.index={array:h.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let i={};h.attributes.forEach(({name:a,array:b,itemSize:c})=>{i[a]={array:b,itemSize:c,type:"Float32Array",normalized:!1}}),g.geometry.data.attributes=i,g.geometry.data.draco=void 0}}return b&&b(c),d.result().data}var Ofd=class{constructor(Pfd,Qfd,Rfd,Sfd,Tfd,Ufd,Vfd){this.id=Pfd,this.data=Qfd,this.dataEvent=Rfd,this.object=Sfd,this.stage=!1,this.actions=$Zc(Rfd,Qfd.actions,Tfd,Ufd,Vfd,Sfd)}disconnect(){_Zc(this.actions)}dispatchIn(){this.actions.Audio.forEach(a=>a.dispatchBasic()),this.actions.Particles.forEach(a=>a.dispatchBasic()),this.actions.Video.forEach(a=>a.dispatchBasic()),this.actions.Create.forEach(a=>a.dispatch()),this.actions.Destroy.forEach(a=>a.dispatch()),this.actions.Reset.forEach(a=>a.dispatch()),this.actions.Link.forEach(a=>a.dispatch()),this.actions.Transition.forEach(a=>{a.object.currentTransitionEvent!==this&&(a.object.currentTransitionEvent=this,a.init())}),this.actions.Transition.forEach(a=>a.toggle()),this.actions.Animation.forEach(a=>a.play()),this.actions.SwitchCamera.forEach(a=>a.play()),this.actions.SceneTransition.forEach(a=>a.dispatch()),this.actions.SetVariable.forEach(a=>a.checkConditions()),this.actions.SetVariable.forEach(a=>a.dispatch()),this.actions.DynamicVariablePlay.forEach(a=>a.dispatch())}dispatchOut(){this.actions.Transition.forEach(a=>{a.toggle()})}},Wfd=class extends O1c{constructor(Xfd,Yfd){super(Xfd),this.eventManager=Yfd,this.breakpoints=[],this.resize=(a,b)=>{this.breakpoints.forEach(c=>{let d=tJa.deviceToSize(c.data.size),e="horizontal"===c.dataEvent.orientation?a:b,f;switch(c.data.operator){case"<":f=e<d[0];break;case">":f=e>d[0];break;case"<>":f=e>d[0]&&e<d[1];break}c.stage!==f&&(c.stage=f,c.stage?c.dispatchIn():c.dispatchOut())})},this.onResizeObserver=new ResizeObserver(a=>{for(let b of a){let{width:c,height:d}=b.contentRect;this.resize(c,d)}})}connect(){let{page:Zfd,sharedAssets:$fd,domElement:_fd}=this.eventContext;this.onResizeObserver.observe(_fd);let agd=a=>{if(!(!a.visible||!a.data?.events.length))for(let{data:b}of a.data.events)b.disabled||"Resize"===b.type&&b.breakpoints.forEach(({data:c,id:d})=>{try{let e=new Ofd(d,c,b,a,Zfd,$fd,this.eventManager);this.breakpoints.push(e)}catch(f){}})};Zfd.traverseEntity(a=>{(a instanceof jEc||a instanceof aCc)&&a.frame?.traverse(a=>{agd(a)}),agd(a)})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(a=>{a.disconnect()}),this.breakpoints=[]}},bgd=class{constructor(cgd,dgd,egd,fgd,ggd){this.publish=cgd,this.controlsManager=dgd,this.animationControls=egd,this.eventContext=fgd,this.sharedVariables=ggd,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=a=>{(a.touches.length>1||this.preventTouchScroll)&&a.preventDefault()},this.onMouseWheelPreventScroll=a=>{this.preventScroll&&a.preventDefault()},this.onMouseMove=a=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(a),pressed:a.buttons>0}},this.onMouseDown=a=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(a),pressed:!0}},this.onMouseUp=a=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(a),pressed:!1}},this.getMousePosition=a=>{let{domRect:b}=this.eventContext,{pageX:c,pageY:d}=a.touches?.length>0?a.touches[0]:a;return{x:c-(b.left+window.scrollX),y:d-(b.top+window.scrollY)}},this.stopRaycast=cgd.stopRaycast,this.preventScroll=cgd.preventScroll,this.preventTouchScroll=cgd.preventTouchScroll,this.hideCursor=cgd.hideCursor,this.requestRender=fgd.requestRender}activate(){if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new U1c(this.eventContext),DynamicVariable:new P7c(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),["Conditional"]:new t3c(this.eventContext,this),["Start"]:new v7c(this.eventContext,this),Basic:new f2c(this.eventContext,this,this.needsRaycast),["MouseHover"]:new h6c(this.eventContext,this),["Scroll"]:new e7c(this.eventContext,this),["Follow"]:new F4c(this.eventContext,this),["DragDrop"]:new W3c(this.eventContext,this),["LookAt"]:new t5c(this.eventContext),["Resize"]:new Wfd(this.eventContext,this)};let{page:hgd,domElement:igd}=this.eventContext;this.hideCursor&&(igd.style.cursor="none"),hgd.traverseEntity(a=>{a.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(a=>a.connect()),igd.addEventListener("wheel",this.onMouseWheelPreventScroll),igd.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++}deactivate(){if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:jgd,domElement:kgd}=this.eventContext;kgd.style.cursor="",Object.values(this.handlers).forEach(a=>a.disconnect()),this.controlsManager.gameControl?.disposeActions(),this.controlsManager.disconnectEvents(),jgd.traverseEntity(a=>{a.removeEventListener("requestRender",this.requestRender),a.destroyedInAction=!1}),kgd.removeEventListener("touchmove",this.onTouchMovePreventScroll),kgd.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode()}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(),this.activate(),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(lgd){let mgd=this.isEnabled;mgd&&this.deactivate(),this.eventContext.useWindowEvents=lgd,mgd&&this.activate()}initializeActionsDependentStates(){let ngd=this.eventContext.sharedAssets;ngd.resetDynamicVariablePlayState();let ogd=a=>{if("Conditional"===a.data.type&&(a.data.ifActions.forEach(ogd),a.data.elseActions.forEach(ogd)),"Conditional"===a.data.type||"SetVariable"===a.data.type)for(let b of"Conditional"===a.data.type?a.data.condition:a.data.expression)"id"in b&&Array.isArray(b.id)&&("mouse"===b.id[0]&&(this.needsMouse=!0),"raycast"===b.id[0]&&(this.needsRaycast=!0));"DynamicVariablePlay"===a.data.type&&""!==a.data.variableId&&("Play"===a.data.mode||"PlayPause"===a.data.mode||"Toggle"===a.data.mode)&&ngd.setDynamicVariablePlayState(a.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(a=>{if(a.data?.events.length){for(let b of a.data.events)if(!b.data.disabled)if("VariableChange"===b.data.type&&("mouseProperty"===b.data.variableId&&(this.needsMouse=!0),"raycastProperty"===b.data.variableId&&(this.needsRaycast=!0)),"Conditional"===b.data.type)for(let c of["inActions","outActions"])b.data[c].forEach(ogd);else if("DragDrop"===b.data.type)for(let d of["drag","drop"])b.data.dragDropActions[d].forEach(ogd);else if("GameControl"===b.data.type)for(let e of["idle","move","jump","run"])b.data.gameActions[e].forEach(ogd);else if("Resize"===b.data.type)for(let f of b.data.breakpoints)f.data.actions.forEach(ogd);else"LookAt"===b.data.type||b.data.actions.forEach(ogd)}})}},pgd=class{constructor(qgd,rgd,sgd,tgd,ugd){this._aspect=1,this.enableResponsive=!1,this._renderer=qgd,this._camera=rgd,this._frameSize=new Eb().copy(sgd),this._editorSize=new Eb().copy(tgd),this._aspect=rgd.aspect,this._fov=ugd??rgd.fov}set frameSize(vgd){this._frameSize.copy(vgd)}updateRenderer(){this._renderer&&this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||"PerspectiveCamera"!==this._camera.cameraType)return;let wgd=this._frameSize.x,xgd=this._frameSize.y,ygd=this._editorSize.y;this._aspect=wgd/xgd,xgd<=ygd&&(this._camera.zoom*=ygd/xgd),this._renderer.setViewport(0,0,wgd,xgd)}updateCamera(zgd=!0){if(this._camera)if("PerspectiveCamera"===this._camera.cameraType){let Agd=this._frameSize.y,Bgd=this._editorSize.y,Cgd=this._fov;if(zgd&&Agd>Bgd){let Dgd=Hgd(Agd,1080,2160,1,15)/100;Cgd*=Agd/Bgd,Cgd*=1-Dgd}this._camera.aspect=this._aspect,this._camera.fov=Cgd,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(Egd){this._camera=Egd,this._aspect=Egd.aspect,this._fov=Egd.fov}revert(){let Fgd=window.innerWidth,Ggd=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,Fgd,Ggd),this._renderer.setSize(Fgd,Ggd)),this._camera&&(this._camera.aspect=Fgd/Ggd,this._camera.fov=this._fov,this._camera.setViewplaneSize(Fgd,Ggd,this.enableResponsive),this._camera.updateProjectionMatrix())}};function Hgd(a,b,c,d,e){return(a-b)/(c-b)*(e-d)+d}var Igd=class{get sharedAssets(){return this.shared}constructor(Jgd,Kgd={}){this.shared=new AYb(Jgd.shared,Kgd),this.scene=new dSc(Jgd.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(Lgd,Mgd){this.scene.clearScene(),this.sharedAssets.reset(Lgd.shared),this.scene.resetAfterClear(Lgd.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let Ngd of this.scene.children)Ngd instanceof aCc&&!Ngd.uiScene&&Ngd.personalCamera.updateState(Ngd.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(a=>{a instanceof A_b&&a.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},Ogd=class{constructor({x:Pgd=10,y:Qgd=10}){this._startTime=0;let Rgd=document.getElementById("spe-perfs");Rgd?this.element=Rgd:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${Pgd}px`,this.element.style.top=`${Qgd}px`}dispose(){this.element.parentElement?.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let Sgd=performance.now()-this._startTime;this.element.innerHTML=Sgd.toFixed(3)+" ms"}};function Tgd(a){let b;if(a.index)for(let c=0;c<a.index.array.length;c+=3)b=a.index.array[c],a.index.array[c]=a.index.array[c+2],a.index.array[c+2]=b}function Ugd(a){return a instanceof G0b?"SubdivObject":"NonParametricGeometry"===a.geometry.type?"NonParametric":"Mesh"}var Vgd=r(K(),1),Wgd=new Eb,Xgd=class{constructor(Ygd,{renderOnDemand:Zgd,renderMode:$gd="auto"}={}){var _gd;this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=a=>{if(this.time=a,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,this._perfs?.start(),!this._renderer){this._perfs?.end();return}if(!this._isPaused&&("manual"===this.renderMode&&!this._renderRequested||"auto"===this.renderMode&&this._skipRender)){this._perfs?.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&(this._eventManager.handlers?.Start.hasVideoAction||this._eventManager.handlers?.Basic.hasVideoAction||this._eventManager.handlers?.Conditional.hasVideoAction)&&(this._skipRender=!1),this._animationControls?.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,this._scene?.traverseVisibleEntity(a=>{"ParticleSystem"===a.type&&(a.update(this.dt),this._skipRender=!1)}),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),this._eventManager?.isEnabled&&(this._eventManager.handlers?.Follow.onAnimationFrameDamping(),this._eventManager.handlers?.LookAt.onAnimationFrameDamping(),this._eventManager.handlers?.DragDrop.onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let b=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=b,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),this._perfs?.end()},this._resize=()=>{if(this._renderer){if(1===this._viewportMode&&this._frameView&&(this._frameView.frameSize=Wgd.set(this._viewportWidth,this._viewportHeight)),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._camera=this._scene?.activeCamera,this._scene?.updateViewPlaneSize(this._frameView?.frameSize?.x??this._viewportWidth,this._frameView?.frameSize?.y??this._viewportHeight,this._frameView?.enableResponsive?? !1),this._camera){let a=Object.values(this._data?.frames??{})[0].preset??"fullscreen";this._frameView?.setCamera(this._camera),this._frameView?.updateCamera("fullscreen"!==a),"PerspectiveCamera"===this._camera.cameraType&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=sya(this._resize,10),this._onScroll=a=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=Ygd,this.renderMode=Zgd?"auto":$gd,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new Ogd({x:10,y:10})),(_gd=Ygd).addEventListener("pointerdown",bza,!0),_gd.addEventListener("pointerdown",dza,!0),_gd.addEventListener("pointermove",dza,!0),_gd.addEventListener("pointerup",cza,!0),_gd.addEventListener("pointercancel",cza,!0),_gd.addEventListener("pointerleave",cza,!0),window.addEventListener("keydown",fza,!0),window.addEventListener("keyup",gza,!0)}async load(ahd,bhd,chd){var dhd;let ehd;ehd="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.",(dhd=ahd).endsWith(".spline")?console.warn(ehd+" The .spline files are only meant to be used by the Editor."):dhd.endsWith(".splinecode")||console.warn(ehd),this.disposed=!1,await this.start(await (await fetch(ahd,chd)).arrayBuffer(),{variables:bhd})}async start(fhd,{interactive:ghd=!0,variables:hhd}={}){var ihd;if(this.disposed)return;let jhd=await Nfd(fhd),khd,lhd;this._data=jhd,jhd.version&&(0,Vgd.default)(jhd.version,"1.0.54")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([$6b(jhd)&&function(){if(AOb)return AOb;async function a(){let[a,b]=await Promise.all([c.e(6669).then(c.bind(c,2070)),fetch("https://unpkg.com/@splinetool/boolean-wasm@1.0.54/build/boolean.wasm").then(a=>a.arrayBuffer())]);evb(await a.default({wasmBinary:b}))}return AOb=a()}(),(khd=!1,jhd.scene.objects.traverse((a,b)=>{"Mesh"===b.type&&"SubdivGeometry"===b.geometry.type&&(khd=!0)}),khd&&function(){if(!Ksb)return Psb||(Psb=a());async function a(){let[a,b]=await Promise.all([c.e(6256).then(c.bind(c,6256)),fetch("https://unpkg.com/@splinetool/modelling-wasm@1.0.54/build/process.wasm").then(a=>a.arrayBuffer())]);Isb(await a.default({wasmBinary:b})),Ksb=!0}}()),YNa.physicsEnabled(jhd.scene.objects)&&function(){if(ECa)return ECa;async function a(){let a=await c.e(6122).then(c.bind(c,330));await a.init(),jza(a)}return ECa=a()}(),a2b(jhd)&&function(){if(aWb=!0,!cWb)return b2b||(b2b=a());async function a(){eVb(await c.e(7934).then(c.bind(c,856))),cWb=!0}}(),Nuc(jhd)&&function(){if(!Muc)return oxc||(oxc=a());async function a(){let a=await c.e(4778).then(c.bind(c,4778));Htc(a.default??a),Muc=!0}}(),(lhd=!1,(ihd=jhd).scene.objects.forEach(a=>{"Page"===a.data.type&&!lhd&&a.data.publish.gameControlObject&&YNa.traverseModuleInstances(ihd,a.id,(a,b,c)=>{for(let d of c)"GameControl"===d.data.type&&d.data.navmesh.enabled&&(lhd=!0)})}),lhd&&function(){if(iza)return iza;async function a(){let[a,b]=await Promise.all([c.e(2275).then(c.bind(c,2275)),fetch("https://unpkg.com/@splinetool/navmesh-wasm@1.0.54/build/navmesh.wasm").then(a=>a.arrayBuffer())]);hza(await a.default({wasmBinary:b}))}return iza=a()}())].filter(Boolean)),this._eventManager?.deactivate(),this._controls?.deactivate(),this._scene?.dispose();let mhd=new Igd(jhd);if(mhd.resetPersonalCameraFromDocumentData(),this._scene=mhd.scene,this._sharedAssetsManager=mhd.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let nhd=performance.now();!function(a,b){var c,d,e;let f,g,h=(c=b,d=a,f={},c.traverseEntity(a=>{if(!a.visible||!(a instanceof Bvb)||"Mesh"!==a.type||Array.isArray(a.material)||a.states&&Object.keys(a.states).length)return;let b=a.parent;for(;b;){if(b instanceof Bvb&&a.states&&Object.keys(a.states).length)return;b=b.parent}let c=a.material.uuid,e=d.shared.materials[c];if(e){if(!oNa.isMergable(e))return}else{let g=d.scene.objects.get(a.uuid)?.data;if(g&&"material"in g&&"string"!=typeof g.material){if(!oNa.isMergable(g.material))return;c=oNa.getHash(g.material)}}f[c]||(f[c]={});let h=f[c][Ugd(a)];if(h){if(h.push(a),a.cloner)for(let i of a.cloner.children)h.push(i)}else if(f[c][Ugd(a)]=[a],a.cloner)for(let j of a.cloner.children)f[c][Ugd(a)].push(j)}),f),i=(e=h,g=0,Object.values(e).forEach(a=>{Object.values(a).forEach(a=>{let b=a.length;b>g&&(g=b)})}),g),j=new Array(i),k=0,l=new Array(i),m=0,n=new Array(i),o=0,p=new Array(i),q=0;for(let[r,s]of Object.entries(h))for(let t of Object.values(s)){if(m=0,o=0,t.forEach(a=>{a instanceof Bvb&&(l[m++]=a.geometry.clone(),n[o++]=a)}),o<2)continue;for(let u=0;u<o;u++)n[u].updateWorldMatrix(!0,!1),l[u].applyMatrix4(n[u].matrixWorld),0>n[u].matrixWorld.determinant()&&Tgd(l[u]);let v=vKa(l.slice(0,m),!1);if(v){let w;switch(r){case"SubdivObject":console.warn("Turning subdiv object into mesh"),w=new GH(v,n[0].material);break;default:w=new GH(v,n[0].material);break}w.castShadow=n[0].castShadow,w.receiveShadow=n[0].receiveShadow,b.add(w);let x=a=>{for(let c of(q=0,a))c.children&&x(c.children),c instanceof Bvb&&(Array.isArray(c.material)||h[c.material.uuid]&&h[c.material.uuid][Ugd(c)]&&h[c.material.uuid][Ugd(c)].length>1||(p[q++]=c));for(let d=0;d<q;d++)b.attach(p[d])};for(let y=0;y<o;y++){let z=n[y];x(z.children),j[k++]=z}}}for(let A=0;A<k;A++)j[A].removeFromParent()}(jhd,mhd.scene);let ohd=performance.now();console.log("Merged geometries in ",ohd-nhd," ms")}$6b(jhd)&&this._scene.traverse(a=>{r7b(a)&&a.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{this._requestRenderAutoMode(),this._scene?.traverse(a=>{a instanceof E2b&&a.pendingMediaLoad&&a.update()})}),this._scene?.traverse(a=>{"ParticleSystem"===a.type&&(a.wakeUp(),a.data.autoPlay?a.start():a.stop())});let phd=Object.keys(jhd.shared.fonts).map(a=>this._sharedAssetsManager.getFont(a).loadingPromise);if(Promise.all(phd).then(()=>{mhd.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),a2b(jhd)&&(function(a){if(YNa.physicsEnabled(a.scene.objects))return!0;let b=!1;return a.scene.objects.traverse((a,c)=>{if(c.events){if(Array.isArray(c.events)){for(let d of c.events)if(!0!==d.data.disabled&&"GameControl"===d.data.type&&d.data.collisionEnabled){b=!0;break}}else for(let e of Object.values(c.events))if(!0!==e.disabled&&"GameControl"===e.type&&e.collisionEnabled){b=!0;break}}}),b})(jhd)&&await Promise.all(phd),Nuc(jhd)){let qhd=[];this._scene.traverseEntity(a=>{(a instanceof jEc||a instanceof aCc)&&a.uiCanvas&&qhd.push(a.uiCanvas)}),await Promise.all(qhd.map(a=>a.promise))}this._scene.rewriteEventsBeforeGoToPlayMode(),gYc(this._scene.activePage,this._sharedAssetsManager),this._renderer||(this._renderer=new Wpc({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=!0===jhd.scene.publish.hdTransmission,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode)),this._scene.initializeSplatViewer(this._renderer),void 0!==jhd.scene.blueNoiseTextureData&&this._renderer.pipeline.updateBlueNoiseTexture(jhd.scene.blueNoiseTextureData);let rhd=Object.values(jhd.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):("fullscreen"===rhd.preset?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=rhd.size[0],this._viewportHeight=rhd.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new pgd(this._renderer,this._camera,new Eb(this._viewportWidth,this._viewportHeight),new Eb(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(rhd.allowResponsive?? !1)&&"fullscreen"===rhd.preset),ghd){let shd=new u1c(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,rhd);this._scene.updateMatrixWorld(!0),this._controls=new Mcd(shd),this._animationControls=new Bed(this._scene,this._requestRenderAutoMode),this._eventManager=new bgd(jhd.scene.publish,this._controls,this._animationControls,shd,jhd.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),void 0!==hhd&&this.setVariables(hhd),0===this.dt&&(this.render(performance.now()),setTimeout(()=>{this._renderer?.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300),document.addEventListener("scroll",this._onScroll)}setVariables(thd){if(void 0!==this._data){let uhd=Object.entries(thd);for(let[vhd,whd]of uhd)this.setVariable(vhd,whd)}}setVariable(xhd,yhd){let zhd=this._getVariableByName(xhd);if(!zhd||"dynamicVariableType"in zhd.data)void 0===zhd?console.warn(`No variable named ${xhd} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in zhd.data&&console.warn(`Dynamic variables like ${xhd} cannot be updated from code.`);else{let Ahd=yhd;"number"==typeof zhd.data.value?Ahd="number"==typeof yhd?yhd:"boolean"==typeof yhd?!0===yhd?1:0:parseFloat(yhd):"boolean"==typeof zhd.data.value?Ahd="number"==typeof yhd?!!yhd:"boolean"==typeof yhd?yhd:"false"!==yhd.toLocaleLowerCase()&&!!yhd:"string"!=typeof zhd.data.value&& void 0!==zhd.data.value.textValue&&(Ahd=yhd.toString());let Bhd="string"==typeof Ahd?{textValue:Ahd}:Ahd;this._sharedAssetsManager?.updateVariable(zhd.id,Bhd),this.requestRender(),this._requestRenderAutoMode()}}getVariables(){let Chd={};return this._data&&this._data.shared.variables.forEach(a=>{void 0===Chd[a.data.name]&&(Chd[a.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(a.id)))}),Chd}getVariable(Dhd){let Ehd=this._getVariableByName(Dhd);if(Ehd){let Fhd=this._sharedAssetsManager.getVariable(Ehd.id);return this._getVariableValue(Fhd)}}_getVariableValue(Ghd){return"string"!=typeof Ghd&&aOa.isTextValue(Ghd)?aOa.getDisplayedValue(Ghd):Ghd}_getVariableByName(Hhd){if(this._data){if(this._variablesCache.has(Hhd))return this._variablesCache.get(Hhd);let Ihd=this._data.shared.variables.find(a=>a.data.name===Hhd);return Ihd&&this._variablesCache.set(Hhd,Ihd),Ihd}}findObjectById(Jhd){let Khd=this._scene?.getObjectByProperty("uuid",Jhd);return this._createProxyObject(Khd)}findObjectByName(Lhd){let Mhd=this._scene?.getObjectByName(Lhd);return this._createProxyObject(Mhd)}getAllObjects(){let Nhd=[];return this._scene?.traverseEntity(a=>{if(a.uuid!==QIa&&!this._scene.isInvisibleObjects(a)&&!(a instanceof aCc)){let b=this._createProxyObject(a);b&&Nhd.push(b)}}),Nhd}getSplineEvents(){return this._eventManager?.handlers?.Spline.splineEvents}emitEvent(Ohd,Phd){(this.findObjectById(Phd)||this.findObjectByName(Phd))?.emitEvent(Ohd)}emitEventReverse(Qhd,Rhd){(this.findObjectById(Rhd)||this.findObjectByName(Rhd))?.emitEventReverse(Qhd)}addEventListener(Shd,Thd){this.canvas.addEventListener(Shd,Thd)}removeEventListener(Uhd,Vhd){this.canvas.removeEventListener(Uhd,Vhd)}setZoom(Whd){this._controls?.orbitControls instanceof Sad&&this._controls?.orbitControls.zoomOut(Whd)}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(Xhd,Yhd){this._viewportWidth=Xhd,this._viewportHeight=Yhd,this._viewportMode=2,this._resize()}setBackgroundColor(Zhd){let{r:$hd,g:_hd,b:aid,a:bid}={r:0,g:0,b:0,a:1},cid=new Vxb($hd,_hd,aid,bid);try{cid.setStyle(Zhd)}catch{console.error("This is not a valid css color",Zhd)}this._scene?.activePage.setBackgroundColor(cid),this._requestRenderAutoMode()}dispose(){var did;this.disposed=!0,this._eventManager?.deactivate(),this._scene?.dispose(),this._sharedAssetsManager?.dispose(),this._proxyObjectCache.forEach(a=>{gua.unsubscribe(a)}),this._variablesCache.clear(),this._renderer?.setAnimationLoop(null),this._renderer?.dispose(),this._renderer=void 0,this._sharedAssetsManager?.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),void 0!==this._resizeObserverTimeout&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),this._controls?.deactivate(),(did=this.canvas).removeEventListener("pointerdown",bza,!0),did.removeEventListener("pointerdown",dza,!0),did.removeEventListener("pointermove",dza,!0),did.removeEventListener("pointerup",cza,!0),did.removeEventListener("pointercancel",cza,!0),did.removeEventListener("pointerleave",cza,!0),window.removeEventListener("keydown",fza,!0),window.removeEventListener("keyup",gza,!0),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){this._isPaused||(this._renderer?.setAnimationLoop(null),this._isPaused=!0,this._eventManager?.pause(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){this._isPaused&&(this._isPaused=!1,this._eventManager?.resume(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!0),this._renderer?.setAnimationLoop(this.render))}setGlobalEvents(eid){this._eventManager?.updateUseWindowEvents(eid)}get data(){return this._data}_createProxyObject(fid){if(null==fid)return;if(this._proxyObjectCache.has(fid.uuid))return this._proxyObjectCache.get(fid.uuid);let gid;fid.traverseAncestors(a=>{a instanceof aCc&&(gid=a.name)});let hid=gua({name:fid.name,uuid:fid.uuid,visible:fid.visible,intensity:fid.intensity,position:fid.position,rotation:fid.rotation,scale:fid.scale,type:fid.data.type,page:gid,parentUuid:fid.parent instanceof aCc||fid instanceof dSc?void 0:fid.parent?.uuid,emitEvent(a){fid.dispatchEvent({type:"userEvent",eventName:a})},emitEventReverse(a){fid.dispatchEvent({type:"userEvent",eventName:a,reverse:!0})}},(a,b)=>{"object"!=typeof fid[a]&&Object.getOwnPropertyDescriptor(fid,a)?.writable&&(fid[a]=b),this._requestRenderAutoMode(),fid.updateMatrix()});return this._proxyObjectCache.set(fid.uuid,hid),hid}setUIWasmUrl(iid){YNb.skiaWasmUrl=iid}}}}])